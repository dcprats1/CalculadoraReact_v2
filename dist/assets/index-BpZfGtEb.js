var tn=Object.defineProperty;var ds=t=>{throw TypeError(t)};var rn=(t,r,e)=>r in t?tn(t,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[r]=e;var bt=(t,r,e)=>rn(t,typeof r!="symbol"?r+"":r,e),Tr=(t,r,e)=>r.has(t)||ds("Cannot "+e);var O=(t,r,e)=>(Tr(t,r,"read from private field"),e?e.call(t):r.get(t)),ke=(t,r,e)=>r.has(t)?ds("Cannot add the same private member more than once"):r instanceof WeakSet?r.add(t):r.set(t,e),Ie=(t,r,e,s)=>(Tr(t,r,"write to private field"),s?s.call(t,e):r.set(t,e),e),Ae=(t,r,e)=>(Tr(t,r,"access private method"),e);var qt=(t,r,e,s)=>({set _(a){Ie(t,r,a,e)},get _(){return O(t,r,s)}});import{r as reactExports,a as reactDomExports,R as React,g as getAugmentedNamespace,c as commonjsGlobal,u as useNavigate,B as BrowserRouter,b as Routes,d as Route}from"./react-vendor-CRwc5v4Q.js";import{c as createClient}from"./supabase-NSeaGaan.js";import{M as Mail,L as Loader2,A as ArrowLeft,a as AlertCircle,C as Calculator,b as ArrowRight,X,c as CheckCircle,S as Save,B as Building,d as Calendar,F as FileSpreadsheet,e as FileText,T as TrendingUp,f as Smartphone,g as Check,I as Info,h as Shield,i as CreditCard,U as Users,E as Eye,j as AlertTriangle,k as XCircle,l as CheckCircle2,m as Upload,n as FileUp,R as RotateCcw,o as Trash2,D as Download,p as Settings,q as User,r as UserPlus,G as Gift,P as Plus,s as Pen,t as Copy,u as Package,v as Minus,w as Ruler,x as Euro,y as Percent,z as LogOut,H as MapPin,J as EyeOff,K as ArrowUp,N as Sliders,O as RefreshCw,Q as Home,V as Loader}from"./icons-KwxofFD9.js";import{c as commonjsRequire,e as exceljs_minExports}from"./excel-Brlu1TUx.js";var jsxRuntime={exports:{}},reactJsxRuntime_production_min={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var f=reactExports,k=Symbol.for("react.element"),l=Symbol.for("react.fragment"),m$1=Object.prototype.hasOwnProperty,n=f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p={key:!0,ref:!0,__self:!0,__source:!0};function q(t,r,e){var s,a={},i=null,o=null;e!==void 0&&(i=""+e),r.key!==void 0&&(i=""+r.key),r.ref!==void 0&&(o=r.ref);for(s in r)m$1.call(r,s)&&!p.hasOwnProperty(s)&&(a[s]=r[s]);if(t&&t.defaultProps)for(s in r=t.defaultProps,r)a[s]===void 0&&(a[s]=r[s]);return{$$typeof:k,type:t,key:i,ref:o,props:a,_owner:n.current}}reactJsxRuntime_production_min.Fragment=l;reactJsxRuntime_production_min.jsx=q;reactJsxRuntime_production_min.jsxs=q;jsxRuntime.exports=reactJsxRuntime_production_min;var jsxRuntimeExports=jsxRuntime.exports,createRoot,m=reactDomExports;createRoot=m.createRoot,m.hydrateRoot;const supabaseUrl="https://eyvhuoldrjfntkffpkfm.supabase.co",supabaseAnonKey="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV5dmh1b2xkcmpmbnRrZmZwa2ZtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg2Mzk3MjgsImV4cCI6MjA3NDIxNTcyOH0.3zYeVfbaU71HNYQK_29Qki1fnQhLGccFtIFDZn_x2Es",supabase=createClient(supabaseUrl,supabaseAnonKey),ALLOWED_DOMAIN="@gls-spain.es",ADMIN_EMAIL="dcprats@gmail.com",TEST_USER_EMAIL="damaso.prats@logicalogistica.com",ALLOWED_EXCEPTIONS=[ADMIN_EMAIL,TEST_USER_EMAIL];function isAllowedEmail(t){const r=t.toLowerCase().trim();return!!(ALLOWED_EXCEPTIONS.includes(r)||r.endsWith(ALLOWED_DOMAIN))}const INVALID_EMAIL_ERROR="Solo usuarios @gls-spain.es pueden iniciar sesión",AuthContext=reactExports.createContext(void 0);function AuthProvider({children:t}){const[r,e]=reactExports.useState(null),[s,a]=reactExports.useState(null),[i,o]=reactExports.useState(!0),[c,h]=reactExports.useState(null);reactExports.useEffect(()=>{async function E(){try{const x=localStorage.getItem("user_session");if(x)try{const g=JSON.parse(x);if(g.expiresAt&&new Date(g.expiresAt)<new Date){localStorage.removeItem("user_session"),h("Tu sesión ha expirado. Por favor, inicia sesión nuevamente.");return}e({id:g.id,email:g.email}),await u(g.id)}catch{localStorage.removeItem("user_session")}}finally{o(!1)}}E()},[]),reactExports.useEffect(()=>{let E=null;return r&&(E=window.setInterval(()=>{const x=localStorage.getItem("user_session");if(x)try{const g=JSON.parse(x);g.expiresAt&&new Date(g.expiresAt)<new Date&&(localStorage.removeItem("user_session"),e(null),a(null),h("Tu sesión ha expirado después de 24 horas. Por favor, inicia sesión nuevamente."))}catch(g){console.error("Error checking session expiry:",g)}},6e4)),()=>{E!==null&&clearInterval(E)}},[r]);async function u(E){try{const{data:x,error:g}=await supabase.from("user_profiles").select("*").eq("id",E).maybeSingle();if(g)throw g;if(x){const w=x.email.split("@")[0].split(".").map(R=>R.charAt(0).toUpperCase()+R.slice(1)).join(" ");a({id:x.id,email:x.email,full_name:w,subscription_status:x.subscription_status,subscription_tier:x.subscription_tier,max_devices:x.max_devices,subscription_end_date:x.subscription_end_date,subscription_interval:x.subscription_interval||"monthly",payment_method:x.payment_method,is_admin:x.email==="dcprats@gmail.com"})}}catch(x){console.error("Error loading user profile:",x)}}async function d(E){try{if(!isAllowedEmail(E))return{success:!1,error:INVALID_EMAIL_ERROR};const x=`${navigator.userAgent}-${screen.width}x${screen.height}`,w=await(await fetch("https://eyvhuoldrjfntkffpkfm.supabase.co/functions/v1/check-active-session",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV5dmh1b2xkcmpmbnRrZmZwa2ZtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg2Mzk3MjgsImV4cCI6MjA3NDIxNTcyOH0.3zYeVfbaU71HNYQK_29Qki1fnQhLGccFtIFDZn_x2Es"},body:JSON.stringify({email:E.toLowerCase().trim(),deviceFingerprint:x})})).json();if(w.hasActiveSession){const M={id:w.user.id,email:w.user.email,sessionToken:w.sessionToken,expiresAt:w.user.expiresAt};return localStorage.setItem("user_session",JSON.stringify(M)),e({id:w.user.id,email:w.user.email}),await u(w.user.id),{success:!0,autoLogin:!0}}const R=await fetch("https://eyvhuoldrjfntkffpkfm.supabase.co/functions/v1/send-login-code",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV5dmh1b2xkcmpmbnRrZmZwa2ZtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg2Mzk3MjgsImV4cCI6MjA3NDIxNTcyOH0.3zYeVfbaU71HNYQK_29Qki1fnQhLGccFtIFDZn_x2Es"},body:JSON.stringify({email:E.toLowerCase().trim()})}),N=await R.json();return R.ok?(N.code&&console.log(`Código de inicio de sesión para ${E}: ${N.code}`),{success:!0}):{success:!1,error:N.error||"Error al enviar código",errorCode:N.errorCode,email:N.email}}catch(x){return console.error("Error sending code:",x),{success:!1,error:"Error de conexión"}}}async function _(E,x){try{const g=`${navigator.userAgent}-${screen.width}x${screen.height}`,w=`${navigator.platform} - ${navigator.userAgent.substring(0,50)}`,R=await fetch("https://eyvhuoldrjfntkffpkfm.supabase.co/functions/v1/verify-login-code",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV5dmh1b2xkcmpmbnRrZmZwa2ZtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg2Mzk3MjgsImV4cCI6MjA3NDIxNTcyOH0.3zYeVfbaU71HNYQK_29Qki1fnQhLGccFtIFDZn_x2Es"},body:JSON.stringify({email:E.toLowerCase().trim(),code:x,deviceFingerprint:g,deviceName:w})}),N=await R.json();if(!R.ok)return{success:!1,error:N.error||"Código incorrecto"};const M={id:N.user.id,email:N.user.email,sessionToken:N.sessionToken,expiresAt:N.user.expiresAt};return localStorage.setItem("user_session",JSON.stringify(M)),e({id:N.user.id,email:N.user.email}),h(null),await u(N.user.id),{success:!0}}catch(g){return console.error("Error verifying code:",g),{success:!1,error:"Error de conexión"}}}async function b(){localStorage.removeItem("user_session"),e(null),a(null),h(null)}const v={user:r,userData:s,isAuthenticated:!!r,isLoading:i,sendLoginCode:d,verifyCode:_,signOut:b,sessionExpiredMessage:c};return jsxRuntimeExports.jsx(AuthContext.Provider,{value:v,children:t})}function useAuth(){const t=reactExports.useContext(AuthContext);if(t===void 0)throw new Error("useAuth must be used within an AuthProvider");return t}const PreferencesContext=reactExports.createContext(void 0);function PreferencesProvider({children:t}){const{user:r,isAuthenticated:e}=useAuth(),[s,a]=reactExports.useState(null),[i,o]=reactExports.useState(!1);reactExports.useEffect(()=>{e&&r?c():a(null)},[e,r]);async function c(){if(r!=null&&r.id){o(!0);try{const{data:_,error:b}=await supabase.from("user_preferences").select("*").eq("user_id",r.id).maybeSingle();if(b)throw b;if(_)a(_);else{const{data:v,error:E}=await supabase.from("user_preferences").insert({user_id:r.id,fixed_spc_value:null,fixed_discount_percentage:null,default_service_packages:[],ui_theme:"light"}).select().single();if(E)throw E;a(v)}}catch(_){console.error("Error loading preferences:",_)}finally{o(!1)}}}async function h(_){if(!(r!=null&&r.id))return!1;try{const{data:b,error:v}=await supabase.from("user_preferences").update(_).eq("user_id",r.id).select().single();if(v)throw v;return b?(a(b),!0):!1}catch(b){return console.error("Error updating preferences:",b),!1}}async function u(){await c()}const d={preferences:s,isLoading:i,updatePreferences:h,refreshPreferences:u};return jsxRuntimeExports.jsx(PreferencesContext.Provider,{value:d,children:t})}function usePreferences(){const t=reactExports.useContext(PreferencesContext);if(t===void 0)throw new Error("usePreferences must be used within a PreferencesProvider");return t}const ViewModeContext=reactExports.createContext(void 0);function ViewModeProvider({children:t}){const[r,e]=reactExports.useState(()=>{const a=localStorage.getItem("admin_view_mode");return a==="user"||a==="admin"?a:"admin"}),s=a=>{e(a),localStorage.setItem("admin_view_mode",a)};return reactExports.useEffect(()=>{const a=i=>{i.key==="admin_view_mode"&&(i.newValue==="admin"||i.newValue==="user")&&e(i.newValue)};return window.addEventListener("storage",a),()=>window.removeEventListener("storage",a)},[]),jsxRuntimeExports.jsx(ViewModeContext.Provider,{value:{viewMode:r,setViewMode:s,isAdminView:r==="admin"},children:t})}function useViewMode(){const t=reactExports.useContext(ViewModeContext);if(t===void 0)throw new Error("useViewMode must be used within a ViewModeProvider");return t}function EmailInputForm({onSubmit:t,initialEmail:r=""}){const[e,s]=reactExports.useState(r),[a,i]=reactExports.useState(!1),[o,c]=reactExports.useState(""),h=async u=>{if(u.preventDefault(),c(""),!e||!e.includes("@")){c("Por favor introduce un email válido");return}i(!0);try{await t(e)}catch(d){c(d.message||"Error al enviar código")}finally{i(!1)}};return jsxRuntimeExports.jsxs("form",{onSubmit:h,className:"space-y-6",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-2",children:"Email corporativo"}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:jsxRuntimeExports.jsx(Mail,{className:"h-5 w-5 text-gray-400"})}),jsxRuntimeExports.jsx("input",{id:"email",type:"email",value:e,onChange:u=>s(u.target.value),disabled:a,className:"block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed transition-colors",placeholder:"tu@empresa.com",autoComplete:"email",autoFocus:!0})]}),o&&jsxRuntimeExports.jsx("p",{className:"mt-2 text-sm text-red-600",children:o})]}),jsxRuntimeExports.jsx("button",{type:"submit",disabled:a,className:"w-full flex items-center justify-center px-4 py-3 border border-transparent text-base font-medium rounded-lg text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:a?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Loader2,{className:"animate-spin -ml-1 mr-3 h-5 w-5"}),"Enviando código..."]}):"Enviar código de acceso"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-center text-gray-500",children:"Recibirás un código de 6 dígitos válido durante 15 minutos"})]})}function CodeVerificationForm({email:t,onVerify:r,onBack:e,devCode:s}){const[a,i]=reactExports.useState(["","","","","",""]),[o,c]=reactExports.useState(!1),[h,u]=reactExports.useState(""),d=reactExports.useRef([]);reactExports.useEffect(()=>{var x;(x=d.current[0])==null||x.focus()},[]);const _=(x,g)=>{var R;if(!/^\d*$/.test(g))return;const w=[...a];w[x]=g.slice(-1),i(w),u(""),g&&x<5&&((R=d.current[x+1])==null||R.focus()),w.every(N=>N!=="")&&E(w.join(""))},b=(x,g)=>{var w;g.key==="Backspace"&&!a[x]&&x>0&&((w=d.current[x-1])==null||w.focus())},v=x=>{x.preventDefault();const g=x.clipboardData.getData("text").replace(/\D/g,"").slice(0,6);if(g.length===6){const w=g.split("");i(w),E(g)}},E=async x=>{var g;if(x.length===6){c(!0),u("");try{await r(x)}catch(w){u(w.message||"Código inválido"),i(["","","","","",""]),(g=d.current[0])==null||g.focus()}finally{c(!1)}}};return jsxRuntimeExports.jsxs("div",{className:"space-y-6",children:[jsxRuntimeExports.jsxs("button",{type:"button",onClick:e,disabled:o,className:"flex items-center text-sm text-gray-600 hover:text-gray-900 transition-colors disabled:opacity-50",children:[jsxRuntimeExports.jsx(ArrowLeft,{className:"h-4 w-4 mr-1"}),"Volver"]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Introduce el código"}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-gray-600",children:["Enviado a ",jsxRuntimeExports.jsx("span",{className:"font-medium",children:t})]})]}),s&&jsxRuntimeExports.jsx("div",{className:"p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:jsxRuntimeExports.jsxs("p",{className:"text-sm text-yellow-800",children:[jsxRuntimeExports.jsx("strong",{children:"DEV MODE:"})," Código: ",jsxRuntimeExports.jsx("span",{className:"font-mono font-bold",children:s})]})}),jsxRuntimeExports.jsx("div",{className:"flex gap-2 justify-center",onPaste:v,children:a.map((x,g)=>jsxRuntimeExports.jsx("input",{ref:w=>d.current[g]=w,type:"text",inputMode:"numeric",maxLength:1,value:x,onChange:w=>_(g,w.target.value),onKeyDown:w=>b(g,w),disabled:o,className:"w-12 h-14 text-center text-2xl font-bold border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-100 disabled:cursor-not-allowed transition-all"},g))}),h&&jsxRuntimeExports.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-red-800",children:h})}),o&&jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-center text-sm text-gray-600",children:[jsxRuntimeExports.jsx(Loader2,{className:"animate-spin mr-2 h-4 w-4"}),"Verificando código..."]}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-center text-gray-500",children:["¿No recibiste el código?"," ",jsxRuntimeExports.jsx("button",{type:"button",onClick:e,disabled:o,className:"text-blue-600 hover:text-blue-700 font-medium disabled:opacity-50",children:"Reenviar"})]})]})}function UnregisteredUserView({email:t,onViewPricing:r,onBackToLogin:e}){return jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-blue-50 flex items-center justify-center p-4",children:jsxRuntimeExports.jsxs("div",{className:"w-full max-w-2xl",children:[jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8 space-y-6",children:[jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-yellow-100 rounded-2xl mb-4",children:jsxRuntimeExports.jsx(AlertCircle,{className:"h-8 w-8 text-yellow-600"})}),jsxRuntimeExports.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Usuario No Registrado"}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["El email ",jsxRuntimeExports.jsx("span",{className:"font-semibold text-gray-900",children:t})," no está dado de alta en el sistema"]})]}),jsxRuntimeExports.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-6",children:[jsxRuntimeExports.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[jsxRuntimeExports.jsx(Calculator,{className:"h-5 w-5 text-blue-600"}),"¿Por qué elegir nuestra calculadora?"]}),jsxRuntimeExports.jsxs("ul",{className:"space-y-2 text-sm text-gray-700",children:[jsxRuntimeExports.jsxs("li",{className:"flex items-start gap-2",children:[jsxRuntimeExports.jsx("span",{className:"text-blue-600 font-bold mt-0.5",children:"•"}),jsxRuntimeExports.jsxs("span",{children:[jsxRuntimeExports.jsx("strong",{children:"Precisión Total:"})," Cálculos exactos incluyendo costes ocultos e incrementos"]})]}),jsxRuntimeExports.jsxs("li",{className:"flex items-start gap-2",children:[jsxRuntimeExports.jsx("span",{className:"text-blue-600 font-bold mt-0.5",children:"•"}),jsxRuntimeExports.jsxs("span",{children:[jsxRuntimeExports.jsx("strong",{children:"Ahorro Inmediato:"})," Recupera tu inversión en días con un solo uso diario"]})]}),jsxRuntimeExports.jsxs("li",{className:"flex items-start gap-2",children:[jsxRuntimeExports.jsx("span",{className:"text-blue-600 font-bold mt-0.5",children:"•"}),jsxRuntimeExports.jsxs("span",{children:[jsxRuntimeExports.jsx("strong",{children:"Comparativa Competitiva:"})," Genera propuestas profesionales en minutos"]})]}),jsxRuntimeExports.jsxs("li",{className:"flex items-start gap-2",children:[jsxRuntimeExports.jsx("span",{className:"text-blue-600 font-bold mt-0.5",children:"•"}),jsxRuntimeExports.jsxs("span",{children:[jsxRuntimeExports.jsx("strong",{children:"Multi-dispositivo:"})," Accede desde todos tus dispositivos"]})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsxs("button",{onClick:r,className:"w-full flex items-center justify-center gap-2 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium shadow-md hover:shadow-lg",children:["Ver Planes y Precios",jsxRuntimeExports.jsx(ArrowRight,{className:"h-5 w-5"})]}),jsxRuntimeExports.jsxs("button",{onClick:e,className:"w-full flex items-center justify-center gap-2 px-6 py-3 bg-white text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors font-medium",children:[jsxRuntimeExports.jsx(ArrowLeft,{className:"h-5 w-5"}),"Volver al Login"]})]}),jsxRuntimeExports.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-xl p-4",children:jsxRuntimeExports.jsxs("p",{className:"text-xs text-gray-600 text-center",children:[jsxRuntimeExports.jsx("strong",{children:"¿Ya tienes una cuenta?"})," Si crees que esto es un error, contacta con el administrador en"," ",jsxRuntimeExports.jsx("a",{href:"mailto:dcprats@gmail.com",className:"text-blue-600 hover:underline",children:"dcprats@gmail.com"})]})})]}),jsxRuntimeExports.jsxs("p",{className:"mt-6 text-center text-xs text-gray-500",children:["© ",new Date().getFullYear()," Lógica Logística. Todos los derechos reservados."]})]})})}function LoginContainer({onShowPricing:t}={}){const{sendLoginCode:r,verifyCode:e,sessionExpiredMessage:s}=useAuth(),[a,i]=reactExports.useState("email"),[o,c]=reactExports.useState(""),[h,u]=reactExports.useState(),[d,_]=reactExports.useState(null),[b,v]=reactExports.useState(""),[E,x]=reactExports.useState(!1);reactExports.useEffect(()=>{const M=localStorage.getItem("recently_activated");if(M)try{const A=JSON.parse(M),I=new Date(A.timestamp).getTime(),y=new Date().getTime(),j=5*60*1e3;y-I<j?(v(A.email),x(!0),setTimeout(()=>{x(!1)},8e3)):localStorage.removeItem("recently_activated")}catch(A){console.error("Error parsing recently_activated:",A),localStorage.removeItem("recently_activated")}},[]);const g=async M=>{c(M);const A=await r(M);if(A.success){if(A.autoLogin)return;A.code&&u(A.code),i("code")}else if(A.errorCode==="USER_NOT_FOUND")_({email:A.email||M}),i("unregistered");else throw new Error(A.error||"Error al enviar código")},w=async M=>{const A=await e(o,M);if(!A.success)throw new Error(A.error||"Código inválido")},R=()=>{i("email"),u(void 0),_(null)},N=()=>{t&&d&&t(d.email)};return a==="unregistered"&&d?jsxRuntimeExports.jsx(UnregisteredUserView,{email:d.email,onViewPricing:N,onBackToLogin:R}):jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-blue-50 flex items-center justify-center p-4",children:jsxRuntimeExports.jsxs("div",{className:"w-full max-w-md",children:[jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8 space-y-8",children:[jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-blue-600 rounded-2xl mb-4",children:jsxRuntimeExports.jsx(Calculator,{className:"h-8 w-8 text-white"})}),jsxRuntimeExports.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Calculadora de Tarifas"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600",children:"Accede a tu cuenta corporativa"})]}),s&&jsxRuntimeExports.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-amber-800 text-center",children:s})}),E&&jsxRuntimeExports.jsxs("div",{className:"bg-green-50 border-2 border-green-500 rounded-xl p-4 mb-6 relative animate-fade-in shadow-lg",children:[jsxRuntimeExports.jsx("button",{onClick:()=>x(!1),className:"absolute top-2 right-2 text-green-700 hover:text-green-900 transition-colors",children:jsxRuntimeExports.jsx(X,{className:"h-5 w-5"})}),jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-3",children:[jsxRuntimeExports.jsx("div",{className:"flex-shrink-0 mt-0.5",children:jsxRuntimeExports.jsx(CheckCircle,{className:"h-6 w-6 text-green-600"})}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("h3",{className:"text-sm font-bold text-green-900 mb-1",children:"¡Bienvenido! Tu cuenta está lista"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-green-800",children:"Introduce tu email para recibir el código de acceso y empezar a usar la calculadora."})]})]})]}),a==="email"&&jsxRuntimeExports.jsx(EmailInputForm,{onSubmit:g,initialEmail:b}),a==="code"&&jsxRuntimeExports.jsx(CodeVerificationForm,{email:o,onVerify:w,onBack:R,devCode:h})]}),jsxRuntimeExports.jsxs("p",{className:"mt-6 text-center text-xs text-gray-500",children:["© ",new Date().getFullYear()," Lógica Logística. Todos los derechos reservados."]})]})})}const DEBOUNCE_DELAY=6e4,pendingActivities=new Map,debounceTimers=new Map;async function sendActivityToServer(t,r){try{const e=await fetch("https://eyvhuoldrjfntkffpkfm.supabase.co/functions/v1/track-user-activity",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV5dmh1b2xkcmpmbnRrZmZwa2ZtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg2Mzk3MjgsImV4cCI6MjA3NDIxNTcyOH0.3zYeVfbaU71HNYQK_29Qki1fnQhLGccFtIFDZn_x2Es"},body:JSON.stringify({user_id:t,activity_type:r})});if(!e.ok){const s=await e.json().catch(()=>({}));console.warn("[Tracking] Error al registrar actividad:",s)}}catch(e){console.warn("[Tracking] Error de red al registrar actividad:",e)}}function trackActivity(t,r){if(!t)return;const e=`${t}-${r}`;if(r==="calculation"){const s=debounceTimers.get(e);s&&clearTimeout(s),pendingActivities.set(e,{userId:t,type:r,timestamp:Date.now()});const a=setTimeout(()=>{const i=pendingActivities.get(e);i&&(sendActivityToServer(i.userId,i.type),pendingActivities.delete(e),debounceTimers.delete(e))},DEBOUNCE_DELAY);debounceTimers.set(e,a)}else sendActivityToServer(t,r)}function trackPackageCalculation(t){trackActivity(t,"calculation")}function trackSOPDownload(t){trackActivity(t,"sop_download")}function trackMiniSOPDownload(t){trackActivity(t,"minisop_download")}function PreferencesTab(){const{preferences:t,updatePreferences:r,isLoading:e}=usePreferences(),[s,a]=reactExports.useState({fixed_spc_value:"",fixed_discount_percentage:""}),[i,o]=reactExports.useState(!1),[c,h]=reactExports.useState(!1);reactExports.useEffect(()=>{var d,_;t&&a({fixed_spc_value:((d=t.fixed_spc_value)==null?void 0:d.toString())||"",fixed_discount_percentage:((_=t.fixed_discount_percentage)==null?void 0:_.toString())||""})},[t]);const u=async()=>{o(!0),h(!1);const d={fixed_spc_value:s.fixed_spc_value?parseFloat(s.fixed_spc_value):null,fixed_discount_percentage:s.fixed_discount_percentage?parseFloat(s.fixed_discount_percentage):null},_=await r(d);o(!1),_&&(h(!0),setTimeout(()=>h(!1),3e3))};return e?jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center h-64",children:jsxRuntimeExports.jsx(Loader2,{className:"h-8 w-8 animate-spin text-blue-600"})}):jsxRuntimeExports.jsxs("div",{className:"space-y-6",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Preferencias de cálculo"}),jsxRuntimeExports.jsxs("div",{className:"space-y-6 bg-gray-50 rounded-lg p-6",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{htmlFor:"fixed_spc_value",className:"block text-sm font-medium text-gray-700 mb-2",children:"Valor SPC fijo (opcional)"}),jsxRuntimeExports.jsx("input",{type:"number",id:"fixed_spc_value",step:"0.01",value:s.fixed_spc_value,onChange:d=>a({...s,fixed_spc_value:d.target.value}),placeholder:"Ej: 1.50",className:"block w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Si estableces un valor (positivo o negativo), los cálculos usarán este SPC automáticamente"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{htmlFor:"fixed_discount_percentage",className:"block text-sm font-medium text-gray-700 mb-2",children:"Descuento lineal fijo % (opcional)"}),jsxRuntimeExports.jsx("input",{type:"number",id:"fixed_discount_percentage",step:"0.1",min:"0",max:"100",value:s.fixed_discount_percentage,onChange:d=>a({...s,fixed_discount_percentage:d.target.value}),placeholder:"Ej: 5.0",className:"block w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Si estableces un valor, los cálculos aplicarán este descuento automáticamente (debe ser positivo)"})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-200",children:[c&&jsxRuntimeExports.jsxs("div",{className:"flex items-center text-green-600",children:[jsxRuntimeExports.jsx(CheckCircle,{className:"h-5 w-5 mr-2"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-medium",children:"Preferencias guardadas"})]}),jsxRuntimeExports.jsx("button",{onClick:u,disabled:i,className:"ml-auto flex items-center px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:i?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Loader2,{className:"animate-spin -ml-1 mr-2 h-5 w-5"}),"Guardando..."]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Save,{className:"-ml-1 mr-2 h-5 w-5"}),"Guardar cambios"]})})]})]})}function useUserStats(){const{user:t,isAuthenticated:r}=useAuth(),[e,s]=reactExports.useState(null),[a,i]=reactExports.useState([]),[o,c]=reactExports.useState(!1),[h,u]=reactExports.useState(null);reactExports.useEffect(()=>{r&&t?d():(s(null),i([]))},[r,t]);async function d(){if(t!=null&&t.id){c(!0),u(null);try{const{data:b,error:v}=await supabase.rpc("get_user_activity_summary",{p_user_id:t.id}).maybeSingle();if(v)throw v;s(b?{total_sop:b.total_sop||0,total_minisop:b.total_minisop||0,total_calculations:b.total_calculations||0,days_active:b.days_active||0,average_calculations_per_day:b.average_calculations_per_day||0,first_activity:b.first_activity,last_activity:b.last_activity}:{total_sop:0,total_minisop:0,total_calculations:0,days_active:0,average_calculations_per_day:0,first_activity:null,last_activity:null});const{data:E,error:x}=await supabase.from("user_daily_activity").select("activity_date, calculation_count, sop_count, minisop_count").eq("user_id",t.id).order("activity_date",{ascending:!1}).limit(7);if(x)throw x;i(E||[])}catch(b){console.error("Error loading user stats:",b),u(b instanceof Error?b.message:"Error al cargar estadísticas"),s({total_sop:0,total_minisop:0,total_calculations:0,days_active:0,average_calculations_per_day:0,first_activity:null,last_activity:null})}finally{c(!1)}}}async function _(){await d()}return{stats:e,dailyActivity:a,isLoading:o,error:h,refreshStats:_}}function ProfileTab(){var x;const{userData:t,user:r}=useAuth(),{preferences:e,updatePreferences:s}=usePreferences(),{stats:a,isLoading:i}=useUserStats(),[o,c]=reactExports.useState({agency_name_number:(e==null?void 0:e.agency_name_number)||"",agency_address:(e==null?void 0:e.agency_address)||"",agency_postal_town:(e==null?void 0:e.agency_postal_town)||"",agency_province:(e==null?void 0:e.agency_province)||"",agency_email:(e==null?void 0:e.agency_email)||""}),[h,u]=reactExports.useState(!1),[d,_]=reactExports.useState(null);if(!t)return jsxRuntimeExports.jsx("div",{children:"Cargando..."});const b=(g,w)=>{c(R=>({...R,[g]:w})),_(null)},v=async()=>{if(o.agency_email&&!E(o.agency_email)){_({type:"error",text:"El email no es válido"});return}u(!0),_(null);try{const g=await s({agency_name_number:o.agency_name_number||null,agency_address:o.agency_address||null,agency_postal_town:o.agency_postal_town||null,agency_province:o.agency_province||null,agency_email:o.agency_email||null});_(g?{type:"success",text:"Datos de agencia guardados correctamente"}:{type:"error",text:"Error al guardar los datos"})}catch{_({type:"error",text:"Error al guardar los datos"})}finally{u(!1)}},E=g=>/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(g);return jsxRuntimeExports.jsxs("div",{className:"space-y-6",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Información del perfil"}),jsxRuntimeExports.jsxs("div",{className:"bg-gray-50 rounded-lg p-6 space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-4",children:[jsxRuntimeExports.jsx("div",{className:"flex-shrink-0",children:jsxRuntimeExports.jsx("div",{className:"w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center",children:jsxRuntimeExports.jsx("span",{className:"text-2xl font-bold text-white",children:t.full_name.split(" ").map(g=>g[0]).join("").toUpperCase().slice(0,2)})})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h4",{className:"text-xl font-semibold text-gray-900",children:t.full_name}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600",children:t.is_admin?"Administrador":"Usuario"})]})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 gap-4 pt-4 border-t border-gray-200",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-3",children:[jsxRuntimeExports.jsx(Mail,{className:"h-5 w-5 text-gray-400"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500",children:"Email"}),jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-gray-900",children:t.email})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-3",children:[jsxRuntimeExports.jsx(Building,{className:"h-5 w-5 text-gray-400"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500",children:"Plan"}),jsxRuntimeExports.jsxs("p",{className:"text-sm font-medium text-gray-900",children:["Tier ",t.subscription_tier," (",t.max_devices," dispositivos)"]})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-3",children:[jsxRuntimeExports.jsx(Calendar,{className:"h-5 w-5 text-gray-400"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500",children:"Cuenta creada"}),jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-gray-900",children:r!=null&&r.created_at?new Date(r.created_at).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}):"N/A"})]})]})]})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Datos de la Agencia"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Estos datos se utilizarán para autocompletar los formularios de SOP"}),jsxRuntimeExports.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6 space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre y número de agencia"}),jsxRuntimeExports.jsx("input",{type:"text",value:o.agency_name_number,onChange:g=>b("agency_name_number",g.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ej: Agencia Madrid 001"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Dirección (Calle y número)"}),jsxRuntimeExports.jsx("input",{type:"text",value:o.agency_address,onChange:g=>b("agency_address",g.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ej: Calle Principal 123"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CP y Población"}),jsxRuntimeExports.jsx("input",{type:"text",value:o.agency_postal_town,onChange:g=>b("agency_postal_town",g.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ej: 28540 Valdemoro (Madrid)"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Provincia"}),jsxRuntimeExports.jsx("input",{type:"text",value:o.agency_province,onChange:g=>b("agency_province",g.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ej: Madrid"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email de contacto agencia"}),jsxRuntimeExports.jsx("input",{type:"email",value:o.agency_email,onChange:g=>b("agency_email",g.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ej: agencia@ejemplo.com"})]}),d&&jsxRuntimeExports.jsx("div",{className:`rounded-lg p-3 text-sm ${d.type==="success"?"bg-green-50 text-green-800 border border-green-200":"bg-red-50 text-red-800 border border-red-200"}`,children:d.text}),jsxRuntimeExports.jsx("div",{className:"flex justify-end pt-2",children:jsxRuntimeExports.jsx("button",{onClick:v,disabled:h,className:`inline-flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-semibold transition-colors ${h?"bg-gray-200 text-gray-500 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white"}`,children:h?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Loader2,{className:"h-4 w-4 animate-spin"}),"Guardando..."]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Save,{className:"h-4 w-4"}),"Guardar cambios"]})})})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Estadísticas de Uso"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Métricas de uso de la herramienta"}),i?jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center py-8",children:jsxRuntimeExports.jsx(Loader2,{className:"h-8 w-8 animate-spin text-blue-600"})}):jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[jsxRuntimeExports.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 border border-blue-200 rounded-lg p-4",children:[jsxRuntimeExports.jsx("div",{className:"flex items-center justify-between mb-2",children:jsxRuntimeExports.jsx(FileSpreadsheet,{className:"h-8 w-8 text-blue-600"})}),jsxRuntimeExports.jsx("p",{className:"text-2xl font-bold text-blue-900",children:(a==null?void 0:a.total_sop)||0}),jsxRuntimeExports.jsx("p",{className:"text-sm text-blue-700",children:"SOP generados"})]}),jsxRuntimeExports.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-green-100 border border-green-200 rounded-lg p-4",children:[jsxRuntimeExports.jsx("div",{className:"flex items-center justify-between mb-2",children:jsxRuntimeExports.jsx(FileText,{className:"h-8 w-8 text-green-600"})}),jsxRuntimeExports.jsx("p",{className:"text-2xl font-bold text-green-900",children:(a==null?void 0:a.total_minisop)||0}),jsxRuntimeExports.jsx("p",{className:"text-sm text-green-700",children:"Mini-SOP generados"})]}),jsxRuntimeExports.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-purple-100 border border-purple-200 rounded-lg p-4",children:[jsxRuntimeExports.jsx("div",{className:"flex items-center justify-between mb-2",children:jsxRuntimeExports.jsx(Calculator,{className:"h-8 w-8 text-purple-600"})}),jsxRuntimeExports.jsx("p",{className:"text-2xl font-bold text-purple-900",children:(a==null?void 0:a.total_calculations)||0}),jsxRuntimeExports.jsx("p",{className:"text-sm text-purple-700",children:"Cálculos realizados"})]}),jsxRuntimeExports.jsxs("div",{className:"bg-gradient-to-br from-orange-50 to-orange-100 border border-orange-200 rounded-lg p-4",children:[jsxRuntimeExports.jsx("div",{className:"flex items-center justify-between mb-2",children:jsxRuntimeExports.jsx(TrendingUp,{className:"h-8 w-8 text-orange-600"})}),jsxRuntimeExports.jsx("p",{className:"text-2xl font-bold text-orange-900",children:((x=a==null?void 0:a.average_calculations_per_day)==null?void 0:x.toFixed(1))||"0"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-orange-700",children:"Promedio diario"}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-orange-600 mt-1",children:[(a==null?void 0:a.days_active)||0," días activos"]})]})]}),a&&(a.total_sop>0||a.total_calculations>0)&&jsxRuntimeExports.jsxs("div",{className:"mt-4 bg-blue-50 border border-blue-200 rounded-lg p-4",children:[jsxRuntimeExports.jsxs("p",{className:"text-sm text-blue-800",children:[jsxRuntimeExports.jsx("strong",{children:"Primera actividad:"})," ",a.first_activity?new Date(a.first_activity).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}):"Sin actividad registrada"]}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-blue-800 mt-1",children:[jsxRuntimeExports.jsx("strong",{children:"Última actividad:"})," ",a.last_activity?new Date(a.last_activity).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}):"Sin actividad registrada"]})]})]})]})}const pricingPlans=[{id:"plan-1",tier:1,name:"Plan Básico",monthlyPrice:90,annualPrice:990,devices:1,monthlyIfPaidMonthly:90*12,monthsFree:1,pricePerDevicePerYear:990,savingsPerDeviceVsPlan1:0,savingsPercentage:8.3,badge:"Básico"},{id:"plan-2",tier:2,name:"Plan Profesional",monthlyPrice:180,annualPrice:1890,devices:3,monthlyIfPaidMonthly:180*12,monthsFree:1.5,pricePerDevicePerYear:630,savingsPerDeviceVsPlan1:360,savingsPercentage:12.5,badge:"Popular"},{id:"plan-3",tier:3,name:"Plan Empresa",monthlyPrice:270,annualPrice:2700,devices:5,monthlyIfPaidMonthly:270*12,monthsFree:2,pricePerDevicePerYear:540,savingsPerDeviceVsPlan1:450,savingsPercentage:16.7},{id:"plan-4",tier:4,name:"Plan Corporativo",monthlyPrice:315,annualPrice:3150,devices:8,monthlyIfPaidMonthly:315*12,monthsFree:2,pricePerDevicePerYear:393.75,savingsPerDeviceVsPlan1:596.25,savingsPercentage:16.7,isBestValue:!0,badge:"MEJOR VALOR"}],getAnnualSavings=t=>t.monthlyIfPaidMonthly-t.annualPrice;pricingPlans.map(t=>({title:`${t.devices} ${t.devices===1?"dispositivo":"dispositivos"}`,subtitle:`${t.monthsFree} ${t.monthsFree===1?"mes":"meses"} gratis`,price:`€${t.annualPrice.toLocaleString()}/año`,perDevice:`€${Math.round(t.pricePerDevicePerYear)}/dispositivo`,savings:t.savingsPerDeviceVsPlan1>0?`Ahorras €${t.savingsPerDeviceVsPlan1.toFixed(0)} por dispositivo`:null}));const getPlanByTier=t=>pricingPlans.find(r=>r.tier===t);function PricingToggle({isAnnual:t,onToggle:r}){return jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-center gap-4 mb-12",children:[jsxRuntimeExports.jsx("span",{className:`text-lg font-medium transition-colors ${t?"text-gray-500":"text-gray-900"}`,children:"Mensual"}),jsxRuntimeExports.jsx("button",{onClick:()=>r(!t),className:"relative inline-flex h-8 w-16 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",style:{backgroundColor:t?"#16a34a":"#9ca3af"},role:"switch","aria-checked":t,"aria-label":"Cambiar entre pago mensual y anual",children:jsxRuntimeExports.jsx("span",{className:`inline-block h-6 w-6 transform rounded-full bg-white shadow-lg transition-transform ${t?"translate-x-9":"translate-x-1"}`})}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:`text-lg font-medium transition-colors ${t?"text-gray-900":"text-gray-500"}`,children:"Anual"}),t&&jsxRuntimeExports.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-semibold bg-green-100 text-green-800 animate-pulse",children:"Ahorra hasta 16.7%"})]})]})}function PlanCard({plan:t,isAnnual:r,onSelect:e,isLoading:s,viewOnly:a=!1,isCurrentPlan:i=!1}){const[o,c]=reactExports.useState(!1),h=async()=>{if(!a){c(!0);try{await e(t.tier,r?"annual":"monthly")}finally{c(!1)}}},u=r?t.annualPrice:t.monthlyPrice,d=Math.round(r?t.pricePerDevicePerYear:t.monthlyPrice*12/t.devices),_=r?Math.round(t.annualPrice/12):null,b=r?getAnnualSavings(t):null,v=t.isBestValue?"bg-green-600":t.badge==="Popular"?"bg-blue-600":"bg-gray-600",E=t.isBestValue?"bg-green-600 hover:bg-green-700":"bg-gray-900 hover:bg-gray-800";return jsxRuntimeExports.jsxs("div",{className:`relative bg-white rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 flex flex-col ${t.isBestValue?"ring-2 ring-green-600 scale-105":""} ${i?"ring-2 ring-blue-600":""}`,children:[i&&jsxRuntimeExports.jsx("div",{className:"absolute -top-4 left-1/2 transform -translate-x-1/2",children:jsxRuntimeExports.jsx("span",{className:"bg-blue-600 text-white text-xs font-bold px-4 py-1 rounded-full shadow-lg",children:"Tu plan actual"})}),t.badge&&!i&&jsxRuntimeExports.jsx("div",{className:"absolute -top-4 left-1/2 transform -translate-x-1/2",children:jsxRuntimeExports.jsx("span",{className:`${v} text-white text-xs font-bold px-4 py-1 rounded-full shadow-lg`,children:t.badge})}),jsxRuntimeExports.jsxs("div",{className:"p-8 flex-1 flex flex-col",children:[jsxRuntimeExports.jsxs("div",{className:"text-center mb-6",children:[jsxRuntimeExports.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-2",children:t.name}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-center gap-2 text-gray-600",children:[jsxRuntimeExports.jsx(Smartphone,{className:"h-4 w-4"}),jsxRuntimeExports.jsxs("span",{className:"text-sm",children:[t.devices," ",t.devices===1?"dispositivo":"dispositivos"]})]})]}),jsxRuntimeExports.jsxs("div",{className:"text-center mb-6",children:[jsxRuntimeExports.jsxs("div",{className:"mb-2",children:[jsxRuntimeExports.jsxs("span",{className:"text-5xl font-bold text-gray-900",children:["€",u]}),jsxRuntimeExports.jsxs("span",{className:"text-gray-600 text-lg",children:["/",r?"año":"mes"]})]}),r&&_&&jsxRuntimeExports.jsxs("p",{className:"text-sm text-gray-600",children:["Equivale a ",jsxRuntimeExports.jsxs("span",{className:"font-semibold",children:["€",_,"/mes"]})]}),!r&&jsxRuntimeExports.jsxs("p",{className:"text-sm text-gray-500",children:["€",t.monthlyPrice*12,"/año sin descuento"]})]}),r&&t.monthsFree>0&&jsxRuntimeExports.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3 mb-6",children:[jsxRuntimeExports.jsxs("p",{className:"text-green-800 font-semibold text-sm text-center",children:[t.monthsFree," ",t.monthsFree===1?"mes":"meses"," gratis"]}),jsxRuntimeExports.jsxs("p",{className:"text-green-700 text-xs text-center mt-1",children:["Pagas ",12-t.monthsFree,", usas 12"]})]}),r&&b&&b>0&&jsxRuntimeExports.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-6",children:[jsxRuntimeExports.jsxs("p",{className:"text-blue-800 font-semibold text-sm text-center",children:["Ahorras €",b," al año"]}),jsxRuntimeExports.jsx("p",{className:"text-blue-700 text-xs text-center mt-1",children:"vs. pago mensual"})]}),jsxRuntimeExports.jsxs("div",{className:"mb-6",children:[jsxRuntimeExports.jsxs("p",{className:"text-center text-sm text-gray-600",children:[jsxRuntimeExports.jsxs("span",{className:"font-semibold text-gray-900",children:["€",d,"/dispositivo"]}),"/año"]}),t.savingsPerDeviceVsPlan1>0&&jsxRuntimeExports.jsxs("p",{className:"text-center text-xs text-green-600 mt-1",children:["Ahorras €",t.savingsPerDeviceVsPlan1.toFixed(0)," vs. Plan Básico"]})]}),a?jsxRuntimeExports.jsx("div",{className:"w-full bg-gray-100 text-gray-600 font-semibold py-4 px-6 rounded-xl text-center",children:i?"Plan activo":"Contacta comercial para cambiar"}):jsxRuntimeExports.jsx("button",{onClick:h,disabled:o||s,className:`w-full ${E} text-white font-semibold py-4 px-6 rounded-xl transition-all duration-200 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none flex items-center justify-center gap-2`,children:o?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Loader2,{className:"h-5 w-5 animate-spin"}),"Procesando..."]}):`Seleccionar ${t.name}`}),jsxRuntimeExports.jsxs("div",{className:"mt-8 space-y-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-3",children:[jsxRuntimeExports.jsx(Check,{className:"h-5 w-5 text-green-600 flex-shrink-0 mt-0.5"}),jsxRuntimeExports.jsxs("span",{className:"text-sm text-gray-700",children:[t.devices," ",t.devices===1?"dispositivo activo":"dispositivos activos"]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-3",children:[jsxRuntimeExports.jsx(Check,{className:"h-5 w-5 text-green-600 flex-shrink-0 mt-0.5"}),jsxRuntimeExports.jsx("span",{className:"text-sm text-gray-700",children:"Soporte técnico 24/7"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-3",children:[jsxRuntimeExports.jsx(Check,{className:"h-5 w-5 text-green-600 flex-shrink-0 mt-0.5"}),jsxRuntimeExports.jsx("span",{className:"text-sm text-gray-700",children:"Actualizaciones automáticas incluidas"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-3",children:[jsxRuntimeExports.jsx(Check,{className:"h-5 w-5 text-green-600 flex-shrink-0 mt-0.5"}),jsxRuntimeExports.jsx("span",{className:"text-sm text-gray-700",children:"Comparador comercial y generador de tarifas"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-3",children:[jsxRuntimeExports.jsx(Check,{className:"h-5 w-5 text-green-600 flex-shrink-0 mt-0.5"}),jsxRuntimeExports.jsx("span",{className:"text-sm text-gray-700",children:"Exportación a Excel/PDF"})]})]})]})]})}function PlanViewModal({isOpen:t,onClose:r,currentTier:e}){const[s,a]=reactExports.useState(!0);if(!t)return null;const i=()=>{};return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0",children:[jsxRuntimeExports.jsx("div",{className:"fixed inset-0 transition-opacity bg-gray-500 bg-opacity-75",onClick:r}),jsxRuntimeExports.jsx("span",{className:"hidden sm:inline-block sm:align-middle sm:h-screen",children:"​"}),jsxRuntimeExports.jsxs("div",{className:"inline-block w-full max-w-7xl my-8 overflow-hidden text-left align-middle transition-all transform bg-white shadow-xl rounded-2xl",children:[jsxRuntimeExports.jsxs("div",{className:"sticky top-0 z-10 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center w-10 h-10 bg-blue-100 rounded-lg",children:jsxRuntimeExports.jsx(Calculator,{className:"h-6 w-6 text-blue-600"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Planes disponibles"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600",children:"Comparativa de precios y características"})]})]}),jsxRuntimeExports.jsx("button",{onClick:r,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:jsxRuntimeExports.jsx(X,{className:"h-6 w-6"})})]}),jsxRuntimeExports.jsxs("div",{className:"px-6 py-8 max-h-[calc(100vh-12rem)] overflow-y-auto",children:[jsxRuntimeExports.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4 mb-6 flex items-start gap-3",children:[jsxRuntimeExports.jsx(Info,{className:"h-5 w-5 text-blue-600 flex-shrink-0 mt-0.5"}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("p",{className:"text-sm text-blue-900 font-medium",children:"Esta es una vista informativa de los planes disponibles"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-blue-800 mt-1",children:"Para cambiar de plan, actualizar métodos de pago o consultar facturas, por favor contacta con el departamento comercial."})]})]}),jsxRuntimeExports.jsx("div",{className:"mb-6",children:jsxRuntimeExports.jsx(PricingToggle,{isAnnual:s,onToggle:a})}),jsxRuntimeExports.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 mb-8",children:pricingPlans.map(o=>jsxRuntimeExports.jsx(PlanCard,{plan:o,isAnnual:s,onSelect:i,viewOnly:!0,isCurrentPlan:e===o.tier},o.id))}),jsxRuntimeExports.jsxs("div",{className:"bg-gray-50 rounded-xl p-6",children:[jsxRuntimeExports.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[jsxRuntimeExports.jsx(Shield,{className:"h-5 w-5 text-gray-700"}),"Beneficios incluidos en todos los planes"]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[jsxRuntimeExports.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:"Precisión Total"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600",children:"Cálculos exactos incluyendo costes ocultos e incrementos"})]}),jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[jsxRuntimeExports.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:"Ahorro Inmediato"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600",children:"Recupera tu inversión en días con un solo uso diario"})]}),jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[jsxRuntimeExports.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:"Comparativa Competitiva"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600",children:"Genera propuestas profesionales en minutos"})]})]})]}),s&&jsxRuntimeExports.jsx("div",{className:"bg-gradient-to-r from-green-50 to-blue-50 border-2 border-green-200 rounded-xl p-4 mt-6",children:jsxRuntimeExports.jsxs("p",{className:"text-center text-gray-800",children:[jsxRuntimeExports.jsx("span",{className:"font-bold text-green-700",children:"Plan Corporativo:"})," Hasta 58% más barato por dispositivo que planes individuales"]})})]}),jsxRuntimeExports.jsx("div",{className:"sticky bottom-0 bg-gray-50 border-t border-gray-200 px-6 py-4 flex justify-end",children:jsxRuntimeExports.jsx("button",{onClick:r,className:"px-6 py-2.5 bg-gray-900 text-white font-semibold rounded-lg hover:bg-gray-800 transition-colors",children:"Cerrar"})})]})]})})}function SubscriptionTab(){const{userData:t}=useAuth(),[r,e]=reactExports.useState([]),[s,a]=reactExports.useState(!0),[i,o]=reactExports.useState(!1);reactExports.useEffect(()=>{t!=null&&t.id&&c()},[t]);async function c(){try{const w=await fetch("https://eyvhuoldrjfntkffpkfm.supabase.co/functions/v1/get-active-sessions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV5dmh1b2xkcmpmbnRrZmZwa2ZtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg2Mzk3MjgsImV4cCI6MjA3NDIxNTcyOH0.3zYeVfbaU71HNYQK_29Qki1fnQhLGccFtIFDZn_x2Es"},body:JSON.stringify({userId:t.id})}),R=await w.json();if(!w.ok){console.error("Error loading sessions:",R.error);return}e(R.sessions||[])}catch(w){console.error("Error:",w)}finally{a(!1)}}if(!t)return jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center h-64",children:jsxRuntimeExports.jsx(Loader2,{className:"h-8 w-8 animate-spin text-blue-600"})});const h={active:{label:"Activa",color:"text-green-600 bg-green-50 border-green-200",icon:CheckCircle},trial:{label:"Periodo de prueba",color:"text-blue-600 bg-blue-50 border-blue-200",icon:CheckCircle},past_due:{label:"Pago pendiente",color:"text-yellow-600 bg-yellow-50 border-yellow-200",icon:AlertCircle},cancelled:{label:"Cancelada",color:"text-red-600 bg-red-50 border-red-200",icon:AlertCircle}},u={stripe:"Pago con tarjeta",manual:"Transferencia bancaria",promo:"Código promocional",trial:"Periodo de prueba gratuito",admin_grant:"Acceso administrativo"},d=getPlanByTier(t.subscription_tier),_=t.is_admin||t.email==="dcprats@gmail.com",b=h[t.subscription_status]||h.active,v=b.icon,E=t.subscription_end_date?new Date(t.subscription_end_date):null,x=E?Math.ceil((E.getTime()-new Date().getTime())/(1e3*60*60*24)):null,g=t.max_devices>0?r.length/t.max_devices*100:0;return jsxRuntimeExports.jsxs("div",{className:"space-y-6",children:[_&&jsxRuntimeExports.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 rounded-lg p-6 text-white",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-3",children:[jsxRuntimeExports.jsx(Shield,{className:"h-8 w-8"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-xl font-bold",children:"Cuenta Administrador"}),jsxRuntimeExports.jsx("p",{className:"text-blue-100 text-sm",children:"Acceso completo al sistema"})]})]})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Información de suscripción"}),jsxRuntimeExports.jsxs("div",{className:"bg-gray-50 rounded-lg p-6 space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:`flex items-center space-x-2 px-3 py-2 rounded-lg border ${b.color}`,children:[jsxRuntimeExports.jsx(v,{className:"h-5 w-5"}),jsxRuntimeExports.jsx("span",{className:"font-medium",children:b.label})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 pt-4 border-t border-gray-200",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start space-x-3",children:[jsxRuntimeExports.jsx(CreditCard,{className:"h-5 w-5 text-gray-400 mt-1"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500",children:"Plan contratado"}),jsxRuntimeExports.jsx("p",{className:"text-lg font-semibold text-gray-900",children:_?"Plan Administrador":(d==null?void 0:d.name)||`Tier ${t.subscription_tier}`}),d&&!_&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600 mt-1",children:t.subscription_interval==="annual"?`${d.annualPrice}€/año (Plan Anual)`:`${d.monthlyPrice}€/mes (Plan Mensual)`}),t.subscription_interval==="annual"&&jsxRuntimeExports.jsxs("p",{className:"text-xs text-green-600 mt-0.5 font-medium",children:["Ahorro: ",d.monthlyPrice*12-d.annualPrice,"€/año"]})]}),_&&jsxRuntimeExports.jsx("p",{className:"text-sm text-blue-600 mt-1 font-medium",children:"Sin coste · Acceso permanente"})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-start space-x-3",children:[jsxRuntimeExports.jsx(Smartphone,{className:"h-5 w-5 text-gray-400 mt-1"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500",children:"Dispositivos"}),jsxRuntimeExports.jsxs("p",{className:"text-lg font-semibold text-gray-900",children:[t.max_devices," ",t.max_devices===1?"dispositivo":"dispositivos"]}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Tier ",t.subscription_tier]})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-start space-x-3",children:[jsxRuntimeExports.jsx(CreditCard,{className:"h-5 w-5 text-gray-400 mt-1"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500",children:"Método de pago"}),jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-gray-900 mt-1",children:u[t.payment_method]||t.payment_method})]})]}),E&&!_&&jsxRuntimeExports.jsxs("div",{className:"flex items-start space-x-3",children:[jsxRuntimeExports.jsx(Calendar,{className:"h-5 w-5 text-gray-400 mt-1"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500",children:x&&x>0?t.subscription_interval==="annual"?"Renovación anual":"Renovación mensual":"Fecha de expiración"}),jsxRuntimeExports.jsx("p",{className:"text-lg font-semibold text-gray-900",children:E.toLocaleDateString("es-ES",{day:"numeric",month:"long",year:"numeric"})}),x!==null&&x>0&&jsxRuntimeExports.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[x," ",x===1?"día":"días"," restantes"]}),x!==null&&x<=0&&jsxRuntimeExports.jsx("p",{className:"text-sm text-red-600 mt-1 font-medium",children:"Suscripción expirada"}),x!==null&&x>0&&x<=7&&jsxRuntimeExports.jsx("p",{className:"text-sm text-yellow-600 mt-1 font-medium",children:"Renovación próxima"})]})]}),_&&jsxRuntimeExports.jsxs("div",{className:"flex items-start space-x-3",children:[jsxRuntimeExports.jsx(Calendar,{className:"h-5 w-5 text-gray-400 mt-1"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500",children:"Validez"}),jsxRuntimeExports.jsx("p",{className:"text-lg font-semibold text-gray-900",children:"Permanente"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-blue-600 mt-1",children:"Sin fecha de expiración"})]})]})]})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Dispositivos conectados"}),jsxRuntimeExports.jsxs("div",{className:"bg-gray-50 rounded-lg p-6 space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-2",children:[jsxRuntimeExports.jsx(Users,{className:"h-5 w-5 text-gray-600"}),jsxRuntimeExports.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[r.length," de ",t.max_devices," en uso"]})]}),jsxRuntimeExports.jsxs("span",{className:"text-sm text-gray-600",children:[Math.round(g),"% capacidad"]})]}),jsxRuntimeExports.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:jsxRuntimeExports.jsx("div",{className:`h-3 rounded-full transition-all duration-300 ${g>=90?"bg-red-600":g>=70?"bg-yellow-600":"bg-green-600"}`,style:{width:`${Math.min(g,100)}%`}})}),s?jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center py-4",children:jsxRuntimeExports.jsx(Loader2,{className:"h-6 w-6 animate-spin text-blue-600"})}):r.length>0?jsxRuntimeExports.jsxs("div",{className:"space-y-2 pt-2",children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500 uppercase font-medium",children:"Sesiones activas"}),r.map(w=>jsxRuntimeExports.jsx("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border border-gray-200",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-3",children:[jsxRuntimeExports.jsx(Smartphone,{className:"h-4 w-4 text-gray-400"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-gray-900",children:w.device_name||"Dispositivo desconocido"}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-gray-500",children:["Última actividad: ",new Date(w.last_authenticated_at).toLocaleString("es-ES")]})]})]})},w.id))]}):jsxRuntimeExports.jsx("div",{className:"text-center py-4",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600",children:"No hay dispositivos conectados actualmente"})}),g===100&&!_&&jsxRuntimeExports.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 mt-4",children:jsxRuntimeExports.jsxs("p",{className:"text-sm text-red-800",children:[jsxRuntimeExports.jsx("strong",{children:"Capacidad completa:"})," ",t.max_devices===1?"Tu único dispositivo está en uso. Actualiza tu suscripción para permitir más sesiones simultáneas.":`Todos tus ${t.max_devices} dispositivos disponibles están en uso. Actualiza tu suscripción si necesitas más dispositivos simultáneos.`]})}),g>=90&&g<100&&!_&&jsxRuntimeExports.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3 mt-4",children:jsxRuntimeExports.jsxs("p",{className:"text-sm text-yellow-800",children:[jsxRuntimeExports.jsx("strong",{children:"Cerca del límite:"})," Estás usando casi todos tus dispositivos disponibles. Considera actualizar tu plan si necesitas más dispositivos simultáneos."]})}),g>=70&&g<90&&!_&&jsxRuntimeExports.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mt-4",children:jsxRuntimeExports.jsxs("p",{className:"text-sm text-blue-800",children:[jsxRuntimeExports.jsx("strong",{children:"Alto uso:"})," Estás utilizando la mayor parte de tus dispositivos disponibles."]})})]})]}),!_&&jsxRuntimeExports.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:jsxRuntimeExports.jsxs("div",{className:"flex items-start justify-between gap-4",children:[jsxRuntimeExports.jsx("div",{className:"flex-1",children:jsxRuntimeExports.jsxs("p",{className:"text-sm text-blue-800",children:[jsxRuntimeExports.jsx("strong",{children:"Gestión de facturación:"})," Para modificar tu plan, actualizar métodos de pago o consultar facturas, contacta con el departamento comercial."]})}),jsxRuntimeExports.jsxs("button",{onClick:()=>o(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white text-sm font-semibold rounded-lg hover:bg-blue-700 transition-colors whitespace-nowrap",children:[jsxRuntimeExports.jsx(Eye,{className:"h-4 w-4"}),"Ver planes"]})]})}),jsxRuntimeExports.jsx(PlanViewModal,{isOpen:i,onClose:()=>o(!1),currentTier:t==null?void 0:t.subscription_tier}),!_&&d&&jsxRuntimeExports.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[jsxRuntimeExports.jsx("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Detalles del plan"}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-gray-500",children:"Precio mensual"}),jsxRuntimeExports.jsxs("p",{className:"font-semibold text-gray-900",children:[d.monthlyPrice,"€/mes"]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-gray-500",children:"Precio anual"}),jsxRuntimeExports.jsxs("p",{className:"font-semibold text-gray-900",children:[d.annualPrice,"€/año"]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-gray-500",children:"Ahorro anual"}),jsxRuntimeExports.jsxs("p",{className:"font-semibold text-green-600",children:[d.monthlyPrice*12-d.annualPrice,"€"]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-gray-500",children:"Precio por dispositivo"}),jsxRuntimeExports.jsxs("p",{className:"font-semibold text-gray-900",children:[Math.round(d.pricePerDevicePerYear),"€/año"]})]})]})]})]})}function useTariffs(t,r=!1,e=!1,s){const[a,i]=reactExports.useState([]),[o,c]=reactExports.useState(!0),[h,u]=reactExports.useState(null);return reactExports.useEffect(()=>{(async()=>{try{const{data:_,error:b}=await supabase.from("tariffs").select("*");if(b)throw b;let v=(_||[]).map(E=>({...E,weight_from:parseFloat(E.weight_from)||0,weight_to:E.weight_to?parseFloat(E.weight_to):null})).sort((E,x)=>E.service_name!==x.service_name?E.service_name.localeCompare(x.service_name):E.weight_from-x.weight_from);if(e)try{const{data:E}=await supabase.from("custom_tariffs").select("*"),{data:x}=await supabase.from("custom_tariffs_active").select("*").eq("is_active",!0);if(E&&x&&x.length>0){const g=new Set(x.map(w=>w.service_name));v=mergeCustomTariffs(v,E,g)}}catch(E){console.error("Error loading custom tariffs, using standard tariffs:",E)}i(v)}catch(_){u(_ instanceof Error?_.message:"Error fetching tariffs")}finally{c(!1)}})()},[t,r,e,s]),{tariffs:a,loading:o,error:h}}function applyCustomOverrides(t,r){const e=JSON.parse(JSON.stringify(t));for(const s of r){const a=e.filter(i=>{const o=i.service_name===s.service_name,c=i.weight_from>=s.weight_from&&(s.weight_to===null||i.weight_to===null||i.weight_from<=s.weight_to);return o&&c});for(const i of a)s.cost_factor_name in i&&(i[s.cost_factor_name]=s.override_value)}return e}function mergeCustomTariffs(t,r,e){const s=JSON.parse(JSON.stringify(t));for(const a of r){if(!e.has(a.service_name))continue;const i=s.findIndex(o=>o.service_name===a.service_name&&o.weight_from.toString()===a.weight_from&&(o.weight_to===null&&a.weight_to==="999"||o.weight_to!==null&&o.weight_to.toString()===a.weight_to));if(i!==-1){const o=s[i];Object.keys(a).forEach(c=>{if(c!=="id"&&c!=="user_id"&&c!=="service_name"&&c!=="weight_from"&&c!=="weight_to"&&c!=="created_at"&&c!=="updated_at"){const h=a[c];h!=null&&(o[c]=h)}}),s[i]=o}}return s}function useDiscountPlans(){const[t,r]=reactExports.useState([]),[e,s]=reactExports.useState(!0),[a,i]=reactExports.useState(null);return reactExports.useEffect(()=>{(async()=>{try{const{data:c,error:h}=await supabase.from("discount_plans").select("*").eq("is_active",!0).order("plan_name",{ascending:!0});if(h)throw h;r(c||[])}catch(c){i(c instanceof Error?c.message:"Error fetching discount plans")}finally{s(!1)}})()},[]),{discountPlans:t,loading:e,error:a}}function useCustomTariffs(t){const[r,e]=reactExports.useState([]),[s,a]=reactExports.useState(!0),[i,o]=reactExports.useState(null);return reactExports.useEffect(()=>{(async()=>{try{let h=supabase.from("custom_tariffs").select("*");t&&(h=h.eq("user_id",t));const{data:u,error:d}=await h.order("service_name",{ascending:!0}).order("weight_from",{ascending:!0});if(d)throw d;e(u||[])}catch(h){o(h instanceof Error?h.message:"Error fetching custom tariffs")}finally{a(!1)}})()},[t]),{customTariffs:r,loading:s,error:i,refetch:async()=>{a(!0);try{let c=supabase.from("custom_tariffs").select("*");t&&(c=c.eq("user_id",t));const{data:h,error:u}=await c.order("service_name",{ascending:!0}).order("weight_from",{ascending:!0});if(u)throw u;e(h||[]),o(null)}catch(c){o(c instanceof Error?c.message:"Error fetching custom tariffs")}finally{a(!1)}}}}function useCustomTariffsActive(t){const[r,e]=reactExports.useState([]),[s,a]=reactExports.useState(!0),[i,o]=reactExports.useState(null);return reactExports.useEffect(()=>{(async()=>{try{let h=supabase.from("custom_tariffs_active").select("*");t&&(h=h.eq("user_id",t));const{data:u,error:d}=await h.order("service_name",{ascending:!0});if(d)throw d;e(u||[])}catch(h){o(h instanceof Error?h.message:"Error fetching custom tariffs active states")}finally{a(!1)}})()},[t]),{activeStates:r,loading:s,error:i,refetch:async()=>{a(!0);try{let c=supabase.from("custom_tariffs_active").select("*");t&&(c=c.eq("user_id",t));const{data:h,error:u}=await c.order("service_name",{ascending:!0});if(u)throw u;e(h||[]),o(null)}catch(c){o(c instanceof Error?c.message:"Error fetching custom tariffs active states")}finally{a(!1)}}}}const RAW_CUSTOM_PLANS=[{baseId:"custom-plan-integral-2026",planName:"Plan Integral 2026",message:"Válida desde 01/01/26",services:{"Urg8:30H Courier":{upto1:35,upto3:35,upto5:35,upto10:35,upto15:35,additional:15},"Urg10H Courier":{upto1:50,upto3:50,upto5:40,upto10:40,upto15:40,additional:15},"Urg14H Courier":{upto1:50,upto3:50,upto5:40,upto10:35,upto15:35,additional:15},"Urg19H Courier":{upto1:50,upto3:50,upto5:40,upto10:35,upto15:35,additional:15},"Business Parcel":{upto1:60,upto3:60,upto5:50,upto10:50,upto15:50,additional:40},"Economy Parcel":{upto1:40,upto3:40,upto5:40,upto10:40,upto15:40,additional:35}}},{baseId:"custom-plan-integral-2025-plus10",planName:"Plan Integral 2025 +10",message:"Válida sólo hasta 31/12/25",services:{"Urg8:30H Courier":{upto1:45,upto3:45,upto5:45,upto10:45,upto15:45,additional:25},"Urg10H Courier":{upto1:60,upto3:60,upto5:50,upto10:50,upto15:50,additional:25},"Urg14H Courier":{upto1:60,upto3:60,upto5:50,upto10:45,upto15:45,additional:25},"Urg19H Courier":{upto1:60,upto3:60,upto5:50,upto10:45,upto15:45,additional:25},"Business Parcel":{upto1:70,upto3:70,upto5:60,upto10:60,upto15:60,additional:50},"Economy Parcel":{upto1:50,upto3:50,upto5:50,upto10:50,upto15:50,additional:45}}}],toServiceKey=t=>t.toLowerCase().replace(/\s+/g,"-"),CUSTOM_PLAN_ENTRIES=RAW_CUSTOM_PLANS.flatMap(t=>Object.entries(t.services).map(([r,e])=>{const s=`${t.baseId}-${toServiceKey(r)}`,a={id:s,plan_name:t.planName,service_name:r,discount_type:"custom",discount_value:0,min_volume:0,max_volume:void 0,applies_to:"cost",is_active:!0,created_at:"1970-01-01T00:00:00Z"};return{id:s,discountPlan:a,message:t.message,percentages:e}})),CUSTOM_DISCOUNT_PLANS=CUSTOM_PLAN_ENTRIES.map(t=>t.discountPlan),CUSTOM_PLAN_MAP=new Map(CUSTOM_PLAN_ENTRIES.map(t=>[t.id,t]));new Set(CUSTOM_PLAN_ENTRIES.map(t=>t.id));const getCustomPlanDefinition=t=>CUSTOM_PLAN_MAP.get(t),getCustomPlanMessage=t=>{var r;return(r=CUSTOM_PLAN_MAP.get(t))==null?void 0:r.message},getWeightBracket=t=>{const r=Math.ceil(Math.max(0,t));return r<=1?"upto1":r<=3?"upto3":r<=5?"upto5":r<=10?"upto10":r<=15?"upto15":"additional"},getCustomPlanPercentage=(t,r,e)=>{const s=CUSTOM_PLAN_MAP.get(t);if(!s||s.discountPlan.service_name!==r)return 0;const a=getWeightBracket(e);return s.percentages[a]??0},normalizePlanGroupKey=t=>t.trim().toLowerCase(),getPlanGroupKey=t=>normalizePlanGroupKey(t.plan_name),findPlanForServiceGroup=(t,r,e)=>{if(!r)return;const s=normalizePlanGroupKey(r);return t.find(a=>normalizePlanGroupKey(a.plan_name)===s&&a.service_name===e)},__vite_import_meta_env__$2={},SOP_DEBUG_ENABLED$1=typeof import.meta<"u"&&typeof __vite_import_meta_env__$2<"u"&&!1,sopLog$2=(...t)=>{SOP_DEBUG_ENABLED$1&&console.log("[SOP]",...t)},STATIC_SERVICES=["Urg8:30H Courier","Urg10H Courier","Urg14H Courier","Urg19H Courier","Business Parcel","EuroBusiness Parcel","Economy Parcel","Marítimo","Parcel Shop"],DESTINATION_ZONES=["Provincial","Regional","Nacional","Portugal","Madeira Mayores","Madeira Menores","Azores Mayores","Azores Menores","Andorra","Gibraltar","Canarias Mayores","Canarias Menores","Baleares Mayores","Baleares Menores","Ceuta","Melilla"],ZONE_KEY_MAP={Provincial:"provincial",Regional:"regional",Nacional:"nacional",Portugal:"portugal","Madeira Mayores":"madeira_mayores","Madeira Menores":"madeira_menores","Azores Mayores":"azores_mayores","Azores Menores":"azores_menores",Andorra:"andorra",Gibraltar:"gibraltar","Canarias Mayores":"canarias_mayores","Canarias Menores":"canarias_menores","Baleares Mayores":"baleares_mayores","Baleares Menores":"baleares_menores",Ceuta:"ceuta",Melilla:"melilla"},SHIPPING_MODES=["salida","recogida","interciudad"],SHIPPING_MODE_LABELS={salida:"Salida",recogida:"Recogida",interciudad:"Interciudad"},SHIPPING_MODE_SUFFIX={salida:"sal",recogida:"rec",interciudad:"int"},BUSINESS_ISLAND_ZONES=new Set(["Canarias Mayores","Canarias Menores","Baleares Mayores","Baleares Menores"]),MARITIME_SPECIAL_ZONES=new Set(["Azores Mayores","Azores Menores","Madeira Mayores","Madeira Menores"]),OPEN_RANGE_THRESHOLD=999,EPSILON=1e-9,CENT_FACTOR=100,roundUp$1=t=>!Number.isFinite(t)||t<=0?0:Math.ceil(t*CENT_FACTOR-EPSILON)/CENT_FACTOR,getEnergyRateForService=t=>t==="Economy Parcel"||t==="Marítimo"?0:.0705,normalizeServiceName=t=>t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim().toLowerCase(),isMaritimeService=t=>normalizeServiceName(t)==="maritimo",isBusinessParcelService=t=>normalizeServiceName(t)==="business parcel",isParcelShopService=t=>normalizeServiceName(t)==="parcel shop",COST_FIELD_MAP={Provincial:{salida:"provincial_sal",recogida:"provincial_rec",interciudad:"provincial_int"},Regional:{salida:"regional_sal",recogida:"regional_rec",interciudad:"regional_int"},Nacional:{salida:"nacional_sal",recogida:"nacional_rec",interciudad:"nacional_int"},Portugal:{salida:"portugal_sal",recogida:"portugal_rec",interciudad:"portugal_int"},"Madeira Mayores":{salida:"madeira_mayores_sal",recogida:"madeira_mayores_rec",interciudad:"madeira_mayores_int"},"Madeira Menores":{salida:"madeira_menores_sal",recogida:"madeira_menores_rec",interciudad:"madeira_menores_int"},"Azores Mayores":{salida:"azores_mayores_sal",recogida:"azores_mayores_rec",interciudad:"azores_mayores_int"},"Azores Menores":{salida:"azores_menores_sal",recogida:"azores_menores_rec",interciudad:"azores_menores_int"},Andorra:{salida:"andorra_sal",recogida:"andorra_rec",interciudad:"andorra_int"},Gibraltar:{salida:"gibraltar_sal",recogida:"gibraltar_rec",interciudad:"gibraltar_int"},"Canarias Mayores":{salida:"canarias_mayores_sal",recogida:"canarias_mayores_rec",interciudad:"canarias_mayores_int"},"Canarias Menores":{salida:"canarias_menores_sal",recogida:"canarias_menores_rec",interciudad:"canarias_menores_int"},"Baleares Mayores":{salida:"baleares_mayores_sal",recogida:"baleares_mayores_rec",interciudad:"baleares_mayores_int"},"Baleares Menores":{salida:"baleares_menores_sal",recogida:"baleares_menores_rec",interciudad:"baleares_menores_int"},Ceuta:{salida:"ceuta_sal",recogida:"ceuta_rec",interciudad:"ceuta_int"},Melilla:{salida:"melilla_sal",recogida:"melilla_rec",interciudad:"melilla_int"}},ARR_FIELD_MAP$1={Provincial:"provincial_arr",Regional:"regional_arr",Nacional:"nacional_arr",Portugal:"portugal_arr","Madeira Mayores":"madeira_mayores_arr","Madeira Menores":"madeira_menores_arr","Azores Mayores":"azores_mayores_arr","Azores Menores":"azores_menores_arr",Andorra:"andorra_arr",Gibraltar:"gibraltar_arr","Canarias Mayores":"canarias_mayores_arr","Canarias Menores":"canarias_menores_arr","Baleares Mayores":"baleares_mayores_arr","Baleares Menores":"baleares_menores_arr",Ceuta:"ceuta_arr",Melilla:"melilla_arr"},SERVICE_INCREMENT_RULES$1={"Urg8:30H Courier":{base:9,overrides:{"Canarias Mayores":10,"Canarias Menores":10}},"Urg10H Courier":{base:9,overrides:{"Canarias Mayores":10,"Canarias Menores":10,"Baleares Mayores":10,"Baleares Menores":10}},"Urg14H Courier":{base:9,overrides:{"Canarias Mayores":10,"Canarias Menores":10,"Baleares Mayores":10,"Baleares Menores":10}},"Urg19H Courier":{base:6,overrides:{"Canarias Mayores":10,"Canarias Menores":10,"Baleares Mayores":10,"Baleares Menores":10}},"Economy Parcel":{base:2,overrides:{"Canarias Mayores":4,"Canarias Menores":4,"Baleares Mayores":4,"Baleares Menores":4}},Marítimo:{base:4,overrides:{}},"Business Parcel":{base:0,overrides:{"Canarias Mayores":4,"Canarias Menores":4}},"EuroBusiness Parcel":{base:0,overrides:{}},"Parcel Shop":{base:0,overrides:{}}},SERVICE_INCREMENT_2025_RULES$1={"Urg8:30H Courier":{Provincial:5,Regional:5,Nacional:5,Portugal:5,"Baleares Mayores":5,"Baleares Menores":5},"Urg10H Courier":{Provincial:5,Regional:5,Nacional:5,Portugal:5,"Baleares Mayores":5,"Baleares Menores":5},"Urg14H Courier":{Provincial:5,Regional:5,Nacional:5,Portugal:5,"Baleares Mayores":5,"Baleares Menores":5},"Urg19H Courier":{Provincial:3,Regional:3,Nacional:3,Portugal:3,Andorra:3,Gibraltar:3}},UNIVERSAL_INCREMENT_2025_OVERRIDES={"Canarias Mayores":3,"Canarias Menores":3,"Baleares Mayores":3,"Baleares Menores":3},getServiceIncrementConfig$1=t=>{const r=SERVICE_INCREMENT_RULES$1[t];return r?{base:r.base,overrides:r.overrides??{}}:{base:0,overrides:{}}},getZoneIncrement2024=(t,r)=>{const e=getServiceIncrementConfig$1(t);return e.overrides[r]??e.base},getZoneIncrement2025$1=(t,r)=>{const e=SERVICE_INCREMENT_2025_RULES$1[t],s=(e==null?void 0:e[r])??0;if(t==="EuroBusiness Parcel")return s;const a=UNIVERSAL_INCREMENT_2025_OVERRIDES[r]??0;return Math.max(s,a)},BASE_COST_BREAKDOWN={initialCost:0,linearDiscount:0,climateProtect:0,canonRed:0,canonDigital:0,noVol:0,amplCobertura:0,energia:0,suplementos:0,irregular:0,mileageCost:0,saturdayCost:0,subtotal:0,incr2024:0,incr2025:0,incr2026:0,incr2024Percent:0,incr2025Percent:0,incr2026Percent:0,spc:0,totalCost:0};function createEmptyCostBreakdown(t="idle"){return{...BASE_COST_BREAKDOWN,status:t}}function calculateVolumetricWeight(t,r,e,s){return t*r*e/1e6*s}function getFinalWeight(t,r){const e=r!==void 0?Math.max(t,r):t;return e<=0?0:Math.ceil(e)}function getConversionFactorForService(t,r){return isMaritimeService(t)||isBusinessParcelService(t)&&r&&BUSINESS_ISLAND_ZONES.has(r)?333:167}function calculateCostBreakdown(t,r=0,e=0,s=0,a=0,i=0,o=0,c=0,h=0,u=0,d={}){const{planDiscountAmount:_=0,energyRate:b=.0705,baseOverride:v=null,serviceName:E}=d,x=E?isParcelShopService(E):!1,g=roundUp$1(t);let R=(x?0:c)>0?roundUp$1(g*(c/100)):0,N=_>0?roundUp$1(_):0;v!==null&&Number.isFinite(v)&&(R=0,N=0);const M=Math.min(g,R+N),A=x?0:roundUp$1(g*.015),I=x?0:roundUp$1(.27),y=x?0:roundUp$1(.06),j=x?0:roundUp$1(.04),T=x?0:roundUp$1(g*.0195),U=x?0:b>0?roundUp$1(g*b):0,F=i>0?roundUp$1(i):0,H=o>0?roundUp$1(o):0,z=u>0?roundUp$1(u):0,de=h>0?roundUp$1(h):0,se=a>0?roundUp$1(a):0;let ue=g;M>0&&(ue=roundUp$1(Math.max(0,g-M))),v!==null&&Number.isFinite(v)&&(ue=roundUp$1(Math.max(0,v)));const Z=roundUp$1(ue+A+I+y+j+T+U+F+H+z+de),ge=r>0?roundUp$1(g*(r/100)):0,re=e>0?roundUp$1(g*(e/100)):0,oe=s>0?roundUp$1(g*(s/100)):0,be=roundUp$1(Z+ge+re+oe+se);return{initialCost:g,linearDiscount:M,climateProtect:A,canonRed:I,canonDigital:y,noVol:j,amplCobertura:T,energia:U,suplementos:F,irregular:H,mileageCost:z,saturdayCost:de,subtotal:Z,incr2024:ge,incr2025:re,incr2026:oe,incr2024Percent:r,incr2025Percent:e,incr2026Percent:s,spc:se,totalCost:be,status:"calculated"}}const buildFieldCandidates=t=>{const r=new Set([t]);return t.includes("national")&&r.add(t.replace("national","nacional")),t.includes("nacional")&&r.add(t.replace("nacional","national")),t.includes("price")&&r.add(t.replace("price","precio")),t.endsWith("_sal")&&r.add(t.replace("_sal","_salida")),t.endsWith("_rec")&&r.add(t.replace("_rec","_recogida")),t.endsWith("_int")&&r.add(t.replace("_int","_interciudad")),Array.from(r)},getTariffNumericValue$1=(t,r)=>{const e=Array.isArray(r)?r.flatMap(buildFieldCandidates):buildFieldCandidates(r),s=Array.from(new Set(e)),a=t;for(const i of s){const o=a[i];if(o==null)continue;if(typeof o=="number"){if(Number.isFinite(o))return o;continue}const c=Number(o);if(Number.isFinite(c))return c}return null},isPlusOneRange=t=>t.weight_to===null||t.weight_to===void 0||t.weight_to<=t.weight_from||t.weight_from>=15&&t.weight_to>=OPEN_RANGE_THRESHOLD,getAdditionalStep=(t,r)=>isMaritimeService(t)&&MARITIME_SPECIAL_ZONES.has(r)?10:1,resolveTariffCost=(t,r,e,s,a)=>{if(!t.length)return null;const i=Math.max(e,0),o=Math.ceil(i);if(o<=0)return 0;const c=[...t].sort((A,I)=>A.weight_from-I.weight_from),u=c.filter(A=>!isPlusOneRange(A)).map(A=>({from:A.weight_from,to:A.weight_to??null,cost:getTariffNumericValue$1(A,r)})).filter(A=>A.cost!==null);if(!u.length)return null;const d=[...c].reverse().find(isPlusOneRange)??null,_=d?getTariffNumericValue$1(d,r):null,b=getAdditionalStep(s,a),v=u[0];let x=u.find(A=>{const I=A.to??A.from;return A.from===0?o>=A.from&&o<=I:o>A.from&&o<=I});x||(o<v.from?x=v:x=[...u].reverse().find(A=>{const I=A.to??A.from;return A.from===0?o>=A.from&&o<=I:o>A.from&&o<=I})??v);const g=x??v,w=g.cost??0,R=g.to??g.from;if(o<=R)return w;if(_===null)return null;const N=Math.max(0,o-R);if(N<=0)return w;const M=Math.ceil(N/b);return w+M*_};function computeZoneCostForPackage(t,r,e,s,a){var d;if(isParcelShopService(r)){const _=t.weight>30,b=t.dimensions?t.dimensions.height+t.dimensions.width+t.dimensions.length>150:!1;if(_||b)return{available:!1,cost:0,reason:"restriction"}}const i=(d=COST_FIELD_MAP[e])==null?void 0:d[s];if(!i)return{available:!1,cost:0,reason:"missing_tariff"};const o=getConversionFactorForService(r,e),c=t.dimensions?calculateVolumetricWeight(t.dimensions.height,t.dimensions.width,t.dimensions.length,o):void 0,h=getFinalWeight(t.weight,c),u=resolveTariffCost(a,i,h,r,e);return u===null?{available:!1,cost:0,reason:"missing_tariff",finalWeight:h}:{available:!0,cost:u,finalWeight:h}}function formatCurrency(t){return new Intl.NumberFormat("es-ES",{style:"currency",currency:"EUR",minimumFractionDigits:2,maximumFractionDigits:2}).format(t)}function formatPercentage(t){return`${t.toFixed(2)}%`}function formatWeight(t){return`${t.toFixed(2)} kg`}function formatDimensions(t,r,e){return`${t} × ${r} × ${e} cm`}function formatVolume(t,r,e){return`${(t*r*e/1e6).toFixed(4)} m³`}const getZoneKey=t=>ZONE_KEY_MAP[t],getZoneCostFromTariff=(t,r,e="salida")=>{var a;const s=(a=COST_FIELD_MAP[r])==null?void 0:a[e];return s?getTariffNumericValue$1(t,s):null},getZoneArrFromTariff=(t,r)=>{const e=ARR_FIELD_MAP$1[r];return e?getTariffNumericValue$1(t,e):null},resolvePlanWeightForTariffRow=(t,r,e)=>{const s=getLastFiniteTariff(t);if(r.weight_to!==null&&r.weight_to!==void 0)return r.weight_to;const a=s?s.weight_to??s.weight_from:r.weight_from,i=getAdditionalStep(r.service_name,e);return a+i},getPlanPercentageForWeight=(t,r,e)=>{if(t.discount_type==="custom"){const s=getCustomPlanDefinition(t.id);return!s||s.discountPlan.service_name!==r?0:getCustomPlanPercentage(t.id,r,e)}return t.discount_type==="percentage"?t.discount_value??0:0},getLastFiniteTariff=t=>{const r=t.filter(e=>e.weight_to!==null&&e.weight_to!==void 0).sort((e,s)=>(e.weight_to??0)-(s.weight_to??0));return r.length?r[r.length-1]:null},resolvePlanCostDetails=(t,r,e,s)=>{if(!t.length)return null;const a=[...t].sort((b,v)=>b.weight_from-v.weight_from),i=a.filter(b=>!isPlusOneRange(b));if(!i.length)return null;const o=Math.ceil(Math.max(s,0)),c=[...a].reverse().find(isPlusOneRange)??null,h=getAdditionalStep(r,e);let u=i.find(b=>{const v=b.weight_to??b.weight_from;return b.weight_from===0?o>=b.weight_from&&o<=v:o>b.weight_from&&o<=v});if(u||(o<i[0].weight_from?u=i[0]:u=[...i].reverse().find(b=>b.weight_from<=o)??i[i.length-1]),!u)return null;const d=u.weight_to??u.weight_from,_=o>d&&c?Math.ceil(Math.max(0,o-d)/Math.max(1,h)):0;return{baseTariff:u,baseThreshold:d,additionalTariff:c,additionalUnits:_,step:Math.max(1,h)}},ALLOWED_ZONES_FOR_PLAN_DISCOUNT=new Set(["Provincial","Regional","Nacional"]),calculatePlanDiscountForWeight=(t,r,e,s,a,i)=>{if(!s)return 0;if(s.discount_type==="fixed")return s.discount_value>0?roundUp$1(s.discount_value):0;if(i==="interciudad")return 0;const o=r==="EuroBusiness Parcel",c=e==="Portugal";if(c&&!o||!c&&!ALLOWED_ZONES_FOR_PLAN_DISCOUNT.has(e))return 0;const h=ARR_FIELD_MAP$1[e];if(!h)return 0;const u=resolvePlanCostDetails(t,r,e,a);if(!u)return 0;const d=(E,x,g=1)=>!E||x<=0||g<=0?0:roundUp$1(E*(x/100)*g),_=E=>getPlanPercentageForWeight(s,r,E);let b=0;const v=getTariffNumericValue$1(u.baseTariff,h);if(Number.isFinite(v)){const E=_(u.baseThreshold);b+=d(v,E)}if(u.additionalUnits>0&&u.additionalTariff){const E=getTariffNumericValue$1(u.additionalTariff,h);if(Number.isFinite(E)){const x=_(u.baseThreshold+u.step);b+=d(E,x,u.additionalUnits)}}return b};function buildVirtualTariffTable(t,r){const e=[];if(!Array.isArray(t)||t.length===0)return e;const{marginPercentage:s,planGroup:a="",discountPlans:i=[],linearDiscount:o=0,spc:c=0,variableSurcharge:h=0,irregularSurcharge:u=0,increment2026:d=0,selectedService:_="",provincialCostOverride:b=null}=r,v=a?normalizePlanGroupKey(a):"",E=Number.isFinite(s)?s:0,x=E<100?1-E/100:0,g=new Map;t.forEach(w=>{const R=g.get(w.service_name);R?R.push(w):g.set(w.service_name,[w])});for(const w of t)for(const R of DESTINATION_ZONES)for(const N of SHIPPING_MODES){const A=getZoneCostFromTariff(w,R,N);if(A===null)continue;const I=v?findPlanForServiceGroup(i,v,w.service_name):void 0,y=!!I,j=_===w.service_name,T=!y&&j&&b!==null,U=y||T?0:o;let F=0,H=null;if(I){const oe=g.get(w.service_name)??[w],be=resolvePlanWeightForTariffRow(oe,w,R);F=calculatePlanDiscountForWeight(oe,w.service_name,R,I,be),H=be}const z=T&&R==="Provincial"?b:null,de=calculateCostBreakdown(A,getZoneIncrement2024(w.service_name,R),getZoneIncrement2025$1(w.service_name,R),d,c,h,u,U,0,0,{planDiscountAmount:F,energyRate:getEnergyRateForService(w.service_name),baseOverride:z}),se=de.totalCost,ue=x>0?se/x:se,Z=roundUp$1(ue),ge=`${getZoneKey(R)}_${SHIPPING_MODE_SUFFIX[N]}`,re=getZoneArrFromTariff(w,R);sopLog$2("virtual-row",{service:w.service_name,zone:R,mode:N,weight_from:w.weight_from,weight_to:w.weight_to,baseCost:A,arrValue:re,planWeight:H,planApplied:(I==null?void 0:I.plan_name)??null,planDiscountAmount:F,linearDiscountApplied:U,baseOverride:z,supplements:{climateProtect:de.climateProtect,canonRed:de.canonRed,canonDigital:de.canonDigital,noVol:de.noVol,amplCobertura:de.amplCobertura,energia:de.energia,suplementos:de.suplementos,irregular:de.irregular,spc:c,incr2024:de.incr2024,incr2025:de.incr2025,incr2026:de.incr2026},totalCost:de.totalCost,marginPercentage:E,pvp:Z}),e.push({service_name:w.service_name,zone:ge,weight_from:w.weight_from,weight_to:w.weight_to,pvp:Z})}return e}function TariffPdfPreview({parsedData:t,onConfirm:r,onCancel:e,onDataImported:s}){const{userData:a}=useAuth(),[i,o]=reactExports.useState(!t),[c,h]=reactExports.useState(t||[]),[u,d]=reactExports.useState(new Set),[_,b]=reactExports.useState(!1),[v,E]=reactExports.useState(null);reactExports.useEffect(()=>{t?(h(t),d(new Set(t.map((y,j)=>`temp-${j}`))),o(!1)):x()},[t]);const x=async(y=0)=>{const T=await g();if(T===0&&y<5){const U=Math.min(1e3*Math.pow(1.5,y),5e3);return console.log(`[TariffPdfPreview] Reintenando carga (${y+1}/5) en ${U}ms...`),await new Promise(F=>setTimeout(F,U)),x(y+1)}return T},g=async()=>{try{o(!0);const{data:y,error:j,count:T}=await supabase.from("tariffspdf").select("*",{count:"exact"}).order("service_name",{ascending:!0}).order("weight_from",{ascending:!0});if(j)throw j;return console.log(`[TariffPdfPreview] Datos cargados: ${(y==null?void 0:y.length)||0} registros (count: ${T})`),h(y||[]),d(new Set((y==null?void 0:y.map(U=>U.id))||[])),(y==null?void 0:y.length)||0}catch(y){return console.error("[TariffPdfPreview] Error cargando tariffspdf:",y),E(y.message||"Error al cargar datos temporales"),0}finally{o(!1)}},w=y=>{const j=new Set(u);j.has(y)?j.delete(y):j.add(y),d(j)},R=()=>{u.size===c.length?d(new Set):d(new Set(c.map((y,j)=>y.id||`temp-${j}`)))},N=async()=>{if(!a){E("Usuario no autenticado");return}if(u.size===0){E("Selecciona al menos una tarifa para importar");return}b(!0),E(null);try{const y=c.filter((F,H)=>u.has(F.id||`temp-${H}`));let j=0,T=0;for(const F of y)try{const{id:H,created_at:z,updated_at:de,...se}=F,{data:ue,error:Z}=await supabase.from("custom_tariffs").select("id").eq("user_id",a.id).eq("service_name",F.service_name).eq("weight_from",F.weight_from).eq("weight_to",F.weight_to).maybeSingle();if(Z){console.error("Error buscando tarifa existente:",Z),T++;continue}if(ue){const{error:ge}=await supabase.from("custom_tariffs").update(se).eq("id",ue.id);ge?(console.error("Error actualizando tarifa:",ge),T++):j++}else{const{error:ge}=await supabase.from("custom_tariffs").insert([{...se,user_id:a.id}]);ge?(console.error("Error insertando tarifa:",ge),T++):j++}}catch(H){console.error("Error procesando tarifa individual:",H),T++}if(console.log(`[TariffPdfPreview] Transferéncia completada: ${j} exitosas, ${T} errores`),T>0&&j===0){E("No se pudo importar ninguna tarifa. Verifica los permisos e inténtalo de nuevo.");return}const{error:U}=await supabase.from("tariffspdf").delete().neq("id","00000000-0000-0000-0000-000000000000");U&&console.warn("[TariffPdfPreview] Advertencia al limpiar tabla temporal:",U),s&&s(),T>0&&console.warn(`[TariffPdfPreview] Importación parcial: ${j} exitosas, ${T} errores`),r()}catch(y){console.error("Error transfiriendo tarifas:",y),E(y.message||"Error al transferir tarifas")}finally{b(!1)}},M=c.reduce((y,j)=>(y[j.service_name]||(y[j.service_name]=[]),y[j.service_name].push(j),y),{}),A=y=>{const j=[];return(y.provincial_sal!==null||y.provincial_rec!==null||y.provincial_int!==null||y.provincial_arr!==null)&&j.push("provincial"),(y.regional_sal!==null||y.regional_rec!==null||y.regional_int!==null||y.regional_arr!==null)&&j.push("regional"),(y.nacional_sal!==null||y.nacional_rec!==null||y.nacional_int!==null||y.nacional_arr!==null)&&j.push("nacional"),(y.portugal_sal!==null||y.portugal_rec!==null||y.portugal_int!==null||y.portugal_arr!==null)&&j.push("portugal"),(y.ceuta_sal!==null||y.ceuta_rec!==null||y.ceuta_int!==null||y.ceuta_arr!==null)&&j.push("ceuta"),(y.melilla_sal!==null||y.melilla_rec!==null||y.melilla_int!==null||y.melilla_arr!==null)&&j.push("melilla"),(y.gibraltar_sal!==null||y.gibraltar_rec!==null||y.gibraltar_int!==null||y.gibraltar_arr!==null)&&j.push("gibraltar"),(y.andorra_sal!==null||y.andorra_rec!==null||y.andorra_int!==null||y.andorra_arr!==null)&&j.push("andorra"),(y.baleares_mayores_sal!==null||y.baleares_mayores_rec!==null||y.baleares_mayores_int!==null||y.baleares_mayores_arr!==null)&&j.push("baleares_mayores"),(y.baleares_menores_sal!==null||y.baleares_menores_rec!==null||y.baleares_menores_int!==null||y.baleares_menores_arr!==null)&&j.push("baleares_menores"),(y.canarias_mayores_sal!==null||y.canarias_mayores_rec!==null||y.canarias_mayores_int!==null||y.canarias_mayores_arr!==null)&&j.push("canarias_mayores"),(y.canarias_menores_sal!==null||y.canarias_menores_rec!==null||y.canarias_menores_int!==null||y.canarias_menores_arr!==null)&&j.push("canarias_menores"),(y.azores_mayores_sal!==null||y.azores_mayores_rec!==null||y.azores_mayores_int!==null||y.azores_mayores_arr!==null)&&j.push("azores_mayores"),(y.azores_menores_sal!==null||y.azores_menores_rec!==null||y.azores_menores_int!==null||y.azores_menores_arr!==null)&&j.push("azores_menores"),(y.madeira_mayores_sal!==null||y.madeira_mayores_rec!==null||y.madeira_mayores_int!==null||y.madeira_mayores_arr!==null)&&j.push("madeira_mayores"),(y.madeira_menores_sal!==null||y.madeira_menores_rec!==null||y.madeira_menores_int!==null||y.madeira_menores_arr!==null)&&j.push("madeira_menores"),j},I=(y,j)=>{const T={provincial:"Provincial",regional:"Regional",nacional:"Nacional",portugal:"Portugal",ceuta:"Ceuta",melilla:"Melilla",gibraltar:"Gibraltar",andorra:"Andorra",baleares_mayores:"Baleares Mayores",baleares_menores:"Baleares Menores",canarias_mayores:"Canarias Mayores",canarias_menores:"Canarias Menores",azores_mayores:"Azores Mayores",azores_menores:"Azores Menores",madeira_mayores:"Madeira Mayores",madeira_menores:"Madeira Menores"},U=y[`${j}_sal`],F=y[`${j}_rec`],H=y[`${j}_int`],z=y[`${j}_arr`];return jsxRuntimeExports.jsxs("div",{className:"space-y-1",children:[jsxRuntimeExports.jsx("div",{className:"font-semibold text-gray-600",children:T[j]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-1",children:[jsxRuntimeExports.jsxs("span",{className:`px-1.5 py-0.5 rounded ${U!=null?"bg-green-100 text-green-800":"bg-gray-100 text-gray-400"}`,children:["Sal: ",U!=null?U.toFixed(2):"-"]}),jsxRuntimeExports.jsxs("span",{className:`px-1.5 py-0.5 rounded ${F!=null?"bg-green-100 text-green-800":"bg-gray-100 text-gray-400"}`,children:["Rec: ",F!=null?F.toFixed(2):"-"]})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-1",children:[jsxRuntimeExports.jsxs("span",{className:`px-1.5 py-0.5 rounded ${H!=null?"bg-green-100 text-green-800":"bg-gray-100 text-gray-400"}`,children:["Int: ",H!=null?H.toFixed(2):"-"]}),jsxRuntimeExports.jsxs("span",{className:`px-1.5 py-0.5 rounded ${z!=null?"bg-green-100 text-green-800":"bg-gray-100 text-gray-400"}`,children:["Arr: ",z!=null?z.toFixed(2):"-"]})]})]},j)};return i?jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-center p-8",children:[jsxRuntimeExports.jsx(Loader2,{className:"w-8 h-8 animate-spin text-blue-600"}),jsxRuntimeExports.jsx("span",{className:"ml-3 text-gray-600",children:"Cargando vista previa..."})]}):c.length===0?jsxRuntimeExports.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-6 text-center",children:[jsxRuntimeExports.jsx(AlertTriangle,{className:"w-12 h-12 text-yellow-600 mx-auto mb-3"}),jsxRuntimeExports.jsx("p",{className:"text-yellow-900 font-medium",children:"No se encontraron tarifas en la tabla temporal"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-yellow-700 mt-2",children:"La importación reportó éxito pero no hay datos en la vista previa."}),jsxRuntimeExports.jsx("p",{className:"text-xs text-yellow-600 mt-1",children:"Esto puede deberse a un problema de sincronización. Intenta de nuevo."}),jsxRuntimeExports.jsx("button",{onClick:e,className:"mt-4 px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors",children:"Volver a Intentar"})]}):jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"Vista Previa de Importación"}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-blue-800",children:["Se extrajeron ",jsxRuntimeExports.jsx("strong",{children:c.length})," tarifas del PDF. Selecciona las que deseas importar a tu tabla personalizada."]}),jsxRuntimeExports.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[jsxRuntimeExports.jsxs("label",{className:"flex items-center gap-2 text-sm text-blue-900 cursor-pointer",children:[jsxRuntimeExports.jsx("input",{type:"checkbox",checked:u.size===c.length,onChange:R,className:"w-4 h-4 rounded border-blue-300"}),jsxRuntimeExports.jsxs("span",{children:["Seleccionar todas (",c.length,")"]})]}),jsxRuntimeExports.jsxs("span",{className:"text-blue-700",children:["| ",u.size," seleccionadas"]})]})]}),v&&jsxRuntimeExports.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 flex items-start gap-3",children:[jsxRuntimeExports.jsx(XCircle,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("p",{className:"font-medium text-red-900",children:"Error"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-red-700",children:v})]})]}),jsxRuntimeExports.jsx("div",{className:"max-h-[500px] overflow-y-auto border border-gray-200 rounded-lg",children:Object.entries(M).map(([y,j])=>jsxRuntimeExports.jsxs("div",{className:"border-b border-gray-200 last:border-0",children:[jsxRuntimeExports.jsxs("div",{className:"bg-gray-100 px-4 py-2 font-semibold text-gray-900 sticky top-0",children:[y," (",j.length," rangos)"]}),jsxRuntimeExports.jsx("div",{className:"divide-y divide-gray-100",children:j.map((T,U)=>{const F=T.id||`temp-${c.indexOf(T)}`;return jsxRuntimeExports.jsxs("div",{className:`flex items-center gap-3 p-3 hover:bg-gray-50 transition-colors ${u.has(F)?"bg-blue-50":""}`,children:[jsxRuntimeExports.jsx("input",{type:"checkbox",checked:u.has(F),onChange:()=>w(F),className:"w-5 h-5 rounded border-gray-300"}),jsxRuntimeExports.jsxs("div",{className:"flex-1 space-y-1",children:[jsxRuntimeExports.jsxs("div",{className:"font-medium text-gray-900 mb-2",children:["Peso: ",T.weight_from,"-",T.weight_to,"kg"]}),jsxRuntimeExports.jsx("div",{className:"grid grid-cols-2 gap-3 text-xs",children:A(T).map(H=>I(T,H))}),A(T).length===0&&jsxRuntimeExports.jsx("div",{className:"text-sm text-yellow-600 bg-yellow-50 p-2 rounded",children:"⚠️ Sin datos de tarifas para este rango"})]})]},F)})})]},y))}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between gap-4 pt-4 border-t",children:[jsxRuntimeExports.jsx("button",{onClick:e,disabled:_,className:"px-6 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Cancelar"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsxs("span",{className:"text-sm text-gray-600",children:[u.size," tarifa",u.size!==1?"s":""," seleccionada",u.size!==1?"s":""]}),jsxRuntimeExports.jsx("button",{onClick:N,disabled:_||u.size===0,className:"flex items-center gap-2 px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium",children:_?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Loader2,{className:"w-4 h-4 animate-spin"}),jsxRuntimeExports.jsx("span",{children:"Importando..."})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(CheckCircle2,{className:"w-4 h-4"}),jsxRuntimeExports.jsx("span",{children:"Confirmar e Importar"}),jsxRuntimeExports.jsx(ArrowRight,{className:"w-4 h-4"})]})})]})]})]})}function TariffPdfUploader({onDataImported:t}={}){const[r,e]=reactExports.useState(!1),[s,a]=reactExports.useState(!1),[i,o]=reactExports.useState(null),[c,h]=reactExports.useState(null),[u,d]=reactExports.useState("upload"),[_,b]=reactExports.useState(""),[v,E]=reactExports.useState(0),x=reactExports.useCallback(y=>{y.preventDefault(),e(!0)},[]),g=reactExports.useCallback(y=>{y.preventDefault(),e(!1)},[]),w=reactExports.useCallback(y=>{y.preventDefault(),e(!1);const T=Array.from(y.dataTransfer.files).find(U=>U.type==="application/pdf"||U.name.toLowerCase().endsWith(".pdf"));if(T){if(T.size>10*1024*1024){o({success:!1,message:"El archivo es demasiado grande",details:`Tamaño máximo: 10MB. Tu archivo: ${(T.size/1024/1024).toFixed(2)}MB`});return}console.log("[TariffPdfUploader] Archivo arrastrado:",{nombre:T.name,tamaño:T.size,tipo:T.type}),h(T),o(null)}else o({success:!1,message:"Por favor, selecciona un archivo PDF válido"})},[]),R=reactExports.useCallback(y=>{const j=y.target.files;if(j&&j.length>0){const T=j[0];if(T.size>10*1024*1024){o({success:!1,message:"El archivo es demasiado grande",details:`Tamaño máximo: 10MB. Tu archivo: ${(T.size/1024/1024).toFixed(2)}MB`});return}T.type==="application/pdf"||T.name.toLowerCase().endsWith(".pdf")?(console.log("[TariffPdfUploader] Archivo seleccionado:",{nombre:T.name,tamaño:T.size,tipo:T.type}),h(T),o(null)):o({success:!1,message:"Por favor, selecciona un archivo PDF válido",details:`Tipo detectado: ${T.type||"desconocido"}`})}},[]),N=async()=>{var T;if(!c)return;a(!0),o(null),b("Preparando archivo..."),E(0);const y=Date.now();let j=null;j=setInterval(()=>{const U=Math.floor((Date.now()-y)/1e3);E(U)},1e3);try{console.log("[TariffPdfUploader] Iniciando subida de archivo:",{nombre:c.name,tamaño:c.size,tipo:c.type});const U=new FormData;U.append("pdf",c,c.name),console.log("[TariffPdfUploader] FormData creado, claves:",Array.from(U.keys()));const F="https://eyvhuoldrjfntkffpkfm.supabase.co",H="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV5dmh1b2xkcmpmbnRrZmZwa2ZtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg2Mzk3MjgsImV4cCI6MjA3NDIxNTcyOH0.3zYeVfbaU71HNYQK_29Qki1fnQhLGccFtIFDZn_x2Es";console.log("[TariffPdfUploader] Enviando petición a:",`${F}/functions/v1/parse-pdf-tariff`),b("Enviando PDF al servidor...");const z=new AbortController,de=setTimeout(()=>{console.warn("[TariffPdfUploader] Timeout alcanzado después de 5 minutos"),z.abort()},3e5);try{b("Procesando PDF (esto puede tardar varios minutos)...");const se=await fetch(`${F}/functions/v1/parse-pdf-tariff`,{method:"POST",headers:{Authorization:`Bearer ${H}`},body:U,signal:z.signal});clearTimeout(de),j&&clearInterval(j),b("Procesando respuesta..."),console.log("[TariffPdfUploader] Respuesta recibida:",{status:se.status,statusText:se.statusText,contentType:se.headers.get("content-type")});const ue=await se.text();console.log("[TariffPdfUploader] Respuesta raw:",ue.substring(0,200));let Z;try{Z=JSON.parse(ue)}catch(ge){throw console.error("[TariffPdfUploader] Error al parsear JSON:",ge),new Error(`Respuesta inválida del servidor: ${ue.substring(0,100)}`)}if(se.ok&&Z.success)if(console.log("[TariffPdfUploader] Extracción exitosa:",Z),Z.preview)console.log("[TariffPdfUploader] Mostrando vista previa de datos extraídos"),o({success:!0,message:Z.message,imported:((T=Z.data)==null?void 0:T.length)||0,preview:Z.data,uniqueServices:new Set(Z.servicesDetected||[]).size}),d("preview");else{if(Z.verified===0||Z.imported===0){console.error("[TariffPdfUploader] Advertencia: No hay datos verificados en DB"),o({success:!1,message:"Error de sincronización con base de datos",details:`Se parsearon ${Z.imported||0} tarifas pero no se verificaron en la base de datos. Intenta de nuevo.`});return}Z.verified!==Z.imported&&console.warn(`[TariffPdfUploader] Discrepancia: insertadas=${Z.imported}, verificadas=${Z.verified}`),o({success:!0,message:Z.message,imported:Z.imported,verified:Z.verified,uniqueServices:Z.uniqueServices,preview:Z.preview}),d("preview")}else console.error("[TariffPdfUploader] Error en la importación:",Z),o({success:!1,message:Z.error||"Error al procesar el PDF",details:Z.details||JSON.stringify(Z.debug),errors:Z.errors||Z.suggestions})}catch(se){throw clearTimeout(de),j&&clearInterval(j),se instanceof Error&&se.name==="AbortError"?new Error(`Timeout: El servidor no respondió en 5 minutos. El archivo puede ser demasiado grande o complejo. Tiempo transcurrido: ${Math.floor((Date.now()-y)/1e3)}s`):se}}catch(U){console.error("[TariffPdfUploader] Error capturado:",U),j&&clearInterval(j),o({success:!1,message:"Error al conectar con el servidor",details:U instanceof Error?U.message:"Error desconocido"})}finally{a(!1),b(""),j&&clearInterval(j)}},M=()=>{h(null),o(null),d("upload")},A=()=>{d("success"),o({success:!0,message:"Tarifas importadas correctamente"})},I=()=>{M()};return u==="preview"&&(i!=null&&i.preview)?jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[jsxRuntimeExports.jsx("div",{className:"flex items-center justify-between mb-4",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(FileText,{className:"w-5 h-5 text-blue-600"}),jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Vista Previa de Importación"})]})}),jsxRuntimeExports.jsx(TariffPdfPreview,{parsedData:i.preview,onConfirm:A,onCancel:I,onDataImported:t})]}):u==="success"?jsxRuntimeExports.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:jsxRuntimeExports.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-6 text-center",children:[jsxRuntimeExports.jsx(CheckCircle2,{className:"w-16 h-16 text-green-600 mx-auto mb-4"}),jsxRuntimeExports.jsx("h3",{className:"text-xl font-semibold text-green-900 mb-2",children:"¡Importación Completada!"}),jsxRuntimeExports.jsx("p",{className:"text-green-700 mb-4",children:"Las tarifas se han importado correctamente a tu tabla personalizada."}),jsxRuntimeExports.jsx("button",{onClick:M,className:"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium",children:"Importar Otro PDF"})]})}):jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[jsxRuntimeExports.jsx("div",{className:"flex items-center justify-between mb-4",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(FileText,{className:"w-5 h-5 text-blue-600"}),jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Importar Tarifas desde PDF"})]})}),jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsx("div",{onDragOver:x,onDragLeave:g,onDrop:w,className:`
            border-2 border-dashed rounded-lg p-8 text-center transition-colors
            ${r?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"}
            ${c?"bg-green-50 border-green-500":""}
          `,children:c?jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-center gap-4",children:[jsxRuntimeExports.jsx(FileText,{className:"w-8 h-8 text-green-600"}),jsxRuntimeExports.jsxs("div",{className:"text-left",children:[jsxRuntimeExports.jsx("p",{className:"font-medium text-gray-900",children:c.name}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-gray-500",children:[(c.size/1024).toFixed(0)," KB"]})]}),jsxRuntimeExports.jsx("button",{onClick:M,className:"p-1 hover:bg-gray-200 rounded-full transition-colors",disabled:s,children:jsxRuntimeExports.jsx(X,{className:"w-5 h-5 text-gray-600"})})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Upload,{className:`w-12 h-12 mx-auto mb-4 ${r?"text-blue-600":"text-gray-400"}`}),jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"Arrastra un archivo PDF aquí o haz clic para seleccionar"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500 mb-4",children:"Formato aceptado: PDF de tarifas GLS España 2025"}),jsxRuntimeExports.jsxs("label",{className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 cursor-pointer transition-colors",children:[jsxRuntimeExports.jsx("span",{children:"Seleccionar PDF"}),jsxRuntimeExports.jsx("input",{type:"file",accept:"application/pdf",onChange:R,className:"hidden"})]})]})}),c&&!i&&jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[s&&_&&jsxRuntimeExports.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[jsxRuntimeExports.jsx(Loader2,{className:"w-5 h-5 text-blue-600 animate-spin flex-shrink-0"}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-blue-900",children:_}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-blue-700 mt-1",children:["Tiempo transcurrido: ",Math.floor(v/60),":",(v%60).toString().padStart(2,"0"),v>120&&jsxRuntimeExports.jsx("span",{className:"ml-2 text-yellow-700",children:"(El procesamiento puede tardar hasta 5 minutos)"})]})]})]}),jsxRuntimeExports.jsx("div",{className:"w-full bg-blue-200 rounded-full h-2 overflow-hidden",children:jsxRuntimeExports.jsx("div",{className:"bg-blue-600 h-full rounded-full animate-pulse",style:{width:"100%"}})})]}),jsxRuntimeExports.jsx("div",{className:"flex justify-end",children:jsxRuntimeExports.jsx("button",{onClick:N,disabled:s,className:"flex items-center gap-2 px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors",children:s?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Loader2,{className:"w-4 h-4 animate-spin"}),jsxRuntimeExports.jsx("span",{children:"Procesando..."})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Upload,{className:"w-4 h-4"}),jsxRuntimeExports.jsx("span",{children:"Importar Tarifas"})]})})})]}),i&&jsxRuntimeExports.jsx("div",{className:`rounded-lg p-4 ${i.success?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"}`,children:jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-3",children:[i.success?jsxRuntimeExports.jsx(CheckCircle2,{className:"w-5 h-5 text-green-600 mt-0.5 flex-shrink-0"}):jsxRuntimeExports.jsx(AlertCircle,{className:"w-5 h-5 text-red-600 mt-0.5 flex-shrink-0"}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("p",{className:`font-medium ${i.success?"text-green-900":"text-red-900"}`,children:i.message}),i.imported!==void 0&&jsxRuntimeExports.jsxs("p",{className:"text-sm text-green-700 mt-1",children:["Tarifas importadas: ",i.imported,i.verified!==void 0&&i.verified!==i.imported&&jsxRuntimeExports.jsxs("span",{className:"text-yellow-700",children:[" (verificadas: ",i.verified,")"]})]}),i.uniqueServices!==void 0&&jsxRuntimeExports.jsxs("p",{className:"text-sm text-green-700 mt-1",children:["Servicios detectados: ",i.uniqueServices]}),i.pages!==void 0&&jsxRuntimeExports.jsxs("p",{className:"text-sm text-green-700 mt-1",children:["Páginas procesadas: ",i.pages]}),i.confidence&&jsxRuntimeExports.jsxs("p",{className:"text-sm text-green-700 mt-1",children:["Confianza de extracción: ",i.confidence==="high"?"Alta":i.confidence==="medium"?"Media":"Baja"]}),i.details&&jsxRuntimeExports.jsx("p",{className:"text-sm text-red-700 mt-1",children:i.details}),i.errors&&i.errors.length>0&&jsxRuntimeExports.jsxs("div",{className:"mt-2",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-red-800",children:"Errores encontrados:"}),jsxRuntimeExports.jsx("ul",{className:"list-disc list-inside text-sm text-red-700 mt-1",children:i.errors.map((y,j)=>jsxRuntimeExports.jsx("li",{children:y},j))})]}),i.preview&&i.preview.length>0&&jsxRuntimeExports.jsxs("div",{className:"mt-3",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-green-800 mb-2",children:"Vista previa de datos importados:"}),jsxRuntimeExports.jsx("div",{className:"bg-white rounded border border-green-200 p-3 max-h-64 overflow-auto",children:jsxRuntimeExports.jsxs("table",{className:"w-full text-xs",children:[jsxRuntimeExports.jsx("thead",{children:jsxRuntimeExports.jsxs("tr",{className:"border-b",children:[jsxRuntimeExports.jsx("th",{className:"text-left py-1 px-2",children:"Servicio"}),jsxRuntimeExports.jsx("th",{className:"text-left py-1 px-2",children:"Peso"}),jsxRuntimeExports.jsx("th",{className:"text-left py-1 px-2",children:"Provincial Sal"}),jsxRuntimeExports.jsx("th",{className:"text-left py-1 px-2",children:"Regional Sal"}),jsxRuntimeExports.jsx("th",{className:"text-left py-1 px-2",children:"Nacional Sal"})]})}),jsxRuntimeExports.jsx("tbody",{children:i.preview.map((y,j)=>jsxRuntimeExports.jsxs("tr",{className:"border-b last:border-0",children:[jsxRuntimeExports.jsx("td",{className:"py-1 px-2",children:y.service_name}),jsxRuntimeExports.jsxs("td",{className:"py-1 px-2",children:[y.weight_from,"-",y.weight_to,"kg"]}),jsxRuntimeExports.jsx("td",{className:"py-1 px-2",children:y.provincial_sal||"-"}),jsxRuntimeExports.jsx("td",{className:"py-1 px-2",children:y.regional_sal||"-"}),jsxRuntimeExports.jsx("td",{className:"py-1 px-2",children:y.nacional_sal||"-"})]},j))})]})})]})]})]})}),jsxRuntimeExports.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 border border-blue-200",children:[jsxRuntimeExports.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"Flujo de Importación:"}),jsxRuntimeExports.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[jsxRuntimeExports.jsxs("li",{children:["• ",jsxRuntimeExports.jsx("strong",{children:"Paso 1:"})," Sube el PDF de tarifas GLS España 2025"]}),jsxRuntimeExports.jsxs("li",{children:["• ",jsxRuntimeExports.jsx("strong",{children:"Paso 2:"})," Revisa la vista previa de datos extraídos"]}),jsxRuntimeExports.jsxs("li",{children:["• ",jsxRuntimeExports.jsx("strong",{children:"Paso 3:"})," Selecciona y confirma las tarifas a importar"]}),jsxRuntimeExports.jsx("li",{children:"• Los datos se guardan primero en tabla temporal para revisión"}),jsxRuntimeExports.jsx("li",{children:"• Tus tarifas actuales NO se modifican hasta confirmar"}),jsxRuntimeExports.jsx("li",{children:"• Se usa PDF.js de Mozilla para extracción profesional"}),jsxRuntimeExports.jsx("li",{children:"• Compatible con Chrome, Firefox, Safari y Edge"})]})]})]})]})}const WEIGHT_RANGES=[{from:"0",to:"1",label:"0-1kg"},{from:"1",to:"3",label:"1-3kg"},{from:"3",to:"5",label:"3-5kg"},{from:"5",to:"10",label:"5-10kg"},{from:"10",to:"15",label:"10-15kg"},{from:"15",to:"999",label:"15-999kg"}],DESTINATIONS=[{key:"provincial",label:"Prov.",columns:[{field:"provincial_sal",label:"Sal"},{field:"provincial_rec",label:"Rec"},{field:"provincial_int",label:"Int"},{field:"provincial_arr",label:"Arr"}]},{key:"regional",label:"Reg.",columns:[{field:"regional_sal",label:"Sal"},{field:"regional_rec",label:"Rec"},{field:"regional_int",label:"Int"},{field:"regional_arr",label:"Arr"}]},{key:"nacional",label:"Nac.",columns:[{field:"nacional_sal",label:"Sal"},{field:"nacional_rec",label:"Rec"},{field:"nacional_int",label:"Int"},{field:"nacional_arr",label:"Arr"}]},{key:"portugal",label:"Port.",columns:[{field:"portugal_sal",label:"Sal"},{field:"portugal_rec",label:"Rec"},{field:"portugal_int",label:"Int"},{field:"portugal_arr",label:"Arr"}]},{key:"canarias_mayores",label:"Can.My.",columns:[{field:"canarias_mayores_sal",label:"Sal"},{field:"canarias_mayores_rec",label:"Rec"},{field:"canarias_mayores_int",label:"Int"},{field:"canarias_mayores_arr",label:"Arr"}]},{key:"canarias_menores",label:"Can.Mn.",columns:[{field:"canarias_menores_sal",label:"Sal"},{field:"canarias_menores_rec",label:"Rec"},{field:"canarias_menores_int",label:"Int"},{field:"canarias_menores_arr",label:"Arr"}]},{key:"baleares_mayores",label:"Bal.My.",columns:[{field:"baleares_mayores_sal",label:"Sal"},{field:"baleares_mayores_rec",label:"Rec"},{field:"baleares_mayores_int",label:"Int"},{field:"baleares_mayores_arr",label:"Arr"}]},{key:"baleares_menores",label:"Bal.Mn.",columns:[{field:"baleares_menores_sal",label:"Sal"},{field:"baleares_menores_rec",label:"Rec"},{field:"baleares_menores_int",label:"Int"},{field:"baleares_menores_arr",label:"Arr"}]},{key:"ceuta",label:"Ceuta",columns:[{field:"ceuta_sal",label:"Sal"},{field:"ceuta_rec",label:"Rec"},{field:"ceuta_int",label:"Int"},{field:"ceuta_arr",label:"Arr"}]},{key:"melilla",label:"Melilla",columns:[{field:"melilla_sal",label:"Sal"},{field:"melilla_rec",label:"Rec"},{field:"melilla_int",label:"Int"},{field:"melilla_arr",label:"Arr"}]}],CustomTariffsEditor=({onClose:t})=>{const{userData:r}=useAuth(),{customTariffs:e,refetch:s}=useCustomTariffs(r==null?void 0:r.id),{activeStates:a}=useCustomTariffsActive(r==null?void 0:r.id),{tariffs:i}=useTariffs(),[o,c]=reactExports.useState(STATIC_SERVICES[0]),[h,u]=reactExports.useState({}),[d,_]=reactExports.useState(null),[b,v]=reactExports.useState(""),[E,x]=reactExports.useState(!1),[g,w]=reactExports.useState(!1),[R,N]=reactExports.useState(null),[M,A]=reactExports.useState(!1);reactExports.useMemo(()=>a.some(S=>S.service_name===o&&S.is_active),[a,o]);const I=reactExports.useCallback(()=>{const S={};WEIGHT_RANGES.forEach(C=>{DESTINATIONS.forEach(P=>{P.columns.forEach(D=>{const B=`${C.from}_${C.to}_${D.field}`,G=e.find(J=>J.service_name===o&&J.weight_from===C.from&&J.weight_to===C.to);if(G&&G[D.field]!==void 0)S[B]=G[D.field];else{const J=i.find(Y=>Y.service_name===o&&Y.weight_from.toString()===C.from&&(Y.weight_to===null?C.to==="999":Y.weight_to.toString()===C.to));if(J){const Y=J[D.field];S[B]=Y!=null?Number(Y):null}else S[B]=null}})})}),u(S),x(!1)},[e,o,i]);reactExports.useEffect(()=>{I()},[I]);const y=S=>S==null?"":S.toFixed(2),j=S=>{const C=S.trim();if(!C)return null;const P=C.replace(",","."),D=parseFloat(P);return isNaN(D)||D<0?null:Math.round(D*100)/100},T=S=>h[S]??null,U=(S,C)=>{u(P=>({...P,[S]:C})),x(!0)},F=S=>{const[C,P,D]=S.split("_"),B=h[S],G=i.find(Ee=>Ee.service_name===o&&Ee.weight_from.toString()===C&&(Ee.weight_to===null?P==="999":Ee.weight_to.toString()===P));if(!G)return!1;const J=G[D],Y=J!=null?Number(J):null;return(B!=null?Number(B):null)!==Y},H=()=>{const S=[];return DESTINATIONS.forEach(C=>{WEIGHT_RANGES.forEach(P=>{C.columns.forEach(D=>{S.push(`${P.from}_${P.to}_${D.field}`)})})}),S},z=reactExports.useMemo(H,[]),de=(S,C)=>{const P=z.indexOf(S);if(P===-1)return!1;const D=P+C;if(D<0||D>=z.length)return!1;const B=z[D];return _(B),v(y(T(B))),setTimeout(()=>{const G=document.querySelector(`input[data-cell-key="${B}"]`);G&&(G.focus(),G.select())},0),!0},se=()=>{if(!d)return;const S=j(b);U(d,S),_(null),v("")},ue=()=>{_(null),v("")},Z=S=>{_(S),v(y(T(S)))},ge=()=>{se()},re=(S,C)=>{S.key==="Enter"?(S.preventDefault(),se(),de(C,1)):S.key==="Tab"?(S.preventDefault(),se(),de(C,S.shiftKey?-1:1)):S.key==="Escape"&&(S.preventDefault(),ue())},oe=async()=>{if(r){w(!0),N(null);try{const{data:S}=await supabase.from("custom_tariffs").select("*").eq("user_id",r.id).eq("service_name",o),C=new Map((S==null?void 0:S.map(Y=>[`${Y.weight_from}_${Y.weight_to}`,Y]))||[]),P=[],D=[];let B=0,G=0;if(WEIGHT_RANGES.forEach(Y=>{const me=i.find(W=>W.service_name===o&&W.weight_from.toString()===Y.from&&(W.weight_to===null?Y.to==="999":W.weight_to.toString()===Y.to)),Ee=`${Y.from}_${Y.to}`,Re=C.get(Ee),Ne={user_id:r.id,service_name:o,weight_from:Y.from,weight_to:Y.to};let he=!1,pe=0,fe=!0;DESTINATIONS.forEach(W=>{W.columns.forEach(Q=>{const xe=`${Y.from}_${Y.to}_${Q.field}`,Se=h[xe],Ce=me?me[Q.field]:null,Le=Ce!=null?Number(Ce):null,De=Se!=null?Number(Se):null,_e=Re&&Re[Q.field]!==void 0?Re[Q.field]:null;De!==Le&&(fe=!1),De!==Le?(Ne[Q.field]=De,he=!0,pe++):_e!==null&&_e!==Le?(Ne[Q.field]=_e,he=!0):Ne[Q.field]=Le})}),fe&&Re?(D.push(Re.id),G++):he&&(Re&&(Ne.id=Re.id),P.push(Ne),B+=pe)}),P.length===0&&D.length===0){N("No hay cambios para guardar"),setTimeout(()=>N(null),3e3),w(!1);return}if(D.length>0){const{error:Y}=await supabase.from("custom_tariffs").delete().in("id",D);if(Y)throw console.error("Error deleting restored tariff rows:",Y),Y}for(const Y of P)if(Y.id){const{id:me,...Ee}=Y,{error:Re}=await supabase.from("custom_tariffs").update(Ee).eq("id",me);if(Re)throw console.error("Error updating tariff row:",Re),Re}else{const{error:me}=await supabase.from("custom_tariffs").insert([Y]);if(me)throw console.error("Error inserting tariff row:",me),me}await s(),x(!1);const J=[];B>0&&J.push(`${B} campo(s) modificado(s) en ${P.length} rango(s)`),G>0&&J.push(`${G} rango(s) restaurado(s) a oficial`),N(J.join(" • ")),setTimeout(()=>N(null),3e3)}catch(S){console.error("Error saving custom tariffs:",S);let C="Error al guardar las tarifas";S!=null&&S.message&&(S.message.includes("row-level security")?C="Error de permisos. Por favor, cierra sesión y vuelve a iniciar.":S.message.includes("duplicate key")?C="Ya existe una tarifa personalizada para este rango de peso.":C=`Error: ${S.message}`),N(C),setTimeout(()=>N(null),5e3)}finally{w(!1)}}},be=async()=>{if(!window.confirm("¿Deseas restaurar los valores oficiales para este servicio? Esto sobrescribirá los valores actuales."))return;const S={};WEIGHT_RANGES.forEach(C=>{DESTINATIONS.forEach(P=>{P.columns.forEach(D=>{const B=`${C.from}_${C.to}_${D.field}`,G=i.find(J=>J.service_name===o&&J.weight_from.toString()===C.from&&(J.weight_to===null?C.to==="999":J.weight_to.toString()===C.to));if(G){const J=G[D.field];S[B]=J!=null?Number(J):null}else S[B]=null})})}),u(S),x(!0)},L=async()=>{if(window.confirm("¿Deseas limpiar todas las tarifas personalizadas de este servicio? Esta acción no se puede deshacer.")&&r)try{await supabase.from("custom_tariffs").delete().eq("user_id",r.id).eq("service_name",o),await s(),I(),N("Tarifas eliminadas correctamente"),setTimeout(()=>N(null),3e3)}catch(S){console.error("Error clearing custom tariffs:",S),N("Error al eliminar las tarifas"),setTimeout(()=>N(null),5e3)}};return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-[95vw] max-h-[95vh] overflow-hidden flex flex-col",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Tabla de Costes Personalizada"}),jsxRuntimeExports.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:jsxRuntimeExports.jsx(X,{className:"h-6 w-6 text-gray-500"})})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4",children:jsxRuntimeExports.jsxs("p",{className:"text-sm text-blue-900 text-center leading-relaxed",children:[". Costes de Salida (Sal), Recogida (Rec) e Interciudad (Int) son costes totales.",jsxRuntimeExports.jsx("br",{}),"Arrastres (Arr) solo se tendrá en cuenta para la aplicación de planes comerciales",jsxRuntimeExports.jsx("br",{}),'PUEDES MODIFICAR ESTA TABLA Y GUARDARLA. ESTARÁ DISPONIBLE COMO TARIFA "PERSONALIZADA".']})}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Servicio a editar"}),jsxRuntimeExports.jsx("select",{value:o,onChange:S=>{E&&!window.confirm("Tienes cambios sin guardar. ¿Deseas cambiar de servicio de todas formas?")||c(S.target.value)},className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",children:STATIC_SERVICES.map(S=>jsxRuntimeExports.jsx("option",{value:S,children:S},S))})]}),jsxRuntimeExports.jsxs("button",{onClick:()=>A(!M),className:"flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors text-sm font-medium",children:[jsxRuntimeExports.jsx(FileUp,{className:"w-4 h-4"}),M?"Ocultar Importador PDF":"Importar desde PDF"]})]}),M&&jsxRuntimeExports.jsx("div",{className:"mt-4",children:jsxRuntimeExports.jsx(TariffPdfUploader,{onDataImported:()=>{s(),I()}})}),R&&jsxRuntimeExports.jsx("div",{className:`rounded-lg p-3 text-sm font-medium ${R.includes("Error")?"bg-red-50 text-red-900 border border-red-200":"bg-green-50 text-green-900 border border-green-200"}`,children:R}),jsxRuntimeExports.jsx("div",{className:"overflow-x-auto border border-gray-200 rounded-lg",children:jsxRuntimeExports.jsxs("table",{className:"min-w-full text-xs",children:[jsxRuntimeExports.jsxs("thead",{children:[jsxRuntimeExports.jsxs("tr",{className:"bg-gray-100",children:[jsxRuntimeExports.jsx("th",{className:"sticky left-0 z-10 bg-gray-100 px-3 py-2 text-left font-semibold text-gray-700 border-r border-gray-300",children:"Peso"}),DESTINATIONS.map(S=>jsxRuntimeExports.jsx("th",{colSpan:S.columns.length,className:"px-2 py-2 text-center font-semibold text-gray-700 border-r border-gray-300",children:S.label},S.key))]}),jsxRuntimeExports.jsxs("tr",{className:"bg-gray-50",children:[jsxRuntimeExports.jsx("th",{className:"sticky left-0 z-10 bg-gray-50 px-3 py-2 border-r border-gray-300"}),DESTINATIONS.map(S=>jsxRuntimeExports.jsx(React.Fragment,{children:S.columns.map(C=>jsxRuntimeExports.jsx("th",{className:`px-1 py-1 text-center text-xs font-medium border-r border-gray-200 ${C.label==="Arr"?"text-red-700 bg-red-50":"text-gray-600"}`,children:C.label},C.field))},S.key))]})]}),jsxRuntimeExports.jsx("tbody",{className:"divide-y divide-gray-200",children:WEIGHT_RANGES.map(S=>jsxRuntimeExports.jsxs("tr",{className:"hover:bg-gray-50",children:[jsxRuntimeExports.jsx("td",{className:"sticky left-0 z-10 bg-white px-3 py-2 font-medium text-gray-700 border-r border-gray-300",children:S.label}),DESTINATIONS.map(C=>jsxRuntimeExports.jsx(React.Fragment,{children:C.columns.map(P=>{const D=`${S.from}_${S.to}_${P.field}`,B=d===D,G=T(D),J=P.label==="Arr",Y=F(D);return jsxRuntimeExports.jsx("td",{className:`px-1 py-1 border-r border-gray-200 ${J?"bg-red-50":""}`,children:jsxRuntimeExports.jsx("input",{type:"text",inputMode:"decimal","data-cell-key":D,value:B?b:y(G),onFocus:()=>Z(D),onBlur:ge,onChange:me=>B&&v(me.target.value),onKeyDown:me=>re(me,D),className:`w-full px-1 py-1 text-right text-xs border border-gray-300 rounded focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition-colors ${J?"text-red-700 font-semibold":""} ${Y?"bg-amber-50 font-medium":"bg-white"}`,style:{minWidth:"60px"}})},P.field)})},C.key))]},`${S.from}_${S.to}`))})]})})]})}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between gap-3 flex-wrap border-t p-6 bg-gray-50",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsxs("button",{onClick:be,className:"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:[jsxRuntimeExports.jsx(RotateCcw,{className:"h-4 w-4"}),"Restaurar Oficial"]}),jsxRuntimeExports.jsxs("button",{onClick:L,className:"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-red-700 bg-red-50 rounded-lg hover:bg-red-100 transition-colors",children:[jsxRuntimeExports.jsx(Trash2,{className:"h-4 w-4"}),"Limpiar"]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[E&&jsxRuntimeExports.jsx("span",{className:"text-sm text-orange-600 font-medium",children:"Cambios pendientes sin guardar"}),jsxRuntimeExports.jsxs("button",{onClick:oe,disabled:!E||g,className:"inline-flex items-center gap-2 px-6 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[jsxRuntimeExports.jsx(Save,{className:"h-4 w-4"}),g?"Guardando...":"GRABAR"]}),jsxRuntimeExports.jsx("button",{onClick:t,className:"inline-flex items-center gap-2 px-6 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"CERRAR"})]})]})]})})};/*! xlsx.js (C) 2013-present SheetJS -- http://sheetjs.com */var XLSX={};XLSX.version="0.18.5";var current_ansi=1252,VALID_ANSI=[874,932,936,949,950,1250,1251,1252,1253,1254,1255,1256,1257,1258,1e4],set_ansi=function(t){VALID_ANSI.indexOf(t)!=-1&&(current_ansi=t)};function reset_ansi(){set_ansi(1252)}var set_cp=function(t){set_ansi(t)};function reset_cp(){set_cp(1200),reset_ansi()}var _getchar=function(r){return String.fromCharCode(r)},_getansi=function(r){return String.fromCharCode(r)},$cptable,Base64_map="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function Base64_encode(t){for(var r="",e=0,s=0,a=0,i=0,o=0,c=0,h=0,u=0;u<t.length;)e=t.charCodeAt(u++),i=e>>2,s=t.charCodeAt(u++),o=(e&3)<<4|s>>4,a=t.charCodeAt(u++),c=(s&15)<<2|a>>6,h=a&63,isNaN(s)?c=h=64:isNaN(a)&&(h=64),r+=Base64_map.charAt(i)+Base64_map.charAt(o)+Base64_map.charAt(c)+Base64_map.charAt(h);return r}function Base64_decode(t){var r="",e=0,s=0,a=0,i=0,o=0,c=0,h=0;t=t.replace(/[^\w\+\/\=]/g,"");for(var u=0;u<t.length;)i=Base64_map.indexOf(t.charAt(u++)),o=Base64_map.indexOf(t.charAt(u++)),e=i<<2|o>>4,r+=String.fromCharCode(e),c=Base64_map.indexOf(t.charAt(u++)),s=(o&15)<<4|c>>2,c!==64&&(r+=String.fromCharCode(s)),h=Base64_map.indexOf(t.charAt(u++)),a=(c&3)<<6|h,h!==64&&(r+=String.fromCharCode(a));return r}var has_buf=function(){return typeof Buffer<"u"&&typeof process<"u"&&typeof process.versions<"u"&&!!process.versions.node}(),Buffer_from=function(){if(typeof Buffer<"u"){var t=!Buffer.from;if(!t)try{Buffer.from("foo","utf8")}catch{t=!0}return t?function(r,e){return e?new Buffer(r,e):new Buffer(r)}:Buffer.from.bind(Buffer)}return function(){}}();function new_raw_buf(t){return has_buf?Buffer.alloc?Buffer.alloc(t):new Buffer(t):typeof Uint8Array<"u"?new Uint8Array(t):new Array(t)}function new_unsafe_buf(t){return has_buf?Buffer.allocUnsafe?Buffer.allocUnsafe(t):new Buffer(t):typeof Uint8Array<"u"?new Uint8Array(t):new Array(t)}var s2a=function(r){return has_buf?Buffer_from(r,"binary"):r.split("").map(function(e){return e.charCodeAt(0)&255})};function s2ab(t){if(typeof ArrayBuffer>"u")return s2a(t);for(var r=new ArrayBuffer(t.length),e=new Uint8Array(r),s=0;s!=t.length;++s)e[s]=t.charCodeAt(s)&255;return r}function a2s(t){if(Array.isArray(t))return t.map(function(s){return String.fromCharCode(s)}).join("");for(var r=[],e=0;e<t.length;++e)r[e]=String.fromCharCode(t[e]);return r.join("")}function a2u(t){if(typeof Uint8Array>"u")throw new Error("Unsupported");return new Uint8Array(t)}var bconcat=has_buf?function(t){return Buffer.concat(t.map(function(r){return Buffer.isBuffer(r)?r:Buffer_from(r)}))}:function(t){if(typeof Uint8Array<"u"){var r=0,e=0;for(r=0;r<t.length;++r)e+=t[r].length;var s=new Uint8Array(e),a=0;for(r=0,e=0;r<t.length;e+=a,++r)if(a=t[r].length,t[r]instanceof Uint8Array)s.set(t[r],e);else{if(typeof t[r]=="string")throw"wtf";s.set(new Uint8Array(t[r]),e)}return s}return[].concat.apply([],t.map(function(i){return Array.isArray(i)?i:[].slice.call(i)}))};function utf8decode(t){for(var r=[],e=0,s=t.length+250,a=new_raw_buf(t.length+255),i=0;i<t.length;++i){var o=t.charCodeAt(i);if(o<128)a[e++]=o;else if(o<2048)a[e++]=192|o>>6&31,a[e++]=128|o&63;else if(o>=55296&&o<57344){o=(o&1023)+64;var c=t.charCodeAt(++i)&1023;a[e++]=240|o>>8&7,a[e++]=128|o>>2&63,a[e++]=128|c>>6&15|(o&3)<<4,a[e++]=128|c&63}else a[e++]=224|o>>12&15,a[e++]=128|o>>6&63,a[e++]=128|o&63;e>s&&(r.push(a.slice(0,e)),e=0,a=new_raw_buf(65535),s=65530)}return r.push(a.slice(0,e)),bconcat(r)}var chr0=/\u0000/g,chr1=/[\u0001-\u0006]/g;function _strrev(t){for(var r="",e=t.length-1;e>=0;)r+=t.charAt(e--);return r}function pad0(t,r){var e=""+t;return e.length>=r?e:fill("0",r-e.length)+e}function pad_(t,r){var e=""+t;return e.length>=r?e:fill(" ",r-e.length)+e}function rpad_(t,r){var e=""+t;return e.length>=r?e:e+fill(" ",r-e.length)}function pad0r1(t,r){var e=""+Math.round(t);return e.length>=r?e:fill("0",r-e.length)+e}function pad0r2(t,r){var e=""+t;return e.length>=r?e:fill("0",r-e.length)+e}var p2_32=Math.pow(2,32);function pad0r(t,r){if(t>p2_32||t<-p2_32)return pad0r1(t,r);var e=Math.round(t);return pad0r2(e,r)}function SSF_isgeneral(t,r){return r=r||0,t.length>=7+r&&(t.charCodeAt(r)|32)===103&&(t.charCodeAt(r+1)|32)===101&&(t.charCodeAt(r+2)|32)===110&&(t.charCodeAt(r+3)|32)===101&&(t.charCodeAt(r+4)|32)===114&&(t.charCodeAt(r+5)|32)===97&&(t.charCodeAt(r+6)|32)===108}var days=[["Sun","Sunday"],["Mon","Monday"],["Tue","Tuesday"],["Wed","Wednesday"],["Thu","Thursday"],["Fri","Friday"],["Sat","Saturday"]],months=[["J","Jan","January"],["F","Feb","February"],["M","Mar","March"],["A","Apr","April"],["M","May","May"],["J","Jun","June"],["J","Jul","July"],["A","Aug","August"],["S","Sep","September"],["O","Oct","October"],["N","Nov","November"],["D","Dec","December"]];function SSF_init_table(t){return t||(t={}),t[0]="General",t[1]="0",t[2]="0.00",t[3]="#,##0",t[4]="#,##0.00",t[9]="0%",t[10]="0.00%",t[11]="0.00E+00",t[12]="# ?/?",t[13]="# ??/??",t[14]="m/d/yy",t[15]="d-mmm-yy",t[16]="d-mmm",t[17]="mmm-yy",t[18]="h:mm AM/PM",t[19]="h:mm:ss AM/PM",t[20]="h:mm",t[21]="h:mm:ss",t[22]="m/d/yy h:mm",t[37]="#,##0 ;(#,##0)",t[38]="#,##0 ;[Red](#,##0)",t[39]="#,##0.00;(#,##0.00)",t[40]="#,##0.00;[Red](#,##0.00)",t[45]="mm:ss",t[46]="[h]:mm:ss",t[47]="mmss.0",t[48]="##0.0E+0",t[49]="@",t[56]='"上午/下午 "hh"時"mm"分"ss"秒 "',t}var table_fmt={0:"General",1:"0",2:"0.00",3:"#,##0",4:"#,##0.00",9:"0%",10:"0.00%",11:"0.00E+00",12:"# ?/?",13:"# ??/??",14:"m/d/yy",15:"d-mmm-yy",16:"d-mmm",17:"mmm-yy",18:"h:mm AM/PM",19:"h:mm:ss AM/PM",20:"h:mm",21:"h:mm:ss",22:"m/d/yy h:mm",37:"#,##0 ;(#,##0)",38:"#,##0 ;[Red](#,##0)",39:"#,##0.00;(#,##0.00)",40:"#,##0.00;[Red](#,##0.00)",45:"mm:ss",46:"[h]:mm:ss",47:"mmss.0",48:"##0.0E+0",49:"@",56:'"上午/下午 "hh"時"mm"分"ss"秒 "'},SSF_default_map={5:37,6:38,7:39,8:40,23:0,24:0,25:0,26:0,27:14,28:14,29:14,30:14,31:14,50:14,51:14,52:14,53:14,54:14,55:14,56:14,57:14,58:14,59:1,60:2,61:3,62:4,67:9,68:10,69:12,70:13,71:14,72:14,73:15,74:16,75:17,76:20,77:21,78:22,79:45,80:46,81:47,82:0},SSF_default_str={5:'"$"#,##0_);\\("$"#,##0\\)',63:'"$"#,##0_);\\("$"#,##0\\)',6:'"$"#,##0_);[Red]\\("$"#,##0\\)',64:'"$"#,##0_);[Red]\\("$"#,##0\\)',7:'"$"#,##0.00_);\\("$"#,##0.00\\)',65:'"$"#,##0.00_);\\("$"#,##0.00\\)',8:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',66:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',41:'_(* #,##0_);_(* \\(#,##0\\);_(* "-"_);_(@_)',42:'_("$"* #,##0_);_("$"* \\(#,##0\\);_("$"* "-"_);_(@_)',43:'_(* #,##0.00_);_(* \\(#,##0.00\\);_(* "-"??_);_(@_)',44:'_("$"* #,##0.00_);_("$"* \\(#,##0.00\\);_("$"* "-"??_);_(@_)'};function SSF_frac(t,r,e){for(var s=t<0?-1:1,a=t*s,i=0,o=1,c=0,h=1,u=0,d=0,_=Math.floor(a);u<r&&(_=Math.floor(a),c=_*o+i,d=_*u+h,!(a-_<5e-8));)a=1/(a-_),i=o,o=c,h=u,u=d;if(d>r&&(u>r?(d=h,c=i):(d=u,c=o)),!e)return[0,s*c,d];var b=Math.floor(s*c/d);return[b,s*c-b*d,d]}function SSF_parse_date_code(t,r,e){if(t>2958465||t<0)return null;var s=t|0,a=Math.floor(86400*(t-s)),i=0,o=[],c={D:s,T:a,u:86400*(t-s)-a,y:0,m:0,d:0,H:0,M:0,S:0,q:0};if(Math.abs(c.u)<1e-6&&(c.u=0),r&&r.date1904&&(s+=1462),c.u>.9999&&(c.u=0,++a==86400&&(c.T=a=0,++s,++c.D)),s===60)o=e?[1317,10,29]:[1900,2,29],i=3;else if(s===0)o=e?[1317,8,29]:[1900,1,0],i=6;else{s>60&&--s;var h=new Date(1900,0,1);h.setDate(h.getDate()+s-1),o=[h.getFullYear(),h.getMonth()+1,h.getDate()],i=h.getDay(),s<60&&(i=(i+6)%7),e&&(i=SSF_fix_hijri(h,o))}return c.y=o[0],c.m=o[1],c.d=o[2],c.S=a%60,a=Math.floor(a/60),c.M=a%60,a=Math.floor(a/60),c.H=a,c.q=i,c}var SSFbasedate=new Date(1899,11,31,0,0,0),SSFdnthresh=SSFbasedate.getTime(),SSFbase1904=new Date(1900,2,1,0,0,0);function datenum_local(t,r){var e=t.getTime();return r?e-=1461*24*60*60*1e3:t>=SSFbase1904&&(e+=24*60*60*1e3),(e-(SSFdnthresh+(t.getTimezoneOffset()-SSFbasedate.getTimezoneOffset())*6e4))/(24*60*60*1e3)}function SSF_strip_decimal(t){return t.indexOf(".")==-1?t:t.replace(/(?:\.0*|(\.\d*[1-9])0+)$/,"$1")}function SSF_normalize_exp(t){return t.indexOf("E")==-1?t:t.replace(/(?:\.0*|(\.\d*[1-9])0+)[Ee]/,"$1E").replace(/(E[+-])(\d)$/,"$10$2")}function SSF_small_exp(t){var r=t<0?12:11,e=SSF_strip_decimal(t.toFixed(12));return e.length<=r||(e=t.toPrecision(10),e.length<=r)?e:t.toExponential(5)}function SSF_large_exp(t){var r=SSF_strip_decimal(t.toFixed(11));return r.length>(t<0?12:11)||r==="0"||r==="-0"?t.toPrecision(6):r}function SSF_general_num(t){var r=Math.floor(Math.log(Math.abs(t))*Math.LOG10E),e;return r>=-4&&r<=-1?e=t.toPrecision(10+r):Math.abs(r)<=9?e=SSF_small_exp(t):r===10?e=t.toFixed(10).substr(0,12):e=SSF_large_exp(t),SSF_strip_decimal(SSF_normalize_exp(e.toUpperCase()))}function SSF_general(t,r){switch(typeof t){case"string":return t;case"boolean":return t?"TRUE":"FALSE";case"number":return(t|0)===t?t.toString(10):SSF_general_num(t);case"undefined":return"";case"object":if(t==null)return"";if(t instanceof Date)return SSF_format(14,datenum_local(t,r&&r.date1904),r)}throw new Error("unsupported value in General format: "+t)}function SSF_fix_hijri(t,r){r[0]-=581;var e=t.getDay();return t<60&&(e=(e+6)%7),e}function SSF_write_date(t,r,e,s){var a="",i=0,o=0,c=e.y,h,u=0;switch(t){case 98:c=e.y+543;case 121:switch(r.length){case 1:case 2:h=c%100,u=2;break;default:h=c%1e4,u=4;break}break;case 109:switch(r.length){case 1:case 2:h=e.m,u=r.length;break;case 3:return months[e.m-1][1];case 5:return months[e.m-1][0];default:return months[e.m-1][2]}break;case 100:switch(r.length){case 1:case 2:h=e.d,u=r.length;break;case 3:return days[e.q][0];default:return days[e.q][1]}break;case 104:switch(r.length){case 1:case 2:h=1+(e.H+11)%12,u=r.length;break;default:throw"bad hour format: "+r}break;case 72:switch(r.length){case 1:case 2:h=e.H,u=r.length;break;default:throw"bad hour format: "+r}break;case 77:switch(r.length){case 1:case 2:h=e.M,u=r.length;break;default:throw"bad minute format: "+r}break;case 115:if(r!="s"&&r!="ss"&&r!=".0"&&r!=".00"&&r!=".000")throw"bad second format: "+r;return e.u===0&&(r=="s"||r=="ss")?pad0(e.S,r.length):(s>=2?o=s===3?1e3:100:o=s===1?10:1,i=Math.round(o*(e.S+e.u)),i>=60*o&&(i=0),r==="s"?i===0?"0":""+i/o:(a=pad0(i,2+s),r==="ss"?a.substr(0,2):"."+a.substr(2,r.length-1)));case 90:switch(r){case"[h]":case"[hh]":h=e.D*24+e.H;break;case"[m]":case"[mm]":h=(e.D*24+e.H)*60+e.M;break;case"[s]":case"[ss]":h=((e.D*24+e.H)*60+e.M)*60+Math.round(e.S+e.u);break;default:throw"bad abstime format: "+r}u=r.length===3?1:2;break;case 101:h=c,u=1;break}var d=u>0?pad0(h,u):"";return d}function commaify(t){var r=3;if(t.length<=r)return t;for(var e=t.length%r,s=t.substr(0,e);e!=t.length;e+=r)s+=(s.length>0?",":"")+t.substr(e,r);return s}var pct1=/%/g;function write_num_pct(t,r,e){var s=r.replace(pct1,""),a=r.length-s.length;return write_num(t,s,e*Math.pow(10,2*a))+fill("%",a)}function write_num_cm(t,r,e){for(var s=r.length-1;r.charCodeAt(s-1)===44;)--s;return write_num(t,r.substr(0,s),e/Math.pow(10,3*(r.length-s)))}function write_num_exp(t,r){var e,s=t.indexOf("E")-t.indexOf(".")-1;if(t.match(/^#+0.0E\+0$/)){if(r==0)return"0.0E+0";if(r<0)return"-"+write_num_exp(t,-r);var a=t.indexOf(".");a===-1&&(a=t.indexOf("E"));var i=Math.floor(Math.log(r)*Math.LOG10E)%a;if(i<0&&(i+=a),e=(r/Math.pow(10,i)).toPrecision(s+1+(a+i)%a),e.indexOf("e")===-1){var o=Math.floor(Math.log(r)*Math.LOG10E);for(e.indexOf(".")===-1?e=e.charAt(0)+"."+e.substr(1)+"E+"+(o-e.length+i):e+="E+"+(o-i);e.substr(0,2)==="0.";)e=e.charAt(0)+e.substr(2,a)+"."+e.substr(2+a),e=e.replace(/^0+([1-9])/,"$1").replace(/^0+\./,"0.");e=e.replace(/\+-/,"-")}e=e.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(c,h,u,d){return h+u+d.substr(0,(a+i)%a)+"."+d.substr(i)+"E"})}else e=r.toExponential(s);return t.match(/E\+00$/)&&e.match(/e[+-]\d$/)&&(e=e.substr(0,e.length-1)+"0"+e.charAt(e.length-1)),t.match(/E\-/)&&e.match(/e\+/)&&(e=e.replace(/e\+/,"e")),e.replace("e","E")}var frac1=/# (\?+)( ?)\/( ?)(\d+)/;function write_num_f1(t,r,e){var s=parseInt(t[4],10),a=Math.round(r*s),i=Math.floor(a/s),o=a-i*s,c=s;return e+(i===0?"":""+i)+" "+(o===0?fill(" ",t[1].length+1+t[4].length):pad_(o,t[1].length)+t[2]+"/"+t[3]+pad0(c,t[4].length))}function write_num_f2(t,r,e){return e+(r===0?"":""+r)+fill(" ",t[1].length+2+t[4].length)}var dec1=/^#*0*\.([0#]+)/,closeparen=/\).*[0#]/,phone=/\(###\) ###\\?-####/;function hashq(t){for(var r="",e,s=0;s!=t.length;++s)switch(e=t.charCodeAt(s)){case 35:break;case 63:r+=" ";break;case 48:r+="0";break;default:r+=String.fromCharCode(e)}return r}function rnd(t,r){var e=Math.pow(10,r);return""+Math.round(t*e)/e}function dec(t,r){var e=t-Math.floor(t),s=Math.pow(10,r);return r<(""+Math.round(e*s)).length?0:Math.round(e*s)}function carry(t,r){return r<(""+Math.round((t-Math.floor(t))*Math.pow(10,r))).length?1:0}function flr(t){return t<2147483647&&t>-2147483648?""+(t>=0?t|0:t-1|0):""+Math.floor(t)}function write_num_flt(t,r,e){if(t.charCodeAt(0)===40&&!r.match(closeparen)){var s=r.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return e>=0?write_num_flt("n",s,e):"("+write_num_flt("n",s,-e)+")"}if(r.charCodeAt(r.length-1)===44)return write_num_cm(t,r,e);if(r.indexOf("%")!==-1)return write_num_pct(t,r,e);if(r.indexOf("E")!==-1)return write_num_exp(r,e);if(r.charCodeAt(0)===36)return"$"+write_num_flt(t,r.substr(r.charAt(1)==" "?2:1),e);var a,i,o,c,h=Math.abs(e),u=e<0?"-":"";if(r.match(/^00+$/))return u+pad0r(h,r.length);if(r.match(/^[#?]+$/))return a=pad0r(e,0),a==="0"&&(a=""),a.length>r.length?a:hashq(r.substr(0,r.length-a.length))+a;if(i=r.match(frac1))return write_num_f1(i,h,u);if(r.match(/^#+0+$/))return u+pad0r(h,r.length-r.indexOf("0"));if(i=r.match(dec1))return a=rnd(e,i[1].length).replace(/^([^\.]+)$/,"$1."+hashq(i[1])).replace(/\.$/,"."+hashq(i[1])).replace(/\.(\d*)$/,function(E,x){return"."+x+fill("0",hashq(i[1]).length-x.length)}),r.indexOf("0.")!==-1?a:a.replace(/^0\./,".");if(r=r.replace(/^#+([0.])/,"$1"),i=r.match(/^(0*)\.(#*)$/))return u+rnd(h,i[2].length).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,i[1].length?"0.":".");if(i=r.match(/^#{1,3},##0(\.?)$/))return u+commaify(pad0r(h,0));if(i=r.match(/^#,##0\.([#0]*0)$/))return e<0?"-"+write_num_flt(t,r,-e):commaify(""+(Math.floor(e)+carry(e,i[1].length)))+"."+pad0(dec(e,i[1].length),i[1].length);if(i=r.match(/^#,#*,#0/))return write_num_flt(t,r.replace(/^#,#*,/,""),e);if(i=r.match(/^([0#]+)(\\?-([0#]+))+$/))return a=_strrev(write_num_flt(t,r.replace(/[\\-]/g,""),e)),o=0,_strrev(_strrev(r.replace(/\\/g,"")).replace(/[0#]/g,function(E){return o<a.length?a.charAt(o++):E==="0"?"0":""}));if(r.match(phone))return a=write_num_flt(t,"##########",e),"("+a.substr(0,3)+") "+a.substr(3,3)+"-"+a.substr(6);var d="";if(i=r.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return o=Math.min(i[4].length,7),c=SSF_frac(h,Math.pow(10,o)-1,!1),a=""+u,d=write_num("n",i[1],c[1]),d.charAt(d.length-1)==" "&&(d=d.substr(0,d.length-1)+"0"),a+=d+i[2]+"/"+i[3],d=rpad_(c[2],o),d.length<i[4].length&&(d=hashq(i[4].substr(i[4].length-d.length))+d),a+=d,a;if(i=r.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return o=Math.min(Math.max(i[1].length,i[4].length),7),c=SSF_frac(h,Math.pow(10,o)-1,!0),u+(c[0]||(c[1]?"":"0"))+" "+(c[1]?pad_(c[1],o)+i[2]+"/"+i[3]+rpad_(c[2],o):fill(" ",2*o+1+i[2].length+i[3].length));if(i=r.match(/^[#0?]+$/))return a=pad0r(e,0),r.length<=a.length?a:hashq(r.substr(0,r.length-a.length))+a;if(i=r.match(/^([#0?]+)\.([#0]+)$/)){a=""+e.toFixed(Math.min(i[2].length,10)).replace(/([^0])0+$/,"$1"),o=a.indexOf(".");var _=r.indexOf(".")-o,b=r.length-a.length-_;return hashq(r.substr(0,_)+a+r.substr(r.length-b))}if(i=r.match(/^00,000\.([#0]*0)$/))return o=dec(e,i[1].length),e<0?"-"+write_num_flt(t,r,-e):commaify(flr(e)).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(E){return"00,"+(E.length<3?pad0(0,3-E.length):"")+E})+"."+pad0(o,i[1].length);switch(r){case"###,##0.00":return write_num_flt(t,"#,##0.00",e);case"###,###":case"##,###":case"#,###":var v=commaify(pad0r(h,0));return v!=="0"?u+v:"";case"###,###.00":return write_num_flt(t,"###,##0.00",e).replace(/^0\./,".");case"#,###.00":return write_num_flt(t,"#,##0.00",e).replace(/^0\./,".")}throw new Error("unsupported format |"+r+"|")}function write_num_cm2(t,r,e){for(var s=r.length-1;r.charCodeAt(s-1)===44;)--s;return write_num(t,r.substr(0,s),e/Math.pow(10,3*(r.length-s)))}function write_num_pct2(t,r,e){var s=r.replace(pct1,""),a=r.length-s.length;return write_num(t,s,e*Math.pow(10,2*a))+fill("%",a)}function write_num_exp2(t,r){var e,s=t.indexOf("E")-t.indexOf(".")-1;if(t.match(/^#+0.0E\+0$/)){if(r==0)return"0.0E+0";if(r<0)return"-"+write_num_exp2(t,-r);var a=t.indexOf(".");a===-1&&(a=t.indexOf("E"));var i=Math.floor(Math.log(r)*Math.LOG10E)%a;if(i<0&&(i+=a),e=(r/Math.pow(10,i)).toPrecision(s+1+(a+i)%a),!e.match(/[Ee]/)){var o=Math.floor(Math.log(r)*Math.LOG10E);e.indexOf(".")===-1?e=e.charAt(0)+"."+e.substr(1)+"E+"+(o-e.length+i):e+="E+"+(o-i),e=e.replace(/\+-/,"-")}e=e.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(c,h,u,d){return h+u+d.substr(0,(a+i)%a)+"."+d.substr(i)+"E"})}else e=r.toExponential(s);return t.match(/E\+00$/)&&e.match(/e[+-]\d$/)&&(e=e.substr(0,e.length-1)+"0"+e.charAt(e.length-1)),t.match(/E\-/)&&e.match(/e\+/)&&(e=e.replace(/e\+/,"e")),e.replace("e","E")}function write_num_int(t,r,e){if(t.charCodeAt(0)===40&&!r.match(closeparen)){var s=r.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return e>=0?write_num_int("n",s,e):"("+write_num_int("n",s,-e)+")"}if(r.charCodeAt(r.length-1)===44)return write_num_cm2(t,r,e);if(r.indexOf("%")!==-1)return write_num_pct2(t,r,e);if(r.indexOf("E")!==-1)return write_num_exp2(r,e);if(r.charCodeAt(0)===36)return"$"+write_num_int(t,r.substr(r.charAt(1)==" "?2:1),e);var a,i,o,c,h=Math.abs(e),u=e<0?"-":"";if(r.match(/^00+$/))return u+pad0(h,r.length);if(r.match(/^[#?]+$/))return a=""+e,e===0&&(a=""),a.length>r.length?a:hashq(r.substr(0,r.length-a.length))+a;if(i=r.match(frac1))return write_num_f2(i,h,u);if(r.match(/^#+0+$/))return u+pad0(h,r.length-r.indexOf("0"));if(i=r.match(dec1))return a=(""+e).replace(/^([^\.]+)$/,"$1."+hashq(i[1])).replace(/\.$/,"."+hashq(i[1])),a=a.replace(/\.(\d*)$/,function(E,x){return"."+x+fill("0",hashq(i[1]).length-x.length)}),r.indexOf("0.")!==-1?a:a.replace(/^0\./,".");if(r=r.replace(/^#+([0.])/,"$1"),i=r.match(/^(0*)\.(#*)$/))return u+(""+h).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,i[1].length?"0.":".");if(i=r.match(/^#{1,3},##0(\.?)$/))return u+commaify(""+h);if(i=r.match(/^#,##0\.([#0]*0)$/))return e<0?"-"+write_num_int(t,r,-e):commaify(""+e)+"."+fill("0",i[1].length);if(i=r.match(/^#,#*,#0/))return write_num_int(t,r.replace(/^#,#*,/,""),e);if(i=r.match(/^([0#]+)(\\?-([0#]+))+$/))return a=_strrev(write_num_int(t,r.replace(/[\\-]/g,""),e)),o=0,_strrev(_strrev(r.replace(/\\/g,"")).replace(/[0#]/g,function(E){return o<a.length?a.charAt(o++):E==="0"?"0":""}));if(r.match(phone))return a=write_num_int(t,"##########",e),"("+a.substr(0,3)+") "+a.substr(3,3)+"-"+a.substr(6);var d="";if(i=r.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return o=Math.min(i[4].length,7),c=SSF_frac(h,Math.pow(10,o)-1,!1),a=""+u,d=write_num("n",i[1],c[1]),d.charAt(d.length-1)==" "&&(d=d.substr(0,d.length-1)+"0"),a+=d+i[2]+"/"+i[3],d=rpad_(c[2],o),d.length<i[4].length&&(d=hashq(i[4].substr(i[4].length-d.length))+d),a+=d,a;if(i=r.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return o=Math.min(Math.max(i[1].length,i[4].length),7),c=SSF_frac(h,Math.pow(10,o)-1,!0),u+(c[0]||(c[1]?"":"0"))+" "+(c[1]?pad_(c[1],o)+i[2]+"/"+i[3]+rpad_(c[2],o):fill(" ",2*o+1+i[2].length+i[3].length));if(i=r.match(/^[#0?]+$/))return a=""+e,r.length<=a.length?a:hashq(r.substr(0,r.length-a.length))+a;if(i=r.match(/^([#0]+)\.([#0]+)$/)){a=""+e.toFixed(Math.min(i[2].length,10)).replace(/([^0])0+$/,"$1"),o=a.indexOf(".");var _=r.indexOf(".")-o,b=r.length-a.length-_;return hashq(r.substr(0,_)+a+r.substr(r.length-b))}if(i=r.match(/^00,000\.([#0]*0)$/))return e<0?"-"+write_num_int(t,r,-e):commaify(""+e).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(E){return"00,"+(E.length<3?pad0(0,3-E.length):"")+E})+"."+pad0(0,i[1].length);switch(r){case"###,###":case"##,###":case"#,###":var v=commaify(""+h);return v!=="0"?u+v:"";default:if(r.match(/\.[0#?]*$/))return write_num_int(t,r.slice(0,r.lastIndexOf(".")),e)+hashq(r.slice(r.lastIndexOf(".")))}throw new Error("unsupported format |"+r+"|")}function write_num(t,r,e){return(e|0)===e?write_num_int(t,r,e):write_num_flt(t,r,e)}function SSF_split_fmt(t){for(var r=[],e=!1,s=0,a=0;s<t.length;++s)switch(t.charCodeAt(s)){case 34:e=!e;break;case 95:case 42:case 92:++s;break;case 59:r[r.length]=t.substr(a,s-a),a=s+1}if(r[r.length]=t.substr(a),e===!0)throw new Error("Format |"+t+"| unterminated string ");return r}var SSF_abstime=/\[[HhMmSs\u0E0A\u0E19\u0E17]*\]/;function fmt_is_date(t){for(var r=0,e="",s="";r<t.length;)switch(e=t.charAt(r)){case"G":SSF_isgeneral(t,r)&&(r+=6),r++;break;case'"':for(;t.charCodeAt(++r)!==34&&r<t.length;);++r;break;case"\\":r+=2;break;case"_":r+=2;break;case"@":++r;break;case"B":case"b":if(t.charAt(r+1)==="1"||t.charAt(r+1)==="2")return!0;case"M":case"D":case"Y":case"H":case"S":case"E":case"m":case"d":case"y":case"h":case"s":case"e":case"g":return!0;case"A":case"a":case"上":if(t.substr(r,3).toUpperCase()==="A/P"||t.substr(r,5).toUpperCase()==="AM/PM"||t.substr(r,5).toUpperCase()==="上午/下午")return!0;++r;break;case"[":for(s=e;t.charAt(r++)!=="]"&&r<t.length;)s+=t.charAt(r);if(s.match(SSF_abstime))return!0;break;case".":case"0":case"#":for(;r<t.length&&("0#?.,E+-%".indexOf(e=t.charAt(++r))>-1||e=="\\"&&t.charAt(r+1)=="-"&&"0#".indexOf(t.charAt(r+2))>-1););break;case"?":for(;t.charAt(++r)===e;);break;case"*":++r,(t.charAt(r)==" "||t.charAt(r)=="*")&&++r;break;case"(":case")":++r;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(;r<t.length&&"0123456789".indexOf(t.charAt(++r))>-1;);break;case" ":++r;break;default:++r;break}return!1}function eval_fmt(t,r,e,s){for(var a=[],i="",o=0,c="",h="t",u,d,_,b="H";o<t.length;)switch(c=t.charAt(o)){case"G":if(!SSF_isgeneral(t,o))throw new Error("unrecognized character "+c+" in "+t);a[a.length]={t:"G",v:"General"},o+=7;break;case'"':for(i="";(_=t.charCodeAt(++o))!==34&&o<t.length;)i+=String.fromCharCode(_);a[a.length]={t:"t",v:i},++o;break;case"\\":var v=t.charAt(++o),E=v==="("||v===")"?v:"t";a[a.length]={t:E,v},++o;break;case"_":a[a.length]={t:"t",v:" "},o+=2;break;case"@":a[a.length]={t:"T",v:r},++o;break;case"B":case"b":if(t.charAt(o+1)==="1"||t.charAt(o+1)==="2"){if(u==null&&(u=SSF_parse_date_code(r,e,t.charAt(o+1)==="2"),u==null))return"";a[a.length]={t:"X",v:t.substr(o,2)},h=c,o+=2;break}case"M":case"D":case"Y":case"H":case"S":case"E":c=c.toLowerCase();case"m":case"d":case"y":case"h":case"s":case"e":case"g":if(r<0||u==null&&(u=SSF_parse_date_code(r,e),u==null))return"";for(i=c;++o<t.length&&t.charAt(o).toLowerCase()===c;)i+=c;c==="m"&&h.toLowerCase()==="h"&&(c="M"),c==="h"&&(c=b),a[a.length]={t:c,v:i},h=c;break;case"A":case"a":case"上":var x={t:c,v:c};if(u==null&&(u=SSF_parse_date_code(r,e)),t.substr(o,3).toUpperCase()==="A/P"?(u!=null&&(x.v=u.H>=12?"P":"A"),x.t="T",b="h",o+=3):t.substr(o,5).toUpperCase()==="AM/PM"?(u!=null&&(x.v=u.H>=12?"PM":"AM"),x.t="T",o+=5,b="h"):t.substr(o,5).toUpperCase()==="上午/下午"?(u!=null&&(x.v=u.H>=12?"下午":"上午"),x.t="T",o+=5,b="h"):(x.t="t",++o),u==null&&x.t==="T")return"";a[a.length]=x,h=c;break;case"[":for(i=c;t.charAt(o++)!=="]"&&o<t.length;)i+=t.charAt(o);if(i.slice(-1)!=="]")throw'unterminated "[" block: |'+i+"|";if(i.match(SSF_abstime)){if(u==null&&(u=SSF_parse_date_code(r,e),u==null))return"";a[a.length]={t:"Z",v:i.toLowerCase()},h=i.charAt(1)}else i.indexOf("$")>-1&&(i=(i.match(/\$([^-\[\]]*)/)||[])[1]||"$",fmt_is_date(t)||(a[a.length]={t:"t",v:i}));break;case".":if(u!=null){for(i=c;++o<t.length&&(c=t.charAt(o))==="0";)i+=c;a[a.length]={t:"s",v:i};break}case"0":case"#":for(i=c;++o<t.length&&"0#?.,E+-%".indexOf(c=t.charAt(o))>-1;)i+=c;a[a.length]={t:"n",v:i};break;case"?":for(i=c;t.charAt(++o)===c;)i+=c;a[a.length]={t:c,v:i},h=c;break;case"*":++o,(t.charAt(o)==" "||t.charAt(o)=="*")&&++o;break;case"(":case")":a[a.length]={t:s===1?"t":c,v:c},++o;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(i=c;o<t.length&&"0123456789".indexOf(t.charAt(++o))>-1;)i+=t.charAt(o);a[a.length]={t:"D",v:i};break;case" ":a[a.length]={t:c,v:c},++o;break;case"$":a[a.length]={t:"t",v:"$"},++o;break;default:if(",$-+/():!^&'~{}<>=€acfijklopqrtuvwxzP".indexOf(c)===-1)throw new Error("unrecognized character "+c+" in "+t);a[a.length]={t:"t",v:c},++o;break}var g=0,w=0,R;for(o=a.length-1,h="t";o>=0;--o)switch(a[o].t){case"h":case"H":a[o].t=b,h="h",g<1&&(g=1);break;case"s":(R=a[o].v.match(/\.0+$/))&&(w=Math.max(w,R[0].length-1)),g<3&&(g=3);case"d":case"y":case"M":case"e":h=a[o].t;break;case"m":h==="s"&&(a[o].t="M",g<2&&(g=2));break;case"X":break;case"Z":g<1&&a[o].v.match(/[Hh]/)&&(g=1),g<2&&a[o].v.match(/[Mm]/)&&(g=2),g<3&&a[o].v.match(/[Ss]/)&&(g=3)}switch(g){case 0:break;case 1:u.u>=.5&&(u.u=0,++u.S),u.S>=60&&(u.S=0,++u.M),u.M>=60&&(u.M=0,++u.H);break;case 2:u.u>=.5&&(u.u=0,++u.S),u.S>=60&&(u.S=0,++u.M);break}var N="",M;for(o=0;o<a.length;++o)switch(a[o].t){case"t":case"T":case" ":case"D":break;case"X":a[o].v="",a[o].t=";";break;case"d":case"m":case"y":case"h":case"H":case"M":case"s":case"e":case"b":case"Z":a[o].v=SSF_write_date(a[o].t.charCodeAt(0),a[o].v,u,w),a[o].t="t";break;case"n":case"?":for(M=o+1;a[M]!=null&&((c=a[M].t)==="?"||c==="D"||(c===" "||c==="t")&&a[M+1]!=null&&(a[M+1].t==="?"||a[M+1].t==="t"&&a[M+1].v==="/")||a[o].t==="("&&(c===" "||c==="n"||c===")")||c==="t"&&(a[M].v==="/"||a[M].v===" "&&a[M+1]!=null&&a[M+1].t=="?"));)a[o].v+=a[M].v,a[M]={v:"",t:";"},++M;N+=a[o].v,o=M-1;break;case"G":a[o].t="t",a[o].v=SSF_general(r,e);break}var A="",I,y;if(N.length>0){N.charCodeAt(0)==40?(I=r<0&&N.charCodeAt(0)===45?-r:r,y=write_num("n",N,I)):(I=r<0&&s>1?-r:r,y=write_num("n",N,I),I<0&&a[0]&&a[0].t=="t"&&(y=y.substr(1),a[0].v="-"+a[0].v)),M=y.length-1;var j=a.length;for(o=0;o<a.length;++o)if(a[o]!=null&&a[o].t!="t"&&a[o].v.indexOf(".")>-1){j=o;break}var T=a.length;if(j===a.length&&y.indexOf("E")===-1){for(o=a.length-1;o>=0;--o)a[o]==null||"n?".indexOf(a[o].t)===-1||(M>=a[o].v.length-1?(M-=a[o].v.length,a[o].v=y.substr(M+1,a[o].v.length)):M<0?a[o].v="":(a[o].v=y.substr(0,M+1),M=-1),a[o].t="t",T=o);M>=0&&T<a.length&&(a[T].v=y.substr(0,M+1)+a[T].v)}else if(j!==a.length&&y.indexOf("E")===-1){for(M=y.indexOf(".")-1,o=j;o>=0;--o)if(!(a[o]==null||"n?".indexOf(a[o].t)===-1)){for(d=a[o].v.indexOf(".")>-1&&o===j?a[o].v.indexOf(".")-1:a[o].v.length-1,A=a[o].v.substr(d+1);d>=0;--d)M>=0&&(a[o].v.charAt(d)==="0"||a[o].v.charAt(d)==="#")&&(A=y.charAt(M--)+A);a[o].v=A,a[o].t="t",T=o}for(M>=0&&T<a.length&&(a[T].v=y.substr(0,M+1)+a[T].v),M=y.indexOf(".")+1,o=j;o<a.length;++o)if(!(a[o]==null||"n?(".indexOf(a[o].t)===-1&&o!==j)){for(d=a[o].v.indexOf(".")>-1&&o===j?a[o].v.indexOf(".")+1:0,A=a[o].v.substr(0,d);d<a[o].v.length;++d)M<y.length&&(A+=y.charAt(M++));a[o].v=A,a[o].t="t",T=o}}}for(o=0;o<a.length;++o)a[o]!=null&&"n?".indexOf(a[o].t)>-1&&(I=s>1&&r<0&&o>0&&a[o-1].v==="-"?-r:r,a[o].v=write_num(a[o].t,a[o].v,I),a[o].t="t");var U="";for(o=0;o!==a.length;++o)a[o]!=null&&(U+=a[o].v);return U}var cfregex2=/\[(=|>[=]?|<[>=]?)(-?\d+(?:\.\d*)?)\]/;function chkcond(t,r){if(r==null)return!1;var e=parseFloat(r[2]);switch(r[1]){case"=":if(t==e)return!0;break;case">":if(t>e)return!0;break;case"<":if(t<e)return!0;break;case"<>":if(t!=e)return!0;break;case">=":if(t>=e)return!0;break;case"<=":if(t<=e)return!0;break}return!1}function choose_fmt(t,r){var e=SSF_split_fmt(t),s=e.length,a=e[s-1].indexOf("@");if(s<4&&a>-1&&--s,e.length>4)throw new Error("cannot find right format for |"+e.join("|")+"|");if(typeof r!="number")return[4,e.length===4||a>-1?e[e.length-1]:"@"];switch(e.length){case 1:e=a>-1?["General","General","General",e[0]]:[e[0],e[0],e[0],"@"];break;case 2:e=a>-1?[e[0],e[0],e[0],e[1]]:[e[0],e[1],e[0],"@"];break;case 3:e=a>-1?[e[0],e[1],e[0],e[2]]:[e[0],e[1],e[2],"@"];break}var i=r>0?e[0]:r<0?e[1]:e[2];if(e[0].indexOf("[")===-1&&e[1].indexOf("[")===-1)return[s,i];if(e[0].match(/\[[=<>]/)!=null||e[1].match(/\[[=<>]/)!=null){var o=e[0].match(cfregex2),c=e[1].match(cfregex2);return chkcond(r,o)?[s,e[0]]:chkcond(r,c)?[s,e[1]]:[s,e[o!=null&&c!=null?2:1]]}return[s,i]}function SSF_format(t,r,e){e==null&&(e={});var s="";switch(typeof t){case"string":t=="m/d/yy"&&e.dateNF?s=e.dateNF:s=t;break;case"number":t==14&&e.dateNF?s=e.dateNF:s=(e.table!=null?e.table:table_fmt)[t],s==null&&(s=e.table&&e.table[SSF_default_map[t]]||table_fmt[SSF_default_map[t]]),s==null&&(s=SSF_default_str[t]||"General");break}if(SSF_isgeneral(s,0))return SSF_general(r,e);r instanceof Date&&(r=datenum_local(r,e.date1904));var a=choose_fmt(s,r);if(SSF_isgeneral(a[1]))return SSF_general(r,e);if(r===!0)r="TRUE";else if(r===!1)r="FALSE";else if(r===""||r==null)return"";return eval_fmt(a[1],r,e,a[0])}function SSF_load(t,r){if(typeof r!="number"){r=+r||-1;for(var e=0;e<392;++e){if(table_fmt[e]==null){r<0&&(r=e);continue}if(table_fmt[e]==t){r=e;break}}r<0&&(r=391)}return table_fmt[r]=t,r}function SSF_load_table(t){for(var r=0;r!=392;++r)t[r]!==void 0&&SSF_load(t[r],r)}function make_ssf(){table_fmt=SSF_init_table()}var dateNFregex=/[dD]+|[mM]+|[yYeE]+|[Hh]+|[Ss]+/g;function dateNF_regex(t){var r=typeof t=="number"?table_fmt[t]:t;return r=r.replace(dateNFregex,"(\\d+)"),new RegExp("^"+r+"$")}function dateNF_fix(t,r,e){var s=-1,a=-1,i=-1,o=-1,c=-1,h=-1;(r.match(dateNFregex)||[]).forEach(function(_,b){var v=parseInt(e[b+1],10);switch(_.toLowerCase().charAt(0)){case"y":s=v;break;case"d":i=v;break;case"h":o=v;break;case"s":h=v;break;case"m":o>=0?c=v:a=v;break}}),h>=0&&c==-1&&a>=0&&(c=a,a=-1);var u=(""+(s>=0?s:new Date().getFullYear())).slice(-4)+"-"+("00"+(a>=1?a:1)).slice(-2)+"-"+("00"+(i>=1?i:1)).slice(-2);u.length==7&&(u="0"+u),u.length==8&&(u="20"+u);var d=("00"+(o>=0?o:0)).slice(-2)+":"+("00"+(c>=0?c:0)).slice(-2)+":"+("00"+(h>=0?h:0)).slice(-2);return o==-1&&c==-1&&h==-1?u:s==-1&&a==-1&&i==-1?d:u+"T"+d}var CRC32=function(){var t={};t.version="1.2.0";function r(){for(var y=0,j=new Array(256),T=0;T!=256;++T)y=T,y=y&1?-306674912^y>>>1:y>>>1,y=y&1?-306674912^y>>>1:y>>>1,y=y&1?-306674912^y>>>1:y>>>1,y=y&1?-306674912^y>>>1:y>>>1,y=y&1?-306674912^y>>>1:y>>>1,y=y&1?-306674912^y>>>1:y>>>1,y=y&1?-306674912^y>>>1:y>>>1,y=y&1?-306674912^y>>>1:y>>>1,j[T]=y;return typeof Int32Array<"u"?new Int32Array(j):j}var e=r();function s(y){var j=0,T=0,U=0,F=typeof Int32Array<"u"?new Int32Array(4096):new Array(4096);for(U=0;U!=256;++U)F[U]=y[U];for(U=0;U!=256;++U)for(T=y[U],j=256+U;j<4096;j+=256)T=F[j]=T>>>8^y[T&255];var H=[];for(U=1;U!=16;++U)H[U-1]=typeof Int32Array<"u"?F.subarray(U*256,U*256+256):F.slice(U*256,U*256+256);return H}var a=s(e),i=a[0],o=a[1],c=a[2],h=a[3],u=a[4],d=a[5],_=a[6],b=a[7],v=a[8],E=a[9],x=a[10],g=a[11],w=a[12],R=a[13],N=a[14];function M(y,j){for(var T=j^-1,U=0,F=y.length;U<F;)T=T>>>8^e[(T^y.charCodeAt(U++))&255];return~T}function A(y,j){for(var T=j^-1,U=y.length-15,F=0;F<U;)T=N[y[F++]^T&255]^R[y[F++]^T>>8&255]^w[y[F++]^T>>16&255]^g[y[F++]^T>>>24]^x[y[F++]]^E[y[F++]]^v[y[F++]]^b[y[F++]]^_[y[F++]]^d[y[F++]]^u[y[F++]]^h[y[F++]]^c[y[F++]]^o[y[F++]]^i[y[F++]]^e[y[F++]];for(U+=15;F<U;)T=T>>>8^e[(T^y[F++])&255];return~T}function I(y,j){for(var T=j^-1,U=0,F=y.length,H=0,z=0;U<F;)H=y.charCodeAt(U++),H<128?T=T>>>8^e[(T^H)&255]:H<2048?(T=T>>>8^e[(T^(192|H>>6&31))&255],T=T>>>8^e[(T^(128|H&63))&255]):H>=55296&&H<57344?(H=(H&1023)+64,z=y.charCodeAt(U++)&1023,T=T>>>8^e[(T^(240|H>>8&7))&255],T=T>>>8^e[(T^(128|H>>2&63))&255],T=T>>>8^e[(T^(128|z>>6&15|(H&3)<<4))&255],T=T>>>8^e[(T^(128|z&63))&255]):(T=T>>>8^e[(T^(224|H>>12&15))&255],T=T>>>8^e[(T^(128|H>>6&63))&255],T=T>>>8^e[(T^(128|H&63))&255]);return~T}return t.table=e,t.bstr=M,t.buf=A,t.str=I,t}(),CFB=function(){var r={};r.version="1.2.1";function e(V,ie){for(var te=V.split("/"),ae=ie.split("/"),le=0,ce=0,Fe=Math.min(te.length,ae.length);le<Fe;++le){if(ce=te[le].length-ae[le].length)return ce;if(te[le]!=ae[le])return te[le]<ae[le]?-1:1}return te.length-ae.length}function s(V){if(V.charAt(V.length-1)=="/")return V.slice(0,-1).indexOf("/")===-1?V:s(V.slice(0,-1));var ie=V.lastIndexOf("/");return ie===-1?V:V.slice(0,ie+1)}function a(V){if(V.charAt(V.length-1)=="/")return a(V.slice(0,-1));var ie=V.lastIndexOf("/");return ie===-1?V:V.slice(ie+1)}function i(V,ie){typeof ie=="string"&&(ie=new Date(ie));var te=ie.getHours();te=te<<6|ie.getMinutes(),te=te<<5|ie.getSeconds()>>>1,V.write_shift(2,te);var ae=ie.getFullYear()-1980;ae=ae<<4|ie.getMonth()+1,ae=ae<<5|ie.getDate(),V.write_shift(2,ae)}function o(V){var ie=V.read_shift(2)&65535,te=V.read_shift(2)&65535,ae=new Date,le=te&31;te>>>=5;var ce=te&15;te>>>=4,ae.setMilliseconds(0),ae.setFullYear(te+1980),ae.setMonth(ce-1),ae.setDate(le);var Fe=ie&31;ie>>>=5;var He=ie&63;return ie>>>=6,ae.setHours(ie),ae.setMinutes(He),ae.setSeconds(Fe<<1),ae}function c(V){prep_blob(V,0);for(var ie={},te=0;V.l<=V.length-4;){var ae=V.read_shift(2),le=V.read_shift(2),ce=V.l+le,Fe={};switch(ae){case 21589:te=V.read_shift(1),te&1&&(Fe.mtime=V.read_shift(4)),le>5&&(te&2&&(Fe.atime=V.read_shift(4)),te&4&&(Fe.ctime=V.read_shift(4))),Fe.mtime&&(Fe.mt=new Date(Fe.mtime*1e3));break}V.l=ce,ie[ae]=Fe}return ie}var h;function u(){return h||(h={})}function d(V,ie){if(V[0]==80&&V[1]==75)return ut(V,ie);if((V[0]|32)==109&&(V[1]|32)==105)return ve(V,ie);if(V.length<512)throw new Error("CFB file size "+V.length+" < 512");var te=3,ae=512,le=0,ce=0,Fe=0,He=0,Oe=0,Me=[],Be=V.slice(0,512);prep_blob(Be,0);var Ze=_(Be);switch(te=Ze[0],te){case 3:ae=512;break;case 4:ae=4096;break;case 0:if(Ze[1]==0)return ut(V,ie);default:throw new Error("Major Version: Expected 3 or 4 saw "+te)}ae!==512&&(Be=V.slice(0,ae),prep_blob(Be,28));var rt=V.slice(0,ae);b(Be,te);var lt=Be.read_shift(4,"i");if(te===3&&lt!==0)throw new Error("# Directory Sectors: Expected 0 saw "+lt);Be.l+=4,Fe=Be.read_shift(4,"i"),Be.l+=4,Be.chk("00100000","Mini Stream Cutoff Size: "),He=Be.read_shift(4,"i"),le=Be.read_shift(4,"i"),Oe=Be.read_shift(4,"i"),ce=Be.read_shift(4,"i");for(var et=-1,dt=0;dt<109&&(et=Be.read_shift(4,"i"),!(et<0));++dt)Me[dt]=et;var mt=v(V,ae);g(Oe,ce,mt,ae,Me);var St=R(mt,Fe,Me,ae);St[Fe].name="!Directory",le>0&&He!==z&&(St[He].name="!MiniFAT"),St[Me[0]].name="!FAT",St.fat_addrs=Me,St.ssz=ae;var Rt={},Pt=[],Bt=[],Ut=[];N(Fe,St,mt,Pt,le,Rt,Bt,He),E(Bt,Ut,Pt),Pt.shift();var Wt={FileIndex:Bt,FullPaths:Ut};return ie&&ie.raw&&(Wt.raw={header:rt,sectors:mt}),Wt}function _(V){if(V[V.l]==80&&V[V.l+1]==75)return[0,0];V.chk(de,"Header Signature: "),V.l+=16;var ie=V.read_shift(2,"u");return[V.read_shift(2,"u"),ie]}function b(V,ie){var te=9;switch(V.l+=2,te=V.read_shift(2)){case 9:if(ie!=3)throw new Error("Sector Shift: Expected 9 saw "+te);break;case 12:if(ie!=4)throw new Error("Sector Shift: Expected 12 saw "+te);break;default:throw new Error("Sector Shift: Expected 9 or 12 saw "+te)}V.chk("0600","Mini Sector Shift: "),V.chk("000000000000","Reserved: ")}function v(V,ie){for(var te=Math.ceil(V.length/ie)-1,ae=[],le=1;le<te;++le)ae[le-1]=V.slice(le*ie,(le+1)*ie);return ae[te-1]=V.slice(te*ie),ae}function E(V,ie,te){for(var ae=0,le=0,ce=0,Fe=0,He=0,Oe=te.length,Me=[],Be=[];ae<Oe;++ae)Me[ae]=Be[ae]=ae,ie[ae]=te[ae];for(;He<Be.length;++He)ae=Be[He],le=V[ae].L,ce=V[ae].R,Fe=V[ae].C,Me[ae]===ae&&(le!==-1&&Me[le]!==le&&(Me[ae]=Me[le]),ce!==-1&&Me[ce]!==ce&&(Me[ae]=Me[ce])),Fe!==-1&&(Me[Fe]=ae),le!==-1&&ae!=Me[ae]&&(Me[le]=Me[ae],Be.lastIndexOf(le)<He&&Be.push(le)),ce!==-1&&ae!=Me[ae]&&(Me[ce]=Me[ae],Be.lastIndexOf(ce)<He&&Be.push(ce));for(ae=1;ae<Oe;++ae)Me[ae]===ae&&(ce!==-1&&Me[ce]!==ce?Me[ae]=Me[ce]:le!==-1&&Me[le]!==le&&(Me[ae]=Me[le]));for(ae=1;ae<Oe;++ae)if(V[ae].type!==0){if(He=ae,He!=Me[He])do He=Me[He],ie[ae]=ie[He]+"/"+ie[ae];while(He!==0&&Me[He]!==-1&&He!=Me[He]);Me[ae]=-1}for(ie[0]+="/",ae=1;ae<Oe;++ae)V[ae].type!==2&&(ie[ae]+="/")}function x(V,ie,te){for(var ae=V.start,le=V.size,ce=[],Fe=ae;te&&le>0&&Fe>=0;)ce.push(ie.slice(Fe*H,Fe*H+H)),le-=H,Fe=__readInt32LE(te,Fe*4);return ce.length===0?new_buf(0):bconcat(ce).slice(0,V.size)}function g(V,ie,te,ae,le){var ce=z;if(V===z){if(ie!==0)throw new Error("DIFAT chain shorter than expected")}else if(V!==-1){var Fe=te[V],He=(ae>>>2)-1;if(!Fe)return;for(var Oe=0;Oe<He&&(ce=__readInt32LE(Fe,Oe*4))!==z;++Oe)le.push(ce);g(__readInt32LE(Fe,ae-4),ie-1,te,ae,le)}}function w(V,ie,te,ae,le){var ce=[],Fe=[];le||(le=[]);var He=ae-1,Oe=0,Me=0;for(Oe=ie;Oe>=0;){le[Oe]=!0,ce[ce.length]=Oe,Fe.push(V[Oe]);var Be=te[Math.floor(Oe*4/ae)];if(Me=Oe*4&He,ae<4+Me)throw new Error("FAT boundary crossed: "+Oe+" 4 "+ae);if(!V[Be])break;Oe=__readInt32LE(V[Be],Me)}return{nodes:ce,data:__toBuffer([Fe])}}function R(V,ie,te,ae){var le=V.length,ce=[],Fe=[],He=[],Oe=[],Me=ae-1,Be=0,Ze=0,rt=0,lt=0;for(Be=0;Be<le;++Be)if(He=[],rt=Be+ie,rt>=le&&(rt-=le),!Fe[rt]){Oe=[];var et=[];for(Ze=rt;Ze>=0;){et[Ze]=!0,Fe[Ze]=!0,He[He.length]=Ze,Oe.push(V[Ze]);var dt=te[Math.floor(Ze*4/ae)];if(lt=Ze*4&Me,ae<4+lt)throw new Error("FAT boundary crossed: "+Ze+" 4 "+ae);if(!V[dt]||(Ze=__readInt32LE(V[dt],lt),et[Ze]))break}ce[rt]={nodes:He,data:__toBuffer([Oe])}}return ce}function N(V,ie,te,ae,le,ce,Fe,He){for(var Oe=0,Me=ae.length?2:0,Be=ie[V].data,Ze=0,rt=0,lt;Ze<Be.length;Ze+=128){var et=Be.slice(Ze,Ze+128);prep_blob(et,64),rt=et.read_shift(2),lt=__utf16le(et,0,rt-Me),ae.push(lt);var dt={name:lt,type:et.read_shift(1),color:et.read_shift(1),L:et.read_shift(4,"i"),R:et.read_shift(4,"i"),C:et.read_shift(4,"i"),clsid:et.read_shift(16),state:et.read_shift(4,"i"),start:0,size:0},mt=et.read_shift(2)+et.read_shift(2)+et.read_shift(2)+et.read_shift(2);mt!==0&&(dt.ct=M(et,et.l-8));var St=et.read_shift(2)+et.read_shift(2)+et.read_shift(2)+et.read_shift(2);St!==0&&(dt.mt=M(et,et.l-8)),dt.start=et.read_shift(4,"i"),dt.size=et.read_shift(4,"i"),dt.size<0&&dt.start<0&&(dt.size=dt.type=0,dt.start=z,dt.name=""),dt.type===5?(Oe=dt.start,le>0&&Oe!==z&&(ie[Oe].name="!StreamData")):dt.size>=4096?(dt.storage="fat",ie[dt.start]===void 0&&(ie[dt.start]=w(te,dt.start,ie.fat_addrs,ie.ssz)),ie[dt.start].name=dt.name,dt.content=ie[dt.start].data.slice(0,dt.size)):(dt.storage="minifat",dt.size<0?dt.size=0:Oe!==z&&dt.start!==z&&ie[Oe]&&(dt.content=x(dt,ie[Oe].data,(ie[He]||{}).data))),dt.content&&prep_blob(dt.content,0),ce[lt]=dt,Fe.push(dt)}}function M(V,ie){return new Date((__readUInt32LE(V,ie+4)/1e7*Math.pow(2,32)+__readUInt32LE(V,ie)/1e7-11644473600)*1e3)}function A(V,ie){return u(),d(h.readFileSync(V),ie)}function I(V,ie){var te=ie&&ie.type;switch(te||has_buf&&Buffer.isBuffer(V)&&(te="buffer"),te||"base64"){case"file":return A(V,ie);case"base64":return d(s2a(Base64_decode(V)),ie);case"binary":return d(s2a(V),ie)}return d(V,ie)}function y(V,ie){var te=ie||{},ae=te.root||"Root Entry";if(V.FullPaths||(V.FullPaths=[]),V.FileIndex||(V.FileIndex=[]),V.FullPaths.length!==V.FileIndex.length)throw new Error("inconsistent CFB structure");V.FullPaths.length===0&&(V.FullPaths[0]=ae+"/",V.FileIndex[0]={name:ae,type:5}),te.CLSID&&(V.FileIndex[0].clsid=te.CLSID),j(V)}function j(V){var ie="Sh33tJ5";if(!CFB.find(V,"/"+ie)){var te=new_buf(4);te[0]=55,te[1]=te[3]=50,te[2]=54,V.FileIndex.push({name:ie,type:2,content:te,size:4,L:69,R:69,C:69}),V.FullPaths.push(V.FullPaths[0]+ie),T(V)}}function T(V,ie){y(V);for(var te=!1,ae=!1,le=V.FullPaths.length-1;le>=0;--le){var ce=V.FileIndex[le];switch(ce.type){case 0:ae?te=!0:(V.FileIndex.pop(),V.FullPaths.pop());break;case 1:case 2:case 5:ae=!0,isNaN(ce.R*ce.L*ce.C)&&(te=!0),ce.R>-1&&ce.L>-1&&ce.R==ce.L&&(te=!0);break;default:te=!0;break}}if(!(!te&&!ie)){var Fe=new Date(1987,1,19),He=0,Oe=Object.create?Object.create(null):{},Me=[];for(le=0;le<V.FullPaths.length;++le)Oe[V.FullPaths[le]]=!0,V.FileIndex[le].type!==0&&Me.push([V.FullPaths[le],V.FileIndex[le]]);for(le=0;le<Me.length;++le){var Be=s(Me[le][0]);ae=Oe[Be],ae||(Me.push([Be,{name:a(Be).replace("/",""),type:1,clsid:ue,ct:Fe,mt:Fe,content:null}]),Oe[Be]=!0)}for(Me.sort(function(lt,et){return e(lt[0],et[0])}),V.FullPaths=[],V.FileIndex=[],le=0;le<Me.length;++le)V.FullPaths[le]=Me[le][0],V.FileIndex[le]=Me[le][1];for(le=0;le<Me.length;++le){var Ze=V.FileIndex[le],rt=V.FullPaths[le];if(Ze.name=a(rt).replace("/",""),Ze.L=Ze.R=Ze.C=-(Ze.color=1),Ze.size=Ze.content?Ze.content.length:0,Ze.start=0,Ze.clsid=Ze.clsid||ue,le===0)Ze.C=Me.length>1?1:-1,Ze.size=0,Ze.type=5;else if(rt.slice(-1)=="/"){for(He=le+1;He<Me.length&&s(V.FullPaths[He])!=rt;++He);for(Ze.C=He>=Me.length?-1:He,He=le+1;He<Me.length&&s(V.FullPaths[He])!=s(rt);++He);Ze.R=He>=Me.length?-1:He,Ze.type=1}else s(V.FullPaths[le+1]||"")==s(rt)&&(Ze.R=le+1),Ze.type=2}}}function U(V,ie){var te=ie||{};if(te.fileType=="mad")return we(V,te);switch(T(V),te.fileType){case"zip":return ye(V,te)}var ae=function(lt){for(var et=0,dt=0,mt=0;mt<lt.FileIndex.length;++mt){var St=lt.FileIndex[mt];if(St.content){var Rt=St.content.length;Rt>0&&(Rt<4096?et+=Rt+63>>6:dt+=Rt+511>>9)}}for(var Pt=lt.FullPaths.length+3>>2,Bt=et+7>>3,Ut=et+127>>7,Wt=Bt+dt+Pt+Ut,Dt=Wt+127>>7,Jt=Dt<=109?0:Math.ceil((Dt-109)/127);Wt+Dt+Jt+127>>7>Dt;)Jt=++Dt<=109?0:Math.ceil((Dt-109)/127);var Mt=[1,Jt,Dt,Ut,Pt,dt,et,0];return lt.FileIndex[0].size=et<<6,Mt[7]=(lt.FileIndex[0].start=Mt[0]+Mt[1]+Mt[2]+Mt[3]+Mt[4]+Mt[5])+(Mt[6]+7>>3),Mt}(V),le=new_buf(ae[7]<<9),ce=0,Fe=0;{for(ce=0;ce<8;++ce)le.write_shift(1,se[ce]);for(ce=0;ce<8;++ce)le.write_shift(2,0);for(le.write_shift(2,62),le.write_shift(2,3),le.write_shift(2,65534),le.write_shift(2,9),le.write_shift(2,6),ce=0;ce<3;++ce)le.write_shift(2,0);for(le.write_shift(4,0),le.write_shift(4,ae[2]),le.write_shift(4,ae[0]+ae[1]+ae[2]+ae[3]-1),le.write_shift(4,0),le.write_shift(4,4096),le.write_shift(4,ae[3]?ae[0]+ae[1]+ae[2]-1:z),le.write_shift(4,ae[3]),le.write_shift(-4,ae[1]?ae[0]-1:z),le.write_shift(4,ae[1]),ce=0;ce<109;++ce)le.write_shift(-4,ce<ae[2]?ae[1]+ce:-1)}if(ae[1])for(Fe=0;Fe<ae[1];++Fe){for(;ce<236+Fe*127;++ce)le.write_shift(-4,ce<ae[2]?ae[1]+ce:-1);le.write_shift(-4,Fe===ae[1]-1?z:Fe+1)}var He=function(lt){for(Fe+=lt;ce<Fe-1;++ce)le.write_shift(-4,ce+1);lt&&(++ce,le.write_shift(-4,z))};for(Fe=ce=0,Fe+=ae[1];ce<Fe;++ce)le.write_shift(-4,Z.DIFSECT);for(Fe+=ae[2];ce<Fe;++ce)le.write_shift(-4,Z.FATSECT);He(ae[3]),He(ae[4]);for(var Oe=0,Me=0,Be=V.FileIndex[0];Oe<V.FileIndex.length;++Oe)Be=V.FileIndex[Oe],Be.content&&(Me=Be.content.length,!(Me<4096)&&(Be.start=Fe,He(Me+511>>9)));for(He(ae[6]+7>>3);le.l&511;)le.write_shift(-4,Z.ENDOFCHAIN);for(Fe=ce=0,Oe=0;Oe<V.FileIndex.length;++Oe)Be=V.FileIndex[Oe],Be.content&&(Me=Be.content.length,!(!Me||Me>=4096)&&(Be.start=Fe,He(Me+63>>6)));for(;le.l&511;)le.write_shift(-4,Z.ENDOFCHAIN);for(ce=0;ce<ae[4]<<2;++ce){var Ze=V.FullPaths[ce];if(!Ze||Ze.length===0){for(Oe=0;Oe<17;++Oe)le.write_shift(4,0);for(Oe=0;Oe<3;++Oe)le.write_shift(4,-1);for(Oe=0;Oe<12;++Oe)le.write_shift(4,0);continue}Be=V.FileIndex[ce],ce===0&&(Be.start=Be.size?Be.start-1:z);var rt=ce===0&&te.root||Be.name;if(Me=2*(rt.length+1),le.write_shift(64,rt,"utf16le"),le.write_shift(2,Me),le.write_shift(1,Be.type),le.write_shift(1,Be.color),le.write_shift(-4,Be.L),le.write_shift(-4,Be.R),le.write_shift(-4,Be.C),Be.clsid)le.write_shift(16,Be.clsid,"hex");else for(Oe=0;Oe<4;++Oe)le.write_shift(4,0);le.write_shift(4,Be.state||0),le.write_shift(4,0),le.write_shift(4,0),le.write_shift(4,0),le.write_shift(4,0),le.write_shift(4,Be.start),le.write_shift(4,Be.size),le.write_shift(4,0)}for(ce=1;ce<V.FileIndex.length;++ce)if(Be=V.FileIndex[ce],Be.size>=4096)if(le.l=Be.start+1<<9,has_buf&&Buffer.isBuffer(Be.content))Be.content.copy(le,le.l,0,Be.size),le.l+=Be.size+511&-512;else{for(Oe=0;Oe<Be.size;++Oe)le.write_shift(1,Be.content[Oe]);for(;Oe&511;++Oe)le.write_shift(1,0)}for(ce=1;ce<V.FileIndex.length;++ce)if(Be=V.FileIndex[ce],Be.size>0&&Be.size<4096)if(has_buf&&Buffer.isBuffer(Be.content))Be.content.copy(le,le.l,0,Be.size),le.l+=Be.size+63&-64;else{for(Oe=0;Oe<Be.size;++Oe)le.write_shift(1,Be.content[Oe]);for(;Oe&63;++Oe)le.write_shift(1,0)}if(has_buf)le.l=le.length;else for(;le.l<le.length;)le.write_shift(1,0);return le}function F(V,ie){var te=V.FullPaths.map(function(Oe){return Oe.toUpperCase()}),ae=te.map(function(Oe){var Me=Oe.split("/");return Me[Me.length-(Oe.slice(-1)=="/"?2:1)]}),le=!1;ie.charCodeAt(0)===47?(le=!0,ie=te[0].slice(0,-1)+ie):le=ie.indexOf("/")!==-1;var ce=ie.toUpperCase(),Fe=le===!0?te.indexOf(ce):ae.indexOf(ce);if(Fe!==-1)return V.FileIndex[Fe];var He=!ce.match(chr1);for(ce=ce.replace(chr0,""),He&&(ce=ce.replace(chr1,"!")),Fe=0;Fe<te.length;++Fe)if((He?te[Fe].replace(chr1,"!"):te[Fe]).replace(chr0,"")==ce||(He?ae[Fe].replace(chr1,"!"):ae[Fe]).replace(chr0,"")==ce)return V.FileIndex[Fe];return null}var H=64,z=-2,de="d0cf11e0a1b11ae1",se=[208,207,17,224,161,177,26,225],ue="00000000000000000000000000000000",Z={MAXREGSECT:-6,DIFSECT:-4,FATSECT:-3,ENDOFCHAIN:z,FREESECT:-1,HEADER_SIGNATURE:de,HEADER_MINOR_VERSION:"3e00",MAXREGSID:-6,NOSTREAM:-1,HEADER_CLSID:ue,EntryTypes:["unknown","storage","stream","lockbytes","property","root"]};function ge(V,ie,te){u();var ae=U(V,te);h.writeFileSync(ie,ae)}function re(V){for(var ie=new Array(V.length),te=0;te<V.length;++te)ie[te]=String.fromCharCode(V[te]);return ie.join("")}function oe(V,ie){var te=U(V,ie);switch(ie&&ie.type||"buffer"){case"file":return u(),h.writeFileSync(ie.filename,te),te;case"binary":return typeof te=="string"?te:re(te);case"base64":return Base64_encode(typeof te=="string"?te:re(te));case"buffer":if(has_buf)return Buffer.isBuffer(te)?te:Buffer_from(te);case"array":return typeof te=="string"?s2a(te):te}return te}var be;function L(V){try{var ie=V.InflateRaw,te=new ie;if(te._processChunk(new Uint8Array([3,0]),te._finishFlushFlag),te.bytesRead)be=V;else throw new Error("zlib does not expose bytesRead")}catch(ae){console.error("cannot use native zlib: "+(ae.message||ae))}}function S(V,ie){if(!be)return je(V,ie);var te=be.InflateRaw,ae=new te,le=ae._processChunk(V.slice(V.l),ae._finishFlushFlag);return V.l+=ae.bytesRead,le}function C(V){return be?be.deflateRawSync(V):ht(V)}var P=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],D=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258],B=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577];function G(V){var ie=(V<<1|V<<11)&139536|(V<<5|V<<15)&558144;return(ie>>16|ie>>8|ie)&255}for(var J=typeof Uint8Array<"u",Y=J?new Uint8Array(256):[],me=0;me<256;++me)Y[me]=G(me);function Ee(V,ie){var te=Y[V&255];return ie<=8?te>>>8-ie:(te=te<<8|Y[V>>8&255],ie<=16?te>>>16-ie:(te=te<<8|Y[V>>16&255],te>>>24-ie))}function Re(V,ie){var te=ie&7,ae=ie>>>3;return(V[ae]|(te<=6?0:V[ae+1]<<8))>>>te&3}function Ne(V,ie){var te=ie&7,ae=ie>>>3;return(V[ae]|(te<=5?0:V[ae+1]<<8))>>>te&7}function he(V,ie){var te=ie&7,ae=ie>>>3;return(V[ae]|(te<=4?0:V[ae+1]<<8))>>>te&15}function pe(V,ie){var te=ie&7,ae=ie>>>3;return(V[ae]|(te<=3?0:V[ae+1]<<8))>>>te&31}function fe(V,ie){var te=ie&7,ae=ie>>>3;return(V[ae]|(te<=1?0:V[ae+1]<<8))>>>te&127}function W(V,ie,te){var ae=ie&7,le=ie>>>3,ce=(1<<te)-1,Fe=V[le]>>>ae;return te<8-ae||(Fe|=V[le+1]<<8-ae,te<16-ae)||(Fe|=V[le+2]<<16-ae,te<24-ae)||(Fe|=V[le+3]<<24-ae),Fe&ce}function Q(V,ie,te){var ae=ie&7,le=ie>>>3;return ae<=5?V[le]|=(te&7)<<ae:(V[le]|=te<<ae&255,V[le+1]=(te&7)>>8-ae),ie+3}function xe(V,ie,te){var ae=ie&7,le=ie>>>3;return te=(te&1)<<ae,V[le]|=te,ie+1}function Se(V,ie,te){var ae=ie&7,le=ie>>>3;return te<<=ae,V[le]|=te&255,te>>>=8,V[le+1]=te,ie+8}function Ce(V,ie,te){var ae=ie&7,le=ie>>>3;return te<<=ae,V[le]|=te&255,te>>>=8,V[le+1]=te&255,V[le+2]=te>>>8,ie+16}function Le(V,ie){var te=V.length,ae=2*te>ie?2*te:ie+5,le=0;if(te>=ie)return V;if(has_buf){var ce=new_unsafe_buf(ae);if(V.copy)V.copy(ce);else for(;le<V.length;++le)ce[le]=V[le];return ce}else if(J){var Fe=new Uint8Array(ae);if(Fe.set)Fe.set(V);else for(;le<te;++le)Fe[le]=V[le];return Fe}return V.length=ae,V}function De(V){for(var ie=new Array(V),te=0;te<V;++te)ie[te]=0;return ie}function _e(V,ie,te){var ae=1,le=0,ce=0,Fe=0,He=0,Oe=V.length,Me=J?new Uint16Array(32):De(32);for(ce=0;ce<32;++ce)Me[ce]=0;for(ce=Oe;ce<te;++ce)V[ce]=0;Oe=V.length;var Be=J?new Uint16Array(Oe):De(Oe);for(ce=0;ce<Oe;++ce)Me[le=V[ce]]++,ae<le&&(ae=le),Be[ce]=0;for(Me[0]=0,ce=1;ce<=ae;++ce)Me[ce+16]=He=He+Me[ce-1]<<1;for(ce=0;ce<Oe;++ce)He=V[ce],He!=0&&(Be[ce]=Me[He+16]++);var Ze=0;for(ce=0;ce<Oe;++ce)if(Ze=V[ce],Ze!=0)for(He=Ee(Be[ce],ae)>>ae-Ze,Fe=(1<<ae+4-Ze)-1;Fe>=0;--Fe)ie[He|Fe<<Ze]=Ze&15|ce<<4;return ae}var Ge=J?new Uint16Array(512):De(512),Ye=J?new Uint16Array(32):De(32);if(!J){for(var ot=0;ot<512;++ot)Ge[ot]=0;for(ot=0;ot<32;++ot)Ye[ot]=0}(function(){for(var V=[],ie=0;ie<32;ie++)V.push(5);_e(V,Ye,32);var te=[];for(ie=0;ie<=143;ie++)te.push(8);for(;ie<=255;ie++)te.push(9);for(;ie<=279;ie++)te.push(7);for(;ie<=287;ie++)te.push(8);_e(te,Ge,288)})();var st=function(){for(var ie=J?new Uint8Array(32768):[],te=0,ae=0;te<B.length-1;++te)for(;ae<B[te+1];++ae)ie[ae]=te;for(;ae<32768;++ae)ie[ae]=29;var le=J?new Uint8Array(259):[];for(te=0,ae=0;te<D.length-1;++te)for(;ae<D[te+1];++ae)le[ae]=te;function ce(He,Oe){for(var Me=0;Me<He.length;){var Be=Math.min(65535,He.length-Me),Ze=Me+Be==He.length;for(Oe.write_shift(1,+Ze),Oe.write_shift(2,Be),Oe.write_shift(2,~Be&65535);Be-- >0;)Oe[Oe.l++]=He[Me++]}return Oe.l}function Fe(He,Oe){for(var Me=0,Be=0,Ze=J?new Uint16Array(32768):[];Be<He.length;){var rt=Math.min(65535,He.length-Be);if(rt<10){for(Me=Q(Oe,Me,+(Be+rt==He.length)),Me&7&&(Me+=8-(Me&7)),Oe.l=Me/8|0,Oe.write_shift(2,rt),Oe.write_shift(2,~rt&65535);rt-- >0;)Oe[Oe.l++]=He[Be++];Me=Oe.l*8;continue}Me=Q(Oe,Me,+(Be+rt==He.length)+2);for(var lt=0;rt-- >0;){var et=He[Be];lt=(lt<<5^et)&32767;var dt=-1,mt=0;if((dt=Ze[lt])&&(dt|=Be&-32768,dt>Be&&(dt-=32768),dt<Be))for(;He[dt+mt]==He[Be+mt]&&mt<250;)++mt;if(mt>2){et=le[mt],et<=22?Me=Se(Oe,Me,Y[et+1]>>1)-1:(Se(Oe,Me,3),Me+=5,Se(Oe,Me,Y[et-23]>>5),Me+=3);var St=et<8?0:et-4>>2;St>0&&(Ce(Oe,Me,mt-D[et]),Me+=St),et=ie[Be-dt],Me=Se(Oe,Me,Y[et]>>3),Me-=3;var Rt=et<4?0:et-2>>1;Rt>0&&(Ce(Oe,Me,Be-dt-B[et]),Me+=Rt);for(var Pt=0;Pt<mt;++Pt)Ze[lt]=Be&32767,lt=(lt<<5^He[Be])&32767,++Be;rt-=mt-1}else et<=143?et=et+48:Me=xe(Oe,Me,1),Me=Se(Oe,Me,Y[et]),Ze[lt]=Be&32767,++Be}Me=Se(Oe,Me,0)-1}return Oe.l=(Me+7)/8|0,Oe.l}return function(Oe,Me){return Oe.length<8?ce(Oe,Me):Fe(Oe,Me)}}();function ht(V){var ie=new_buf(50+Math.floor(V.length*1.1)),te=st(V,ie);return ie.slice(0,te)}var Je=J?new Uint16Array(32768):De(32768),nt=J?new Uint16Array(32768):De(32768),ct=J?new Uint16Array(128):De(128),ft=1,pt=1;function Xe(V,ie){var te=pe(V,ie)+257;ie+=5;var ae=pe(V,ie)+1;ie+=5;var le=he(V,ie)+4;ie+=4;for(var ce=0,Fe=J?new Uint8Array(19):De(19),He=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Oe=1,Me=J?new Uint8Array(8):De(8),Be=J?new Uint8Array(8):De(8),Ze=Fe.length,rt=0;rt<le;++rt)Fe[P[rt]]=ce=Ne(V,ie),Oe<ce&&(Oe=ce),Me[ce]++,ie+=3;var lt=0;for(Me[0]=0,rt=1;rt<=Oe;++rt)Be[rt]=lt=lt+Me[rt-1]<<1;for(rt=0;rt<Ze;++rt)(lt=Fe[rt])!=0&&(He[rt]=Be[lt]++);var et=0;for(rt=0;rt<Ze;++rt)if(et=Fe[rt],et!=0){lt=Y[He[rt]]>>8-et;for(var dt=(1<<7-et)-1;dt>=0;--dt)ct[lt|dt<<et]=et&7|rt<<3}var mt=[];for(Oe=1;mt.length<te+ae;)switch(lt=ct[fe(V,ie)],ie+=lt&7,lt>>>=3){case 16:for(ce=3+Re(V,ie),ie+=2,lt=mt[mt.length-1];ce-- >0;)mt.push(lt);break;case 17:for(ce=3+Ne(V,ie),ie+=3;ce-- >0;)mt.push(0);break;case 18:for(ce=11+fe(V,ie),ie+=7;ce-- >0;)mt.push(0);break;default:mt.push(lt),Oe<lt&&(Oe=lt);break}var St=mt.slice(0,te),Rt=mt.slice(te);for(rt=te;rt<286;++rt)St[rt]=0;for(rt=ae;rt<30;++rt)Rt[rt]=0;return ft=_e(St,Je,286),pt=_e(Rt,nt,30),ie}function Pe(V,ie){if(V[0]==3&&!(V[1]&3))return[new_raw_buf(ie),2];for(var te=0,ae=0,le=new_unsafe_buf(ie||1<<18),ce=0,Fe=le.length>>>0,He=0,Oe=0;!(ae&1);){if(ae=Ne(V,te),te+=3,ae>>>1)ae>>1==1?(He=9,Oe=5):(te=Xe(V,te),He=ft,Oe=pt);else{te&7&&(te+=8-(te&7));var Me=V[te>>>3]|V[(te>>>3)+1]<<8;if(te+=32,Me>0)for(!ie&&Fe<ce+Me&&(le=Le(le,ce+Me),Fe=le.length);Me-- >0;)le[ce++]=V[te>>>3],te+=8;continue}for(;;){!ie&&Fe<ce+32767&&(le=Le(le,ce+32767),Fe=le.length);var Be=W(V,te,He),Ze=ae>>>1==1?Ge[Be]:Je[Be];if(te+=Ze&15,Ze>>>=4,!(Ze>>>8&255))le[ce++]=Ze;else{if(Ze==256)break;Ze-=257;var rt=Ze<8?0:Ze-4>>2;rt>5&&(rt=0);var lt=ce+D[Ze];rt>0&&(lt+=W(V,te,rt),te+=rt),Be=W(V,te,Oe),Ze=ae>>>1==1?Ye[Be]:nt[Be],te+=Ze&15,Ze>>>=4;var et=Ze<4?0:Ze-2>>1,dt=B[Ze];for(et>0&&(dt+=W(V,te,et),te+=et),!ie&&Fe<lt&&(le=Le(le,lt+100),Fe=le.length);ce<lt;)le[ce]=le[ce-dt],++ce}}}return ie?[le,te+7>>>3]:[le.slice(0,ce),te+7>>>3]}function je(V,ie){var te=V.slice(V.l||0),ae=Pe(te,ie);return V.l+=ae[1],ae[0]}function Qe(V,ie){if(V)typeof console<"u"&&console.error(ie);else throw new Error(ie)}function ut(V,ie){var te=V;prep_blob(te,0);var ae=[],le=[],ce={FileIndex:ae,FullPaths:le};y(ce,{root:ie.root});for(var Fe=te.length-4;(te[Fe]!=80||te[Fe+1]!=75||te[Fe+2]!=5||te[Fe+3]!=6)&&Fe>=0;)--Fe;te.l=Fe+4,te.l+=4;var He=te.read_shift(2);te.l+=6;var Oe=te.read_shift(4);for(te.l=Oe,Fe=0;Fe<He;++Fe){te.l+=20;var Me=te.read_shift(4),Be=te.read_shift(4),Ze=te.read_shift(2),rt=te.read_shift(2),lt=te.read_shift(2);te.l+=8;var et=te.read_shift(4),dt=c(te.slice(te.l+Ze,te.l+Ze+rt));te.l+=Ze+rt+lt;var mt=te.l;te.l=et+4,K(te,Me,Be,ce,dt),te.l=mt}return ce}function K(V,ie,te,ae,le){V.l+=2;var ce=V.read_shift(2),Fe=V.read_shift(2),He=o(V);if(ce&8257)throw new Error("Unsupported ZIP encryption");for(var Oe=V.read_shift(4),Me=V.read_shift(4),Be=V.read_shift(4),Ze=V.read_shift(2),rt=V.read_shift(2),lt="",et=0;et<Ze;++et)lt+=String.fromCharCode(V[V.l++]);if(rt){var dt=c(V.slice(V.l,V.l+rt));(dt[21589]||{}).mt&&(He=dt[21589].mt),((le||{})[21589]||{}).mt&&(He=le[21589].mt)}V.l+=rt;var mt=V.slice(V.l,V.l+Me);switch(Fe){case 8:mt=S(V,Be);break;case 0:break;default:throw new Error("Unsupported ZIP Compression method "+Fe)}var St=!1;ce&8&&(Oe=V.read_shift(4),Oe==134695760&&(Oe=V.read_shift(4),St=!0),Me=V.read_shift(4),Be=V.read_shift(4)),Me!=ie&&Qe(St,"Bad compressed size: "+ie+" != "+Me),Be!=te&&Qe(St,"Bad uncompressed size: "+te+" != "+Be),We(ae,lt,mt,{unsafe:!0,mt:He})}function ye(V,ie){var te=ie||{},ae=[],le=[],ce=new_buf(1),Fe=te.compression?8:0,He=0,Oe=0,Me=0,Be=0,Ze=0,rt=V.FullPaths[0],lt=rt,et=V.FileIndex[0],dt=[],mt=0;for(Oe=1;Oe<V.FullPaths.length;++Oe)if(lt=V.FullPaths[Oe].slice(rt.length),et=V.FileIndex[Oe],!(!et.size||!et.content||lt=="Sh33tJ5")){var St=Be,Rt=new_buf(lt.length);for(Me=0;Me<lt.length;++Me)Rt.write_shift(1,lt.charCodeAt(Me)&127);Rt=Rt.slice(0,Rt.l),dt[Ze]=CRC32.buf(et.content,0);var Pt=et.content;Fe==8&&(Pt=C(Pt)),ce=new_buf(30),ce.write_shift(4,67324752),ce.write_shift(2,20),ce.write_shift(2,He),ce.write_shift(2,Fe),et.mt?i(ce,et.mt):ce.write_shift(4,0),ce.write_shift(-4,dt[Ze]),ce.write_shift(4,Pt.length),ce.write_shift(4,et.content.length),ce.write_shift(2,Rt.length),ce.write_shift(2,0),Be+=ce.length,ae.push(ce),Be+=Rt.length,ae.push(Rt),Be+=Pt.length,ae.push(Pt),ce=new_buf(46),ce.write_shift(4,33639248),ce.write_shift(2,0),ce.write_shift(2,20),ce.write_shift(2,He),ce.write_shift(2,Fe),ce.write_shift(4,0),ce.write_shift(-4,dt[Ze]),ce.write_shift(4,Pt.length),ce.write_shift(4,et.content.length),ce.write_shift(2,Rt.length),ce.write_shift(2,0),ce.write_shift(2,0),ce.write_shift(2,0),ce.write_shift(2,0),ce.write_shift(4,0),ce.write_shift(4,St),mt+=ce.l,le.push(ce),mt+=Rt.length,le.push(Rt),++Ze}return ce=new_buf(22),ce.write_shift(4,101010256),ce.write_shift(2,0),ce.write_shift(2,0),ce.write_shift(2,Ze),ce.write_shift(2,Ze),ce.write_shift(4,mt),ce.write_shift(4,Be),ce.write_shift(2,0),bconcat([bconcat(ae),bconcat(le),ce])}var Ue={htm:"text/html",xml:"text/xml",gif:"image/gif",jpg:"image/jpeg",png:"image/png",mso:"application/x-mso",thmx:"application/vnd.ms-officetheme",sh33tj5:"application/octet-stream"};function ze(V,ie){if(V.ctype)return V.ctype;var te=V.name||"",ae=te.match(/\.([^\.]+)$/);return ae&&Ue[ae[1]]||ie&&(ae=(te=ie).match(/[\.\\]([^\.\\])+$/),ae&&Ue[ae[1]])?Ue[ae[1]]:"application/octet-stream"}function Ke(V){for(var ie=Base64_encode(V),te=[],ae=0;ae<ie.length;ae+=76)te.push(ie.slice(ae,ae+76));return te.join(`\r
`)+`\r
`}function Ve(V){var ie=V.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF=]/g,function(Me){var Be=Me.charCodeAt(0).toString(16).toUpperCase();return"="+(Be.length==1?"0"+Be:Be)});ie=ie.replace(/ $/mg,"=20").replace(/\t$/mg,"=09"),ie.charAt(0)==`
`&&(ie="=0D"+ie.slice(1)),ie=ie.replace(/\r(?!\n)/mg,"=0D").replace(/\n\n/mg,`
=0A`).replace(/([^\r\n])\n/mg,"$1=0A");for(var te=[],ae=ie.split(`\r
`),le=0;le<ae.length;++le){var ce=ae[le];if(ce.length==0){te.push("");continue}for(var Fe=0;Fe<ce.length;){var He=76,Oe=ce.slice(Fe,Fe+He);Oe.charAt(He-1)=="="?He--:Oe.charAt(He-2)=="="?He-=2:Oe.charAt(He-3)=="="&&(He-=3),Oe=ce.slice(Fe,Fe+He),Fe+=He,Fe<ce.length&&(Oe+="="),te.push(Oe)}}return te.join(`\r
`)}function ee(V){for(var ie=[],te=0;te<V.length;++te){for(var ae=V[te];te<=V.length&&ae.charAt(ae.length-1)=="=";)ae=ae.slice(0,ae.length-1)+V[++te];ie.push(ae)}for(var le=0;le<ie.length;++le)ie[le]=ie[le].replace(/[=][0-9A-Fa-f]{2}/g,function(ce){return String.fromCharCode(parseInt(ce.slice(1),16))});return s2a(ie.join(`\r
`))}function ne(V,ie,te){for(var ae="",le="",ce="",Fe,He=0;He<10;++He){var Oe=ie[He];if(!Oe||Oe.match(/^\s*$/))break;var Me=Oe.match(/^(.*?):\s*([^\s].*)$/);if(Me)switch(Me[1].toLowerCase()){case"content-location":ae=Me[2].trim();break;case"content-type":ce=Me[2].trim();break;case"content-transfer-encoding":le=Me[2].trim();break}}switch(++He,le.toLowerCase()){case"base64":Fe=s2a(Base64_decode(ie.slice(He).join("")));break;case"quoted-printable":Fe=ee(ie.slice(He));break;default:throw new Error("Unsupported Content-Transfer-Encoding "+le)}var Be=We(V,ae.slice(te.length),Fe,{unsafe:!0});ce&&(Be.ctype=ce)}function ve(V,ie){if(re(V.slice(0,13)).toLowerCase()!="mime-version:")throw new Error("Unsupported MAD header");var te=ie&&ie.root||"",ae=(has_buf&&Buffer.isBuffer(V)?V.toString("binary"):re(V)).split(`\r
`),le=0,ce="";for(le=0;le<ae.length;++le)if(ce=ae[le],!!/^Content-Location:/i.test(ce)&&(ce=ce.slice(ce.indexOf("file")),te||(te=ce.slice(0,ce.lastIndexOf("/")+1)),ce.slice(0,te.length)!=te))for(;te.length>0&&(te=te.slice(0,te.length-1),te=te.slice(0,te.lastIndexOf("/")+1),ce.slice(0,te.length)!=te););var Fe=(ae[1]||"").match(/boundary="(.*?)"/);if(!Fe)throw new Error("MAD cannot find boundary");var He="--"+(Fe[1]||""),Oe=[],Me=[],Be={FileIndex:Oe,FullPaths:Me};y(Be);var Ze,rt=0;for(le=0;le<ae.length;++le){var lt=ae[le];lt!==He&&lt!==He+"--"||(rt++&&ne(Be,ae.slice(Ze,le),te),Ze=le)}return Be}function we(V,ie){var te=ie||{},ae=te.boundary||"SheetJS";ae="------="+ae;for(var le=["MIME-Version: 1.0",'Content-Type: multipart/related; boundary="'+ae.slice(2)+'"',"","",""],ce=V.FullPaths[0],Fe=ce,He=V.FileIndex[0],Oe=1;Oe<V.FullPaths.length;++Oe)if(Fe=V.FullPaths[Oe].slice(ce.length),He=V.FileIndex[Oe],!(!He.size||!He.content||Fe=="Sh33tJ5")){Fe=Fe.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF]/g,function(mt){return"_x"+mt.charCodeAt(0).toString(16)+"_"}).replace(/[\u0080-\uFFFF]/g,function(mt){return"_u"+mt.charCodeAt(0).toString(16)+"_"});for(var Me=He.content,Be=has_buf&&Buffer.isBuffer(Me)?Me.toString("binary"):re(Me),Ze=0,rt=Math.min(1024,Be.length),lt=0,et=0;et<=rt;++et)(lt=Be.charCodeAt(et))>=32&&lt<128&&++Ze;var dt=Ze>=rt*4/5;le.push(ae),le.push("Content-Location: "+(te.root||"file:///C:/SheetJS/")+Fe),le.push("Content-Transfer-Encoding: "+(dt?"quoted-printable":"base64")),le.push("Content-Type: "+ze(He,Fe)),le.push(""),le.push(dt?Ve(Be):Ke(Be))}return le.push(ae+`--\r
`),le.join(`\r
`)}function Te(V){var ie={};return y(ie,V),ie}function We(V,ie,te,ae){var le=ae&&ae.unsafe;le||y(V);var ce=!le&&CFB.find(V,ie);if(!ce){var Fe=V.FullPaths[0];ie.slice(0,Fe.length)==Fe?Fe=ie:(Fe.slice(-1)!="/"&&(Fe+="/"),Fe=(Fe+ie).replace("//","/")),ce={name:a(ie),type:2},V.FileIndex.push(ce),V.FullPaths.push(Fe),le||CFB.utils.cfb_gc(V)}return ce.content=te,ce.size=te?te.length:0,ae&&(ae.CLSID&&(ce.clsid=ae.CLSID),ae.mt&&(ce.mt=ae.mt),ae.ct&&(ce.ct=ae.ct)),ce}function $e(V,ie){y(V);var te=CFB.find(V,ie);if(te){for(var ae=0;ae<V.FileIndex.length;++ae)if(V.FileIndex[ae]==te)return V.FileIndex.splice(ae,1),V.FullPaths.splice(ae,1),!0}return!1}function tt(V,ie,te){y(V);var ae=CFB.find(V,ie);if(ae){for(var le=0;le<V.FileIndex.length;++le)if(V.FileIndex[le]==ae)return V.FileIndex[le].name=a(te),V.FullPaths[le]=te,!0}return!1}function at(V){T(V,!0)}return r.find=F,r.read=I,r.parse=d,r.write=oe,r.writeFile=ge,r.utils={cfb_new:Te,cfb_add:We,cfb_del:$e,cfb_mov:tt,cfb_gc:at,ReadShift,CheckField,prep_blob,bconcat,use_zlib:L,_deflateRaw:ht,_inflateRaw:je,consts:Z},r}();function blobify(t){return typeof t=="string"?s2ab(t):Array.isArray(t)?a2u(t):t}function write_dl(t,r,e){if(typeof Deno<"u"){if(e&&typeof r=="string")switch(e){case"utf8":r=new TextEncoder(e).encode(r);break;case"binary":r=s2ab(r);break;default:throw new Error("Unsupported encoding "+e)}return Deno.writeFileSync(t,r)}var s=e=="utf8"?utf8write(r):r;if(typeof IE_SaveFile<"u")return IE_SaveFile(s,t);if(typeof Blob<"u"){var a=new Blob([blobify(s)],{type:"application/octet-stream"});if(typeof navigator<"u"&&navigator.msSaveBlob)return navigator.msSaveBlob(a,t);if(typeof saveAs<"u")return saveAs(a,t);if(typeof URL<"u"&&typeof document<"u"&&document.createElement&&URL.createObjectURL){var i=URL.createObjectURL(a);if(typeof chrome=="object"&&typeof(chrome.downloads||{}).download=="function")return URL.revokeObjectURL&&typeof setTimeout<"u"&&setTimeout(function(){URL.revokeObjectURL(i)},6e4),chrome.downloads.download({url:i,filename:t,saveAs:!0});var o=document.createElement("a");if(o.download!=null)return o.download=t,o.href=i,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL&&typeof setTimeout<"u"&&setTimeout(function(){URL.revokeObjectURL(i)},6e4),i}}if(typeof $<"u"&&typeof File<"u"&&typeof Folder<"u")try{var c=File(t);return c.open("w"),c.encoding="binary",Array.isArray(r)&&(r=a2s(r)),c.write(r),c.close(),r}catch(h){if(!h.message||!h.message.match(/onstruct/))throw h}throw new Error("cannot save file "+t)}function keys(t){for(var r=Object.keys(t),e=[],s=0;s<r.length;++s)Object.prototype.hasOwnProperty.call(t,r[s])&&e.push(r[s]);return e}function evert_key(t,r){for(var e=[],s=keys(t),a=0;a!==s.length;++a)e[t[s[a]][r]]==null&&(e[t[s[a]][r]]=s[a]);return e}function evert(t){for(var r=[],e=keys(t),s=0;s!==e.length;++s)r[t[e[s]]]=e[s];return r}function evert_num(t){for(var r=[],e=keys(t),s=0;s!==e.length;++s)r[t[e[s]]]=parseInt(e[s],10);return r}function evert_arr(t){for(var r=[],e=keys(t),s=0;s!==e.length;++s)r[t[e[s]]]==null&&(r[t[e[s]]]=[]),r[t[e[s]]].push(e[s]);return r}var basedate=new Date(1899,11,30,0,0,0);function datenum(t,r){var e=t.getTime(),s=basedate.getTime()+(t.getTimezoneOffset()-basedate.getTimezoneOffset())*6e4;return(e-s)/(24*60*60*1e3)}var refdate=new Date,dnthresh=basedate.getTime()+(refdate.getTimezoneOffset()-basedate.getTimezoneOffset())*6e4,refoffset=refdate.getTimezoneOffset();function numdate(t){var r=new Date;return r.setTime(t*24*60*60*1e3+dnthresh),r.getTimezoneOffset()!==refoffset&&r.setTime(r.getTime()+(r.getTimezoneOffset()-refoffset)*6e4),r}var good_pd_date_1=new Date("2017-02-19T19:06:09.000Z"),good_pd_date=isNaN(good_pd_date_1.getFullYear())?new Date("2/19/17"):good_pd_date_1,good_pd=good_pd_date.getFullYear()==2017;function parseDate(t,r){var e=new Date(t);if(good_pd)return r>0?e.setTime(e.getTime()+e.getTimezoneOffset()*60*1e3):r<0&&e.setTime(e.getTime()-e.getTimezoneOffset()*60*1e3),e;if(t instanceof Date)return t;if(good_pd_date.getFullYear()==1917&&!isNaN(e.getFullYear())){var s=e.getFullYear();return t.indexOf(""+s)>-1||e.setFullYear(e.getFullYear()+100),e}var a=t.match(/\d+/g)||["2017","2","19","0","0","0"],i=new Date(+a[0],+a[1]-1,+a[2],+a[3]||0,+a[4]||0,+a[5]||0);return t.indexOf("Z")>-1&&(i=new Date(i.getTime()-i.getTimezoneOffset()*60*1e3)),i}function cc2str(t,r){if(has_buf&&Buffer.isBuffer(t))return t.toString("binary");if(typeof TextDecoder<"u")try{var e={"€":"","‚":"",ƒ:"","„":"","…":"","†":"","‡":"","ˆ":"","‰":"",Š:"","‹":"",Œ:"",Ž:"","‘":"","’":"","“":"","”":"","•":"","–":"","—":"","˜":"","™":"",š:"","›":"",œ:"",ž:"",Ÿ:""};return Array.isArray(t)&&(t=new Uint8Array(t)),new TextDecoder("latin1").decode(t).replace(/[€‚ƒ„…†‡ˆ‰Š‹ŒŽ‘’“”•–—˜™š›œžŸ]/g,function(i){return e[i]||i})}catch{}for(var s=[],a=0;a!=t.length;++a)s.push(String.fromCharCode(t[a]));return s.join("")}function dup(t){if(typeof JSON<"u"&&!Array.isArray(t))return JSON.parse(JSON.stringify(t));if(typeof t!="object"||t==null)return t;if(t instanceof Date)return new Date(t.getTime());var r={};for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(r[e]=dup(t[e]));return r}function fill(t,r){for(var e="";e.length<r;)e+=t;return e}function fuzzynum(t){var r=Number(t);if(!isNaN(r))return isFinite(r)?r:NaN;if(!/\d/.test(t))return r;var e=1,s=t.replace(/([\d]),([\d])/g,"$1$2").replace(/[$]/g,"").replace(/[%]/g,function(){return e*=100,""});return!isNaN(r=Number(s))||(s=s.replace(/[(](.*)[)]/,function(a,i){return e=-e,i}),!isNaN(r=Number(s)))?r/e:r}var lower_months=["january","february","march","april","may","june","july","august","september","october","november","december"];function fuzzydate(t){var r=new Date(t),e=new Date(NaN),s=r.getYear(),a=r.getMonth(),i=r.getDate();if(isNaN(i))return e;var o=t.toLowerCase();if(o.match(/jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec/)){if(o=o.replace(/[^a-z]/g,"").replace(/([^a-z]|^)[ap]m?([^a-z]|$)/,""),o.length>3&&lower_months.indexOf(o)==-1)return e}else if(o.match(/[a-z]/))return e;return s<0||s>8099?e:(a>0||i>1)&&s!=101?r:t.match(/[^-0-9:,\/\\]/)?e:r}function zip_add_file(t,r,e){if(t.FullPaths){if(typeof e=="string"){var s;return has_buf?s=Buffer_from(e):s=utf8decode(e),CFB.utils.cfb_add(t,r,s)}CFB.utils.cfb_add(t,r,e)}else t.file(r,e)}function zip_new(){return CFB.utils.cfb_new()}var XML_HEADER=`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\r
`,encodings={"&quot;":'"',"&apos;":"'","&gt;":">","&lt;":"<","&amp;":"&"},rencoding=evert(encodings),decregex=/[&<>'"]/g,charegex=/[\u0000-\u0008\u000b-\u001f]/g;function escapexml(t){var r=t+"";return r.replace(decregex,function(e){return rencoding[e]}).replace(charegex,function(e){return"_x"+("000"+e.charCodeAt(0).toString(16)).slice(-4)+"_"})}function escapexmltag(t){return escapexml(t).replace(/ /g,"_x0020_")}var htmlcharegex=/[\u0000-\u001f]/g;function escapehtml(t){var r=t+"";return r.replace(decregex,function(e){return rencoding[e]}).replace(/\n/g,"<br/>").replace(htmlcharegex,function(e){return"&#x"+("000"+e.charCodeAt(0).toString(16)).slice(-4)+";"})}function escapexlml(t){var r=t+"";return r.replace(decregex,function(e){return rencoding[e]}).replace(htmlcharegex,function(e){return"&#x"+e.charCodeAt(0).toString(16).toUpperCase()+";"})}function xlml_unfixstr(t){return t.replace(/(\r\n|[\r\n])/g,"&#10;")}function parsexmlbool(t){switch(t){case 1:case!0:case"1":case"true":case"TRUE":return!0;default:return!1}}function utf8reada(t){for(var r="",e=0,s=0,a=0,i=0,o=0,c=0;e<t.length;){if(s=t.charCodeAt(e++),s<128){r+=String.fromCharCode(s);continue}if(a=t.charCodeAt(e++),s>191&&s<224){o=(s&31)<<6,o|=a&63,r+=String.fromCharCode(o);continue}if(i=t.charCodeAt(e++),s<240){r+=String.fromCharCode((s&15)<<12|(a&63)<<6|i&63);continue}o=t.charCodeAt(e++),c=((s&7)<<18|(a&63)<<12|(i&63)<<6|o&63)-65536,r+=String.fromCharCode(55296+(c>>>10&1023)),r+=String.fromCharCode(56320+(c&1023))}return r}function utf8readb(t){var r=new_raw_buf(2*t.length),e,s,a=1,i=0,o=0,c;for(s=0;s<t.length;s+=a)a=1,(c=t.charCodeAt(s))<128?e=c:c<224?(e=(c&31)*64+(t.charCodeAt(s+1)&63),a=2):c<240?(e=(c&15)*4096+(t.charCodeAt(s+1)&63)*64+(t.charCodeAt(s+2)&63),a=3):(a=4,e=(c&7)*262144+(t.charCodeAt(s+1)&63)*4096+(t.charCodeAt(s+2)&63)*64+(t.charCodeAt(s+3)&63),e-=65536,o=55296+(e>>>10&1023),e=56320+(e&1023)),o!==0&&(r[i++]=o&255,r[i++]=o>>>8,o=0),r[i++]=e%256,r[i++]=e>>>8;return r.slice(0,i).toString("ucs2")}function utf8readc(t){return Buffer_from(t,"binary").toString("utf8")}var utf8corpus="foo bar bazâð£",utf8read=has_buf&&(utf8readc(utf8corpus)==utf8reada(utf8corpus)&&utf8readc||utf8readb(utf8corpus)==utf8reada(utf8corpus)&&utf8readb)||utf8reada,utf8write=has_buf?function(t){return Buffer_from(t,"utf8").toString("binary")}:function(t){for(var r=[],e=0,s=0,a=0;e<t.length;)switch(s=t.charCodeAt(e++),!0){case s<128:r.push(String.fromCharCode(s));break;case s<2048:r.push(String.fromCharCode(192+(s>>6))),r.push(String.fromCharCode(128+(s&63)));break;case(s>=55296&&s<57344):s-=55296,a=t.charCodeAt(e++)-56320+(s<<10),r.push(String.fromCharCode(240+(a>>18&7))),r.push(String.fromCharCode(144+(a>>12&63))),r.push(String.fromCharCode(128+(a>>6&63))),r.push(String.fromCharCode(128+(a&63)));break;default:r.push(String.fromCharCode(224+(s>>12))),r.push(String.fromCharCode(128+(s>>6&63))),r.push(String.fromCharCode(128+(s&63)))}return r.join("")},htmldecode=function(){var t=[["nbsp"," "],["middot","·"],["quot",'"'],["apos","'"],["gt",">"],["lt","<"],["amp","&"]].map(function(r){return[new RegExp("&"+r[0]+";","ig"),r[1]]});return function(e){for(var s=e.replace(/^[\t\n\r ]+/,"").replace(/[\t\n\r ]+$/,"").replace(/>\s+/g,">").replace(/\s+</g,"<").replace(/[\t\n\r ]+/g," ").replace(/<\s*[bB][rR]\s*\/?>/g,`
`).replace(/<[^>]*>/g,""),a=0;a<t.length;++a)s=s.replace(t[a][0],t[a][1]);return s}}(),wtregex=/(^\s|\s$|\n)/;function writetag(t,r){return"<"+t+(r.match(wtregex)?' xml:space="preserve"':"")+">"+r+"</"+t+">"}function wxt_helper(t){return keys(t).map(function(r){return" "+r+'="'+t[r]+'"'}).join("")}function writextag(t,r,e){return"<"+t+(e!=null?wxt_helper(e):"")+(r!=null?(r.match(wtregex)?' xml:space="preserve"':"")+">"+r+"</"+t:"/")+">"}function write_w3cdtf(t,r){try{return t.toISOString().replace(/\.\d*/,"")}catch(e){if(r)throw e}return""}function write_vt(t,r){switch(typeof t){case"string":var e=writextag("vt:lpwstr",escapexml(t));return e=e.replace(/&quot;/g,"_x0022_"),e;case"number":return writextag((t|0)==t?"vt:i4":"vt:r8",escapexml(String(t)));case"boolean":return writextag("vt:bool",t?"true":"false")}if(t instanceof Date)return writextag("vt:filetime",write_w3cdtf(t));throw new Error("Unable to serialize "+t)}var XMLNS={CORE_PROPS:"http://schemas.openxmlformats.org/package/2006/metadata/core-properties",CUST_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/custom-properties",EXT_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/extended-properties",CT:"http://schemas.openxmlformats.org/package/2006/content-types",RELS:"http://schemas.openxmlformats.org/package/2006/relationships",TCMNT:"http://schemas.microsoft.com/office/spreadsheetml/2018/threadedcomments",dc:"http://purl.org/dc/elements/1.1/",dcterms:"http://purl.org/dc/terms/",dcmitype:"http://purl.org/dc/dcmitype/",r:"http://schemas.openxmlformats.org/officeDocument/2006/relationships",vt:"http://schemas.openxmlformats.org/officeDocument/2006/docPropsVTypes",xsi:"http://www.w3.org/2001/XMLSchema-instance",xsd:"http://www.w3.org/2001/XMLSchema"},XMLNS_main=["http://schemas.openxmlformats.org/spreadsheetml/2006/main","http://purl.oclc.org/ooxml/spreadsheetml/main","http://schemas.microsoft.com/office/excel/2006/main","http://schemas.microsoft.com/office/excel/2006/2"],XLMLNS={o:"urn:schemas-microsoft-com:office:office",x:"urn:schemas-microsoft-com:office:excel",ss:"urn:schemas-microsoft-com:office:spreadsheet",dt:"uuid:C2F41010-65B3-11d1-A29F-00AA00C14882",mv:"http://macVmlSchemaUri",v:"urn:schemas-microsoft-com:vml",html:"http://www.w3.org/TR/REC-html40"};function read_double_le(t,r){for(var e=1-2*(t[r+7]>>>7),s=((t[r+7]&127)<<4)+(t[r+6]>>>4&15),a=t[r+6]&15,i=5;i>=0;--i)a=a*256+t[r+i];return s==2047?a==0?e*(1/0):NaN:(s==0?s=-1022:(s-=1023,a+=Math.pow(2,52)),e*Math.pow(2,s-52)*a)}function write_double_le(t,r,e){var s=(r<0||1/r==-1/0?1:0)<<7,a=0,i=0,o=s?-r:r;isFinite(o)?o==0?a=i=0:(a=Math.floor(Math.log(o)/Math.LN2),i=o*Math.pow(2,52-a),a<=-1023&&(!isFinite(i)||i<Math.pow(2,52))?a=-1022:(i-=Math.pow(2,52),a+=1023)):(a=2047,i=isNaN(r)?26985:0);for(var c=0;c<=5;++c,i/=256)t[e+c]=i&255;t[e+6]=(a&15)<<4|i&15,t[e+7]=a>>4|s}var ___toBuffer=function(t){for(var r=[],e=10240,s=0;s<t[0].length;++s)if(t[0][s])for(var a=0,i=t[0][s].length;a<i;a+=e)r.push.apply(r,t[0][s].slice(a,a+e));return r},__toBuffer=has_buf?function(t){return t[0].length>0&&Buffer.isBuffer(t[0][0])?Buffer.concat(t[0].map(function(r){return Buffer.isBuffer(r)?r:Buffer_from(r)})):___toBuffer(t)}:___toBuffer,___utf16le=function(t,r,e){for(var s=[],a=r;a<e;a+=2)s.push(String.fromCharCode(__readUInt16LE(t,a)));return s.join("").replace(chr0,"")},__utf16le=has_buf?function(t,r,e){return Buffer.isBuffer(t)?t.toString("utf16le",r,e).replace(chr0,""):___utf16le(t,r,e)}:___utf16le,___hexlify=function(t,r,e){for(var s=[],a=r;a<r+e;++a)s.push(("0"+t[a].toString(16)).slice(-2));return s.join("")},__hexlify=has_buf?function(t,r,e){return Buffer.isBuffer(t)?t.toString("hex",r,r+e):___hexlify(t,r,e)}:___hexlify,___utf8=function(t,r,e){for(var s=[],a=r;a<e;a++)s.push(String.fromCharCode(__readUInt8(t,a)));return s.join("")},__utf8=has_buf?function(r,e,s){return Buffer.isBuffer(r)?r.toString("utf8",e,s):___utf8(r,e,s)}:___utf8,___lpstr=function(t,r){var e=__readUInt32LE(t,r);return e>0?__utf8(t,r+4,r+4+e-1):""},__lpstr=___lpstr,___cpstr=function(t,r){var e=__readUInt32LE(t,r);return e>0?__utf8(t,r+4,r+4+e-1):""},__cpstr=___cpstr,___lpwstr=function(t,r){var e=2*__readUInt32LE(t,r);return e>0?__utf8(t,r+4,r+4+e-1):""},__lpwstr=___lpwstr,___lpp4=function(r,e){var s=__readUInt32LE(r,e);return s>0?__utf16le(r,e+4,e+4+s):""},__lpp4=___lpp4,___8lpp4=function(t,r){var e=__readUInt32LE(t,r);return e>0?__utf8(t,r+4,r+4+e):""},__8lpp4=___8lpp4,___double=function(t,r){return read_double_le(t,r)},__double=___double,is_buf=function(r){return Array.isArray(r)||typeof Uint8Array<"u"&&r instanceof Uint8Array};has_buf&&(__lpstr=function(r,e){if(!Buffer.isBuffer(r))return ___lpstr(r,e);var s=r.readUInt32LE(e);return s>0?r.toString("utf8",e+4,e+4+s-1):""},__cpstr=function(r,e){if(!Buffer.isBuffer(r))return ___cpstr(r,e);var s=r.readUInt32LE(e);return s>0?r.toString("utf8",e+4,e+4+s-1):""},__lpwstr=function(r,e){if(!Buffer.isBuffer(r))return ___lpwstr(r,e);var s=2*r.readUInt32LE(e);return r.toString("utf16le",e+4,e+4+s-1)},__lpp4=function(r,e){if(!Buffer.isBuffer(r))return ___lpp4(r,e);var s=r.readUInt32LE(e);return r.toString("utf16le",e+4,e+4+s)},__8lpp4=function(r,e){if(!Buffer.isBuffer(r))return ___8lpp4(r,e);var s=r.readUInt32LE(e);return r.toString("utf8",e+4,e+4+s)},__double=function(r,e){return Buffer.isBuffer(r)?r.readDoubleLE(e):___double(r,e)},is_buf=function(r){return Buffer.isBuffer(r)||Array.isArray(r)||typeof Uint8Array<"u"&&r instanceof Uint8Array});var __readUInt8=function(t,r){return t[r]},__readUInt16LE=function(t,r){return t[r+1]*256+t[r]},__readInt16LE=function(t,r){var e=t[r+1]*256+t[r];return e<32768?e:(65535-e+1)*-1},__readUInt32LE=function(t,r){return t[r+3]*(1<<24)+(t[r+2]<<16)+(t[r+1]<<8)+t[r]},__readInt32LE=function(t,r){return t[r+3]<<24|t[r+2]<<16|t[r+1]<<8|t[r]},__readInt32BE=function(t,r){return t[r]<<24|t[r+1]<<16|t[r+2]<<8|t[r+3]};function ReadShift(t,r){var e="",s,a,i=[],o,c,h,u;switch(r){case"dbcs":if(u=this.l,has_buf&&Buffer.isBuffer(this))e=this.slice(this.l,this.l+2*t).toString("utf16le");else for(h=0;h<t;++h)e+=String.fromCharCode(__readUInt16LE(this,u)),u+=2;t*=2;break;case"utf8":e=__utf8(this,this.l,this.l+t);break;case"utf16le":t*=2,e=__utf16le(this,this.l,this.l+t);break;case"wstr":return ReadShift.call(this,t,"dbcs");case"lpstr-ansi":e=__lpstr(this,this.l),t=4+__readUInt32LE(this,this.l);break;case"lpstr-cp":e=__cpstr(this,this.l),t=4+__readUInt32LE(this,this.l);break;case"lpwstr":e=__lpwstr(this,this.l),t=4+2*__readUInt32LE(this,this.l);break;case"lpp4":t=4+__readUInt32LE(this,this.l),e=__lpp4(this,this.l),t&2&&(t+=2);break;case"8lpp4":t=4+__readUInt32LE(this,this.l),e=__8lpp4(this,this.l),t&3&&(t+=4-(t&3));break;case"cstr":for(t=0,e="";(o=__readUInt8(this,this.l+t++))!==0;)i.push(_getchar(o));e=i.join("");break;case"_wstr":for(t=0,e="";(o=__readUInt16LE(this,this.l+t))!==0;)i.push(_getchar(o)),t+=2;t+=2,e=i.join("");break;case"dbcs-cont":for(e="",u=this.l,h=0;h<t;++h){if(this.lens&&this.lens.indexOf(u)!==-1)return o=__readUInt8(this,u),this.l=u+1,c=ReadShift.call(this,t-h,o?"dbcs-cont":"sbcs-cont"),i.join("")+c;i.push(_getchar(__readUInt16LE(this,u))),u+=2}e=i.join(""),t*=2;break;case"cpstr":case"sbcs-cont":for(e="",u=this.l,h=0;h!=t;++h){if(this.lens&&this.lens.indexOf(u)!==-1)return o=__readUInt8(this,u),this.l=u+1,c=ReadShift.call(this,t-h,o?"dbcs-cont":"sbcs-cont"),i.join("")+c;i.push(_getchar(__readUInt8(this,u))),u+=1}e=i.join("");break;default:switch(t){case 1:return s=__readUInt8(this,this.l),this.l++,s;case 2:return s=(r==="i"?__readInt16LE:__readUInt16LE)(this,this.l),this.l+=2,s;case 4:case-4:return r==="i"||!(this[this.l+3]&128)?(s=(t>0?__readInt32LE:__readInt32BE)(this,this.l),this.l+=4,s):(a=__readUInt32LE(this,this.l),this.l+=4,a);case 8:case-8:if(r==="f")return t==8?a=__double(this,this.l):a=__double([this[this.l+7],this[this.l+6],this[this.l+5],this[this.l+4],this[this.l+3],this[this.l+2],this[this.l+1],this[this.l+0]],0),this.l+=8,a;t=8;case 16:e=__hexlify(this,this.l,t);break}}return this.l+=t,e}var __writeUInt32LE=function(t,r,e){t[e]=r&255,t[e+1]=r>>>8&255,t[e+2]=r>>>16&255,t[e+3]=r>>>24&255},__writeInt32LE=function(t,r,e){t[e]=r&255,t[e+1]=r>>8&255,t[e+2]=r>>16&255,t[e+3]=r>>24&255},__writeUInt16LE=function(t,r,e){t[e]=r&255,t[e+1]=r>>>8&255};function WriteShift(t,r,e){var s=0,a=0;if(e==="dbcs"){for(a=0;a!=r.length;++a)__writeUInt16LE(this,r.charCodeAt(a),this.l+2*a);s=2*r.length}else if(e==="sbcs"){for(r=r.replace(/[^\x00-\x7F]/g,"_"),a=0;a!=r.length;++a)this[this.l+a]=r.charCodeAt(a)&255;s=r.length}else if(e==="hex"){for(;a<t;++a)this[this.l++]=parseInt(r.slice(2*a,2*a+2),16)||0;return this}else if(e==="utf16le"){var i=Math.min(this.l+t,this.length);for(a=0;a<Math.min(r.length,t);++a){var o=r.charCodeAt(a);this[this.l++]=o&255,this[this.l++]=o>>8}for(;this.l<i;)this[this.l++]=0;return this}else switch(t){case 1:s=1,this[this.l]=r&255;break;case 2:s=2,this[this.l]=r&255,r>>>=8,this[this.l+1]=r&255;break;case 3:s=3,this[this.l]=r&255,r>>>=8,this[this.l+1]=r&255,r>>>=8,this[this.l+2]=r&255;break;case 4:s=4,__writeUInt32LE(this,r,this.l);break;case 8:if(s=8,e==="f"){write_double_le(this,r,this.l);break}case 16:break;case-4:s=4,__writeInt32LE(this,r,this.l);break}return this.l+=s,this}function CheckField(t,r){var e=__hexlify(this,this.l,t.length>>1);if(e!==t)throw new Error(r+"Expected "+t+" saw "+e);this.l+=t.length>>1}function prep_blob(t,r){t.l=r,t.read_shift=ReadShift,t.chk=CheckField,t.write_shift=WriteShift}function parsenoop(t,r){t.l+=r}function new_buf(t){var r=new_raw_buf(t);return prep_blob(r,0),r}function buf_array(){var t=[],r=has_buf?256:2048,e=function(u){var d=new_buf(u);return prep_blob(d,0),d},s=e(r),a=function(){s&&(s.length>s.l&&(s=s.slice(0,s.l),s.l=s.length),s.length>0&&t.push(s),s=null)},i=function(u){return s&&u<s.length-s.l?s:(a(),s=e(Math.max(u+1,r)))},o=function(){return a(),bconcat(t)},c=function(u){a(),s=u,s.l==null&&(s.l=s.length),i(r)};return{next:i,push:c,end:o,_bufs:t}}function write_record(t,r,e,s){var a=+r,i;if(!isNaN(a)){s||(s=XLSBRecordEnum[a].p||(e||[]).length||0),i=1+(a>=128?1:0)+1,s>=128&&++i,s>=16384&&++i,s>=2097152&&++i;var o=t.next(i);a<=127?o.write_shift(1,a):(o.write_shift(1,(a&127)+128),o.write_shift(1,a>>7));for(var c=0;c!=4;++c)if(s>=128)o.write_shift(1,(s&127)+128),s>>=7;else{o.write_shift(1,s);break}s>0&&is_buf(e)&&t.push(e)}}function shift_cell_xls(t,r,e){var s=dup(t);if(r.s?(s.cRel&&(s.c+=r.s.c),s.rRel&&(s.r+=r.s.r)):(s.cRel&&(s.c+=r.c),s.rRel&&(s.r+=r.r)),!e||e.biff<12){for(;s.c>=256;)s.c-=256;for(;s.r>=65536;)s.r-=65536}return s}function shift_range_xls(t,r,e){var s=dup(t);return s.s=shift_cell_xls(s.s,r.s,e),s.e=shift_cell_xls(s.e,r.s,e),s}function encode_cell_xls(t,r){if(t.cRel&&t.c<0)for(t=dup(t);t.c<0;)t.c+=r>8?16384:256;if(t.rRel&&t.r<0)for(t=dup(t);t.r<0;)t.r+=r>8?1048576:r>5?65536:16384;var e=encode_cell(t);return!t.cRel&&t.cRel!=null&&(e=fix_col(e)),!t.rRel&&t.rRel!=null&&(e=fix_row(e)),e}function encode_range_xls(t,r){return t.s.r==0&&!t.s.rRel&&t.e.r==(r.biff>=12?1048575:r.biff>=8?65536:16384)&&!t.e.rRel?(t.s.cRel?"":"$")+encode_col(t.s.c)+":"+(t.e.cRel?"":"$")+encode_col(t.e.c):t.s.c==0&&!t.s.cRel&&t.e.c==(r.biff>=12?16383:255)&&!t.e.cRel?(t.s.rRel?"":"$")+encode_row(t.s.r)+":"+(t.e.rRel?"":"$")+encode_row(t.e.r):encode_cell_xls(t.s,r.biff)+":"+encode_cell_xls(t.e,r.biff)}function decode_row(t){return parseInt(unfix_row(t),10)-1}function encode_row(t){return""+(t+1)}function fix_row(t){return t.replace(/([A-Z]|^)(\d+)$/,"$1$$$2")}function unfix_row(t){return t.replace(/\$(\d+)$/,"$1")}function decode_col(t){for(var r=unfix_col(t),e=0,s=0;s!==r.length;++s)e=26*e+r.charCodeAt(s)-64;return e-1}function encode_col(t){if(t<0)throw new Error("invalid column "+t);var r="";for(++t;t;t=Math.floor((t-1)/26))r=String.fromCharCode((t-1)%26+65)+r;return r}function fix_col(t){return t.replace(/^([A-Z])/,"$$$1")}function unfix_col(t){return t.replace(/^\$([A-Z])/,"$1")}function split_cell(t){return t.replace(/(\$?[A-Z]*)(\$?\d*)/,"$1,$2").split(",")}function decode_cell(t){for(var r=0,e=0,s=0;s<t.length;++s){var a=t.charCodeAt(s);a>=48&&a<=57?r=10*r+(a-48):a>=65&&a<=90&&(e=26*e+(a-64))}return{c:e-1,r:r-1}}function encode_cell(t){for(var r=t.c+1,e="";r;r=(r-1)/26|0)e=String.fromCharCode((r-1)%26+65)+e;return e+(t.r+1)}function decode_range(t){var r=t.indexOf(":");return r==-1?{s:decode_cell(t),e:decode_cell(t)}:{s:decode_cell(t.slice(0,r)),e:decode_cell(t.slice(r+1))}}function encode_range(t,r){return typeof r>"u"||typeof r=="number"?encode_range(t.s,t.e):(typeof t!="string"&&(t=encode_cell(t)),typeof r!="string"&&(r=encode_cell(r)),t==r?t:t+":"+r)}function safe_decode_range(t){var r={s:{c:0,r:0},e:{c:0,r:0}},e=0,s=0,a=0,i=t.length;for(e=0;s<i&&!((a=t.charCodeAt(s)-64)<1||a>26);++s)e=26*e+a;for(r.s.c=--e,e=0;s<i&&!((a=t.charCodeAt(s)-48)<0||a>9);++s)e=10*e+a;if(r.s.r=--e,s===i||a!=10)return r.e.c=r.s.c,r.e.r=r.s.r,r;for(++s,e=0;s!=i&&!((a=t.charCodeAt(s)-64)<1||a>26);++s)e=26*e+a;for(r.e.c=--e,e=0;s!=i&&!((a=t.charCodeAt(s)-48)<0||a>9);++s)e=10*e+a;return r.e.r=--e,r}function safe_format_cell(t,r){var e=t.t=="d"&&r instanceof Date;if(t.z!=null)try{return t.w=SSF_format(t.z,e?datenum(r):r)}catch{}try{return t.w=SSF_format((t.XF||{}).numFmtId||(e?14:0),e?datenum(r):r)}catch{return""+r}}function format_cell(t,r,e){return t==null||t.t==null||t.t=="z"?"":t.w!==void 0?t.w:(t.t=="d"&&!t.z&&e&&e.dateNF&&(t.z=e.dateNF),t.t=="e"?BErr[t.v]||t.v:r==null?safe_format_cell(t,t.v):safe_format_cell(t,r))}function sheet_to_workbook(t,r){var e=r&&r.sheet?r.sheet:"Sheet1",s={};return s[e]=t,{SheetNames:[e],Sheets:s}}function sheet_add_aoa(t,r,e){var s=e||{},a=t?Array.isArray(t):s.dense,i=t||(a?[]:{}),o=0,c=0;if(i&&s.origin!=null){if(typeof s.origin=="number")o=s.origin;else{var h=typeof s.origin=="string"?decode_cell(s.origin):s.origin;o=h.r,c=h.c}i["!ref"]||(i["!ref"]="A1:A1")}var u={s:{c:1e7,r:1e7},e:{c:0,r:0}};if(i["!ref"]){var d=safe_decode_range(i["!ref"]);u.s.c=d.s.c,u.s.r=d.s.r,u.e.c=Math.max(u.e.c,d.e.c),u.e.r=Math.max(u.e.r,d.e.r),o==-1&&(u.e.r=o=d.e.r+1)}for(var _=0;_!=r.length;++_)if(r[_]){if(!Array.isArray(r[_]))throw new Error("aoa_to_sheet expects an array of arrays");for(var b=0;b!=r[_].length;++b)if(!(typeof r[_][b]>"u")){var v={v:r[_][b]},E=o+_,x=c+b;if(u.s.r>E&&(u.s.r=E),u.s.c>x&&(u.s.c=x),u.e.r<E&&(u.e.r=E),u.e.c<x&&(u.e.c=x),r[_][b]&&typeof r[_][b]=="object"&&!Array.isArray(r[_][b])&&!(r[_][b]instanceof Date))v=r[_][b];else if(Array.isArray(v.v)&&(v.f=r[_][b][1],v.v=v.v[0]),v.v===null)if(v.f)v.t="n";else if(s.nullError)v.t="e",v.v=0;else if(s.sheetStubs)v.t="z";else continue;else typeof v.v=="number"?v.t="n":typeof v.v=="boolean"?v.t="b":v.v instanceof Date?(v.z=s.dateNF||table_fmt[14],s.cellDates?(v.t="d",v.w=SSF_format(v.z,datenum(v.v))):(v.t="n",v.v=datenum(v.v),v.w=SSF_format(v.z,v.v))):v.t="s";if(a)i[E]||(i[E]=[]),i[E][x]&&i[E][x].z&&(v.z=i[E][x].z),i[E][x]=v;else{var g=encode_cell({c:x,r:E});i[g]&&i[g].z&&(v.z=i[g].z),i[g]=v}}}return u.s.c<1e7&&(i["!ref"]=encode_range(u)),i}function aoa_to_sheet(t,r){return sheet_add_aoa(null,t,r)}function parse_Int32LE(t){return t.read_shift(4,"i")}function write_UInt32LE(t,r){return r||(r=new_buf(4)),r.write_shift(4,t),r}function parse_XLWideString(t){var r=t.read_shift(4);return r===0?"":t.read_shift(r,"dbcs")}function write_XLWideString(t,r){var e=!1;return r==null&&(e=!0,r=new_buf(4+2*t.length)),r.write_shift(4,t.length),t.length>0&&r.write_shift(0,t,"dbcs"),e?r.slice(0,r.l):r}function parse_StrRun(t){return{ich:t.read_shift(2),ifnt:t.read_shift(2)}}function write_StrRun(t,r){return r||(r=new_buf(4)),r.write_shift(2,0),r.write_shift(2,0),r}function parse_RichStr(t,r){var e=t.l,s=t.read_shift(1),a=parse_XLWideString(t),i=[],o={t:a,h:a};if(s&1){for(var c=t.read_shift(4),h=0;h!=c;++h)i.push(parse_StrRun(t));o.r=i}else o.r=[{ich:0,ifnt:0}];return t.l=e+r,o}function write_RichStr(t,r){var e=!1;return r==null&&(e=!0,r=new_buf(15+4*t.t.length)),r.write_shift(1,0),write_XLWideString(t.t,r),e?r.slice(0,r.l):r}var parse_BrtCommentText=parse_RichStr;function write_BrtCommentText(t,r){var e=!1;return r==null&&(e=!0,r=new_buf(23+4*t.t.length)),r.write_shift(1,1),write_XLWideString(t.t,r),r.write_shift(4,1),write_StrRun({},r),e?r.slice(0,r.l):r}function parse_XLSBCell(t){var r=t.read_shift(4),e=t.read_shift(2);return e+=t.read_shift(1)<<16,t.l++,{c:r,iStyleRef:e}}function write_XLSBCell(t,r){return r==null&&(r=new_buf(8)),r.write_shift(-4,t.c),r.write_shift(3,t.iStyleRef||t.s),r.write_shift(1,0),r}function parse_XLSBShortCell(t){var r=t.read_shift(2);return r+=t.read_shift(1)<<16,t.l++,{c:-1,iStyleRef:r}}function write_XLSBShortCell(t,r){return r==null&&(r=new_buf(4)),r.write_shift(3,t.iStyleRef||t.s),r.write_shift(1,0),r}var parse_XLSBCodeName=parse_XLWideString,write_XLSBCodeName=write_XLWideString;function parse_XLNullableWideString(t){var r=t.read_shift(4);return r===0||r===4294967295?"":t.read_shift(r,"dbcs")}function write_XLNullableWideString(t,r){var e=!1;return r==null&&(e=!0,r=new_buf(127)),r.write_shift(4,t.length>0?t.length:4294967295),t.length>0&&r.write_shift(0,t,"dbcs"),e?r.slice(0,r.l):r}var parse_XLNameWideString=parse_XLWideString,parse_RelID=parse_XLNullableWideString,write_RelID=write_XLNullableWideString;function parse_RkNumber(t){var r=t.slice(t.l,t.l+4),e=r[0]&1,s=r[0]&2;t.l+=4;var a=s===0?__double([0,0,0,0,r[0]&252,r[1],r[2],r[3]],0):__readInt32LE(r,0)>>2;return e?a/100:a}function write_RkNumber(t,r){r==null&&(r=new_buf(4));var e=0,s=0,a=t*100;if(t==(t|0)&&t>=-536870912&&t<1<<29?s=1:a==(a|0)&&a>=-536870912&&a<1<<29&&(s=1,e=1),s)r.write_shift(-4,((e?a:t)<<2)+(e+2));else throw new Error("unsupported RkNumber "+t)}function parse_RfX(t){var r={s:{},e:{}};return r.s.r=t.read_shift(4),r.e.r=t.read_shift(4),r.s.c=t.read_shift(4),r.e.c=t.read_shift(4),r}function write_RfX(t,r){return r||(r=new_buf(16)),r.write_shift(4,t.s.r),r.write_shift(4,t.e.r),r.write_shift(4,t.s.c),r.write_shift(4,t.e.c),r}var parse_UncheckedRfX=parse_RfX,write_UncheckedRfX=write_RfX;function parse_Xnum(t){if(t.length-t.l<8)throw"XLS Xnum Buffer underflow";return t.read_shift(8,"f")}function write_Xnum(t,r){return(r||new_buf(8)).write_shift(8,t,"f")}function parse_BrtColor(t){var r={},e=t.read_shift(1),s=e>>>1,a=t.read_shift(1),i=t.read_shift(2,"i"),o=t.read_shift(1),c=t.read_shift(1),h=t.read_shift(1);switch(t.l++,s){case 0:r.auto=1;break;case 1:r.index=a;var u=XLSIcv[a];u&&(r.rgb=rgb2Hex(u));break;case 2:r.rgb=rgb2Hex([o,c,h]);break;case 3:r.theme=a;break}return i!=0&&(r.tint=i>0?i/32767:i/32768),r}function write_BrtColor(t,r){if(r||(r=new_buf(8)),!t||t.auto)return r.write_shift(4,0),r.write_shift(4,0),r;t.index!=null?(r.write_shift(1,2),r.write_shift(1,t.index)):t.theme!=null?(r.write_shift(1,6),r.write_shift(1,t.theme)):(r.write_shift(1,5),r.write_shift(1,0));var e=t.tint||0;if(e>0?e*=32767:e<0&&(e*=32768),r.write_shift(2,e),!t.rgb||t.theme!=null)r.write_shift(2,0),r.write_shift(1,0),r.write_shift(1,0);else{var s=t.rgb||"FFFFFF";typeof s=="number"&&(s=("000000"+s.toString(16)).slice(-6)),r.write_shift(1,parseInt(s.slice(0,2),16)),r.write_shift(1,parseInt(s.slice(2,4),16)),r.write_shift(1,parseInt(s.slice(4,6),16)),r.write_shift(1,255)}return r}function parse_FontFlags(t){var r=t.read_shift(1);t.l++;var e={fBold:r&1,fItalic:r&2,fUnderline:r&4,fStrikeout:r&8,fOutline:r&16,fShadow:r&32,fCondense:r&64,fExtend:r&128};return e}function write_FontFlags(t,r){r||(r=new_buf(2));var e=(t.italic?2:0)|(t.strike?8:0)|(t.outline?16:0)|(t.shadow?32:0)|(t.condense?64:0)|(t.extend?128:0);return r.write_shift(1,e),r.write_shift(1,0),r}var VT_I2=2,VT_I4=3,VT_BOOL=11,VT_UI4=19,VT_FILETIME=64,VT_BLOB=65,VT_CF=71,VT_VECTOR_VARIANT=4108,VT_VECTOR_LPSTR=4126,VT_STRING=80,DocSummaryPIDDSI={1:{n:"CodePage",t:VT_I2},2:{n:"Category",t:VT_STRING},3:{n:"PresentationFormat",t:VT_STRING},4:{n:"ByteCount",t:VT_I4},5:{n:"LineCount",t:VT_I4},6:{n:"ParagraphCount",t:VT_I4},7:{n:"SlideCount",t:VT_I4},8:{n:"NoteCount",t:VT_I4},9:{n:"HiddenCount",t:VT_I4},10:{n:"MultimediaClipCount",t:VT_I4},11:{n:"ScaleCrop",t:VT_BOOL},12:{n:"HeadingPairs",t:VT_VECTOR_VARIANT},13:{n:"TitlesOfParts",t:VT_VECTOR_LPSTR},14:{n:"Manager",t:VT_STRING},15:{n:"Company",t:VT_STRING},16:{n:"LinksUpToDate",t:VT_BOOL},17:{n:"CharacterCount",t:VT_I4},19:{n:"SharedDoc",t:VT_BOOL},22:{n:"HyperlinksChanged",t:VT_BOOL},23:{n:"AppVersion",t:VT_I4,p:"version"},24:{n:"DigSig",t:VT_BLOB},26:{n:"ContentType",t:VT_STRING},27:{n:"ContentStatus",t:VT_STRING},28:{n:"Language",t:VT_STRING},29:{n:"Version",t:VT_STRING},255:{},2147483648:{n:"Locale",t:VT_UI4},2147483651:{n:"Behavior",t:VT_UI4},1919054434:{}},SummaryPIDSI={1:{n:"CodePage",t:VT_I2},2:{n:"Title",t:VT_STRING},3:{n:"Subject",t:VT_STRING},4:{n:"Author",t:VT_STRING},5:{n:"Keywords",t:VT_STRING},6:{n:"Comments",t:VT_STRING},7:{n:"Template",t:VT_STRING},8:{n:"LastAuthor",t:VT_STRING},9:{n:"RevNumber",t:VT_STRING},10:{n:"EditTime",t:VT_FILETIME},11:{n:"LastPrinted",t:VT_FILETIME},12:{n:"CreatedDate",t:VT_FILETIME},13:{n:"ModifiedDate",t:VT_FILETIME},14:{n:"PageCount",t:VT_I4},15:{n:"WordCount",t:VT_I4},16:{n:"CharCount",t:VT_I4},17:{n:"Thumbnail",t:VT_CF},18:{n:"Application",t:VT_STRING},19:{n:"DocSecurity",t:VT_I4},255:{},2147483648:{n:"Locale",t:VT_UI4},2147483651:{n:"Behavior",t:VT_UI4},1919054434:{}};function rgbify(t){return t.map(function(r){return[r>>16&255,r>>8&255,r&255]})}var _XLSIcv=rgbify([0,16777215,16711680,65280,255,16776960,16711935,65535,0,16777215,16711680,65280,255,16776960,16711935,65535,8388608,32768,128,8421376,8388736,32896,12632256,8421504,10066431,10040166,16777164,13434879,6684774,16744576,26316,13421823,128,16711935,16776960,65535,8388736,8388608,32896,255,52479,13434879,13434828,16777113,10079487,16751052,13408767,16764057,3368703,3394764,10079232,16763904,16750848,16737792,6710937,9868950,13158,3381606,13056,3355392,10040064,10040166,3355545,3355443,16777215,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),XLSIcv=dup(_XLSIcv),BErr={0:"#NULL!",7:"#DIV/0!",15:"#VALUE!",23:"#REF!",29:"#NAME?",36:"#NUM!",42:"#N/A",43:"#GETTING_DATA",255:"#WTF?"},ct2type={"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml":"workbooks","application/vnd.ms-excel.sheet.macroEnabled.main+xml":"workbooks","application/vnd.ms-excel.sheet.binary.macroEnabled.main":"workbooks","application/vnd.ms-excel.addin.macroEnabled.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml":"sheets","application/vnd.ms-excel.worksheet":"sheets","application/vnd.ms-excel.binIndexWs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml":"charts","application/vnd.ms-excel.chartsheet":"charts","application/vnd.ms-excel.macrosheet+xml":"macros","application/vnd.ms-excel.macrosheet":"macros","application/vnd.ms-excel.intlmacrosheet":"TODO","application/vnd.ms-excel.binIndexMs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml":"dialogs","application/vnd.ms-excel.dialogsheet":"dialogs","application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml":"strs","application/vnd.ms-excel.sharedStrings":"strs","application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml":"styles","application/vnd.ms-excel.styles":"styles","application/vnd.openxmlformats-package.core-properties+xml":"coreprops","application/vnd.openxmlformats-officedocument.custom-properties+xml":"custprops","application/vnd.openxmlformats-officedocument.extended-properties+xml":"extprops","application/vnd.openxmlformats-officedocument.customXmlProperties+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.customProperty":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml":"comments","application/vnd.ms-excel.comments":"comments","application/vnd.ms-excel.threadedcomments+xml":"threadedcomments","application/vnd.ms-excel.person+xml":"people","application/vnd.openxmlformats-officedocument.spreadsheetml.sheetMetadata+xml":"metadata","application/vnd.ms-excel.sheetMetadata":"metadata","application/vnd.ms-excel.pivotTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotTable+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.chart+xml":"TODO","application/vnd.ms-office.chartcolorstyle+xml":"TODO","application/vnd.ms-office.chartstyle+xml":"TODO","application/vnd.ms-office.chartex+xml":"TODO","application/vnd.ms-excel.calcChain":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.calcChain+xml":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.printerSettings":"TODO","application/vnd.ms-office.activeX":"TODO","application/vnd.ms-office.activeX+xml":"TODO","application/vnd.ms-excel.attachedToolbars":"TODO","application/vnd.ms-excel.connections":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.connections+xml":"TODO","application/vnd.ms-excel.externalLink":"links","application/vnd.openxmlformats-officedocument.spreadsheetml.externalLink+xml":"links","application/vnd.ms-excel.pivotCacheDefinition":"TODO","application/vnd.ms-excel.pivotCacheRecords":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheDefinition+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheRecords+xml":"TODO","application/vnd.ms-excel.queryTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.queryTable+xml":"TODO","application/vnd.ms-excel.userNames":"TODO","application/vnd.ms-excel.revisionHeaders":"TODO","application/vnd.ms-excel.revisionLog":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionHeaders+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionLog+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.userNames+xml":"TODO","application/vnd.ms-excel.tableSingleCells":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.tableSingleCells+xml":"TODO","application/vnd.ms-excel.slicer":"TODO","application/vnd.ms-excel.slicerCache":"TODO","application/vnd.ms-excel.slicer+xml":"TODO","application/vnd.ms-excel.slicerCache+xml":"TODO","application/vnd.ms-excel.wsSortMap":"TODO","application/vnd.ms-excel.table":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.table+xml":"TODO","application/vnd.openxmlformats-officedocument.theme+xml":"themes","application/vnd.openxmlformats-officedocument.themeOverride+xml":"TODO","application/vnd.ms-excel.Timeline+xml":"TODO","application/vnd.ms-excel.TimelineCache+xml":"TODO","application/vnd.ms-office.vbaProject":"vba","application/vnd.ms-office.vbaProjectSignature":"TODO","application/vnd.ms-office.volatileDependencies":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.volatileDependencies+xml":"TODO","application/vnd.ms-excel.controlproperties+xml":"TODO","application/vnd.openxmlformats-officedocument.model+data":"TODO","application/vnd.ms-excel.Survey+xml":"TODO","application/vnd.openxmlformats-officedocument.drawing+xml":"drawings","application/vnd.openxmlformats-officedocument.drawingml.chartshapes+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramColors+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramData+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramLayout+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramStyle+xml":"TODO","application/vnd.openxmlformats-officedocument.vmlDrawing":"TODO","application/vnd.openxmlformats-package.relationships+xml":"rels","application/vnd.openxmlformats-officedocument.oleObject":"TODO","image/png":"TODO",sheet:"js"},CT_LIST={workbooks:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml",xlsm:"application/vnd.ms-excel.sheet.macroEnabled.main+xml",xlsb:"application/vnd.ms-excel.sheet.binary.macroEnabled.main",xlam:"application/vnd.ms-excel.addin.macroEnabled.main+xml",xltx:"application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml"},strs:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml",xlsb:"application/vnd.ms-excel.sharedStrings"},comments:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml",xlsb:"application/vnd.ms-excel.comments"},sheets:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml",xlsb:"application/vnd.ms-excel.worksheet"},charts:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml",xlsb:"application/vnd.ms-excel.chartsheet"},dialogs:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml",xlsb:"application/vnd.ms-excel.dialogsheet"},macros:{xlsx:"application/vnd.ms-excel.macrosheet+xml",xlsb:"application/vnd.ms-excel.macrosheet"},metadata:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheetMetadata+xml",xlsb:"application/vnd.ms-excel.sheetMetadata"},styles:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml",xlsb:"application/vnd.ms-excel.styles"}};function new_ct(){return{workbooks:[],sheets:[],charts:[],dialogs:[],macros:[],rels:[],strs:[],comments:[],threadedcomments:[],links:[],coreprops:[],extprops:[],custprops:[],themes:[],styles:[],calcchains:[],vba:[],drawings:[],metadata:[],people:[],TODO:[],xmlns:""}}function write_ct(t,r){var e=evert_arr(ct2type),s=[],a;s[s.length]=XML_HEADER,s[s.length]=writextag("Types",null,{xmlns:XMLNS.CT,"xmlns:xsd":XMLNS.xsd,"xmlns:xsi":XMLNS.xsi}),s=s.concat([["xml","application/xml"],["bin","application/vnd.ms-excel.sheet.binary.macroEnabled.main"],["vml","application/vnd.openxmlformats-officedocument.vmlDrawing"],["data","application/vnd.openxmlformats-officedocument.model+data"],["bmp","image/bmp"],["png","image/png"],["gif","image/gif"],["emf","image/x-emf"],["wmf","image/x-wmf"],["jpg","image/jpeg"],["jpeg","image/jpeg"],["tif","image/tiff"],["tiff","image/tiff"],["pdf","application/pdf"],["rels","application/vnd.openxmlformats-package.relationships+xml"]].map(function(h){return writextag("Default",null,{Extension:h[0],ContentType:h[1]})}));var i=function(h){t[h]&&t[h].length>0&&(a=t[h][0],s[s.length]=writextag("Override",null,{PartName:(a[0]=="/"?"":"/")+a,ContentType:CT_LIST[h][r.bookType]||CT_LIST[h].xlsx}))},o=function(h){(t[h]||[]).forEach(function(u){s[s.length]=writextag("Override",null,{PartName:(u[0]=="/"?"":"/")+u,ContentType:CT_LIST[h][r.bookType]||CT_LIST[h].xlsx})})},c=function(h){(t[h]||[]).forEach(function(u){s[s.length]=writextag("Override",null,{PartName:(u[0]=="/"?"":"/")+u,ContentType:e[h][0]})})};return i("workbooks"),o("sheets"),o("charts"),c("themes"),["strs","styles"].forEach(i),["coreprops","extprops","custprops"].forEach(c),c("vba"),c("comments"),c("threadedcomments"),c("drawings"),o("metadata"),c("people"),s.length>2&&(s[s.length]="</Types>",s[1]=s[1].replace("/>",">")),s.join("")}var RELS={WB:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument",HLINK:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/hyperlink",VML:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/vmlDrawing",XPATH:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/externalLinkPath",XMISS:"http://schemas.microsoft.com/office/2006/relationships/xlExternalLinkPath/xlPathMissing",CMNT:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/comments",CORE_PROPS:"http://schemas.openxmlformats.org/package/2006/relationships/metadata/core-properties",EXT_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/extended-properties",CUST_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/custom-properties",SST:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sharedStrings",STY:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles",THEME:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/theme",WS:["http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet","http://purl.oclc.org/ooxml/officeDocument/relationships/worksheet"],DRAW:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/drawing",XLMETA:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sheetMetadata",TCMNT:"http://schemas.microsoft.com/office/2017/10/relationships/threadedComment",PEOPLE:"http://schemas.microsoft.com/office/2017/10/relationships/person",VBA:"http://schemas.microsoft.com/office/2006/relationships/vbaProject"};function get_rels_path(t){var r=t.lastIndexOf("/");return t.slice(0,r+1)+"_rels/"+t.slice(r+1)+".rels"}function write_rels(t){var r=[XML_HEADER,writextag("Relationships",null,{xmlns:XMLNS.RELS})];return keys(t["!id"]).forEach(function(e){r[r.length]=writextag("Relationship",null,t["!id"][e])}),r.length>2&&(r[r.length]="</Relationships>",r[1]=r[1].replace("/>",">")),r.join("")}function add_rels(t,r,e,s,a,i){if(a||(a={}),t["!id"]||(t["!id"]={}),t["!idx"]||(t["!idx"]=1),r<0)for(r=t["!idx"];t["!id"]["rId"+r];++r);if(t["!idx"]=r+1,a.Id="rId"+r,a.Type=s,a.Target=e,[RELS.HLINK,RELS.XPATH,RELS.XMISS].indexOf(a.Type)>-1&&(a.TargetMode="External"),t["!id"][a.Id])throw new Error("Cannot rewrite rId "+r);return t["!id"][a.Id]=a,t[("/"+a.Target).replace("//","/")]=a,r}function write_manifest(t){var r=[XML_HEADER];r.push(`<manifest:manifest xmlns:manifest="urn:oasis:names:tc:opendocument:xmlns:manifest:1.0" manifest:version="1.2">
`),r.push(`  <manifest:file-entry manifest:full-path="/" manifest:version="1.2" manifest:media-type="application/vnd.oasis.opendocument.spreadsheet"/>
`);for(var e=0;e<t.length;++e)r.push('  <manifest:file-entry manifest:full-path="'+t[e][0]+'" manifest:media-type="'+t[e][1]+`"/>
`);return r.push("</manifest:manifest>"),r.join("")}function write_rdf_type(t,r,e){return['  <rdf:Description rdf:about="'+t+`">
`,'    <rdf:type rdf:resource="http://docs.oasis-open.org/ns/office/1.2/meta/'+(e||"odf")+"#"+r+`"/>
`,`  </rdf:Description>
`].join("")}function write_rdf_has(t,r){return['  <rdf:Description rdf:about="'+t+`">
`,'    <ns0:hasPart xmlns:ns0="http://docs.oasis-open.org/ns/office/1.2/meta/pkg#" rdf:resource="'+r+`"/>
`,`  </rdf:Description>
`].join("")}function write_rdf(t){var r=[XML_HEADER];r.push(`<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
`);for(var e=0;e!=t.length;++e)r.push(write_rdf_type(t[e][0],t[e][1])),r.push(write_rdf_has("",t[e][0]));return r.push(write_rdf_type("","Document","pkg")),r.push("</rdf:RDF>"),r.join("")}function write_meta_ods(){return'<office:document-meta xmlns:office="urn:oasis:names:tc:opendocument:xmlns:office:1.0" xmlns:meta="urn:oasis:names:tc:opendocument:xmlns:meta:1.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:xlink="http://www.w3.org/1999/xlink" office:version="1.2"><office:meta><meta:generator>SheetJS '+XLSX.version+"</meta:generator></office:meta></office:document-meta>"}var CORE_PROPS=[["cp:category","Category"],["cp:contentStatus","ContentStatus"],["cp:keywords","Keywords"],["cp:lastModifiedBy","LastAuthor"],["cp:lastPrinted","LastPrinted"],["cp:revision","RevNumber"],["cp:version","Version"],["dc:creator","Author"],["dc:description","Comments"],["dc:identifier","Identifier"],["dc:language","Language"],["dc:subject","Subject"],["dc:title","Title"],["dcterms:created","CreatedDate","date"],["dcterms:modified","ModifiedDate","date"]];function cp_doit(t,r,e,s,a){a[t]!=null||r==null||r===""||(a[t]=r,r=escapexml(r),s[s.length]=e?writextag(t,r,e):writetag(t,r))}function write_core_props(t,r){var e=r||{},s=[XML_HEADER,writextag("cp:coreProperties",null,{"xmlns:cp":XMLNS.CORE_PROPS,"xmlns:dc":XMLNS.dc,"xmlns:dcterms":XMLNS.dcterms,"xmlns:dcmitype":XMLNS.dcmitype,"xmlns:xsi":XMLNS.xsi})],a={};if(!t&&!e.Props)return s.join("");t&&(t.CreatedDate!=null&&cp_doit("dcterms:created",typeof t.CreatedDate=="string"?t.CreatedDate:write_w3cdtf(t.CreatedDate,e.WTF),{"xsi:type":"dcterms:W3CDTF"},s,a),t.ModifiedDate!=null&&cp_doit("dcterms:modified",typeof t.ModifiedDate=="string"?t.ModifiedDate:write_w3cdtf(t.ModifiedDate,e.WTF),{"xsi:type":"dcterms:W3CDTF"},s,a));for(var i=0;i!=CORE_PROPS.length;++i){var o=CORE_PROPS[i],c=e.Props&&e.Props[o[1]]!=null?e.Props[o[1]]:t?t[o[1]]:null;c===!0?c="1":c===!1?c="0":typeof c=="number"&&(c=String(c)),c!=null&&cp_doit(o[0],c,null,s,a)}return s.length>2&&(s[s.length]="</cp:coreProperties>",s[1]=s[1].replace("/>",">")),s.join("")}var EXT_PROPS=[["Application","Application","string"],["AppVersion","AppVersion","string"],["Company","Company","string"],["DocSecurity","DocSecurity","string"],["Manager","Manager","string"],["HyperlinksChanged","HyperlinksChanged","bool"],["SharedDoc","SharedDoc","bool"],["LinksUpToDate","LinksUpToDate","bool"],["ScaleCrop","ScaleCrop","bool"],["HeadingPairs","HeadingPairs","raw"],["TitlesOfParts","TitlesOfParts","raw"]],PseudoPropsPairs=["Worksheets","SheetNames","NamedRanges","DefinedNames","Chartsheets","ChartNames"];function write_ext_props(t){var r=[],e=writextag;return t||(t={}),t.Application="SheetJS",r[r.length]=XML_HEADER,r[r.length]=writextag("Properties",null,{xmlns:XMLNS.EXT_PROPS,"xmlns:vt":XMLNS.vt}),EXT_PROPS.forEach(function(s){if(t[s[1]]!==void 0){var a;switch(s[2]){case"string":a=escapexml(String(t[s[1]]));break;case"bool":a=t[s[1]]?"true":"false";break}a!==void 0&&(r[r.length]=e(s[0],a))}}),r[r.length]=e("HeadingPairs",e("vt:vector",e("vt:variant","<vt:lpstr>Worksheets</vt:lpstr>")+e("vt:variant",e("vt:i4",String(t.Worksheets))),{size:2,baseType:"variant"})),r[r.length]=e("TitlesOfParts",e("vt:vector",t.SheetNames.map(function(s){return"<vt:lpstr>"+escapexml(s)+"</vt:lpstr>"}).join(""),{size:t.Worksheets,baseType:"lpstr"})),r.length>2&&(r[r.length]="</Properties>",r[1]=r[1].replace("/>",">")),r.join("")}function write_cust_props(t){var r=[XML_HEADER,writextag("Properties",null,{xmlns:XMLNS.CUST_PROPS,"xmlns:vt":XMLNS.vt})];if(!t)return r.join("");var e=1;return keys(t).forEach(function(a){++e,r[r.length]=writextag("property",write_vt(t[a]),{fmtid:"{D5CDD505-2E9C-101B-9397-08002B2CF9AE}",pid:e,name:escapexml(a)})}),r.length>2&&(r[r.length]="</Properties>",r[1]=r[1].replace("/>",">")),r.join("")}var XLMLDocPropsMap={Title:"Title",Subject:"Subject",Author:"Author",Keywords:"Keywords",Comments:"Description",LastAuthor:"LastAuthor",RevNumber:"Revision",Application:"AppName",LastPrinted:"LastPrinted",CreatedDate:"Created",ModifiedDate:"LastSaved",Category:"Category",Manager:"Manager",Company:"Company",AppVersion:"Version",ContentStatus:"ContentStatus",Identifier:"Identifier",Language:"Language"};function xlml_write_docprops(t,r){var e=[];return keys(XLMLDocPropsMap).map(function(s){for(var a=0;a<CORE_PROPS.length;++a)if(CORE_PROPS[a][1]==s)return CORE_PROPS[a];for(a=0;a<EXT_PROPS.length;++a)if(EXT_PROPS[a][1]==s)return EXT_PROPS[a];throw s}).forEach(function(s){if(t[s[1]]!=null){var a=r&&r.Props&&r.Props[s[1]]!=null?r.Props[s[1]]:t[s[1]];switch(s[2]){case"date":a=new Date(a).toISOString().replace(/\.\d*Z/,"Z");break}typeof a=="number"?a=String(a):a===!0||a===!1?a=a?"1":"0":a instanceof Date&&(a=new Date(a).toISOString().replace(/\.\d*Z/,"")),e.push(writetag(XLMLDocPropsMap[s[1]]||s[1],a))}}),writextag("DocumentProperties",e.join(""),{xmlns:XLMLNS.o})}function xlml_write_custprops(t,r){var e=["Worksheets","SheetNames"],s="CustomDocumentProperties",a=[];return t&&keys(t).forEach(function(i){if(Object.prototype.hasOwnProperty.call(t,i)){for(var o=0;o<CORE_PROPS.length;++o)if(i==CORE_PROPS[o][1])return;for(o=0;o<EXT_PROPS.length;++o)if(i==EXT_PROPS[o][1])return;for(o=0;o<e.length;++o)if(i==e[o])return;var c=t[i],h="string";typeof c=="number"?(h="float",c=String(c)):c===!0||c===!1?(h="boolean",c=c?"1":"0"):c=String(c),a.push(writextag(escapexmltag(i),c,{"dt:dt":h}))}}),r&&keys(r).forEach(function(i){if(Object.prototype.hasOwnProperty.call(r,i)&&!(t&&Object.prototype.hasOwnProperty.call(t,i))){var o=r[i],c="string";typeof o=="number"?(c="float",o=String(o)):o===!0||o===!1?(c="boolean",o=o?"1":"0"):o instanceof Date?(c="dateTime.tz",o=o.toISOString()):o=String(o),a.push(writextag(escapexmltag(i),o,{"dt:dt":c}))}}),"<"+s+' xmlns="'+XLMLNS.o+'">'+a.join("")+"</"+s+">"}function write_FILETIME(t){var r=typeof t=="string"?new Date(Date.parse(t)):t,e=r.getTime()/1e3+11644473600,s=e%Math.pow(2,32),a=(e-s)/Math.pow(2,32);s*=1e7,a*=1e7;var i=s/Math.pow(2,32)|0;i>0&&(s=s%Math.pow(2,32),a+=i);var o=new_buf(8);return o.write_shift(4,s),o.write_shift(4,a),o}function write_TypedPropertyValue(t,r){var e=new_buf(4),s=new_buf(4);switch(e.write_shift(4,t==80?31:t),t){case 3:s.write_shift(-4,r);break;case 5:s=new_buf(8),s.write_shift(8,r,"f");break;case 11:s.write_shift(4,r?1:0);break;case 64:s=write_FILETIME(r);break;case 31:case 80:for(s=new_buf(4+2*(r.length+1)+(r.length%2?0:2)),s.write_shift(4,r.length+1),s.write_shift(0,r,"dbcs");s.l!=s.length;)s.write_shift(1,0);break;default:throw new Error("TypedPropertyValue unrecognized type "+t+" "+r)}return bconcat([e,s])}var XLSPSSkip=["CodePage","Thumbnail","_PID_LINKBASE","_PID_HLINKS","SystemIdentifier","FMTID"];function guess_property_type(t){switch(typeof t){case"boolean":return 11;case"number":return(t|0)==t?3:5;case"string":return 31;case"object":if(t instanceof Date)return 64;break}return-1}function write_PropertySet(t,r,e){var s=new_buf(8),a=[],i=[],o=8,c=0,h=new_buf(8),u=new_buf(8);if(h.write_shift(4,2),h.write_shift(4,1200),u.write_shift(4,1),i.push(h),a.push(u),o+=8+h.length,!r){u=new_buf(8),u.write_shift(4,0),a.unshift(u);var d=[new_buf(4)];for(d[0].write_shift(4,t.length),c=0;c<t.length;++c){var _=t[c][0];for(h=new_buf(8+2*(_.length+1)+(_.length%2?0:2)),h.write_shift(4,c+2),h.write_shift(4,_.length+1),h.write_shift(0,_,"dbcs");h.l!=h.length;)h.write_shift(1,0);d.push(h)}h=bconcat(d),i.unshift(h),o+=8+h.length}for(c=0;c<t.length;++c)if(!(r&&!r[t[c][0]])&&!(XLSPSSkip.indexOf(t[c][0])>-1||PseudoPropsPairs.indexOf(t[c][0])>-1)&&t[c][1]!=null){var b=t[c][1],v=0;if(r){v=+r[t[c][0]];var E=e[v];if(E.p=="version"&&typeof b=="string"){var x=b.split(".");b=(+x[0]<<16)+(+x[1]||0)}h=write_TypedPropertyValue(E.t,b)}else{var g=guess_property_type(b);g==-1&&(g=31,b=String(b)),h=write_TypedPropertyValue(g,b)}i.push(h),u=new_buf(8),u.write_shift(4,r?v:2+c),a.push(u),o+=8+h.length}var w=8*(i.length+1);for(c=0;c<i.length;++c)a[c].write_shift(4,w),w+=i[c].length;return s.write_shift(4,o),s.write_shift(4,i.length),bconcat([s].concat(a).concat(i))}function write_PropertySetStream(t,r,e,s,a,i){var o=new_buf(a?68:48),c=[o];o.write_shift(2,65534),o.write_shift(2,0),o.write_shift(4,842412599),o.write_shift(16,CFB.utils.consts.HEADER_CLSID,"hex"),o.write_shift(4,a?2:1),o.write_shift(16,r,"hex"),o.write_shift(4,a?68:48);var h=write_PropertySet(t,e,s);if(c.push(h),a){var u=write_PropertySet(a,null,null);o.write_shift(16,i,"hex"),o.write_shift(4,68+h.length),c.push(u)}return bconcat(c)}function writezeroes(t,r){r||(r=new_buf(t));for(var e=0;e<t;++e)r.write_shift(1,0);return r}function parsebool(t,r){return t.read_shift(r)===1}function writebool(t,r){return r||(r=new_buf(2)),r.write_shift(2,+!!t),r}function parseuint16(t){return t.read_shift(2,"u")}function writeuint16(t,r){return r||(r=new_buf(2)),r.write_shift(2,t),r}function write_Bes(t,r,e){return e||(e=new_buf(2)),e.write_shift(1,r=="e"?+t:+!!t),e.write_shift(1,r=="e"?1:0),e}function parse_ShortXLUnicodeString(t,r,e){var s=t.read_shift(e&&e.biff>=12?2:1),a="sbcs-cont";if(e&&e.biff>=8,!e||e.biff==8){var i=t.read_shift(1);i&&(a="dbcs-cont")}else e.biff==12&&(a="wstr");e.biff>=2&&e.biff<=5&&(a="cpstr");var o=s?t.read_shift(s,a):"";return o}function write_XLUnicodeRichExtendedString(t){var r=t.t||"",e=new_buf(3);e.write_shift(2,r.length),e.write_shift(1,1);var s=new_buf(2*r.length);s.write_shift(2*r.length,r,"utf16le");var a=[e,s];return bconcat(a)}function parse_XLUnicodeStringNoCch(t,r,e){var s;if(e){if(e.biff>=2&&e.biff<=5)return t.read_shift(r,"cpstr");if(e.biff>=12)return t.read_shift(r,"dbcs-cont")}var a=t.read_shift(1);return a===0?s=t.read_shift(r,"sbcs-cont"):s=t.read_shift(r,"dbcs-cont"),s}function parse_XLUnicodeString(t,r,e){var s=t.read_shift(e&&e.biff==2?1:2);return s===0?(t.l++,""):parse_XLUnicodeStringNoCch(t,s,e)}function parse_XLUnicodeString2(t,r,e){if(e.biff>5)return parse_XLUnicodeString(t,r,e);var s=t.read_shift(1);return s===0?(t.l++,""):t.read_shift(s,e.biff<=4||!t.lens?"cpstr":"sbcs-cont")}function write_XLUnicodeString(t,r,e){return e||(e=new_buf(3+2*t.length)),e.write_shift(2,t.length),e.write_shift(1,1),e.write_shift(31,t,"utf16le"),e}function write_HyperlinkString(t,r){r||(r=new_buf(6+t.length*2)),r.write_shift(4,1+t.length);for(var e=0;e<t.length;++e)r.write_shift(2,t.charCodeAt(e));return r.write_shift(2,0),r}function write_Hyperlink(t){var r=new_buf(512),e=0,s=t.Target;s.slice(0,7)=="file://"&&(s=s.slice(7));var a=s.indexOf("#"),i=a>-1?31:23;switch(s.charAt(0)){case"#":i=28;break;case".":i&=-3;break}r.write_shift(4,2),r.write_shift(4,i);var o=[8,6815827,6619237,4849780,83];for(e=0;e<o.length;++e)r.write_shift(4,o[e]);if(i==28)s=s.slice(1),write_HyperlinkString(s,r);else if(i&2){for(o="e0 c9 ea 79 f9 ba ce 11 8c 82 00 aa 00 4b a9 0b".split(" "),e=0;e<o.length;++e)r.write_shift(1,parseInt(o[e],16));var c=a>-1?s.slice(0,a):s;for(r.write_shift(4,2*(c.length+1)),e=0;e<c.length;++e)r.write_shift(2,c.charCodeAt(e));r.write_shift(2,0),i&8&&write_HyperlinkString(a>-1?s.slice(a+1):"",r)}else{for(o="03 03 00 00 00 00 00 00 c0 00 00 00 00 00 00 46".split(" "),e=0;e<o.length;++e)r.write_shift(1,parseInt(o[e],16));for(var h=0;s.slice(h*3,h*3+3)=="../"||s.slice(h*3,h*3+3)=="..\\";)++h;for(r.write_shift(2,h),r.write_shift(4,s.length-3*h+1),e=0;e<s.length-3*h;++e)r.write_shift(1,s.charCodeAt(e+3*h)&255);for(r.write_shift(1,0),r.write_shift(2,65535),r.write_shift(2,57005),e=0;e<6;++e)r.write_shift(4,0)}return r.slice(0,r.l)}function write_XLSCell(t,r,e,s){return s||(s=new_buf(6)),s.write_shift(2,t),s.write_shift(2,r),s.write_shift(2,e||0),s}function parse_XTI(t,r,e){var s=e.biff>8?4:2,a=t.read_shift(s),i=t.read_shift(s,"i"),o=t.read_shift(s,"i");return[a,i,o]}function parse_Ref8U(t){var r=t.read_shift(2),e=t.read_shift(2),s=t.read_shift(2),a=t.read_shift(2);return{s:{c:s,r},e:{c:a,r:e}}}function write_Ref8U(t,r){return r||(r=new_buf(8)),r.write_shift(2,t.s.r),r.write_shift(2,t.e.r),r.write_shift(2,t.s.c),r.write_shift(2,t.e.c),r}function write_BOF(t,r,e){var s=1536,a=16;switch(e.bookType){case"biff8":break;case"biff5":s=1280,a=8;break;case"biff4":s=4,a=6;break;case"biff3":s=3,a=6;break;case"biff2":s=2,a=4;break;case"xla":break;default:throw new Error("unsupported BIFF version")}var i=new_buf(a);return i.write_shift(2,s),i.write_shift(2,r),a>4&&i.write_shift(2,29282),a>6&&i.write_shift(2,1997),a>8&&(i.write_shift(2,49161),i.write_shift(2,1),i.write_shift(2,1798),i.write_shift(2,0)),i}function write_WriteAccess(t,r){var e=!r||r.biff==8,s=new_buf(e?112:54);for(s.write_shift(r.biff==8?2:1,7),e&&s.write_shift(1,0),s.write_shift(4,859007059),s.write_shift(4,5458548|(e?0:536870912));s.l<s.length;)s.write_shift(1,e?0:32);return s}function write_BoundSheet8(t,r){var e=!r||r.biff>=8?2:1,s=new_buf(8+e*t.name.length);s.write_shift(4,t.pos),s.write_shift(1,t.hs||0),s.write_shift(1,t.dt),s.write_shift(1,t.name.length),r.biff>=8&&s.write_shift(1,1),s.write_shift(e*t.name.length,t.name,r.biff<8?"sbcs":"utf16le");var a=s.slice(0,s.l);return a.l=s.l,a}function write_SST(t,r){var e=new_buf(8);e.write_shift(4,t.Count),e.write_shift(4,t.Unique);for(var s=[],a=0;a<t.length;++a)s[a]=write_XLUnicodeRichExtendedString(t[a]);var i=bconcat([e].concat(s));return i.parts=[e.length].concat(s.map(function(o){return o.length})),i}function write_Window1(){var t=new_buf(18);return t.write_shift(2,0),t.write_shift(2,0),t.write_shift(2,29280),t.write_shift(2,17600),t.write_shift(2,56),t.write_shift(2,0),t.write_shift(2,0),t.write_shift(2,1),t.write_shift(2,500),t}function write_Window2(t){var r=new_buf(18),e=1718;return t&&t.RTL&&(e|=64),r.write_shift(2,e),r.write_shift(4,0),r.write_shift(4,64),r.write_shift(4,0),r.write_shift(4,0),r}function write_Font(t,r){var e=t.name||"Arial",s=r&&r.biff==5,a=s?15+e.length:16+2*e.length,i=new_buf(a);return i.write_shift(2,t.sz*20),i.write_shift(4,0),i.write_shift(2,400),i.write_shift(4,0),i.write_shift(2,0),i.write_shift(1,e.length),s||i.write_shift(1,1),i.write_shift((s?1:2)*e.length,e,s?"sbcs":"utf16le"),i}function write_LabelSst(t,r,e,s){var a=new_buf(10);return write_XLSCell(t,r,s,a),a.write_shift(4,e),a}function write_Label(t,r,e,s,a){var i=!a||a.biff==8,o=new_buf(8+ +i+(1+i)*e.length);return write_XLSCell(t,r,s,o),o.write_shift(2,e.length),i&&o.write_shift(1,1),o.write_shift((1+i)*e.length,e,i?"utf16le":"sbcs"),o}function write_Format(t,r,e,s){var a=e&&e.biff==5;s||(s=new_buf(a?3+r.length:5+2*r.length)),s.write_shift(2,t),s.write_shift(a?1:2,r.length),a||s.write_shift(1,1),s.write_shift((a?1:2)*r.length,r,a?"sbcs":"utf16le");var i=s.length>s.l?s.slice(0,s.l):s;return i.l==null&&(i.l=i.length),i}function write_Dimensions(t,r){var e=r.biff==8||!r.biff?4:2,s=new_buf(2*e+6);return s.write_shift(e,t.s.r),s.write_shift(e,t.e.r+1),s.write_shift(2,t.s.c),s.write_shift(2,t.e.c+1),s.write_shift(2,0),s}function write_XF(t,r,e,s){var a=e&&e.biff==5;s||(s=new_buf(a?16:20)),s.write_shift(2,0),t.style?(s.write_shift(2,t.numFmtId||0),s.write_shift(2,65524)):(s.write_shift(2,t.numFmtId||0),s.write_shift(2,r<<4));var i=0;return t.numFmtId>0&&a&&(i|=1024),s.write_shift(4,i),s.write_shift(4,0),a||s.write_shift(4,0),s.write_shift(2,0),s}function write_Guts(t){var r=new_buf(8);return r.write_shift(4,0),r.write_shift(2,0),r.write_shift(2,0),r}function write_BoolErr(t,r,e,s,a,i){var o=new_buf(8);return write_XLSCell(t,r,s,o),write_Bes(e,i,o),o}function write_Number(t,r,e,s){var a=new_buf(14);return write_XLSCell(t,r,s,a),write_Xnum(e,a),a}function parse_ExternSheet(t,r,e){if(e.biff<8)return parse_BIFF5ExternSheet(t,r,e);for(var s=[],a=t.l+r,i=t.read_shift(e.biff>8?4:2);i--!==0;)s.push(parse_XTI(t,e.biff>8?12:6,e));if(t.l!=a)throw new Error("Bad ExternSheet: "+t.l+" != "+a);return s}function parse_BIFF5ExternSheet(t,r,e){t[t.l+1]==3&&t[t.l]++;var s=parse_ShortXLUnicodeString(t,r,e);return s.charCodeAt(0)==3?s.slice(1):s}function write_MergeCells(t){var r=new_buf(2+t.length*8);r.write_shift(2,t.length);for(var e=0;e<t.length;++e)write_Ref8U(t[e],r);return r}function write_HLink(t){var r=new_buf(24),e=decode_cell(t[0]);r.write_shift(2,e.r),r.write_shift(2,e.r),r.write_shift(2,e.c),r.write_shift(2,e.c);for(var s="d0 c9 ea 79 f9 ba ce 11 8c 82 00 aa 00 4b a9 0b".split(" "),a=0;a<16;++a)r.write_shift(1,parseInt(s[a],16));return bconcat([r,write_Hyperlink(t[1])])}function write_HLinkTooltip(t){var r=t[1].Tooltip,e=new_buf(10+2*(r.length+1));e.write_shift(2,2048);var s=decode_cell(t[0]);e.write_shift(2,s.r),e.write_shift(2,s.r),e.write_shift(2,s.c),e.write_shift(2,s.c);for(var a=0;a<r.length;++a)e.write_shift(2,r.charCodeAt(a));return e.write_shift(2,0),e}function write_Country(t){return t||(t=new_buf(4)),t.write_shift(2,1),t.write_shift(2,1),t}function parse_ColInfo(t,r,e){if(!e.cellStyles)return parsenoop(t,r);var s=e&&e.biff>=12?4:2,a=t.read_shift(s),i=t.read_shift(s),o=t.read_shift(s),c=t.read_shift(s),h=t.read_shift(2);s==2&&(t.l+=2);var u={s:a,e:i,w:o,ixfe:c,flags:h};return(e.biff>=5||!e.biff)&&(u.level=h>>8&7),u}function write_ColInfo(t,r){var e=new_buf(12);e.write_shift(2,r),e.write_shift(2,r),e.write_shift(2,t.width*256),e.write_shift(2,0);var s=0;return t.hidden&&(s|=1),e.write_shift(1,s),s=t.level||0,e.write_shift(1,s),e.write_shift(2,0),e}function write_RRTabId(t){for(var r=new_buf(2*t),e=0;e<t;++e)r.write_shift(2,e+1);return r}function write_BIFF2NUM(t,r,e){var s=new_buf(15);return write_BIFF2Cell(s,t,r),s.write_shift(8,e,"f"),s}function write_BIFF2INT(t,r,e){var s=new_buf(9);return write_BIFF2Cell(s,t,r),s.write_shift(2,e),s}var DBF=function(){var t={1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127,8:865,9:437,10:850,11:437,13:437,14:850,15:437,16:850,17:437,18:850,19:932,20:850,21:437,22:850,23:865,24:437,25:437,26:850,27:437,28:863,29:850,31:852,34:852,35:852,36:860,37:850,38:866,55:850,64:852,77:936,78:949,79:950,80:874,87:1252,88:1252,89:1252,108:863,134:737,135:852,136:857,204:1257,255:16969},r=evert({1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127});function e(c,h){var u=[],d=new_raw_buf(1);switch(h.type){case"base64":d=s2a(Base64_decode(c));break;case"binary":d=s2a(c);break;case"buffer":case"array":d=c;break}prep_blob(d,0);var _=d.read_shift(1),b=!!(_&136),v=!1,E=!1;switch(_){case 2:break;case 3:break;case 48:v=!0,b=!0;break;case 49:v=!0,b=!0;break;case 131:break;case 139:break;case 140:E=!0;break;case 245:break;default:throw new Error("DBF Unsupported Version: "+_.toString(16))}var x=0,g=521;_==2&&(x=d.read_shift(2)),d.l+=3,_!=2&&(x=d.read_shift(4)),x>1048576&&(x=1e6),_!=2&&(g=d.read_shift(2));var w=d.read_shift(2),R=h.codepage||1252;_!=2&&(d.l+=16,d.read_shift(1),d[d.l]!==0&&(R=t[d[d.l]]),d.l+=1,d.l+=2),E&&(d.l+=36);for(var N=[],M={},A=Math.min(d.length,_==2?521:g-10-(v?264:0)),I=E?32:11;d.l<A&&d[d.l]!=13;)switch(M={},M.name=$cptable.utils.decode(R,d.slice(d.l,d.l+I)).replace(/[\u0000\r\n].*$/g,""),d.l+=I,M.type=String.fromCharCode(d.read_shift(1)),_!=2&&!E&&(M.offset=d.read_shift(4)),M.len=d.read_shift(1),_==2&&(M.offset=d.read_shift(2)),M.dec=d.read_shift(1),M.name.length&&N.push(M),_!=2&&(d.l+=E?13:14),M.type){case"B":(!v||M.len!=8)&&h.WTF&&console.log("Skipping "+M.name+":"+M.type);break;case"G":case"P":h.WTF&&console.log("Skipping "+M.name+":"+M.type);break;case"+":case"0":case"@":case"C":case"D":case"F":case"I":case"L":case"M":case"N":case"O":case"T":case"Y":break;default:throw new Error("Unknown Field Type: "+M.type)}if(d[d.l]!==13&&(d.l=g-1),d.read_shift(1)!==13)throw new Error("DBF Terminator not found "+d.l+" "+d[d.l]);d.l=g;var y=0,j=0;for(u[0]=[],j=0;j!=N.length;++j)u[0][j]=N[j].name;for(;x-- >0;){if(d[d.l]===42){d.l+=w;continue}for(++d.l,u[++y]=[],j=0,j=0;j!=N.length;++j){var T=d.slice(d.l,d.l+N[j].len);d.l+=N[j].len,prep_blob(T,0);var U=$cptable.utils.decode(R,T);switch(N[j].type){case"C":U.trim().length&&(u[y][j]=U.replace(/\s+$/,""));break;case"D":U.length===8?u[y][j]=new Date(+U.slice(0,4),+U.slice(4,6)-1,+U.slice(6,8)):u[y][j]=U;break;case"F":u[y][j]=parseFloat(U.trim());break;case"+":case"I":u[y][j]=E?T.read_shift(-4,"i")^2147483648:T.read_shift(4,"i");break;case"L":switch(U.trim().toUpperCase()){case"Y":case"T":u[y][j]=!0;break;case"N":case"F":u[y][j]=!1;break;case"":case"?":break;default:throw new Error("DBF Unrecognized L:|"+U+"|")}break;case"M":if(!b)throw new Error("DBF Unexpected MEMO for type "+_.toString(16));u[y][j]="##MEMO##"+(E?parseInt(U.trim(),10):T.read_shift(4));break;case"N":U=U.replace(/\u0000/g,"").trim(),U&&U!="."&&(u[y][j]=+U||0);break;case"@":u[y][j]=new Date(T.read_shift(-8,"f")-621356832e5);break;case"T":u[y][j]=new Date((T.read_shift(4)-2440588)*864e5+T.read_shift(4));break;case"Y":u[y][j]=T.read_shift(4,"i")/1e4+T.read_shift(4,"i")/1e4*Math.pow(2,32);break;case"O":u[y][j]=-T.read_shift(-8,"f");break;case"B":if(v&&N[j].len==8){u[y][j]=T.read_shift(8,"f");break}case"G":case"P":T.l+=N[j].len;break;case"0":if(N[j].name==="_NullFlags")break;default:throw new Error("DBF Unsupported data type "+N[j].type)}}}if(_!=2&&d.l<d.length&&d[d.l++]!=26)throw new Error("DBF EOF Marker missing "+(d.l-1)+" of "+d.length+" "+d[d.l-1].toString(16));return h&&h.sheetRows&&(u=u.slice(0,h.sheetRows)),h.DBF=N,u}function s(c,h){var u=h||{};u.dateNF||(u.dateNF="yyyymmdd");var d=aoa_to_sheet(e(c,u),u);return d["!cols"]=u.DBF.map(function(_){return{wch:_.len,DBF:_}}),delete u.DBF,d}function a(c,h){try{return sheet_to_workbook(s(c,h),h)}catch(u){if(h&&h.WTF)throw u}return{SheetNames:[],Sheets:{}}}var i={B:8,C:250,L:1,D:8,"?":0,"":0};function o(c,h){var u=h||{};if(+u.codepage>=0&&set_cp(+u.codepage),u.type=="string")throw new Error("Cannot write DBF to JS string");var d=buf_array(),_=sheet_to_json(c,{header:1,raw:!0,cellDates:!0}),b=_[0],v=_.slice(1),E=c["!cols"]||[],x=0,g=0,w=0,R=1;for(x=0;x<b.length;++x){if(((E[x]||{}).DBF||{}).name){b[x]=E[x].DBF.name,++w;continue}if(b[x]!=null){if(++w,typeof b[x]=="number"&&(b[x]=b[x].toString(10)),typeof b[x]!="string")throw new Error("DBF Invalid column name "+b[x]+" |"+typeof b[x]+"|");if(b.indexOf(b[x])!==x){for(g=0;g<1024;++g)if(b.indexOf(b[x]+"_"+g)==-1){b[x]+="_"+g;break}}}}var N=safe_decode_range(c["!ref"]),M=[],A=[],I=[];for(x=0;x<=N.e.c-N.s.c;++x){var y="",j="",T=0,U=[];for(g=0;g<v.length;++g)v[g][x]!=null&&U.push(v[g][x]);if(U.length==0||b[x]==null){M[x]="?";continue}for(g=0;g<U.length;++g){switch(typeof U[g]){case"number":j="B";break;case"string":j="C";break;case"boolean":j="L";break;case"object":j=U[g]instanceof Date?"D":"C";break;default:j="C"}T=Math.max(T,String(U[g]).length),y=y&&y!=j?"C":j}T>250&&(T=250),j=((E[x]||{}).DBF||{}).type,j=="C"&&E[x].DBF.len>T&&(T=E[x].DBF.len),y=="B"&&j=="N"&&(y="N",I[x]=E[x].DBF.dec,T=E[x].DBF.len),A[x]=y=="C"||j=="N"?T:i[y]||0,R+=A[x],M[x]=y}var F=d.next(32);for(F.write_shift(4,318902576),F.write_shift(4,v.length),F.write_shift(2,296+32*w),F.write_shift(2,R),x=0;x<4;++x)F.write_shift(4,0);for(F.write_shift(4,0|(+r[current_ansi]||3)<<8),x=0,g=0;x<b.length;++x)if(b[x]!=null){var H=d.next(32),z=(b[x].slice(-10)+"\0\0\0\0\0\0\0\0\0\0\0").slice(0,11);H.write_shift(1,z,"sbcs"),H.write_shift(1,M[x]=="?"?"C":M[x],"sbcs"),H.write_shift(4,g),H.write_shift(1,A[x]||i[M[x]]||0),H.write_shift(1,I[x]||0),H.write_shift(1,2),H.write_shift(4,0),H.write_shift(1,0),H.write_shift(4,0),H.write_shift(4,0),g+=A[x]||i[M[x]]||0}var de=d.next(264);for(de.write_shift(4,13),x=0;x<65;++x)de.write_shift(4,0);for(x=0;x<v.length;++x){var se=d.next(R);for(se.write_shift(1,0),g=0;g<b.length;++g)if(b[g]!=null)switch(M[g]){case"L":se.write_shift(1,v[x][g]==null?63:v[x][g]?84:70);break;case"B":se.write_shift(8,v[x][g]||0,"f");break;case"N":var ue="0";for(typeof v[x][g]=="number"&&(ue=v[x][g].toFixed(I[g]||0)),w=0;w<A[g]-ue.length;++w)se.write_shift(1,32);se.write_shift(1,ue,"sbcs");break;case"D":v[x][g]?(se.write_shift(4,("0000"+v[x][g].getFullYear()).slice(-4),"sbcs"),se.write_shift(2,("00"+(v[x][g].getMonth()+1)).slice(-2),"sbcs"),se.write_shift(2,("00"+v[x][g].getDate()).slice(-2),"sbcs")):se.write_shift(8,"00000000","sbcs");break;case"C":var Z=String(v[x][g]!=null?v[x][g]:"").slice(0,A[g]);for(se.write_shift(1,Z,"sbcs"),w=0;w<A[g]-Z.length;++w)se.write_shift(1,32);break}}return d.next(1).write_shift(1,26),d.end()}return{to_workbook:a,to_sheet:s,from_sheet:o}}(),SYLK=function(){var t={AA:"À",BA:"Á",CA:"Â",DA:195,HA:"Ä",JA:197,AE:"È",BE:"É",CE:"Ê",HE:"Ë",AI:"Ì",BI:"Í",CI:"Î",HI:"Ï",AO:"Ò",BO:"Ó",CO:"Ô",DO:213,HO:"Ö",AU:"Ù",BU:"Ú",CU:"Û",HU:"Ü",Aa:"à",Ba:"á",Ca:"â",Da:227,Ha:"ä",Ja:229,Ae:"è",Be:"é",Ce:"ê",He:"ë",Ai:"ì",Bi:"í",Ci:"î",Hi:"ï",Ao:"ò",Bo:"ó",Co:"ô",Do:245,Ho:"ö",Au:"ù",Bu:"ú",Cu:"û",Hu:"ü",KC:"Ç",Kc:"ç",q:"æ",z:"œ",a:"Æ",j:"Œ",DN:209,Dn:241,Hy:255,S:169,c:170,R:174,"B ":180,0:176,1:177,2:178,3:179,5:181,6:182,7:183,Q:185,k:186,b:208,i:216,l:222,s:240,y:248,"!":161,'"':162,"#":163,"(":164,"%":165,"'":167,"H ":168,"+":171,";":187,"<":188,"=":189,">":190,"?":191,"{":223},r=new RegExp("\x1BN("+keys(t).join("|").replace(/\|\|\|/,"|\\||").replace(/([?()+])/g,"\\$1")+"|\\|)","gm"),e=function(b,v){var E=t[v];return typeof E=="number"?_getansi(E):E},s=function(b,v,E){var x=v.charCodeAt(0)-32<<4|E.charCodeAt(0)-48;return x==59?b:_getansi(x)};t["|"]=254;function a(b,v){switch(v.type){case"base64":return i(Base64_decode(b),v);case"binary":return i(b,v);case"buffer":return i(has_buf&&Buffer.isBuffer(b)?b.toString("binary"):a2s(b),v);case"array":return i(cc2str(b),v)}throw new Error("Unrecognized type "+v.type)}function i(b,v){var E=b.split(/[\n\r]+/),x=-1,g=-1,w=0,R=0,N=[],M=[],A=null,I={},y=[],j=[],T=[],U=0,F;for(+v.codepage>=0&&set_cp(+v.codepage);w!==E.length;++w){U=0;var H=E[w].trim().replace(/\x1B([\x20-\x2F])([\x30-\x3F])/g,s).replace(r,e),z=H.replace(/;;/g,"\0").split(";").map(function(P){return P.replace(/\u0000/g,";")}),de=z[0],se;if(H.length>0)switch(de){case"ID":break;case"E":break;case"B":break;case"O":break;case"W":break;case"P":z[1].charAt(0)=="P"&&M.push(H.slice(3).replace(/;;/g,";"));break;case"C":var ue=!1,Z=!1,ge=!1,re=!1,oe=-1,be=-1;for(R=1;R<z.length;++R)switch(z[R].charAt(0)){case"A":break;case"X":g=parseInt(z[R].slice(1))-1,Z=!0;break;case"Y":for(x=parseInt(z[R].slice(1))-1,Z||(g=0),F=N.length;F<=x;++F)N[F]=[];break;case"K":se=z[R].slice(1),se.charAt(0)==='"'?se=se.slice(1,se.length-1):se==="TRUE"?se=!0:se==="FALSE"?se=!1:isNaN(fuzzynum(se))?isNaN(fuzzydate(se).getDate())||(se=parseDate(se)):(se=fuzzynum(se),A!==null&&fmt_is_date(A)&&(se=numdate(se))),ue=!0;break;case"E":re=!0;var L=rc_to_a1(z[R].slice(1),{r:x,c:g});N[x][g]=[N[x][g],L];break;case"S":ge=!0,N[x][g]=[N[x][g],"S5S"];break;case"G":break;case"R":oe=parseInt(z[R].slice(1))-1;break;case"C":be=parseInt(z[R].slice(1))-1;break;default:if(v&&v.WTF)throw new Error("SYLK bad record "+H)}if(ue&&(N[x][g]&&N[x][g].length==2?N[x][g][0]=se:N[x][g]=se,A=null),ge){if(re)throw new Error("SYLK shared formula cannot have own formula");var S=oe>-1&&N[oe][be];if(!S||!S[1])throw new Error("SYLK shared formula cannot find base");N[x][g][1]=shift_formula_str(S[1],{r:x-oe,c:g-be})}break;case"F":var C=0;for(R=1;R<z.length;++R)switch(z[R].charAt(0)){case"X":g=parseInt(z[R].slice(1))-1,++C;break;case"Y":for(x=parseInt(z[R].slice(1))-1,F=N.length;F<=x;++F)N[F]=[];break;case"M":U=parseInt(z[R].slice(1))/20;break;case"F":break;case"G":break;case"P":A=M[parseInt(z[R].slice(1))];break;case"S":break;case"D":break;case"N":break;case"W":for(T=z[R].slice(1).split(" "),F=parseInt(T[0],10);F<=parseInt(T[1],10);++F)U=parseInt(T[2],10),j[F-1]=U===0?{hidden:!0}:{wch:U},process_col(j[F-1]);break;case"C":g=parseInt(z[R].slice(1))-1,j[g]||(j[g]={});break;case"R":x=parseInt(z[R].slice(1))-1,y[x]||(y[x]={}),U>0?(y[x].hpt=U,y[x].hpx=pt2px(U)):U===0&&(y[x].hidden=!0);break;default:if(v&&v.WTF)throw new Error("SYLK bad record "+H)}C<1&&(A=null);break;default:if(v&&v.WTF)throw new Error("SYLK bad record "+H)}}return y.length>0&&(I["!rows"]=y),j.length>0&&(I["!cols"]=j),v&&v.sheetRows&&(N=N.slice(0,v.sheetRows)),[N,I]}function o(b,v){var E=a(b,v),x=E[0],g=E[1],w=aoa_to_sheet(x,v);return keys(g).forEach(function(R){w[R]=g[R]}),w}function c(b,v){return sheet_to_workbook(o(b,v),v)}function h(b,v,E,x){var g="C;Y"+(E+1)+";X"+(x+1)+";K";switch(b.t){case"n":g+=b.v||0,b.f&&!b.F&&(g+=";E"+a1_to_rc(b.f,{r:E,c:x}));break;case"b":g+=b.v?"TRUE":"FALSE";break;case"e":g+=b.w||b.v;break;case"d":g+='"'+(b.w||b.v)+'"';break;case"s":g+='"'+b.v.replace(/"/g,"").replace(/;/g,";;")+'"';break}return g}function u(b,v){v.forEach(function(E,x){var g="F;W"+(x+1)+" "+(x+1)+" ";E.hidden?g+="0":(typeof E.width=="number"&&!E.wpx&&(E.wpx=width2px(E.width)),typeof E.wpx=="number"&&!E.wch&&(E.wch=px2char(E.wpx)),typeof E.wch=="number"&&(g+=Math.round(E.wch))),g.charAt(g.length-1)!=" "&&b.push(g)})}function d(b,v){v.forEach(function(E,x){var g="F;";E.hidden?g+="M0;":E.hpt?g+="M"+20*E.hpt+";":E.hpx&&(g+="M"+20*px2pt(E.hpx)+";"),g.length>2&&b.push(g+"R"+(x+1))})}function _(b,v){var E=["ID;PWXL;N;E"],x=[],g=safe_decode_range(b["!ref"]),w,R=Array.isArray(b),N=`\r
`;E.push("P;PGeneral"),E.push("F;P0;DG0G8;M255"),b["!cols"]&&u(E,b["!cols"]),b["!rows"]&&d(E,b["!rows"]),E.push("B;Y"+(g.e.r-g.s.r+1)+";X"+(g.e.c-g.s.c+1)+";D"+[g.s.c,g.s.r,g.e.c,g.e.r].join(" "));for(var M=g.s.r;M<=g.e.r;++M)for(var A=g.s.c;A<=g.e.c;++A){var I=encode_cell({r:M,c:A});w=R?(b[M]||[])[A]:b[I],!(!w||w.v==null&&(!w.f||w.F))&&x.push(h(w,b,M,A))}return E.join(N)+N+x.join(N)+N+"E"+N}return{to_workbook:c,to_sheet:o,from_sheet:_}}(),DIF=function(){function t(i,o){switch(o.type){case"base64":return r(Base64_decode(i),o);case"binary":return r(i,o);case"buffer":return r(has_buf&&Buffer.isBuffer(i)?i.toString("binary"):a2s(i),o);case"array":return r(cc2str(i),o)}throw new Error("Unrecognized type "+o.type)}function r(i,o){for(var c=i.split(`
`),h=-1,u=-1,d=0,_=[];d!==c.length;++d){if(c[d].trim()==="BOT"){_[++h]=[],u=0;continue}if(!(h<0)){var b=c[d].trim().split(","),v=b[0],E=b[1];++d;for(var x=c[d]||"";(x.match(/["]/g)||[]).length&1&&d<c.length-1;)x+=`
`+c[++d];switch(x=x.trim(),+v){case-1:if(x==="BOT"){_[++h]=[],u=0;continue}else if(x!=="EOD")throw new Error("Unrecognized DIF special command "+x);break;case 0:x==="TRUE"?_[h][u]=!0:x==="FALSE"?_[h][u]=!1:isNaN(fuzzynum(E))?isNaN(fuzzydate(E).getDate())?_[h][u]=E:_[h][u]=parseDate(E):_[h][u]=fuzzynum(E),++u;break;case 1:x=x.slice(1,x.length-1),x=x.replace(/""/g,'"'),x&&x.match(/^=".*"$/)&&(x=x.slice(2,-1)),_[h][u++]=x!==""?x:null;break}if(x==="EOD")break}}return o&&o.sheetRows&&(_=_.slice(0,o.sheetRows)),_}function e(i,o){return aoa_to_sheet(t(i,o),o)}function s(i,o){return sheet_to_workbook(e(i,o),o)}var a=function(){var i=function(h,u,d,_,b){h.push(u),h.push(d+","+_),h.push('"'+b.replace(/"/g,'""')+'"')},o=function(h,u,d,_){h.push(u+","+d),h.push(u==1?'"'+_.replace(/"/g,'""')+'"':_)};return function(h){var u=[],d=safe_decode_range(h["!ref"]),_,b=Array.isArray(h);i(u,"TABLE",0,1,"sheetjs"),i(u,"VECTORS",0,d.e.r-d.s.r+1,""),i(u,"TUPLES",0,d.e.c-d.s.c+1,""),i(u,"DATA",0,0,"");for(var v=d.s.r;v<=d.e.r;++v){o(u,-1,0,"BOT");for(var E=d.s.c;E<=d.e.c;++E){var x=encode_cell({r:v,c:E});if(_=b?(h[v]||[])[E]:h[x],!_){o(u,1,0,"");continue}switch(_.t){case"n":var g=_.w;!g&&_.v!=null&&(g=_.v),g==null?_.f&&!_.F?o(u,1,0,"="+_.f):o(u,1,0,""):o(u,0,g,"V");break;case"b":o(u,0,_.v?1:0,_.v?"TRUE":"FALSE");break;case"s":o(u,1,0,isNaN(_.v)?_.v:'="'+_.v+'"');break;case"d":_.w||(_.w=SSF_format(_.z||table_fmt[14],datenum(parseDate(_.v)))),o(u,0,_.w,"V");break;default:o(u,1,0,"")}}}o(u,-1,0,"EOD");var w=`\r
`,R=u.join(w);return R}}();return{to_workbook:s,to_sheet:e,from_sheet:a}}(),ETH=function(){function t(_){return _.replace(/\\b/g,"\\").replace(/\\c/g,":").replace(/\\n/g,`
`)}function r(_){return _.replace(/\\/g,"\\b").replace(/:/g,"\\c").replace(/\n/g,"\\n")}function e(_,b){for(var v=_.split(`
`),E=-1,x=-1,g=0,w=[];g!==v.length;++g){var R=v[g].trim().split(":");if(R[0]==="cell"){var N=decode_cell(R[1]);if(w.length<=N.r)for(E=w.length;E<=N.r;++E)w[E]||(w[E]=[]);switch(E=N.r,x=N.c,R[2]){case"t":w[E][x]=t(R[3]);break;case"v":w[E][x]=+R[3];break;case"vtf":var M=R[R.length-1];case"vtc":switch(R[3]){case"nl":w[E][x]=!!+R[4];break;default:w[E][x]=+R[4];break}R[2]=="vtf"&&(w[E][x]=[w[E][x],M])}}}return b&&b.sheetRows&&(w=w.slice(0,b.sheetRows)),w}function s(_,b){return aoa_to_sheet(e(_,b),b)}function a(_,b){return sheet_to_workbook(s(_,b),b)}var i=["socialcalc:version:1.5","MIME-Version: 1.0","Content-Type: multipart/mixed; boundary=SocialCalcSpreadsheetControlSave"].join(`
`),o=["--SocialCalcSpreadsheetControlSave","Content-type: text/plain; charset=UTF-8"].join(`
`)+`
`,c=["# SocialCalc Spreadsheet Control Save","part:sheet"].join(`
`),h="--SocialCalcSpreadsheetControlSave--";function u(_){if(!_||!_["!ref"])return"";for(var b=[],v=[],E,x="",g=decode_range(_["!ref"]),w=Array.isArray(_),R=g.s.r;R<=g.e.r;++R)for(var N=g.s.c;N<=g.e.c;++N)if(x=encode_cell({r:R,c:N}),E=w?(_[R]||[])[N]:_[x],!(!E||E.v==null||E.t==="z")){switch(v=["cell",x,"t"],E.t){case"s":case"str":v.push(r(E.v));break;case"n":E.f?(v[2]="vtf",v[3]="n",v[4]=E.v,v[5]=r(E.f)):(v[2]="v",v[3]=E.v);break;case"b":v[2]="vt"+(E.f?"f":"c"),v[3]="nl",v[4]=E.v?"1":"0",v[5]=r(E.f||(E.v?"TRUE":"FALSE"));break;case"d":var M=datenum(parseDate(E.v));v[2]="vtc",v[3]="nd",v[4]=""+M,v[5]=E.w||SSF_format(E.z||table_fmt[14],M);break;case"e":continue}b.push(v.join(":"))}return b.push("sheet:c:"+(g.e.c-g.s.c+1)+":r:"+(g.e.r-g.s.r+1)+":tvf:1"),b.push("valueformat:1:text-wiki"),b.join(`
`)}function d(_){return[i,o,c,o,u(_),h].join(`
`)}return{to_workbook:a,to_sheet:s,from_sheet:d}}(),PRN=function(){function t(d,_,b,v,E){E.raw?_[b][v]=d:d===""||(d==="TRUE"?_[b][v]=!0:d==="FALSE"?_[b][v]=!1:isNaN(fuzzynum(d))?isNaN(fuzzydate(d).getDate())?_[b][v]=d:_[b][v]=parseDate(d):_[b][v]=fuzzynum(d))}function r(d,_){var b=_||{},v=[];if(!d||d.length===0)return v;for(var E=d.split(/[\r\n]/),x=E.length-1;x>=0&&E[x].length===0;)--x;for(var g=10,w=0,R=0;R<=x;++R)w=E[R].indexOf(" "),w==-1?w=E[R].length:w++,g=Math.max(g,w);for(R=0;R<=x;++R){v[R]=[];var N=0;for(t(E[R].slice(0,g).trim(),v,R,N,b),N=1;N<=(E[R].length-g)/10+1;++N)t(E[R].slice(g+(N-1)*10,g+N*10).trim(),v,R,N,b)}return b.sheetRows&&(v=v.slice(0,b.sheetRows)),v}var e={44:",",9:"	",59:";",124:"|"},s={44:3,9:2,59:1,124:0};function a(d){for(var _={},b=!1,v=0,E=0;v<d.length;++v)(E=d.charCodeAt(v))==34?b=!b:!b&&E in e&&(_[E]=(_[E]||0)+1);E=[];for(v in _)Object.prototype.hasOwnProperty.call(_,v)&&E.push([_[v],v]);if(!E.length){_=s;for(v in _)Object.prototype.hasOwnProperty.call(_,v)&&E.push([_[v],v])}return E.sort(function(x,g){return x[0]-g[0]||s[x[1]]-s[g[1]]}),e[E.pop()[1]]||44}function i(d,_){var b=_||{},v="",E=b.dense?[]:{},x={s:{c:0,r:0},e:{c:0,r:0}};d.slice(0,4)=="sep="?d.charCodeAt(5)==13&&d.charCodeAt(6)==10?(v=d.charAt(4),d=d.slice(7)):d.charCodeAt(5)==13||d.charCodeAt(5)==10?(v=d.charAt(4),d=d.slice(6)):v=a(d.slice(0,1024)):b&&b.FS?v=b.FS:v=a(d.slice(0,1024));var g=0,w=0,R=0,N=0,M=0,A=v.charCodeAt(0),I=!1,y=0,j=d.charCodeAt(0);d=d.replace(/\r\n/mg,`
`);var T=b.dateNF!=null?dateNF_regex(b.dateNF):null;function U(){var F=d.slice(N,M),H={};if(F.charAt(0)=='"'&&F.charAt(F.length-1)=='"'&&(F=F.slice(1,-1).replace(/""/g,'"')),F.length===0)H.t="z";else if(b.raw)H.t="s",H.v=F;else if(F.trim().length===0)H.t="s",H.v=F;else if(F.charCodeAt(0)==61)F.charCodeAt(1)==34&&F.charCodeAt(F.length-1)==34?(H.t="s",H.v=F.slice(2,-1).replace(/""/g,'"')):fuzzyfmla(F)?(H.t="n",H.f=F.slice(1)):(H.t="s",H.v=F);else if(F=="TRUE")H.t="b",H.v=!0;else if(F=="FALSE")H.t="b",H.v=!1;else if(!isNaN(R=fuzzynum(F)))H.t="n",b.cellText!==!1&&(H.w=F),H.v=R;else if(!isNaN(fuzzydate(F).getDate())||T&&F.match(T)){H.z=b.dateNF||table_fmt[14];var z=0;T&&F.match(T)&&(F=dateNF_fix(F,b.dateNF,F.match(T)||[]),z=1),b.cellDates?(H.t="d",H.v=parseDate(F,z)):(H.t="n",H.v=datenum(parseDate(F,z))),b.cellText!==!1&&(H.w=SSF_format(H.z,H.v instanceof Date?datenum(H.v):H.v)),b.cellNF||delete H.z}else H.t="s",H.v=F;if(H.t=="z"||(b.dense?(E[g]||(E[g]=[]),E[g][w]=H):E[encode_cell({c:w,r:g})]=H),N=M+1,j=d.charCodeAt(N),x.e.c<w&&(x.e.c=w),x.e.r<g&&(x.e.r=g),y==A)++w;else if(w=0,++g,b.sheetRows&&b.sheetRows<=g)return!0}e:for(;M<d.length;++M)switch(y=d.charCodeAt(M)){case 34:j===34&&(I=!I);break;case A:case 10:case 13:if(!I&&U())break e;break}return M-N>0&&U(),E["!ref"]=encode_range(x),E}function o(d,_){return!(_&&_.PRN)||_.FS||d.slice(0,4)=="sep="||d.indexOf("	")>=0||d.indexOf(",")>=0||d.indexOf(";")>=0?i(d,_):aoa_to_sheet(r(d,_),_)}function c(d,_){var b="",v=_.type=="string"?[0,0,0,0]:firstbyte(d,_);switch(_.type){case"base64":b=Base64_decode(d);break;case"binary":b=d;break;case"buffer":_.codepage==65001?b=d.toString("utf8"):_.codepage&&typeof $cptable<"u"||(b=has_buf&&Buffer.isBuffer(d)?d.toString("binary"):a2s(d));break;case"array":b=cc2str(d);break;case"string":b=d;break;default:throw new Error("Unrecognized type "+_.type)}return v[0]==239&&v[1]==187&&v[2]==191?b=utf8read(b.slice(3)):_.type!="string"&&_.type!="buffer"&&_.codepage==65001?b=utf8read(b):_.type=="binary"&&typeof $cptable<"u",b.slice(0,19)=="socialcalc:version:"?ETH.to_sheet(_.type=="string"?b:utf8read(b),_):o(b,_)}function h(d,_){return sheet_to_workbook(c(d,_),_)}function u(d){for(var _=[],b=safe_decode_range(d["!ref"]),v,E=Array.isArray(d),x=b.s.r;x<=b.e.r;++x){for(var g=[],w=b.s.c;w<=b.e.c;++w){var R=encode_cell({r:x,c:w});if(v=E?(d[x]||[])[w]:d[R],!v||v.v==null){g.push("          ");continue}for(var N=(v.w||(format_cell(v),v.w)||"").slice(0,10);N.length<10;)N+=" ";g.push(N+(w===0?" ":""))}_.push(g.join(""))}return _.join(`
`)}return{to_workbook:h,to_sheet:c,from_sheet:u}}(),WK_=function(){function t(L,S,C){if(L){prep_blob(L,L.l||0);for(var P=C.Enum||oe;L.l<L.length;){var D=L.read_shift(2),B=P[D]||P[65535],G=L.read_shift(2),J=L.l+G,Y=B.f&&B.f(L,G,C);if(L.l=J,S(Y,B,D))return}}}function r(L,S){switch(S.type){case"base64":return e(s2a(Base64_decode(L)),S);case"binary":return e(s2a(L),S);case"buffer":case"array":return e(L,S)}throw"Unsupported type "+S.type}function e(L,S){if(!L)return L;var C=S||{},P=C.dense?[]:{},D="Sheet1",B="",G=0,J={},Y=[],me=[],Ee={s:{r:0,c:0},e:{r:0,c:0}},Re=C.sheetRows||0;if(L[2]==0&&(L[3]==8||L[3]==9)&&L.length>=16&&L[14]==5&&L[15]===108)throw new Error("Unsupported Works 3 for Mac file");if(L[2]==2)C.Enum=oe,t(L,function(fe,W,Q){switch(Q){case 0:C.vers=fe,fe>=4096&&(C.qpro=!0);break;case 6:Ee=fe;break;case 204:fe&&(B=fe);break;case 222:B=fe;break;case 15:case 51:C.qpro||(fe[1].v=fe[1].v.slice(1));case 13:case 14:case 16:Q==14&&(fe[2]&112)==112&&(fe[2]&15)>1&&(fe[2]&15)<15&&(fe[1].z=C.dateNF||table_fmt[14],C.cellDates&&(fe[1].t="d",fe[1].v=numdate(fe[1].v))),C.qpro&&fe[3]>G&&(P["!ref"]=encode_range(Ee),J[D]=P,Y.push(D),P=C.dense?[]:{},Ee={s:{r:0,c:0},e:{r:0,c:0}},G=fe[3],D=B||"Sheet"+(G+1),B="");var xe=C.dense?(P[fe[0].r]||[])[fe[0].c]:P[encode_cell(fe[0])];if(xe){xe.t=fe[1].t,xe.v=fe[1].v,fe[1].z!=null&&(xe.z=fe[1].z),fe[1].f!=null&&(xe.f=fe[1].f);break}C.dense?(P[fe[0].r]||(P[fe[0].r]=[]),P[fe[0].r][fe[0].c]=fe[1]):P[encode_cell(fe[0])]=fe[1];break}},C);else if(L[2]==26||L[2]==14)C.Enum=be,L[2]==14&&(C.qpro=!0,L.l=0),t(L,function(fe,W,Q){switch(Q){case 204:D=fe;break;case 22:fe[1].v=fe[1].v.slice(1);case 23:case 24:case 25:case 37:case 39:case 40:if(fe[3]>G&&(P["!ref"]=encode_range(Ee),J[D]=P,Y.push(D),P=C.dense?[]:{},Ee={s:{r:0,c:0},e:{r:0,c:0}},G=fe[3],D="Sheet"+(G+1)),Re>0&&fe[0].r>=Re)break;C.dense?(P[fe[0].r]||(P[fe[0].r]=[]),P[fe[0].r][fe[0].c]=fe[1]):P[encode_cell(fe[0])]=fe[1],Ee.e.c<fe[0].c&&(Ee.e.c=fe[0].c),Ee.e.r<fe[0].r&&(Ee.e.r=fe[0].r);break;case 27:fe[14e3]&&(me[fe[14e3][0]]=fe[14e3][1]);break;case 1537:me[fe[0]]=fe[1],fe[0]==G&&(D=fe[1]);break}},C);else throw new Error("Unrecognized LOTUS BOF "+L[2]);if(P["!ref"]=encode_range(Ee),J[B||D]=P,Y.push(B||D),!me.length)return{SheetNames:Y,Sheets:J};for(var Ne={},he=[],pe=0;pe<me.length;++pe)J[Y[pe]]?(he.push(me[pe]||Y[pe]),Ne[me[pe]]=J[me[pe]]||J[Y[pe]]):(he.push(me[pe]),Ne[me[pe]]={"!ref":"A1"});return{SheetNames:he,Sheets:Ne}}function s(L,S){var C=S||{};if(+C.codepage>=0&&set_cp(+C.codepage),C.type=="string")throw new Error("Cannot write WK1 to JS string");var P=buf_array(),D=safe_decode_range(L["!ref"]),B=Array.isArray(L),G=[];write_biff_rec(P,0,i(1030)),write_biff_rec(P,6,h(D));for(var J=Math.min(D.e.r,8191),Y=D.s.r;Y<=J;++Y)for(var me=encode_row(Y),Ee=D.s.c;Ee<=D.e.c;++Ee){Y===D.s.r&&(G[Ee]=encode_col(Ee));var Re=G[Ee]+me,Ne=B?(L[Y]||[])[Ee]:L[Re];if(!(!Ne||Ne.t=="z"))if(Ne.t=="n")(Ne.v|0)==Ne.v&&Ne.v>=-32768&&Ne.v<=32767?write_biff_rec(P,13,v(Y,Ee,Ne.v)):write_biff_rec(P,14,x(Y,Ee,Ne.v));else{var he=format_cell(Ne);write_biff_rec(P,15,_(Y,Ee,he.slice(0,239)))}}return write_biff_rec(P,1),P.end()}function a(L,S){var C=S||{};if(+C.codepage>=0&&set_cp(+C.codepage),C.type=="string")throw new Error("Cannot write WK3 to JS string");var P=buf_array();write_biff_rec(P,0,o(L));for(var D=0,B=0;D<L.SheetNames.length;++D)(L.Sheets[L.SheetNames[D]]||{})["!ref"]&&write_biff_rec(P,27,re(L.SheetNames[D],B++));var G=0;for(D=0;D<L.SheetNames.length;++D){var J=L.Sheets[L.SheetNames[D]];if(!(!J||!J["!ref"])){for(var Y=safe_decode_range(J["!ref"]),me=Array.isArray(J),Ee=[],Re=Math.min(Y.e.r,8191),Ne=Y.s.r;Ne<=Re;++Ne)for(var he=encode_row(Ne),pe=Y.s.c;pe<=Y.e.c;++pe){Ne===Y.s.r&&(Ee[pe]=encode_col(pe));var fe=Ee[pe]+he,W=me?(J[Ne]||[])[pe]:J[fe];if(!(!W||W.t=="z"))if(W.t=="n")write_biff_rec(P,23,U(Ne,pe,G,W.v));else{var Q=format_cell(W);write_biff_rec(P,22,y(Ne,pe,G,Q.slice(0,239)))}}++G}}return write_biff_rec(P,1),P.end()}function i(L){var S=new_buf(2);return S.write_shift(2,L),S}function o(L){var S=new_buf(26);S.write_shift(2,4096),S.write_shift(2,4),S.write_shift(4,0);for(var C=0,P=0,D=0,B=0;B<L.SheetNames.length;++B){var G=L.SheetNames[B],J=L.Sheets[G];if(!(!J||!J["!ref"])){++D;var Y=decode_range(J["!ref"]);C<Y.e.r&&(C=Y.e.r),P<Y.e.c&&(P=Y.e.c)}}return C>8191&&(C=8191),S.write_shift(2,C),S.write_shift(1,D),S.write_shift(1,P),S.write_shift(2,0),S.write_shift(2,0),S.write_shift(1,1),S.write_shift(1,2),S.write_shift(4,0),S.write_shift(4,0),S}function c(L,S,C){var P={s:{c:0,r:0},e:{c:0,r:0}};return S==8&&C.qpro?(P.s.c=L.read_shift(1),L.l++,P.s.r=L.read_shift(2),P.e.c=L.read_shift(1),L.l++,P.e.r=L.read_shift(2),P):(P.s.c=L.read_shift(2),P.s.r=L.read_shift(2),S==12&&C.qpro&&(L.l+=2),P.e.c=L.read_shift(2),P.e.r=L.read_shift(2),S==12&&C.qpro&&(L.l+=2),P.s.c==65535&&(P.s.c=P.e.c=P.s.r=P.e.r=0),P)}function h(L){var S=new_buf(8);return S.write_shift(2,L.s.c),S.write_shift(2,L.s.r),S.write_shift(2,L.e.c),S.write_shift(2,L.e.r),S}function u(L,S,C){var P=[{c:0,r:0},{t:"n",v:0},0,0];return C.qpro&&C.vers!=20768?(P[0].c=L.read_shift(1),P[3]=L.read_shift(1),P[0].r=L.read_shift(2),L.l+=2):(P[2]=L.read_shift(1),P[0].c=L.read_shift(2),P[0].r=L.read_shift(2)),P}function d(L,S,C){var P=L.l+S,D=u(L,S,C);if(D[1].t="s",C.vers==20768){L.l++;var B=L.read_shift(1);return D[1].v=L.read_shift(B,"utf8"),D}return C.qpro&&L.l++,D[1].v=L.read_shift(P-L.l,"cstr"),D}function _(L,S,C){var P=new_buf(7+C.length);P.write_shift(1,255),P.write_shift(2,S),P.write_shift(2,L),P.write_shift(1,39);for(var D=0;D<P.length;++D){var B=C.charCodeAt(D);P.write_shift(1,B>=128?95:B)}return P.write_shift(1,0),P}function b(L,S,C){var P=u(L,S,C);return P[1].v=L.read_shift(2,"i"),P}function v(L,S,C){var P=new_buf(7);return P.write_shift(1,255),P.write_shift(2,S),P.write_shift(2,L),P.write_shift(2,C,"i"),P}function E(L,S,C){var P=u(L,S,C);return P[1].v=L.read_shift(8,"f"),P}function x(L,S,C){var P=new_buf(13);return P.write_shift(1,255),P.write_shift(2,S),P.write_shift(2,L),P.write_shift(8,C,"f"),P}function g(L,S,C){var P=L.l+S,D=u(L,S,C);if(D[1].v=L.read_shift(8,"f"),C.qpro)L.l=P;else{var B=L.read_shift(2);M(L.slice(L.l,L.l+B),D),L.l+=B}return D}function w(L,S,C){var P=S&32768;return S&=-32769,S=(P?L:0)+(S>=8192?S-16384:S),(P?"":"$")+(C?encode_col(S):encode_row(S))}var R={51:["FALSE",0],52:["TRUE",0],70:["LEN",1],80:["SUM",69],81:["AVERAGEA",69],82:["COUNTA",69],83:["MINA",69],84:["MAXA",69],111:["T",1]},N=["","","","","","","","","","+","-","*","/","^","=","<>","<=",">=","<",">","","","","","&","","","","","","",""];function M(L,S){prep_blob(L,0);for(var C=[],P=0,D="",B="",G="",J="";L.l<L.length;){var Y=L[L.l++];switch(Y){case 0:C.push(L.read_shift(8,"f"));break;case 1:B=w(S[0].c,L.read_shift(2),!0),D=w(S[0].r,L.read_shift(2),!1),C.push(B+D);break;case 2:{var me=w(S[0].c,L.read_shift(2),!0),Ee=w(S[0].r,L.read_shift(2),!1);B=w(S[0].c,L.read_shift(2),!0),D=w(S[0].r,L.read_shift(2),!1),C.push(me+Ee+":"+B+D)}break;case 3:if(L.l<L.length){console.error("WK1 premature formula end");return}break;case 4:C.push("("+C.pop()+")");break;case 5:C.push(L.read_shift(2));break;case 6:{for(var Re="";Y=L[L.l++];)Re+=String.fromCharCode(Y);C.push('"'+Re.replace(/"/g,'""')+'"')}break;case 8:C.push("-"+C.pop());break;case 23:C.push("+"+C.pop());break;case 22:C.push("NOT("+C.pop()+")");break;case 20:case 21:J=C.pop(),G=C.pop(),C.push(["AND","OR"][Y-20]+"("+G+","+J+")");break;default:if(Y<32&&N[Y])J=C.pop(),G=C.pop(),C.push(G+N[Y]+J);else if(R[Y]){if(P=R[Y][1],P==69&&(P=L[L.l++]),P>C.length){console.error("WK1 bad formula parse 0x"+Y.toString(16)+":|"+C.join("|")+"|");return}var Ne=C.slice(-P);C.length-=P,C.push(R[Y][0]+"("+Ne.join(",")+")")}else return Y<=7?console.error("WK1 invalid opcode "+Y.toString(16)):Y<=24?console.error("WK1 unsupported op "+Y.toString(16)):Y<=30?console.error("WK1 invalid opcode "+Y.toString(16)):Y<=115?console.error("WK1 unsupported function opcode "+Y.toString(16)):console.error("WK1 unrecognized opcode "+Y.toString(16))}}C.length==1?S[1].f=""+C[0]:console.error("WK1 bad formula parse |"+C.join("|")+"|")}function A(L){var S=[{c:0,r:0},{t:"n",v:0},0];return S[0].r=L.read_shift(2),S[3]=L[L.l++],S[0].c=L[L.l++],S}function I(L,S){var C=A(L);return C[1].t="s",C[1].v=L.read_shift(S-4,"cstr"),C}function y(L,S,C,P){var D=new_buf(6+P.length);D.write_shift(2,L),D.write_shift(1,C),D.write_shift(1,S),D.write_shift(1,39);for(var B=0;B<P.length;++B){var G=P.charCodeAt(B);D.write_shift(1,G>=128?95:G)}return D.write_shift(1,0),D}function j(L,S){var C=A(L);C[1].v=L.read_shift(2);var P=C[1].v>>1;if(C[1].v&1)switch(P&7){case 0:P=(P>>3)*5e3;break;case 1:P=(P>>3)*500;break;case 2:P=(P>>3)/20;break;case 3:P=(P>>3)/200;break;case 4:P=(P>>3)/2e3;break;case 5:P=(P>>3)/2e4;break;case 6:P=(P>>3)/16;break;case 7:P=(P>>3)/64;break}return C[1].v=P,C}function T(L,S){var C=A(L),P=L.read_shift(4),D=L.read_shift(4),B=L.read_shift(2);if(B==65535)return P===0&&D===3221225472?(C[1].t="e",C[1].v=15):P===0&&D===3489660928?(C[1].t="e",C[1].v=42):C[1].v=0,C;var G=B&32768;return B=(B&32767)-16446,C[1].v=(1-G*2)*(D*Math.pow(2,B+32)+P*Math.pow(2,B)),C}function U(L,S,C,P){var D=new_buf(14);if(D.write_shift(2,L),D.write_shift(1,C),D.write_shift(1,S),P==0)return D.write_shift(4,0),D.write_shift(4,0),D.write_shift(2,65535),D;var B=0,G=0,J=0,Y=0;return P<0&&(B=1,P=-P),G=Math.log2(P)|0,P/=Math.pow(2,G-31),Y=P>>>0,Y&2147483648||(P/=2,++G,Y=P>>>0),P-=Y,Y|=2147483648,Y>>>=0,P*=Math.pow(2,32),J=P>>>0,D.write_shift(4,J),D.write_shift(4,Y),G+=16383+(B?32768:0),D.write_shift(2,G),D}function F(L,S){var C=T(L);return L.l+=S-14,C}function H(L,S){var C=A(L),P=L.read_shift(4);return C[1].v=P>>6,C}function z(L,S){var C=A(L),P=L.read_shift(8,"f");return C[1].v=P,C}function de(L,S){var C=z(L);return L.l+=S-10,C}function se(L,S){return L[L.l+S-1]==0?L.read_shift(S,"cstr"):""}function ue(L,S){var C=L[L.l++];C>S-1&&(C=S-1);for(var P="";P.length<C;)P+=String.fromCharCode(L[L.l++]);return P}function Z(L,S,C){if(!(!C.qpro||S<21)){var P=L.read_shift(1);L.l+=17,L.l+=1,L.l+=2;var D=L.read_shift(S-21,"cstr");return[P,D]}}function ge(L,S){for(var C={},P=L.l+S;L.l<P;){var D=L.read_shift(2);if(D==14e3){for(C[D]=[0,""],C[D][0]=L.read_shift(2);L[L.l];)C[D][1]+=String.fromCharCode(L[L.l]),L.l++;L.l++}}return C}function re(L,S){var C=new_buf(5+L.length);C.write_shift(2,14e3),C.write_shift(2,S);for(var P=0;P<L.length;++P){var D=L.charCodeAt(P);C[C.l++]=D>127?95:D}return C[C.l++]=0,C}var oe={0:{n:"BOF",f:parseuint16},1:{n:"EOF"},2:{n:"CALCMODE"},3:{n:"CALCORDER"},4:{n:"SPLIT"},5:{n:"SYNC"},6:{n:"RANGE",f:c},7:{n:"WINDOW1"},8:{n:"COLW1"},9:{n:"WINTWO"},10:{n:"COLW2"},11:{n:"NAME"},12:{n:"BLANK"},13:{n:"INTEGER",f:b},14:{n:"NUMBER",f:E},15:{n:"LABEL",f:d},16:{n:"FORMULA",f:g},24:{n:"TABLE"},25:{n:"ORANGE"},26:{n:"PRANGE"},27:{n:"SRANGE"},28:{n:"FRANGE"},29:{n:"KRANGE1"},32:{n:"HRANGE"},35:{n:"KRANGE2"},36:{n:"PROTEC"},37:{n:"FOOTER"},38:{n:"HEADER"},39:{n:"SETUP"},40:{n:"MARGINS"},41:{n:"LABELFMT"},42:{n:"TITLES"},43:{n:"SHEETJS"},45:{n:"GRAPH"},46:{n:"NGRAPH"},47:{n:"CALCCOUNT"},48:{n:"UNFORMATTED"},49:{n:"CURSORW12"},50:{n:"WINDOW"},51:{n:"STRING",f:d},55:{n:"PASSWORD"},56:{n:"LOCKED"},60:{n:"QUERY"},61:{n:"QUERYNAME"},62:{n:"PRINT"},63:{n:"PRINTNAME"},64:{n:"GRAPH2"},65:{n:"GRAPHNAME"},66:{n:"ZOOM"},67:{n:"SYMSPLIT"},68:{n:"NSROWS"},69:{n:"NSCOLS"},70:{n:"RULER"},71:{n:"NNAME"},72:{n:"ACOMM"},73:{n:"AMACRO"},74:{n:"PARSE"},102:{n:"PRANGES??"},103:{n:"RRANGES??"},104:{n:"FNAME??"},105:{n:"MRANGES??"},204:{n:"SHEETNAMECS",f:se},222:{n:"SHEETNAMELP",f:ue},65535:{n:""}},be={0:{n:"BOF"},1:{n:"EOF"},2:{n:"PASSWORD"},3:{n:"CALCSET"},4:{n:"WINDOWSET"},5:{n:"SHEETCELLPTR"},6:{n:"SHEETLAYOUT"},7:{n:"COLUMNWIDTH"},8:{n:"HIDDENCOLUMN"},9:{n:"USERRANGE"},10:{n:"SYSTEMRANGE"},11:{n:"ZEROFORCE"},12:{n:"SORTKEYDIR"},13:{n:"FILESEAL"},14:{n:"DATAFILLNUMS"},15:{n:"PRINTMAIN"},16:{n:"PRINTSTRING"},17:{n:"GRAPHMAIN"},18:{n:"GRAPHSTRING"},19:{n:"??"},20:{n:"ERRCELL"},21:{n:"NACELL"},22:{n:"LABEL16",f:I},23:{n:"NUMBER17",f:T},24:{n:"NUMBER18",f:j},25:{n:"FORMULA19",f:F},26:{n:"FORMULA1A"},27:{n:"XFORMAT",f:ge},28:{n:"DTLABELMISC"},29:{n:"DTLABELCELL"},30:{n:"GRAPHWINDOW"},31:{n:"CPA"},32:{n:"LPLAUTO"},33:{n:"QUERY"},34:{n:"HIDDENSHEET"},35:{n:"??"},37:{n:"NUMBER25",f:H},38:{n:"??"},39:{n:"NUMBER27",f:z},40:{n:"FORMULA28",f:de},142:{n:"??"},147:{n:"??"},150:{n:"??"},151:{n:"??"},152:{n:"??"},153:{n:"??"},154:{n:"??"},155:{n:"??"},156:{n:"??"},163:{n:"??"},174:{n:"??"},175:{n:"??"},176:{n:"??"},177:{n:"??"},184:{n:"??"},185:{n:"??"},186:{n:"??"},187:{n:"??"},188:{n:"??"},195:{n:"??"},201:{n:"??"},204:{n:"SHEETNAMECS",f:se},205:{n:"??"},206:{n:"??"},207:{n:"??"},208:{n:"??"},256:{n:"??"},259:{n:"??"},260:{n:"??"},261:{n:"??"},262:{n:"??"},263:{n:"??"},265:{n:"??"},266:{n:"??"},267:{n:"??"},268:{n:"??"},270:{n:"??"},271:{n:"??"},384:{n:"??"},389:{n:"??"},390:{n:"??"},393:{n:"??"},396:{n:"??"},512:{n:"??"},514:{n:"??"},513:{n:"??"},516:{n:"??"},517:{n:"??"},640:{n:"??"},641:{n:"??"},642:{n:"??"},643:{n:"??"},644:{n:"??"},645:{n:"??"},646:{n:"??"},647:{n:"??"},648:{n:"??"},658:{n:"??"},659:{n:"??"},660:{n:"??"},661:{n:"??"},662:{n:"??"},665:{n:"??"},666:{n:"??"},768:{n:"??"},772:{n:"??"},1537:{n:"SHEETINFOQP",f:Z},1600:{n:"??"},1602:{n:"??"},1793:{n:"??"},1794:{n:"??"},1795:{n:"??"},1796:{n:"??"},1920:{n:"??"},2048:{n:"??"},2049:{n:"??"},2052:{n:"??"},2688:{n:"??"},10998:{n:"??"},12849:{n:"??"},28233:{n:"??"},28484:{n:"??"},65535:{n:""}};return{sheet_to_wk1:s,book_to_wk3:a,to_workbook:r}}(),straywsregex=/^\s|\s$|[\t\n\r]/;function write_sst_xml(t,r){if(!r.bookSST)return"";var e=[XML_HEADER];e[e.length]=writextag("sst",null,{xmlns:XMLNS_main[0],count:t.Count,uniqueCount:t.Unique});for(var s=0;s!=t.length;++s)if(t[s]!=null){var a=t[s],i="<si>";a.r?i+=a.r:(i+="<t",a.t||(a.t=""),a.t.match(straywsregex)&&(i+=' xml:space="preserve"'),i+=">"+escapexml(a.t)+"</t>"),i+="</si>",e[e.length]=i}return e.length>2&&(e[e.length]="</sst>",e[1]=e[1].replace("/>",">")),e.join("")}function parse_BrtBeginSst(t){return[t.read_shift(4),t.read_shift(4)]}function write_BrtBeginSst(t,r){return r||(r=new_buf(8)),r.write_shift(4,t.Count),r.write_shift(4,t.Unique),r}var write_BrtSSTItem=write_RichStr;function write_sst_bin(t){var r=buf_array();write_record(r,159,write_BrtBeginSst(t));for(var e=0;e<t.length;++e)write_record(r,19,write_BrtSSTItem(t[e]));return write_record(r,160),r.end()}function _JS2ANSI(t){for(var r=[],e=t.split(""),s=0;s<e.length;++s)r[s]=e[s].charCodeAt(0);return r}function crypto_CreatePasswordVerifier_Method1(t){var r=0,e,s=_JS2ANSI(t),a=s.length+1,i,o,c,h,u;for(e=new_raw_buf(a),e[0]=s.length,i=1;i!=a;++i)e[i]=s[i-1];for(i=a-1;i>=0;--i)o=e[i],c=r&16384?1:0,h=r<<1&32767,u=c|h,r=u^o;return r^52811}var RTF=function(){function t(a,i){switch(i.type){case"base64":return r(Base64_decode(a),i);case"binary":return r(a,i);case"buffer":return r(has_buf&&Buffer.isBuffer(a)?a.toString("binary"):a2s(a),i);case"array":return r(cc2str(a),i)}throw new Error("Unrecognized type "+i.type)}function r(a,i){var o=i||{},c=o.dense?[]:{},h=a.match(/\\trowd.*?\\row\b/g);if(!h.length)throw new Error("RTF missing table");var u={s:{c:0,r:0},e:{c:0,r:h.length-1}};return h.forEach(function(d,_){Array.isArray(c)&&(c[_]=[]);for(var b=/\\\w+\b/g,v=0,E,x=-1;E=b.exec(d);){switch(E[0]){case"\\cell":var g=d.slice(v,b.lastIndex-E[0].length);if(g[0]==" "&&(g=g.slice(1)),++x,g.length){var w={v:g,t:"s"};Array.isArray(c)?c[_][x]=w:c[encode_cell({r:_,c:x})]=w}break}v=b.lastIndex}x>u.e.c&&(u.e.c=x)}),c["!ref"]=encode_range(u),c}function e(a,i){return sheet_to_workbook(t(a,i),i)}function s(a){for(var i=["{\\rtf1\\ansi"],o=safe_decode_range(a["!ref"]),c,h=Array.isArray(a),u=o.s.r;u<=o.e.r;++u){i.push("\\trowd\\trautofit1");for(var d=o.s.c;d<=o.e.c;++d)i.push("\\cellx"+(d+1));for(i.push("\\pard\\intbl"),d=o.s.c;d<=o.e.c;++d){var _=encode_cell({r:u,c:d});c=h?(a[u]||[])[d]:a[_],!(!c||c.v==null&&(!c.f||c.F))&&(i.push(" "+(c.w||(format_cell(c),c.w))),i.push("\\cell"))}i.push("\\pard\\intbl\\row")}return i.join("")+"}"}return{to_workbook:e,to_sheet:t,from_sheet:s}}();function rgb2Hex(t){for(var r=0,e=1;r!=3;++r)e=e*256+(t[r]>255?255:t[r]<0?0:t[r]);return e.toString(16).toUpperCase().slice(1)}var DEF_MDW=6,MDW=DEF_MDW;function width2px(t){return Math.floor((t+Math.round(128/MDW)/256)*MDW)}function px2char(t){return Math.floor((t-5)/MDW*100+.5)/100}function char2width(t){return Math.round((t*MDW+5)/MDW*256)/256}function process_col(t){t.width?(t.wpx=width2px(t.width),t.wch=px2char(t.wpx),t.MDW=MDW):t.wpx?(t.wch=px2char(t.wpx),t.width=char2width(t.wch),t.MDW=MDW):typeof t.wch=="number"&&(t.width=char2width(t.wch),t.wpx=width2px(t.width),t.MDW=MDW),t.customWidth&&delete t.customWidth}var DEF_PPI=96,PPI=DEF_PPI;function px2pt(t){return t*96/PPI}function pt2px(t){return t*PPI/96}function write_numFmts(t){var r=["<numFmts>"];return[[5,8],[23,26],[41,44],[50,392]].forEach(function(e){for(var s=e[0];s<=e[1];++s)t[s]!=null&&(r[r.length]=writextag("numFmt",null,{numFmtId:s,formatCode:escapexml(t[s])}))}),r.length===1?"":(r[r.length]="</numFmts>",r[0]=writextag("numFmts",null,{count:r.length-2}).replace("/>",">"),r.join(""))}function write_cellXfs(t){var r=[];return r[r.length]=writextag("cellXfs",null),t.forEach(function(e){r[r.length]=writextag("xf",null,e)}),r[r.length]="</cellXfs>",r.length===2?"":(r[0]=writextag("cellXfs",null,{count:r.length-2}).replace("/>",">"),r.join(""))}function write_sty_xml(t,r){var e=[XML_HEADER,writextag("styleSheet",null,{xmlns:XMLNS_main[0],"xmlns:vt":XMLNS.vt})],s;return t.SSF&&(s=write_numFmts(t.SSF))!=null&&(e[e.length]=s),e[e.length]='<fonts count="1"><font><sz val="12"/><color theme="1"/><name val="Calibri"/><family val="2"/><scheme val="minor"/></font></fonts>',e[e.length]='<fills count="2"><fill><patternFill patternType="none"/></fill><fill><patternFill patternType="gray125"/></fill></fills>',e[e.length]='<borders count="1"><border><left/><right/><top/><bottom/><diagonal/></border></borders>',e[e.length]='<cellStyleXfs count="1"><xf numFmtId="0" fontId="0" fillId="0" borderId="0"/></cellStyleXfs>',(s=write_cellXfs(r.cellXfs))&&(e[e.length]=s),e[e.length]='<cellStyles count="1"><cellStyle name="Normal" xfId="0" builtinId="0"/></cellStyles>',e[e.length]='<dxfs count="0"/>',e[e.length]='<tableStyles count="0" defaultTableStyle="TableStyleMedium9" defaultPivotStyle="PivotStyleMedium4"/>',e.length>2&&(e[e.length]="</styleSheet>",e[1]=e[1].replace("/>",">")),e.join("")}function parse_BrtFmt(t,r){var e=t.read_shift(2),s=parse_XLWideString(t);return[e,s]}function write_BrtFmt(t,r,e){e||(e=new_buf(6+4*r.length)),e.write_shift(2,t),write_XLWideString(r,e);var s=e.length>e.l?e.slice(0,e.l):e;return e.l==null&&(e.l=e.length),s}function parse_BrtFont(t,r,e){var s={};s.sz=t.read_shift(2)/20;var a=parse_FontFlags(t);a.fItalic&&(s.italic=1),a.fCondense&&(s.condense=1),a.fExtend&&(s.extend=1),a.fShadow&&(s.shadow=1),a.fOutline&&(s.outline=1),a.fStrikeout&&(s.strike=1);var i=t.read_shift(2);switch(i===700&&(s.bold=1),t.read_shift(2)){case 1:s.vertAlign="superscript";break;case 2:s.vertAlign="subscript";break}var o=t.read_shift(1);o!=0&&(s.underline=o);var c=t.read_shift(1);c>0&&(s.family=c);var h=t.read_shift(1);switch(h>0&&(s.charset=h),t.l++,s.color=parse_BrtColor(t),t.read_shift(1)){case 1:s.scheme="major";break;case 2:s.scheme="minor";break}return s.name=parse_XLWideString(t),s}function write_BrtFont(t,r){r||(r=new_buf(25+4*32)),r.write_shift(2,t.sz*20),write_FontFlags(t,r),r.write_shift(2,t.bold?700:400);var e=0;t.vertAlign=="superscript"?e=1:t.vertAlign=="subscript"&&(e=2),r.write_shift(2,e),r.write_shift(1,t.underline||0),r.write_shift(1,t.family||0),r.write_shift(1,t.charset||0),r.write_shift(1,0),write_BrtColor(t.color,r);var s=0;return s=2,r.write_shift(1,s),write_XLWideString(t.name,r),r.length>r.l?r.slice(0,r.l):r}var XLSBFillPTNames=["none","solid","mediumGray","darkGray","lightGray","darkHorizontal","darkVertical","darkDown","darkUp","darkGrid","darkTrellis","lightHorizontal","lightVertical","lightDown","lightUp","lightGrid","lightTrellis","gray125","gray0625"],rev_XLSBFillPTNames,parse_BrtFill=parsenoop;function write_BrtFill(t,r){r||(r=new_buf(4*3+8*7+16*1)),rev_XLSBFillPTNames||(rev_XLSBFillPTNames=evert(XLSBFillPTNames));var e=rev_XLSBFillPTNames[t.patternType];e==null&&(e=40),r.write_shift(4,e);var s=0;if(e!=40)for(write_BrtColor({auto:1},r),write_BrtColor({auto:1},r);s<12;++s)r.write_shift(4,0);else{for(;s<4;++s)r.write_shift(4,0);for(;s<12;++s)r.write_shift(4,0)}return r.length>r.l?r.slice(0,r.l):r}function parse_BrtXF(t,r){var e=t.l+r,s=t.read_shift(2),a=t.read_shift(2);return t.l=e,{ixfe:s,numFmtId:a}}function write_BrtXF(t,r,e){e||(e=new_buf(16)),e.write_shift(2,r||0),e.write_shift(2,t.numFmtId||0),e.write_shift(2,0),e.write_shift(2,0),e.write_shift(2,0),e.write_shift(1,0),e.write_shift(1,0);var s=0;return e.write_shift(1,s),e.write_shift(1,0),e.write_shift(1,0),e.write_shift(1,0),e}function write_Blxf(t,r){return r||(r=new_buf(10)),r.write_shift(1,0),r.write_shift(1,0),r.write_shift(4,0),r.write_shift(4,0),r}var parse_BrtBorder=parsenoop;function write_BrtBorder(t,r){return r||(r=new_buf(51)),r.write_shift(1,0),write_Blxf(null,r),write_Blxf(null,r),write_Blxf(null,r),write_Blxf(null,r),write_Blxf(null,r),r.length>r.l?r.slice(0,r.l):r}function write_BrtStyle(t,r){return r||(r=new_buf(12+4*10)),r.write_shift(4,t.xfId),r.write_shift(2,1),r.write_shift(1,0),r.write_shift(1,0),write_XLNullableWideString(t.name||"",r),r.length>r.l?r.slice(0,r.l):r}function write_BrtBeginTableStyles(t,r,e){var s=new_buf(2052);return s.write_shift(4,t),write_XLNullableWideString(r,s),write_XLNullableWideString(e,s),s.length>s.l?s.slice(0,s.l):s}function write_FMTS_bin(t,r){if(r){var e=0;[[5,8],[23,26],[41,44],[50,392]].forEach(function(s){for(var a=s[0];a<=s[1];++a)r[a]!=null&&++e}),e!=0&&(write_record(t,615,write_UInt32LE(e)),[[5,8],[23,26],[41,44],[50,392]].forEach(function(s){for(var a=s[0];a<=s[1];++a)r[a]!=null&&write_record(t,44,write_BrtFmt(a,r[a]))}),write_record(t,616))}}function write_FONTS_bin(t){var r=1;write_record(t,611,write_UInt32LE(r)),write_record(t,43,write_BrtFont({sz:12,color:{theme:1},name:"Calibri",family:2})),write_record(t,612)}function write_FILLS_bin(t){var r=2;write_record(t,603,write_UInt32LE(r)),write_record(t,45,write_BrtFill({patternType:"none"})),write_record(t,45,write_BrtFill({patternType:"gray125"})),write_record(t,604)}function write_BORDERS_bin(t){var r=1;write_record(t,613,write_UInt32LE(r)),write_record(t,46,write_BrtBorder()),write_record(t,614)}function write_CELLSTYLEXFS_bin(t){var r=1;write_record(t,626,write_UInt32LE(r)),write_record(t,47,write_BrtXF({numFmtId:0},65535)),write_record(t,627)}function write_CELLXFS_bin(t,r){write_record(t,617,write_UInt32LE(r.length)),r.forEach(function(e){write_record(t,47,write_BrtXF(e,0))}),write_record(t,618)}function write_STYLES_bin(t){var r=1;write_record(t,619,write_UInt32LE(r)),write_record(t,48,write_BrtStyle({xfId:0,name:"Normal"})),write_record(t,620)}function write_DXFS_bin(t){var r=0;write_record(t,505,write_UInt32LE(r)),write_record(t,506)}function write_TABLESTYLES_bin(t){var r=0;write_record(t,508,write_BrtBeginTableStyles(r,"TableStyleMedium9","PivotStyleMedium4")),write_record(t,509)}function write_sty_bin(t,r){var e=buf_array();return write_record(e,278),write_FMTS_bin(e,t.SSF),write_FONTS_bin(e),write_FILLS_bin(e),write_BORDERS_bin(e),write_CELLSTYLEXFS_bin(e),write_CELLXFS_bin(e,r.cellXfs),write_STYLES_bin(e),write_DXFS_bin(e),write_TABLESTYLES_bin(e),write_record(e,279),e.end()}function write_theme(t,r){if(r&&r.themeXLSX)return r.themeXLSX;if(t&&typeof t.raw=="string")return t.raw;var e=[XML_HEADER];return e[e.length]='<a:theme xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main" name="Office Theme">',e[e.length]="<a:themeElements>",e[e.length]='<a:clrScheme name="Office">',e[e.length]='<a:dk1><a:sysClr val="windowText" lastClr="000000"/></a:dk1>',e[e.length]='<a:lt1><a:sysClr val="window" lastClr="FFFFFF"/></a:lt1>',e[e.length]='<a:dk2><a:srgbClr val="1F497D"/></a:dk2>',e[e.length]='<a:lt2><a:srgbClr val="EEECE1"/></a:lt2>',e[e.length]='<a:accent1><a:srgbClr val="4F81BD"/></a:accent1>',e[e.length]='<a:accent2><a:srgbClr val="C0504D"/></a:accent2>',e[e.length]='<a:accent3><a:srgbClr val="9BBB59"/></a:accent3>',e[e.length]='<a:accent4><a:srgbClr val="8064A2"/></a:accent4>',e[e.length]='<a:accent5><a:srgbClr val="4BACC6"/></a:accent5>',e[e.length]='<a:accent6><a:srgbClr val="F79646"/></a:accent6>',e[e.length]='<a:hlink><a:srgbClr val="0000FF"/></a:hlink>',e[e.length]='<a:folHlink><a:srgbClr val="800080"/></a:folHlink>',e[e.length]="</a:clrScheme>",e[e.length]='<a:fontScheme name="Office">',e[e.length]="<a:majorFont>",e[e.length]='<a:latin typeface="Cambria"/>',e[e.length]='<a:ea typeface=""/>',e[e.length]='<a:cs typeface=""/>',e[e.length]='<a:font script="Jpan" typeface="ＭＳ Ｐゴシック"/>',e[e.length]='<a:font script="Hang" typeface="맑은 고딕"/>',e[e.length]='<a:font script="Hans" typeface="宋体"/>',e[e.length]='<a:font script="Hant" typeface="新細明體"/>',e[e.length]='<a:font script="Arab" typeface="Times New Roman"/>',e[e.length]='<a:font script="Hebr" typeface="Times New Roman"/>',e[e.length]='<a:font script="Thai" typeface="Tahoma"/>',e[e.length]='<a:font script="Ethi" typeface="Nyala"/>',e[e.length]='<a:font script="Beng" typeface="Vrinda"/>',e[e.length]='<a:font script="Gujr" typeface="Shruti"/>',e[e.length]='<a:font script="Khmr" typeface="MoolBoran"/>',e[e.length]='<a:font script="Knda" typeface="Tunga"/>',e[e.length]='<a:font script="Guru" typeface="Raavi"/>',e[e.length]='<a:font script="Cans" typeface="Euphemia"/>',e[e.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',e[e.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',e[e.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',e[e.length]='<a:font script="Thaa" typeface="MV Boli"/>',e[e.length]='<a:font script="Deva" typeface="Mangal"/>',e[e.length]='<a:font script="Telu" typeface="Gautami"/>',e[e.length]='<a:font script="Taml" typeface="Latha"/>',e[e.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',e[e.length]='<a:font script="Orya" typeface="Kalinga"/>',e[e.length]='<a:font script="Mlym" typeface="Kartika"/>',e[e.length]='<a:font script="Laoo" typeface="DokChampa"/>',e[e.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',e[e.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',e[e.length]='<a:font script="Viet" typeface="Times New Roman"/>',e[e.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',e[e.length]='<a:font script="Geor" typeface="Sylfaen"/>',e[e.length]="</a:majorFont>",e[e.length]="<a:minorFont>",e[e.length]='<a:latin typeface="Calibri"/>',e[e.length]='<a:ea typeface=""/>',e[e.length]='<a:cs typeface=""/>',e[e.length]='<a:font script="Jpan" typeface="ＭＳ Ｐゴシック"/>',e[e.length]='<a:font script="Hang" typeface="맑은 고딕"/>',e[e.length]='<a:font script="Hans" typeface="宋体"/>',e[e.length]='<a:font script="Hant" typeface="新細明體"/>',e[e.length]='<a:font script="Arab" typeface="Arial"/>',e[e.length]='<a:font script="Hebr" typeface="Arial"/>',e[e.length]='<a:font script="Thai" typeface="Tahoma"/>',e[e.length]='<a:font script="Ethi" typeface="Nyala"/>',e[e.length]='<a:font script="Beng" typeface="Vrinda"/>',e[e.length]='<a:font script="Gujr" typeface="Shruti"/>',e[e.length]='<a:font script="Khmr" typeface="DaunPenh"/>',e[e.length]='<a:font script="Knda" typeface="Tunga"/>',e[e.length]='<a:font script="Guru" typeface="Raavi"/>',e[e.length]='<a:font script="Cans" typeface="Euphemia"/>',e[e.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',e[e.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',e[e.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',e[e.length]='<a:font script="Thaa" typeface="MV Boli"/>',e[e.length]='<a:font script="Deva" typeface="Mangal"/>',e[e.length]='<a:font script="Telu" typeface="Gautami"/>',e[e.length]='<a:font script="Taml" typeface="Latha"/>',e[e.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',e[e.length]='<a:font script="Orya" typeface="Kalinga"/>',e[e.length]='<a:font script="Mlym" typeface="Kartika"/>',e[e.length]='<a:font script="Laoo" typeface="DokChampa"/>',e[e.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',e[e.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',e[e.length]='<a:font script="Viet" typeface="Arial"/>',e[e.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',e[e.length]='<a:font script="Geor" typeface="Sylfaen"/>',e[e.length]="</a:minorFont>",e[e.length]="</a:fontScheme>",e[e.length]='<a:fmtScheme name="Office">',e[e.length]="<a:fillStyleLst>",e[e.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',e[e.length]='<a:gradFill rotWithShape="1">',e[e.length]="<a:gsLst>",e[e.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="50000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',e[e.length]='<a:gs pos="35000"><a:schemeClr val="phClr"><a:tint val="37000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',e[e.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="15000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',e[e.length]="</a:gsLst>",e[e.length]='<a:lin ang="16200000" scaled="1"/>',e[e.length]="</a:gradFill>",e[e.length]='<a:gradFill rotWithShape="1">',e[e.length]="<a:gsLst>",e[e.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="100000"/><a:shade val="100000"/><a:satMod val="130000"/></a:schemeClr></a:gs>',e[e.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="50000"/><a:shade val="100000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',e[e.length]="</a:gsLst>",e[e.length]='<a:lin ang="16200000" scaled="0"/>',e[e.length]="</a:gradFill>",e[e.length]="</a:fillStyleLst>",e[e.length]="<a:lnStyleLst>",e[e.length]='<a:ln w="9525" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"><a:shade val="95000"/><a:satMod val="105000"/></a:schemeClr></a:solidFill><a:prstDash val="solid"/></a:ln>',e[e.length]='<a:ln w="25400" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',e[e.length]='<a:ln w="38100" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',e[e.length]="</a:lnStyleLst>",e[e.length]="<a:effectStyleLst>",e[e.length]="<a:effectStyle>",e[e.length]="<a:effectLst>",e[e.length]='<a:outerShdw blurRad="40000" dist="20000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="38000"/></a:srgbClr></a:outerShdw>',e[e.length]="</a:effectLst>",e[e.length]="</a:effectStyle>",e[e.length]="<a:effectStyle>",e[e.length]="<a:effectLst>",e[e.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',e[e.length]="</a:effectLst>",e[e.length]="</a:effectStyle>",e[e.length]="<a:effectStyle>",e[e.length]="<a:effectLst>",e[e.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',e[e.length]="</a:effectLst>",e[e.length]='<a:scene3d><a:camera prst="orthographicFront"><a:rot lat="0" lon="0" rev="0"/></a:camera><a:lightRig rig="threePt" dir="t"><a:rot lat="0" lon="0" rev="1200000"/></a:lightRig></a:scene3d>',e[e.length]='<a:sp3d><a:bevelT w="63500" h="25400"/></a:sp3d>',e[e.length]="</a:effectStyle>",e[e.length]="</a:effectStyleLst>",e[e.length]="<a:bgFillStyleLst>",e[e.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',e[e.length]='<a:gradFill rotWithShape="1">',e[e.length]="<a:gsLst>",e[e.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="40000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',e[e.length]='<a:gs pos="40000"><a:schemeClr val="phClr"><a:tint val="45000"/><a:shade val="99000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',e[e.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="20000"/><a:satMod val="255000"/></a:schemeClr></a:gs>',e[e.length]="</a:gsLst>",e[e.length]='<a:path path="circle"><a:fillToRect l="50000" t="-80000" r="50000" b="180000"/></a:path>',e[e.length]="</a:gradFill>",e[e.length]='<a:gradFill rotWithShape="1">',e[e.length]="<a:gsLst>",e[e.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="80000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',e[e.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="30000"/><a:satMod val="200000"/></a:schemeClr></a:gs>',e[e.length]="</a:gsLst>",e[e.length]='<a:path path="circle"><a:fillToRect l="50000" t="50000" r="50000" b="50000"/></a:path>',e[e.length]="</a:gradFill>",e[e.length]="</a:bgFillStyleLst>",e[e.length]="</a:fmtScheme>",e[e.length]="</a:themeElements>",e[e.length]="<a:objectDefaults>",e[e.length]="<a:spDef>",e[e.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="1"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="3"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="2"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="lt1"/></a:fontRef></a:style>',e[e.length]="</a:spDef>",e[e.length]="<a:lnDef>",e[e.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="2"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="0"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="1"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="tx1"/></a:fontRef></a:style>',e[e.length]="</a:lnDef>",e[e.length]="</a:objectDefaults>",e[e.length]="<a:extraClrSchemeLst/>",e[e.length]="</a:theme>",e.join("")}function parse_BrtMdtinfo(t,r){return{flags:t.read_shift(4),version:t.read_shift(4),name:parse_XLWideString(t)}}function write_BrtMdtinfo(t){var r=new_buf(12+2*t.name.length);return r.write_shift(4,t.flags),r.write_shift(4,t.version),write_XLWideString(t.name,r),r.slice(0,r.l)}function parse_BrtMdb(t){for(var r=[],e=t.read_shift(4);e-- >0;)r.push([t.read_shift(4),t.read_shift(4)]);return r}function write_BrtMdb(t){var r=new_buf(4+8*t.length);r.write_shift(4,t.length);for(var e=0;e<t.length;++e)r.write_shift(4,t[e][0]),r.write_shift(4,t[e][1]);return r}function write_BrtBeginEsfmd(t,r){var e=new_buf(8+2*r.length);return e.write_shift(4,t),write_XLWideString(r,e),e.slice(0,e.l)}function parse_BrtBeginEsmdb(t){return t.l+=4,t.read_shift(4)!=0}function write_BrtBeginEsmdb(t,r){var e=new_buf(8);return e.write_shift(4,t),e.write_shift(4,1),e}function write_xlmeta_bin(){var t=buf_array();return write_record(t,332),write_record(t,334,write_UInt32LE(1)),write_record(t,335,write_BrtMdtinfo({name:"XLDAPR",version:12e4,flags:3496657072})),write_record(t,336),write_record(t,339,write_BrtBeginEsfmd(1,"XLDAPR")),write_record(t,52),write_record(t,35,write_UInt32LE(514)),write_record(t,4096,write_UInt32LE(0)),write_record(t,4097,writeuint16(1)),write_record(t,36),write_record(t,53),write_record(t,340),write_record(t,337,write_BrtBeginEsmdb(1)),write_record(t,51,write_BrtMdb([[1,0]])),write_record(t,338),write_record(t,333),t.end()}function write_xlmeta_xml(){var t=[XML_HEADER];return t.push(`<metadata xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main" xmlns:xlrd="http://schemas.microsoft.com/office/spreadsheetml/2017/richdata" xmlns:xda="http://schemas.microsoft.com/office/spreadsheetml/2017/dynamicarray">
  <metadataTypes count="1">
    <metadataType name="XLDAPR" minSupportedVersion="120000" copy="1" pasteAll="1" pasteValues="1" merge="1" splitFirst="1" rowColShift="1" clearFormats="1" clearComments="1" assign="1" coerce="1" cellMeta="1"/>
  </metadataTypes>
  <futureMetadata name="XLDAPR" count="1">
    <bk>
      <extLst>
        <ext uri="{bdbb8cdc-fa1e-496e-a857-3c3f30c029c3}">
          <xda:dynamicArrayProperties fDynamic="1" fCollapsed="0"/>
        </ext>
      </extLst>
    </bk>
  </futureMetadata>
  <cellMetadata count="1">
    <bk>
      <rc t="1" v="0"/>
    </bk>
  </cellMetadata>
</metadata>`),t.join("")}function parse_BrtCalcChainItem$(t){var r={};r.i=t.read_shift(4);var e={};e.r=t.read_shift(4),e.c=t.read_shift(4),r.r=encode_cell(e);var s=t.read_shift(1);return s&2&&(r.l="1"),s&8&&(r.a="1"),r}var _shapeid=1024;function write_comments_vml(t,r){for(var e=[21600,21600],s=["m0,0l0",e[1],e[0],e[1],e[0],"0xe"].join(","),a=[writextag("xml",null,{"xmlns:v":XLMLNS.v,"xmlns:o":XLMLNS.o,"xmlns:x":XLMLNS.x,"xmlns:mv":XLMLNS.mv}).replace(/\/>/,">"),writextag("o:shapelayout",writextag("o:idmap",null,{"v:ext":"edit",data:t}),{"v:ext":"edit"}),writextag("v:shapetype",[writextag("v:stroke",null,{joinstyle:"miter"}),writextag("v:path",null,{gradientshapeok:"t","o:connecttype":"rect"})].join(""),{id:"_x0000_t202","o:spt":202,coordsize:e.join(","),path:s})];_shapeid<t*1e3;)_shapeid+=1e3;return r.forEach(function(i){var o=decode_cell(i[0]),c={color2:"#BEFF82",type:"gradient"};c.type=="gradient"&&(c.angle="-180");var h=c.type=="gradient"?writextag("o:fill",null,{type:"gradientUnscaled","v:ext":"view"}):null,u=writextag("v:fill",h,c),d={on:"t",obscured:"t"};++_shapeid,a=a.concat(["<v:shape"+wxt_helper({id:"_x0000_s"+_shapeid,type:"#_x0000_t202",style:"position:absolute; margin-left:80pt;margin-top:5pt;width:104pt;height:64pt;z-index:10"+(i[1].hidden?";visibility:hidden":""),fillcolor:"#ECFAD4",strokecolor:"#edeaa1"})+">",u,writextag("v:shadow",null,d),writextag("v:path",null,{"o:connecttype":"none"}),'<v:textbox><div style="text-align:left"></div></v:textbox>','<x:ClientData ObjectType="Note">',"<x:MoveWithCells/>","<x:SizeWithCells/>",writetag("x:Anchor",[o.c+1,0,o.r+1,0,o.c+3,20,o.r+5,20].join(",")),writetag("x:AutoFill","False"),writetag("x:Row",String(o.r)),writetag("x:Column",String(o.c)),i[1].hidden?"":"<x:Visible/>","</x:ClientData>","</v:shape>"])}),a.push("</xml>"),a.join("")}function write_comments_xml(t){var r=[XML_HEADER,writextag("comments",null,{xmlns:XMLNS_main[0]})],e=[];return r.push("<authors>"),t.forEach(function(s){s[1].forEach(function(a){var i=escapexml(a.a);e.indexOf(i)==-1&&(e.push(i),r.push("<author>"+i+"</author>")),a.T&&a.ID&&e.indexOf("tc="+a.ID)==-1&&(e.push("tc="+a.ID),r.push("<author>tc="+a.ID+"</author>"))})}),e.length==0&&(e.push("SheetJ5"),r.push("<author>SheetJ5</author>")),r.push("</authors>"),r.push("<commentList>"),t.forEach(function(s){var a=0,i=[];if(s[1][0]&&s[1][0].T&&s[1][0].ID?a=e.indexOf("tc="+s[1][0].ID):s[1].forEach(function(h){h.a&&(a=e.indexOf(escapexml(h.a))),i.push(h.t||"")}),r.push('<comment ref="'+s[0]+'" authorId="'+a+'"><text>'),i.length<=1)r.push(writetag("t",escapexml(i[0]||"")));else{for(var o=`Comment:
    `+i[0]+`
`,c=1;c<i.length;++c)o+=`Reply:
    `+i[c]+`
`;r.push(writetag("t",escapexml(o)))}r.push("</text></comment>")}),r.push("</commentList>"),r.length>2&&(r[r.length]="</comments>",r[1]=r[1].replace("/>",">")),r.join("")}function write_tcmnt_xml(t,r,e){var s=[XML_HEADER,writextag("ThreadedComments",null,{xmlns:XMLNS.TCMNT}).replace(/[\/]>/,">")];return t.forEach(function(a){var i="";(a[1]||[]).forEach(function(o,c){if(!o.T){delete o.ID;return}o.a&&r.indexOf(o.a)==-1&&r.push(o.a);var h={ref:a[0],id:"{54EE7951-7262-4200-6969-"+("000000000000"+e.tcid++).slice(-12)+"}"};c==0?i=h.id:h.parentId=i,o.ID=h.id,o.a&&(h.personId="{54EE7950-7262-4200-6969-"+("000000000000"+r.indexOf(o.a)).slice(-12)+"}"),s.push(writextag("threadedComment",writetag("text",o.t||""),h))})}),s.push("</ThreadedComments>"),s.join("")}function write_people_xml(t){var r=[XML_HEADER,writextag("personList",null,{xmlns:XMLNS.TCMNT,"xmlns:x":XMLNS_main[0]}).replace(/[\/]>/,">")];return t.forEach(function(e,s){r.push(writextag("person",null,{displayName:e,id:"{54EE7950-7262-4200-6969-"+("000000000000"+s).slice(-12)+"}",userId:e,providerId:"None"}))}),r.push("</personList>"),r.join("")}function parse_BrtBeginComment(t){var r={};r.iauthor=t.read_shift(4);var e=parse_UncheckedRfX(t);return r.rfx=e.s,r.ref=encode_cell(e.s),t.l+=16,r}function write_BrtBeginComment(t,r){return r==null&&(r=new_buf(36)),r.write_shift(4,t[1].iauthor),write_UncheckedRfX(t[0],r),r.write_shift(4,0),r.write_shift(4,0),r.write_shift(4,0),r.write_shift(4,0),r}var parse_BrtCommentAuthor=parse_XLWideString;function write_BrtCommentAuthor(t){return write_XLWideString(t.slice(0,54))}function write_comments_bin(t){var r=buf_array(),e=[];return write_record(r,628),write_record(r,630),t.forEach(function(s){s[1].forEach(function(a){e.indexOf(a.a)>-1||(e.push(a.a.slice(0,54)),write_record(r,632,write_BrtCommentAuthor(a.a)))})}),write_record(r,631),write_record(r,633),t.forEach(function(s){s[1].forEach(function(a){a.iauthor=e.indexOf(a.a);var i={s:decode_cell(s[0]),e:decode_cell(s[0])};write_record(r,635,write_BrtBeginComment([i,a])),a.t&&a.t.length>0&&write_record(r,637,write_BrtCommentText(a)),write_record(r,636),delete a.iauthor})}),write_record(r,634),write_record(r,629),r.end()}function fill_vba_xls(t,r){r.FullPaths.forEach(function(e,s){if(s!=0){var a=e.replace(/[^\/]*[\/]/,"/_VBA_PROJECT_CUR/");a.slice(-1)!=="/"&&CFB.utils.cfb_add(t,a,r.FileIndex[s].content)}})}var VBAFMTS=["xlsb","xlsm","xlam","biff8","xla"],rc_to_a1=function(){var t=/(^|[^A-Za-z_])R(\[?-?\d+\]|[1-9]\d*|)C(\[?-?\d+\]|[1-9]\d*|)(?![A-Za-z0-9_])/g,r={r:0,c:0};function e(s,a,i,o){var c=!1,h=!1;i.length==0?h=!0:i.charAt(0)=="["&&(h=!0,i=i.slice(1,-1)),o.length==0?c=!0:o.charAt(0)=="["&&(c=!0,o=o.slice(1,-1));var u=i.length>0?parseInt(i,10)|0:0,d=o.length>0?parseInt(o,10)|0:0;return c?d+=r.c:--d,h?u+=r.r:--u,a+(c?"":"$")+encode_col(d)+(h?"":"$")+encode_row(u)}return function(a,i){return r=i,a.replace(t,e)}}(),crefregex=/(^|[^._A-Z0-9])([$]?)([A-Z]{1,2}|[A-W][A-Z]{2}|X[A-E][A-Z]|XF[A-D])([$]?)(10[0-3]\d{4}|104[0-7]\d{3}|1048[0-4]\d{2}|10485[0-6]\d|104857[0-6]|[1-9]\d{0,5})(?![_.\(A-Za-z0-9])/g,a1_to_rc=function(){return function(r,e){return r.replace(crefregex,function(s,a,i,o,c,h){var u=decode_col(o)-(i?0:e.c),d=decode_row(h)-(c?0:e.r),_=d==0?"":c?d+1:"["+d+"]",b=u==0?"":i?u+1:"["+u+"]";return a+"R"+_+"C"+b})}}();function shift_formula_str(t,r){return t.replace(crefregex,function(e,s,a,i,o,c){return s+(a=="$"?a+i:encode_col(decode_col(i)+r.c))+(o=="$"?o+c:encode_row(decode_row(c)+r.r))})}function fuzzyfmla(t){return t.length!=1}function parseread1(t){t.l+=1}function parse_ColRelU(t,r){var e=t.read_shift(2);return[e&16383,e>>14&1,e>>15&1]}function parse_RgceArea(t,r,e){var s=2;if(e){if(e.biff>=2&&e.biff<=5)return parse_RgceArea_BIFF2(t);e.biff==12&&(s=4)}var a=t.read_shift(s),i=t.read_shift(s),o=parse_ColRelU(t),c=parse_ColRelU(t);return{s:{r:a,c:o[0],cRel:o[1],rRel:o[2]},e:{r:i,c:c[0],cRel:c[1],rRel:c[2]}}}function parse_RgceArea_BIFF2(t){var r=parse_ColRelU(t),e=parse_ColRelU(t),s=t.read_shift(1),a=t.read_shift(1);return{s:{r:r[0],c:s,cRel:r[1],rRel:r[2]},e:{r:e[0],c:a,cRel:e[1],rRel:e[2]}}}function parse_RgceAreaRel(t,r,e){if(e.biff<8)return parse_RgceArea_BIFF2(t);var s=t.read_shift(e.biff==12?4:2),a=t.read_shift(e.biff==12?4:2),i=parse_ColRelU(t),o=parse_ColRelU(t);return{s:{r:s,c:i[0],cRel:i[1],rRel:i[2]},e:{r:a,c:o[0],cRel:o[1],rRel:o[2]}}}function parse_RgceLoc(t,r,e){if(e&&e.biff>=2&&e.biff<=5)return parse_RgceLoc_BIFF2(t);var s=t.read_shift(e&&e.biff==12?4:2),a=parse_ColRelU(t);return{r:s,c:a[0],cRel:a[1],rRel:a[2]}}function parse_RgceLoc_BIFF2(t){var r=parse_ColRelU(t),e=t.read_shift(1);return{r:r[0],c:e,cRel:r[1],rRel:r[2]}}function parse_RgceElfLoc(t){var r=t.read_shift(2),e=t.read_shift(2);return{r,c:e&255,fQuoted:!!(e&16384),cRel:e>>15,rRel:e>>15}}function parse_RgceLocRel(t,r,e){var s=e&&e.biff?e.biff:8;if(s>=2&&s<=5)return parse_RgceLocRel_BIFF2(t);var a=t.read_shift(s>=12?4:2),i=t.read_shift(2),o=(i&16384)>>14,c=(i&32768)>>15;if(i&=16383,c==1)for(;a>524287;)a-=1048576;if(o==1)for(;i>8191;)i=i-16384;return{r:a,c:i,cRel:o,rRel:c}}function parse_RgceLocRel_BIFF2(t){var r=t.read_shift(2),e=t.read_shift(1),s=(r&32768)>>15,a=(r&16384)>>14;return r&=16383,s==1&&r>=8192&&(r=r-16384),a==1&&e>=128&&(e=e-256),{r,c:e,cRel:a,rRel:s}}function parse_PtgArea(t,r,e){var s=(t[t.l++]&96)>>5,a=parse_RgceArea(t,e.biff>=2&&e.biff<=5?6:8,e);return[s,a]}function parse_PtgArea3d(t,r,e){var s=(t[t.l++]&96)>>5,a=t.read_shift(2,"i"),i=8;if(e)switch(e.biff){case 5:t.l+=12,i=6;break;case 12:i=12;break}var o=parse_RgceArea(t,i,e);return[s,a,o]}function parse_PtgAreaErr(t,r,e){var s=(t[t.l++]&96)>>5;return t.l+=e&&e.biff>8?12:e.biff<8?6:8,[s]}function parse_PtgAreaErr3d(t,r,e){var s=(t[t.l++]&96)>>5,a=t.read_shift(2),i=8;if(e)switch(e.biff){case 5:t.l+=12,i=6;break;case 12:i=12;break}return t.l+=i,[s,a]}function parse_PtgAreaN(t,r,e){var s=(t[t.l++]&96)>>5,a=parse_RgceAreaRel(t,r-1,e);return[s,a]}function parse_PtgArray(t,r,e){var s=(t[t.l++]&96)>>5;return t.l+=e.biff==2?6:e.biff==12?14:7,[s]}function parse_PtgAttrBaxcel(t){var r=t[t.l+1]&1,e=1;return t.l+=4,[r,e]}function parse_PtgAttrChoose(t,r,e){t.l+=2;for(var s=t.read_shift(e&&e.biff==2?1:2),a=[],i=0;i<=s;++i)a.push(t.read_shift(e&&e.biff==2?1:2));return a}function parse_PtgAttrGoto(t,r,e){var s=t[t.l+1]&255?1:0;return t.l+=2,[s,t.read_shift(e&&e.biff==2?1:2)]}function parse_PtgAttrIf(t,r,e){var s=t[t.l+1]&255?1:0;return t.l+=2,[s,t.read_shift(e&&e.biff==2?1:2)]}function parse_PtgAttrIfError(t){var r=t[t.l+1]&255?1:0;return t.l+=2,[r,t.read_shift(2)]}function parse_PtgAttrSemi(t,r,e){var s=t[t.l+1]&255?1:0;return t.l+=e&&e.biff==2?3:4,[s]}function parse_PtgAttrSpaceType(t){var r=t.read_shift(1),e=t.read_shift(1);return[r,e]}function parse_PtgAttrSpace(t){return t.read_shift(2),parse_PtgAttrSpaceType(t)}function parse_PtgAttrSpaceSemi(t){return t.read_shift(2),parse_PtgAttrSpaceType(t)}function parse_PtgRef(t,r,e){var s=(t[t.l]&96)>>5;t.l+=1;var a=parse_RgceLoc(t,0,e);return[s,a]}function parse_PtgRefN(t,r,e){var s=(t[t.l]&96)>>5;t.l+=1;var a=parse_RgceLocRel(t,0,e);return[s,a]}function parse_PtgRef3d(t,r,e){var s=(t[t.l]&96)>>5;t.l+=1;var a=t.read_shift(2);e&&e.biff==5&&(t.l+=12);var i=parse_RgceLoc(t,0,e);return[s,a,i]}function parse_PtgFunc(t,r,e){var s=(t[t.l]&96)>>5;t.l+=1;var a=t.read_shift(e&&e.biff<=3?1:2);return[FtabArgc[a],Ftab[a],s]}function parse_PtgFuncVar(t,r,e){var s=t[t.l++],a=t.read_shift(1),i=e&&e.biff<=3?[s==88?-1:0,t.read_shift(1)]:parsetab(t);return[a,(i[0]===0?Ftab:Cetab)[i[1]]]}function parsetab(t){return[t[t.l+1]>>7,t.read_shift(2)&32767]}function parse_PtgAttrSum(t,r,e){t.l+=e&&e.biff==2?3:4}function parse_PtgExp(t,r,e){if(t.l++,e&&e.biff==12)return[t.read_shift(4,"i"),0];var s=t.read_shift(2),a=t.read_shift(e&&e.biff==2?1:2);return[s,a]}function parse_PtgErr(t){return t.l++,BErr[t.read_shift(1)]}function parse_PtgInt(t){return t.l++,t.read_shift(2)}function parse_PtgBool(t){return t.l++,t.read_shift(1)!==0}function parse_PtgNum(t){return t.l++,parse_Xnum(t)}function parse_PtgStr(t,r,e){return t.l++,parse_ShortXLUnicodeString(t,r-1,e)}function parse_SerAr(t,r){var e=[t.read_shift(1)];if(r==12)switch(e[0]){case 2:e[0]=4;break;case 4:e[0]=16;break;case 0:e[0]=1;break;case 1:e[0]=2;break}switch(e[0]){case 4:e[1]=parsebool(t,1)?"TRUE":"FALSE",r!=12&&(t.l+=7);break;case 37:case 16:e[1]=BErr[t[t.l]],t.l+=r==12?4:8;break;case 0:t.l+=8;break;case 1:e[1]=parse_Xnum(t);break;case 2:e[1]=parse_XLUnicodeString2(t,0,{biff:r>0&&r<8?2:r});break;default:throw new Error("Bad SerAr: "+e[0])}return e}function parse_PtgExtraMem(t,r,e){for(var s=t.read_shift(e.biff==12?4:2),a=[],i=0;i!=s;++i)a.push((e.biff==12?parse_UncheckedRfX:parse_Ref8U)(t));return a}function parse_PtgExtraArray(t,r,e){var s=0,a=0;e.biff==12?(s=t.read_shift(4),a=t.read_shift(4)):(a=1+t.read_shift(1),s=1+t.read_shift(2)),e.biff>=2&&e.biff<8&&(--s,--a==0&&(a=256));for(var i=0,o=[];i!=s&&(o[i]=[]);++i)for(var c=0;c!=a;++c)o[i][c]=parse_SerAr(t,e.biff);return o}function parse_PtgName(t,r,e){var s=t.read_shift(1)>>>5&3,a=!e||e.biff>=8?4:2,i=t.read_shift(a);switch(e.biff){case 2:t.l+=5;break;case 3:case 4:t.l+=8;break;case 5:t.l+=12;break}return[s,0,i]}function parse_PtgNameX(t,r,e){if(e.biff==5)return parse_PtgNameX_BIFF5(t);var s=t.read_shift(1)>>>5&3,a=t.read_shift(2),i=t.read_shift(4);return[s,a,i]}function parse_PtgNameX_BIFF5(t){var r=t.read_shift(1)>>>5&3,e=t.read_shift(2,"i");t.l+=8;var s=t.read_shift(2);return t.l+=12,[r,e,s]}function parse_PtgMemArea(t,r,e){var s=t.read_shift(1)>>>5&3;t.l+=e&&e.biff==2?3:4;var a=t.read_shift(e&&e.biff==2?1:2);return[s,a]}function parse_PtgMemFunc(t,r,e){var s=t.read_shift(1)>>>5&3,a=t.read_shift(e&&e.biff==2?1:2);return[s,a]}function parse_PtgRefErr(t,r,e){var s=t.read_shift(1)>>>5&3;return t.l+=4,e.biff<8&&t.l--,e.biff==12&&(t.l+=2),[s]}function parse_PtgRefErr3d(t,r,e){var s=(t[t.l++]&96)>>5,a=t.read_shift(2),i=4;if(e)switch(e.biff){case 5:i=15;break;case 12:i=6;break}return t.l+=i,[s,a]}var parse_PtgMemErr=parsenoop,parse_PtgMemNoMem=parsenoop,parse_PtgTbl=parsenoop;function parse_PtgElfLoc(t,r,e){return t.l+=2,[parse_RgceElfLoc(t)]}function parse_PtgElfNoop(t){return t.l+=6,[]}var parse_PtgElfCol=parse_PtgElfLoc,parse_PtgElfColS=parse_PtgElfNoop,parse_PtgElfColSV=parse_PtgElfNoop,parse_PtgElfColV=parse_PtgElfLoc;function parse_PtgElfLel(t){return t.l+=2,[parseuint16(t),t.read_shift(2)&1]}var parse_PtgElfRadical=parse_PtgElfLoc,parse_PtgElfRadicalLel=parse_PtgElfLel,parse_PtgElfRadicalS=parse_PtgElfNoop,parse_PtgElfRw=parse_PtgElfLoc,parse_PtgElfRwV=parse_PtgElfLoc,PtgListRT=["Data","All","Headers","??","?Data2","??","?DataHeaders","??","Totals","??","??","??","?DataTotals","??","??","??","?Current"];function parse_PtgList(t){t.l+=2;var r=t.read_shift(2),e=t.read_shift(2),s=t.read_shift(4),a=t.read_shift(2),i=t.read_shift(2),o=PtgListRT[e>>2&31];return{ixti:r,coltype:e&3,rt:o,idx:s,c:a,C:i}}function parse_PtgSxName(t){return t.l+=2,[t.read_shift(4)]}function parse_PtgSheet(t,r,e){return t.l+=5,t.l+=2,t.l+=e.biff==2?1:4,["PTGSHEET"]}function parse_PtgEndSheet(t,r,e){return t.l+=e.biff==2?4:5,["PTGENDSHEET"]}function parse_PtgMemAreaN(t){var r=t.read_shift(1)>>>5&3,e=t.read_shift(2);return[r,e]}function parse_PtgMemNoMemN(t){var r=t.read_shift(1)>>>5&3,e=t.read_shift(2);return[r,e]}function parse_PtgAttrNoop(t){return t.l+=4,[0,0]}var PtgTypes={1:{n:"PtgExp",f:parse_PtgExp},2:{n:"PtgTbl",f:parse_PtgTbl},3:{n:"PtgAdd",f:parseread1},4:{n:"PtgSub",f:parseread1},5:{n:"PtgMul",f:parseread1},6:{n:"PtgDiv",f:parseread1},7:{n:"PtgPower",f:parseread1},8:{n:"PtgConcat",f:parseread1},9:{n:"PtgLt",f:parseread1},10:{n:"PtgLe",f:parseread1},11:{n:"PtgEq",f:parseread1},12:{n:"PtgGe",f:parseread1},13:{n:"PtgGt",f:parseread1},14:{n:"PtgNe",f:parseread1},15:{n:"PtgIsect",f:parseread1},16:{n:"PtgUnion",f:parseread1},17:{n:"PtgRange",f:parseread1},18:{n:"PtgUplus",f:parseread1},19:{n:"PtgUminus",f:parseread1},20:{n:"PtgPercent",f:parseread1},21:{n:"PtgParen",f:parseread1},22:{n:"PtgMissArg",f:parseread1},23:{n:"PtgStr",f:parse_PtgStr},26:{n:"PtgSheet",f:parse_PtgSheet},27:{n:"PtgEndSheet",f:parse_PtgEndSheet},28:{n:"PtgErr",f:parse_PtgErr},29:{n:"PtgBool",f:parse_PtgBool},30:{n:"PtgInt",f:parse_PtgInt},31:{n:"PtgNum",f:parse_PtgNum},32:{n:"PtgArray",f:parse_PtgArray},33:{n:"PtgFunc",f:parse_PtgFunc},34:{n:"PtgFuncVar",f:parse_PtgFuncVar},35:{n:"PtgName",f:parse_PtgName},36:{n:"PtgRef",f:parse_PtgRef},37:{n:"PtgArea",f:parse_PtgArea},38:{n:"PtgMemArea",f:parse_PtgMemArea},39:{n:"PtgMemErr",f:parse_PtgMemErr},40:{n:"PtgMemNoMem",f:parse_PtgMemNoMem},41:{n:"PtgMemFunc",f:parse_PtgMemFunc},42:{n:"PtgRefErr",f:parse_PtgRefErr},43:{n:"PtgAreaErr",f:parse_PtgAreaErr},44:{n:"PtgRefN",f:parse_PtgRefN},45:{n:"PtgAreaN",f:parse_PtgAreaN},46:{n:"PtgMemAreaN",f:parse_PtgMemAreaN},47:{n:"PtgMemNoMemN",f:parse_PtgMemNoMemN},57:{n:"PtgNameX",f:parse_PtgNameX},58:{n:"PtgRef3d",f:parse_PtgRef3d},59:{n:"PtgArea3d",f:parse_PtgArea3d},60:{n:"PtgRefErr3d",f:parse_PtgRefErr3d},61:{n:"PtgAreaErr3d",f:parse_PtgAreaErr3d},255:{}},PtgDupes={64:32,96:32,65:33,97:33,66:34,98:34,67:35,99:35,68:36,100:36,69:37,101:37,70:38,102:38,71:39,103:39,72:40,104:40,73:41,105:41,74:42,106:42,75:43,107:43,76:44,108:44,77:45,109:45,78:46,110:46,79:47,111:47,88:34,120:34,89:57,121:57,90:58,122:58,91:59,123:59,92:60,124:60,93:61,125:61},Ptg18={1:{n:"PtgElfLel",f:parse_PtgElfLel},2:{n:"PtgElfRw",f:parse_PtgElfRw},3:{n:"PtgElfCol",f:parse_PtgElfCol},6:{n:"PtgElfRwV",f:parse_PtgElfRwV},7:{n:"PtgElfColV",f:parse_PtgElfColV},10:{n:"PtgElfRadical",f:parse_PtgElfRadical},11:{n:"PtgElfRadicalS",f:parse_PtgElfRadicalS},13:{n:"PtgElfColS",f:parse_PtgElfColS},15:{n:"PtgElfColSV",f:parse_PtgElfColSV},16:{n:"PtgElfRadicalLel",f:parse_PtgElfRadicalLel},25:{n:"PtgList",f:parse_PtgList},29:{n:"PtgSxName",f:parse_PtgSxName},255:{}},Ptg19={0:{n:"PtgAttrNoop",f:parse_PtgAttrNoop},1:{n:"PtgAttrSemi",f:parse_PtgAttrSemi},2:{n:"PtgAttrIf",f:parse_PtgAttrIf},4:{n:"PtgAttrChoose",f:parse_PtgAttrChoose},8:{n:"PtgAttrGoto",f:parse_PtgAttrGoto},16:{n:"PtgAttrSum",f:parse_PtgAttrSum},32:{n:"PtgAttrBaxcel",f:parse_PtgAttrBaxcel},33:{n:"PtgAttrBaxcel",f:parse_PtgAttrBaxcel},64:{n:"PtgAttrSpace",f:parse_PtgAttrSpace},65:{n:"PtgAttrSpaceSemi",f:parse_PtgAttrSpaceSemi},128:{n:"PtgAttrIfError",f:parse_PtgAttrIfError},255:{}};function parse_RgbExtra(t,r,e,s){if(s.biff<8)return parsenoop(t,r);for(var a=t.l+r,i=[],o=0;o!==e.length;++o)switch(e[o][0]){case"PtgArray":e[o][1]=parse_PtgExtraArray(t,0,s),i.push(e[o][1]);break;case"PtgMemArea":e[o][2]=parse_PtgExtraMem(t,e[o][1],s),i.push(e[o][2]);break;case"PtgExp":s&&s.biff==12&&(e[o][1][1]=t.read_shift(4),i.push(e[o][1]));break;case"PtgList":case"PtgElfRadicalS":case"PtgElfColS":case"PtgElfColSV":throw"Unsupported "+e[o][0]}return r=a-t.l,r!==0&&i.push(parsenoop(t,r)),i}function parse_Rgce(t,r,e){for(var s=t.l+r,a,i,o=[];s!=t.l;)r=s-t.l,i=t[t.l],a=PtgTypes[i]||PtgTypes[PtgDupes[i]],(i===24||i===25)&&(a=(i===24?Ptg18:Ptg19)[t[t.l+1]]),!a||!a.f?parsenoop(t,r):o.push([a.n,a.f(t,r,e)]);return o}function stringify_array(t){for(var r=[],e=0;e<t.length;++e){for(var s=t[e],a=[],i=0;i<s.length;++i){var o=s[i];if(o)switch(o[0]){case 2:a.push('"'+o[1].replace(/"/g,'""')+'"');break;default:a.push(o[1])}else a.push("")}r.push(a.join(","))}return r.join(";")}var PtgBinOp={PtgAdd:"+",PtgConcat:"&",PtgDiv:"/",PtgEq:"=",PtgGe:">=",PtgGt:">",PtgLe:"<=",PtgLt:"<",PtgMul:"*",PtgNe:"<>",PtgPower:"^",PtgSub:"-"};function formula_quote_sheet_name(t,r){if(!t&&!(r&&r.biff<=5&&r.biff>=2))throw new Error("empty sheet name");return/[^\w\u4E00-\u9FFF\u3040-\u30FF]/.test(t)?"'"+t+"'":t}function get_ixti_raw(t,r,e){if(!t)return"SH33TJSERR0";if(e.biff>8&&(!t.XTI||!t.XTI[r]))return t.SheetNames[r];if(!t.XTI)return"SH33TJSERR6";var s=t.XTI[r];if(e.biff<8)return r>1e4&&(r-=65536),r<0&&(r=-r),r==0?"":t.XTI[r-1];if(!s)return"SH33TJSERR1";var a="";if(e.biff>8)switch(t[s[0]][0]){case 357:return a=s[1]==-1?"#REF":t.SheetNames[s[1]],s[1]==s[2]?a:a+":"+t.SheetNames[s[2]];case 358:return e.SID!=null?t.SheetNames[e.SID]:"SH33TJSSAME"+t[s[0]][0];case 355:default:return"SH33TJSSRC"+t[s[0]][0]}switch(t[s[0]][0][0]){case 1025:return a=s[1]==-1?"#REF":t.SheetNames[s[1]]||"SH33TJSERR3",s[1]==s[2]?a:a+":"+t.SheetNames[s[2]];case 14849:return t[s[0]].slice(1).map(function(i){return i.Name}).join(";;");default:return t[s[0]][0][3]?(a=s[1]==-1?"#REF":t[s[0]][0][3][s[1]]||"SH33TJSERR4",s[1]==s[2]?a:a+":"+t[s[0]][0][3][s[2]]):"SH33TJSERR2"}}function get_ixti(t,r,e){var s=get_ixti_raw(t,r,e);return s=="#REF"?s:formula_quote_sheet_name(s,e)}function stringify_formula(t,r,e,s,a){var i=a&&a.biff||8,o={s:{c:0,r:0}},c=[],h,u,d,_=0,b=0,v,E="";if(!t[0]||!t[0][0])return"";for(var x=-1,g="",w=0,R=t[0].length;w<R;++w){var N=t[0][w];switch(N[0]){case"PtgUminus":c.push("-"+c.pop());break;case"PtgUplus":c.push("+"+c.pop());break;case"PtgPercent":c.push(c.pop()+"%");break;case"PtgAdd":case"PtgConcat":case"PtgDiv":case"PtgEq":case"PtgGe":case"PtgGt":case"PtgLe":case"PtgLt":case"PtgMul":case"PtgNe":case"PtgPower":case"PtgSub":if(h=c.pop(),u=c.pop(),x>=0){switch(t[0][x][1][0]){case 0:g=fill(" ",t[0][x][1][1]);break;case 1:g=fill("\r",t[0][x][1][1]);break;default:if(g="",a.WTF)throw new Error("Unexpected PtgAttrSpaceType "+t[0][x][1][0])}u=u+g,x=-1}c.push(u+PtgBinOp[N[0]]+h);break;case"PtgIsect":h=c.pop(),u=c.pop(),c.push(u+" "+h);break;case"PtgUnion":h=c.pop(),u=c.pop(),c.push(u+","+h);break;case"PtgRange":h=c.pop(),u=c.pop(),c.push(u+":"+h);break;case"PtgAttrChoose":break;case"PtgAttrGoto":break;case"PtgAttrIf":break;case"PtgAttrIfError":break;case"PtgRef":d=shift_cell_xls(N[1][1],o,a),c.push(encode_cell_xls(d,i));break;case"PtgRefN":d=e?shift_cell_xls(N[1][1],e,a):N[1][1],c.push(encode_cell_xls(d,i));break;case"PtgRef3d":_=N[1][1],d=shift_cell_xls(N[1][2],o,a),E=get_ixti(s,_,a),c.push(E+"!"+encode_cell_xls(d,i));break;case"PtgFunc":case"PtgFuncVar":var M=N[1][0],A=N[1][1];M||(M=0),M&=127;var I=M==0?[]:c.slice(-M);c.length-=M,A==="User"&&(A=I.shift()),c.push(A+"("+I.join(",")+")");break;case"PtgBool":c.push(N[1]?"TRUE":"FALSE");break;case"PtgInt":c.push(N[1]);break;case"PtgNum":c.push(String(N[1]));break;case"PtgStr":c.push('"'+N[1].replace(/"/g,'""')+'"');break;case"PtgErr":c.push(N[1]);break;case"PtgAreaN":v=shift_range_xls(N[1][1],e?{s:e}:o,a),c.push(encode_range_xls(v,a));break;case"PtgArea":v=shift_range_xls(N[1][1],o,a),c.push(encode_range_xls(v,a));break;case"PtgArea3d":_=N[1][1],v=N[1][2],E=get_ixti(s,_,a),c.push(E+"!"+encode_range_xls(v,a));break;case"PtgAttrSum":c.push("SUM("+c.pop()+")");break;case"PtgAttrBaxcel":case"PtgAttrSemi":break;case"PtgName":b=N[1][2];var y=(s.names||[])[b-1]||(s[0]||[])[b],j=y?y.Name:"SH33TJSNAME"+String(b);j&&j.slice(0,6)=="_xlfn."&&!a.xlfn&&(j=j.slice(6)),c.push(j);break;case"PtgNameX":var T=N[1][1];b=N[1][2];var U;if(a.biff<=5)T<0&&(T=-T),s[T]&&(U=s[T][b]);else{var F="";if(((s[T]||[])[0]||[])[0]==14849||(((s[T]||[])[0]||[])[0]==1025?s[T][b]&&s[T][b].itab>0&&(F=s.SheetNames[s[T][b].itab-1]+"!"):F=s.SheetNames[b-1]+"!"),s[T]&&s[T][b])F+=s[T][b].Name;else if(s[0]&&s[0][b])F+=s[0][b].Name;else{var H=(get_ixti_raw(s,T,a)||"").split(";;");H[b-1]?F=H[b-1]:F+="SH33TJSERRX"}c.push(F);break}U||(U={Name:"SH33TJSERRY"}),c.push(U.Name);break;case"PtgParen":var z="(",de=")";if(x>=0){switch(g="",t[0][x][1][0]){case 2:z=fill(" ",t[0][x][1][1])+z;break;case 3:z=fill("\r",t[0][x][1][1])+z;break;case 4:de=fill(" ",t[0][x][1][1])+de;break;case 5:de=fill("\r",t[0][x][1][1])+de;break;default:if(a.WTF)throw new Error("Unexpected PtgAttrSpaceType "+t[0][x][1][0])}x=-1}c.push(z+c.pop()+de);break;case"PtgRefErr":c.push("#REF!");break;case"PtgRefErr3d":c.push("#REF!");break;case"PtgExp":d={c:N[1][1],r:N[1][0]};var se={c:e.c,r:e.r};if(s.sharedf[encode_cell(d)]){var ue=s.sharedf[encode_cell(d)];c.push(stringify_formula(ue,o,se,s,a))}else{var Z=!1;for(h=0;h!=s.arrayf.length;++h)if(u=s.arrayf[h],!(d.c<u[0].s.c||d.c>u[0].e.c)&&!(d.r<u[0].s.r||d.r>u[0].e.r)){c.push(stringify_formula(u[1],o,se,s,a)),Z=!0;break}Z||c.push(N[1])}break;case"PtgArray":c.push("{"+stringify_array(N[1])+"}");break;case"PtgMemArea":break;case"PtgAttrSpace":case"PtgAttrSpaceSemi":x=w;break;case"PtgTbl":break;case"PtgMemErr":break;case"PtgMissArg":c.push("");break;case"PtgAreaErr":c.push("#REF!");break;case"PtgAreaErr3d":c.push("#REF!");break;case"PtgList":c.push("Table"+N[1].idx+"[#"+N[1].rt+"]");break;case"PtgMemAreaN":case"PtgMemNoMemN":case"PtgAttrNoop":case"PtgSheet":case"PtgEndSheet":break;case"PtgMemFunc":break;case"PtgMemNoMem":break;case"PtgElfCol":case"PtgElfColS":case"PtgElfColSV":case"PtgElfColV":case"PtgElfLel":case"PtgElfRadical":case"PtgElfRadicalLel":case"PtgElfRadicalS":case"PtgElfRw":case"PtgElfRwV":throw new Error("Unsupported ELFs");case"PtgSxName":throw new Error("Unrecognized Formula Token: "+String(N));default:throw new Error("Unrecognized Formula Token: "+String(N))}var ge=["PtgAttrSpace","PtgAttrSpaceSemi","PtgAttrGoto"];if(a.biff!=3&&x>=0&&ge.indexOf(t[0][w][0])==-1){N=t[0][x];var re=!0;switch(N[1][0]){case 4:re=!1;case 0:g=fill(" ",N[1][1]);break;case 5:re=!1;case 1:g=fill("\r",N[1][1]);break;default:if(g="",a.WTF)throw new Error("Unexpected PtgAttrSpaceType "+N[1][0])}c.push((re?g:"")+c.pop()+(re?"":g)),x=-1}}if(c.length>1&&a.WTF)throw new Error("bad formula stack");return c[0]}function write_FormulaValue(t){if(t==null){var r=new_buf(8);return r.write_shift(1,3),r.write_shift(1,0),r.write_shift(2,0),r.write_shift(2,0),r.write_shift(2,65535),r}else if(typeof t=="number")return write_Xnum(t);return write_Xnum(0)}function write_Formula(t,r,e,s,a){var i=write_XLSCell(r,e,a),o=write_FormulaValue(t.v),c=new_buf(6),h=33;c.write_shift(2,h),c.write_shift(4,0);for(var u=new_buf(t.bf.length),d=0;d<t.bf.length;++d)u[d]=t.bf[d];var _=bconcat([i,o,c,u]);return _}function parse_XLSBParsedFormula(t,r,e){var s=t.read_shift(4),a=parse_Rgce(t,s,e),i=t.read_shift(4),o=i>0?parse_RgbExtra(t,i,a,e):null;return[a,o]}var parse_XLSBArrayParsedFormula=parse_XLSBParsedFormula,parse_XLSBCellParsedFormula=parse_XLSBParsedFormula,parse_XLSBNameParsedFormula=parse_XLSBParsedFormula,parse_XLSBSharedParsedFormula=parse_XLSBParsedFormula,Cetab={0:"BEEP",1:"OPEN",2:"OPEN.LINKS",3:"CLOSE.ALL",4:"SAVE",5:"SAVE.AS",6:"FILE.DELETE",7:"PAGE.SETUP",8:"PRINT",9:"PRINTER.SETUP",10:"QUIT",11:"NEW.WINDOW",12:"ARRANGE.ALL",13:"WINDOW.SIZE",14:"WINDOW.MOVE",15:"FULL",16:"CLOSE",17:"RUN",22:"SET.PRINT.AREA",23:"SET.PRINT.TITLES",24:"SET.PAGE.BREAK",25:"REMOVE.PAGE.BREAK",26:"FONT",27:"DISPLAY",28:"PROTECT.DOCUMENT",29:"PRECISION",30:"A1.R1C1",31:"CALCULATE.NOW",32:"CALCULATION",34:"DATA.FIND",35:"EXTRACT",36:"DATA.DELETE",37:"SET.DATABASE",38:"SET.CRITERIA",39:"SORT",40:"DATA.SERIES",41:"TABLE",42:"FORMAT.NUMBER",43:"ALIGNMENT",44:"STYLE",45:"BORDER",46:"CELL.PROTECTION",47:"COLUMN.WIDTH",48:"UNDO",49:"CUT",50:"COPY",51:"PASTE",52:"CLEAR",53:"PASTE.SPECIAL",54:"EDIT.DELETE",55:"INSERT",56:"FILL.RIGHT",57:"FILL.DOWN",61:"DEFINE.NAME",62:"CREATE.NAMES",63:"FORMULA.GOTO",64:"FORMULA.FIND",65:"SELECT.LAST.CELL",66:"SHOW.ACTIVE.CELL",67:"GALLERY.AREA",68:"GALLERY.BAR",69:"GALLERY.COLUMN",70:"GALLERY.LINE",71:"GALLERY.PIE",72:"GALLERY.SCATTER",73:"COMBINATION",74:"PREFERRED",75:"ADD.OVERLAY",76:"GRIDLINES",77:"SET.PREFERRED",78:"AXES",79:"LEGEND",80:"ATTACH.TEXT",81:"ADD.ARROW",82:"SELECT.CHART",83:"SELECT.PLOT.AREA",84:"PATTERNS",85:"MAIN.CHART",86:"OVERLAY",87:"SCALE",88:"FORMAT.LEGEND",89:"FORMAT.TEXT",90:"EDIT.REPEAT",91:"PARSE",92:"JUSTIFY",93:"HIDE",94:"UNHIDE",95:"WORKSPACE",96:"FORMULA",97:"FORMULA.FILL",98:"FORMULA.ARRAY",99:"DATA.FIND.NEXT",100:"DATA.FIND.PREV",101:"FORMULA.FIND.NEXT",102:"FORMULA.FIND.PREV",103:"ACTIVATE",104:"ACTIVATE.NEXT",105:"ACTIVATE.PREV",106:"UNLOCKED.NEXT",107:"UNLOCKED.PREV",108:"COPY.PICTURE",109:"SELECT",110:"DELETE.NAME",111:"DELETE.FORMAT",112:"VLINE",113:"HLINE",114:"VPAGE",115:"HPAGE",116:"VSCROLL",117:"HSCROLL",118:"ALERT",119:"NEW",120:"CANCEL.COPY",121:"SHOW.CLIPBOARD",122:"MESSAGE",124:"PASTE.LINK",125:"APP.ACTIVATE",126:"DELETE.ARROW",127:"ROW.HEIGHT",128:"FORMAT.MOVE",129:"FORMAT.SIZE",130:"FORMULA.REPLACE",131:"SEND.KEYS",132:"SELECT.SPECIAL",133:"APPLY.NAMES",134:"REPLACE.FONT",135:"FREEZE.PANES",136:"SHOW.INFO",137:"SPLIT",138:"ON.WINDOW",139:"ON.DATA",140:"DISABLE.INPUT",142:"OUTLINE",143:"LIST.NAMES",144:"FILE.CLOSE",145:"SAVE.WORKBOOK",146:"DATA.FORM",147:"COPY.CHART",148:"ON.TIME",149:"WAIT",150:"FORMAT.FONT",151:"FILL.UP",152:"FILL.LEFT",153:"DELETE.OVERLAY",155:"SHORT.MENUS",159:"SET.UPDATE.STATUS",161:"COLOR.PALETTE",162:"DELETE.STYLE",163:"WINDOW.RESTORE",164:"WINDOW.MAXIMIZE",166:"CHANGE.LINK",167:"CALCULATE.DOCUMENT",168:"ON.KEY",169:"APP.RESTORE",170:"APP.MOVE",171:"APP.SIZE",172:"APP.MINIMIZE",173:"APP.MAXIMIZE",174:"BRING.TO.FRONT",175:"SEND.TO.BACK",185:"MAIN.CHART.TYPE",186:"OVERLAY.CHART.TYPE",187:"SELECT.END",188:"OPEN.MAIL",189:"SEND.MAIL",190:"STANDARD.FONT",191:"CONSOLIDATE",192:"SORT.SPECIAL",193:"GALLERY.3D.AREA",194:"GALLERY.3D.COLUMN",195:"GALLERY.3D.LINE",196:"GALLERY.3D.PIE",197:"VIEW.3D",198:"GOAL.SEEK",199:"WORKGROUP",200:"FILL.GROUP",201:"UPDATE.LINK",202:"PROMOTE",203:"DEMOTE",204:"SHOW.DETAIL",206:"UNGROUP",207:"OBJECT.PROPERTIES",208:"SAVE.NEW.OBJECT",209:"SHARE",210:"SHARE.NAME",211:"DUPLICATE",212:"APPLY.STYLE",213:"ASSIGN.TO.OBJECT",214:"OBJECT.PROTECTION",215:"HIDE.OBJECT",216:"SET.EXTRACT",217:"CREATE.PUBLISHER",218:"SUBSCRIBE.TO",219:"ATTRIBUTES",220:"SHOW.TOOLBAR",222:"PRINT.PREVIEW",223:"EDIT.COLOR",224:"SHOW.LEVELS",225:"FORMAT.MAIN",226:"FORMAT.OVERLAY",227:"ON.RECALC",228:"EDIT.SERIES",229:"DEFINE.STYLE",240:"LINE.PRINT",243:"ENTER.DATA",249:"GALLERY.RADAR",250:"MERGE.STYLES",251:"EDITION.OPTIONS",252:"PASTE.PICTURE",253:"PASTE.PICTURE.LINK",254:"SPELLING",256:"ZOOM",259:"INSERT.OBJECT",260:"WINDOW.MINIMIZE",265:"SOUND.NOTE",266:"SOUND.PLAY",267:"FORMAT.SHAPE",268:"EXTEND.POLYGON",269:"FORMAT.AUTO",272:"GALLERY.3D.BAR",273:"GALLERY.3D.SURFACE",274:"FILL.AUTO",276:"CUSTOMIZE.TOOLBAR",277:"ADD.TOOL",278:"EDIT.OBJECT",279:"ON.DOUBLECLICK",280:"ON.ENTRY",281:"WORKBOOK.ADD",282:"WORKBOOK.MOVE",283:"WORKBOOK.COPY",284:"WORKBOOK.OPTIONS",285:"SAVE.WORKSPACE",288:"CHART.WIZARD",289:"DELETE.TOOL",290:"MOVE.TOOL",291:"WORKBOOK.SELECT",292:"WORKBOOK.ACTIVATE",293:"ASSIGN.TO.TOOL",295:"COPY.TOOL",296:"RESET.TOOL",297:"CONSTRAIN.NUMERIC",298:"PASTE.TOOL",302:"WORKBOOK.NEW",305:"SCENARIO.CELLS",306:"SCENARIO.DELETE",307:"SCENARIO.ADD",308:"SCENARIO.EDIT",309:"SCENARIO.SHOW",310:"SCENARIO.SHOW.NEXT",311:"SCENARIO.SUMMARY",312:"PIVOT.TABLE.WIZARD",313:"PIVOT.FIELD.PROPERTIES",314:"PIVOT.FIELD",315:"PIVOT.ITEM",316:"PIVOT.ADD.FIELDS",318:"OPTIONS.CALCULATION",319:"OPTIONS.EDIT",320:"OPTIONS.VIEW",321:"ADDIN.MANAGER",322:"MENU.EDITOR",323:"ATTACH.TOOLBARS",324:"VBAActivate",325:"OPTIONS.CHART",328:"VBA.INSERT.FILE",330:"VBA.PROCEDURE.DEFINITION",336:"ROUTING.SLIP",338:"ROUTE.DOCUMENT",339:"MAIL.LOGON",342:"INSERT.PICTURE",343:"EDIT.TOOL",344:"GALLERY.DOUGHNUT",350:"CHART.TREND",352:"PIVOT.ITEM.PROPERTIES",354:"WORKBOOK.INSERT",355:"OPTIONS.TRANSITION",356:"OPTIONS.GENERAL",370:"FILTER.ADVANCED",373:"MAIL.ADD.MAILER",374:"MAIL.DELETE.MAILER",375:"MAIL.REPLY",376:"MAIL.REPLY.ALL",377:"MAIL.FORWARD",378:"MAIL.NEXT.LETTER",379:"DATA.LABEL",380:"INSERT.TITLE",381:"FONT.PROPERTIES",382:"MACRO.OPTIONS",383:"WORKBOOK.HIDE",384:"WORKBOOK.UNHIDE",385:"WORKBOOK.DELETE",386:"WORKBOOK.NAME",388:"GALLERY.CUSTOM",390:"ADD.CHART.AUTOFORMAT",391:"DELETE.CHART.AUTOFORMAT",392:"CHART.ADD.DATA",393:"AUTO.OUTLINE",394:"TAB.ORDER",395:"SHOW.DIALOG",396:"SELECT.ALL",397:"UNGROUP.SHEETS",398:"SUBTOTAL.CREATE",399:"SUBTOTAL.REMOVE",400:"RENAME.OBJECT",412:"WORKBOOK.SCROLL",413:"WORKBOOK.NEXT",414:"WORKBOOK.PREV",415:"WORKBOOK.TAB.SPLIT",416:"FULL.SCREEN",417:"WORKBOOK.PROTECT",420:"SCROLLBAR.PROPERTIES",421:"PIVOT.SHOW.PAGES",422:"TEXT.TO.COLUMNS",423:"FORMAT.CHARTTYPE",424:"LINK.FORMAT",425:"TRACER.DISPLAY",430:"TRACER.NAVIGATE",431:"TRACER.CLEAR",432:"TRACER.ERROR",433:"PIVOT.FIELD.GROUP",434:"PIVOT.FIELD.UNGROUP",435:"CHECKBOX.PROPERTIES",436:"LABEL.PROPERTIES",437:"LISTBOX.PROPERTIES",438:"EDITBOX.PROPERTIES",439:"PIVOT.REFRESH",440:"LINK.COMBO",441:"OPEN.TEXT",442:"HIDE.DIALOG",443:"SET.DIALOG.FOCUS",444:"ENABLE.OBJECT",445:"PUSHBUTTON.PROPERTIES",446:"SET.DIALOG.DEFAULT",447:"FILTER",448:"FILTER.SHOW.ALL",449:"CLEAR.OUTLINE",450:"FUNCTION.WIZARD",451:"ADD.LIST.ITEM",452:"SET.LIST.ITEM",453:"REMOVE.LIST.ITEM",454:"SELECT.LIST.ITEM",455:"SET.CONTROL.VALUE",456:"SAVE.COPY.AS",458:"OPTIONS.LISTS.ADD",459:"OPTIONS.LISTS.DELETE",460:"SERIES.AXES",461:"SERIES.X",462:"SERIES.Y",463:"ERRORBAR.X",464:"ERRORBAR.Y",465:"FORMAT.CHART",466:"SERIES.ORDER",467:"MAIL.LOGOFF",468:"CLEAR.ROUTING.SLIP",469:"APP.ACTIVATE.MICROSOFT",470:"MAIL.EDIT.MAILER",471:"ON.SHEET",472:"STANDARD.WIDTH",473:"SCENARIO.MERGE",474:"SUMMARY.INFO",475:"FIND.FILE",476:"ACTIVE.CELL.FONT",477:"ENABLE.TIPWIZARD",478:"VBA.MAKE.ADDIN",480:"INSERTDATATABLE",481:"WORKGROUP.OPTIONS",482:"MAIL.SEND.MAILER",485:"AUTOCORRECT",489:"POST.DOCUMENT",491:"PICKLIST",493:"VIEW.SHOW",494:"VIEW.DEFINE",495:"VIEW.DELETE",509:"SHEET.BACKGROUND",510:"INSERT.MAP.OBJECT",511:"OPTIONS.MENONO",517:"MSOCHECKS",518:"NORMAL",519:"LAYOUT",520:"RM.PRINT.AREA",521:"CLEAR.PRINT.AREA",522:"ADD.PRINT.AREA",523:"MOVE.BRK",545:"HIDECURR.NOTE",546:"HIDEALL.NOTES",547:"DELETE.NOTE",548:"TRAVERSE.NOTES",549:"ACTIVATE.NOTES",620:"PROTECT.REVISIONS",621:"UNPROTECT.REVISIONS",647:"OPTIONS.ME",653:"WEB.PUBLISH",667:"NEWWEBQUERY",673:"PIVOT.TABLE.CHART",753:"OPTIONS.SAVE",755:"OPTIONS.SPELL",808:"HIDEALL.INKANNOTS"},Ftab={0:"COUNT",1:"IF",2:"ISNA",3:"ISERROR",4:"SUM",5:"AVERAGE",6:"MIN",7:"MAX",8:"ROW",9:"COLUMN",10:"NA",11:"NPV",12:"STDEV",13:"DOLLAR",14:"FIXED",15:"SIN",16:"COS",17:"TAN",18:"ATAN",19:"PI",20:"SQRT",21:"EXP",22:"LN",23:"LOG10",24:"ABS",25:"INT",26:"SIGN",27:"ROUND",28:"LOOKUP",29:"INDEX",30:"REPT",31:"MID",32:"LEN",33:"VALUE",34:"TRUE",35:"FALSE",36:"AND",37:"OR",38:"NOT",39:"MOD",40:"DCOUNT",41:"DSUM",42:"DAVERAGE",43:"DMIN",44:"DMAX",45:"DSTDEV",46:"VAR",47:"DVAR",48:"TEXT",49:"LINEST",50:"TREND",51:"LOGEST",52:"GROWTH",53:"GOTO",54:"HALT",55:"RETURN",56:"PV",57:"FV",58:"NPER",59:"PMT",60:"RATE",61:"MIRR",62:"IRR",63:"RAND",64:"MATCH",65:"DATE",66:"TIME",67:"DAY",68:"MONTH",69:"YEAR",70:"WEEKDAY",71:"HOUR",72:"MINUTE",73:"SECOND",74:"NOW",75:"AREAS",76:"ROWS",77:"COLUMNS",78:"OFFSET",79:"ABSREF",80:"RELREF",81:"ARGUMENT",82:"SEARCH",83:"TRANSPOSE",84:"ERROR",85:"STEP",86:"TYPE",87:"ECHO",88:"SET.NAME",89:"CALLER",90:"DEREF",91:"WINDOWS",92:"SERIES",93:"DOCUMENTS",94:"ACTIVE.CELL",95:"SELECTION",96:"RESULT",97:"ATAN2",98:"ASIN",99:"ACOS",100:"CHOOSE",101:"HLOOKUP",102:"VLOOKUP",103:"LINKS",104:"INPUT",105:"ISREF",106:"GET.FORMULA",107:"GET.NAME",108:"SET.VALUE",109:"LOG",110:"EXEC",111:"CHAR",112:"LOWER",113:"UPPER",114:"PROPER",115:"LEFT",116:"RIGHT",117:"EXACT",118:"TRIM",119:"REPLACE",120:"SUBSTITUTE",121:"CODE",122:"NAMES",123:"DIRECTORY",124:"FIND",125:"CELL",126:"ISERR",127:"ISTEXT",128:"ISNUMBER",129:"ISBLANK",130:"T",131:"N",132:"FOPEN",133:"FCLOSE",134:"FSIZE",135:"FREADLN",136:"FREAD",137:"FWRITELN",138:"FWRITE",139:"FPOS",140:"DATEVALUE",141:"TIMEVALUE",142:"SLN",143:"SYD",144:"DDB",145:"GET.DEF",146:"REFTEXT",147:"TEXTREF",148:"INDIRECT",149:"REGISTER",150:"CALL",151:"ADD.BAR",152:"ADD.MENU",153:"ADD.COMMAND",154:"ENABLE.COMMAND",155:"CHECK.COMMAND",156:"RENAME.COMMAND",157:"SHOW.BAR",158:"DELETE.MENU",159:"DELETE.COMMAND",160:"GET.CHART.ITEM",161:"DIALOG.BOX",162:"CLEAN",163:"MDETERM",164:"MINVERSE",165:"MMULT",166:"FILES",167:"IPMT",168:"PPMT",169:"COUNTA",170:"CANCEL.KEY",171:"FOR",172:"WHILE",173:"BREAK",174:"NEXT",175:"INITIATE",176:"REQUEST",177:"POKE",178:"EXECUTE",179:"TERMINATE",180:"RESTART",181:"HELP",182:"GET.BAR",183:"PRODUCT",184:"FACT",185:"GET.CELL",186:"GET.WORKSPACE",187:"GET.WINDOW",188:"GET.DOCUMENT",189:"DPRODUCT",190:"ISNONTEXT",191:"GET.NOTE",192:"NOTE",193:"STDEVP",194:"VARP",195:"DSTDEVP",196:"DVARP",197:"TRUNC",198:"ISLOGICAL",199:"DCOUNTA",200:"DELETE.BAR",201:"UNREGISTER",204:"USDOLLAR",205:"FINDB",206:"SEARCHB",207:"REPLACEB",208:"LEFTB",209:"RIGHTB",210:"MIDB",211:"LENB",212:"ROUNDUP",213:"ROUNDDOWN",214:"ASC",215:"DBCS",216:"RANK",219:"ADDRESS",220:"DAYS360",221:"TODAY",222:"VDB",223:"ELSE",224:"ELSE.IF",225:"END.IF",226:"FOR.CELL",227:"MEDIAN",228:"SUMPRODUCT",229:"SINH",230:"COSH",231:"TANH",232:"ASINH",233:"ACOSH",234:"ATANH",235:"DGET",236:"CREATE.OBJECT",237:"VOLATILE",238:"LAST.ERROR",239:"CUSTOM.UNDO",240:"CUSTOM.REPEAT",241:"FORMULA.CONVERT",242:"GET.LINK.INFO",243:"TEXT.BOX",244:"INFO",245:"GROUP",246:"GET.OBJECT",247:"DB",248:"PAUSE",251:"RESUME",252:"FREQUENCY",253:"ADD.TOOLBAR",254:"DELETE.TOOLBAR",255:"User",256:"RESET.TOOLBAR",257:"EVALUATE",258:"GET.TOOLBAR",259:"GET.TOOL",260:"SPELLING.CHECK",261:"ERROR.TYPE",262:"APP.TITLE",263:"WINDOW.TITLE",264:"SAVE.TOOLBAR",265:"ENABLE.TOOL",266:"PRESS.TOOL",267:"REGISTER.ID",268:"GET.WORKBOOK",269:"AVEDEV",270:"BETADIST",271:"GAMMALN",272:"BETAINV",273:"BINOMDIST",274:"CHIDIST",275:"CHIINV",276:"COMBIN",277:"CONFIDENCE",278:"CRITBINOM",279:"EVEN",280:"EXPONDIST",281:"FDIST",282:"FINV",283:"FISHER",284:"FISHERINV",285:"FLOOR",286:"GAMMADIST",287:"GAMMAINV",288:"CEILING",289:"HYPGEOMDIST",290:"LOGNORMDIST",291:"LOGINV",292:"NEGBINOMDIST",293:"NORMDIST",294:"NORMSDIST",295:"NORMINV",296:"NORMSINV",297:"STANDARDIZE",298:"ODD",299:"PERMUT",300:"POISSON",301:"TDIST",302:"WEIBULL",303:"SUMXMY2",304:"SUMX2MY2",305:"SUMX2PY2",306:"CHITEST",307:"CORREL",308:"COVAR",309:"FORECAST",310:"FTEST",311:"INTERCEPT",312:"PEARSON",313:"RSQ",314:"STEYX",315:"SLOPE",316:"TTEST",317:"PROB",318:"DEVSQ",319:"GEOMEAN",320:"HARMEAN",321:"SUMSQ",322:"KURT",323:"SKEW",324:"ZTEST",325:"LARGE",326:"SMALL",327:"QUARTILE",328:"PERCENTILE",329:"PERCENTRANK",330:"MODE",331:"TRIMMEAN",332:"TINV",334:"MOVIE.COMMAND",335:"GET.MOVIE",336:"CONCATENATE",337:"POWER",338:"PIVOT.ADD.DATA",339:"GET.PIVOT.TABLE",340:"GET.PIVOT.FIELD",341:"GET.PIVOT.ITEM",342:"RADIANS",343:"DEGREES",344:"SUBTOTAL",345:"SUMIF",346:"COUNTIF",347:"COUNTBLANK",348:"SCENARIO.GET",349:"OPTIONS.LISTS.GET",350:"ISPMT",351:"DATEDIF",352:"DATESTRING",353:"NUMBERSTRING",354:"ROMAN",355:"OPEN.DIALOG",356:"SAVE.DIALOG",357:"VIEW.GET",358:"GETPIVOTDATA",359:"HYPERLINK",360:"PHONETIC",361:"AVERAGEA",362:"MAXA",363:"MINA",364:"STDEVPA",365:"VARPA",366:"STDEVA",367:"VARA",368:"BAHTTEXT",369:"THAIDAYOFWEEK",370:"THAIDIGIT",371:"THAIMONTHOFYEAR",372:"THAINUMSOUND",373:"THAINUMSTRING",374:"THAISTRINGLENGTH",375:"ISTHAIDIGIT",376:"ROUNDBAHTDOWN",377:"ROUNDBAHTUP",378:"THAIYEAR",379:"RTD",380:"CUBEVALUE",381:"CUBEMEMBER",382:"CUBEMEMBERPROPERTY",383:"CUBERANKEDMEMBER",384:"HEX2BIN",385:"HEX2DEC",386:"HEX2OCT",387:"DEC2BIN",388:"DEC2HEX",389:"DEC2OCT",390:"OCT2BIN",391:"OCT2HEX",392:"OCT2DEC",393:"BIN2DEC",394:"BIN2OCT",395:"BIN2HEX",396:"IMSUB",397:"IMDIV",398:"IMPOWER",399:"IMABS",400:"IMSQRT",401:"IMLN",402:"IMLOG2",403:"IMLOG10",404:"IMSIN",405:"IMCOS",406:"IMEXP",407:"IMARGUMENT",408:"IMCONJUGATE",409:"IMAGINARY",410:"IMREAL",411:"COMPLEX",412:"IMSUM",413:"IMPRODUCT",414:"SERIESSUM",415:"FACTDOUBLE",416:"SQRTPI",417:"QUOTIENT",418:"DELTA",419:"GESTEP",420:"ISEVEN",421:"ISODD",422:"MROUND",423:"ERF",424:"ERFC",425:"BESSELJ",426:"BESSELK",427:"BESSELY",428:"BESSELI",429:"XIRR",430:"XNPV",431:"PRICEMAT",432:"YIELDMAT",433:"INTRATE",434:"RECEIVED",435:"DISC",436:"PRICEDISC",437:"YIELDDISC",438:"TBILLEQ",439:"TBILLPRICE",440:"TBILLYIELD",441:"PRICE",442:"YIELD",443:"DOLLARDE",444:"DOLLARFR",445:"NOMINAL",446:"EFFECT",447:"CUMPRINC",448:"CUMIPMT",449:"EDATE",450:"EOMONTH",451:"YEARFRAC",452:"COUPDAYBS",453:"COUPDAYS",454:"COUPDAYSNC",455:"COUPNCD",456:"COUPNUM",457:"COUPPCD",458:"DURATION",459:"MDURATION",460:"ODDLPRICE",461:"ODDLYIELD",462:"ODDFPRICE",463:"ODDFYIELD",464:"RANDBETWEEN",465:"WEEKNUM",466:"AMORDEGRC",467:"AMORLINC",468:"CONVERT",724:"SHEETJS",469:"ACCRINT",470:"ACCRINTM",471:"WORKDAY",472:"NETWORKDAYS",473:"GCD",474:"MULTINOMIAL",475:"LCM",476:"FVSCHEDULE",477:"CUBEKPIMEMBER",478:"CUBESET",479:"CUBESETCOUNT",480:"IFERROR",481:"COUNTIFS",482:"SUMIFS",483:"AVERAGEIF",484:"AVERAGEIFS"},FtabArgc={2:1,3:1,10:0,15:1,16:1,17:1,18:1,19:0,20:1,21:1,22:1,23:1,24:1,25:1,26:1,27:2,30:2,31:3,32:1,33:1,34:0,35:0,38:1,39:2,40:3,41:3,42:3,43:3,44:3,45:3,47:3,48:2,53:1,61:3,63:0,65:3,66:3,67:1,68:1,69:1,70:1,71:1,72:1,73:1,74:0,75:1,76:1,77:1,79:2,80:2,83:1,85:0,86:1,89:0,90:1,94:0,95:0,97:2,98:1,99:1,101:3,102:3,105:1,106:1,108:2,111:1,112:1,113:1,114:1,117:2,118:1,119:4,121:1,126:1,127:1,128:1,129:1,130:1,131:1,133:1,134:1,135:1,136:2,137:2,138:2,140:1,141:1,142:3,143:4,144:4,161:1,162:1,163:1,164:1,165:2,172:1,175:2,176:2,177:3,178:2,179:1,184:1,186:1,189:3,190:1,195:3,196:3,197:1,198:1,199:3,201:1,207:4,210:3,211:1,212:2,213:2,214:1,215:1,225:0,229:1,230:1,231:1,232:1,233:1,234:1,235:3,244:1,247:4,252:2,257:1,261:1,271:1,273:4,274:2,275:2,276:2,277:3,278:3,279:1,280:3,281:3,282:3,283:1,284:1,285:2,286:4,287:3,288:2,289:4,290:3,291:3,292:3,293:4,294:1,295:3,296:1,297:3,298:1,299:2,300:3,301:3,302:4,303:2,304:2,305:2,306:2,307:2,308:2,309:3,310:2,311:2,312:2,313:2,314:2,315:2,316:4,325:2,326:2,327:2,328:2,331:2,332:2,337:2,342:1,343:1,346:2,347:1,350:4,351:3,352:1,353:2,360:1,368:1,369:1,370:1,371:1,372:1,373:1,374:1,375:1,376:1,377:1,378:1,382:3,385:1,392:1,393:1,396:2,397:2,398:2,399:1,400:1,401:1,402:1,403:1,404:1,405:1,406:1,407:1,408:1,409:1,410:1,414:4,415:1,416:1,417:2,420:1,421:1,422:2,424:1,425:2,426:2,427:2,428:2,430:3,438:3,439:3,440:3,443:2,444:2,445:2,446:2,447:6,448:6,449:2,450:2,464:2,468:3,476:2,479:1,480:2,65535:0};function csf_to_ods_formula(t){var r="of:="+t.replace(crefregex,"$1[.$2$3$4$5]").replace(/\]:\[/g,":");return r.replace(/;/g,"|").replace(/,/g,";")}function csf_to_ods_3D(t){return t.replace(/\./,"!")}var browser_has_Map=typeof Map<"u";function get_sst_id(t,r,e){var s=0,a=t.length;if(e){if(browser_has_Map?e.has(r):Object.prototype.hasOwnProperty.call(e,r)){for(var i=browser_has_Map?e.get(r):e[r];s<i.length;++s)if(t[i[s]].t===r)return t.Count++,i[s]}}else for(;s<a;++s)if(t[s].t===r)return t.Count++,s;return t[a]={t:r},t.Count++,t.Unique++,e&&(browser_has_Map?(e.has(r)||e.set(r,[]),e.get(r).push(a)):(Object.prototype.hasOwnProperty.call(e,r)||(e[r]=[]),e[r].push(a))),a}function col_obj_w(t,r){var e={min:t+1,max:t+1},s=-1;return r.MDW&&(MDW=r.MDW),r.width!=null?e.customWidth=1:r.wpx!=null?s=px2char(r.wpx):r.wch!=null&&(s=r.wch),s>-1?(e.width=char2width(s),e.customWidth=1):r.width!=null&&(e.width=r.width),r.hidden&&(e.hidden=!0),r.level!=null&&(e.outlineLevel=e.level=r.level),e}function default_margins(t,r){if(t){var e=[.7,.7,.75,.75,.3,.3];t.left==null&&(t.left=e[0]),t.right==null&&(t.right=e[1]),t.top==null&&(t.top=e[2]),t.bottom==null&&(t.bottom=e[3]),t.header==null&&(t.header=e[4]),t.footer==null&&(t.footer=e[5])}}function get_cell_style(t,r,e){var s=e.revssf[r.z!=null?r.z:"General"],a=60,i=t.length;if(s==null&&e.ssf){for(;a<392;++a)if(e.ssf[a]==null){SSF_load(r.z,a),e.ssf[a]=r.z,e.revssf[r.z]=s=a;break}}for(a=0;a!=i;++a)if(t[a].numFmtId===s)return a;return t[i]={numFmtId:s,fontId:0,fillId:0,borderId:0,xfId:0,applyNumberFormat:1},i}function check_ws(t,r,e){if(t&&t["!ref"]){var s=safe_decode_range(t["!ref"]);if(s.e.c<s.s.c||s.e.r<s.s.r)throw new Error("Bad range ("+e+"): "+t["!ref"])}}function write_ws_xml_merges(t){if(t.length===0)return"";for(var r='<mergeCells count="'+t.length+'">',e=0;e!=t.length;++e)r+='<mergeCell ref="'+encode_range(t[e])+'"/>';return r+"</mergeCells>"}function write_ws_xml_sheetpr(t,r,e,s,a){var i=!1,o={},c=null;if(s.bookType!=="xlsx"&&r.vbaraw){var h=r.SheetNames[e];try{r.Workbook&&(h=r.Workbook.Sheets[e].CodeName||h)}catch{}i=!0,o.codeName=utf8write(escapexml(h))}if(t&&t["!outline"]){var u={summaryBelow:1,summaryRight:1};t["!outline"].above&&(u.summaryBelow=0),t["!outline"].left&&(u.summaryRight=0),c=(c||"")+writextag("outlinePr",null,u)}!i&&!c||(a[a.length]=writextag("sheetPr",c,o))}var sheetprot_deffalse=["objects","scenarios","selectLockedCells","selectUnlockedCells"],sheetprot_deftrue=["formatColumns","formatRows","formatCells","insertColumns","insertRows","insertHyperlinks","deleteColumns","deleteRows","sort","autoFilter","pivotTables"];function write_ws_xml_protection(t){var r={sheet:1};return sheetprot_deffalse.forEach(function(e){t[e]!=null&&t[e]&&(r[e]="1")}),sheetprot_deftrue.forEach(function(e){t[e]!=null&&!t[e]&&(r[e]="0")}),t.password&&(r.password=crypto_CreatePasswordVerifier_Method1(t.password).toString(16).toUpperCase()),writextag("sheetProtection",null,r)}function write_ws_xml_margins(t){return default_margins(t),writextag("pageMargins",null,t)}function write_ws_xml_cols(t,r){for(var e=["<cols>"],s,a=0;a!=r.length;++a)(s=r[a])&&(e[e.length]=writextag("col",null,col_obj_w(a,s)));return e[e.length]="</cols>",e.join("")}function write_ws_xml_autofilter(t,r,e,s){var a=typeof t.ref=="string"?t.ref:encode_range(t.ref);e.Workbook||(e.Workbook={Sheets:[]}),e.Workbook.Names||(e.Workbook.Names=[]);var i=e.Workbook.Names,o=decode_range(a);o.s.r==o.e.r&&(o.e.r=decode_range(r["!ref"]).e.r,a=encode_range(o));for(var c=0;c<i.length;++c){var h=i[c];if(h.Name=="_xlnm._FilterDatabase"&&h.Sheet==s){h.Ref="'"+e.SheetNames[s]+"'!"+a;break}}return c==i.length&&i.push({Name:"_xlnm._FilterDatabase",Sheet:s,Ref:"'"+e.SheetNames[s]+"'!"+a}),writextag("autoFilter",null,{ref:a})}function write_ws_xml_sheetviews(t,r,e,s){var a={workbookViewId:"0"};return(((s||{}).Workbook||{}).Views||[])[0]&&(a.rightToLeft=s.Workbook.Views[0].RTL?"1":"0"),writextag("sheetViews",writextag("sheetView",null,a),{})}function write_ws_xml_cell(t,r,e,s){if(t.c&&e["!comments"].push([r,t.c]),t.v===void 0&&typeof t.f!="string"||t.t==="z"&&!t.f)return"";var a="",i=t.t,o=t.v;if(t.t!=="z")switch(t.t){case"b":a=t.v?"1":"0";break;case"n":a=""+t.v;break;case"e":a=BErr[t.v];break;case"d":s&&s.cellDates?a=parseDate(t.v,-1).toISOString():(t=dup(t),t.t="n",a=""+(t.v=datenum(parseDate(t.v)))),typeof t.z>"u"&&(t.z=table_fmt[14]);break;default:a=t.v;break}var c=writetag("v",escapexml(a)),h={r},u=get_cell_style(s.cellXfs,t,s);switch(u!==0&&(h.s=u),t.t){case"n":break;case"d":h.t="d";break;case"b":h.t="b";break;case"e":h.t="e";break;case"z":break;default:if(t.v==null){delete t.t;break}if(t.v.length>32767)throw new Error("Text length must not exceed 32767 characters");if(s&&s.bookSST){c=writetag("v",""+get_sst_id(s.Strings,t.v,s.revStrings)),h.t="s";break}h.t="str";break}if(t.t!=i&&(t.t=i,t.v=o),typeof t.f=="string"&&t.f){var d=t.F&&t.F.slice(0,r.length)==r?{t:"array",ref:t.F}:null;c=writextag("f",escapexml(t.f),d)+(t.v!=null?c:"")}return t.l&&e["!links"].push([r,t.l]),t.D&&(h.cm=1),writextag("c",c,h)}function write_ws_xml_data(t,r,e,s){var a=[],i=[],o=safe_decode_range(t["!ref"]),c="",h,u="",d=[],_=0,b=0,v=t["!rows"],E=Array.isArray(t),x={r:u},g,w=-1;for(b=o.s.c;b<=o.e.c;++b)d[b]=encode_col(b);for(_=o.s.r;_<=o.e.r;++_){for(i=[],u=encode_row(_),b=o.s.c;b<=o.e.c;++b){h=d[b]+u;var R=E?(t[_]||[])[b]:t[h];R!==void 0&&(c=write_ws_xml_cell(R,h,t,r))!=null&&i.push(c)}(i.length>0||v&&v[_])&&(x={r:u},v&&v[_]&&(g=v[_],g.hidden&&(x.hidden=1),w=-1,g.hpx?w=px2pt(g.hpx):g.hpt&&(w=g.hpt),w>-1&&(x.ht=w,x.customHeight=1),g.level&&(x.outlineLevel=g.level)),a[a.length]=writextag("row",i.join(""),x))}if(v)for(;_<v.length;++_)v&&v[_]&&(x={r:_+1},g=v[_],g.hidden&&(x.hidden=1),w=-1,g.hpx?w=px2pt(g.hpx):g.hpt&&(w=g.hpt),w>-1&&(x.ht=w,x.customHeight=1),g.level&&(x.outlineLevel=g.level),a[a.length]=writextag("row","",x));return a.join("")}function write_ws_xml(t,r,e,s){var a=[XML_HEADER,writextag("worksheet",null,{xmlns:XMLNS_main[0],"xmlns:r":XMLNS.r})],i=e.SheetNames[t],o=0,c="",h=e.Sheets[i];h==null&&(h={});var u=h["!ref"]||"A1",d=safe_decode_range(u);if(d.e.c>16383||d.e.r>1048575){if(r.WTF)throw new Error("Range "+u+" exceeds format limit A1:XFD1048576");d.e.c=Math.min(d.e.c,16383),d.e.r=Math.min(d.e.c,1048575),u=encode_range(d)}s||(s={}),h["!comments"]=[];var _=[];write_ws_xml_sheetpr(h,e,t,r,a),a[a.length]=writextag("dimension",null,{ref:u}),a[a.length]=write_ws_xml_sheetviews(h,r,t,e),r.sheetFormat&&(a[a.length]=writextag("sheetFormatPr",null,{defaultRowHeight:r.sheetFormat.defaultRowHeight||"16",baseColWidth:r.sheetFormat.baseColWidth||"10",outlineLevelRow:r.sheetFormat.outlineLevelRow||"7"})),h["!cols"]!=null&&h["!cols"].length>0&&(a[a.length]=write_ws_xml_cols(h,h["!cols"])),a[o=a.length]="<sheetData/>",h["!links"]=[],h["!ref"]!=null&&(c=write_ws_xml_data(h,r),c.length>0&&(a[a.length]=c)),a.length>o+1&&(a[a.length]="</sheetData>",a[o]=a[o].replace("/>",">")),h["!protect"]&&(a[a.length]=write_ws_xml_protection(h["!protect"])),h["!autofilter"]!=null&&(a[a.length]=write_ws_xml_autofilter(h["!autofilter"],h,e,t)),h["!merges"]!=null&&h["!merges"].length>0&&(a[a.length]=write_ws_xml_merges(h["!merges"]));var b=-1,v,E=-1;return h["!links"].length>0&&(a[a.length]="<hyperlinks>",h["!links"].forEach(function(x){x[1].Target&&(v={ref:x[0]},x[1].Target.charAt(0)!="#"&&(E=add_rels(s,-1,escapexml(x[1].Target).replace(/#.*$/,""),RELS.HLINK),v["r:id"]="rId"+E),(b=x[1].Target.indexOf("#"))>-1&&(v.location=escapexml(x[1].Target.slice(b+1))),x[1].Tooltip&&(v.tooltip=escapexml(x[1].Tooltip)),a[a.length]=writextag("hyperlink",null,v))}),a[a.length]="</hyperlinks>"),delete h["!links"],h["!margins"]!=null&&(a[a.length]=write_ws_xml_margins(h["!margins"])),(!r||r.ignoreEC||r.ignoreEC==null)&&(a[a.length]=writetag("ignoredErrors",writextag("ignoredError",null,{numberStoredAsText:1,sqref:u}))),_.length>0&&(E=add_rels(s,-1,"../drawings/drawing"+(t+1)+".xml",RELS.DRAW),a[a.length]=writextag("drawing",null,{"r:id":"rId"+E}),h["!drawing"]=_),h["!comments"].length>0&&(E=add_rels(s,-1,"../drawings/vmlDrawing"+(t+1)+".vml",RELS.VML),a[a.length]=writextag("legacyDrawing",null,{"r:id":"rId"+E}),h["!legacy"]=E),a.length>1&&(a[a.length]="</worksheet>",a[1]=a[1].replace("/>",">")),a.join("")}function parse_BrtRowHdr(t,r){var e={},s=t.l+r;e.r=t.read_shift(4),t.l+=4;var a=t.read_shift(2);t.l+=1;var i=t.read_shift(1);return t.l=s,i&7&&(e.level=i&7),i&16&&(e.hidden=!0),i&32&&(e.hpt=a/20),e}function write_BrtRowHdr(t,r,e){var s=new_buf(145),a=(e["!rows"]||[])[t]||{};s.write_shift(4,t),s.write_shift(4,0);var i=320;a.hpx?i=px2pt(a.hpx)*20:a.hpt&&(i=a.hpt*20),s.write_shift(2,i),s.write_shift(1,0);var o=0;a.level&&(o|=a.level),a.hidden&&(o|=16),(a.hpx||a.hpt)&&(o|=32),s.write_shift(1,o),s.write_shift(1,0);var c=0,h=s.l;s.l+=4;for(var u={r:t,c:0},d=0;d<16;++d)if(!(r.s.c>d+1<<10||r.e.c<d<<10)){for(var _=-1,b=-1,v=d<<10;v<d+1<<10;++v){u.c=v;var E=Array.isArray(e)?(e[u.r]||[])[u.c]:e[encode_cell(u)];E&&(_<0&&(_=v),b=v)}_<0||(++c,s.write_shift(4,_),s.write_shift(4,b))}var x=s.l;return s.l=h,s.write_shift(4,c),s.l=x,s.length>s.l?s.slice(0,s.l):s}function write_row_header(t,r,e,s){var a=write_BrtRowHdr(s,e,r);(a.length>17||(r["!rows"]||[])[s])&&write_record(t,0,a)}var parse_BrtWsDim=parse_UncheckedRfX,write_BrtWsDim=write_UncheckedRfX;function parse_BrtWsFmtInfo(){}function parse_BrtWsProp(t,r){var e={},s=t[t.l];return++t.l,e.above=!(s&64),e.left=!(s&128),t.l+=18,e.name=parse_XLSBCodeName(t),e}function write_BrtWsProp(t,r,e){e==null&&(e=new_buf(84+4*t.length));var s=192;r&&(r.above&&(s&=-65),r.left&&(s&=-129)),e.write_shift(1,s);for(var a=1;a<3;++a)e.write_shift(1,0);return write_BrtColor({auto:1},e),e.write_shift(-4,-1),e.write_shift(-4,-1),write_XLSBCodeName(t,e),e.slice(0,e.l)}function parse_BrtCellBlank(t){var r=parse_XLSBCell(t);return[r]}function write_BrtCellBlank(t,r,e){return e==null&&(e=new_buf(8)),write_XLSBCell(r,e)}function parse_BrtShortBlank(t){var r=parse_XLSBShortCell(t);return[r]}function write_BrtShortBlank(t,r,e){return e==null&&(e=new_buf(4)),write_XLSBShortCell(r,e)}function parse_BrtCellBool(t){var r=parse_XLSBCell(t),e=t.read_shift(1);return[r,e,"b"]}function write_BrtCellBool(t,r,e){return e==null&&(e=new_buf(9)),write_XLSBCell(r,e),e.write_shift(1,t.v?1:0),e}function parse_BrtShortBool(t){var r=parse_XLSBShortCell(t),e=t.read_shift(1);return[r,e,"b"]}function write_BrtShortBool(t,r,e){return e==null&&(e=new_buf(5)),write_XLSBShortCell(r,e),e.write_shift(1,t.v?1:0),e}function parse_BrtCellError(t){var r=parse_XLSBCell(t),e=t.read_shift(1);return[r,e,"e"]}function write_BrtCellError(t,r,e){return e==null&&(e=new_buf(9)),write_XLSBCell(r,e),e.write_shift(1,t.v),e}function parse_BrtShortError(t){var r=parse_XLSBShortCell(t),e=t.read_shift(1);return[r,e,"e"]}function write_BrtShortError(t,r,e){return e==null&&(e=new_buf(8)),write_XLSBShortCell(r,e),e.write_shift(1,t.v),e.write_shift(2,0),e.write_shift(1,0),e}function parse_BrtCellIsst(t){var r=parse_XLSBCell(t),e=t.read_shift(4);return[r,e,"s"]}function write_BrtCellIsst(t,r,e){return e==null&&(e=new_buf(12)),write_XLSBCell(r,e),e.write_shift(4,r.v),e}function parse_BrtShortIsst(t){var r=parse_XLSBShortCell(t),e=t.read_shift(4);return[r,e,"s"]}function write_BrtShortIsst(t,r,e){return e==null&&(e=new_buf(8)),write_XLSBShortCell(r,e),e.write_shift(4,r.v),e}function parse_BrtCellReal(t){var r=parse_XLSBCell(t),e=parse_Xnum(t);return[r,e,"n"]}function write_BrtCellReal(t,r,e){return e==null&&(e=new_buf(16)),write_XLSBCell(r,e),write_Xnum(t.v,e),e}function parse_BrtShortReal(t){var r=parse_XLSBShortCell(t),e=parse_Xnum(t);return[r,e,"n"]}function write_BrtShortReal(t,r,e){return e==null&&(e=new_buf(12)),write_XLSBShortCell(r,e),write_Xnum(t.v,e),e}function parse_BrtCellRk(t){var r=parse_XLSBCell(t),e=parse_RkNumber(t);return[r,e,"n"]}function write_BrtCellRk(t,r,e){return e==null&&(e=new_buf(12)),write_XLSBCell(r,e),write_RkNumber(t.v,e),e}function parse_BrtShortRk(t){var r=parse_XLSBShortCell(t),e=parse_RkNumber(t);return[r,e,"n"]}function write_BrtShortRk(t,r,e){return e==null&&(e=new_buf(8)),write_XLSBShortCell(r,e),write_RkNumber(t.v,e),e}function parse_BrtCellRString(t){var r=parse_XLSBCell(t),e=parse_RichStr(t);return[r,e,"is"]}function parse_BrtCellSt(t){var r=parse_XLSBCell(t),e=parse_XLWideString(t);return[r,e,"str"]}function write_BrtCellSt(t,r,e){return e==null&&(e=new_buf(12+4*t.v.length)),write_XLSBCell(r,e),write_XLWideString(t.v,e),e.length>e.l?e.slice(0,e.l):e}function parse_BrtShortSt(t){var r=parse_XLSBShortCell(t),e=parse_XLWideString(t);return[r,e,"str"]}function write_BrtShortSt(t,r,e){return e==null&&(e=new_buf(8+4*t.v.length)),write_XLSBShortCell(r,e),write_XLWideString(t.v,e),e.length>e.l?e.slice(0,e.l):e}function parse_BrtFmlaBool(t,r,e){var s=t.l+r,a=parse_XLSBCell(t);a.r=e["!row"];var i=t.read_shift(1),o=[a,i,"b"];if(e.cellFormula){t.l+=2;var c=parse_XLSBCellParsedFormula(t,s-t.l,e);o[3]=stringify_formula(c,null,a,e.supbooks,e)}else t.l=s;return o}function parse_BrtFmlaError(t,r,e){var s=t.l+r,a=parse_XLSBCell(t);a.r=e["!row"];var i=t.read_shift(1),o=[a,i,"e"];if(e.cellFormula){t.l+=2;var c=parse_XLSBCellParsedFormula(t,s-t.l,e);o[3]=stringify_formula(c,null,a,e.supbooks,e)}else t.l=s;return o}function parse_BrtFmlaNum(t,r,e){var s=t.l+r,a=parse_XLSBCell(t);a.r=e["!row"];var i=parse_Xnum(t),o=[a,i,"n"];if(e.cellFormula){t.l+=2;var c=parse_XLSBCellParsedFormula(t,s-t.l,e);o[3]=stringify_formula(c,null,a,e.supbooks,e)}else t.l=s;return o}function parse_BrtFmlaString(t,r,e){var s=t.l+r,a=parse_XLSBCell(t);a.r=e["!row"];var i=parse_XLWideString(t),o=[a,i,"str"];if(e.cellFormula){t.l+=2;var c=parse_XLSBCellParsedFormula(t,s-t.l,e);o[3]=stringify_formula(c,null,a,e.supbooks,e)}else t.l=s;return o}var parse_BrtMergeCell=parse_UncheckedRfX,write_BrtMergeCell=write_UncheckedRfX;function write_BrtBeginMergeCells(t,r){return r==null&&(r=new_buf(4)),r.write_shift(4,t),r}function parse_BrtHLink(t,r){var e=t.l+r,s=parse_UncheckedRfX(t),a=parse_XLNullableWideString(t),i=parse_XLWideString(t),o=parse_XLWideString(t),c=parse_XLWideString(t);t.l=e;var h={rfx:s,relId:a,loc:i,display:c};return o&&(h.Tooltip=o),h}function write_BrtHLink(t,r){var e=new_buf(50+4*(t[1].Target.length+(t[1].Tooltip||"").length));write_UncheckedRfX({s:decode_cell(t[0]),e:decode_cell(t[0])},e),write_RelID("rId"+r,e);var s=t[1].Target.indexOf("#"),a=s==-1?"":t[1].Target.slice(s+1);return write_XLWideString(a||"",e),write_XLWideString(t[1].Tooltip||"",e),write_XLWideString("",e),e.slice(0,e.l)}function parse_BrtPane(){}function parse_BrtArrFmla(t,r,e){var s=t.l+r,a=parse_RfX(t),i=t.read_shift(1),o=[a];if(o[2]=i,e.cellFormula){var c=parse_XLSBArrayParsedFormula(t,s-t.l,e);o[1]=c}else t.l=s;return o}function parse_BrtShrFmla(t,r,e){var s=t.l+r,a=parse_UncheckedRfX(t),i=[a];if(e.cellFormula){var o=parse_XLSBSharedParsedFormula(t,s-t.l,e);i[1]=o,t.l=s}else t.l=s;return i}function write_BrtColInfo(t,r,e){e==null&&(e=new_buf(18));var s=col_obj_w(t,r);e.write_shift(-4,t),e.write_shift(-4,t),e.write_shift(4,(s.width||10)*256),e.write_shift(4,0);var a=0;return r.hidden&&(a|=1),typeof s.width=="number"&&(a|=2),r.level&&(a|=r.level<<8),e.write_shift(2,a),e}var BrtMarginKeys=["left","right","top","bottom","header","footer"];function parse_BrtMargins(t){var r={};return BrtMarginKeys.forEach(function(e){r[e]=parse_Xnum(t)}),r}function write_BrtMargins(t,r){return r==null&&(r=new_buf(6*8)),default_margins(t),BrtMarginKeys.forEach(function(e){write_Xnum(t[e],r)}),r}function parse_BrtBeginWsView(t){var r=t.read_shift(2);return t.l+=28,{RTL:r&32}}function write_BrtBeginWsView(t,r,e){e==null&&(e=new_buf(30));var s=924;return(((r||{}).Views||[])[0]||{}).RTL&&(s|=32),e.write_shift(2,s),e.write_shift(4,0),e.write_shift(4,0),e.write_shift(4,0),e.write_shift(1,0),e.write_shift(1,0),e.write_shift(2,0),e.write_shift(2,100),e.write_shift(2,0),e.write_shift(2,0),e.write_shift(2,0),e.write_shift(4,0),e}function write_BrtCellIgnoreEC(t){var r=new_buf(24);return r.write_shift(4,4),r.write_shift(4,1),write_UncheckedRfX(t,r),r}function write_BrtSheetProtection(t,r){return r==null&&(r=new_buf(16*4+2)),r.write_shift(2,t.password?crypto_CreatePasswordVerifier_Method1(t.password):0),r.write_shift(4,1),[["objects",!1],["scenarios",!1],["formatCells",!0],["formatColumns",!0],["formatRows",!0],["insertColumns",!0],["insertRows",!0],["insertHyperlinks",!0],["deleteColumns",!0],["deleteRows",!0],["selectLockedCells",!1],["sort",!0],["autoFilter",!0],["pivotTables",!0],["selectUnlockedCells",!1]].forEach(function(e){e[1]?r.write_shift(4,t[e[0]]!=null&&!t[e[0]]?1:0):r.write_shift(4,t[e[0]]!=null&&t[e[0]]?0:1)}),r}function parse_BrtDVal(){}function parse_BrtDVal14(){}function write_ws_bin_cell(t,r,e,s,a,i,o){if(r.v===void 0)return!1;var c="";switch(r.t){case"b":c=r.v?"1":"0";break;case"d":r=dup(r),r.z=r.z||table_fmt[14],r.v=datenum(parseDate(r.v)),r.t="n";break;case"n":case"e":c=""+r.v;break;default:c=r.v;break}var h={r:e,c:s};switch(h.s=get_cell_style(a.cellXfs,r,a),r.l&&i["!links"].push([encode_cell(h),r.l]),r.c&&i["!comments"].push([encode_cell(h),r.c]),r.t){case"s":case"str":return a.bookSST?(c=get_sst_id(a.Strings,r.v,a.revStrings),h.t="s",h.v=c,o?write_record(t,18,write_BrtShortIsst(r,h)):write_record(t,7,write_BrtCellIsst(r,h))):(h.t="str",o?write_record(t,17,write_BrtShortSt(r,h)):write_record(t,6,write_BrtCellSt(r,h))),!0;case"n":return r.v==(r.v|0)&&r.v>-1e3&&r.v<1e3?o?write_record(t,13,write_BrtShortRk(r,h)):write_record(t,2,write_BrtCellRk(r,h)):o?write_record(t,16,write_BrtShortReal(r,h)):write_record(t,5,write_BrtCellReal(r,h)),!0;case"b":return h.t="b",o?write_record(t,15,write_BrtShortBool(r,h)):write_record(t,4,write_BrtCellBool(r,h)),!0;case"e":return h.t="e",o?write_record(t,14,write_BrtShortError(r,h)):write_record(t,3,write_BrtCellError(r,h)),!0}return o?write_record(t,12,write_BrtShortBlank(r,h)):write_record(t,1,write_BrtCellBlank(r,h)),!0}function write_CELLTABLE(t,r,e,s){var a=safe_decode_range(r["!ref"]||"A1"),i,o="",c=[];write_record(t,145);var h=Array.isArray(r),u=a.e.r;r["!rows"]&&(u=Math.max(a.e.r,r["!rows"].length-1));for(var d=a.s.r;d<=u;++d){o=encode_row(d),write_row_header(t,r,a,d);var _=!1;if(d<=a.e.r)for(var b=a.s.c;b<=a.e.c;++b){d===a.s.r&&(c[b]=encode_col(b)),i=c[b]+o;var v=h?(r[d]||[])[b]:r[i];if(!v){_=!1;continue}_=write_ws_bin_cell(t,v,d,b,s,r,_)}}write_record(t,146)}function write_MERGECELLS(t,r){!r||!r["!merges"]||(write_record(t,177,write_BrtBeginMergeCells(r["!merges"].length)),r["!merges"].forEach(function(e){write_record(t,176,write_BrtMergeCell(e))}),write_record(t,178))}function write_COLINFOS(t,r){!r||!r["!cols"]||(write_record(t,390),r["!cols"].forEach(function(e,s){e&&write_record(t,60,write_BrtColInfo(s,e))}),write_record(t,391))}function write_IGNOREECS(t,r){!r||!r["!ref"]||(write_record(t,648),write_record(t,649,write_BrtCellIgnoreEC(safe_decode_range(r["!ref"]))),write_record(t,650))}function write_HLINKS(t,r,e){r["!links"].forEach(function(s){if(s[1].Target){var a=add_rels(e,-1,s[1].Target.replace(/#.*$/,""),RELS.HLINK);write_record(t,494,write_BrtHLink(s,a))}}),delete r["!links"]}function write_LEGACYDRAWING(t,r,e,s){if(r["!comments"].length>0){var a=add_rels(s,-1,"../drawings/vmlDrawing"+(e+1)+".vml",RELS.VML);write_record(t,551,write_RelID("rId"+a)),r["!legacy"]=a}}function write_AUTOFILTER(t,r,e,s){if(r["!autofilter"]){var a=r["!autofilter"],i=typeof a.ref=="string"?a.ref:encode_range(a.ref);e.Workbook||(e.Workbook={Sheets:[]}),e.Workbook.Names||(e.Workbook.Names=[]);var o=e.Workbook.Names,c=decode_range(i);c.s.r==c.e.r&&(c.e.r=decode_range(r["!ref"]).e.r,i=encode_range(c));for(var h=0;h<o.length;++h){var u=o[h];if(u.Name=="_xlnm._FilterDatabase"&&u.Sheet==s){u.Ref="'"+e.SheetNames[s]+"'!"+i;break}}h==o.length&&o.push({Name:"_xlnm._FilterDatabase",Sheet:s,Ref:"'"+e.SheetNames[s]+"'!"+i}),write_record(t,161,write_UncheckedRfX(safe_decode_range(i))),write_record(t,162)}}function write_WSVIEWS2(t,r,e){write_record(t,133),write_record(t,137,write_BrtBeginWsView(r,e)),write_record(t,138),write_record(t,134)}function write_SHEETPROTECT(t,r){r["!protect"]&&write_record(t,535,write_BrtSheetProtection(r["!protect"]))}function write_ws_bin(t,r,e,s){var a=buf_array(),i=e.SheetNames[t],o=e.Sheets[i]||{},c=i;try{e&&e.Workbook&&(c=e.Workbook.Sheets[t].CodeName||c)}catch{}var h=safe_decode_range(o["!ref"]||"A1");if(h.e.c>16383||h.e.r>1048575){if(r.WTF)throw new Error("Range "+(o["!ref"]||"A1")+" exceeds format limit A1:XFD1048576");h.e.c=Math.min(h.e.c,16383),h.e.r=Math.min(h.e.c,1048575)}return o["!links"]=[],o["!comments"]=[],write_record(a,129),(e.vbaraw||o["!outline"])&&write_record(a,147,write_BrtWsProp(c,o["!outline"])),write_record(a,148,write_BrtWsDim(h)),write_WSVIEWS2(a,o,e.Workbook),write_COLINFOS(a,o),write_CELLTABLE(a,o,t,r),write_SHEETPROTECT(a,o),write_AUTOFILTER(a,o,e,t),write_MERGECELLS(a,o),write_HLINKS(a,o,s),o["!margins"]&&write_record(a,476,write_BrtMargins(o["!margins"])),(!r||r.ignoreEC||r.ignoreEC==null)&&write_IGNOREECS(a,o),write_LEGACYDRAWING(a,o,t,s),write_record(a,130),a.end()}function parse_BrtCsProp(t,r){t.l+=10;var e=parse_XLWideString(t);return{name:e}}var WBPropsDef=[["allowRefreshQuery",!1,"bool"],["autoCompressPictures",!0,"bool"],["backupFile",!1,"bool"],["checkCompatibility",!1,"bool"],["CodeName",""],["date1904",!1,"bool"],["defaultThemeVersion",0,"int"],["filterPrivacy",!1,"bool"],["hidePivotFieldList",!1,"bool"],["promptedSolutions",!1,"bool"],["publishItems",!1,"bool"],["refreshAllConnections",!1,"bool"],["saveExternalLinkValues",!0,"bool"],["showBorderUnselectedTables",!0,"bool"],["showInkAnnotation",!0,"bool"],["showObjects","all"],["showPivotChartFilter",!1,"bool"],["updateLinks","userSet"]];function safe1904(t){return!t.Workbook||!t.Workbook.WBProps?"false":parsexmlbool(t.Workbook.WBProps.date1904)?"true":"false"}var badchars="][*?/\\".split("");function check_ws_name(t,r){if(t.length>31)throw new Error("Sheet names cannot exceed 31 chars");var e=!0;return badchars.forEach(function(s){if(t.indexOf(s)!=-1)throw new Error("Sheet name cannot contain : \\ / ? * [ ]")}),e}function check_wb_names(t,r,e){t.forEach(function(s,a){check_ws_name(s);for(var i=0;i<a;++i)if(s==t[i])throw new Error("Duplicate Sheet Name: "+s);if(e){var o=r&&r[a]&&r[a].CodeName||s;if(o.charCodeAt(0)==95&&o.length>22)throw new Error("Bad Code Name: Worksheet"+o)}})}function check_wb(t){if(!t||!t.SheetNames||!t.Sheets)throw new Error("Invalid Workbook");if(!t.SheetNames.length)throw new Error("Workbook is empty");var r=t.Workbook&&t.Workbook.Sheets||[];check_wb_names(t.SheetNames,r,!!t.vbaraw);for(var e=0;e<t.SheetNames.length;++e)check_ws(t.Sheets[t.SheetNames[e]],t.SheetNames[e],e)}function write_wb_xml(t){var r=[XML_HEADER];r[r.length]=writextag("workbook",null,{xmlns:XMLNS_main[0],"xmlns:r":XMLNS.r});var e=t.Workbook&&(t.Workbook.Names||[]).length>0,s={codeName:"ThisWorkbook"};t.Workbook&&t.Workbook.WBProps&&(WBPropsDef.forEach(function(c){t.Workbook.WBProps[c[0]]!=null&&t.Workbook.WBProps[c[0]]!=c[1]&&(s[c[0]]=t.Workbook.WBProps[c[0]])}),t.Workbook.WBProps.CodeName&&(s.codeName=t.Workbook.WBProps.CodeName,delete s.CodeName)),r[r.length]=writextag("workbookPr",null,s);var a=t.Workbook&&t.Workbook.Sheets||[],i=0;if(a&&a[0]&&a[0].Hidden){for(r[r.length]="<bookViews>",i=0;i!=t.SheetNames.length&&!(!a[i]||!a[i].Hidden);++i);i==t.SheetNames.length&&(i=0),r[r.length]='<workbookView firstSheet="'+i+'" activeTab="'+i+'"/>',r[r.length]="</bookViews>"}for(r[r.length]="<sheets>",i=0;i!=t.SheetNames.length;++i){var o={name:escapexml(t.SheetNames[i].slice(0,31))};if(o.sheetId=""+(i+1),o["r:id"]="rId"+(i+1),a[i])switch(a[i].Hidden){case 1:o.state="hidden";break;case 2:o.state="veryHidden";break}r[r.length]=writextag("sheet",null,o)}return r[r.length]="</sheets>",e&&(r[r.length]="<definedNames>",t.Workbook&&t.Workbook.Names&&t.Workbook.Names.forEach(function(c){var h={name:c.Name};c.Comment&&(h.comment=c.Comment),c.Sheet!=null&&(h.localSheetId=""+c.Sheet),c.Hidden&&(h.hidden="1"),c.Ref&&(r[r.length]=writextag("definedName",escapexml(c.Ref),h))}),r[r.length]="</definedNames>"),r.length>2&&(r[r.length]="</workbook>",r[1]=r[1].replace("/>",">")),r.join("")}function parse_BrtBundleSh(t,r){var e={};return e.Hidden=t.read_shift(4),e.iTabID=t.read_shift(4),e.strRelID=parse_RelID(t),e.name=parse_XLWideString(t),e}function write_BrtBundleSh(t,r){return r||(r=new_buf(127)),r.write_shift(4,t.Hidden),r.write_shift(4,t.iTabID),write_RelID(t.strRelID,r),write_XLWideString(t.name.slice(0,31),r),r.length>r.l?r.slice(0,r.l):r}function parse_BrtWbProp(t,r){var e={},s=t.read_shift(4);e.defaultThemeVersion=t.read_shift(4);var a=r>8?parse_XLWideString(t):"";return a.length>0&&(e.CodeName=a),e.autoCompressPictures=!!(s&65536),e.backupFile=!!(s&64),e.checkCompatibility=!!(s&4096),e.date1904=!!(s&1),e.filterPrivacy=!!(s&8),e.hidePivotFieldList=!!(s&1024),e.promptedSolutions=!!(s&16),e.publishItems=!!(s&2048),e.refreshAllConnections=!!(s&262144),e.saveExternalLinkValues=!!(s&128),e.showBorderUnselectedTables=!!(s&4),e.showInkAnnotation=!!(s&32),e.showObjects=["all","placeholders","none"][s>>13&3],e.showPivotChartFilter=!!(s&32768),e.updateLinks=["userSet","never","always"][s>>8&3],e}function write_BrtWbProp(t,r){r||(r=new_buf(72));var e=0;return t&&t.filterPrivacy&&(e|=8),r.write_shift(4,e),r.write_shift(4,0),write_XLSBCodeName(t&&t.CodeName||"ThisWorkbook",r),r.slice(0,r.l)}function parse_BrtName(t,r,e){var s=t.l+r;t.l+=4,t.l+=1;var a=t.read_shift(4),i=parse_XLNameWideString(t),o=parse_XLSBNameParsedFormula(t,0,e),c=parse_XLNullableWideString(t);t.l=s;var h={Name:i,Ptg:o};return a<268435455&&(h.Sheet=a),c&&(h.Comment=c),h}function write_BUNDLESHS(t,r){write_record(t,143);for(var e=0;e!=r.SheetNames.length;++e){var s=r.Workbook&&r.Workbook.Sheets&&r.Workbook.Sheets[e]&&r.Workbook.Sheets[e].Hidden||0,a={Hidden:s,iTabID:e+1,strRelID:"rId"+(e+1),name:r.SheetNames[e]};write_record(t,156,write_BrtBundleSh(a))}write_record(t,144)}function write_BrtFileVersion(t,r){r||(r=new_buf(127));for(var e=0;e!=4;++e)r.write_shift(4,0);return write_XLWideString("SheetJS",r),write_XLWideString(XLSX.version,r),write_XLWideString(XLSX.version,r),write_XLWideString("7262",r),r.length>r.l?r.slice(0,r.l):r}function write_BrtBookView(t,r){r||(r=new_buf(29)),r.write_shift(-4,0),r.write_shift(-4,460),r.write_shift(4,28800),r.write_shift(4,17600),r.write_shift(4,500),r.write_shift(4,t),r.write_shift(4,t);var e=120;return r.write_shift(1,e),r.length>r.l?r.slice(0,r.l):r}function write_BOOKVIEWS(t,r){if(!(!r.Workbook||!r.Workbook.Sheets)){for(var e=r.Workbook.Sheets,s=0,a=-1,i=-1;s<e.length;++s)!e[s]||!e[s].Hidden&&a==-1?a=s:e[s].Hidden==1&&i==-1&&(i=s);i>a||(write_record(t,135),write_record(t,158,write_BrtBookView(a)),write_record(t,136))}}function write_wb_bin(t,r){var e=buf_array();return write_record(e,131),write_record(e,128,write_BrtFileVersion()),write_record(e,153,write_BrtWbProp(t.Workbook&&t.Workbook.WBProps||null)),write_BOOKVIEWS(e,t),write_BUNDLESHS(e,t),write_record(e,132),e.end()}function write_wb(t,r,e){return(r.slice(-4)===".bin"?write_wb_bin:write_wb_xml)(t)}function write_ws(t,r,e,s,a){return(r.slice(-4)===".bin"?write_ws_bin:write_ws_xml)(t,e,s,a)}function write_sty(t,r,e){return(r.slice(-4)===".bin"?write_sty_bin:write_sty_xml)(t,e)}function write_sst(t,r,e){return(r.slice(-4)===".bin"?write_sst_bin:write_sst_xml)(t,e)}function write_cmnt(t,r,e){return(r.slice(-4)===".bin"?write_comments_bin:write_comments_xml)(t)}function write_xlmeta(t){return(t.slice(-4)===".bin"?write_xlmeta_bin:write_xlmeta_xml)()}function write_props_xlml(t,r){var e=[];return t.Props&&e.push(xlml_write_docprops(t.Props,r)),t.Custprops&&e.push(xlml_write_custprops(t.Props,t.Custprops)),e.join("")}function write_wb_xlml(){return""}function write_sty_xlml(t,r){var e=['<Style ss:ID="Default" ss:Name="Normal"><NumberFormat/></Style>'];return r.cellXfs.forEach(function(s,a){var i=[];i.push(writextag("NumberFormat",null,{"ss:Format":escapexml(table_fmt[s.numFmtId])}));var o={"ss:ID":"s"+(21+a)};e.push(writextag("Style",i.join(""),o))}),writextag("Styles",e.join(""))}function write_name_xlml(t){return writextag("NamedRange",null,{"ss:Name":t.Name,"ss:RefersTo":"="+a1_to_rc(t.Ref,{r:0,c:0})})}function write_names_xlml(t){if(!((t||{}).Workbook||{}).Names)return"";for(var r=t.Workbook.Names,e=[],s=0;s<r.length;++s){var a=r[s];a.Sheet==null&&(a.Name.match(/^_xlfn\./)||e.push(write_name_xlml(a)))}return writextag("Names",e.join(""))}function write_ws_xlml_names(t,r,e,s){if(!t||!((s||{}).Workbook||{}).Names)return"";for(var a=s.Workbook.Names,i=[],o=0;o<a.length;++o){var c=a[o];c.Sheet==e&&(c.Name.match(/^_xlfn\./)||i.push(write_name_xlml(c)))}return i.join("")}function write_ws_xlml_wsopts(t,r,e,s){if(!t)return"";var a=[];if(t["!margins"]&&(a.push("<PageSetup>"),t["!margins"].header&&a.push(writextag("Header",null,{"x:Margin":t["!margins"].header})),t["!margins"].footer&&a.push(writextag("Footer",null,{"x:Margin":t["!margins"].footer})),a.push(writextag("PageMargins",null,{"x:Bottom":t["!margins"].bottom||"0.75","x:Left":t["!margins"].left||"0.7","x:Right":t["!margins"].right||"0.7","x:Top":t["!margins"].top||"0.75"})),a.push("</PageSetup>")),s&&s.Workbook&&s.Workbook.Sheets&&s.Workbook.Sheets[e])if(s.Workbook.Sheets[e].Hidden)a.push(writextag("Visible",s.Workbook.Sheets[e].Hidden==1?"SheetHidden":"SheetVeryHidden",{}));else{for(var i=0;i<e&&!(s.Workbook.Sheets[i]&&!s.Workbook.Sheets[i].Hidden);++i);i==e&&a.push("<Selected/>")}return((((s||{}).Workbook||{}).Views||[])[0]||{}).RTL&&a.push("<DisplayRightToLeft/>"),t["!protect"]&&(a.push(writetag("ProtectContents","True")),t["!protect"].objects&&a.push(writetag("ProtectObjects","True")),t["!protect"].scenarios&&a.push(writetag("ProtectScenarios","True")),t["!protect"].selectLockedCells!=null&&!t["!protect"].selectLockedCells?a.push(writetag("EnableSelection","NoSelection")):t["!protect"].selectUnlockedCells!=null&&!t["!protect"].selectUnlockedCells&&a.push(writetag("EnableSelection","UnlockedCells")),[["formatCells","AllowFormatCells"],["formatColumns","AllowSizeCols"],["formatRows","AllowSizeRows"],["insertColumns","AllowInsertCols"],["insertRows","AllowInsertRows"],["insertHyperlinks","AllowInsertHyperlinks"],["deleteColumns","AllowDeleteCols"],["deleteRows","AllowDeleteRows"],["sort","AllowSort"],["autoFilter","AllowFilter"],["pivotTables","AllowUsePivotTables"]].forEach(function(o){t["!protect"][o[0]]&&a.push("<"+o[1]+"/>")})),a.length==0?"":writextag("WorksheetOptions",a.join(""),{xmlns:XLMLNS.x})}function write_ws_xlml_comment(t){return t.map(function(r){var e=xlml_unfixstr(r.t||""),s=writextag("ss:Data",e,{xmlns:"http://www.w3.org/TR/REC-html40"});return writextag("Comment",s,{"ss:Author":r.a})}).join("")}function write_ws_xlml_cell(t,r,e,s,a,i,o){if(!t||t.v==null&&t.f==null)return"";var c={};if(t.f&&(c["ss:Formula"]="="+escapexml(a1_to_rc(t.f,o))),t.F&&t.F.slice(0,r.length)==r){var h=decode_cell(t.F.slice(r.length+1));c["ss:ArrayRange"]="RC:R"+(h.r==o.r?"":"["+(h.r-o.r)+"]")+"C"+(h.c==o.c?"":"["+(h.c-o.c)+"]")}if(t.l&&t.l.Target&&(c["ss:HRef"]=escapexml(t.l.Target),t.l.Tooltip&&(c["x:HRefScreenTip"]=escapexml(t.l.Tooltip))),e["!merges"])for(var u=e["!merges"],d=0;d!=u.length;++d)u[d].s.c!=o.c||u[d].s.r!=o.r||(u[d].e.c>u[d].s.c&&(c["ss:MergeAcross"]=u[d].e.c-u[d].s.c),u[d].e.r>u[d].s.r&&(c["ss:MergeDown"]=u[d].e.r-u[d].s.r));var _="",b="";switch(t.t){case"z":if(!s.sheetStubs)return"";break;case"n":_="Number",b=String(t.v);break;case"b":_="Boolean",b=t.v?"1":"0";break;case"e":_="Error",b=BErr[t.v];break;case"d":_="DateTime",b=new Date(t.v).toISOString(),t.z==null&&(t.z=t.z||table_fmt[14]);break;case"s":_="String",b=escapexlml(t.v||"");break}var v=get_cell_style(s.cellXfs,t,s);c["ss:StyleID"]="s"+(21+v),c["ss:Index"]=o.c+1;var E=t.v!=null?b:"",x=t.t=="z"?"":'<Data ss:Type="'+_+'">'+E+"</Data>";return(t.c||[]).length>0&&(x+=write_ws_xlml_comment(t.c)),writextag("Cell",x,c)}function write_ws_xlml_row(t,r){var e='<Row ss:Index="'+(t+1)+'"';return r&&(r.hpt&&!r.hpx&&(r.hpx=pt2px(r.hpt)),r.hpx&&(e+=' ss:AutoFitHeight="0" ss:Height="'+r.hpx+'"'),r.hidden&&(e+=' ss:Hidden="1"')),e+">"}function write_ws_xlml_table(t,r,e,s){if(!t["!ref"])return"";var a=safe_decode_range(t["!ref"]),i=t["!merges"]||[],o=0,c=[];t["!cols"]&&t["!cols"].forEach(function(g,w){process_col(g);var R=!!g.width,N=col_obj_w(w,g),M={"ss:Index":w+1};R&&(M["ss:Width"]=width2px(N.width)),g.hidden&&(M["ss:Hidden"]="1"),c.push(writextag("Column",null,M))});for(var h=Array.isArray(t),u=a.s.r;u<=a.e.r;++u){for(var d=[write_ws_xlml_row(u,(t["!rows"]||[])[u])],_=a.s.c;_<=a.e.c;++_){var b=!1;for(o=0;o!=i.length;++o)if(!(i[o].s.c>_)&&!(i[o].s.r>u)&&!(i[o].e.c<_)&&!(i[o].e.r<u)){(i[o].s.c!=_||i[o].s.r!=u)&&(b=!0);break}if(!b){var v={r:u,c:_},E=encode_cell(v),x=h?(t[u]||[])[_]:t[E];d.push(write_ws_xlml_cell(x,E,t,r,e,s,v))}}d.push("</Row>"),d.length>2&&c.push(d.join(""))}return c.join("")}function write_ws_xlml(t,r,e){var s=[],a=e.SheetNames[t],i=e.Sheets[a],o=i?write_ws_xlml_names(i,r,t,e):"";return o.length>0&&s.push("<Names>"+o+"</Names>"),o=i?write_ws_xlml_table(i,r,t,e):"",o.length>0&&s.push("<Table>"+o+"</Table>"),s.push(write_ws_xlml_wsopts(i,r,t,e)),s.join("")}function write_xlml(t,r){r||(r={}),t.SSF||(t.SSF=dup(table_fmt)),t.SSF&&(make_ssf(),SSF_load_table(t.SSF),r.revssf=evert_num(t.SSF),r.revssf[t.SSF[65535]]=0,r.ssf=t.SSF,r.cellXfs=[],get_cell_style(r.cellXfs,{},{revssf:{General:0}}));var e=[];e.push(write_props_xlml(t,r)),e.push(write_wb_xlml()),e.push(""),e.push("");for(var s=0;s<t.SheetNames.length;++s)e.push(writextag("Worksheet",write_ws_xlml(s,r,t),{"ss:Name":escapexml(t.SheetNames[s])}));return e[2]=write_sty_xlml(t,r),e[3]=write_names_xlml(t),XML_HEADER+writextag("Workbook",e.join(""),{xmlns:XLMLNS.ss,"xmlns:o":XLMLNS.o,"xmlns:x":XLMLNS.x,"xmlns:ss":XLMLNS.ss,"xmlns:dt":XLMLNS.dt,"xmlns:html":XLMLNS.html})}var PSCLSID={SI:"e0859ff2f94f6810ab9108002b27b3d9",DSI:"02d5cdd59c2e1b10939708002b2cf9ae",UDI:"05d5cdd59c2e1b10939708002b2cf9ae"};function write_xls_props(t,r){var e=[],s=[],a=[],i=0,o,c=evert_key(DocSummaryPIDDSI,"n"),h=evert_key(SummaryPIDSI,"n");if(t.Props)for(o=keys(t.Props),i=0;i<o.length;++i)(Object.prototype.hasOwnProperty.call(c,o[i])?e:Object.prototype.hasOwnProperty.call(h,o[i])?s:a).push([o[i],t.Props[o[i]]]);if(t.Custprops)for(o=keys(t.Custprops),i=0;i<o.length;++i)Object.prototype.hasOwnProperty.call(t.Props||{},o[i])||(Object.prototype.hasOwnProperty.call(c,o[i])?e:Object.prototype.hasOwnProperty.call(h,o[i])?s:a).push([o[i],t.Custprops[o[i]]]);var u=[];for(i=0;i<a.length;++i)XLSPSSkip.indexOf(a[i][0])>-1||PseudoPropsPairs.indexOf(a[i][0])>-1||a[i][1]!=null&&u.push(a[i]);s.length&&CFB.utils.cfb_add(r,"/SummaryInformation",write_PropertySetStream(s,PSCLSID.SI,h,SummaryPIDSI)),(e.length||u.length)&&CFB.utils.cfb_add(r,"/DocumentSummaryInformation",write_PropertySetStream(e,PSCLSID.DSI,c,DocSummaryPIDDSI,u.length?u:null,PSCLSID.UDI))}function write_xlscfb(t,r){var e=r||{},s=CFB.utils.cfb_new({root:"R"}),a="/Workbook";switch(e.bookType||"xls"){case"xls":e.bookType="biff8";case"xla":e.bookType||(e.bookType="xla");case"biff8":a="/Workbook",e.biff=8;break;case"biff5":a="/Book",e.biff=5;break;default:throw new Error("invalid type "+e.bookType+" for XLS CFB")}return CFB.utils.cfb_add(s,a,write_biff_buf(t,e)),e.biff==8&&(t.Props||t.Custprops)&&write_xls_props(t,s),e.biff==8&&t.vbaraw&&fill_vba_xls(s,CFB.read(t.vbaraw,{type:typeof t.vbaraw=="string"?"binary":"buffer"})),s}var XLSBRecordEnum={0:{f:parse_BrtRowHdr},1:{f:parse_BrtCellBlank},2:{f:parse_BrtCellRk},3:{f:parse_BrtCellError},4:{f:parse_BrtCellBool},5:{f:parse_BrtCellReal},6:{f:parse_BrtCellSt},7:{f:parse_BrtCellIsst},8:{f:parse_BrtFmlaString},9:{f:parse_BrtFmlaNum},10:{f:parse_BrtFmlaBool},11:{f:parse_BrtFmlaError},12:{f:parse_BrtShortBlank},13:{f:parse_BrtShortRk},14:{f:parse_BrtShortError},15:{f:parse_BrtShortBool},16:{f:parse_BrtShortReal},17:{f:parse_BrtShortSt},18:{f:parse_BrtShortIsst},19:{f:parse_RichStr},20:{},21:{},22:{},23:{},24:{},25:{},26:{},27:{},28:{},29:{},30:{},31:{},32:{},33:{},34:{},35:{T:1},36:{T:-1},37:{T:1},38:{T:-1},39:{f:parse_BrtName},40:{},42:{},43:{f:parse_BrtFont},44:{f:parse_BrtFmt},45:{f:parse_BrtFill},46:{f:parse_BrtBorder},47:{f:parse_BrtXF},48:{},49:{f:parse_Int32LE},50:{},51:{f:parse_BrtMdb},52:{T:1},53:{T:-1},54:{T:1},55:{T:-1},56:{T:1},57:{T:-1},58:{},59:{},60:{f:parse_ColInfo},62:{f:parse_BrtCellRString},63:{f:parse_BrtCalcChainItem$},64:{f:parse_BrtDVal},65:{},66:{},67:{},68:{},69:{},70:{},128:{},129:{T:1},130:{T:-1},131:{T:1,f:parsenoop,p:0},132:{T:-1},133:{T:1},134:{T:-1},135:{T:1},136:{T:-1},137:{T:1,f:parse_BrtBeginWsView},138:{T:-1},139:{T:1},140:{T:-1},141:{T:1},142:{T:-1},143:{T:1},144:{T:-1},145:{T:1},146:{T:-1},147:{f:parse_BrtWsProp},148:{f:parse_BrtWsDim,p:16},151:{f:parse_BrtPane},152:{},153:{f:parse_BrtWbProp},154:{},155:{},156:{f:parse_BrtBundleSh},157:{},158:{},159:{T:1,f:parse_BrtBeginSst},160:{T:-1},161:{T:1,f:parse_UncheckedRfX},162:{T:-1},163:{T:1},164:{T:-1},165:{T:1},166:{T:-1},167:{},168:{},169:{},170:{},171:{},172:{T:1},173:{T:-1},174:{},175:{},176:{f:parse_BrtMergeCell},177:{T:1},178:{T:-1},179:{T:1},180:{T:-1},181:{T:1},182:{T:-1},183:{T:1},184:{T:-1},185:{T:1},186:{T:-1},187:{T:1},188:{T:-1},189:{T:1},190:{T:-1},191:{T:1},192:{T:-1},193:{T:1},194:{T:-1},195:{T:1},196:{T:-1},197:{T:1},198:{T:-1},199:{T:1},200:{T:-1},201:{T:1},202:{T:-1},203:{T:1},204:{T:-1},205:{T:1},206:{T:-1},207:{T:1},208:{T:-1},209:{T:1},210:{T:-1},211:{T:1},212:{T:-1},213:{T:1},214:{T:-1},215:{T:1},216:{T:-1},217:{T:1},218:{T:-1},219:{T:1},220:{T:-1},221:{T:1},222:{T:-1},223:{T:1},224:{T:-1},225:{T:1},226:{T:-1},227:{T:1},228:{T:-1},229:{T:1},230:{T:-1},231:{T:1},232:{T:-1},233:{T:1},234:{T:-1},235:{T:1},236:{T:-1},237:{T:1},238:{T:-1},239:{T:1},240:{T:-1},241:{T:1},242:{T:-1},243:{T:1},244:{T:-1},245:{T:1},246:{T:-1},247:{T:1},248:{T:-1},249:{T:1},250:{T:-1},251:{T:1},252:{T:-1},253:{T:1},254:{T:-1},255:{T:1},256:{T:-1},257:{T:1},258:{T:-1},259:{T:1},260:{T:-1},261:{T:1},262:{T:-1},263:{T:1},264:{T:-1},265:{T:1},266:{T:-1},267:{T:1},268:{T:-1},269:{T:1},270:{T:-1},271:{T:1},272:{T:-1},273:{T:1},274:{T:-1},275:{T:1},276:{T:-1},277:{},278:{T:1},279:{T:-1},280:{T:1},281:{T:-1},282:{T:1},283:{T:1},284:{T:-1},285:{T:1},286:{T:-1},287:{T:1},288:{T:-1},289:{T:1},290:{T:-1},291:{T:1},292:{T:-1},293:{T:1},294:{T:-1},295:{T:1},296:{T:-1},297:{T:1},298:{T:-1},299:{T:1},300:{T:-1},301:{T:1},302:{T:-1},303:{T:1},304:{T:-1},305:{T:1},306:{T:-1},307:{T:1},308:{T:-1},309:{T:1},310:{T:-1},311:{T:1},312:{T:-1},313:{T:-1},314:{T:1},315:{T:-1},316:{T:1},317:{T:-1},318:{T:1},319:{T:-1},320:{T:1},321:{T:-1},322:{T:1},323:{T:-1},324:{T:1},325:{T:-1},326:{T:1},327:{T:-1},328:{T:1},329:{T:-1},330:{T:1},331:{T:-1},332:{T:1},333:{T:-1},334:{T:1},335:{f:parse_BrtMdtinfo},336:{T:-1},337:{f:parse_BrtBeginEsmdb,T:1},338:{T:-1},339:{T:1},340:{T:-1},341:{T:1},342:{T:-1},343:{T:1},344:{T:-1},345:{T:1},346:{T:-1},347:{T:1},348:{T:-1},349:{T:1},350:{T:-1},351:{},352:{},353:{T:1},354:{T:-1},355:{f:parse_RelID},357:{},358:{},359:{},360:{T:1},361:{},362:{f:parse_ExternSheet},363:{},364:{},366:{},367:{},368:{},369:{},370:{},371:{},372:{T:1},373:{T:-1},374:{T:1},375:{T:-1},376:{T:1},377:{T:-1},378:{T:1},379:{T:-1},380:{T:1},381:{T:-1},382:{T:1},383:{T:-1},384:{T:1},385:{T:-1},386:{T:1},387:{T:-1},388:{T:1},389:{T:-1},390:{T:1},391:{T:-1},392:{T:1},393:{T:-1},394:{T:1},395:{T:-1},396:{},397:{},398:{},399:{},400:{},401:{T:1},403:{},404:{},405:{},406:{},407:{},408:{},409:{},410:{},411:{},412:{},413:{},414:{},415:{},416:{},417:{},418:{},419:{},420:{},421:{},422:{T:1},423:{T:1},424:{T:-1},425:{T:-1},426:{f:parse_BrtArrFmla},427:{f:parse_BrtShrFmla},428:{},429:{T:1},430:{T:-1},431:{T:1},432:{T:-1},433:{T:1},434:{T:-1},435:{T:1},436:{T:-1},437:{T:1},438:{T:-1},439:{T:1},440:{T:-1},441:{T:1},442:{T:-1},443:{T:1},444:{T:-1},445:{T:1},446:{T:-1},447:{T:1},448:{T:-1},449:{T:1},450:{T:-1},451:{T:1},452:{T:-1},453:{T:1},454:{T:-1},455:{T:1},456:{T:-1},457:{T:1},458:{T:-1},459:{T:1},460:{T:-1},461:{T:1},462:{T:-1},463:{T:1},464:{T:-1},465:{T:1},466:{T:-1},467:{T:1},468:{T:-1},469:{T:1},470:{T:-1},471:{},472:{},473:{T:1},474:{T:-1},475:{},476:{f:parse_BrtMargins},477:{},478:{},479:{T:1},480:{T:-1},481:{T:1},482:{T:-1},483:{T:1},484:{T:-1},485:{f:parse_BrtWsFmtInfo},486:{T:1},487:{T:-1},488:{T:1},489:{T:-1},490:{T:1},491:{T:-1},492:{T:1},493:{T:-1},494:{f:parse_BrtHLink},495:{T:1},496:{T:-1},497:{T:1},498:{T:-1},499:{},500:{T:1},501:{T:-1},502:{T:1},503:{T:-1},504:{},505:{T:1},506:{T:-1},507:{},508:{T:1},509:{T:-1},510:{T:1},511:{T:-1},512:{},513:{},514:{T:1},515:{T:-1},516:{T:1},517:{T:-1},518:{T:1},519:{T:-1},520:{T:1},521:{T:-1},522:{},523:{},524:{},525:{},526:{},527:{},528:{T:1},529:{T:-1},530:{T:1},531:{T:-1},532:{T:1},533:{T:-1},534:{},535:{},536:{},537:{},538:{T:1},539:{T:-1},540:{T:1},541:{T:-1},542:{T:1},548:{},549:{},550:{f:parse_RelID},551:{},552:{},553:{},554:{T:1},555:{T:-1},556:{T:1},557:{T:-1},558:{T:1},559:{T:-1},560:{T:1},561:{T:-1},562:{},564:{},565:{T:1},566:{T:-1},569:{T:1},570:{T:-1},572:{},573:{T:1},574:{T:-1},577:{},578:{},579:{},580:{},581:{},582:{},583:{},584:{},585:{},586:{},587:{},588:{T:-1},589:{},590:{T:1},591:{T:-1},592:{T:1},593:{T:-1},594:{T:1},595:{T:-1},596:{},597:{T:1},598:{T:-1},599:{T:1},600:{T:-1},601:{T:1},602:{T:-1},603:{T:1},604:{T:-1},605:{T:1},606:{T:-1},607:{},608:{T:1},609:{T:-1},610:{},611:{T:1},612:{T:-1},613:{T:1},614:{T:-1},615:{T:1},616:{T:-1},617:{T:1},618:{T:-1},619:{T:1},620:{T:-1},625:{},626:{T:1},627:{T:-1},628:{T:1},629:{T:-1},630:{T:1},631:{T:-1},632:{f:parse_BrtCommentAuthor},633:{T:1},634:{T:-1},635:{T:1,f:parse_BrtBeginComment},636:{T:-1},637:{f:parse_BrtCommentText},638:{T:1},639:{},640:{T:-1},641:{T:1},642:{T:-1},643:{T:1},644:{},645:{T:-1},646:{T:1},648:{T:1},649:{},650:{T:-1},651:{f:parse_BrtCsProp},652:{},653:{T:1},654:{T:-1},655:{T:1},656:{T:-1},657:{T:1},658:{T:-1},659:{},660:{T:1},661:{},662:{T:-1},663:{},664:{T:1},665:{},666:{T:-1},667:{},668:{},669:{},671:{T:1},672:{T:-1},673:{T:1},674:{T:-1},675:{},676:{},677:{},678:{},679:{},680:{},681:{},1024:{},1025:{},1026:{T:1},1027:{T:-1},1028:{T:1},1029:{T:-1},1030:{},1031:{T:1},1032:{T:-1},1033:{T:1},1034:{T:-1},1035:{},1036:{},1037:{},1038:{T:1},1039:{T:-1},1040:{},1041:{T:1},1042:{T:-1},1043:{},1044:{},1045:{},1046:{T:1},1047:{T:-1},1048:{T:1},1049:{T:-1},1050:{},1051:{T:1},1052:{T:1},1053:{f:parse_BrtDVal14},1054:{T:1},1055:{},1056:{T:1},1057:{T:-1},1058:{T:1},1059:{T:-1},1061:{},1062:{T:1},1063:{T:-1},1064:{T:1},1065:{T:-1},1066:{T:1},1067:{T:-1},1068:{T:1},1069:{T:-1},1070:{T:1},1071:{T:-1},1072:{T:1},1073:{T:-1},1075:{T:1},1076:{T:-1},1077:{T:1},1078:{T:-1},1079:{T:1},1080:{T:-1},1081:{T:1},1082:{T:-1},1083:{T:1},1084:{T:-1},1085:{},1086:{T:1},1087:{T:-1},1088:{T:1},1089:{T:-1},1090:{T:1},1091:{T:-1},1092:{T:1},1093:{T:-1},1094:{T:1},1095:{T:-1},1096:{},1097:{T:1},1098:{},1099:{T:-1},1100:{T:1},1101:{T:-1},1102:{},1103:{},1104:{},1105:{},1111:{},1112:{},1113:{T:1},1114:{T:-1},1115:{T:1},1116:{T:-1},1117:{},1118:{T:1},1119:{T:-1},1120:{T:1},1121:{T:-1},1122:{T:1},1123:{T:-1},1124:{T:1},1125:{T:-1},1126:{},1128:{T:1},1129:{T:-1},1130:{},1131:{T:1},1132:{T:-1},1133:{T:1},1134:{T:-1},1135:{T:1},1136:{T:-1},1137:{T:1},1138:{T:-1},1139:{T:1},1140:{T:-1},1141:{},1142:{T:1},1143:{T:-1},1144:{T:1},1145:{T:-1},1146:{},1147:{T:1},1148:{T:-1},1149:{T:1},1150:{T:-1},1152:{T:1},1153:{T:-1},1154:{T:-1},1155:{T:-1},1156:{T:-1},1157:{T:1},1158:{T:-1},1159:{T:1},1160:{T:-1},1161:{T:1},1162:{T:-1},1163:{T:1},1164:{T:-1},1165:{T:1},1166:{T:-1},1167:{T:1},1168:{T:-1},1169:{T:1},1170:{T:-1},1171:{},1172:{T:1},1173:{T:-1},1177:{},1178:{T:1},1180:{},1181:{},1182:{},2048:{T:1},2049:{T:-1},2050:{},2051:{T:1},2052:{T:-1},2053:{},2054:{},2055:{T:1},2056:{T:-1},2057:{T:1},2058:{T:-1},2060:{},2067:{},2068:{T:1},2069:{T:-1},2070:{},2071:{},2072:{T:1},2073:{T:-1},2075:{},2076:{},2077:{T:1},2078:{T:-1},2079:{},2080:{T:1},2081:{T:-1},2082:{},2083:{T:1},2084:{T:-1},2085:{T:1},2086:{T:-1},2087:{T:1},2088:{T:-1},2089:{T:1},2090:{T:-1},2091:{},2092:{},2093:{T:1},2094:{T:-1},2095:{},2096:{T:1},2097:{T:-1},2098:{T:1},2099:{T:-1},2100:{T:1},2101:{T:-1},2102:{},2103:{T:1},2104:{T:-1},2105:{},2106:{T:1},2107:{T:-1},2108:{},2109:{T:1},2110:{T:-1},2111:{T:1},2112:{T:-1},2113:{T:1},2114:{T:-1},2115:{},2116:{},2117:{},2118:{T:1},2119:{T:-1},2120:{},2121:{T:1},2122:{T:-1},2123:{T:1},2124:{T:-1},2125:{},2126:{T:1},2127:{T:-1},2128:{},2129:{T:1},2130:{T:-1},2131:{T:1},2132:{T:-1},2133:{T:1},2134:{},2135:{},2136:{},2137:{T:1},2138:{T:-1},2139:{T:1},2140:{T:-1},2141:{},3072:{},3073:{},4096:{T:1},4097:{T:-1},5002:{T:1},5003:{T:-1},5081:{T:1},5082:{T:-1},5083:{},5084:{T:1},5085:{T:-1},5086:{T:1},5087:{T:-1},5088:{},5089:{},5090:{},5092:{T:1},5093:{T:-1},5094:{},5095:{T:1},5096:{T:-1},5097:{},5099:{},65535:{n:""}};function write_biff_rec(t,r,e,s){var a=r;if(!isNaN(a)){var i=s||(e||[]).length||0,o=t.next(4);o.write_shift(2,a),o.write_shift(2,i),i>0&&is_buf(e)&&t.push(e)}}function write_biff_continue(t,r,e,s){var a=(e||[]).length||0;if(a<=8224)return write_biff_rec(t,r,e,a);var i=r;if(!isNaN(i)){for(var o=e.parts||[],c=0,h=0,u=0;u+(o[c]||8224)<=8224;)u+=o[c]||8224,c++;var d=t.next(4);for(d.write_shift(2,i),d.write_shift(2,u),t.push(e.slice(h,h+u)),h+=u;h<a;){for(d=t.next(4),d.write_shift(2,60),u=0;u+(o[c]||8224)<=8224;)u+=o[c]||8224,c++;d.write_shift(2,u),t.push(e.slice(h,h+u)),h+=u}}}function write_BIFF2Cell(t,r,e){return t||(t=new_buf(7)),t.write_shift(2,r),t.write_shift(2,e),t.write_shift(2,0),t.write_shift(1,0),t}function write_BIFF2BERR(t,r,e,s){var a=new_buf(9);return write_BIFF2Cell(a,t,r),write_Bes(e,s||"b",a),a}function write_BIFF2LABEL(t,r,e){var s=new_buf(8+2*e.length);return write_BIFF2Cell(s,t,r),s.write_shift(1,e.length),s.write_shift(e.length,e,"sbcs"),s.l<s.length?s.slice(0,s.l):s}function write_ws_biff2_cell(t,r,e,s){if(r.v!=null)switch(r.t){case"d":case"n":var a=r.t=="d"?datenum(parseDate(r.v)):r.v;a==(a|0)&&a>=0&&a<65536?write_biff_rec(t,2,write_BIFF2INT(e,s,a)):write_biff_rec(t,3,write_BIFF2NUM(e,s,a));return;case"b":case"e":write_biff_rec(t,5,write_BIFF2BERR(e,s,r.v,r.t));return;case"s":case"str":write_biff_rec(t,4,write_BIFF2LABEL(e,s,(r.v||"").slice(0,255)));return}write_biff_rec(t,1,write_BIFF2Cell(null,e,s))}function write_ws_biff2(t,r,e,s){var a=Array.isArray(r),i=safe_decode_range(r["!ref"]||"A1"),o,c="",h=[];if(i.e.c>255||i.e.r>16383){if(s.WTF)throw new Error("Range "+(r["!ref"]||"A1")+" exceeds format limit A1:IV16384");i.e.c=Math.min(i.e.c,255),i.e.r=Math.min(i.e.c,16383),o=encode_range(i)}for(var u=i.s.r;u<=i.e.r;++u){c=encode_row(u);for(var d=i.s.c;d<=i.e.c;++d){u===i.s.r&&(h[d]=encode_col(d)),o=h[d]+c;var _=a?(r[u]||[])[d]:r[o];_&&write_ws_biff2_cell(t,_,u,d)}}}function write_biff2_buf(t,r){for(var e=r||{},s=buf_array(),a=0,i=0;i<t.SheetNames.length;++i)t.SheetNames[i]==e.sheet&&(a=i);if(a==0&&e.sheet&&t.SheetNames[0]!=e.sheet)throw new Error("Sheet not found: "+e.sheet);return write_biff_rec(s,e.biff==4?1033:e.biff==3?521:9,write_BOF(t,16,e)),write_ws_biff2(s,t.Sheets[t.SheetNames[a]],a,e),write_biff_rec(s,10),s.end()}function write_FONTS_biff8(t,r,e){write_biff_rec(t,49,write_Font({sz:12,name:"Arial"},e))}function write_FMTS_biff8(t,r,e){r&&[[5,8],[23,26],[41,44],[50,392]].forEach(function(s){for(var a=s[0];a<=s[1];++a)r[a]!=null&&write_biff_rec(t,1054,write_Format(a,r[a],e))})}function write_FEAT(t,r){var e=new_buf(19);e.write_shift(4,2151),e.write_shift(4,0),e.write_shift(4,0),e.write_shift(2,3),e.write_shift(1,1),e.write_shift(4,0),write_biff_rec(t,2151,e),e=new_buf(39),e.write_shift(4,2152),e.write_shift(4,0),e.write_shift(4,0),e.write_shift(2,3),e.write_shift(1,0),e.write_shift(4,0),e.write_shift(2,1),e.write_shift(4,4),e.write_shift(2,0),write_Ref8U(safe_decode_range(r["!ref"]||"A1"),e),e.write_shift(4,4),write_biff_rec(t,2152,e)}function write_CELLXFS_biff8(t,r){for(var e=0;e<16;++e)write_biff_rec(t,224,write_XF({numFmtId:0,style:!0},0,r));r.cellXfs.forEach(function(s){write_biff_rec(t,224,write_XF(s,0,r))})}function write_ws_biff8_hlinks(t,r){for(var e=0;e<r["!links"].length;++e){var s=r["!links"][e];write_biff_rec(t,440,write_HLink(s)),s[1].Tooltip&&write_biff_rec(t,2048,write_HLinkTooltip(s))}delete r["!links"]}function write_ws_cols_biff8(t,r){if(r){var e=0;r.forEach(function(s,a){++e<=256&&s&&write_biff_rec(t,125,write_ColInfo(col_obj_w(a,s),a))})}}function write_ws_biff8_cell(t,r,e,s,a){var i=16+get_cell_style(a.cellXfs,r,a);if(r.v==null&&!r.bf){write_biff_rec(t,513,write_XLSCell(e,s,i));return}if(r.bf)write_biff_rec(t,6,write_Formula(r,e,s,a,i));else switch(r.t){case"d":case"n":var o=r.t=="d"?datenum(parseDate(r.v)):r.v;write_biff_rec(t,515,write_Number(e,s,o,i));break;case"b":case"e":write_biff_rec(t,517,write_BoolErr(e,s,r.v,i,a,r.t));break;case"s":case"str":if(a.bookSST){var c=get_sst_id(a.Strings,r.v,a.revStrings);write_biff_rec(t,253,write_LabelSst(e,s,c,i))}else write_biff_rec(t,516,write_Label(e,s,(r.v||"").slice(0,255),i,a));break;default:write_biff_rec(t,513,write_XLSCell(e,s,i))}}function write_ws_biff8(t,r,e){var s=buf_array(),a=e.SheetNames[t],i=e.Sheets[a]||{},o=(e||{}).Workbook||{},c=(o.Sheets||[])[t]||{},h=Array.isArray(i),u=r.biff==8,d,_="",b=[],v=safe_decode_range(i["!ref"]||"A1"),E=u?65536:16384;if(v.e.c>255||v.e.r>=E){if(r.WTF)throw new Error("Range "+(i["!ref"]||"A1")+" exceeds format limit A1:IV16384");v.e.c=Math.min(v.e.c,255),v.e.r=Math.min(v.e.c,E-1)}write_biff_rec(s,2057,write_BOF(e,16,r)),write_biff_rec(s,13,writeuint16(1)),write_biff_rec(s,12,writeuint16(100)),write_biff_rec(s,15,writebool(!0)),write_biff_rec(s,17,writebool(!1)),write_biff_rec(s,16,write_Xnum(.001)),write_biff_rec(s,95,writebool(!0)),write_biff_rec(s,42,writebool(!1)),write_biff_rec(s,43,writebool(!1)),write_biff_rec(s,130,writeuint16(1)),write_biff_rec(s,128,write_Guts()),write_biff_rec(s,131,writebool(!1)),write_biff_rec(s,132,writebool(!1)),u&&write_ws_cols_biff8(s,i["!cols"]),write_biff_rec(s,512,write_Dimensions(v,r)),u&&(i["!links"]=[]);for(var x=v.s.r;x<=v.e.r;++x){_=encode_row(x);for(var g=v.s.c;g<=v.e.c;++g){x===v.s.r&&(b[g]=encode_col(g)),d=b[g]+_;var w=h?(i[x]||[])[g]:i[d];w&&(write_ws_biff8_cell(s,w,x,g,r),u&&w.l&&i["!links"].push([d,w.l]))}}var R=c.CodeName||c.name||a;return u&&write_biff_rec(s,574,write_Window2((o.Views||[])[0])),u&&(i["!merges"]||[]).length&&write_biff_rec(s,229,write_MergeCells(i["!merges"])),u&&write_ws_biff8_hlinks(s,i),write_biff_rec(s,442,write_XLUnicodeString(R)),u&&write_FEAT(s,i),write_biff_rec(s,10),s.end()}function write_biff8_global(t,r,e){var s=buf_array(),a=(t||{}).Workbook||{},i=a.Sheets||[],o=a.WBProps||{},c=e.biff==8,h=e.biff==5;if(write_biff_rec(s,2057,write_BOF(t,5,e)),e.bookType=="xla"&&write_biff_rec(s,135),write_biff_rec(s,225,c?writeuint16(1200):null),write_biff_rec(s,193,writezeroes(2)),h&&write_biff_rec(s,191),h&&write_biff_rec(s,192),write_biff_rec(s,226),write_biff_rec(s,92,write_WriteAccess("SheetJS",e)),write_biff_rec(s,66,writeuint16(c?1200:1252)),c&&write_biff_rec(s,353,writeuint16(0)),c&&write_biff_rec(s,448),write_biff_rec(s,317,write_RRTabId(t.SheetNames.length)),c&&t.vbaraw&&write_biff_rec(s,211),c&&t.vbaraw){var u=o.CodeName||"ThisWorkbook";write_biff_rec(s,442,write_XLUnicodeString(u))}write_biff_rec(s,156,writeuint16(17)),write_biff_rec(s,25,writebool(!1)),write_biff_rec(s,18,writebool(!1)),write_biff_rec(s,19,writeuint16(0)),c&&write_biff_rec(s,431,writebool(!1)),c&&write_biff_rec(s,444,writeuint16(0)),write_biff_rec(s,61,write_Window1()),write_biff_rec(s,64,writebool(!1)),write_biff_rec(s,141,writeuint16(0)),write_biff_rec(s,34,writebool(safe1904(t)=="true")),write_biff_rec(s,14,writebool(!0)),c&&write_biff_rec(s,439,writebool(!1)),write_biff_rec(s,218,writeuint16(0)),write_FONTS_biff8(s,t,e),write_FMTS_biff8(s,t.SSF,e),write_CELLXFS_biff8(s,e),c&&write_biff_rec(s,352,writebool(!1));var d=s.end(),_=buf_array();c&&write_biff_rec(_,140,write_Country()),c&&e.Strings&&write_biff_continue(_,252,write_SST(e.Strings)),write_biff_rec(_,10);var b=_.end(),v=buf_array(),E=0,x=0;for(x=0;x<t.SheetNames.length;++x)E+=(c?12:11)+(c?2:1)*t.SheetNames[x].length;var g=d.length+E+b.length;for(x=0;x<t.SheetNames.length;++x){var w=i[x]||{};write_biff_rec(v,133,write_BoundSheet8({pos:g,hs:w.Hidden||0,dt:0,name:t.SheetNames[x]},e)),g+=r[x].length}var R=v.end();if(E!=R.length)throw new Error("BS8 "+E+" != "+R.length);var N=[];return d.length&&N.push(d),R.length&&N.push(R),b.length&&N.push(b),bconcat(N)}function write_biff8_buf(t,r){var e=r||{},s=[];t&&!t.SSF&&(t.SSF=dup(table_fmt)),t&&t.SSF&&(make_ssf(),SSF_load_table(t.SSF),e.revssf=evert_num(t.SSF),e.revssf[t.SSF[65535]]=0,e.ssf=t.SSF),e.Strings=[],e.Strings.Count=0,e.Strings.Unique=0,fix_write_opts(e),e.cellXfs=[],get_cell_style(e.cellXfs,{},{revssf:{General:0}}),t.Props||(t.Props={});for(var a=0;a<t.SheetNames.length;++a)s[s.length]=write_ws_biff8(a,e,t);return s.unshift(write_biff8_global(t,s,e)),bconcat(s)}function write_biff_buf(t,r){for(var e=0;e<=t.SheetNames.length;++e){var s=t.Sheets[t.SheetNames[e]];if(!(!s||!s["!ref"])){var a=decode_range(s["!ref"]);a.e.c>255&&typeof console<"u"&&console.error&&console.error("Worksheet '"+t.SheetNames[e]+"' extends beyond column IV (255).  Data may be lost.")}}var i=r||{};switch(i.biff||2){case 8:case 5:return write_biff8_buf(t,r);case 4:case 3:case 2:return write_biff2_buf(t,r)}throw new Error("invalid type "+i.bookType+" for BIFF")}function make_html_row(t,r,e,s){for(var a=t["!merges"]||[],i=[],o=r.s.c;o<=r.e.c;++o){for(var c=0,h=0,u=0;u<a.length;++u)if(!(a[u].s.r>e||a[u].s.c>o)&&!(a[u].e.r<e||a[u].e.c<o)){if(a[u].s.r<e||a[u].s.c<o){c=-1;break}c=a[u].e.r-a[u].s.r+1,h=a[u].e.c-a[u].s.c+1;break}if(!(c<0)){var d=encode_cell({r:e,c:o}),_=s.dense?(t[e]||[])[o]:t[d],b=_&&_.v!=null&&(_.h||escapehtml(_.w||(format_cell(_),_.w)||""))||"",v={};c>1&&(v.rowspan=c),h>1&&(v.colspan=h),s.editable?b='<span contenteditable="true">'+b+"</span>":_&&(v["data-t"]=_&&_.t||"z",_.v!=null&&(v["data-v"]=_.v),_.z!=null&&(v["data-z"]=_.z),_.l&&(_.l.Target||"#").charAt(0)!="#"&&(b='<a href="'+_.l.Target+'">'+b+"</a>")),v.id=(s.id||"sjs")+"-"+d,i.push(writextag("td",b,v))}}var E="<tr>";return E+i.join("")+"</tr>"}var HTML_BEGIN='<html><head><meta charset="utf-8"/><title>SheetJS Table Export</title></head><body>',HTML_END="</body></html>";function make_html_preamble(t,r,e){var s=[];return s.join("")+"<table"+(e&&e.id?' id="'+e.id+'"':"")+">"}function sheet_to_html(t,r){var e=r||{},s=e.header!=null?e.header:HTML_BEGIN,a=e.footer!=null?e.footer:HTML_END,i=[s],o=decode_range(t["!ref"]);e.dense=Array.isArray(t),i.push(make_html_preamble(t,o,e));for(var c=o.s.r;c<=o.e.r;++c)i.push(make_html_row(t,o,c,e));return i.push("</table>"+a),i.join("")}function sheet_add_dom(t,r,e){var s=e||{},a=0,i=0;if(s.origin!=null)if(typeof s.origin=="number")a=s.origin;else{var o=typeof s.origin=="string"?decode_cell(s.origin):s.origin;a=o.r,i=o.c}var c=r.getElementsByTagName("tr"),h=Math.min(s.sheetRows||1e7,c.length),u={s:{r:0,c:0},e:{r:a,c:i}};if(t["!ref"]){var d=decode_range(t["!ref"]);u.s.r=Math.min(u.s.r,d.s.r),u.s.c=Math.min(u.s.c,d.s.c),u.e.r=Math.max(u.e.r,d.e.r),u.e.c=Math.max(u.e.c,d.e.c),a==-1&&(u.e.r=a=d.e.r+1)}var _=[],b=0,v=t["!rows"]||(t["!rows"]=[]),E=0,x=0,g=0,w=0,R=0,N=0;for(t["!cols"]||(t["!cols"]=[]);E<c.length&&x<h;++E){var M=c[E];if(is_dom_element_hidden(M)){if(s.display)continue;v[x]={hidden:!0}}var A=M.children;for(g=w=0;g<A.length;++g){var I=A[g];if(!(s.display&&is_dom_element_hidden(I))){var y=I.hasAttribute("data-v")?I.getAttribute("data-v"):I.hasAttribute("v")?I.getAttribute("v"):htmldecode(I.innerHTML),j=I.getAttribute("data-z")||I.getAttribute("z");for(b=0;b<_.length;++b){var T=_[b];T.s.c==w+i&&T.s.r<x+a&&x+a<=T.e.r&&(w=T.e.c+1-i,b=-1)}N=+I.getAttribute("colspan")||1,((R=+I.getAttribute("rowspan")||1)>1||N>1)&&_.push({s:{r:x+a,c:w+i},e:{r:x+a+(R||1)-1,c:w+i+(N||1)-1}});var U={t:"s",v:y},F=I.getAttribute("data-t")||I.getAttribute("t")||"";y!=null&&(y.length==0?U.t=F||"z":s.raw||y.trim().length==0||F=="s"||(y==="TRUE"?U={t:"b",v:!0}:y==="FALSE"?U={t:"b",v:!1}:isNaN(fuzzynum(y))?isNaN(fuzzydate(y).getDate())||(U={t:"d",v:parseDate(y)},s.cellDates||(U={t:"n",v:datenum(U.v)}),U.z=s.dateNF||table_fmt[14]):U={t:"n",v:fuzzynum(y)})),U.z===void 0&&j!=null&&(U.z=j);var H="",z=I.getElementsByTagName("A");if(z&&z.length)for(var de=0;de<z.length&&!(z[de].hasAttribute("href")&&(H=z[de].getAttribute("href"),H.charAt(0)!="#"));++de);H&&H.charAt(0)!="#"&&(U.l={Target:H}),s.dense?(t[x+a]||(t[x+a]=[]),t[x+a][w+i]=U):t[encode_cell({c:w+i,r:x+a})]=U,u.e.c<w+i&&(u.e.c=w+i),w+=N}}++x}return _.length&&(t["!merges"]=(t["!merges"]||[]).concat(_)),u.e.r=Math.max(u.e.r,x-1+a),t["!ref"]=encode_range(u),x>=h&&(t["!fullref"]=encode_range((u.e.r=c.length-E+x-1+a,u))),t}function parse_dom_table(t,r){var e=r||{},s=e.dense?[]:{};return sheet_add_dom(s,t,r)}function table_to_book(t,r){return sheet_to_workbook(parse_dom_table(t,r),r)}function is_dom_element_hidden(t){var r="",e=get_get_computed_style_function(t);return e&&(r=e(t).getPropertyValue("display")),r||(r=t.style&&t.style.display),r==="none"}function get_get_computed_style_function(t){return t.ownerDocument.defaultView&&typeof t.ownerDocument.defaultView.getComputedStyle=="function"?t.ownerDocument.defaultView.getComputedStyle:typeof getComputedStyle=="function"?getComputedStyle:null}var write_styles_ods=function(){var t=["<office:master-styles>",'<style:master-page style:name="mp1" style:page-layout-name="mp1">',"<style:header/>",'<style:header-left style:display="false"/>',"<style:footer/>",'<style:footer-left style:display="false"/>',"</style:master-page>","</office:master-styles>"].join(""),r="<office:document-styles "+wxt_helper({"xmlns:office":"urn:oasis:names:tc:opendocument:xmlns:office:1.0","xmlns:table":"urn:oasis:names:tc:opendocument:xmlns:table:1.0","xmlns:style":"urn:oasis:names:tc:opendocument:xmlns:style:1.0","xmlns:text":"urn:oasis:names:tc:opendocument:xmlns:text:1.0","xmlns:draw":"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0","xmlns:fo":"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0","xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:dc":"http://purl.org/dc/elements/1.1/","xmlns:number":"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0","xmlns:svg":"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0","xmlns:of":"urn:oasis:names:tc:opendocument:xmlns:of:1.2","office:version":"1.2"})+">"+t+"</office:document-styles>";return function(){return XML_HEADER+r}}(),write_content_ods=function(){var t=function(i){return escapexml(i).replace(/  +/g,function(o){return'<text:s text:c="'+o.length+'"/>'}).replace(/\t/g,"<text:tab/>").replace(/\n/g,"</text:p><text:p>").replace(/^ /,"<text:s/>").replace(/ $/,"<text:s/>")},r=`          <table:table-cell />
`,e=`          <table:covered-table-cell/>
`,s=function(i,o,c){var h=[];h.push('      <table:table table:name="'+escapexml(o.SheetNames[c])+`" table:style-name="ta1">
`);var u=0,d=0,_=decode_range(i["!ref"]||"A1"),b=i["!merges"]||[],v=0,E=Array.isArray(i);if(i["!cols"])for(d=0;d<=_.e.c;++d)h.push("        <table:table-column"+(i["!cols"][d]?' table:style-name="co'+i["!cols"][d].ods+'"':"")+`></table:table-column>
`);var x="",g=i["!rows"]||[];for(u=0;u<_.s.r;++u)x=g[u]?' table:style-name="ro'+g[u].ods+'"':"",h.push("        <table:table-row"+x+`></table:table-row>
`);for(;u<=_.e.r;++u){for(x=g[u]?' table:style-name="ro'+g[u].ods+'"':"",h.push("        <table:table-row"+x+`>
`),d=0;d<_.s.c;++d)h.push(r);for(;d<=_.e.c;++d){var w=!1,R={},N="";for(v=0;v!=b.length;++v)if(!(b[v].s.c>d)&&!(b[v].s.r>u)&&!(b[v].e.c<d)&&!(b[v].e.r<u)){(b[v].s.c!=d||b[v].s.r!=u)&&(w=!0),R["table:number-columns-spanned"]=b[v].e.c-b[v].s.c+1,R["table:number-rows-spanned"]=b[v].e.r-b[v].s.r+1;break}if(w){h.push(e);continue}var M=encode_cell({r:u,c:d}),A=E?(i[u]||[])[d]:i[M];if(A&&A.f&&(R["table:formula"]=escapexml(csf_to_ods_formula(A.f)),A.F&&A.F.slice(0,M.length)==M)){var I=decode_range(A.F);R["table:number-matrix-columns-spanned"]=I.e.c-I.s.c+1,R["table:number-matrix-rows-spanned"]=I.e.r-I.s.r+1}if(!A){h.push(r);continue}switch(A.t){case"b":N=A.v?"TRUE":"FALSE",R["office:value-type"]="boolean",R["office:boolean-value"]=A.v?"true":"false";break;case"n":N=A.w||String(A.v||0),R["office:value-type"]="float",R["office:value"]=A.v||0;break;case"s":case"str":N=A.v==null?"":A.v,R["office:value-type"]="string";break;case"d":N=A.w||parseDate(A.v).toISOString(),R["office:value-type"]="date",R["office:date-value"]=parseDate(A.v).toISOString(),R["table:style-name"]="ce1";break;default:h.push(r);continue}var y=t(N);if(A.l&&A.l.Target){var j=A.l.Target;j=j.charAt(0)=="#"?"#"+csf_to_ods_3D(j.slice(1)):j,j.charAt(0)!="#"&&!j.match(/^\w+:/)&&(j="../"+j),y=writextag("text:a",y,{"xlink:href":j.replace(/&/g,"&amp;")})}h.push("          "+writextag("table:table-cell",writextag("text:p",y,{}),R)+`
`)}h.push(`        </table:table-row>
`)}return h.push(`      </table:table>
`),h.join("")},a=function(i,o){i.push(` <office:automatic-styles>
`),i.push(`  <number:date-style style:name="N37" number:automatic-order="true">
`),i.push(`   <number:month number:style="long"/>
`),i.push(`   <number:text>/</number:text>
`),i.push(`   <number:day number:style="long"/>
`),i.push(`   <number:text>/</number:text>
`),i.push(`   <number:year/>
`),i.push(`  </number:date-style>
`);var c=0;o.SheetNames.map(function(u){return o.Sheets[u]}).forEach(function(u){if(u&&u["!cols"]){for(var d=0;d<u["!cols"].length;++d)if(u["!cols"][d]){var _=u["!cols"][d];if(_.width==null&&_.wpx==null&&_.wch==null)continue;process_col(_),_.ods=c;var b=u["!cols"][d].wpx+"px";i.push('  <style:style style:name="co'+c+`" style:family="table-column">
`),i.push('   <style:table-column-properties fo:break-before="auto" style:column-width="'+b+`"/>
`),i.push(`  </style:style>
`),++c}}});var h=0;o.SheetNames.map(function(u){return o.Sheets[u]}).forEach(function(u){if(u&&u["!rows"]){for(var d=0;d<u["!rows"].length;++d)if(u["!rows"][d]){u["!rows"][d].ods=h;var _=u["!rows"][d].hpx+"px";i.push('  <style:style style:name="ro'+h+`" style:family="table-row">
`),i.push('   <style:table-row-properties fo:break-before="auto" style:row-height="'+_+`"/>
`),i.push(`  </style:style>
`),++h}}}),i.push(`  <style:style style:name="ta1" style:family="table" style:master-page-name="mp1">
`),i.push(`   <style:table-properties table:display="true" style:writing-mode="lr-tb"/>
`),i.push(`  </style:style>
`),i.push(`  <style:style style:name="ce1" style:family="table-cell" style:parent-style-name="Default" style:data-style-name="N37"/>
`),i.push(` </office:automatic-styles>
`)};return function(o,c){var h=[XML_HEADER],u=wxt_helper({"xmlns:office":"urn:oasis:names:tc:opendocument:xmlns:office:1.0","xmlns:table":"urn:oasis:names:tc:opendocument:xmlns:table:1.0","xmlns:style":"urn:oasis:names:tc:opendocument:xmlns:style:1.0","xmlns:text":"urn:oasis:names:tc:opendocument:xmlns:text:1.0","xmlns:draw":"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0","xmlns:fo":"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0","xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:dc":"http://purl.org/dc/elements/1.1/","xmlns:meta":"urn:oasis:names:tc:opendocument:xmlns:meta:1.0","xmlns:number":"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0","xmlns:presentation":"urn:oasis:names:tc:opendocument:xmlns:presentation:1.0","xmlns:svg":"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0","xmlns:chart":"urn:oasis:names:tc:opendocument:xmlns:chart:1.0","xmlns:dr3d":"urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0","xmlns:math":"http://www.w3.org/1998/Math/MathML","xmlns:form":"urn:oasis:names:tc:opendocument:xmlns:form:1.0","xmlns:script":"urn:oasis:names:tc:opendocument:xmlns:script:1.0","xmlns:ooo":"http://openoffice.org/2004/office","xmlns:ooow":"http://openoffice.org/2004/writer","xmlns:oooc":"http://openoffice.org/2004/calc","xmlns:dom":"http://www.w3.org/2001/xml-events","xmlns:xforms":"http://www.w3.org/2002/xforms","xmlns:xsd":"http://www.w3.org/2001/XMLSchema","xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance","xmlns:sheet":"urn:oasis:names:tc:opendocument:sh33tjs:1.0","xmlns:rpt":"http://openoffice.org/2005/report","xmlns:of":"urn:oasis:names:tc:opendocument:xmlns:of:1.2","xmlns:xhtml":"http://www.w3.org/1999/xhtml","xmlns:grddl":"http://www.w3.org/2003/g/data-view#","xmlns:tableooo":"http://openoffice.org/2009/table","xmlns:drawooo":"http://openoffice.org/2010/draw","xmlns:calcext":"urn:org:documentfoundation:names:experimental:calc:xmlns:calcext:1.0","xmlns:loext":"urn:org:documentfoundation:names:experimental:office:xmlns:loext:1.0","xmlns:field":"urn:openoffice:names:experimental:ooo-ms-interop:xmlns:field:1.0","xmlns:formx":"urn:openoffice:names:experimental:ooxml-odf-interop:xmlns:form:1.0","xmlns:css3t":"http://www.w3.org/TR/css3-text/","office:version":"1.2"}),d=wxt_helper({"xmlns:config":"urn:oasis:names:tc:opendocument:xmlns:config:1.0","office:mimetype":"application/vnd.oasis.opendocument.spreadsheet"});c.bookType=="fods"?(h.push("<office:document"+u+d+`>
`),h.push(write_meta_ods().replace(/office:document-meta/g,"office:meta"))):h.push("<office:document-content"+u+`>
`),a(h,o),h.push(`  <office:body>
`),h.push(`    <office:spreadsheet>
`);for(var _=0;_!=o.SheetNames.length;++_)h.push(s(o.Sheets[o.SheetNames[_]],o,_));return h.push(`    </office:spreadsheet>
`),h.push(`  </office:body>
`),c.bookType=="fods"?h.push("</office:document>"):h.push("</office:document-content>"),h.join("")}}();function write_ods(t,r){if(r.bookType=="fods")return write_content_ods(t,r);var e=zip_new(),s="",a=[],i=[];return s="mimetype",zip_add_file(e,s,"application/vnd.oasis.opendocument.spreadsheet"),s="content.xml",zip_add_file(e,s,write_content_ods(t,r)),a.push([s,"text/xml"]),i.push([s,"ContentFile"]),s="styles.xml",zip_add_file(e,s,write_styles_ods(t,r)),a.push([s,"text/xml"]),i.push([s,"StylesFile"]),s="meta.xml",zip_add_file(e,s,XML_HEADER+write_meta_ods()),a.push([s,"text/xml"]),i.push([s,"MetadataFile"]),s="manifest.rdf",zip_add_file(e,s,write_rdf(i)),a.push([s,"application/rdf+xml"]),s="META-INF/manifest.xml",zip_add_file(e,s,write_manifest(a)),e}/*! sheetjs (C) 2013-present SheetJS -- http://sheetjs.com */function u8_to_dataview(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function stru8(t){return typeof TextEncoder<"u"?new TextEncoder().encode(t):s2a(utf8write(t))}function u8contains(t,r){e:for(var e=0;e<=t.length-r.length;++e){for(var s=0;s<r.length;++s)if(t[e+s]!=r[s])continue e;return!0}return!1}function u8concat(t){var r=t.reduce(function(a,i){return a+i.length},0),e=new Uint8Array(r),s=0;return t.forEach(function(a){e.set(a,s),s+=a.length}),e}function writeDecimal128LE(t,r,e){var s=Math.floor(e==0?0:Math.LOG10E*Math.log(Math.abs(e)))+6176-20,a=e/Math.pow(10,s-6176);t[r+15]|=s>>7,t[r+14]|=(s&127)<<1;for(var i=0;a>=1;++i,a/=256)t[r+i]=a&255;t[r+15]|=e>=0?0:128}function parse_varint49(t,r){var e=r?r[0]:0,s=t[e]&127;e:if(t[e++]>=128&&(s|=(t[e]&127)<<7,t[e++]<128||(s|=(t[e]&127)<<14,t[e++]<128)||(s|=(t[e]&127)<<21,t[e++]<128)||(s+=(t[e]&127)*Math.pow(2,28),++e,t[e++]<128)||(s+=(t[e]&127)*Math.pow(2,35),++e,t[e++]<128)||(s+=(t[e]&127)*Math.pow(2,42),++e,t[e++]<128)))break e;return r&&(r[0]=e),s}function write_varint49(t){var r=new Uint8Array(7);r[0]=t&127;var e=1;e:if(t>127){if(r[e-1]|=128,r[e]=t>>7&127,++e,t<=16383||(r[e-1]|=128,r[e]=t>>14&127,++e,t<=2097151)||(r[e-1]|=128,r[e]=t>>21&127,++e,t<=268435455)||(r[e-1]|=128,r[e]=t/256>>>21&127,++e,t<=34359738367)||(r[e-1]|=128,r[e]=t/65536>>>21&127,++e,t<=4398046511103))break e;r[e-1]|=128,r[e]=t/16777216>>>21&127,++e}return r.slice(0,e)}function varint_to_i32(t){var r=0,e=t[r]&127;e:if(t[r++]>=128){if(e|=(t[r]&127)<<7,t[r++]<128||(e|=(t[r]&127)<<14,t[r++]<128)||(e|=(t[r]&127)<<21,t[r++]<128))break e;e|=(t[r]&127)<<28}return e}function parse_shallow(t){for(var r=[],e=[0];e[0]<t.length;){var s=e[0],a=parse_varint49(t,e),i=a&7;a=Math.floor(a/8);var o=0,c;if(a==0)break;switch(i){case 0:{for(var h=e[0];t[e[0]++]>=128;);c=t.slice(h,e[0])}break;case 5:o=4,c=t.slice(e[0],e[0]+o),e[0]+=o;break;case 1:o=8,c=t.slice(e[0],e[0]+o),e[0]+=o;break;case 2:o=parse_varint49(t,e),c=t.slice(e[0],e[0]+o),e[0]+=o;break;case 3:case 4:default:throw new Error("PB Type ".concat(i," for Field ").concat(a," at offset ").concat(s))}var u={data:c,type:i};r[a]==null?r[a]=[u]:r[a].push(u)}return r}function write_shallow(t){var r=[];return t.forEach(function(e,s){e.forEach(function(a){a.data&&(r.push(write_varint49(s*8+a.type)),a.type==2&&r.push(write_varint49(a.data.length)),r.push(a.data))})}),u8concat(r)}function parse_iwa_file(t){for(var r,e=[],s=[0];s[0]<t.length;){var a=parse_varint49(t,s),i=parse_shallow(t.slice(s[0],s[0]+a));s[0]+=a;var o={id:varint_to_i32(i[1][0].data),messages:[]};i[2].forEach(function(c){var h=parse_shallow(c.data),u=varint_to_i32(h[3][0].data);o.messages.push({meta:h,data:t.slice(s[0],s[0]+u)}),s[0]+=u}),(r=i[3])!=null&&r[0]&&(o.merge=varint_to_i32(i[3][0].data)>>>0>0),e.push(o)}return e}function write_iwa_file(t){var r=[];return t.forEach(function(e){var s=[];s[1]=[{data:write_varint49(e.id),type:0}],s[2]=[],e.merge!=null&&(s[3]=[{data:write_varint49(+!!e.merge),type:0}]);var a=[];e.messages.forEach(function(o){a.push(o.data),o.meta[3]=[{type:0,data:write_varint49(o.data.length)}],s[2].push({data:write_shallow(o.meta),type:2})});var i=write_shallow(s);r.push(write_varint49(i.length)),r.push(i),a.forEach(function(o){return r.push(o)})}),u8concat(r)}function parse_snappy_chunk(t,r){if(t!=0)throw new Error("Unexpected Snappy chunk type ".concat(t));for(var e=[0],s=parse_varint49(r,e),a=[];e[0]<r.length;){var i=r[e[0]]&3;if(i==0){var o=r[e[0]++]>>2;if(o<60)++o;else{var c=o-59;o=r[e[0]],c>1&&(o|=r[e[0]+1]<<8),c>2&&(o|=r[e[0]+2]<<16),c>3&&(o|=r[e[0]+3]<<24),o>>>=0,o++,e[0]+=c}a.push(r.slice(e[0],e[0]+o)),e[0]+=o;continue}else{var h=0,u=0;if(i==1?(u=(r[e[0]]>>2&7)+4,h=(r[e[0]++]&224)<<3,h|=r[e[0]++]):(u=(r[e[0]++]>>2)+1,i==2?(h=r[e[0]]|r[e[0]+1]<<8,e[0]+=2):(h=(r[e[0]]|r[e[0]+1]<<8|r[e[0]+2]<<16|r[e[0]+3]<<24)>>>0,e[0]+=4)),a=[u8concat(a)],h==0)throw new Error("Invalid offset 0");if(h>a[0].length)throw new Error("Invalid offset beyond length");if(u>=h)for(a.push(a[0].slice(-h)),u-=h;u>=a[a.length-1].length;)a.push(a[a.length-1]),u-=a[a.length-1].length;a.push(a[0].slice(-h,-h+u))}}var d=u8concat(a);if(d.length!=s)throw new Error("Unexpected length: ".concat(d.length," != ").concat(s));return d}function decompress_iwa_file(t){for(var r=[],e=0;e<t.length;){var s=t[e++],a=t[e]|t[e+1]<<8|t[e+2]<<16;e+=3,r.push(parse_snappy_chunk(s,t.slice(e,e+a))),e+=a}if(e!==t.length)throw new Error("data is not a valid framed stream!");return u8concat(r)}function compress_iwa_file(t){for(var r=[],e=0;e<t.length;){var s=Math.min(t.length-e,268435455),a=new Uint8Array(4);r.push(a);var i=write_varint49(s),o=i.length;r.push(i),s<=60?(o++,r.push(new Uint8Array([s-1<<2]))):s<=256?(o+=2,r.push(new Uint8Array([240,s-1&255]))):s<=65536?(o+=3,r.push(new Uint8Array([244,s-1&255,s-1>>8&255]))):s<=16777216?(o+=4,r.push(new Uint8Array([248,s-1&255,s-1>>8&255,s-1>>16&255]))):s<=4294967296&&(o+=5,r.push(new Uint8Array([252,s-1&255,s-1>>8&255,s-1>>16&255,s-1>>>24&255]))),r.push(t.slice(e,e+s)),o+=s,a[0]=0,a[1]=o&255,a[2]=o>>8&255,a[3]=o>>16&255,e+=s}return u8concat(r)}function write_new_storage(t,r){var e=new Uint8Array(32),s=u8_to_dataview(e),a=12,i=0;switch(e[0]=5,t.t){case"n":e[1]=2,writeDecimal128LE(e,a,t.v),i|=1,a+=16;break;case"b":e[1]=6,s.setFloat64(a,t.v?1:0,!0),i|=2,a+=8;break;case"s":if(r.indexOf(t.v)==-1)throw new Error("Value ".concat(t.v," missing from SST!"));e[1]=3,s.setUint32(a,r.indexOf(t.v),!0),i|=8,a+=4;break;default:throw"unsupported cell type "+t.t}return s.setUint32(8,i,!0),e.slice(0,a)}function write_old_storage(t,r){var e=new Uint8Array(32),s=u8_to_dataview(e),a=12,i=0;switch(e[0]=3,t.t){case"n":e[2]=2,s.setFloat64(a,t.v,!0),i|=32,a+=8;break;case"b":e[2]=6,s.setFloat64(a,t.v?1:0,!0),i|=32,a+=8;break;case"s":if(r.indexOf(t.v)==-1)throw new Error("Value ".concat(t.v," missing from SST!"));e[2]=3,s.setUint32(a,r.indexOf(t.v),!0),i|=16,a+=4;break;default:throw"unsupported cell type "+t.t}return s.setUint32(4,i,!0),e.slice(0,a)}function parse_TSP_Reference(t){var r=parse_shallow(t);return parse_varint49(r[1][0].data)}function write_tile_row(t,r,e){var s,a,i,o;if(!((s=t[6])!=null&&s[0])||!((a=t[7])!=null&&a[0]))throw"Mutation only works on post-BNC storages!";var c=((o=(i=t[8])==null?void 0:i[0])==null?void 0:o.data)&&varint_to_i32(t[8][0].data)>0||!1;if(c)throw"Math only works with normal offsets";for(var h=0,u=u8_to_dataview(t[7][0].data),d=0,_=[],b=u8_to_dataview(t[4][0].data),v=0,E=[],x=0;x<r.length;++x){if(r[x]==null){u.setUint16(x*2,65535,!0),b.setUint16(x*2,65535);continue}u.setUint16(x*2,d,!0),b.setUint16(x*2,v,!0);var g,w;switch(typeof r[x]){case"string":g=write_new_storage({t:"s",v:r[x]},e),w=write_old_storage({t:"s",v:r[x]},e);break;case"number":g=write_new_storage({t:"n",v:r[x]},e),w=write_old_storage({t:"n",v:r[x]},e);break;case"boolean":g=write_new_storage({t:"b",v:r[x]},e),w=write_old_storage({t:"b",v:r[x]},e);break;default:throw new Error("Unsupported value "+r[x])}_.push(g),d+=g.length,E.push(w),v+=w.length,++h}for(t[2][0].data=write_varint49(h);x<t[7][0].data.length/2;++x)u.setUint16(x*2,65535,!0),b.setUint16(x*2,65535,!0);return t[6][0].data=u8concat(_),t[3][0].data=u8concat(E),h}function write_numbers_iwa(t,r){if(!r||!r.numbers)throw new Error("Must pass a `numbers` option -- check the README");var e=t.Sheets[t.SheetNames[0]];t.SheetNames.length>1&&console.error("The Numbers writer currently writes only the first table");var s=decode_range(e["!ref"]);s.s.r=s.s.c=0;var a=!1;s.e.c>9&&(a=!0,s.e.c=9),s.e.r>49&&(a=!0,s.e.r=49),a&&console.error("The Numbers writer is currently limited to ".concat(encode_range(s)));var i=sheet_to_json(e,{range:s,header:1}),o=["~Sh33tJ5~"];i.forEach(function(S){return S.forEach(function(C){typeof C=="string"&&o.push(C)})});var c={},h=[],u=CFB.read(r.numbers,{type:"base64"});u.FileIndex.map(function(S,C){return[S,u.FullPaths[C]]}).forEach(function(S){var C=S[0],P=S[1];if(C.type==2&&C.name.match(/\.iwa/)){var D=C.content,B=decompress_iwa_file(D),G=parse_iwa_file(B);G.forEach(function(J){h.push(J.id),c[J.id]={deps:[],location:P,type:varint_to_i32(J.messages[0].meta[1][0].data)}})}}),h.sort(function(S,C){return S-C});var d=h.filter(function(S){return S>1}).map(function(S){return[S,write_varint49(S)]});u.FileIndex.map(function(S,C){return[S,u.FullPaths[C]]}).forEach(function(S){var C=S[0];if(S[1],!!C.name.match(/\.iwa/)){var P=parse_iwa_file(decompress_iwa_file(C.content));P.forEach(function(D){D.messages.forEach(function(B){d.forEach(function(G){D.messages.some(function(J){return varint_to_i32(J.meta[1][0].data)!=11006&&u8contains(J.data,G[1])})&&c[G[0]].deps.push(D.id)})})})}});for(var _=CFB.find(u,c[1].location),b=parse_iwa_file(decompress_iwa_file(_.content)),v,E=0;E<b.length;++E){var x=b[E];x.id==1&&(v=x)}var g=parse_TSP_Reference(parse_shallow(v.messages[0].data)[1][0].data);for(_=CFB.find(u,c[g].location),b=parse_iwa_file(decompress_iwa_file(_.content)),E=0;E<b.length;++E)x=b[E],x.id==g&&(v=x);for(g=parse_TSP_Reference(parse_shallow(v.messages[0].data)[2][0].data),_=CFB.find(u,c[g].location),b=parse_iwa_file(decompress_iwa_file(_.content)),E=0;E<b.length;++E)x=b[E],x.id==g&&(v=x);for(g=parse_TSP_Reference(parse_shallow(v.messages[0].data)[2][0].data),_=CFB.find(u,c[g].location),b=parse_iwa_file(decompress_iwa_file(_.content)),E=0;E<b.length;++E)x=b[E],x.id==g&&(v=x);var w=parse_shallow(v.messages[0].data);{w[6][0].data=write_varint49(s.e.r+1),w[7][0].data=write_varint49(s.e.c+1);var R=parse_TSP_Reference(w[46][0].data),N=CFB.find(u,c[R].location),M=parse_iwa_file(decompress_iwa_file(N.content));{for(var A=0;A<M.length&&M[A].id!=R;++A);if(M[A].id!=R)throw"Bad ColumnRowUIDMapArchive";var I=parse_shallow(M[A].messages[0].data);I[1]=[],I[2]=[],I[3]=[];for(var y=0;y<=s.e.c;++y){var j=[];j[1]=j[2]=[{type:0,data:write_varint49(y+420690)}],I[1].push({type:2,data:write_shallow(j)}),I[2].push({type:0,data:write_varint49(y)}),I[3].push({type:0,data:write_varint49(y)})}I[4]=[],I[5]=[],I[6]=[];for(var T=0;T<=s.e.r;++T)j=[],j[1]=j[2]=[{type:0,data:write_varint49(T+726270)}],I[4].push({type:2,data:write_shallow(j)}),I[5].push({type:0,data:write_varint49(T)}),I[6].push({type:0,data:write_varint49(T)});M[A].messages[0].data=write_shallow(I)}N.content=compress_iwa_file(write_iwa_file(M)),N.size=N.content.length,delete w[46];var U=parse_shallow(w[4][0].data);{U[7][0].data=write_varint49(s.e.r+1);var F=parse_shallow(U[1][0].data),H=parse_TSP_Reference(F[2][0].data);N=CFB.find(u,c[H].location),M=parse_iwa_file(decompress_iwa_file(N.content));{if(M[0].id!=H)throw"Bad HeaderStorageBucket";var z=parse_shallow(M[0].messages[0].data);for(T=0;T<i.length;++T){var de=parse_shallow(z[2][0].data);de[1][0].data=write_varint49(T),de[4][0].data=write_varint49(i[T].length),z[2][T]={type:z[2][0].type,data:write_shallow(de)}}M[0].messages[0].data=write_shallow(z)}N.content=compress_iwa_file(write_iwa_file(M)),N.size=N.content.length;var se=parse_TSP_Reference(U[2][0].data);N=CFB.find(u,c[se].location),M=parse_iwa_file(decompress_iwa_file(N.content));{if(M[0].id!=se)throw"Bad HeaderStorageBucket";for(z=parse_shallow(M[0].messages[0].data),y=0;y<=s.e.c;++y)de=parse_shallow(z[2][0].data),de[1][0].data=write_varint49(y),de[4][0].data=write_varint49(s.e.r+1),z[2][y]={type:z[2][0].type,data:write_shallow(de)};M[0].messages[0].data=write_shallow(z)}N.content=compress_iwa_file(write_iwa_file(M)),N.size=N.content.length;var ue=parse_TSP_Reference(U[4][0].data);(function(){for(var S=CFB.find(u,c[ue].location),C=parse_iwa_file(decompress_iwa_file(S.content)),P,D=0;D<C.length;++D){var B=C[D];B.id==ue&&(P=B)}var G=parse_shallow(P.messages[0].data);{G[3]=[];var J=[];o.forEach(function(Ee,Re){J[1]=[{type:0,data:write_varint49(Re)}],J[2]=[{type:0,data:write_varint49(1)}],J[3]=[{type:2,data:stru8(Ee)}],G[3].push({type:2,data:write_shallow(J)})})}P.messages[0].data=write_shallow(G);var Y=write_iwa_file(C),me=compress_iwa_file(Y);S.content=me,S.size=S.content.length})();var Z=parse_shallow(U[3][0].data);{var ge=Z[1][0];delete Z[2];var re=parse_shallow(ge.data);{var oe=parse_TSP_Reference(re[2][0].data);(function(){for(var S=CFB.find(u,c[oe].location),C=parse_iwa_file(decompress_iwa_file(S.content)),P,D=0;D<C.length;++D){var B=C[D];B.id==oe&&(P=B)}var G=parse_shallow(P.messages[0].data);{delete G[6],delete Z[7];var J=new Uint8Array(G[5][0].data);G[5]=[];for(var Y=0,me=0;me<=s.e.r;++me){var Ee=parse_shallow(J);Y+=write_tile_row(Ee,i[me],o),Ee[1][0].data=write_varint49(me),G[5].push({data:write_shallow(Ee),type:2})}G[1]=[{type:0,data:write_varint49(s.e.c+1)}],G[2]=[{type:0,data:write_varint49(s.e.r+1)}],G[3]=[{type:0,data:write_varint49(Y)}],G[4]=[{type:0,data:write_varint49(s.e.r+1)}]}P.messages[0].data=write_shallow(G);var Re=write_iwa_file(C),Ne=compress_iwa_file(Re);S.content=Ne,S.size=S.content.length})()}ge.data=write_shallow(re)}U[3][0].data=write_shallow(Z)}w[4][0].data=write_shallow(U)}v.messages[0].data=write_shallow(w);var be=write_iwa_file(b),L=compress_iwa_file(be);return _.content=L,_.size=_.content.length,u}function fix_opts_func(t){return function(e){for(var s=0;s!=t.length;++s){var a=t[s];e[a[0]]===void 0&&(e[a[0]]=a[1]),a[2]==="n"&&(e[a[0]]=Number(e[a[0]]))}}}function fix_write_opts(t){fix_opts_func([["cellDates",!1],["bookSST",!1],["bookType","xlsx"],["compression",!1],["WTF",!1]])(t)}function write_zip(t,r){return r.bookType=="ods"?write_ods(t,r):r.bookType=="numbers"?write_numbers_iwa(t,r):r.bookType=="xlsb"?write_zip_xlsxb(t,r):write_zip_xlsx(t,r)}function write_zip_xlsxb(t,r){_shapeid=1024,t&&!t.SSF&&(t.SSF=dup(table_fmt)),t&&t.SSF&&(make_ssf(),SSF_load_table(t.SSF),r.revssf=evert_num(t.SSF),r.revssf[t.SSF[65535]]=0,r.ssf=t.SSF),r.rels={},r.wbrels={},r.Strings=[],r.Strings.Count=0,r.Strings.Unique=0,browser_has_Map?r.revStrings=new Map:(r.revStrings={},r.revStrings.foo=[],delete r.revStrings.foo);var e=r.bookType=="xlsb"?"bin":"xml",s=VBAFMTS.indexOf(r.bookType)>-1,a=new_ct();fix_write_opts(r=r||{});var i=zip_new(),o="",c=0;if(r.cellXfs=[],get_cell_style(r.cellXfs,{},{revssf:{General:0}}),t.Props||(t.Props={}),o="docProps/core.xml",zip_add_file(i,o,write_core_props(t.Props,r)),a.coreprops.push(o),add_rels(r.rels,2,o,RELS.CORE_PROPS),o="docProps/app.xml",!(t.Props&&t.Props.SheetNames))if(!t.Workbook||!t.Workbook.Sheets)t.Props.SheetNames=t.SheetNames;else{for(var h=[],u=0;u<t.SheetNames.length;++u)(t.Workbook.Sheets[u]||{}).Hidden!=2&&h.push(t.SheetNames[u]);t.Props.SheetNames=h}for(t.Props.Worksheets=t.Props.SheetNames.length,zip_add_file(i,o,write_ext_props(t.Props)),a.extprops.push(o),add_rels(r.rels,3,o,RELS.EXT_PROPS),t.Custprops!==t.Props&&keys(t.Custprops||{}).length>0&&(o="docProps/custom.xml",zip_add_file(i,o,write_cust_props(t.Custprops)),a.custprops.push(o),add_rels(r.rels,4,o,RELS.CUST_PROPS)),c=1;c<=t.SheetNames.length;++c){var d={"!id":{}},_=t.Sheets[t.SheetNames[c-1]],b=(_||{})["!type"]||"sheet";switch(b){case"chart":default:o="xl/worksheets/sheet"+c+"."+e,zip_add_file(i,o,write_ws(c-1,o,r,t,d)),a.sheets.push(o),add_rels(r.wbrels,-1,"worksheets/sheet"+c+"."+e,RELS.WS[0])}if(_){var v=_["!comments"],E=!1,x="";v&&v.length>0&&(x="xl/comments"+c+"."+e,zip_add_file(i,x,write_cmnt(v,x)),a.comments.push(x),add_rels(d,-1,"../comments"+c+"."+e,RELS.CMNT),E=!0),_["!legacy"]&&E&&zip_add_file(i,"xl/drawings/vmlDrawing"+c+".vml",write_comments_vml(c,_["!comments"])),delete _["!comments"],delete _["!legacy"]}d["!id"].rId1&&zip_add_file(i,get_rels_path(o),write_rels(d))}return r.Strings!=null&&r.Strings.length>0&&(o="xl/sharedStrings."+e,zip_add_file(i,o,write_sst(r.Strings,o,r)),a.strs.push(o),add_rels(r.wbrels,-1,"sharedStrings."+e,RELS.SST)),o="xl/workbook."+e,zip_add_file(i,o,write_wb(t,o)),a.workbooks.push(o),add_rels(r.rels,1,o,RELS.WB),o="xl/theme/theme1.xml",zip_add_file(i,o,write_theme(t.Themes,r)),a.themes.push(o),add_rels(r.wbrels,-1,"theme/theme1.xml",RELS.THEME),o="xl/styles."+e,zip_add_file(i,o,write_sty(t,o,r)),a.styles.push(o),add_rels(r.wbrels,-1,"styles."+e,RELS.STY),t.vbaraw&&s&&(o="xl/vbaProject.bin",zip_add_file(i,o,t.vbaraw),a.vba.push(o),add_rels(r.wbrels,-1,"vbaProject.bin",RELS.VBA)),o="xl/metadata."+e,zip_add_file(i,o,write_xlmeta(o)),a.metadata.push(o),add_rels(r.wbrels,-1,"metadata."+e,RELS.XLMETA),zip_add_file(i,"[Content_Types].xml",write_ct(a,r)),zip_add_file(i,"_rels/.rels",write_rels(r.rels)),zip_add_file(i,"xl/_rels/workbook."+e+".rels",write_rels(r.wbrels)),delete r.revssf,delete r.ssf,i}function write_zip_xlsx(t,r){_shapeid=1024,t&&!t.SSF&&(t.SSF=dup(table_fmt)),t&&t.SSF&&(make_ssf(),SSF_load_table(t.SSF),r.revssf=evert_num(t.SSF),r.revssf[t.SSF[65535]]=0,r.ssf=t.SSF),r.rels={},r.wbrels={},r.Strings=[],r.Strings.Count=0,r.Strings.Unique=0,browser_has_Map?r.revStrings=new Map:(r.revStrings={},r.revStrings.foo=[],delete r.revStrings.foo);var e="xml",s=VBAFMTS.indexOf(r.bookType)>-1,a=new_ct();fix_write_opts(r=r||{});var i=zip_new(),o="",c=0;if(r.cellXfs=[],get_cell_style(r.cellXfs,{},{revssf:{General:0}}),t.Props||(t.Props={}),o="docProps/core.xml",zip_add_file(i,o,write_core_props(t.Props,r)),a.coreprops.push(o),add_rels(r.rels,2,o,RELS.CORE_PROPS),o="docProps/app.xml",!(t.Props&&t.Props.SheetNames))if(!t.Workbook||!t.Workbook.Sheets)t.Props.SheetNames=t.SheetNames;else{for(var h=[],u=0;u<t.SheetNames.length;++u)(t.Workbook.Sheets[u]||{}).Hidden!=2&&h.push(t.SheetNames[u]);t.Props.SheetNames=h}t.Props.Worksheets=t.Props.SheetNames.length,zip_add_file(i,o,write_ext_props(t.Props)),a.extprops.push(o),add_rels(r.rels,3,o,RELS.EXT_PROPS),t.Custprops!==t.Props&&keys(t.Custprops||{}).length>0&&(o="docProps/custom.xml",zip_add_file(i,o,write_cust_props(t.Custprops)),a.custprops.push(o),add_rels(r.rels,4,o,RELS.CUST_PROPS));var d=["SheetJ5"];for(r.tcid=0,c=1;c<=t.SheetNames.length;++c){var _={"!id":{}},b=t.Sheets[t.SheetNames[c-1]],v=(b||{})["!type"]||"sheet";switch(v){case"chart":default:o="xl/worksheets/sheet"+c+"."+e,zip_add_file(i,o,write_ws_xml(c-1,r,t,_)),a.sheets.push(o),add_rels(r.wbrels,-1,"worksheets/sheet"+c+"."+e,RELS.WS[0])}if(b){var E=b["!comments"],x=!1,g="";if(E&&E.length>0){var w=!1;E.forEach(function(R){R[1].forEach(function(N){N.T==!0&&(w=!0)})}),w&&(g="xl/threadedComments/threadedComment"+c+"."+e,zip_add_file(i,g,write_tcmnt_xml(E,d,r)),a.threadedcomments.push(g),add_rels(_,-1,"../threadedComments/threadedComment"+c+"."+e,RELS.TCMNT)),g="xl/comments"+c+"."+e,zip_add_file(i,g,write_comments_xml(E)),a.comments.push(g),add_rels(_,-1,"../comments"+c+"."+e,RELS.CMNT),x=!0}b["!legacy"]&&x&&zip_add_file(i,"xl/drawings/vmlDrawing"+c+".vml",write_comments_vml(c,b["!comments"])),delete b["!comments"],delete b["!legacy"]}_["!id"].rId1&&zip_add_file(i,get_rels_path(o),write_rels(_))}return r.Strings!=null&&r.Strings.length>0&&(o="xl/sharedStrings."+e,zip_add_file(i,o,write_sst_xml(r.Strings,r)),a.strs.push(o),add_rels(r.wbrels,-1,"sharedStrings."+e,RELS.SST)),o="xl/workbook."+e,zip_add_file(i,o,write_wb_xml(t)),a.workbooks.push(o),add_rels(r.rels,1,o,RELS.WB),o="xl/theme/theme1.xml",zip_add_file(i,o,write_theme(t.Themes,r)),a.themes.push(o),add_rels(r.wbrels,-1,"theme/theme1.xml",RELS.THEME),o="xl/styles."+e,zip_add_file(i,o,write_sty_xml(t,r)),a.styles.push(o),add_rels(r.wbrels,-1,"styles."+e,RELS.STY),t.vbaraw&&s&&(o="xl/vbaProject.bin",zip_add_file(i,o,t.vbaraw),a.vba.push(o),add_rels(r.wbrels,-1,"vbaProject.bin",RELS.VBA)),o="xl/metadata."+e,zip_add_file(i,o,write_xlmeta_xml()),a.metadata.push(o),add_rels(r.wbrels,-1,"metadata."+e,RELS.XLMETA),d.length>1&&(o="xl/persons/person.xml",zip_add_file(i,o,write_people_xml(d)),a.people.push(o),add_rels(r.wbrels,-1,"persons/person.xml",RELS.PEOPLE)),zip_add_file(i,"[Content_Types].xml",write_ct(a,r)),zip_add_file(i,"_rels/.rels",write_rels(r.rels)),zip_add_file(i,"xl/_rels/workbook."+e+".rels",write_rels(r.wbrels)),delete r.revssf,delete r.ssf,i}function firstbyte(t,r){var e="";switch((r||{}).type||"base64"){case"buffer":return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]];case"base64":e=Base64_decode(t.slice(0,12));break;case"binary":e=t;break;case"array":return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]];default:throw new Error("Unrecognized type "+(r&&r.type||"undefined"))}return[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3),e.charCodeAt(4),e.charCodeAt(5),e.charCodeAt(6),e.charCodeAt(7)]}function write_cfb_ctr(t,r){switch(r.type){case"base64":case"binary":break;case"buffer":case"array":r.type="";break;case"file":return write_dl(r.file,CFB.write(t,{type:has_buf?"buffer":""}));case"string":throw new Error("'string' output type invalid for '"+r.bookType+"' files");default:throw new Error("Unrecognized type "+r.type)}return CFB.write(t,r)}function write_zip_type(t,r){var e=dup(r||{}),s=write_zip(t,e);return write_zip_denouement(s,e)}function write_zip_denouement(t,r){var e={},s=has_buf?"nodebuffer":typeof Uint8Array<"u"?"array":"string";if(r.compression&&(e.compression="DEFLATE"),r.password)e.type=s;else switch(r.type){case"base64":e.type="base64";break;case"binary":e.type="string";break;case"string":throw new Error("'string' output type invalid for '"+r.bookType+"' files");case"buffer":case"file":e.type=s;break;default:throw new Error("Unrecognized type "+r.type)}var a=t.FullPaths?CFB.write(t,{fileType:"zip",type:{nodebuffer:"buffer",string:"binary"}[e.type]||e.type,compression:!!r.compression}):t.generate(e);if(typeof Deno<"u"&&typeof a=="string"){if(r.type=="binary"||r.type=="base64")return a;a=new Uint8Array(s2ab(a))}return r.password&&typeof encrypt_agile<"u"?write_cfb_ctr(encrypt_agile(a,r.password),r):r.type==="file"?write_dl(r.file,a):r.type=="string"?utf8read(a):a}function write_cfb_type(t,r){var e=r||{},s=write_xlscfb(t,e);return write_cfb_ctr(s,e)}function write_string_type(t,r,e){e||(e="");var s=e+t;switch(r.type){case"base64":return Base64_encode(utf8write(s));case"binary":return utf8write(s);case"string":return t;case"file":return write_dl(r.file,s,"utf8");case"buffer":return has_buf?Buffer_from(s,"utf8"):typeof TextEncoder<"u"?new TextEncoder().encode(s):write_string_type(s,{type:"binary"}).split("").map(function(a){return a.charCodeAt(0)})}throw new Error("Unrecognized type "+r.type)}function write_stxt_type(t,r){switch(r.type){case"base64":return Base64_encode(t);case"binary":return t;case"string":return t;case"file":return write_dl(r.file,t,"binary");case"buffer":return has_buf?Buffer_from(t,"binary"):t.split("").map(function(e){return e.charCodeAt(0)})}throw new Error("Unrecognized type "+r.type)}function write_binary_type(t,r){switch(r.type){case"string":case"base64":case"binary":for(var e="",s=0;s<t.length;++s)e+=String.fromCharCode(t[s]);return r.type=="base64"?Base64_encode(e):r.type=="string"?utf8read(e):e;case"file":return write_dl(r.file,t);case"buffer":return t;default:throw new Error("Unrecognized type "+r.type)}}function writeSync(t,r){reset_cp(),check_wb(t);var e=dup(r||{});if(e.cellStyles&&(e.cellNF=!0,e.sheetStubs=!0),e.type=="array"){e.type="binary";var s=writeSync(t,e);return e.type="array",s2ab(s)}var a=0;if(e.sheet&&(typeof e.sheet=="number"?a=e.sheet:a=t.SheetNames.indexOf(e.sheet),!t.SheetNames[a]))throw new Error("Sheet not found: "+e.sheet+" : "+typeof e.sheet);switch(e.bookType||"xlsb"){case"xml":case"xlml":return write_string_type(write_xlml(t,e),e);case"slk":case"sylk":return write_string_type(SYLK.from_sheet(t.Sheets[t.SheetNames[a]],e),e);case"htm":case"html":return write_string_type(sheet_to_html(t.Sheets[t.SheetNames[a]],e),e);case"txt":return write_stxt_type(sheet_to_txt(t.Sheets[t.SheetNames[a]],e),e);case"csv":return write_string_type(sheet_to_csv(t.Sheets[t.SheetNames[a]],e),e,"\uFEFF");case"dif":return write_string_type(DIF.from_sheet(t.Sheets[t.SheetNames[a]],e),e);case"dbf":return write_binary_type(DBF.from_sheet(t.Sheets[t.SheetNames[a]],e),e);case"prn":return write_string_type(PRN.from_sheet(t.Sheets[t.SheetNames[a]],e),e);case"rtf":return write_string_type(RTF.from_sheet(t.Sheets[t.SheetNames[a]],e),e);case"eth":return write_string_type(ETH.from_sheet(t.Sheets[t.SheetNames[a]],e),e);case"fods":return write_string_type(write_ods(t,e),e);case"wk1":return write_binary_type(WK_.sheet_to_wk1(t.Sheets[t.SheetNames[a]],e),e);case"wk3":return write_binary_type(WK_.book_to_wk3(t,e),e);case"biff2":e.biff||(e.biff=2);case"biff3":e.biff||(e.biff=3);case"biff4":return e.biff||(e.biff=4),write_binary_type(write_biff_buf(t,e),e);case"biff5":e.biff||(e.biff=5);case"biff8":case"xla":case"xls":return e.biff||(e.biff=8),write_cfb_type(t,e);case"xlsx":case"xlsm":case"xlam":case"xlsb":case"numbers":case"ods":return write_zip_type(t,e);default:throw new Error("Unrecognized bookType |"+e.bookType+"|")}}function make_json_row(t,r,e,s,a,i,o,c){var h=encode_row(e),u=c.defval,d=c.raw||!Object.prototype.hasOwnProperty.call(c,"raw"),_=!0,b=a===1?[]:{};if(a!==1)if(Object.defineProperty)try{Object.defineProperty(b,"__rowNum__",{value:e,enumerable:!1})}catch{b.__rowNum__=e}else b.__rowNum__=e;if(!o||t[e])for(var v=r.s.c;v<=r.e.c;++v){var E=o?t[e][v]:t[s[v]+h];if(E===void 0||E.t===void 0){if(u===void 0)continue;i[v]!=null&&(b[i[v]]=u);continue}var x=E.v;switch(E.t){case"z":if(x==null)break;continue;case"e":x=x==0?null:void 0;break;case"s":case"d":case"b":case"n":break;default:throw new Error("unrecognized type "+E.t)}if(i[v]!=null){if(x==null)if(E.t=="e"&&x===null)b[i[v]]=null;else if(u!==void 0)b[i[v]]=u;else if(d&&x===null)b[i[v]]=null;else continue;else b[i[v]]=d&&(E.t!=="n"||E.t==="n"&&c.rawNumbers!==!1)?x:format_cell(E,x,c);x!=null&&(_=!1)}}return{row:b,isempty:_}}function sheet_to_json(t,r){if(t==null||t["!ref"]==null)return[];var e={t:"n",v:0},s=0,a=1,i=[],o=0,c="",h={s:{r:0,c:0},e:{r:0,c:0}},u=r||{},d=u.range!=null?u.range:t["!ref"];switch(u.header===1?s=1:u.header==="A"?s=2:Array.isArray(u.header)?s=3:u.header==null&&(s=0),typeof d){case"string":h=safe_decode_range(d);break;case"number":h=safe_decode_range(t["!ref"]),h.s.r=d;break;default:h=d}s>0&&(a=0);var _=encode_row(h.s.r),b=[],v=[],E=0,x=0,g=Array.isArray(t),w=h.s.r,R=0,N={};g&&!t[w]&&(t[w]=[]);var M=u.skipHidden&&t["!cols"]||[],A=u.skipHidden&&t["!rows"]||[];for(R=h.s.c;R<=h.e.c;++R)if(!(M[R]||{}).hidden)switch(b[R]=encode_col(R),e=g?t[w][R]:t[b[R]+_],s){case 1:i[R]=R-h.s.c;break;case 2:i[R]=b[R];break;case 3:i[R]=u.header[R-h.s.c];break;default:if(e==null&&(e={w:"__EMPTY",t:"s"}),c=o=format_cell(e,null,u),x=N[o]||0,!x)N[o]=1;else{do c=o+"_"+x++;while(N[c]);N[o]=x,N[c]=1}i[R]=c}for(w=h.s.r+a;w<=h.e.r;++w)if(!(A[w]||{}).hidden){var I=make_json_row(t,h,w,b,s,i,g,u);(I.isempty===!1||(s===1?u.blankrows!==!1:u.blankrows))&&(v[E++]=I.row)}return v.length=E,v}var qreg=/"/g;function make_csv_row(t,r,e,s,a,i,o,c){for(var h=!0,u=[],d="",_=encode_row(e),b=r.s.c;b<=r.e.c;++b)if(s[b]){var v=c.dense?(t[e]||[])[b]:t[s[b]+_];if(v==null)d="";else if(v.v!=null){h=!1,d=""+(c.rawNumbers&&v.t=="n"?v.v:format_cell(v,null,c));for(var E=0,x=0;E!==d.length;++E)if((x=d.charCodeAt(E))===a||x===i||x===34||c.forceQuotes){d='"'+d.replace(qreg,'""')+'"';break}d=="ID"&&(d='"ID"')}else v.f!=null&&!v.F?(h=!1,d="="+v.f,d.indexOf(",")>=0&&(d='"'+d.replace(qreg,'""')+'"')):d="";u.push(d)}return c.blankrows===!1&&h?null:u.join(o)}function sheet_to_csv(t,r){var e=[],s=r??{};if(t==null||t["!ref"]==null)return"";var a=safe_decode_range(t["!ref"]),i=s.FS!==void 0?s.FS:",",o=i.charCodeAt(0),c=s.RS!==void 0?s.RS:`
`,h=c.charCodeAt(0),u=new RegExp((i=="|"?"\\|":i)+"+$"),d="",_=[];s.dense=Array.isArray(t);for(var b=s.skipHidden&&t["!cols"]||[],v=s.skipHidden&&t["!rows"]||[],E=a.s.c;E<=a.e.c;++E)(b[E]||{}).hidden||(_[E]=encode_col(E));for(var x=0,g=a.s.r;g<=a.e.r;++g)(v[g]||{}).hidden||(d=make_csv_row(t,a,g,_,o,h,i,s),d!=null&&(s.strip&&(d=d.replace(u,"")),(d||s.blankrows!==!1)&&e.push((x++?c:"")+d)));return delete s.dense,e.join("")}function sheet_to_txt(t,r){r||(r={}),r.FS="	",r.RS=`
`;var e=sheet_to_csv(t,r);return e}function sheet_to_formulae(t){var r="",e,s="";if(t==null||t["!ref"]==null)return[];var a=safe_decode_range(t["!ref"]),i="",o=[],c,h=[],u=Array.isArray(t);for(c=a.s.c;c<=a.e.c;++c)o[c]=encode_col(c);for(var d=a.s.r;d<=a.e.r;++d)for(i=encode_row(d),c=a.s.c;c<=a.e.c;++c)if(r=o[c]+i,e=u?(t[d]||[])[c]:t[r],s="",e!==void 0){if(e.F!=null){if(r=e.F,!e.f)continue;s=e.f,r.indexOf(":")==-1&&(r=r+":"+r)}if(e.f!=null)s=e.f;else{if(e.t=="z")continue;if(e.t=="n"&&e.v!=null)s=""+e.v;else if(e.t=="b")s=e.v?"TRUE":"FALSE";else if(e.w!==void 0)s="'"+e.w;else{if(e.v===void 0)continue;e.t=="s"?s="'"+e.v:s=""+e.v}}h[h.length]=r+"="+s}return h}function sheet_add_json(t,r,e){var s=e||{},a=+!s.skipHeader,i=t||{},o=0,c=0;if(i&&s.origin!=null)if(typeof s.origin=="number")o=s.origin;else{var h=typeof s.origin=="string"?decode_cell(s.origin):s.origin;o=h.r,c=h.c}var u,d={s:{c:0,r:0},e:{c,r:o+r.length-1+a}};if(i["!ref"]){var _=safe_decode_range(i["!ref"]);d.e.c=Math.max(d.e.c,_.e.c),d.e.r=Math.max(d.e.r,_.e.r),o==-1&&(o=_.e.r+1,d.e.r=o+r.length-1+a)}else o==-1&&(o=0,d.e.r=r.length-1+a);var b=s.header||[],v=0;r.forEach(function(x,g){keys(x).forEach(function(w){(v=b.indexOf(w))==-1&&(b[v=b.length]=w);var R=x[w],N="z",M="",A=encode_cell({c:c+v,r:o+g+a});u=ws_get_cell_stub(i,A),R&&typeof R=="object"&&!(R instanceof Date)?i[A]=R:(typeof R=="number"?N="n":typeof R=="boolean"?N="b":typeof R=="string"?N="s":R instanceof Date?(N="d",s.cellDates||(N="n",R=datenum(R)),M=s.dateNF||table_fmt[14]):R===null&&s.nullError&&(N="e",R=0),u?(u.t=N,u.v=R,delete u.w,delete u.R,M&&(u.z=M)):i[A]=u={t:N,v:R},M&&(u.z=M))})}),d.e.c=Math.max(d.e.c,c+b.length-1);var E=encode_row(o);if(a)for(v=0;v<b.length;++v)i[encode_col(v+c)+E]={t:"s",v:b[v]};return i["!ref"]=encode_range(d),i}function json_to_sheet(t,r){return sheet_add_json(null,t,r)}function ws_get_cell_stub(t,r,e){if(typeof r=="string"){if(Array.isArray(t)){var s=decode_cell(r);return t[s.r]||(t[s.r]=[]),t[s.r][s.c]||(t[s.r][s.c]={t:"z"})}return t[r]||(t[r]={t:"z"})}return typeof r!="number"?ws_get_cell_stub(t,encode_cell(r)):ws_get_cell_stub(t,encode_cell({r,c:e||0}))}function wb_sheet_idx(t,r){if(typeof r=="number"){if(r>=0&&t.SheetNames.length>r)return r;throw new Error("Cannot find sheet # "+r)}else if(typeof r=="string"){var e=t.SheetNames.indexOf(r);if(e>-1)return e;throw new Error("Cannot find sheet name |"+r+"|")}else throw new Error("Cannot find sheet |"+r+"|")}function book_new(){return{SheetNames:[],Sheets:{}}}function book_append_sheet(t,r,e,s){var a=1;if(!e)for(;a<=65535&&t.SheetNames.indexOf(e="Sheet"+a)!=-1;++a,e=void 0);if(!e||t.SheetNames.length>=65535)throw new Error("Too many worksheets");if(s&&t.SheetNames.indexOf(e)>=0){var i=e.match(/(^.*?)(\d+)$/);a=i&&+i[2]||0;var o=i&&i[1]||e;for(++a;a<=65535&&t.SheetNames.indexOf(e=o+a)!=-1;++a);}if(check_ws_name(e),t.SheetNames.indexOf(e)>=0)throw new Error("Worksheet with name |"+e+"| already exists!");return t.SheetNames.push(e),t.Sheets[e]=r,e}function book_set_sheet_visibility(t,r,e){t.Workbook||(t.Workbook={}),t.Workbook.Sheets||(t.Workbook.Sheets=[]);var s=wb_sheet_idx(t,r);switch(t.Workbook.Sheets[s]||(t.Workbook.Sheets[s]={}),e){case 0:case 1:case 2:break;default:throw new Error("Bad sheet visibility setting "+e)}t.Workbook.Sheets[s].Hidden=e}function cell_set_number_format(t,r){return t.z=r,t}function cell_set_hyperlink(t,r,e){return r?(t.l={Target:r},e&&(t.l.Tooltip=e)):delete t.l,t}function cell_set_internal_link(t,r,e){return cell_set_hyperlink(t,"#"+r,e)}function cell_add_comment(t,r,e){t.c||(t.c=[]),t.c.push({t:r,a:e||"SheetJS"})}function sheet_set_array_formula(t,r,e,s){for(var a=typeof r!="string"?r:safe_decode_range(r),i=typeof r=="string"?r:encode_range(r),o=a.s.r;o<=a.e.r;++o)for(var c=a.s.c;c<=a.e.c;++c){var h=ws_get_cell_stub(t,o,c);h.t="n",h.F=i,delete h.v,o==a.s.r&&c==a.s.c&&(h.f=e,s&&(h.D=!0))}return t}var utils={encode_col,encode_row,encode_cell,encode_range,decode_col,decode_row,split_cell,decode_cell,decode_range,format_cell,sheet_add_aoa,sheet_add_json,sheet_add_dom,aoa_to_sheet,json_to_sheet,table_to_sheet:parse_dom_table,table_to_book,sheet_to_csv,sheet_to_txt,sheet_to_json,sheet_to_html,sheet_to_formulae,sheet_to_row_object_array:sheet_to_json,sheet_get_cell:ws_get_cell_stub,book_new,book_append_sheet,book_set_sheet_visibility,cell_set_number_format,cell_set_hyperlink,cell_set_internal_link,cell_add_comment,sheet_set_array_formula,consts:{SHEET_VISIBLE:0,SHEET_HIDDEN:1,SHEET_VERY_HIDDEN:2}},pdf={exports:{}};const __viteBrowserExternal={},__viteBrowserExternal$1=Object.freeze(Object.defineProperty({__proto__:null,default:__viteBrowserExternal},Symbol.toStringTag,{value:"Module"})),require$$6=getAugmentedNamespace(__viteBrowserExternal$1);var path2dPolyfill_esm={},hasRequiredPath2dPolyfill_esm;function requirePath2dPolyfill_esm(){if(hasRequiredPath2dPolyfill_esm)return path2dPolyfill_esm;hasRequiredPath2dPolyfill_esm=1;function t(E,x,g){for(var w=0,R=x.length,N;w<R;w++)(N||!(w in x))&&(N||(N=Array.prototype.slice.call(x,0,w)),N[w]=x[w]);return E.concat(N||Array.prototype.slice.call(x))}var r={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},e=/([astvzqmhlc])([^astvzqmhlc]*)/gi,s=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/gi;function a(E){var x=E.match(s);return x?x.map(Number):[]}function i(E){var x=[],g=String(E).trim();return g[0]!=="M"&&g[0]!=="m"||g.replace(e,function(w,R,N){var M=a(N),A=R.toLowerCase(),I=R;if(A==="m"&&M.length>2&&(x.push(t([I],M.splice(0,2))),A="l",I=I==="m"?"l":"L"),M.length<r[A])return"";for(x.push(t([I],M.splice(0,r[A])));M.length>=r[A]&&M.length&&r[A];)x.push(t([I],M.splice(0,r[A])));return""}),x}function o(E,x){var g=E.x*Math.cos(x)-E.y*Math.sin(x),w=E.y*Math.cos(x)+E.x*Math.sin(x);E.x=g,E.y=w}function c(E,x,g){E.x+=x,E.y+=g}function h(E,x){E.x*=x,E.y*=x}var u=function(){function E(x){var g;this.commands=[],x&&x instanceof E?(g=this.commands).push.apply(g,x.commands):x&&(this.commands=i(x))}return E.prototype.addPath=function(x){var g;x&&x instanceof E&&(g=this.commands).push.apply(g,x.commands)},E.prototype.moveTo=function(x,g){this.commands.push(["M",x,g])},E.prototype.lineTo=function(x,g){this.commands.push(["L",x,g])},E.prototype.arc=function(x,g,w,R,N,M){this.commands.push(["AC",x,g,w,R,N,!!M])},E.prototype.arcTo=function(x,g,w,R,N){this.commands.push(["AT",x,g,w,R,N])},E.prototype.ellipse=function(x,g,w,R,N,M,A,I){this.commands.push(["E",x,g,w,R,N,M,A,!!I])},E.prototype.closePath=function(){this.commands.push(["Z"])},E.prototype.bezierCurveTo=function(x,g,w,R,N,M){this.commands.push(["C",x,g,w,R,N,M])},E.prototype.quadraticCurveTo=function(x,g,w,R){this.commands.push(["Q",x,g,w,R])},E.prototype.rect=function(x,g,w,R){this.commands.push(["R",x,g,w,R])},E.prototype.roundRect=function(x,g,w,R,N){typeof N>"u"?this.commands.push(["RR",x,g,w,R,0]):this.commands.push(["RR",x,g,w,R,N])},E}();function d(E,x){var g=0,w=0,R,N,M,A,I,y,j,T,U,F,H,z,de,se,ue,Z,ge,re,oe,be,L,S=null,C=null,P=null,D=null,B=null,G=null;E.beginPath();for(var J=0;J<x.length;++J){re=x[J][0],re!=="S"&&re!=="s"&&re!=="C"&&re!=="c"&&(S=null,C=null),re!=="T"&&re!=="t"&&re!=="Q"&&re!=="q"&&(P=null,D=null);var Y=void 0;switch(re){case"m":case"M":Y=x[J],re==="m"?(g+=Y[1],w+=Y[2]):(g=Y[1],w=Y[2]),(re==="M"||!B)&&(B={x:g,y:w}),E.moveTo(g,w);break;case"l":Y=x[J],g+=Y[1],w+=Y[2],E.lineTo(g,w);break;case"L":Y=x[J],g=Y[1],w=Y[2],E.lineTo(g,w);break;case"H":Y=x[J],g=Y[1],E.lineTo(g,w);break;case"h":Y=x[J],g+=Y[1],E.lineTo(g,w);break;case"V":Y=x[J],w=Y[1],E.lineTo(g,w);break;case"v":Y=x[J],w+=Y[1],E.lineTo(g,w);break;case"a":case"A":if(Y=x[J],G===null)throw new Error("This should never happen");re==="a"?(g+=Y[6],w+=Y[7]):(g=Y[6],w=Y[7]),se=Y[1],ue=Y[2],j=Y[3]*Math.PI/180,M=!!Y[4],A=!!Y[5],I={x:g,y:w},y={x:(G.x-I.x)/2,y:(G.y-I.y)/2},o(y,-j),T=y.x*y.x/(se*se)+y.y*y.y/(ue*ue),T>1&&(T=Math.sqrt(T),se*=T,ue*=T),oe={x:se*y.y/ue,y:-(ue*y.x)/se},U=se*se*ue*ue,F=se*se*y.y*y.y+ue*ue*y.x*y.x,A!==M?h(oe,Math.sqrt((U-F)/F)||0):h(oe,-Math.sqrt((U-F)/F)||0),N=Math.atan2((y.y-oe.y)/ue,(y.x-oe.x)/se),R=Math.atan2(-(y.y+oe.y)/ue,-(y.x+oe.x)/se),o(oe,j),c(oe,(I.x+G.x)/2,(I.y+G.y)/2),E.save(),E.translate(oe.x,oe.y),E.rotate(j),E.scale(se,ue),E.arc(0,0,1,N,R,!A),E.restore();break;case"C":Y=x[J],S=Y[3],C=Y[4],g=Y[5],w=Y[6],E.bezierCurveTo(Y[1],Y[2],S,C,g,w);break;case"c":Y=x[J],E.bezierCurveTo(Y[1]+g,Y[2]+w,Y[3]+g,Y[4]+w,Y[5]+g,Y[6]+w),S=Y[3]+g,C=Y[4]+w,g+=Y[5],w+=Y[6];break;case"S":Y=x[J],(S===null||C===null)&&(S=g,C=w),E.bezierCurveTo(2*g-S,2*w-C,Y[1],Y[2],Y[3],Y[4]),S=Y[1],C=Y[2],g=Y[3],w=Y[4];break;case"s":Y=x[J],(S===null||C===null)&&(S=g,C=w),E.bezierCurveTo(2*g-S,2*w-C,Y[1]+g,Y[2]+w,Y[3]+g,Y[4]+w),S=Y[1]+g,C=Y[2]+w,g+=Y[3],w+=Y[4];break;case"Q":Y=x[J],P=Y[1],D=Y[2],g=Y[3],w=Y[4],E.quadraticCurveTo(P,D,g,w);break;case"q":Y=x[J],P=Y[1]+g,D=Y[2]+w,g+=Y[3],w+=Y[4],E.quadraticCurveTo(P,D,g,w);break;case"T":Y=x[J],(P===null||D===null)&&(P=g,D=w),P=2*g-P,D=2*w-D,g=Y[1],w=Y[2],E.quadraticCurveTo(P,D,g,w);break;case"t":Y=x[J],(P===null||D===null)&&(P=g,D=w),P=2*g-P,D=2*w-D,g+=Y[1],w+=Y[2],E.quadraticCurveTo(P,D,g,w);break;case"z":case"Z":B&&(g=B.x,w=B.y),B=null,E.closePath();break;case"AC":Y=x[J],g=Y[1],w=Y[2],de=Y[3],N=Y[4],R=Y[5],be=Y[6],E.arc(g,w,de,N,R,be);break;case"AT":Y=x[J],H=Y[1],z=Y[2],g=Y[3],w=Y[4],de=Y[5],E.arcTo(H,z,g,w,de);break;case"E":Y=x[J],g=Y[1],w=Y[2],se=Y[3],ue=Y[4],j=Y[5],N=Y[6],R=Y[7],be=Y[8],E.save(),E.translate(g,w),E.rotate(j),E.scale(se,ue),E.arc(0,0,1,N,R,be),E.restore();break;case"R":Y=x[J],g=Y[1],w=Y[2],Z=Y[3],ge=Y[4],B={x:g,y:w},E.rect(g,w,Z,ge);break;case"RR":Y=x[J],g=Y[1],w=Y[2],Z=Y[3],ge=Y[4],L=Y[5],B={x:g,y:w},E.roundRect(g,w,Z,ge,L);break}G?(G.x=g,G.y=w):G={x:g,y:w}}}function _(E){if(!(!E||!E.CanvasRenderingContext2D||E.Path2D)){var x=E.CanvasRenderingContext2D,g=x.prototype.fill,w=x.prototype.stroke,R=x.prototype.isPointInPath;x.prototype.fill=function(){for(var M=[],A=0;A<arguments.length;A++)M[A]=arguments[A];if(M[0]instanceof u){var I=M[0],y=M[1]||"nonzero";d(this,I.commands),g.apply(this,[y])}else{var y=M[0]||"nonzero";return g.apply(this,[y])}},x.prototype.stroke=function(M){M&&d(this,M.commands),w.apply(this)},x.prototype.isPointInPath=function(){for(var M=[],A=0;A<arguments.length;A++)M[A]=arguments[A];if(M[0]instanceof u){var I=M[0],y=M[1],j=M[2],T=M[3]||"nonzero";return d(this,I.commands),R.apply(this,[y,j,T])}else return R.apply(this,M)},E.Path2D=u}}function b(E,x,g,w,R){var N=this;if(R===void 0&&(R=0),typeof R=="number"&&(R=[R]),Array.isArray(R)){if(R.length===0||R.length>4)throw new RangeError("Failed to execute 'roundRect' on '".concat(this.constructor.name,"': ").concat(R.length," radii provided. Between one and four radii are necessary."));R.forEach(function(T){if(T<0)throw new RangeError("Failed to execute 'roundRect' on '".concat(N.constructor.name,"': Radius value ").concat(T," is negative."))})}else return;if(R.length===1&&R[0]===0)return this.rect(E,x,g,w);var M=Math.min(g,w)/2,A,I,y,j=A=I=y=Math.min(M,R[0]);R.length===2&&(A=y=Math.min(M,R[1])),R.length===3&&(A=y=Math.min(M,R[1]),I=Math.min(M,R[2])),R.length===4&&(A=Math.min(M,R[1]),I=Math.min(M,R[2]),y=Math.min(M,R[3])),this.moveTo(E,x+w-y),this.arcTo(E,x,E+j,x,j),this.arcTo(E+g,x,E+g,x+A,A),this.arcTo(E+g,x+w,E+g-I,x+w,I),this.arcTo(E,x+w,E,x+w-y,y),this.moveTo(E,x)}function v(E){if(!(!E||!E.CanvasRenderingContext2D)){var x=E.CanvasRenderingContext2D,g=E.Path2D;x&&!x.prototype.roundRect&&(x.prototype.roundRect=b),g&&!g.prototype.roundRect&&(g.prototype.roundRect=b)}}return _(window),v(window),path2dPolyfill_esm}(function(module,exports){(function(r,e){module.exports=r.pdfjsLib=e()})(globalThis,()=>(()=>{var __webpack_modules__=[,(t,r,e)=>{var pt;Object.defineProperty(r,"__esModule",{value:!0}),r.VerbosityLevel=r.Util=r.UnknownErrorException=r.UnexpectedResponseException=r.TextRenderingMode=r.RenderingIntentFlag=r.PromiseCapability=r.PermissionFlag=r.PasswordResponses=r.PasswordException=r.PageActionEventType=r.OPS=r.MissingPDFException=r.MAX_IMAGE_SIZE_TO_CACHE=r.LINE_FACTOR=r.LINE_DESCENT_FACTOR=r.InvalidPDFException=r.ImageKind=r.IDENTITY_MATRIX=r.FormatError=r.FeatureTest=r.FONT_IDENTITY_MATRIX=r.DocumentActionEventType=r.CMapCompressionType=r.BaseException=r.BASELINE_FACTOR=r.AnnotationType=r.AnnotationReplyType=r.AnnotationPrefix=r.AnnotationMode=r.AnnotationFlag=r.AnnotationFieldFlag=r.AnnotationEditorType=r.AnnotationEditorPrefix=r.AnnotationEditorParamsType=r.AnnotationBorderStyleType=r.AnnotationActionEventType=r.AbortException=void 0,r.assert=oe,r.bytesToString=Ee,r.createValidAbsoluteUrl=L,r.getModificationDate=ot,r.getUuid=ct,r.getVerbosityLevel=ue,r.info=Z,r.isArrayBuffer=Ge,r.isArrayEqual=Ye,r.isNodeJS=void 0,r.normalizeUnicode=nt,r.objectFromMap=pe,r.objectSize=he,r.setVerbosityLevel=se,r.shadow=S,r.string32=Ne,r.stringToBytes=Re,r.stringToPDFString=Le,r.stringToUTF8String=De,r.unreachable=re,r.utf8StringToString=_e,r.warn=ge,e(2),e(84),e(86),e(87),e(89),e(93),e(101),e(102),e(105),e(107),e(109),e(113),e(116),e(123);const s=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser");r.isNodeJS=s;const a=[1,0,0,1,0,0];r.IDENTITY_MATRIX=a;const i=[.001,0,0,.001,0,0];r.FONT_IDENTITY_MATRIX=i;const o=1e7;r.MAX_IMAGE_SIZE_TO_CACHE=o;const c=1.35;r.LINE_FACTOR=c;const h=.35;r.LINE_DESCENT_FACTOR=h;const u=h/c;r.BASELINE_FACTOR=u;const d={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,OPLIST:256};r.RenderingIntentFlag=d;const _={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3};r.AnnotationMode=_;const b="pdfjs_internal_editor_";r.AnnotationEditorPrefix=b;const v={DISABLE:-1,NONE:0,FREETEXT:3,STAMP:13,INK:15};r.AnnotationEditorType=v;const E={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23};r.AnnotationEditorParamsType=E;const x={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048};r.PermissionFlag=x;const g={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4};r.TextRenderingMode=g;const w={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3};r.ImageKind=w;const R={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};r.AnnotationType=R;const N={GROUP:"Group",REPLY:"R"};r.AnnotationReplyType=N;const M={INVISIBLE:1,HIDDEN:2,PRINT:4,NOZOOM:8,NOROTATE:16,NOVIEW:32,READONLY:64,LOCKED:128,TOGGLENOVIEW:256,LOCKEDCONTENTS:512};r.AnnotationFlag=M;const A={READONLY:1,REQUIRED:2,NOEXPORT:4,MULTILINE:4096,PASSWORD:8192,NOTOGGLETOOFF:16384,RADIO:32768,PUSHBUTTON:65536,COMBO:131072,EDIT:262144,SORT:524288,FILESELECT:1048576,MULTISELECT:2097152,DONOTSPELLCHECK:4194304,DONOTSCROLL:8388608,COMB:16777216,RICHTEXT:33554432,RADIOSINUNISON:33554432,COMMITONSELCHANGE:67108864};r.AnnotationFieldFlag=A;const I={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};r.AnnotationBorderStyleType=I;const y={E:"Mouse Enter",X:"Mouse Exit",D:"Mouse Down",U:"Mouse Up",Fo:"Focus",Bl:"Blur",PO:"PageOpen",PC:"PageClose",PV:"PageVisible",PI:"PageInvisible",K:"Keystroke",F:"Format",V:"Validate",C:"Calculate"};r.AnnotationActionEventType=y;const j={WC:"WillClose",WS:"WillSave",DS:"DidSave",WP:"WillPrint",DP:"DidPrint"};r.DocumentActionEventType=j;const T={O:"PageOpen",C:"PageClose"};r.PageActionEventType=T;const U={ERRORS:0,WARNINGS:1,INFOS:5};r.VerbosityLevel=U;const F={NONE:0,BINARY:1};r.CMapCompressionType=F;const H={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91};r.OPS=H;const z={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};r.PasswordResponses=z;let de=U.WARNINGS;function se(Xe){Number.isInteger(Xe)&&(de=Xe)}function ue(){return de}function Z(Xe){de>=U.INFOS&&console.log(`Info: ${Xe}`)}function ge(Xe){de>=U.WARNINGS&&console.log(`Warning: ${Xe}`)}function re(Xe){throw new Error(Xe)}function oe(Xe,Pe){Xe||re(Pe)}function be(Xe){switch(Xe==null?void 0:Xe.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function L(Xe){let Pe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,je=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;if(!Xe)return null;try{if(je&&typeof Xe=="string"){if(je.addDefaultProtocol&&Xe.startsWith("www.")){const ut=Xe.match(/\./g);(ut==null?void 0:ut.length)>=2&&(Xe=`http://${Xe}`)}if(je.tryConvertEncoding)try{Xe=De(Xe)}catch{}}const Qe=Pe?new URL(Xe,Pe):new URL(Xe);if(be(Qe))return Qe}catch{}return null}function S(Xe,Pe,je){let Qe=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return Object.defineProperty(Xe,Pe,{value:je,enumerable:!Qe,configurable:!0,writable:!1}),je}const C=function(){function Pe(je,Qe){this.constructor===Pe&&re("Cannot initialize BaseException."),this.message=je,this.name=Qe}return Pe.prototype=new Error,Pe.constructor=Pe,Pe}();r.BaseException=C;class P extends C{constructor(Pe,je){super(Pe,"PasswordException"),this.code=je}}r.PasswordException=P;class D extends C{constructor(Pe,je){super(Pe,"UnknownErrorException"),this.details=je}}r.UnknownErrorException=D;class B extends C{constructor(Pe){super(Pe,"InvalidPDFException")}}r.InvalidPDFException=B;class G extends C{constructor(Pe){super(Pe,"MissingPDFException")}}r.MissingPDFException=G;class J extends C{constructor(Pe,je){super(Pe,"UnexpectedResponseException"),this.status=je}}r.UnexpectedResponseException=J;class Y extends C{constructor(Pe){super(Pe,"FormatError")}}r.FormatError=Y;class me extends C{constructor(Pe){super(Pe,"AbortException")}}r.AbortException=me;function Ee(Xe){(typeof Xe!="object"||(Xe==null?void 0:Xe.length)===void 0)&&re("Invalid argument for bytesToString");const Pe=Xe.length,je=8192;if(Pe<je)return String.fromCharCode.apply(null,Xe);const Qe=[];for(let ut=0;ut<Pe;ut+=je){const K=Math.min(ut+je,Pe),ye=Xe.subarray(ut,K);Qe.push(String.fromCharCode.apply(null,ye))}return Qe.join("")}function Re(Xe){typeof Xe!="string"&&re("Invalid argument for stringToBytes");const Pe=Xe.length,je=new Uint8Array(Pe);for(let Qe=0;Qe<Pe;++Qe)je[Qe]=Xe.charCodeAt(Qe)&255;return je}function Ne(Xe){return String.fromCharCode(Xe>>24&255,Xe>>16&255,Xe>>8&255,Xe&255)}function he(Xe){return Object.keys(Xe).length}function pe(Xe){const Pe=Object.create(null);for(const[je,Qe]of Xe)Pe[je]=Qe;return Pe}function fe(){const Xe=new Uint8Array(4);return Xe[0]=1,new Uint32Array(Xe.buffer,0,1)[0]===1}function W(){try{return new Function(""),!0}catch{return!1}}class Q{static get isLittleEndian(){return S(this,"isLittleEndian",fe())}static get isEvalSupported(){return S(this,"isEvalSupported",W())}static get isOffscreenCanvasSupported(){return S(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get platform(){return typeof navigator>"u"?S(this,"platform",{isWin:!1,isMac:!1}):S(this,"platform",{isWin:navigator.platform.includes("Win"),isMac:navigator.platform.includes("Mac")})}static get isCSSRoundSupported(){var Pe,je;return S(this,"isCSSRoundSupported",(je=(Pe=globalThis.CSS)==null?void 0:Pe.supports)==null?void 0:je.call(Pe,"width: round(1.5px, 1px)"))}}r.FeatureTest=Q;const xe=[...Array(256).keys()].map(Xe=>Xe.toString(16).padStart(2,"0"));class Se{static makeHexColor(Pe,je,Qe){return`#${xe[Pe]}${xe[je]}${xe[Qe]}`}static scaleMinMax(Pe,je){let Qe;Pe[0]?(Pe[0]<0&&(Qe=je[0],je[0]=je[1],je[1]=Qe),je[0]*=Pe[0],je[1]*=Pe[0],Pe[3]<0&&(Qe=je[2],je[2]=je[3],je[3]=Qe),je[2]*=Pe[3],je[3]*=Pe[3]):(Qe=je[0],je[0]=je[2],je[2]=Qe,Qe=je[1],je[1]=je[3],je[3]=Qe,Pe[1]<0&&(Qe=je[2],je[2]=je[3],je[3]=Qe),je[2]*=Pe[1],je[3]*=Pe[1],Pe[2]<0&&(Qe=je[0],je[0]=je[1],je[1]=Qe),je[0]*=Pe[2],je[1]*=Pe[2]),je[0]+=Pe[4],je[1]+=Pe[4],je[2]+=Pe[5],je[3]+=Pe[5]}static transform(Pe,je){return[Pe[0]*je[0]+Pe[2]*je[1],Pe[1]*je[0]+Pe[3]*je[1],Pe[0]*je[2]+Pe[2]*je[3],Pe[1]*je[2]+Pe[3]*je[3],Pe[0]*je[4]+Pe[2]*je[5]+Pe[4],Pe[1]*je[4]+Pe[3]*je[5]+Pe[5]]}static applyTransform(Pe,je){const Qe=Pe[0]*je[0]+Pe[1]*je[2]+je[4],ut=Pe[0]*je[1]+Pe[1]*je[3]+je[5];return[Qe,ut]}static applyInverseTransform(Pe,je){const Qe=je[0]*je[3]-je[1]*je[2],ut=(Pe[0]*je[3]-Pe[1]*je[2]+je[2]*je[5]-je[4]*je[3])/Qe,K=(-Pe[0]*je[1]+Pe[1]*je[0]+je[4]*je[1]-je[5]*je[0])/Qe;return[ut,K]}static getAxialAlignedBoundingBox(Pe,je){const Qe=this.applyTransform(Pe,je),ut=this.applyTransform(Pe.slice(2,4),je),K=this.applyTransform([Pe[0],Pe[3]],je),ye=this.applyTransform([Pe[2],Pe[1]],je);return[Math.min(Qe[0],ut[0],K[0],ye[0]),Math.min(Qe[1],ut[1],K[1],ye[1]),Math.max(Qe[0],ut[0],K[0],ye[0]),Math.max(Qe[1],ut[1],K[1],ye[1])]}static inverseTransform(Pe){const je=Pe[0]*Pe[3]-Pe[1]*Pe[2];return[Pe[3]/je,-Pe[1]/je,-Pe[2]/je,Pe[0]/je,(Pe[2]*Pe[5]-Pe[4]*Pe[3])/je,(Pe[4]*Pe[1]-Pe[5]*Pe[0])/je]}static singularValueDecompose2dScale(Pe){const je=[Pe[0],Pe[2],Pe[1],Pe[3]],Qe=Pe[0]*je[0]+Pe[1]*je[2],ut=Pe[0]*je[1]+Pe[1]*je[3],K=Pe[2]*je[0]+Pe[3]*je[2],ye=Pe[2]*je[1]+Pe[3]*je[3],Ue=(Qe+ye)/2,ze=Math.sqrt((Qe+ye)**2-4*(Qe*ye-K*ut))/2,Ke=Ue+ze||1,Ve=Ue-ze||1;return[Math.sqrt(Ke),Math.sqrt(Ve)]}static normalizeRect(Pe){const je=Pe.slice(0);return Pe[0]>Pe[2]&&(je[0]=Pe[2],je[2]=Pe[0]),Pe[1]>Pe[3]&&(je[1]=Pe[3],je[3]=Pe[1]),je}static intersect(Pe,je){const Qe=Math.max(Math.min(Pe[0],Pe[2]),Math.min(je[0],je[2])),ut=Math.min(Math.max(Pe[0],Pe[2]),Math.max(je[0],je[2]));if(Qe>ut)return null;const K=Math.max(Math.min(Pe[1],Pe[3]),Math.min(je[1],je[3])),ye=Math.min(Math.max(Pe[1],Pe[3]),Math.max(je[1],je[3]));return K>ye?null:[Qe,K,ut,ye]}static bezierBoundingBox(Pe,je,Qe,ut,K,ye,Ue,ze){const Ke=[],Ve=[[],[]];let ee,ne,ve,we,Te,We,$e,tt;for(let te=0;te<2;++te){if(te===0?(ne=6*Pe-12*Qe+6*K,ee=-3*Pe+9*Qe-9*K+3*Ue,ve=3*Qe-3*Pe):(ne=6*je-12*ut+6*ye,ee=-3*je+9*ut-9*ye+3*ze,ve=3*ut-3*je),Math.abs(ee)<1e-12){if(Math.abs(ne)<1e-12)continue;we=-ve/ne,0<we&&we<1&&Ke.push(we);continue}$e=ne*ne-4*ve*ee,tt=Math.sqrt($e),!($e<0)&&(Te=(-ne+tt)/(2*ee),0<Te&&Te<1&&Ke.push(Te),We=(-ne-tt)/(2*ee),0<We&&We<1&&Ke.push(We))}let at=Ke.length,V;const ie=at;for(;at--;)we=Ke[at],V=1-we,Ve[0][at]=V*V*V*Pe+3*V*V*we*Qe+3*V*we*we*K+we*we*we*Ue,Ve[1][at]=V*V*V*je+3*V*V*we*ut+3*V*we*we*ye+we*we*we*ze;return Ve[0][ie]=Pe,Ve[1][ie]=je,Ve[0][ie+1]=Ue,Ve[1][ie+1]=ze,Ve[0].length=Ve[1].length=ie+2,[Math.min(...Ve[0]),Math.min(...Ve[1]),Math.max(...Ve[0]),Math.max(...Ve[1])]}}r.Util=Se;const Ce=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,728,711,710,729,733,731,730,732,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8226,8224,8225,8230,8212,8211,402,8260,8249,8250,8722,8240,8222,8220,8221,8216,8217,8218,8482,64257,64258,321,338,352,376,381,305,322,339,353,382,0,8364];function Le(Xe){if(Xe[0]>="ï"){let je;if(Xe[0]==="þ"&&Xe[1]==="ÿ"?je="utf-16be":Xe[0]==="ÿ"&&Xe[1]==="þ"?je="utf-16le":Xe[0]==="ï"&&Xe[1]==="»"&&Xe[2]==="¿"&&(je="utf-8"),je)try{const Qe=new TextDecoder(je,{fatal:!0}),ut=Re(Xe);return Qe.decode(ut)}catch(Qe){ge(`stringToPDFString: "${Qe}".`)}}const Pe=[];for(let je=0,Qe=Xe.length;je<Qe;je++){const ut=Ce[Xe.charCodeAt(je)];Pe.push(ut?String.fromCharCode(ut):Xe.charAt(je))}return Pe.join("")}function De(Xe){return decodeURIComponent(escape(Xe))}function _e(Xe){return unescape(encodeURIComponent(Xe))}function Ge(Xe){return typeof Xe=="object"&&(Xe==null?void 0:Xe.byteLength)!==void 0}function Ye(Xe,Pe){if(Xe.length!==Pe.length)return!1;for(let je=0,Qe=Xe.length;je<Qe;je++)if(Xe[je]!==Pe[je])return!1;return!0}function ot(){let Xe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:new Date;return[Xe.getUTCFullYear().toString(),(Xe.getUTCMonth()+1).toString().padStart(2,"0"),Xe.getUTCDate().toString().padStart(2,"0"),Xe.getUTCHours().toString().padStart(2,"0"),Xe.getUTCMinutes().toString().padStart(2,"0"),Xe.getUTCSeconds().toString().padStart(2,"0")].join("")}class st{constructor(){ke(this,pt,!1);this.promise=new Promise((Pe,je)=>{this.resolve=Qe=>{Ie(this,pt,!0),Pe(Qe)},this.reject=Qe=>{Ie(this,pt,!0),je(Qe)}})}get settled(){return O(this,pt)}}pt=new WeakMap,r.PromiseCapability=st;let ht=null,Je=null;function nt(Xe){return ht||(ht=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,Je=new Map([["ﬅ","ſt"]])),Xe.replaceAll(ht,(Pe,je,Qe)=>je?je.normalize("NFKC"):Je.get(Qe))}function ct(){if(typeof crypto<"u"&&typeof(crypto==null?void 0:crypto.randomUUID)=="function")return crypto.randomUUID();const Xe=new Uint8Array(32);if(typeof crypto<"u"&&typeof(crypto==null?void 0:crypto.getRandomValues)=="function")crypto.getRandomValues(Xe);else for(let Pe=0;Pe<32;Pe++)Xe[Pe]=Math.floor(Math.random()*255);return Ee(Xe)}const ft="pdfjs_internal_id_";r.AnnotationPrefix=ft},(t,r,e)=>{var s=e(3),a=e(4),i=e(69),o=e(70),c="WebAssembly",h=a[c],u=Error("e",{cause:7}).cause!==7,d=function(b,v){var E={};E[b]=o(b,v,u),s({global:!0,constructor:!0,arity:1,forced:u},E)},_=function(b,v){if(h&&h[b]){var E={};E[b]=o(c+"."+b,v,u),s({target:c,stat:!0,constructor:!0,arity:1,forced:u},E)}};d("Error",function(b){return function(E){return i(b,this,arguments)}}),d("EvalError",function(b){return function(E){return i(b,this,arguments)}}),d("RangeError",function(b){return function(E){return i(b,this,arguments)}}),d("ReferenceError",function(b){return function(E){return i(b,this,arguments)}}),d("SyntaxError",function(b){return function(E){return i(b,this,arguments)}}),d("TypeError",function(b){return function(E){return i(b,this,arguments)}}),d("URIError",function(b){return function(E){return i(b,this,arguments)}}),_("CompileError",function(b){return function(E){return i(b,this,arguments)}}),_("LinkError",function(b){return function(E){return i(b,this,arguments)}}),_("RuntimeError",function(b){return function(E){return i(b,this,arguments)}})},(t,r,e)=>{var s=e(4),a=e(5).f,i=e(44),o=e(48),c=e(38),h=e(56),u=e(68);t.exports=function(d,_){var b=d.target,v=d.global,E=d.stat,x,g,w,R,N,M;if(v?g=s:E?g=s[b]||c(b,{}):g=(s[b]||{}).prototype,g)for(w in _){if(N=_[w],d.dontCallGetSet?(M=a(g,w),R=M&&M.value):R=g[w],x=u(v?w:b+(E?".":"#")+w,d.forced),!x&&R!==void 0){if(typeof N==typeof R)continue;h(N,R)}(d.sham||R&&R.sham)&&i(N,"sham",!0),o(g,w,N,d)}}},function(t){var r=function(e){return e&&e.Math===Math&&e};t.exports=r(typeof globalThis=="object"&&globalThis)||r(typeof window=="object"&&window)||r(typeof self=="object"&&self)||r(typeof commonjsGlobal=="object"&&commonjsGlobal)||function(){return this}()||this||Function("return this")()},(t,r,e)=>{var s=e(6),a=e(8),i=e(10),o=e(11),c=e(12),h=e(18),u=e(39),d=e(42),_=Object.getOwnPropertyDescriptor;r.f=s?_:function(v,E){if(v=c(v),E=h(E),d)try{return _(v,E)}catch{}if(u(v,E))return o(!a(i.f,v,E),v[E])}},(t,r,e)=>{var s=e(7);t.exports=!s(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7})},t=>{t.exports=function(r){try{return!!r()}catch{return!0}}},(t,r,e)=>{var s=e(9),a=Function.prototype.call;t.exports=s?a.bind(a):function(){return a.apply(a,arguments)}},(t,r,e)=>{var s=e(7);t.exports=!s(function(){var a=(function(){}).bind();return typeof a!="function"||a.hasOwnProperty("prototype")})},(t,r)=>{var e={}.propertyIsEnumerable,s=Object.getOwnPropertyDescriptor,a=s&&!e.call({1:2},1);r.f=a?function(o){var c=s(this,o);return!!c&&c.enumerable}:e},t=>{t.exports=function(r,e){return{enumerable:!(r&1),configurable:!(r&2),writable:!(r&4),value:e}}},(t,r,e)=>{var s=e(13),a=e(16);t.exports=function(i){return s(a(i))}},(t,r,e)=>{var s=e(14),a=e(7),i=e(15),o=Object,c=s("".split);t.exports=a(function(){return!o("z").propertyIsEnumerable(0)})?function(h){return i(h)==="String"?c(h,""):o(h)}:o},(t,r,e)=>{var s=e(9),a=Function.prototype,i=a.call,o=s&&a.bind.bind(i,i);t.exports=s?o:function(c){return function(){return i.apply(c,arguments)}}},(t,r,e)=>{var s=e(14),a=s({}.toString),i=s("".slice);t.exports=function(o){return i(a(o),8,-1)}},(t,r,e)=>{var s=e(17),a=TypeError;t.exports=function(i){if(s(i))throw a("Can't call method on "+i);return i}},t=>{t.exports=function(r){return r==null}},(t,r,e)=>{var s=e(19),a=e(23);t.exports=function(i){var o=s(i,"string");return a(o)?o:o+""}},(t,r,e)=>{var s=e(8),a=e(20),i=e(23),o=e(30),c=e(33),h=e(34),u=TypeError,d=h("toPrimitive");t.exports=function(_,b){if(!a(_)||i(_))return _;var v=o(_,d),E;if(v){if(b===void 0&&(b="default"),E=s(v,_,b),!a(E)||i(E))return E;throw u("Can't convert object to primitive value")}return b===void 0&&(b="number"),c(_,b)}},(t,r,e)=>{var s=e(21),a=e(22),i=a.all;t.exports=a.IS_HTMLDDA?function(o){return typeof o=="object"?o!==null:s(o)||o===i}:function(o){return typeof o=="object"?o!==null:s(o)}},(t,r,e)=>{var s=e(22),a=s.all;t.exports=s.IS_HTMLDDA?function(i){return typeof i=="function"||i===a}:function(i){return typeof i=="function"}},t=>{var r=typeof document=="object"&&document.all,e=typeof r>"u"&&r!==void 0;t.exports={all:r,IS_HTMLDDA:e}},(t,r,e)=>{var s=e(24),a=e(21),i=e(25),o=e(26),c=Object;t.exports=o?function(h){return typeof h=="symbol"}:function(h){var u=s("Symbol");return a(u)&&i(u.prototype,c(h))}},(t,r,e)=>{var s=e(4),a=e(21),i=function(o){return a(o)?o:void 0};t.exports=function(o,c){return arguments.length<2?i(s[o]):s[o]&&s[o][c]}},(t,r,e)=>{var s=e(14);t.exports=s({}.isPrototypeOf)},(t,r,e)=>{var s=e(27);t.exports=s&&!Symbol.sham&&typeof Symbol.iterator=="symbol"},(t,r,e)=>{var s=e(28),a=e(7),i=e(4),o=i.String;t.exports=!!Object.getOwnPropertySymbols&&!a(function(){var c=Symbol("symbol detection");return!o(c)||!(Object(c)instanceof Symbol)||!Symbol.sham&&s&&s<41})},(t,r,e)=>{var s=e(4),a=e(29),i=s.process,o=s.Deno,c=i&&i.versions||o&&o.version,h=c&&c.v8,u,d;h&&(u=h.split("."),d=u[0]>0&&u[0]<4?1:+(u[0]+u[1])),!d&&a&&(u=a.match(/Edge\/(\d+)/),(!u||u[1]>=74)&&(u=a.match(/Chrome\/(\d+)/),u&&(d=+u[1]))),t.exports=d},t=>{t.exports=typeof navigator<"u"&&String(navigator.userAgent)||""},(t,r,e)=>{var s=e(31),a=e(17);t.exports=function(i,o){var c=i[o];return a(c)?void 0:s(c)}},(t,r,e)=>{var s=e(21),a=e(32),i=TypeError;t.exports=function(o){if(s(o))return o;throw i(a(o)+" is not a function")}},t=>{var r=String;t.exports=function(e){try{return r(e)}catch{return"Object"}}},(t,r,e)=>{var s=e(8),a=e(21),i=e(20),o=TypeError;t.exports=function(c,h){var u,d;if(h==="string"&&a(u=c.toString)&&!i(d=s(u,c))||a(u=c.valueOf)&&!i(d=s(u,c))||h!=="string"&&a(u=c.toString)&&!i(d=s(u,c)))return d;throw o("Can't convert object to primitive value")}},(t,r,e)=>{var s=e(4),a=e(35),i=e(39),o=e(41),c=e(27),h=e(26),u=s.Symbol,d=a("wks"),_=h?u.for||u:u&&u.withoutSetter||o;t.exports=function(b){return i(d,b)||(d[b]=c&&i(u,b)?u[b]:_("Symbol."+b)),d[b]}},(t,r,e)=>{var s=e(36),a=e(37);(t.exports=function(i,o){return a[i]||(a[i]=o!==void 0?o:{})})("versions",[]).push({version:"3.32.2",mode:s?"pure":"global",copyright:"© 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.32.2/LICENSE",source:"https://github.com/zloirock/core-js"})},t=>{t.exports=!1},(t,r,e)=>{var s=e(4),a=e(38),i="__core-js_shared__",o=s[i]||a(i,{});t.exports=o},(t,r,e)=>{var s=e(4),a=Object.defineProperty;t.exports=function(i,o){try{a(s,i,{value:o,configurable:!0,writable:!0})}catch{s[i]=o}return o}},(t,r,e)=>{var s=e(14),a=e(40),i=s({}.hasOwnProperty);t.exports=Object.hasOwn||function(c,h){return i(a(c),h)}},(t,r,e)=>{var s=e(16),a=Object;t.exports=function(i){return a(s(i))}},(t,r,e)=>{var s=e(14),a=0,i=Math.random(),o=s(1 .toString);t.exports=function(c){return"Symbol("+(c===void 0?"":c)+")_"+o(++a+i,36)}},(t,r,e)=>{var s=e(6),a=e(7),i=e(43);t.exports=!s&&!a(function(){return Object.defineProperty(i("div"),"a",{get:function(){return 7}}).a!==7})},(t,r,e)=>{var s=e(4),a=e(20),i=s.document,o=a(i)&&a(i.createElement);t.exports=function(c){return o?i.createElement(c):{}}},(t,r,e)=>{var s=e(6),a=e(45),i=e(11);t.exports=s?function(o,c,h){return a.f(o,c,i(1,h))}:function(o,c,h){return o[c]=h,o}},(t,r,e)=>{var s=e(6),a=e(42),i=e(46),o=e(47),c=e(18),h=TypeError,u=Object.defineProperty,d=Object.getOwnPropertyDescriptor,_="enumerable",b="configurable",v="writable";r.f=s?i?function(x,g,w){if(o(x),g=c(g),o(w),typeof x=="function"&&g==="prototype"&&"value"in w&&v in w&&!w[v]){var R=d(x,g);R&&R[v]&&(x[g]=w.value,w={configurable:b in w?w[b]:R[b],enumerable:_ in w?w[_]:R[_],writable:!1})}return u(x,g,w)}:u:function(x,g,w){if(o(x),g=c(g),o(w),a)try{return u(x,g,w)}catch{}if("get"in w||"set"in w)throw h("Accessors not supported");return"value"in w&&(x[g]=w.value),x}},(t,r,e)=>{var s=e(6),a=e(7);t.exports=s&&a(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42})},(t,r,e)=>{var s=e(20),a=String,i=TypeError;t.exports=function(o){if(s(o))return o;throw i(a(o)+" is not an object")}},(t,r,e)=>{var s=e(21),a=e(45),i=e(49),o=e(38);t.exports=function(c,h,u,d){d||(d={});var _=d.enumerable,b=d.name!==void 0?d.name:h;if(s(u)&&i(u,b,d),d.global)_?c[h]=u:o(h,u);else{try{d.unsafe?c[h]&&(_=!0):delete c[h]}catch{}_?c[h]=u:a.f(c,h,{value:u,enumerable:!1,configurable:!d.nonConfigurable,writable:!d.nonWritable})}return c}},(t,r,e)=>{var s=e(14),a=e(7),i=e(21),o=e(39),c=e(6),h=e(50).CONFIGURABLE,u=e(51),d=e(52),_=d.enforce,b=d.get,v=String,E=Object.defineProperty,x=s("".slice),g=s("".replace),w=s([].join),R=c&&!a(function(){return E(function(){},"length",{value:8}).length!==8}),N=String(String).split("String"),M=t.exports=function(A,I,y){x(v(I),0,7)==="Symbol("&&(I="["+g(v(I),/^Symbol\(([^)]*)\)/,"$1")+"]"),y&&y.getter&&(I="get "+I),y&&y.setter&&(I="set "+I),(!o(A,"name")||h&&A.name!==I)&&(c?E(A,"name",{value:I,configurable:!0}):A.name=I),R&&y&&o(y,"arity")&&A.length!==y.arity&&E(A,"length",{value:y.arity});try{y&&o(y,"constructor")&&y.constructor?c&&E(A,"prototype",{writable:!1}):A.prototype&&(A.prototype=void 0)}catch{}var j=_(A);return o(j,"source")||(j.source=w(N,typeof I=="string"?I:"")),A};Function.prototype.toString=M(function(){return i(this)&&b(this).source||u(this)},"toString")},(t,r,e)=>{var s=e(6),a=e(39),i=Function.prototype,o=s&&Object.getOwnPropertyDescriptor,c=a(i,"name"),h=c&&(function(){}).name==="something",u=c&&(!s||s&&o(i,"name").configurable);t.exports={EXISTS:c,PROPER:h,CONFIGURABLE:u}},(t,r,e)=>{var s=e(14),a=e(21),i=e(37),o=s(Function.toString);a(i.inspectSource)||(i.inspectSource=function(c){return o(c)}),t.exports=i.inspectSource},(t,r,e)=>{var s=e(53),a=e(4),i=e(20),o=e(44),c=e(39),h=e(37),u=e(54),d=e(55),_="Object already initialized",b=a.TypeError,v=a.WeakMap,E,x,g,w=function(A){return g(A)?x(A):E(A,{})},R=function(A){return function(I){var y;if(!i(I)||(y=x(I)).type!==A)throw b("Incompatible receiver, "+A+" required");return y}};if(s||h.state){var N=h.state||(h.state=new v);N.get=N.get,N.has=N.has,N.set=N.set,E=function(A,I){if(N.has(A))throw b(_);return I.facade=A,N.set(A,I),I},x=function(A){return N.get(A)||{}},g=function(A){return N.has(A)}}else{var M=u("state");d[M]=!0,E=function(A,I){if(c(A,M))throw b(_);return I.facade=A,o(A,M,I),I},x=function(A){return c(A,M)?A[M]:{}},g=function(A){return c(A,M)}}t.exports={set:E,get:x,has:g,enforce:w,getterFor:R}},(t,r,e)=>{var s=e(4),a=e(21),i=s.WeakMap;t.exports=a(i)&&/native code/.test(String(i))},(t,r,e)=>{var s=e(35),a=e(41),i=s("keys");t.exports=function(o){return i[o]||(i[o]=a(o))}},t=>{t.exports={}},(t,r,e)=>{var s=e(39),a=e(57),i=e(5),o=e(45);t.exports=function(c,h,u){for(var d=a(h),_=o.f,b=i.f,v=0;v<d.length;v++){var E=d[v];!s(c,E)&&!(u&&s(u,E))&&_(c,E,b(h,E))}}},(t,r,e)=>{var s=e(24),a=e(14),i=e(58),o=e(67),c=e(47),h=a([].concat);t.exports=s("Reflect","ownKeys")||function(d){var _=i.f(c(d)),b=o.f;return b?h(_,b(d)):_}},(t,r,e)=>{var s=e(59),a=e(66),i=a.concat("length","prototype");r.f=Object.getOwnPropertyNames||function(c){return s(c,i)}},(t,r,e)=>{var s=e(14),a=e(39),i=e(12),o=e(60).indexOf,c=e(55),h=s([].push);t.exports=function(u,d){var _=i(u),b=0,v=[],E;for(E in _)!a(c,E)&&a(_,E)&&h(v,E);for(;d.length>b;)a(_,E=d[b++])&&(~o(v,E)||h(v,E));return v}},(t,r,e)=>{var s=e(12),a=e(61),i=e(64),o=function(c){return function(h,u,d){var _=s(h),b=i(_),v=a(d,b),E;if(c&&u!==u){for(;b>v;)if(E=_[v++],E!==E)return!0}else for(;b>v;v++)if((c||v in _)&&_[v]===u)return c||v||0;return!c&&-1}};t.exports={includes:o(!0),indexOf:o(!1)}},(t,r,e)=>{var s=e(62),a=Math.max,i=Math.min;t.exports=function(o,c){var h=s(o);return h<0?a(h+c,0):i(h,c)}},(t,r,e)=>{var s=e(63);t.exports=function(a){var i=+a;return i!==i||i===0?0:s(i)}},t=>{var r=Math.ceil,e=Math.floor;t.exports=Math.trunc||function(a){var i=+a;return(i>0?e:r)(i)}},(t,r,e)=>{var s=e(65);t.exports=function(a){return s(a.length)}},(t,r,e)=>{var s=e(62),a=Math.min;t.exports=function(i){return i>0?a(s(i),9007199254740991):0}},t=>{t.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},(t,r)=>{r.f=Object.getOwnPropertySymbols},(t,r,e)=>{var s=e(7),a=e(21),i=/#|\.prototype\./,o=function(_,b){var v=h[c(_)];return v===d?!0:v===u?!1:a(b)?s(b):!!b},c=o.normalize=function(_){return String(_).replace(i,".").toLowerCase()},h=o.data={},u=o.NATIVE="N",d=o.POLYFILL="P";t.exports=o},(t,r,e)=>{var s=e(9),a=Function.prototype,i=a.apply,o=a.call;t.exports=typeof Reflect=="object"&&Reflect.apply||(s?o.bind(i):function(){return o.apply(i,arguments)})},(t,r,e)=>{var s=e(24),a=e(39),i=e(44),o=e(25),c=e(71),h=e(56),u=e(74),d=e(75),_=e(76),b=e(80),v=e(81),E=e(6),x=e(36);t.exports=function(g,w,R,N){var M="stackTraceLimit",A=N?2:1,I=g.split("."),y=I[I.length-1],j=s.apply(null,I);if(j){var T=j.prototype;if(!x&&a(T,"cause")&&delete T.cause,!R)return j;var U=s("Error"),F=w(function(H,z){var de=_(N?z:H,void 0),se=N?new j(H):new j;return de!==void 0&&i(se,"message",de),v(se,F,se.stack,2),this&&o(T,this)&&d(se,this,F),arguments.length>A&&b(se,arguments[A]),se});if(F.prototype=T,y!=="Error"?c?c(F,U):h(F,U,{name:!0}):E&&M in j&&(u(F,j,M),u(F,j,"prepareStackTrace")),h(F,j),!x)try{T.name!==y&&i(T,"name",y),T.constructor=F}catch{}return F}}},(t,r,e)=>{var s=e(72),a=e(47),i=e(73);t.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var o=!1,c={},h;try{h=s(Object.prototype,"__proto__","set"),h(c,[]),o=c instanceof Array}catch{}return function(d,_){return a(d),i(_),o?h(d,_):d.__proto__=_,d}}():void 0)},(t,r,e)=>{var s=e(14),a=e(31);t.exports=function(i,o,c){try{return s(a(Object.getOwnPropertyDescriptor(i,o)[c]))}catch{}}},(t,r,e)=>{var s=e(21),a=String,i=TypeError;t.exports=function(o){if(typeof o=="object"||s(o))return o;throw i("Can't set "+a(o)+" as a prototype")}},(t,r,e)=>{var s=e(45).f;t.exports=function(a,i,o){o in a||s(a,o,{configurable:!0,get:function(){return i[o]},set:function(c){i[o]=c}})}},(t,r,e)=>{var s=e(21),a=e(20),i=e(71);t.exports=function(o,c,h){var u,d;return i&&s(u=c.constructor)&&u!==h&&a(d=u.prototype)&&d!==h.prototype&&i(o,d),o}},(t,r,e)=>{var s=e(77);t.exports=function(a,i){return a===void 0?arguments.length<2?"":i:s(a)}},(t,r,e)=>{var s=e(78),a=String;t.exports=function(i){if(s(i)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return a(i)}},(t,r,e)=>{var s=e(79),a=e(21),i=e(15),o=e(34),c=o("toStringTag"),h=Object,u=i(function(){return arguments}())==="Arguments",d=function(_,b){try{return _[b]}catch{}};t.exports=s?i:function(_){var b,v,E;return _===void 0?"Undefined":_===null?"Null":typeof(v=d(b=h(_),c))=="string"?v:u?i(b):(E=i(b))==="Object"&&a(b.callee)?"Arguments":E}},(t,r,e)=>{var s=e(34),a=s("toStringTag"),i={};i[a]="z",t.exports=String(i)==="[object z]"},(t,r,e)=>{var s=e(20),a=e(44);t.exports=function(i,o){s(o)&&"cause"in o&&a(i,"cause",o.cause)}},(t,r,e)=>{var s=e(44),a=e(82),i=e(83),o=Error.captureStackTrace;t.exports=function(c,h,u,d){i&&(o?o(c,h):s(c,"stack",a(u,d)))}},(t,r,e)=>{var s=e(14),a=Error,i=s("".replace),o=function(u){return String(a(u).stack)}("zxcasd"),c=/\n\s*at [^:]*:[^\n]*/,h=c.test(o);t.exports=function(u,d){if(h&&typeof u=="string"&&!a.prepareStackTrace)for(;d--;)u=i(u,c,"");return u}},(t,r,e)=>{var s=e(7),a=e(11);t.exports=!s(function(){var i=Error("a");return"stack"in i?(Object.defineProperty(i,"stack",a(1,7)),i.stack!==7):!0})},(t,r,e)=>{var s=e(48),a=e(14),i=e(77),o=e(85),c=URLSearchParams,h=c.prototype,u=a(h.append),d=a(h.delete),_=a(h.forEach),b=a([].push),v=new c("a=1&a=2&b=3");v.delete("a",1),v.delete("b",void 0),v+""!="a=2"&&s(h,"delete",function(E){var x=arguments.length,g=x<2?void 0:arguments[1];if(x&&g===void 0)return d(this,E);var w=[];_(this,function(T,U){b(w,{key:U,value:T})}),o(x,1);for(var R=i(E),N=i(g),M=0,A=0,I=!1,y=w.length,j;M<y;)j=w[M++],I||j.key===R?(I=!0,d(this,j.key)):A++;for(;A<y;)j=w[A++],j.key===R&&j.value===N||u(this,j.key,j.value)},{enumerable:!0,unsafe:!0})},t=>{var r=TypeError;t.exports=function(e,s){if(e<s)throw r("Not enough arguments");return e}},(t,r,e)=>{var s=e(48),a=e(14),i=e(77),o=e(85),c=URLSearchParams,h=c.prototype,u=a(h.getAll),d=a(h.has),_=new c("a=1");(_.has("a",2)||!_.has("a",void 0))&&s(h,"has",function(v){var E=arguments.length,x=E<2?void 0:arguments[1];if(E&&x===void 0)return d(this,v);var g=u(this,v);o(E,1);for(var w=i(x),R=0;R<g.length;)if(g[R++]===w)return!0;return!1},{enumerable:!0,unsafe:!0})},(t,r,e)=>{var s=e(6),a=e(14),i=e(88),o=URLSearchParams.prototype,c=a(o.forEach);s&&!("size"in o)&&i(o,"size",{get:function(){var u=0;return c(this,function(){u++}),u},configurable:!0,enumerable:!0})},(t,r,e)=>{var s=e(49),a=e(45);t.exports=function(i,o,c){return c.get&&s(c.get,o,{getter:!0}),c.set&&s(c.set,o,{setter:!0}),a.f(i,o,c)}},(t,r,e)=>{var s=e(3),a=e(40),i=e(64),o=e(90),c=e(92),h=e(7),u=h(function(){return[].push.call({length:4294967296},1)!==4294967297}),d=function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(b){return b instanceof TypeError}},_=u||!d();s({target:"Array",proto:!0,arity:1,forced:_},{push:function(v){var E=a(this),x=i(E),g=arguments.length;c(x+g);for(var w=0;w<g;w++)E[x]=arguments[w],x++;return o(E,x),x}})},(t,r,e)=>{var s=e(6),a=e(91),i=TypeError,o=Object.getOwnPropertyDescriptor,c=s&&!function(){if(this!==void 0)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(h){return h instanceof TypeError}}();t.exports=c?function(h,u){if(a(h)&&!o(h,"length").writable)throw i("Cannot set read only .length");return h.length=u}:function(h,u){return h.length=u}},(t,r,e)=>{var s=e(15);t.exports=Array.isArray||function(i){return s(i)==="Array"}},t=>{var r=TypeError,e=9007199254740991;t.exports=function(s){if(s>e)throw r("Maximum allowed index exceeded");return s}},(t,r,e)=>{var s=e(94),a=e(98).findLast,i=s.aTypedArray,o=s.exportTypedArrayMethod;o("findLast",function(h){return a(i(this),h,arguments.length>1?arguments[1]:void 0)})},(t,r,e)=>{var s=e(95),a=e(6),i=e(4),o=e(21),c=e(20),h=e(39),u=e(78),d=e(32),_=e(44),b=e(48),v=e(88),E=e(25),x=e(96),g=e(71),w=e(34),R=e(41),N=e(52),M=N.enforce,A=N.get,I=i.Int8Array,y=I&&I.prototype,j=i.Uint8ClampedArray,T=j&&j.prototype,U=I&&x(I),F=y&&x(y),H=Object.prototype,z=i.TypeError,de=w("toStringTag"),se=R("TYPED_ARRAY_TAG"),ue="TypedArrayConstructor",Z=s&&!!g&&u(i.opera)!=="Opera",ge=!1,re,oe,be,L={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},S={BigInt64Array:8,BigUint64Array:8},C=function(Ee){if(!c(Ee))return!1;var Re=u(Ee);return Re==="DataView"||h(L,Re)||h(S,Re)},P=function(me){var Ee=x(me);if(c(Ee)){var Re=A(Ee);return Re&&h(Re,ue)?Re[ue]:P(Ee)}},D=function(me){if(!c(me))return!1;var Ee=u(me);return h(L,Ee)||h(S,Ee)},B=function(me){if(D(me))return me;throw z("Target is not a typed array")},G=function(me){if(o(me)&&(!g||E(U,me)))return me;throw z(d(me)+" is not a typed array constructor")},J=function(me,Ee,Re,Ne){if(a){if(Re)for(var he in L){var pe=i[he];if(pe&&h(pe.prototype,me))try{delete pe.prototype[me]}catch{try{pe.prototype[me]=Ee}catch{}}}(!F[me]||Re)&&b(F,me,Re?Ee:Z&&y[me]||Ee,Ne)}},Y=function(me,Ee,Re){var Ne,he;if(a){if(g){if(Re){for(Ne in L)if(he=i[Ne],he&&h(he,me))try{delete he[me]}catch{}}if(!U[me]||Re)try{return b(U,me,Re?Ee:Z&&U[me]||Ee)}catch{}else return}for(Ne in L)he=i[Ne],he&&(!he[me]||Re)&&b(he,me,Ee)}};for(re in L)oe=i[re],be=oe&&oe.prototype,be?M(be)[ue]=oe:Z=!1;for(re in S)oe=i[re],be=oe&&oe.prototype,be&&(M(be)[ue]=oe);if((!Z||!o(U)||U===Function.prototype)&&(U=function(){throw z("Incorrect invocation")},Z))for(re in L)i[re]&&g(i[re],U);if((!Z||!F||F===H)&&(F=U.prototype,Z))for(re in L)i[re]&&g(i[re].prototype,F);if(Z&&x(T)!==F&&g(T,F),a&&!h(F,de)){ge=!0,v(F,de,{configurable:!0,get:function(){return c(this)?this[se]:void 0}});for(re in L)i[re]&&_(i[re],se,re)}t.exports={NATIVE_ARRAY_BUFFER_VIEWS:Z,TYPED_ARRAY_TAG:ge&&se,aTypedArray:B,aTypedArrayConstructor:G,exportTypedArrayMethod:J,exportTypedArrayStaticMethod:Y,getTypedArrayConstructor:P,isView:C,isTypedArray:D,TypedArray:U,TypedArrayPrototype:F}},t=>{t.exports=typeof ArrayBuffer<"u"&&typeof DataView<"u"},(t,r,e)=>{var s=e(39),a=e(21),i=e(40),o=e(54),c=e(97),h=o("IE_PROTO"),u=Object,d=u.prototype;t.exports=c?u.getPrototypeOf:function(_){var b=i(_);if(s(b,h))return b[h];var v=b.constructor;return a(v)&&b instanceof v?v.prototype:b instanceof u?d:null}},(t,r,e)=>{var s=e(7);t.exports=!s(function(){function a(){}return a.prototype.constructor=null,Object.getPrototypeOf(new a)!==a.prototype})},(t,r,e)=>{var s=e(99),a=e(13),i=e(40),o=e(64),c=function(h){var u=h===1;return function(d,_,b){for(var v=i(d),E=a(v),x=s(_,b),g=o(E),w,R;g-- >0;)if(w=E[g],R=x(w,g,v),R)switch(h){case 0:return w;case 1:return g}return u?-1:void 0}};t.exports={findLast:c(0),findLastIndex:c(1)}},(t,r,e)=>{var s=e(100),a=e(31),i=e(9),o=s(s.bind);t.exports=function(c,h){return a(c),h===void 0?c:i?o(c,h):function(){return c.apply(h,arguments)}}},(t,r,e)=>{var s=e(15),a=e(14);t.exports=function(i){if(s(i)==="Function")return a(i)}},(t,r,e)=>{var s=e(94),a=e(98).findLastIndex,i=s.aTypedArray,o=s.exportTypedArrayMethod;o("findLastIndex",function(h){return a(i(this),h,arguments.length>1?arguments[1]:void 0)})},(t,r,e)=>{var s=e(4),a=e(8),i=e(94),o=e(64),c=e(103),h=e(40),u=e(7),d=s.RangeError,_=s.Int8Array,b=_&&_.prototype,v=b&&b.set,E=i.aTypedArray,x=i.exportTypedArrayMethod,g=!u(function(){var R=new Uint8ClampedArray(2);return a(v,R,{length:1,0:3},1),R[1]!==3}),w=g&&i.NATIVE_ARRAY_BUFFER_VIEWS&&u(function(){var R=new _(2);return R.set(1),R.set("2",1),R[0]!==0||R[1]!==2});x("set",function(N){E(this);var M=c(arguments.length>1?arguments[1]:void 0,1),A=h(N);if(g)return a(v,this,A,M);var I=this.length,y=o(A),j=0;if(y+M>I)throw d("Wrong length");for(;j<y;)this[M+j]=A[j++]},!g||w)},(t,r,e)=>{var s=e(104),a=RangeError;t.exports=function(i,o){var c=s(i);if(c%o)throw a("Wrong offset");return c}},(t,r,e)=>{var s=e(62),a=RangeError;t.exports=function(i){var o=s(i);if(o<0)throw a("The argument can't be less than 0");return o}},(t,r,e)=>{var s=e(106),a=e(94),i=a.aTypedArray,o=a.exportTypedArrayMethod,c=a.getTypedArrayConstructor;o("toReversed",function(){return s(i(this),c(this))})},(t,r,e)=>{var s=e(64);t.exports=function(a,i){for(var o=s(a),c=new i(o),h=0;h<o;h++)c[h]=a[o-h-1];return c}},(t,r,e)=>{var s=e(94),a=e(14),i=e(31),o=e(108),c=s.aTypedArray,h=s.getTypedArrayConstructor,u=s.exportTypedArrayMethod,d=a(s.TypedArrayPrototype.sort);u("toSorted",function(b){b!==void 0&&i(b);var v=c(this),E=o(h(v),v);return d(E,b)})},(t,r,e)=>{var s=e(64);t.exports=function(a,i){for(var o=0,c=s(i),h=new a(c);c>o;)h[o]=i[o++];return h}},(t,r,e)=>{var s=e(110),a=e(94),i=e(111),o=e(62),c=e(112),h=a.aTypedArray,u=a.getTypedArrayConstructor,d=a.exportTypedArrayMethod,_=!!function(){try{new Int8Array(1).with(2,{valueOf:function(){throw 8}})}catch(b){return b===8}}();d("with",function(b,v){var E=h(this),x=o(b),g=i(E)?c(v):+v;return s(E,u(E),x,g)},!_)},(t,r,e)=>{var s=e(64),a=e(62),i=RangeError;t.exports=function(o,c,h,u){var d=s(o),_=a(h),b=_<0?d+_:_;if(b>=d||b<0)throw i("Incorrect index");for(var v=new c(d),E=0;E<d;E++)v[E]=E===b?u:o[E];return v}},(t,r,e)=>{var s=e(78);t.exports=function(a){var i=s(a);return i==="BigInt64Array"||i==="BigUint64Array"}},(t,r,e)=>{var s=e(19),a=TypeError;t.exports=function(i){var o=s(i,"number");if(typeof o=="number")throw a("Can't convert number to bigint");return BigInt(o)}},(t,r,e)=>{var s=e(6),a=e(88),i=e(114),o=ArrayBuffer.prototype;s&&!("detached"in o)&&a(o,"detached",{configurable:!0,get:function(){return i(this)}})},(t,r,e)=>{var s=e(14),a=e(115),i=s(ArrayBuffer.prototype.slice);t.exports=function(o){if(a(o)!==0)return!1;try{return i(o,0,0),!1}catch{return!0}}},(t,r,e)=>{var s=e(72),a=e(15),i=TypeError;t.exports=s(ArrayBuffer.prototype,"byteLength","get")||function(o){if(a(o)!=="ArrayBuffer")throw i("ArrayBuffer expected");return o.byteLength}},(t,r,e)=>{var s=e(3),a=e(117);a&&s({target:"ArrayBuffer",proto:!0},{transfer:function(){return a(this,arguments.length?arguments[0]:void 0,!0)}})},(t,r,e)=>{var s=e(4),a=e(14),i=e(72),o=e(118),c=e(114),h=e(115),u=e(119),d=s.TypeError,_=s.structuredClone,b=s.ArrayBuffer,v=s.DataView,E=Math.min,x=b.prototype,g=v.prototype,w=a(x.slice),R=i(x,"resizable","get"),N=i(x,"maxByteLength","get"),M=a(g.getInt8),A=a(g.setInt8);t.exports=u&&function(I,y,j){var T=h(I),U=y===void 0?T:o(y),F=!R||!R(I);if(c(I))throw d("ArrayBuffer is detached");var H=_(I,{transfer:[I]});if(T===U&&(j||F))return H;if(T>=U&&(!j||F))return w(H,0,U);for(var z=j&&!F&&N?{maxByteLength:N(H)}:void 0,de=new b(U,z),se=new v(H),ue=new v(de),Z=E(U,T),ge=0;ge<Z;ge++)A(ue,ge,M(se,ge));return de}},(t,r,e)=>{var s=e(62),a=e(65),i=RangeError;t.exports=function(o){if(o===void 0)return 0;var c=s(o),h=a(c);if(c!==h)throw i("Wrong length or index");return h}},(t,r,e)=>{var s=e(4),a=e(7),i=e(28),o=e(120),c=e(121),h=e(122),u=s.structuredClone;t.exports=!!u&&!a(function(){if(c&&i>92||h&&i>94||o&&i>97)return!1;var d=new ArrayBuffer(8),_=u(d,{transfer:[d]});return d.byteLength!==0||_.byteLength!==8})},(t,r,e)=>{var s=e(121),a=e(122);t.exports=!s&&!a&&typeof window=="object"&&typeof document=="object"},t=>{t.exports=typeof Deno=="object"&&Deno&&typeof Deno.version=="object"},(t,r,e)=>{var s=e(4),a=e(15);t.exports=a(s.process)==="process"},(t,r,e)=>{var s=e(3),a=e(117);a&&s({target:"ArrayBuffer",proto:!0},{transferToFixedLength:function(){return a(this,arguments.length?arguments[0]:void 0,!1)}})},(__unused_webpack_module,exports,__w_pdfjs_require__)=>{var t,e,s,a,zt,hr,c,h,u,d,_,b,v,E,x,fr,w,R,Cr,M,A;Object.defineProperty(exports,"__esModule",{value:!0}),exports.RenderTask=exports.PDFWorkerUtil=exports.PDFWorker=exports.PDFPageProxy=exports.PDFDocumentProxy=exports.PDFDocumentLoadingTask=exports.PDFDataRangeTransport=exports.LoopbackPort=exports.DefaultStandardFontDataFactory=exports.DefaultFilterFactory=exports.DefaultCanvasFactory=exports.DefaultCMapReaderFactory=void 0,Object.defineProperty(exports,"SVGGraphics",{enumerable:!0,get:function(){return _displaySvg.SVGGraphics}}),exports.build=void 0,exports.getDocument=getDocument,exports.version=void 0,__w_pdfjs_require__(84),__w_pdfjs_require__(86),__w_pdfjs_require__(87),__w_pdfjs_require__(2),__w_pdfjs_require__(93),__w_pdfjs_require__(101),__w_pdfjs_require__(102),__w_pdfjs_require__(105),__w_pdfjs_require__(107),__w_pdfjs_require__(109),__w_pdfjs_require__(113),__w_pdfjs_require__(116),__w_pdfjs_require__(123),__w_pdfjs_require__(89),__w_pdfjs_require__(125),__w_pdfjs_require__(136),__w_pdfjs_require__(138),__w_pdfjs_require__(141),__w_pdfjs_require__(143),__w_pdfjs_require__(145),__w_pdfjs_require__(147),__w_pdfjs_require__(149),__w_pdfjs_require__(152);var _util=__w_pdfjs_require__(1),_annotation_storage=__w_pdfjs_require__(163),_display_utils=__w_pdfjs_require__(168),_font_loader=__w_pdfjs_require__(171),_displayNode_utils=__w_pdfjs_require__(172),_canvas=__w_pdfjs_require__(173),_worker_options=__w_pdfjs_require__(176),_message_handler=__w_pdfjs_require__(177),_metadata=__w_pdfjs_require__(178),_optional_content_config=__w_pdfjs_require__(179),_transport_stream=__w_pdfjs_require__(180),_displayFetch_stream=__w_pdfjs_require__(181),_displayNetwork=__w_pdfjs_require__(184),_displayNode_stream=__w_pdfjs_require__(185),_displaySvg=__w_pdfjs_require__(186),_xfa_text=__w_pdfjs_require__(194);const DEFAULT_RANGE_CHUNK_SIZE=65536,RENDERING_CANCELLED_TIMEOUT=100,DELAYED_CLEANUP_TIMEOUT=5e3,DefaultCanvasFactory=_util.isNodeJS?_displayNode_utils.NodeCanvasFactory:_display_utils.DOMCanvasFactory;exports.DefaultCanvasFactory=DefaultCanvasFactory;const DefaultCMapReaderFactory=_util.isNodeJS?_displayNode_utils.NodeCMapReaderFactory:_display_utils.DOMCMapReaderFactory;exports.DefaultCMapReaderFactory=DefaultCMapReaderFactory;const DefaultFilterFactory=_util.isNodeJS?_displayNode_utils.NodeFilterFactory:_display_utils.DOMFilterFactory;exports.DefaultFilterFactory=DefaultFilterFactory;const DefaultStandardFontDataFactory=_util.isNodeJS?_displayNode_utils.NodeStandardFontDataFactory:_display_utils.DOMStandardFontDataFactory;exports.DefaultStandardFontDataFactory=DefaultStandardFontDataFactory;function getDocument(y){if(typeof y=="string"||y instanceof URL?y={url:y}:(0,_util.isArrayBuffer)(y)&&(y={data:y}),typeof y!="object")throw new Error("Invalid parameter in getDocument, need parameter object.");if(!y.url&&!y.data&&!y.range)throw new Error("Invalid parameter object: need either .data, .range or .url");const j=new PDFDocumentLoadingTask,{docId:T}=j,U=y.url?getUrlProp(y.url):null,F=y.data?getDataProp(y.data):null,H=y.httpHeaders||null,z=y.withCredentials===!0,de=y.password??null,se=y.range instanceof PDFDataRangeTransport?y.range:null,ue=Number.isInteger(y.rangeChunkSize)&&y.rangeChunkSize>0?y.rangeChunkSize:DEFAULT_RANGE_CHUNK_SIZE;let Z=y.worker instanceof PDFWorker?y.worker:null;const ge=y.verbosity,re=typeof y.docBaseUrl=="string"&&!(0,_display_utils.isDataScheme)(y.docBaseUrl)?y.docBaseUrl:null,oe=typeof y.cMapUrl=="string"?y.cMapUrl:null,be=y.cMapPacked!==!1,L=y.CMapReaderFactory||DefaultCMapReaderFactory,S=typeof y.standardFontDataUrl=="string"?y.standardFontDataUrl:null,C=y.StandardFontDataFactory||DefaultStandardFontDataFactory,P=y.stopAtErrors!==!0,D=Number.isInteger(y.maxImageSize)&&y.maxImageSize>-1?y.maxImageSize:-1,B=y.isEvalSupported!==!1,G=typeof y.isOffscreenCanvasSupported=="boolean"?y.isOffscreenCanvasSupported:!_util.isNodeJS,J=Number.isInteger(y.canvasMaxAreaInBytes)?y.canvasMaxAreaInBytes:-1,Y=typeof y.disableFontFace=="boolean"?y.disableFontFace:_util.isNodeJS,me=y.fontExtraProperties===!0,Ee=y.enableXfa===!0,Re=y.ownerDocument||globalThis.document,Ne=y.disableRange===!0,he=y.disableStream===!0,pe=y.disableAutoFetch===!0,fe=y.pdfBug===!0,W=se?se.length:y.length??NaN,Q=typeof y.useSystemFonts=="boolean"?y.useSystemFonts:!_util.isNodeJS&&!Y,xe=typeof y.useWorkerFetch=="boolean"?y.useWorkerFetch:L===_display_utils.DOMCMapReaderFactory&&C===_display_utils.DOMStandardFontDataFactory&&oe&&S&&(0,_display_utils.isValidFetchUrl)(oe,document.baseURI)&&(0,_display_utils.isValidFetchUrl)(S,document.baseURI),Se=y.canvasFactory||new DefaultCanvasFactory({ownerDocument:Re}),Ce=y.filterFactory||new DefaultFilterFactory({docId:T,ownerDocument:Re}),Le=null;(0,_util.setVerbosityLevel)(ge);const De={canvasFactory:Se,filterFactory:Ce};if(xe||(De.cMapReaderFactory=new L({baseUrl:oe,isCompressed:be}),De.standardFontDataFactory=new C({baseUrl:S})),!Z){const Ye={verbosity:ge,port:_worker_options.GlobalWorkerOptions.workerPort};Z=Ye.port?PDFWorker.fromPort(Ye):new PDFWorker(Ye),j._worker=Z}const _e={docId:T,apiVersion:"3.11.174",data:F,password:de,disableAutoFetch:pe,rangeChunkSize:ue,length:W,docBaseUrl:re,enableXfa:Ee,evaluatorOptions:{maxImageSize:D,disableFontFace:Y,ignoreErrors:P,isEvalSupported:B,isOffscreenCanvasSupported:G,canvasMaxAreaInBytes:J,fontExtraProperties:me,useSystemFonts:Q,cMapUrl:xe?oe:null,standardFontDataUrl:xe?S:null}},Ge={ignoreErrors:P,isEvalSupported:B,disableFontFace:Y,fontExtraProperties:me,enableXfa:Ee,ownerDocument:Re,disableAutoFetch:pe,pdfBug:fe,styleElement:Le};return Z.promise.then(function(){if(j.destroyed)throw new Error("Loading aborted");const Ye=_fetchDocument(Z,_e),ot=new Promise(function(st){let ht;se?ht=new _transport_stream.PDFDataTransportStream({length:W,initialData:se.initialData,progressiveDone:se.progressiveDone,contentDispositionFilename:se.contentDispositionFilename,disableRange:Ne,disableStream:he},se):F||(ht=(nt=>_util.isNodeJS?new _displayNode_stream.PDFNodeStream(nt):(0,_display_utils.isValidFetchUrl)(nt.url)?new _displayFetch_stream.PDFFetchStream(nt):new _displayNetwork.PDFNetworkStream(nt))({url:U,length:W,httpHeaders:H,withCredentials:z,rangeChunkSize:ue,disableRange:Ne,disableStream:he})),st(ht)});return Promise.all([Ye,ot]).then(function(st){let[ht,Je]=st;if(j.destroyed)throw new Error("Loading aborted");const nt=new _message_handler.MessageHandler(T,ht,Z.port),ct=new WorkerTransport(nt,j,Je,Ge,De);j._transport=ct,nt.send("Ready",null)})}).catch(j._capability.reject),j}async function _fetchDocument(y,j){if(y.destroyed)throw new Error("Worker was destroyed");const T=await y.messageHandler.sendWithPromise("GetDocRequest",j,j.data?[j.data.buffer]:null);if(y.destroyed)throw new Error("Worker was destroyed");return T}function getUrlProp(y){if(y instanceof URL)return y.href;try{return new URL(y,window.location).href}catch{if(_util.isNodeJS&&typeof y=="string")return y}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function getDataProp(y){if(_util.isNodeJS&&typeof Buffer<"u"&&y instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(y instanceof Uint8Array&&y.byteLength===y.buffer.byteLength)return y;if(typeof y=="string")return(0,_util.stringToBytes)(y);if(typeof y=="object"&&!isNaN(y==null?void 0:y.length)||(0,_util.isArrayBuffer)(y))return new Uint8Array(y);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}const r=class r{constructor(){this._capability=new _util.PromiseCapability,this._transport=null,this._worker=null,this.docId=`d${qt(r,t)._++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){var j,T,U;this.destroyed=!0;try{(j=this._worker)!=null&&j.port&&(this._worker._pendingDestroy=!0),await((T=this._transport)==null?void 0:T.destroy())}catch(F){throw(U=this._worker)!=null&&U.port&&delete this._worker._pendingDestroy,F}this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}};t=new WeakMap,ke(r,t,0);let PDFDocumentLoadingTask=r;exports.PDFDocumentLoadingTask=PDFDocumentLoadingTask;class PDFDataRangeTransport{constructor(j,T){let U=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,F=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;this.length=j,this.initialData=T,this.progressiveDone=U,this.contentDispositionFilename=F,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=new _util.PromiseCapability}addRangeListener(j){this._rangeListeners.push(j)}addProgressListener(j){this._progressListeners.push(j)}addProgressiveReadListener(j){this._progressiveReadListeners.push(j)}addProgressiveDoneListener(j){this._progressiveDoneListeners.push(j)}onDataRange(j,T){for(const U of this._rangeListeners)U(j,T)}onDataProgress(j,T){this._readyCapability.promise.then(()=>{for(const U of this._progressListeners)U(j,T)})}onDataProgressiveRead(j){this._readyCapability.promise.then(()=>{for(const T of this._progressiveReadListeners)T(j)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const j of this._progressiveDoneListeners)j()})}transportReady(){this._readyCapability.resolve()}requestDataRange(j,T){(0,_util.unreachable)("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}exports.PDFDataRangeTransport=PDFDataRangeTransport;class PDFDocumentProxy{constructor(j,T){this._pdfInfo=j,this._transport=T,Object.defineProperty(this,"getJavaScript",{value:()=>((0,_display_utils.deprecated)("`PDFDocumentProxy.getJavaScript`, please use `PDFDocumentProxy.getJSActions` instead."),this.getJSActions().then(U=>{if(!U)return U;const F=[];for(const H in U)F.push(...U[H]);return F}))})}get annotationStorage(){return this._transport.annotationStorage}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(j){return this._transport.getPage(j)}getPageIndex(j){return this._transport.getPageIndex(j)}getDestinations(){return this._transport.getDestinations()}getDestination(j){return this._transport.getDestination(j)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig(){return this._transport.getOptionalContentConfig()}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(){let j=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return this._transport.startCleanup(j||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}exports.PDFDocumentProxy=PDFDocumentProxy;class PDFPageProxy{constructor(j,T,U){ke(this,a);ke(this,e,null);ke(this,s,!1);let F=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;this._pageIndex=j,this._pageInfo=T,this._transport=U,this._stats=F?new _display_utils.StatTimer:null,this._pdfBug=F,this.commonObjs=U.commonObjs,this.objs=new PDFObjects,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport(){let{scale:j,rotation:T=this.rotate,offsetX:U=0,offsetY:F=0,dontFlip:H=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return new _display_utils.PageViewport({viewBox:this.view,scale:j,rotation:T,offsetX:U,offsetY:F,dontFlip:H})}getAnnotations(){let{intent:j="display"}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const T=this._transport.getRenderingIntent(j);return this._transport.getAnnotations(this._pageIndex,T.renderingIntent)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var j;return((j=this._transport._htmlForXfa)==null?void 0:j.children[this._pageIndex])||null}render(j){var P,D;let{canvasContext:T,viewport:U,intent:F="display",annotationMode:H=_util.AnnotationMode.ENABLE,transform:z=null,background:de=null,optionalContentConfigPromise:se=null,annotationCanvasMap:ue=null,pageColors:Z=null,printAnnotationStorage:ge=null}=j;(P=this._stats)==null||P.time("Overall");const re=this._transport.getRenderingIntent(F,H,ge);Ie(this,s,!1),Ae(this,a,hr).call(this),se||(se=this._transport.getOptionalContentConfig());let oe=this._intentStates.get(re.cacheKey);oe||(oe=Object.create(null),this._intentStates.set(re.cacheKey,oe)),oe.streamReaderCancelTimeout&&(clearTimeout(oe.streamReaderCancelTimeout),oe.streamReaderCancelTimeout=null);const be=!!(re.renderingIntent&_util.RenderingIntentFlag.PRINT);oe.displayReadyCapability||(oe.displayReadyCapability=new _util.PromiseCapability,oe.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(D=this._stats)==null||D.time("Page Request"),this._pumpOperatorList(re));const L=B=>{var G,J;oe.renderTasks.delete(S),(this._maybeCleanupAfterRender||be)&&Ie(this,s,!0),Ae(this,a,zt).call(this,!be),B?(S.capability.reject(B),this._abortOperatorList({intentState:oe,reason:B instanceof Error?B:new Error(B)})):S.capability.resolve(),(G=this._stats)==null||G.timeEnd("Rendering"),(J=this._stats)==null||J.timeEnd("Overall")},S=new InternalRenderTask({callback:L,params:{canvasContext:T,viewport:U,transform:z,background:de},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:ue,operatorList:oe.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!be,pdfBug:this._pdfBug,pageColors:Z});(oe.renderTasks||(oe.renderTasks=new Set)).add(S);const C=S.task;return Promise.all([oe.displayReadyCapability.promise,se]).then(B=>{var Y;let[G,J]=B;if(this.destroyed){L();return}(Y=this._stats)==null||Y.time("Rendering"),S.initializeGraphics({transparency:G,optionalContentConfig:J}),S.operatorListChanged()}).catch(L),C}getOperatorList(){var se;let{intent:j="display",annotationMode:T=_util.AnnotationMode.ENABLE,printAnnotationStorage:U=null}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};function F(){z.operatorList.lastChunk&&(z.opListReadCapability.resolve(z.operatorList),z.renderTasks.delete(de))}const H=this._transport.getRenderingIntent(j,T,U,!0);let z=this._intentStates.get(H.cacheKey);z||(z=Object.create(null),this._intentStates.set(H.cacheKey,z));let de;return z.opListReadCapability||(de=Object.create(null),de.operatorListChanged=F,z.opListReadCapability=new _util.PromiseCapability,(z.renderTasks||(z.renderTasks=new Set)).add(de),z.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(se=this._stats)==null||se.time("Page Request"),this._pumpOperatorList(H)),z.opListReadCapability.promise}streamTextContent(){let{includeMarkedContent:j=!1,disableNormalization:T=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:j===!0,disableNormalization:T===!0},{highWaterMark:100,size(F){return F.items.length}})}getTextContent(){let j=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this._transport._htmlForXfa)return this.getXfa().then(U=>_xfa_text.XfaText.textContent(U));const T=this.streamTextContent(j);return new Promise(function(U,F){function H(){z.read().then(function(se){let{value:ue,done:Z}=se;if(Z){U(de);return}Object.assign(de.styles,ue.styles),de.items.push(...ue.items),H()},F)}const z=T.getReader(),de={items:[],styles:Object.create(null)};H()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const j=[];for(const T of this._intentStates.values())if(this._abortOperatorList({intentState:T,reason:new Error("Page was destroyed."),force:!0}),!T.opListReadCapability)for(const U of T.renderTasks)j.push(U.completed),U.cancel();return this.objs.clear(),Ie(this,s,!1),Ae(this,a,hr).call(this),Promise.all(j)}cleanup(){let j=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;Ie(this,s,!0);const T=Ae(this,a,zt).call(this,!1);return j&&T&&this._stats&&(this._stats=new _display_utils.StatTimer),T}_startRenderPage(j,T){var F,H;const U=this._intentStates.get(T);U&&((F=this._stats)==null||F.timeEnd("Page Request"),(H=U.displayReadyCapability)==null||H.resolve(j))}_renderPageChunk(j,T){for(let U=0,F=j.length;U<F;U++)T.operatorList.fnArray.push(j.fnArray[U]),T.operatorList.argsArray.push(j.argsArray[U]);T.operatorList.lastChunk=j.lastChunk,T.operatorList.separateAnnots=j.separateAnnots;for(const U of T.renderTasks)U.operatorListChanged();j.lastChunk&&Ae(this,a,zt).call(this,!0)}_pumpOperatorList(j){let{renderingIntent:T,cacheKey:U,annotationStorageSerializable:F}=j;const{map:H,transfers:z}=F,se=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:T,cacheKey:U,annotationStorage:H},z).getReader(),ue=this._intentStates.get(U);ue.streamReader=se;const Z=()=>{se.read().then(ge=>{let{value:re,done:oe}=ge;if(oe){ue.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(re,ue),Z())},ge=>{if(ue.streamReader=null,!this._transport.destroyed){if(ue.operatorList){ue.operatorList.lastChunk=!0;for(const re of ue.renderTasks)re.operatorListChanged();Ae(this,a,zt).call(this,!0)}if(ue.displayReadyCapability)ue.displayReadyCapability.reject(ge);else if(ue.opListReadCapability)ue.opListReadCapability.reject(ge);else throw ge}})};Z()}_abortOperatorList(j){let{intentState:T,reason:U,force:F=!1}=j;if(T.streamReader){if(T.streamReaderCancelTimeout&&(clearTimeout(T.streamReaderCancelTimeout),T.streamReaderCancelTimeout=null),!F){if(T.renderTasks.size>0)return;if(U instanceof _display_utils.RenderingCancelledException){let H=RENDERING_CANCELLED_TIMEOUT;U.extraDelay>0&&U.extraDelay<1e3&&(H+=U.extraDelay),T.streamReaderCancelTimeout=setTimeout(()=>{T.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:T,reason:U,force:!0})},H);return}}if(T.streamReader.cancel(new _util.AbortException(U.message)).catch(()=>{}),T.streamReader=null,!this._transport.destroyed){for(const[H,z]of this._intentStates)if(z===T){this._intentStates.delete(H);break}this.cleanup()}}}get stats(){return this._stats}}e=new WeakMap,s=new WeakMap,a=new WeakSet,zt=function(){let j=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(Ae(this,a,hr).call(this),!O(this,s)||this.destroyed)return!1;if(j)return Ie(this,e,setTimeout(()=>{Ie(this,e,null),Ae(this,a,zt).call(this,!1)},DELAYED_CLEANUP_TIMEOUT)),!1;for(const{renderTasks:T,operatorList:U}of this._intentStates.values())if(T.size>0||!U.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),Ie(this,s,!1),!0},hr=function(){O(this,e)&&(clearTimeout(O(this,e)),Ie(this,e,null))},exports.PDFPageProxy=PDFPageProxy;class LoopbackPort{constructor(){ke(this,c,new Set);ke(this,h,Promise.resolve())}postMessage(j,T){const U={data:structuredClone(j,null)};O(this,h).then(()=>{for(const F of O(this,c))F.call(this,U)})}addEventListener(j,T){O(this,c).add(T)}removeEventListener(j,T){O(this,c).delete(T)}terminate(){O(this,c).clear()}}c=new WeakMap,h=new WeakMap,exports.LoopbackPort=LoopbackPort;const PDFWorkerUtil={isWorkerDisabled:!1,fallbackWorkerSrc:null,fakeWorkerId:0};exports.PDFWorkerUtil=PDFWorkerUtil;{if(_util.isNodeJS&&typeof commonjsRequire=="function")PDFWorkerUtil.isWorkerDisabled=!0,PDFWorkerUtil.fallbackWorkerSrc="./pdf.worker.js";else if(typeof document=="object"){const y=(u=document==null?void 0:document.currentScript)==null?void 0:u.src;y&&(PDFWorkerUtil.fallbackWorkerSrc=y.replace(/(\.(?:min\.)?js)(\?.*)?$/i,".worker$1$2"))}PDFWorkerUtil.isSameOrigin=function(y,j){let T;try{if(T=new URL(y),!T.origin||T.origin==="null")return!1}catch{return!1}const U=new URL(j,T);return T.origin===U.origin},PDFWorkerUtil.createCDNWrapper=function(y){const j=`importScripts("${y}");`;return URL.createObjectURL(new Blob([j]))}}const _PDFWorker=class _PDFWorker{constructor(){var U;let{name:y=null,port:j=null,verbosity:T=(0,_util.getVerbosityLevel)()}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this.name=y,this.destroyed=!1,this.verbosity=T,this._readyCapability=new _util.PromiseCapability,this._port=null,this._webWorker=null,this._messageHandler=null,j){if((U=O(_PDFWorker,d))!=null&&U.has(j))throw new Error("Cannot use more than one PDFWorker per port.");(O(_PDFWorker,d)||Ie(_PDFWorker,d,new WeakMap)).set(j,this),this._initializeFromPort(j);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(y){this._port=y,this._messageHandler=new _message_handler.MessageHandler("main","worker",y),this._messageHandler.on("ready",function(){}),this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})}_initialize(){if(!PDFWorkerUtil.isWorkerDisabled&&!_PDFWorker._mainThreadWorkerMessageHandler){let{workerSrc:y}=_PDFWorker;try{PDFWorkerUtil.isSameOrigin(window.location.href,y)||(y=PDFWorkerUtil.createCDNWrapper(new URL(y,window.location).href));const j=new Worker(y),T=new _message_handler.MessageHandler("main","worker",j),U=()=>{j.removeEventListener("error",F),T.destroy(),j.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},F=()=>{this._webWorker||U()};j.addEventListener("error",F),T.on("test",z=>{if(j.removeEventListener("error",F),this.destroyed){U();return}z?(this._messageHandler=T,this._port=j,this._webWorker=j,this._readyCapability.resolve(),T.send("configure",{verbosity:this.verbosity})):(this._setupFakeWorker(),T.destroy(),j.terminate())}),T.on("ready",z=>{if(j.removeEventListener("error",F),this.destroyed){U();return}try{H()}catch{this._setupFakeWorker()}});const H=()=>{const z=new Uint8Array;T.send("test",z,[z.buffer])};H();return}catch{(0,_util.info)("The worker has been disabled.")}}this._setupFakeWorker()}_setupFakeWorker(){PDFWorkerUtil.isWorkerDisabled||((0,_util.warn)("Setting up fake worker."),PDFWorkerUtil.isWorkerDisabled=!0),_PDFWorker._setupFakeWorkerGlobal.then(y=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const j=new LoopbackPort;this._port=j;const T=`fake${PDFWorkerUtil.fakeWorkerId++}`,U=new _message_handler.MessageHandler(T+"_worker",T,j);y.setup(U,j);const F=new _message_handler.MessageHandler(T,T+"_worker",j);this._messageHandler=F,this._readyCapability.resolve(),F.send("configure",{verbosity:this.verbosity})}).catch(y=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${y.message}".`))})}destroy(){var y;this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),(y=O(_PDFWorker,d))==null||y.delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(y){var T;if(!(y!=null&&y.port))throw new Error("PDFWorker.fromPort - invalid method signature.");const j=(T=O(this,d))==null?void 0:T.get(y.port);if(j){if(j._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return j}return new _PDFWorker(y)}static get workerSrc(){if(_worker_options.GlobalWorkerOptions.workerSrc)return _worker_options.GlobalWorkerOptions.workerSrc;if(PDFWorkerUtil.fallbackWorkerSrc!==null)return _util.isNodeJS||(0,_display_utils.deprecated)('No "GlobalWorkerOptions.workerSrc" specified.'),PDFWorkerUtil.fallbackWorkerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _mainThreadWorkerMessageHandler(){var y;try{return((y=globalThis.pdfjsWorker)==null?void 0:y.WorkerMessageHandler)||null}catch{return null}}static get _setupFakeWorkerGlobal(){const loader=async()=>{const mainWorkerMessageHandler=this._mainThreadWorkerMessageHandler;if(mainWorkerMessageHandler)return mainWorkerMessageHandler;if(_util.isNodeJS&&typeof commonjsRequire=="function"){const worker=eval("require")(this.workerSrc);return worker.WorkerMessageHandler}return await(0,_display_utils.loadScript)(this.workerSrc),window.pdfjsWorker.WorkerMessageHandler};return(0,_util.shadow)(this,"_setupFakeWorkerGlobal",loader())}};d=new WeakMap,ke(_PDFWorker,d);let PDFWorker=_PDFWorker;exports.PDFWorker=PDFWorker;class WorkerTransport{constructor(j,T,U,F,H){ke(this,x);ke(this,_,new Map);ke(this,b,new Map);ke(this,v,new Map);ke(this,E,null);this.messageHandler=j,this.loadingTask=T,this.commonObjs=new PDFObjects,this.fontLoader=new _font_loader.FontLoader({ownerDocument:F.ownerDocument,styleElement:F.styleElement}),this._params=F,this.canvasFactory=H.canvasFactory,this.filterFactory=H.filterFactory,this.cMapReaderFactory=H.cMapReaderFactory,this.standardFontDataFactory=H.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=U,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=new _util.PromiseCapability,this.setupMessageHandler()}get annotationStorage(){return(0,_util.shadow)(this,"annotationStorage",new _annotation_storage.AnnotationStorage)}getRenderingIntent(j){let T=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_util.AnnotationMode.ENABLE,U=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,F=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,H=_util.RenderingIntentFlag.DISPLAY,z=_annotation_storage.SerializableEmpty;switch(j){case"any":H=_util.RenderingIntentFlag.ANY;break;case"display":break;case"print":H=_util.RenderingIntentFlag.PRINT;break;default:(0,_util.warn)(`getRenderingIntent - invalid intent: ${j}`)}switch(T){case _util.AnnotationMode.DISABLE:H+=_util.RenderingIntentFlag.ANNOTATIONS_DISABLE;break;case _util.AnnotationMode.ENABLE:break;case _util.AnnotationMode.ENABLE_FORMS:H+=_util.RenderingIntentFlag.ANNOTATIONS_FORMS;break;case _util.AnnotationMode.ENABLE_STORAGE:H+=_util.RenderingIntentFlag.ANNOTATIONS_STORAGE,z=(H&_util.RenderingIntentFlag.PRINT&&U instanceof _annotation_storage.PrintAnnotationStorage?U:this.annotationStorage).serializable;break;default:(0,_util.warn)(`getRenderingIntent - invalid annotationMode: ${T}`)}return F&&(H+=_util.RenderingIntentFlag.OPLIST),{renderingIntent:H,cacheKey:`${H}_${z.hash}`,annotationStorageSerializable:z}}destroy(){var U;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=new _util.PromiseCapability,(U=O(this,E))==null||U.reject(new Error("Worker was destroyed during onPassword callback"));const j=[];for(const F of O(this,b).values())j.push(F._destroy());O(this,b).clear(),O(this,v).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const T=this.messageHandler.sendWithPromise("Terminate",null);return j.push(T),Promise.all(j).then(()=>{var F;this.commonObjs.clear(),this.fontLoader.clear(),O(this,_).clear(),this.filterFactory.destroy(),(F=this._networkStream)==null||F.cancelAllRequests(new _util.AbortException("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:j,loadingTask:T}=this;j.on("GetReader",(U,F)=>{(0,_util.assert)(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=H=>{this._lastProgress={loaded:H.loaded,total:H.total}},F.onPull=()=>{this._fullReader.read().then(function(H){let{value:z,done:de}=H;if(de){F.close();return}(0,_util.assert)(z instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),F.enqueue(new Uint8Array(z),1,[z])}).catch(H=>{F.error(H)})},F.onCancel=H=>{this._fullReader.cancel(H),F.ready.catch(z=>{if(!this.destroyed)throw z})}}),j.on("ReaderHeadersReady",U=>{const F=new _util.PromiseCapability,H=this._fullReader;return H.headersReady.then(()=>{var z;(!H.isStreamingSupported||!H.isRangeSupported)&&(this._lastProgress&&((z=T.onProgress)==null||z.call(T,this._lastProgress)),H.onProgress=de=>{var se;(se=T.onProgress)==null||se.call(T,{loaded:de.loaded,total:de.total})}),F.resolve({isStreamingSupported:H.isStreamingSupported,isRangeSupported:H.isRangeSupported,contentLength:H.contentLength})},F.reject),F.promise}),j.on("GetRangeReader",(U,F)=>{(0,_util.assert)(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const H=this._networkStream.getRangeReader(U.begin,U.end);if(!H){F.close();return}F.onPull=()=>{H.read().then(function(z){let{value:de,done:se}=z;if(se){F.close();return}(0,_util.assert)(de instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),F.enqueue(new Uint8Array(de),1,[de])}).catch(z=>{F.error(z)})},F.onCancel=z=>{H.cancel(z),F.ready.catch(de=>{if(!this.destroyed)throw de})}}),j.on("GetDoc",U=>{let{pdfInfo:F}=U;this._numPages=F.numPages,this._htmlForXfa=F.htmlForXfa,delete F.htmlForXfa,T._capability.resolve(new PDFDocumentProxy(F,this))}),j.on("DocException",function(U){let F;switch(U.name){case"PasswordException":F=new _util.PasswordException(U.message,U.code);break;case"InvalidPDFException":F=new _util.InvalidPDFException(U.message);break;case"MissingPDFException":F=new _util.MissingPDFException(U.message);break;case"UnexpectedResponseException":F=new _util.UnexpectedResponseException(U.message,U.status);break;case"UnknownErrorException":F=new _util.UnknownErrorException(U.message,U.details);break;default:(0,_util.unreachable)("DocException - expected a valid Error.")}T._capability.reject(F)}),j.on("PasswordRequest",U=>{if(Ie(this,E,new _util.PromiseCapability),T.onPassword){const F=H=>{H instanceof Error?O(this,E).reject(H):O(this,E).resolve({password:H})};try{T.onPassword(F,U.code)}catch(H){O(this,E).reject(H)}}else O(this,E).reject(new _util.PasswordException(U.message,U.code));return O(this,E).promise}),j.on("DataLoaded",U=>{var F;(F=T.onProgress)==null||F.call(T,{loaded:U.length,total:U.length}),this.downloadInfoCapability.resolve(U)}),j.on("StartRenderPage",U=>{if(this.destroyed)return;O(this,b).get(U.pageIndex)._startRenderPage(U.transparency,U.cacheKey)}),j.on("commonobj",U=>{var de;let[F,H,z]=U;if(!this.destroyed&&!this.commonObjs.has(F))switch(H){case"Font":const se=this._params;if("error"in z){const ge=z.error;(0,_util.warn)(`Error during font loading: ${ge}`),this.commonObjs.resolve(F,ge);break}const ue=se.pdfBug&&((de=globalThis.FontInspector)!=null&&de.enabled)?(ge,re)=>globalThis.FontInspector.fontAdded(ge,re):null,Z=new _font_loader.FontFaceObject(z,{isEvalSupported:se.isEvalSupported,disableFontFace:se.disableFontFace,ignoreErrors:se.ignoreErrors,inspectFont:ue});this.fontLoader.bind(Z).catch(ge=>j.sendWithPromise("FontFallback",{id:F})).finally(()=>{!se.fontExtraProperties&&Z.data&&(Z.data=null),this.commonObjs.resolve(F,Z)});break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(F,z);break;default:throw new Error(`Got unknown common object type ${H}`)}}),j.on("obj",U=>{var ue;let[F,H,z,de]=U;if(this.destroyed)return;const se=O(this,b).get(H);if(!se.objs.has(F))switch(z){case"Image":if(se.objs.resolve(F,de),de){let Z;if(de.bitmap){const{width:ge,height:re}=de;Z=ge*re*4}else Z=((ue=de.data)==null?void 0:ue.length)||0;Z>_util.MAX_IMAGE_SIZE_TO_CACHE&&(se._maybeCleanupAfterRender=!0)}break;case"Pattern":se.objs.resolve(F,de);break;default:throw new Error(`Got unknown object type ${z}`)}}),j.on("DocProgress",U=>{var F;this.destroyed||(F=T.onProgress)==null||F.call(T,{loaded:U.loaded,total:U.total})}),j.on("FetchBuiltInCMap",U=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.cMapReaderFactory?this.cMapReaderFactory.fetch(U):Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter."))),j.on("FetchStandardFontData",U=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.standardFontDataFactory?this.standardFontDataFactory.fetch(U):Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.")))}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var U;this.annotationStorage.size<=0&&(0,_util.warn)("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:j,transfers:T}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:j,filename:((U=this._fullReader)==null?void 0:U.filename)??null},T).finally(()=>{this.annotationStorage.resetModified()})}getPage(j){if(!Number.isInteger(j)||j<=0||j>this._numPages)return Promise.reject(new Error("Invalid page request."));const T=j-1,U=O(this,v).get(T);if(U)return U;const F=this.messageHandler.sendWithPromise("GetPage",{pageIndex:T}).then(H=>{if(this.destroyed)throw new Error("Transport destroyed");const z=new PDFPageProxy(T,H,this,this._params.pdfBug);return O(this,b).set(T,z),z});return O(this,v).set(T,F),F}getPageIndex(j){return typeof j!="object"||j===null||!Number.isInteger(j.num)||j.num<0||!Number.isInteger(j.gen)||j.gen<0?Promise.reject(new Error("Invalid pageIndex request.")):this.messageHandler.sendWithPromise("GetPageIndex",{num:j.num,gen:j.gen})}getAnnotations(j,T){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:j,intent:T})}getFieldObjects(){return Ae(this,x,fr).call(this,"GetFieldObjects")}hasJSActions(){return Ae(this,x,fr).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(j){return typeof j!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:j})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return Ae(this,x,fr).call(this,"GetDocJSActions")}getPageJSActions(j){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:j})}getStructTree(j){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:j})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(){return this.messageHandler.sendWithPromise("GetOptionalContentConfig",null).then(j=>new _optional_content_config.OptionalContentConfig(j))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const j="GetMetadata",T=O(this,_).get(j);if(T)return T;const U=this.messageHandler.sendWithPromise(j,null).then(F=>{var H,z;return{info:F[0],metadata:F[1]?new _metadata.Metadata(F[1]):null,contentDispositionFilename:((H=this._fullReader)==null?void 0:H.filename)??null,contentLength:((z=this._fullReader)==null?void 0:z.contentLength)??null}});return O(this,_).set(j,U),U}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(){let j=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const T of O(this,b).values())if(!T.cleanup())throw new Error(`startCleanup: Page ${T.pageNumber} is currently rendering.`);this.commonObjs.clear(),j||this.fontLoader.clear(),O(this,_).clear(),this.filterFactory.destroy(!0)}}get loadingParams(){const{disableAutoFetch:j,enableXfa:T}=this._params;return(0,_util.shadow)(this,"loadingParams",{disableAutoFetch:j,enableXfa:T})}}_=new WeakMap,b=new WeakMap,v=new WeakMap,E=new WeakMap,x=new WeakSet,fr=function(j){let T=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const U=O(this,_).get(j);if(U)return U;const F=this.messageHandler.sendWithPromise(j,T);return O(this,_).set(j,F),F};class PDFObjects{constructor(){ke(this,R);ke(this,w,Object.create(null))}get(j){let T=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(T){const F=Ae(this,R,Cr).call(this,j);return F.capability.promise.then(()=>T(F.data)),null}const U=O(this,w)[j];if(!(U!=null&&U.capability.settled))throw new Error(`Requesting object that isn't resolved yet ${j}.`);return U.data}has(j){const T=O(this,w)[j];return(T==null?void 0:T.capability.settled)||!1}resolve(j){let T=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const U=Ae(this,R,Cr).call(this,j);U.data=T,U.capability.resolve()}clear(){var j;for(const T in O(this,w)){const{data:U}=O(this,w)[T];(j=U==null?void 0:U.bitmap)==null||j.close()}Ie(this,w,Object.create(null))}}w=new WeakMap,R=new WeakSet,Cr=function(j){var T;return(T=O(this,w))[j]||(T[j]={capability:new _util.PromiseCapability,data:null})};class RenderTask{constructor(j){ke(this,M,null);Ie(this,M,j),this.onContinue=null}get promise(){return O(this,M).capability.promise}cancel(){let j=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;O(this,M).cancel(null,j)}get separateAnnots(){const{separateAnnots:j}=O(this,M).operatorList;if(!j)return!1;const{annotationCanvasMap:T}=O(this,M);return j.form||j.canvas&&(T==null?void 0:T.size)>0}}M=new WeakMap,exports.RenderTask=RenderTask;const I=class I{constructor(j){let{callback:T,params:U,objs:F,commonObjs:H,annotationCanvasMap:z,operatorList:de,pageIndex:se,canvasFactory:ue,filterFactory:Z,useRequestAnimationFrame:ge=!1,pdfBug:re=!1,pageColors:oe=null}=j;this.callback=T,this.params=U,this.objs=F,this.commonObjs=H,this.annotationCanvasMap=z,this.operatorListIdx=null,this.operatorList=de,this._pageIndex=se,this.canvasFactory=ue,this.filterFactory=Z,this._pdfBug=re,this.pageColors=oe,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=ge===!0&&typeof window<"u",this.cancelled=!1,this.capability=new _util.PromiseCapability,this.task=new RenderTask(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=U.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics(j){var se,ue;let{transparency:T=!1,optionalContentConfig:U}=j;if(this.cancelled)return;if(this._canvas){if(O(I,A).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");O(I,A).add(this._canvas)}this._pdfBug&&((se=globalThis.StepperManager)!=null&&se.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:F,viewport:H,transform:z,background:de}=this.params;this.gfx=new _canvas.CanvasGraphics(F,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:U},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:z,viewport:H,transparency:T,background:de}),this.operatorListIdx=0,this.graphicsReady=!0,(ue=this.graphicsReadyCallback)==null||ue.call(this)}cancel(){var U;let j=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,T=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;this.running=!1,this.cancelled=!0,(U=this.gfx)==null||U.endDrawing(),O(I,A).delete(this._canvas),this.callback(j||new _display_utils.RenderingCancelledException(`Rendering cancelled, page ${this._pageIndex+1}`,T))}operatorListChanged(){var j;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(j=this.stepper)==null||j.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?window.requestAnimationFrame(()=>{this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),O(I,A).delete(this._canvas),this.callback())))}};A=new WeakMap,ke(I,A,new WeakSet);let InternalRenderTask=I;const version="3.11.174";exports.version=version;const build="ce8716743";exports.build=build},(t,r,e)=>{var s=e(3),a=e(126),i=e(135);s({target:"Set",proto:!0,real:!0,forced:!i("difference")},{difference:a})},(t,r,e)=>{var s=e(127),a=e(128),i=e(129),o=e(132),c=e(133),h=e(130),u=e(131),d=a.has,_=a.remove;t.exports=function(v){var E=s(this),x=c(v),g=i(E);return o(E)<=x.size?h(E,function(w){x.includes(w)&&_(g,w)}):u(x.getIterator(),function(w){d(E,w)&&_(g,w)}),g}},(t,r,e)=>{var s=e(128).has;t.exports=function(a){return s(a),a}},(t,r,e)=>{var s=e(14),a=Set.prototype;t.exports={Set,add:s(a.add),has:s(a.has),remove:s(a.delete),proto:a}},(t,r,e)=>{var s=e(128),a=e(130),i=s.Set,o=s.add;t.exports=function(c){var h=new i;return a(c,function(u){o(h,u)}),h}},(t,r,e)=>{var s=e(14),a=e(131),i=e(128),o=i.Set,c=i.proto,h=s(c.forEach),u=s(c.keys),d=u(new o).next;t.exports=function(_,b,v){return v?a({iterator:u(_),next:d},b):h(_,b)}},(t,r,e)=>{var s=e(8);t.exports=function(a,i,o){for(var c=o?a:a.iterator,h=a.next,u,d;!(u=s(h,c)).done;)if(d=i(u.value),d!==void 0)return d}},(t,r,e)=>{var s=e(72),a=e(128);t.exports=s(a.proto,"size","get")||function(i){return i.size}},(t,r,e)=>{var s=e(31),a=e(47),i=e(8),o=e(62),c=e(134),h="Invalid size",u=RangeError,d=TypeError,_=Math.max,b=function(v,E,x,g){this.set=v,this.size=E,this.has=x,this.keys=g};b.prototype={getIterator:function(){return c(a(i(this.keys,this.set)))},includes:function(v){return i(this.has,this.set,v)}},t.exports=function(v){a(v);var E=+v.size;if(E!==E)throw d(h);var x=o(E);if(x<0)throw u(h);return new b(v,_(x,0),s(v.has),s(v.keys))}},t=>{t.exports=function(r){return{iterator:r,next:r.next,done:!1}}},(t,r,e)=>{var s=e(24),a=function(i){return{size:i,has:function(){return!1},keys:function(){return{next:function(){return{done:!0}}}}}};t.exports=function(i){var o=s("Set");try{new o()[i](a(0));try{return new o()[i](a(-1)),!1}catch{return!0}}catch{return!1}}},(t,r,e)=>{var s=e(3),a=e(7),i=e(137),o=e(135),c=!o("intersection")||a(function(){return Array.from(new Set([1,2,3]).intersection(new Set([3,2])))!=="3,2"});s({target:"Set",proto:!0,real:!0,forced:c},{intersection:i})},(t,r,e)=>{var s=e(127),a=e(128),i=e(132),o=e(133),c=e(130),h=e(131),u=a.Set,d=a.add,_=a.has;t.exports=function(v){var E=s(this),x=o(v),g=new u;return i(E)>x.size?h(x.getIterator(),function(w){_(E,w)&&d(g,w)}):c(E,function(w){x.includes(w)&&d(g,w)}),g}},(t,r,e)=>{var s=e(3),a=e(139),i=e(135);s({target:"Set",proto:!0,real:!0,forced:!i("isDisjointFrom")},{isDisjointFrom:a})},(t,r,e)=>{var s=e(127),a=e(128).has,i=e(132),o=e(133),c=e(130),h=e(131),u=e(140);t.exports=function(_){var b=s(this),v=o(_);if(i(b)<=v.size)return c(b,function(x){if(v.includes(x))return!1},!0)!==!1;var E=v.getIterator();return h(E,function(x){if(a(b,x))return u(E,"normal",!1)})!==!1}},(t,r,e)=>{var s=e(8),a=e(47),i=e(30);t.exports=function(o,c,h){var u,d;a(o);try{if(u=i(o,"return"),!u){if(c==="throw")throw h;return h}u=s(u,o)}catch(_){d=!0,u=_}if(c==="throw")throw h;if(d)throw u;return a(u),h}},(t,r,e)=>{var s=e(3),a=e(142),i=e(135);s({target:"Set",proto:!0,real:!0,forced:!i("isSubsetOf")},{isSubsetOf:a})},(t,r,e)=>{var s=e(127),a=e(132),i=e(130),o=e(133);t.exports=function(h){var u=s(this),d=o(h);return a(u)>d.size?!1:i(u,function(_){if(!d.includes(_))return!1},!0)!==!1}},(t,r,e)=>{var s=e(3),a=e(144),i=e(135);s({target:"Set",proto:!0,real:!0,forced:!i("isSupersetOf")},{isSupersetOf:a})},(t,r,e)=>{var s=e(127),a=e(128).has,i=e(132),o=e(133),c=e(131),h=e(140);t.exports=function(d){var _=s(this),b=o(d);if(i(_)<b.size)return!1;var v=b.getIterator();return c(v,function(E){if(!a(_,E))return h(v,"normal",!1)})!==!1}},(t,r,e)=>{var s=e(3),a=e(146),i=e(135);s({target:"Set",proto:!0,real:!0,forced:!i("symmetricDifference")},{symmetricDifference:a})},(t,r,e)=>{var s=e(127),a=e(128),i=e(129),o=e(133),c=e(131),h=a.add,u=a.has,d=a.remove;t.exports=function(b){var v=s(this),E=o(b).getIterator(),x=i(v);return c(E,function(g){u(v,g)?d(x,g):h(x,g)}),x}},(t,r,e)=>{var s=e(3),a=e(148),i=e(135);s({target:"Set",proto:!0,real:!0,forced:!i("union")},{union:a})},(t,r,e)=>{var s=e(127),a=e(128).add,i=e(129),o=e(133),c=e(131);t.exports=function(u){var d=s(this),_=o(u).getIterator(),b=i(d);return c(_,function(v){a(b,v)}),b}},(t,r,e)=>{var s=e(3),a=e(4),i=e(24),o=e(11),c=e(45).f,h=e(39),u=e(150),d=e(75),_=e(76),b=e(151),v=e(82),E=e(6),x=e(36),g="DOMException",w=i("Error"),R=i(g),N=function(){u(this,M);var ue=arguments.length,Z=_(ue<1?void 0:arguments[0]),ge=_(ue<2?void 0:arguments[1],"Error"),re=new R(Z,ge),oe=w(Z);return oe.name=g,c(re,"stack",o(1,v(oe.stack,1))),d(re,this,N),re},M=N.prototype=R.prototype,A="stack"in w(g),I="stack"in new R(1,2),y=R&&E&&Object.getOwnPropertyDescriptor(a,g),j=!!y&&!(y.writable&&y.configurable),T=A&&!j&&!I;s({global:!0,constructor:!0,forced:x||T},{DOMException:T?N:R});var U=i(g),F=U.prototype;if(F.constructor!==U){x||c(F,"constructor",o(1,U));for(var H in b)if(h(b,H)){var z=b[H],de=z.s;h(U,de)||c(U,de,o(6,z.c))}}},(t,r,e)=>{var s=e(25),a=TypeError;t.exports=function(i,o){if(s(o,i))return i;throw a("Incorrect invocation")}},t=>{t.exports={IndexSizeError:{s:"INDEX_SIZE_ERR",c:1,m:1},DOMStringSizeError:{s:"DOMSTRING_SIZE_ERR",c:2,m:0},HierarchyRequestError:{s:"HIERARCHY_REQUEST_ERR",c:3,m:1},WrongDocumentError:{s:"WRONG_DOCUMENT_ERR",c:4,m:1},InvalidCharacterError:{s:"INVALID_CHARACTER_ERR",c:5,m:1},NoDataAllowedError:{s:"NO_DATA_ALLOWED_ERR",c:6,m:0},NoModificationAllowedError:{s:"NO_MODIFICATION_ALLOWED_ERR",c:7,m:1},NotFoundError:{s:"NOT_FOUND_ERR",c:8,m:1},NotSupportedError:{s:"NOT_SUPPORTED_ERR",c:9,m:1},InUseAttributeError:{s:"INUSE_ATTRIBUTE_ERR",c:10,m:1},InvalidStateError:{s:"INVALID_STATE_ERR",c:11,m:1},SyntaxError:{s:"SYNTAX_ERR",c:12,m:1},InvalidModificationError:{s:"INVALID_MODIFICATION_ERR",c:13,m:1},NamespaceError:{s:"NAMESPACE_ERR",c:14,m:1},InvalidAccessError:{s:"INVALID_ACCESS_ERR",c:15,m:1},ValidationError:{s:"VALIDATION_ERR",c:16,m:0},TypeMismatchError:{s:"TYPE_MISMATCH_ERR",c:17,m:1},SecurityError:{s:"SECURITY_ERR",c:18,m:1},NetworkError:{s:"NETWORK_ERR",c:19,m:1},AbortError:{s:"ABORT_ERR",c:20,m:1},URLMismatchError:{s:"URL_MISMATCH_ERR",c:21,m:1},QuotaExceededError:{s:"QUOTA_EXCEEDED_ERR",c:22,m:1},TimeoutError:{s:"TIMEOUT_ERR",c:23,m:1},InvalidNodeTypeError:{s:"INVALID_NODE_TYPE_ERR",c:24,m:1},DataCloneError:{s:"DATA_CLONE_ERR",c:25,m:1}}},(t,r,e)=>{var s=e(36),a=e(3),i=e(4),o=e(24),c=e(14),h=e(7),u=e(41),d=e(21),_=e(153),b=e(17),v=e(20),E=e(23),x=e(154),g=e(47),w=e(78),R=e(39),N=e(159),M=e(44),A=e(64),I=e(85),y=e(160),j=e(162),T=e(128),U=e(83),F=e(119),H=i.Object,z=i.Array,de=i.Date,se=i.Error,ue=i.EvalError,Z=i.RangeError,ge=i.ReferenceError,re=i.SyntaxError,oe=i.TypeError,be=i.URIError,L=i.PerformanceMark,S=i.WebAssembly,C=S&&S.CompileError||se,P=S&&S.LinkError||se,D=S&&S.RuntimeError||se,B=o("DOMException"),G=j.Map,J=j.has,Y=j.get,me=j.set,Ee=T.Set,Re=T.add,Ne=o("Object","keys"),he=c([].push),pe=c((!0).valueOf),fe=c(1 .valueOf),W=c("".valueOf),Q=c(de.prototype.getTime),xe=u("structuredClone"),Se="DataCloneError",Ce="Transferring",Le=function(K){return!h(function(){var ye=new i.Set([7]),Ue=K(ye),ze=K(H(7));return Ue===ye||!Ue.has(7)||typeof ze!="object"||+ze!=7})&&K},De=function(K,ye){return!h(function(){var Ue=new ye,ze=K({a:Ue,b:Ue});return!(ze&&ze.a===ze.b&&ze.a instanceof ye&&ze.a.stack===Ue.stack)})},_e=function(K){return!h(function(){var ye=K(new i.AggregateError([1],xe,{cause:3}));return ye.name!=="AggregateError"||ye.errors[0]!==1||ye.message!==xe||ye.cause!==3})},Ge=i.structuredClone,Ye=s||!De(Ge,se)||!De(Ge,B)||!_e(Ge),ot=!Ge&&Le(function(K){return new L(xe,{detail:K}).detail}),st=Le(Ge)||ot,ht=function(K){throw new B("Uncloneable type: "+K,Se)},Je=function(K,ye){throw new B((ye||"Cloning")+" of "+K+" cannot be properly polyfilled in this engine",Se)},nt=function(K,ye){return st||Je(ye),st(K)},ct=function(){var K;try{K=new i.DataTransfer}catch{try{K=new i.ClipboardEvent("").clipboardData}catch{}}return K&&K.items&&K.files?K:null},ft=function(K,ye,Ue){if(J(ye,K))return Y(ye,K);var ze=Ue||w(K),Ke,Ve,ee,ne,ve,we;if(ze==="SharedArrayBuffer")st?Ke=st(K):Ke=K;else{var Te=i.DataView;!Te&&typeof K.slice!="function"&&Je("ArrayBuffer");try{if(typeof K.slice=="function"&&!K.resizable)Ke=K.slice(0);else for(Ve=K.byteLength,ee=("maxByteLength"in K)?{maxByteLength:K.maxByteLength}:void 0,Ke=new ArrayBuffer(Ve,ee),ne=new Te(K),ve=new Te(Ke),we=0;we<Ve;we++)ve.setUint8(we,ne.getUint8(we))}catch{throw new B("ArrayBuffer is detached",Se)}}return me(ye,K,Ke),Ke},pt=function(K,ye,Ue,ze,Ke){var Ve=i[ye];return v(Ve)||Je(ye),new Ve(ft(K.buffer,Ke),Ue,ze)},Xe=function(K,ye,Ue){this.object=K,this.type=ye,this.metadata=Ue},Pe=function(K,ye,Ue){if(E(K)&&ht("Symbol"),!v(K))return K;if(ye){if(J(ye,K))return Y(ye,K)}else ye=new G;var ze=w(K),Ke,Ve,ee,ne,ve,we,Te,We;switch(ze){case"Array":ee=z(A(K));break;case"Object":ee={};break;case"Map":ee=new G;break;case"Set":ee=new Ee;break;case"RegExp":ee=new RegExp(K.source,y(K));break;case"Error":switch(Ve=K.name,Ve){case"AggregateError":ee=o("AggregateError")([]);break;case"EvalError":ee=ue();break;case"RangeError":ee=Z();break;case"ReferenceError":ee=ge();break;case"SyntaxError":ee=re();break;case"TypeError":ee=oe();break;case"URIError":ee=be();break;case"CompileError":ee=C();break;case"LinkError":ee=P();break;case"RuntimeError":ee=D();break;default:ee=se()}break;case"DOMException":ee=new B(K.message,K.name);break;case"ArrayBuffer":case"SharedArrayBuffer":ee=Ue?new Xe(K,ze):ft(K,ye,ze);break;case"DataView":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float16Array":case"Float32Array":case"Float64Array":case"BigInt64Array":case"BigUint64Array":we=ze==="DataView"?K.byteLength:K.length,ee=Ue?new Xe(K,ze,{offset:K.byteOffset,length:we}):pt(K,ze,K.byteOffset,we,ye);break;case"DOMQuad":try{ee=new DOMQuad(Pe(K.p1,ye,Ue),Pe(K.p2,ye,Ue),Pe(K.p3,ye,Ue),Pe(K.p4,ye,Ue))}catch{ee=nt(K,ze)}break;case"File":if(st)try{ee=st(K),w(ee)!==ze&&(ee=void 0)}catch{}if(!ee)try{ee=new File([K],K.name,K)}catch{}ee||Je(ze);break;case"FileList":if(ne=ct(),ne){for(ve=0,we=A(K);ve<we;ve++)ne.items.add(Pe(K[ve],ye,Ue));ee=ne.files}else ee=nt(K,ze);break;case"ImageData":try{ee=new ImageData(Pe(K.data,ye,Ue),K.width,K.height,{colorSpace:K.colorSpace})}catch{ee=nt(K,ze)}break;default:if(st)ee=st(K);else switch(ze){case"BigInt":ee=H(K.valueOf());break;case"Boolean":ee=H(pe(K));break;case"Number":ee=H(fe(K));break;case"String":ee=H(W(K));break;case"Date":ee=new de(Q(K));break;case"Blob":try{ee=K.slice(0,K.size,K.type)}catch{Je(ze)}break;case"DOMPoint":case"DOMPointReadOnly":Ke=i[ze];try{ee=Ke.fromPoint?Ke.fromPoint(K):new Ke(K.x,K.y,K.z,K.w)}catch{Je(ze)}break;case"DOMRect":case"DOMRectReadOnly":Ke=i[ze];try{ee=Ke.fromRect?Ke.fromRect(K):new Ke(K.x,K.y,K.width,K.height)}catch{Je(ze)}break;case"DOMMatrix":case"DOMMatrixReadOnly":Ke=i[ze];try{ee=Ke.fromMatrix?Ke.fromMatrix(K):new Ke(K)}catch{Je(ze)}break;case"AudioData":case"VideoFrame":d(K.clone)||Je(ze);try{ee=K.clone()}catch{ht(ze)}break;case"CropTarget":case"CryptoKey":case"FileSystemDirectoryHandle":case"FileSystemFileHandle":case"FileSystemHandle":case"GPUCompilationInfo":case"GPUCompilationMessage":case"ImageBitmap":case"RTCCertificate":case"WebAssembly.Module":Je(ze);default:ht(ze)}}switch(me(ye,K,ee),ze){case"Array":case"Object":for(Te=Ne(K),ve=0,we=A(Te);ve<we;ve++)We=Te[ve],N(ee,We,Pe(K[We],ye,Ue));break;case"Map":K.forEach(function($e,tt){me(ee,Pe(tt,ye,Ue),Pe($e,ye,Ue))});break;case"Set":K.forEach(function($e){Re(ee,Pe($e,ye,Ue))});break;case"Error":M(ee,"message",Pe(K.message,ye,Ue)),R(K,"cause")&&M(ee,"cause",Pe(K.cause,ye,Ue)),Ve==="AggregateError"&&(ee.errors=Pe(K.errors,ye,Ue));case"DOMException":U&&M(ee,"stack",Pe(K.stack,ye,Ue))}return ee},je=function(K,ye){if(!v(K))return K;if(J(ye,K))return Y(ye,K);var Ue,ze,Ke,Ve,ee,ne,ve,we;if(K instanceof Xe)switch(Ue=K.type,ze=K.object,Ue){case"ArrayBuffer":case"SharedArrayBuffer":we=ft(ze,ye,Ue);break;case"DataView":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float16Array":case"Float32Array":case"Float64Array":case"BigInt64Array":case"BigUint64Array":Ke=K.metadata,we=pt(ze,Ue,Ke.offset,Ke.length,ye)}else switch(w(K)){case"Array":case"Object":for(ne=Ne(K),Ve=0,ee=A(ne);Ve<ee;Ve++)ve=ne[Ve],K[ve]=je(K[ve],ye);break;case"Map":we=new G,K.forEach(function(Te,We){me(we,je(We,ye),je(Te,ye))});break;case"Set":we=new Ee,K.forEach(function(Te){Re(we,je(Te,ye))});break;case"Error":K.message=je(K.message,ye),R(K,"cause")&&(K.cause=je(K.cause,ye)),K.name==="AggregateError"&&(K.errors=je(K.errors,ye));case"DOMException":U&&(K.stack=je(K.stack,ye))}return me(ye,K,we||K),we||K},Qe=function(K,ye){if(!v(K))throw oe("Transfer option cannot be converted to a sequence");var Ue=[];x(K,function($e){he(Ue,g($e))});for(var ze=0,Ke=A(Ue),Ve=[],ee,ne,ve,we,Te,We;ze<Ke;){if(ee=Ue[ze++],ne=w(ee),ne==="ArrayBuffer"){he(Ve,ee);continue}if(J(ye,ee))throw new B("Duplicate transferable",Se);if(F)we=Ge(ee,{transfer:[ee]});else switch(ne){case"ImageBitmap":ve=i.OffscreenCanvas,_(ve)||Je(ne,Ce);try{Te=new ve(ee.width,ee.height),We=Te.getContext("bitmaprenderer"),We.transferFromImageBitmap(ee),we=Te.transferToImageBitmap()}catch{}break;case"AudioData":case"VideoFrame":(!d(ee.clone)||!d(ee.close))&&Je(ne,Ce);try{we=ee.clone(),ee.close()}catch{}break;case"MediaSourceHandle":case"MessagePort":case"OffscreenCanvas":case"ReadableStream":case"TransformStream":case"WritableStream":Je(ne,Ce)}if(we===void 0)throw new B("This object cannot be transferred: "+ne,Se);me(ye,ee,we)}return Ve},ut=function(K,ye){for(var Ue=0,ze=A(K),Ke,Ve;Ue<ze;){if(Ke=K[Ue++],J(ye,Ke))throw new B("Duplicate transferable",Se);F?Ve=Ge(Ke,{transfer:[Ke]}):(d(Ke.transfer)||Je("ArrayBuffer",Ce),Ve=Ke.transfer()),me(ye,Ke,Ve)}};a({global:!0,enumerable:!0,sham:!F,forced:Ye},{structuredClone:function(ye){var Ue=I(arguments.length,1)>1&&!b(arguments[1])?g(arguments[1]):void 0,ze=Ue?Ue.transfer:void 0,Ke=!1,Ve,ee;ze!==void 0&&(Ve=new G,ee=Qe(ze,Ve),Ke=!!A(ee));var ne=Pe(ye,Ve,Ke);return Ke&&(Ve=new G,ut(ze,Ve),ne=je(ne,Ve)),ne}})},(t,r,e)=>{var s=e(14),a=e(7),i=e(21),o=e(78),c=e(24),h=e(51),u=function(){},d=[],_=c("Reflect","construct"),b=/^\s*(?:class|function)\b/,v=s(b.exec),E=!b.exec(u),x=function(R){if(!i(R))return!1;try{return _(u,d,R),!0}catch{return!1}},g=function(R){if(!i(R))return!1;switch(o(R)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return E||!!v(b,h(R))}catch{return!0}};g.sham=!0,t.exports=!_||a(function(){var w;return x(x.call)||!x(Object)||!x(function(){w=!0})||w})?g:x},(t,r,e)=>{var s=e(99),a=e(8),i=e(47),o=e(32),c=e(155),h=e(64),u=e(25),d=e(157),_=e(158),b=e(140),v=TypeError,E=function(g,w){this.stopped=g,this.result=w},x=E.prototype;t.exports=function(g,w,R){var N=R&&R.that,M=!!(R&&R.AS_ENTRIES),A=!!(R&&R.IS_RECORD),I=!!(R&&R.IS_ITERATOR),y=!!(R&&R.INTERRUPTED),j=s(w,N),T,U,F,H,z,de,se,ue=function(ge){return T&&b(T,"normal",ge),new E(!0,ge)},Z=function(ge){return M?(i(ge),y?j(ge[0],ge[1],ue):j(ge[0],ge[1])):y?j(ge,ue):j(ge)};if(A)T=g.iterator;else if(I)T=g;else{if(U=_(g),!U)throw v(o(g)+" is not iterable");if(c(U)){for(F=0,H=h(g);H>F;F++)if(z=Z(g[F]),z&&u(x,z))return z;return new E(!1)}T=d(g,U)}for(de=A?g.next:T.next;!(se=a(de,T)).done;){try{z=Z(se.value)}catch(ge){b(T,"throw",ge)}if(typeof z=="object"&&z&&u(x,z))return z}return new E(!1)}},(t,r,e)=>{var s=e(34),a=e(156),i=s("iterator"),o=Array.prototype;t.exports=function(c){return c!==void 0&&(a.Array===c||o[i]===c)}},t=>{t.exports={}},(t,r,e)=>{var s=e(8),a=e(31),i=e(47),o=e(32),c=e(158),h=TypeError;t.exports=function(u,d){var _=arguments.length<2?c(u):d;if(a(_))return i(s(_,u));throw h(o(u)+" is not iterable")}},(t,r,e)=>{var s=e(78),a=e(30),i=e(17),o=e(156),c=e(34),h=c("iterator");t.exports=function(u){if(!i(u))return a(u,h)||a(u,"@@iterator")||o[s(u)]}},(t,r,e)=>{var s=e(18),a=e(45),i=e(11);t.exports=function(o,c,h){var u=s(c);u in o?a.f(o,u,i(0,h)):o[u]=h}},(t,r,e)=>{var s=e(8),a=e(39),i=e(25),o=e(161),c=RegExp.prototype;t.exports=function(h){var u=h.flags;return u===void 0&&!("flags"in c)&&!a(h,"flags")&&i(c,h)?s(o,h):u}},(t,r,e)=>{var s=e(47);t.exports=function(){var a=s(this),i="";return a.hasIndices&&(i+="d"),a.global&&(i+="g"),a.ignoreCase&&(i+="i"),a.multiline&&(i+="m"),a.dotAll&&(i+="s"),a.unicode&&(i+="u"),a.unicodeSets&&(i+="v"),a.sticky&&(i+="y"),i}},(t,r,e)=>{var s=e(14),a=Map.prototype;t.exports={Map,set:s(a.set),get:s(a.get),has:s(a.has),remove:s(a.delete),proto:a}},(t,r,e)=>{var u,d,_,hs,v;Object.defineProperty(r,"__esModule",{value:!0}),r.SerializableEmpty=r.PrintAnnotationStorage=r.AnnotationStorage=void 0,e(89),e(149),e(152);var s=e(1),a=e(164),i=e(170);const o=Object.freeze({map:null,hash:"",transfers:void 0});r.SerializableEmpty=o;class c{constructor(){ke(this,_);ke(this,u,!1);ke(this,d,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(x,g){const w=O(this,d).get(x);return w===void 0?g:Object.assign(g,w)}getRawValue(x){return O(this,d).get(x)}remove(x){if(O(this,d).delete(x),O(this,d).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const g of O(this,d).values())if(g instanceof a.AnnotationEditor)return;this.onAnnotationEditor(null)}}setValue(x,g){const w=O(this,d).get(x);let R=!1;if(w!==void 0)for(const[N,M]of Object.entries(g))w[N]!==M&&(R=!0,w[N]=M);else R=!0,O(this,d).set(x,g);R&&Ae(this,_,hs).call(this),g instanceof a.AnnotationEditor&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(g.constructor._type)}has(x){return O(this,d).has(x)}getAll(){return O(this,d).size>0?(0,s.objectFromMap)(O(this,d)):null}setAll(x){for(const[g,w]of Object.entries(x))this.setValue(g,w)}get size(){return O(this,d).size}resetModified(){O(this,u)&&(Ie(this,u,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new h(this)}get serializable(){if(O(this,d).size===0)return o;const x=new Map,g=new i.MurmurHash3_64,w=[],R=Object.create(null);let N=!1;for(const[M,A]of O(this,d)){const I=A instanceof a.AnnotationEditor?A.serialize(!1,R):A;I&&(x.set(M,I),g.update(`${M}:${JSON.stringify(I)}`),N||(N=!!I.bitmap))}if(N)for(const M of x.values())M.bitmap&&w.push(M.bitmap);return x.size>0?{map:x,hash:g.hexdigest(),transfers:w}:o}}u=new WeakMap,d=new WeakMap,_=new WeakSet,hs=function(){O(this,u)||(Ie(this,u,!0),typeof this.onSetModified=="function"&&this.onSetModified())},r.AnnotationStorage=c;class h extends c{constructor(g){super();ke(this,v);const{map:w,hash:R,transfers:N}=g.serializable,M=structuredClone(w,null);Ie(this,v,{map:M,hash:R,transfers:N})}get print(){(0,s.unreachable)("Should not call PrintAnnotationStorage.print")}get serializable(){return O(this,v)}}v=new WeakMap,r.PrintAnnotationStorage=h},(t,r,e)=>{var h,u,d,_,b,v,E,x,g,w,R,N,M,A,I,Nr,jr,T,Pr,Fr,fs,ps,ms,kr,xs;Object.defineProperty(r,"__esModule",{value:!0}),r.AnnotationEditor=void 0,e(89),e(2);var s=e(165),a=e(1),i=e(168);const Z=class Z{constructor(re){ke(this,I);ke(this,h,"");ke(this,u,!1);ke(this,d,null);ke(this,_,null);ke(this,b,null);ke(this,v,!1);ke(this,E,null);ke(this,x,this.focusin.bind(this));ke(this,g,this.focusout.bind(this));ke(this,w,!1);ke(this,R,!1);ke(this,N,!1);bt(this,"_initialOptions",Object.create(null));bt(this,"_uiManager",null);bt(this,"_focusEventsAllowed",!0);bt(this,"_l10nPromise",null);ke(this,M,!1);ke(this,A,Z._zIndex++);this.constructor===Z&&(0,a.unreachable)("Cannot initialize AnnotationEditor."),this.parent=re.parent,this.id=re.id,this.width=this.height=null,this.pageIndex=re.parent.pageIndex,this.name=re.name,this.div=null,this._uiManager=re.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=re.isCentered,this._structTreeParentId=null;const{rotation:oe,rawDims:{pageWidth:be,pageHeight:L,pageX:S,pageY:C}}=this.parent.viewport;this.rotation=oe,this.pageRotation=(360+oe-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[be,L],this.pageTranslation=[S,C];const[P,D]=this.parentDimensions;this.x=re.x/P,this.y=re.y/D,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get _defaultLineColor(){return(0,a.shadow)(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(re){const oe=new c({id:re.parent.getNextId(),parent:re.parent,uiManager:re._uiManager});oe.annotationElementId=re.annotationElementId,oe.deleted=!0,oe._uiManager.addToAnnotationStorage(oe)}static initialize(re){let oe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(Z._l10nPromise||(Z._l10nPromise=new Map(["editor_alt_text_button_label","editor_alt_text_edit_button_label","editor_alt_text_decorative_tooltip"].map(L=>[L,re.get(L)]))),oe!=null&&oe.strings)for(const L of oe.strings)Z._l10nPromise.set(L,re.get(L));if(Z._borderLineWidth!==-1)return;const be=getComputedStyle(document.documentElement);Z._borderLineWidth=parseFloat(be.getPropertyValue("--outline-width"))||0}static updateDefaultParams(re,oe){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(re){return!1}static paste(re,oe){(0,a.unreachable)("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return O(this,M)}set _isDraggable(re){var oe;Ie(this,M,re),(oe=this.div)==null||oe.classList.toggle("draggable",re)}center(){const[re,oe]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*oe/(re*2),this.y+=this.width*re/(oe*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*oe/(re*2),this.y-=this.width*re/(oe*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(re){this._uiManager.addCommands(re)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=O(this,A)}setParent(re){re!==null&&(this.pageIndex=re.pageIndex,this.pageDimensions=re.pageDimensions),this.parent=re}focusin(re){this._focusEventsAllowed&&(O(this,w)?Ie(this,w,!1):this.parent.setSelected(this))}focusout(re){var be;if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;const oe=re.relatedTarget;oe!=null&&oe.closest(`#${this.id}`)||(re.preventDefault(),(be=this.parent)!=null&&be.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(re,oe,be,L){const[S,C]=this.parentDimensions;[be,L]=this.screenToPageTranslation(be,L),this.x=(re+be)/S,this.y=(oe+L)/C,this.fixAndSetPosition()}translate(re,oe){Ae(this,I,Nr).call(this,this.parentDimensions,re,oe)}translateInPage(re,oe){Ae(this,I,Nr).call(this,this.pageDimensions,re,oe),this.div.scrollIntoView({block:"nearest"})}drag(re,oe){const[be,L]=this.parentDimensions;if(this.x+=re/be,this.y+=oe/L,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:B,y:G}=this.div.getBoundingClientRect();this.parent.findNewParent(this,B,G)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:S,y:C}=this;const[P,D]=Ae(this,I,jr).call(this);S+=P,C+=D,this.div.style.left=`${(100*S).toFixed(2)}%`,this.div.style.top=`${(100*C).toFixed(2)}%`,this.div.scrollIntoView({block:"nearest"})}fixAndSetPosition(){const[re,oe]=this.pageDimensions;let{x:be,y:L,width:S,height:C}=this;switch(S*=re,C*=oe,be*=re,L*=oe,this.rotation){case 0:be=Math.max(0,Math.min(re-S,be)),L=Math.max(0,Math.min(oe-C,L));break;case 90:be=Math.max(0,Math.min(re-C,be)),L=Math.min(oe,Math.max(S,L));break;case 180:be=Math.min(re,Math.max(S,be)),L=Math.min(oe,Math.max(C,L));break;case 270:be=Math.min(re,Math.max(C,be)),L=Math.max(0,Math.min(oe-S,L));break}this.x=be/=re,this.y=L/=oe;const[P,D]=Ae(this,I,jr).call(this);be+=P,L+=D;const{style:B}=this.div;B.left=`${(100*be).toFixed(2)}%`,B.top=`${(100*L).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(re,oe){var be;return Ae(be=Z,T,Pr).call(be,re,oe,this.parentRotation)}pageTranslationToScreen(re,oe){var be;return Ae(be=Z,T,Pr).call(be,re,oe,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:re,pageDimensions:[oe,be]}=this,L=oe*re,S=be*re;return a.FeatureTest.isCSSRoundSupported?[Math.round(L),Math.round(S)]:[L,S]}setDims(re,oe){var S;const[be,L]=this.parentDimensions;this.div.style.width=`${(100*re/be).toFixed(2)}%`,O(this,v)||(this.div.style.height=`${(100*oe/L).toFixed(2)}%`),(S=O(this,d))==null||S.classList.toggle("small",re<Z.SMALL_EDITOR_SIZE||oe<Z.SMALL_EDITOR_SIZE)}fixDims(){const{style:re}=this.div,{height:oe,width:be}=re,L=be.endsWith("%"),S=!O(this,v)&&oe.endsWith("%");if(L&&S)return;const[C,P]=this.parentDimensions;L||(re.width=`${(100*parseFloat(be)/C).toFixed(2)}%`),!O(this,v)&&!S&&(re.height=`${(100*parseFloat(oe)/P).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}async addAltTextButton(){if(O(this,d))return;const re=Ie(this,d,document.createElement("button"));re.className="altText";const oe=await Z._l10nPromise.get("editor_alt_text_button_label");re.textContent=oe,re.setAttribute("aria-label",oe),re.tabIndex="0",re.addEventListener("contextmenu",i.noContextMenu),re.addEventListener("pointerdown",be=>be.stopPropagation()),re.addEventListener("click",be=>{be.preventDefault(),this._uiManager.editAltText(this)},{capture:!0}),re.addEventListener("keydown",be=>{be.target===re&&be.key==="Enter"&&(be.preventDefault(),this._uiManager.editAltText(this))}),Ae(this,I,kr).call(this),this.div.append(re),Z.SMALL_EDITOR_SIZE||(Z.SMALL_EDITOR_SIZE=Math.min(128,Math.round(re.getBoundingClientRect().width*1.4)))}getClientDimensions(){return this.div.getBoundingClientRect()}get altTextData(){return{altText:O(this,h),decorative:O(this,u)}}set altTextData(re){let{altText:oe,decorative:be}=re;O(this,h)===oe&&O(this,u)===be||(Ie(this,h,oe),Ie(this,u,be),Ae(this,I,kr).call(this))}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.setAttribute("tabIndex",0),this.setInForeground(),this.div.addEventListener("focusin",O(this,x)),this.div.addEventListener("focusout",O(this,g));const[re,oe]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*oe/re).toFixed(2)}%`,this.div.style.maxHeight=`${(100*re/oe).toFixed(2)}%`);const[be,L]=this.getInitialTranslation();return this.translate(be,L),(0,s.bindEvents)(this,this.div,["pointerdown"]),this.div}pointerdown(re){const{isMac:oe}=a.FeatureTest.platform;if(re.button!==0||re.ctrlKey&&oe){re.preventDefault();return}Ie(this,w,!0),Ae(this,I,xs).call(this,re)}moveInDOM(){var re;(re=this.parent)==null||re.moveEditorInDOM(this)}_setParentAndPosition(re,oe,be){re.changeParent(this),this.x=oe,this.y=be,this.fixAndSetPosition()}getRect(re,oe){const be=this.parentScale,[L,S]=this.pageDimensions,[C,P]=this.pageTranslation,D=re/be,B=oe/be,G=this.x*L,J=this.y*S,Y=this.width*L,me=this.height*S;switch(this.rotation){case 0:return[G+D+C,S-J-B-me+P,G+D+Y+C,S-J-B+P];case 90:return[G+B+C,S-J+D+P,G+B+me+C,S-J+D+Y+P];case 180:return[G-D-Y+C,S-J+B+P,G-D+C,S-J+B+me+P];case 270:return[G-B-me+C,S-J-D-Y+P,G-B+C,S-J-D+P];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(re,oe){const[be,L,S,C]=re,P=S-be,D=C-L;switch(this.rotation){case 0:return[be,oe-C,P,D];case 90:return[be,oe-L,D,P];case 180:return[S,oe-L,P,D];case 270:return[S,oe-C,D,P];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){Ie(this,N,!0)}disableEditMode(){Ie(this,N,!1)}isInEditMode(){return O(this,N)}shouldGetKeyboardEvents(){return!1}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}rebuild(){var re,oe;(re=this.div)==null||re.addEventListener("focusin",O(this,x)),(oe=this.div)==null||oe.addEventListener("focusout",O(this,g))}serialize(){(0,a.unreachable)("An editor must be serializable")}static deserialize(re,oe,be){const L=new this.prototype.constructor({parent:oe,id:oe.getNextId(),uiManager:be});L.rotation=re.rotation;const[S,C]=L.pageDimensions,[P,D,B,G]=L.getRectInCurrentCoords(re.rect,C);return L.x=P/S,L.y=D/C,L.width=B/S,L.height=G/C,L}remove(){var re;this.div.removeEventListener("focusin",O(this,x)),this.div.removeEventListener("focusout",O(this,g)),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),(re=O(this,d))==null||re.remove(),Ie(this,d,null),Ie(this,_,null)}get isResizable(){return!1}makeResizable(){this.isResizable&&(Ae(this,I,fs).call(this),O(this,E).classList.remove("hidden"))}select(){var re;this.makeResizable(),(re=this.div)==null||re.classList.add("selectedEditor")}unselect(){var re,oe,be;(re=O(this,E))==null||re.classList.add("hidden"),(oe=this.div)==null||oe.classList.remove("selectedEditor"),(be=this.div)!=null&&be.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus()}updateParams(re,oe){}disableEditing(){O(this,d)&&(O(this,d).hidden=!0)}enableEditing(){O(this,d)&&(O(this,d).hidden=!1)}enterInEditMode(){}get contentDiv(){return this.div}get isEditing(){return O(this,R)}set isEditing(re){Ie(this,R,re),this.parent&&(re?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(re,oe){Ie(this,v,!0);const be=re/oe,{style:L}=this.div;L.aspectRatio=be,L.height="auto"}static get MIN_SIZE(){return 16}};h=new WeakMap,u=new WeakMap,d=new WeakMap,_=new WeakMap,b=new WeakMap,v=new WeakMap,E=new WeakMap,x=new WeakMap,g=new WeakMap,w=new WeakMap,R=new WeakMap,N=new WeakMap,M=new WeakMap,A=new WeakMap,I=new WeakSet,Nr=function(re,oe,be){let[L,S]=re;[oe,be]=this.screenToPageTranslation(oe,be),this.x+=oe/L,this.y+=be/S,this.fixAndSetPosition()},jr=function(){const[re,oe]=this.parentDimensions,{_borderLineWidth:be}=Z,L=be/re,S=be/oe;switch(this.rotation){case 90:return[-L,S];case 180:return[L,S];case 270:return[L,-S];default:return[-L,-S]}},T=new WeakSet,Pr=function(re,oe,be){switch(be){case 90:return[oe,-re];case 180:return[-re,-oe];case 270:return[-oe,re];default:return[re,oe]}},Fr=function(re){switch(re){case 90:{const[oe,be]=this.pageDimensions;return[0,-oe/be,be/oe,0]}case 180:return[-1,0,0,-1];case 270:{const[oe,be]=this.pageDimensions;return[0,oe/be,-be/oe,0]}default:return[1,0,0,1]}},fs=function(){if(O(this,E))return;Ie(this,E,document.createElement("div")),O(this,E).classList.add("resizers");const re=["topLeft","topRight","bottomRight","bottomLeft"];this._willKeepAspectRatio||re.push("topMiddle","middleRight","bottomMiddle","middleLeft");for(const oe of re){const be=document.createElement("div");O(this,E).append(be),be.classList.add("resizer",oe),be.addEventListener("pointerdown",Ae(this,I,ps).bind(this,oe)),be.addEventListener("contextmenu",i.noContextMenu)}this.div.prepend(O(this,E))},ps=function(re,oe){oe.preventDefault();const{isMac:be}=a.FeatureTest.platform;if(oe.button!==0||oe.ctrlKey&&be)return;const L=Ae(this,I,ms).bind(this,re),S=this._isDraggable;this._isDraggable=!1;const C={passive:!0,capture:!0};window.addEventListener("pointermove",L,C);const P=this.x,D=this.y,B=this.width,G=this.height,J=this.parent.div.style.cursor,Y=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(oe.target).cursor;const me=()=>{this._isDraggable=S,window.removeEventListener("pointerup",me),window.removeEventListener("blur",me),window.removeEventListener("pointermove",L,C),this.parent.div.style.cursor=J,this.div.style.cursor=Y;const Ee=this.x,Re=this.y,Ne=this.width,he=this.height;Ee===P&&Re===D&&Ne===B&&he===G||this.addCommands({cmd:()=>{this.width=Ne,this.height=he,this.x=Ee,this.y=Re;const[pe,fe]=this.parentDimensions;this.setDims(pe*Ne,fe*he),this.fixAndSetPosition()},undo:()=>{this.width=B,this.height=G,this.x=P,this.y=D;const[pe,fe]=this.parentDimensions;this.setDims(pe*B,fe*G),this.fixAndSetPosition()},mustExec:!0})};window.addEventListener("pointerup",me),window.addEventListener("blur",me)},ms=function(re,oe){const[be,L]=this.parentDimensions,S=this.x,C=this.y,P=this.width,D=this.height,B=Z.MIN_SIZE/be,G=Z.MIN_SIZE/L,J=Je=>Math.round(Je*1e4)/1e4,Y=Ae(this,I,Fr).call(this,this.rotation),me=(Je,nt)=>[Y[0]*Je+Y[2]*nt,Y[1]*Je+Y[3]*nt],Ee=Ae(this,I,Fr).call(this,360-this.rotation),Re=(Je,nt)=>[Ee[0]*Je+Ee[2]*nt,Ee[1]*Je+Ee[3]*nt];let Ne,he,pe=!1,fe=!1;switch(re){case"topLeft":pe=!0,Ne=(Je,nt)=>[0,0],he=(Je,nt)=>[Je,nt];break;case"topMiddle":Ne=(Je,nt)=>[Je/2,0],he=(Je,nt)=>[Je/2,nt];break;case"topRight":pe=!0,Ne=(Je,nt)=>[Je,0],he=(Je,nt)=>[0,nt];break;case"middleRight":fe=!0,Ne=(Je,nt)=>[Je,nt/2],he=(Je,nt)=>[0,nt/2];break;case"bottomRight":pe=!0,Ne=(Je,nt)=>[Je,nt],he=(Je,nt)=>[0,0];break;case"bottomMiddle":Ne=(Je,nt)=>[Je/2,nt],he=(Je,nt)=>[Je/2,0];break;case"bottomLeft":pe=!0,Ne=(Je,nt)=>[0,nt],he=(Je,nt)=>[Je,0];break;case"middleLeft":fe=!0,Ne=(Je,nt)=>[0,nt/2],he=(Je,nt)=>[Je,nt/2];break}const W=Ne(P,D),Q=he(P,D);let xe=me(...Q);const Se=J(S+xe[0]),Ce=J(C+xe[1]);let Le=1,De=1,[_e,Ge]=this.screenToPageTranslation(oe.movementX,oe.movementY);if([_e,Ge]=Re(_e/be,Ge/L),pe){const Je=Math.hypot(P,D);Le=De=Math.max(Math.min(Math.hypot(Q[0]-W[0]-_e,Q[1]-W[1]-Ge)/Je,1/P,1/D),B/P,G/D)}else fe?Le=Math.max(B,Math.min(1,Math.abs(Q[0]-W[0]-_e)))/P:De=Math.max(G,Math.min(1,Math.abs(Q[1]-W[1]-Ge)))/D;const Ye=J(P*Le),ot=J(D*De);xe=me(...he(Ye,ot));const st=Se-xe[0],ht=Ce-xe[1];this.width=Ye,this.height=ot,this.x=st,this.y=ht,this.setDims(be*Ye,L*ot),this.fixAndSetPosition()},kr=async function(){var be;const re=O(this,d);if(!re)return;if(!O(this,h)&&!O(this,u)){re.classList.remove("done"),(be=O(this,_))==null||be.remove();return}Z._l10nPromise.get("editor_alt_text_edit_button_label").then(L=>{re.setAttribute("aria-label",L)});let oe=O(this,_);if(!oe){Ie(this,_,oe=document.createElement("span")),oe.className="tooltip",oe.setAttribute("role","tooltip");const L=oe.id=`alt-text-tooltip-${this.id}`;re.setAttribute("aria-describedby",L);const S=100;re.addEventListener("mouseenter",()=>{Ie(this,b,setTimeout(()=>{Ie(this,b,null),O(this,_).classList.add("show"),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",subtype:this.editorType,data:{action:"alt_text_tooltip"}}})},S))}),re.addEventListener("mouseleave",()=>{var C;clearTimeout(O(this,b)),Ie(this,b,null),(C=O(this,_))==null||C.classList.remove("show")})}re.classList.add("done"),oe.innerText=O(this,u)?await Z._l10nPromise.get("editor_alt_text_decorative_tooltip"):O(this,h),oe.parentNode||re.append(oe)},xs=function(re){if(!this._isDraggable)return;const oe=this._uiManager.isSelected(this);this._uiManager.setUpDragSession();let be,L;oe&&(be={passive:!0,capture:!0},L=C=>{const[P,D]=this.screenToPageTranslation(C.movementX,C.movementY);this._uiManager.dragSelectedEditors(P,D)},window.addEventListener("pointermove",L,be));const S=()=>{if(window.removeEventListener("pointerup",S),window.removeEventListener("blur",S),oe&&window.removeEventListener("pointermove",L,be),Ie(this,w,!1),!this._uiManager.endDragSession()){const{isMac:C}=a.FeatureTest.platform;re.ctrlKey&&!C||re.shiftKey||re.metaKey&&C?this.parent.toggleSelected(this):this.parent.setSelected(this)}};window.addEventListener("pointerup",S),window.addEventListener("blur",S)},ke(Z,T),bt(Z,"_borderLineWidth",-1),bt(Z,"_colorManager",new s.ColorManager),bt(Z,"_zIndex",1),bt(Z,"SMALL_EDITOR_SIZE",0);let o=Z;r.AnnotationEditor=o;class c extends o{constructor(re){super(re),this.annotationElementId=re.annotationElementId,this.deleted=!0}serialize(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex}}}},(t,r,e)=>{var v,E,x,g,w,Ir,M,A,I,y,j,gs,F,H,z,de,se,ue,Z,ge,re,oe,be,L,S,C,P,D,B,G,J,Y,me,Ee,Re,Ne,he,pe,fe,W,Q,xe,Se,Ce,Le,De,_e,vs,Mr,Or,pr,Dr,Lr,It,er,Es,bs,Br,tr,Ur;Object.defineProperty(r,"__esModule",{value:!0}),r.KeyboardManager=r.CommandManager=r.ColorManager=r.AnnotationEditorUIManager=void 0,r.bindEvents=i,r.opacityToHex=o,e(93),e(101),e(102),e(105),e(107),e(109),e(113),e(116),e(123),e(2),e(89),e(125),e(136),e(138),e(141),e(143),e(145),e(147),e(166);var s=e(1),a=e(168);function i(ut,K,ye){for(const Ue of ye)K.addEventListener(Ue,ut[Ue].bind(ut))}function o(ut){return Math.round(Math.min(255,Math.max(1,255*ut))).toString(16).padStart(2,"0")}class c{constructor(){ke(this,v,0)}getId(){return`${s.AnnotationEditorPrefix}${qt(this,v)._++}`}}v=new WeakMap;const N=class N{constructor(){ke(this,w);ke(this,E,(0,s.getUuid)());ke(this,x,0);ke(this,g,null)}static get _isSVGFittingCanvas(){const K='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',Ue=new OffscreenCanvas(1,3).getContext("2d"),ze=new Image;ze.src=K;const Ke=ze.decode().then(()=>(Ue.drawImage(ze,0,0,1,1,0,0,1,3),new Uint32Array(Ue.getImageData(0,0,1,1).data.buffer)[0]===0));return(0,s.shadow)(this,"_isSVGFittingCanvas",Ke)}async getFromFile(K){const{lastModified:ye,name:Ue,size:ze,type:Ke}=K;return Ae(this,w,Ir).call(this,`${ye}_${Ue}_${ze}_${Ke}`,K)}async getFromUrl(K){return Ae(this,w,Ir).call(this,K,K)}async getFromId(K){O(this,g)||Ie(this,g,new Map);const ye=O(this,g).get(K);return ye?ye.bitmap?(ye.refCounter+=1,ye):ye.file?this.getFromFile(ye.file):this.getFromUrl(ye.url):null}getSvgUrl(K){const ye=O(this,g).get(K);return ye!=null&&ye.isSvg?ye.svgUrl:null}deleteId(K){O(this,g)||Ie(this,g,new Map);const ye=O(this,g).get(K);ye&&(ye.refCounter-=1,ye.refCounter===0&&(ye.bitmap=null))}isValidId(K){return K.startsWith(`image_${O(this,E)}_`)}};E=new WeakMap,x=new WeakMap,g=new WeakMap,w=new WeakSet,Ir=async function(K,ye){O(this,g)||Ie(this,g,new Map);let Ue=O(this,g).get(K);if(Ue===null)return null;if(Ue!=null&&Ue.bitmap)return Ue.refCounter+=1,Ue;try{Ue||(Ue={bitmap:null,id:`image_${O(this,E)}_${qt(this,x)._++}`,refCounter:0,isSvg:!1});let ze;if(typeof ye=="string"){Ue.url=ye;const Ke=await fetch(ye);if(!Ke.ok)throw new Error(Ke.statusText);ze=await Ke.blob()}else ze=Ue.file=ye;if(ze.type==="image/svg+xml"){const Ke=N._isSVGFittingCanvas,Ve=new FileReader,ee=new Image,ne=new Promise((ve,we)=>{ee.onload=()=>{Ue.bitmap=ee,Ue.isSvg=!0,ve()},Ve.onload=async()=>{const Te=Ue.svgUrl=Ve.result;ee.src=await Ke?`${Te}#svgView(preserveAspectRatio(none))`:Te},ee.onerror=Ve.onerror=we});Ve.readAsDataURL(ze),await ne}else Ue.bitmap=await createImageBitmap(ze);Ue.refCounter=1}catch(ze){console.error(ze),Ue=null}return O(this,g).set(K,Ue),Ue&&O(this,g).set(Ue.id,Ue),Ue};let h=N;class u{constructor(){ke(this,M,[]);ke(this,A,!1);ke(this,I);ke(this,y,-1);let K=arguments.length>0&&arguments[0]!==void 0?arguments[0]:128;Ie(this,I,K)}add(K){let{cmd:ye,undo:Ue,mustExec:ze,type:Ke=NaN,overwriteIfSameType:Ve=!1,keepUndo:ee=!1}=K;if(ze&&ye(),O(this,A))return;const ne={cmd:ye,undo:Ue,type:Ke};if(O(this,y)===-1){O(this,M).length>0&&(O(this,M).length=0),Ie(this,y,0),O(this,M).push(ne);return}if(Ve&&O(this,M)[O(this,y)].type===Ke){ee&&(ne.undo=O(this,M)[O(this,y)].undo),O(this,M)[O(this,y)]=ne;return}const ve=O(this,y)+1;ve===O(this,I)?O(this,M).splice(0,1):(Ie(this,y,ve),ve<O(this,M).length&&O(this,M).splice(ve)),O(this,M).push(ne)}undo(){O(this,y)!==-1&&(Ie(this,A,!0),O(this,M)[O(this,y)].undo(),Ie(this,A,!1),Ie(this,y,O(this,y)-1))}redo(){O(this,y)<O(this,M).length-1&&(Ie(this,y,O(this,y)+1),Ie(this,A,!0),O(this,M)[O(this,y)].cmd(),Ie(this,A,!1))}hasSomethingToUndo(){return O(this,y)!==-1}hasSomethingToRedo(){return O(this,y)<O(this,M).length-1}destroy(){Ie(this,M,null)}}M=new WeakMap,A=new WeakMap,I=new WeakMap,y=new WeakMap,r.CommandManager=u;class d{constructor(K){ke(this,j);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:ye}=s.FeatureTest.platform;for(const[Ue,ze,Ke={}]of K)for(const Ve of Ue){const ee=Ve.startsWith("mac+");ye&&ee?(this.callbacks.set(Ve.slice(4),{callback:ze,options:Ke}),this.allKeys.add(Ve.split("+").at(-1))):!ye&&!ee&&(this.callbacks.set(Ve,{callback:ze,options:Ke}),this.allKeys.add(Ve.split("+").at(-1)))}}exec(K,ye){if(!this.allKeys.has(ye.key))return;const Ue=this.callbacks.get(Ae(this,j,gs).call(this,ye));if(!Ue)return;const{callback:ze,options:{bubbles:Ke=!1,args:Ve=[],checker:ee=null}}=Ue;ee&&!ee(K,ye)||(ze.bind(K,...Ve)(),Ke||(ye.stopPropagation(),ye.preventDefault()))}}j=new WeakSet,gs=function(K){K.altKey&&this.buffer.push("alt"),K.ctrlKey&&this.buffer.push("ctrl"),K.metaKey&&this.buffer.push("meta"),K.shiftKey&&this.buffer.push("shift"),this.buffer.push(K.key);const ye=this.buffer.join("+");return this.buffer.length=0,ye},r.KeyboardManager=d;const U=class U{get _colors(){const K=new Map([["CanvasText",null],["Canvas",null]]);return(0,a.getColorValues)(K),(0,s.shadow)(this,"_colors",K)}convert(K){const ye=(0,a.getRGB)(K);if(!window.matchMedia("(forced-colors: active)").matches)return ye;for(const[Ue,ze]of this._colors)if(ze.every((Ke,Ve)=>Ke===ye[Ve]))return U._colorsMapping.get(Ue);return ye}getHexCode(K){const ye=this._colors.get(K);return ye?s.Util.makeHexColor(...ye):K}};bt(U,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));let _=U;r.ColorManager=_;const Qe=class Qe{constructor(K,ye,Ue,ze,Ke,Ve){ke(this,_e);ke(this,F,null);ke(this,H,new Map);ke(this,z,new Map);ke(this,de,null);ke(this,se,null);ke(this,ue,new u);ke(this,Z,0);ke(this,ge,new Set);ke(this,re,null);ke(this,oe,null);ke(this,be,new Set);ke(this,L,null);ke(this,S,new c);ke(this,C,!1);ke(this,P,!1);ke(this,D,null);ke(this,B,s.AnnotationEditorType.NONE);ke(this,G,new Set);ke(this,J,null);ke(this,Y,this.blur.bind(this));ke(this,me,this.focus.bind(this));ke(this,Ee,this.copy.bind(this));ke(this,Re,this.cut.bind(this));ke(this,Ne,this.paste.bind(this));ke(this,he,this.keydown.bind(this));ke(this,pe,this.onEditingAction.bind(this));ke(this,fe,this.onPageChanging.bind(this));ke(this,W,this.onScaleChanging.bind(this));ke(this,Q,this.onRotationChanging.bind(this));ke(this,xe,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1});ke(this,Se,[0,0]);ke(this,Ce,null);ke(this,Le,null);ke(this,De,null);Ie(this,Le,K),Ie(this,De,ye),Ie(this,de,Ue),this._eventBus=ze,this._eventBus._on("editingaction",O(this,pe)),this._eventBus._on("pagechanging",O(this,fe)),this._eventBus._on("scalechanging",O(this,W)),this._eventBus._on("rotationchanging",O(this,Q)),Ie(this,se,Ke.annotationStorage),Ie(this,L,Ke.filterFactory),Ie(this,J,Ve),this.viewParameters={realScale:a.PixelsPerInch.PDF_TO_CSS_UNITS,rotation:0}}static get _keyboardManager(){const K=Qe.prototype,ye=Ke=>{const{activeElement:Ve}=document;return Ve&&O(Ke,Le).contains(Ve)&&Ke.hasSomethingToControl()},Ue=this.TRANSLATE_SMALL,ze=this.TRANSLATE_BIG;return(0,s.shadow)(this,"_keyboardManager",new d([[["ctrl+a","mac+meta+a"],K.selectAll],[["ctrl+z","mac+meta+z"],K.undo],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],K.redo],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],K.delete],[["Escape","mac+Escape"],K.unselectAll],[["ArrowLeft","mac+ArrowLeft"],K.translateSelectedEditors,{args:[-Ue,0],checker:ye}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],K.translateSelectedEditors,{args:[-ze,0],checker:ye}],[["ArrowRight","mac+ArrowRight"],K.translateSelectedEditors,{args:[Ue,0],checker:ye}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],K.translateSelectedEditors,{args:[ze,0],checker:ye}],[["ArrowUp","mac+ArrowUp"],K.translateSelectedEditors,{args:[0,-Ue],checker:ye}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],K.translateSelectedEditors,{args:[0,-ze],checker:ye}],[["ArrowDown","mac+ArrowDown"],K.translateSelectedEditors,{args:[0,Ue],checker:ye}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],K.translateSelectedEditors,{args:[0,ze],checker:ye}]]))}destroy(){Ae(this,_e,pr).call(this),Ae(this,_e,Mr).call(this),this._eventBus._off("editingaction",O(this,pe)),this._eventBus._off("pagechanging",O(this,fe)),this._eventBus._off("scalechanging",O(this,W)),this._eventBus._off("rotationchanging",O(this,Q));for(const K of O(this,z).values())K.destroy();O(this,z).clear(),O(this,H).clear(),O(this,be).clear(),Ie(this,F,null),O(this,G).clear(),O(this,ue).destroy(),O(this,de).destroy()}get hcmFilter(){return(0,s.shadow)(this,"hcmFilter",O(this,J)?O(this,L).addHCMFilter(O(this,J).foreground,O(this,J).background):"none")}get direction(){return(0,s.shadow)(this,"direction",getComputedStyle(O(this,Le)).direction)}editAltText(K){var ye;(ye=O(this,de))==null||ye.editAltText(this,K)}onPageChanging(K){let{pageNumber:ye}=K;Ie(this,Z,ye-1)}focusMainContainer(){O(this,Le).focus()}findParent(K,ye){for(const Ue of O(this,z).values()){const{x:ze,y:Ke,width:Ve,height:ee}=Ue.div.getBoundingClientRect();if(K>=ze&&K<=ze+Ve&&ye>=Ke&&ye<=Ke+ee)return Ue}return null}disableUserSelect(){let K=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;O(this,De).classList.toggle("noUserSelect",K)}addShouldRescale(K){O(this,be).add(K)}removeShouldRescale(K){O(this,be).delete(K)}onScaleChanging(K){let{scale:ye}=K;this.commitOrRemove(),this.viewParameters.realScale=ye*a.PixelsPerInch.PDF_TO_CSS_UNITS;for(const Ue of O(this,be))Ue.onScaleChanging()}onRotationChanging(K){let{pagesRotation:ye}=K;this.commitOrRemove(),this.viewParameters.rotation=ye}addToAnnotationStorage(K){!K.isEmpty()&&O(this,se)&&!O(this,se).has(K.id)&&O(this,se).setValue(K.id,K)}blur(){if(!this.hasSelection)return;const{activeElement:K}=document;for(const ye of O(this,G))if(ye.div.contains(K)){Ie(this,D,[ye,K]),ye._focusEventsAllowed=!1;break}}focus(){if(!O(this,D))return;const[K,ye]=O(this,D);Ie(this,D,null),ye.addEventListener("focusin",()=>{K._focusEventsAllowed=!0},{once:!0}),ye.focus()}addEditListeners(){Ae(this,_e,Or).call(this),Ae(this,_e,Dr).call(this)}removeEditListeners(){Ae(this,_e,pr).call(this),Ae(this,_e,Lr).call(this)}copy(K){var Ue;if(K.preventDefault(),(Ue=O(this,F))==null||Ue.commitOrRemove(),!this.hasSelection)return;const ye=[];for(const ze of O(this,G)){const Ke=ze.serialize(!0);Ke&&ye.push(Ke)}ye.length!==0&&K.clipboardData.setData("application/pdfjs",JSON.stringify(ye))}cut(K){this.copy(K),this.delete()}paste(K){K.preventDefault();const{clipboardData:ye}=K;for(const Ke of ye.items)for(const Ve of O(this,oe))if(Ve.isHandlingMimeForPasting(Ke.type)){Ve.paste(Ke,this.currentLayer);return}let Ue=ye.getData("application/pdfjs");if(!Ue)return;try{Ue=JSON.parse(Ue)}catch(Ke){(0,s.warn)(`paste: "${Ke.message}".`);return}if(!Array.isArray(Ue))return;this.unselectAll();const ze=this.currentLayer;try{const Ke=[];for(const ne of Ue){const ve=ze.deserialize(ne);if(!ve)return;Ke.push(ve)}const Ve=()=>{for(const ne of Ke)Ae(this,_e,Br).call(this,ne);Ae(this,_e,Ur).call(this,Ke)},ee=()=>{for(const ne of Ke)ne.remove()};this.addCommands({cmd:Ve,undo:ee,mustExec:!0})}catch(Ke){(0,s.warn)(`paste: "${Ke.message}".`)}}keydown(K){var ye;(ye=this.getActive())!=null&&ye.shouldGetKeyboardEvents()||Qe._keyboardManager.exec(this,K)}onEditingAction(K){["undo","redo","delete","selectAll"].includes(K.name)&&this[K.name]()}setEditingState(K){K?(Ae(this,_e,vs).call(this),Ae(this,_e,Or).call(this),Ae(this,_e,Dr).call(this),Ae(this,_e,It).call(this,{isEditing:O(this,B)!==s.AnnotationEditorType.NONE,isEmpty:Ae(this,_e,tr).call(this),hasSomethingToUndo:O(this,ue).hasSomethingToUndo(),hasSomethingToRedo:O(this,ue).hasSomethingToRedo(),hasSelectedEditor:!1})):(Ae(this,_e,Mr).call(this),Ae(this,_e,pr).call(this),Ae(this,_e,Lr).call(this),Ae(this,_e,It).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(K){if(!O(this,oe)){Ie(this,oe,K);for(const ye of O(this,oe))Ae(this,_e,er).call(this,ye.defaultPropertiesToUpdate)}}getId(){return O(this,S).getId()}get currentLayer(){return O(this,z).get(O(this,Z))}getLayer(K){return O(this,z).get(K)}get currentPageIndex(){return O(this,Z)}addLayer(K){O(this,z).set(K.pageIndex,K),O(this,C)?K.enable():K.disable()}removeLayer(K){O(this,z).delete(K.pageIndex)}updateMode(K){let ye=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(O(this,B)!==K){if(Ie(this,B,K),K===s.AnnotationEditorType.NONE){this.setEditingState(!1),Ae(this,_e,bs).call(this);return}this.setEditingState(!0),Ae(this,_e,Es).call(this),this.unselectAll();for(const Ue of O(this,z).values())Ue.updateMode(K);if(ye){for(const Ue of O(this,H).values())if(Ue.annotationElementId===ye){this.setSelected(Ue),Ue.enterInEditMode();break}}}}updateToolbar(K){K!==O(this,B)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:K})}updateParams(K,ye){if(O(this,oe)){if(K===s.AnnotationEditorParamsType.CREATE){this.currentLayer.addNewEditor(K);return}for(const Ue of O(this,G))Ue.updateParams(K,ye);for(const Ue of O(this,oe))Ue.updateDefaultParams(K,ye)}}enableWaiting(){let K=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(O(this,P)!==K){Ie(this,P,K);for(const ye of O(this,z).values())K?ye.disableClick():ye.enableClick(),ye.div.classList.toggle("waiting",K)}}getEditors(K){const ye=[];for(const Ue of O(this,H).values())Ue.pageIndex===K&&ye.push(Ue);return ye}getEditor(K){return O(this,H).get(K)}addEditor(K){O(this,H).set(K.id,K)}removeEditor(K){var ye;O(this,H).delete(K.id),this.unselect(K),(!K.annotationElementId||!O(this,ge).has(K.annotationElementId))&&((ye=O(this,se))==null||ye.remove(K.id))}addDeletedAnnotationElement(K){O(this,ge).add(K.annotationElementId),K.deleted=!0}isDeletedAnnotationElement(K){return O(this,ge).has(K)}removeDeletedAnnotationElement(K){O(this,ge).delete(K.annotationElementId),K.deleted=!1}setActiveEditor(K){O(this,F)!==K&&(Ie(this,F,K),K&&Ae(this,_e,er).call(this,K.propertiesToUpdate))}toggleSelected(K){if(O(this,G).has(K)){O(this,G).delete(K),K.unselect(),Ae(this,_e,It).call(this,{hasSelectedEditor:this.hasSelection});return}O(this,G).add(K),K.select(),Ae(this,_e,er).call(this,K.propertiesToUpdate),Ae(this,_e,It).call(this,{hasSelectedEditor:!0})}setSelected(K){for(const ye of O(this,G))ye!==K&&ye.unselect();O(this,G).clear(),O(this,G).add(K),K.select(),Ae(this,_e,er).call(this,K.propertiesToUpdate),Ae(this,_e,It).call(this,{hasSelectedEditor:!0})}isSelected(K){return O(this,G).has(K)}unselect(K){K.unselect(),O(this,G).delete(K),Ae(this,_e,It).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return O(this,G).size!==0}undo(){O(this,ue).undo(),Ae(this,_e,It).call(this,{hasSomethingToUndo:O(this,ue).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:Ae(this,_e,tr).call(this)})}redo(){O(this,ue).redo(),Ae(this,_e,It).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:O(this,ue).hasSomethingToRedo(),isEmpty:Ae(this,_e,tr).call(this)})}addCommands(K){O(this,ue).add(K),Ae(this,_e,It).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:Ae(this,_e,tr).call(this)})}delete(){if(this.commitOrRemove(),!this.hasSelection)return;const K=[...O(this,G)],ye=()=>{for(const ze of K)ze.remove()},Ue=()=>{for(const ze of K)Ae(this,_e,Br).call(this,ze)};this.addCommands({cmd:ye,undo:Ue,mustExec:!0})}commitOrRemove(){var K;(K=O(this,F))==null||K.commitOrRemove()}hasSomethingToControl(){return O(this,F)||this.hasSelection}selectAll(){for(const K of O(this,G))K.commit();Ae(this,_e,Ur).call(this,O(this,H).values())}unselectAll(){if(O(this,F)){O(this,F).commitOrRemove();return}if(this.hasSelection){for(const K of O(this,G))K.unselect();O(this,G).clear(),Ae(this,_e,It).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(K,ye){if((arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1)||this.commitOrRemove(),!this.hasSelection)return;O(this,Se)[0]+=K,O(this,Se)[1]+=ye;const[ze,Ke]=O(this,Se),Ve=[...O(this,G)],ee=1e3;O(this,Ce)&&clearTimeout(O(this,Ce)),Ie(this,Ce,setTimeout(()=>{Ie(this,Ce,null),O(this,Se)[0]=O(this,Se)[1]=0,this.addCommands({cmd:()=>{for(const ne of Ve)O(this,H).has(ne.id)&&ne.translateInPage(ze,Ke)},undo:()=>{for(const ne of Ve)O(this,H).has(ne.id)&&ne.translateInPage(-ze,-Ke)},mustExec:!1})},ee));for(const ne of Ve)ne.translateInPage(K,ye)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),Ie(this,re,new Map);for(const K of O(this,G))O(this,re).set(K,{savedX:K.x,savedY:K.y,savedPageIndex:K.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!O(this,re))return!1;this.disableUserSelect(!1);const K=O(this,re);Ie(this,re,null);let ye=!1;for(const[{x:ze,y:Ke,pageIndex:Ve},ee]of K)ee.newX=ze,ee.newY=Ke,ee.newPageIndex=Ve,ye||(ye=ze!==ee.savedX||Ke!==ee.savedY||Ve!==ee.savedPageIndex);if(!ye)return!1;const Ue=(ze,Ke,Ve,ee)=>{if(O(this,H).has(ze.id)){const ne=O(this,z).get(ee);ne?ze._setParentAndPosition(ne,Ke,Ve):(ze.pageIndex=ee,ze.x=Ke,ze.y=Ve)}};return this.addCommands({cmd:()=>{for(const[ze,{newX:Ke,newY:Ve,newPageIndex:ee}]of K)Ue(ze,Ke,Ve,ee)},undo:()=>{for(const[ze,{savedX:Ke,savedY:Ve,savedPageIndex:ee}]of K)Ue(ze,Ke,Ve,ee)},mustExec:!0}),!0}dragSelectedEditors(K,ye){if(O(this,re))for(const Ue of O(this,re).keys())Ue.drag(K,ye)}rebuild(K){if(K.parent===null){const ye=this.getLayer(K.pageIndex);ye?(ye.changeParent(K),ye.addOrRebuild(K)):(this.addEditor(K),this.addToAnnotationStorage(K),K.rebuild())}else K.parent.addOrRebuild(K)}isActive(K){return O(this,F)===K}getActive(){return O(this,F)}getMode(){return O(this,B)}get imageManager(){return(0,s.shadow)(this,"imageManager",new h)}};F=new WeakMap,H=new WeakMap,z=new WeakMap,de=new WeakMap,se=new WeakMap,ue=new WeakMap,Z=new WeakMap,ge=new WeakMap,re=new WeakMap,oe=new WeakMap,be=new WeakMap,L=new WeakMap,S=new WeakMap,C=new WeakMap,P=new WeakMap,D=new WeakMap,B=new WeakMap,G=new WeakMap,J=new WeakMap,Y=new WeakMap,me=new WeakMap,Ee=new WeakMap,Re=new WeakMap,Ne=new WeakMap,he=new WeakMap,pe=new WeakMap,fe=new WeakMap,W=new WeakMap,Q=new WeakMap,xe=new WeakMap,Se=new WeakMap,Ce=new WeakMap,Le=new WeakMap,De=new WeakMap,_e=new WeakSet,vs=function(){window.addEventListener("focus",O(this,me)),window.addEventListener("blur",O(this,Y))},Mr=function(){window.removeEventListener("focus",O(this,me)),window.removeEventListener("blur",O(this,Y))},Or=function(){window.addEventListener("keydown",O(this,he),{capture:!0})},pr=function(){window.removeEventListener("keydown",O(this,he),{capture:!0})},Dr=function(){document.addEventListener("copy",O(this,Ee)),document.addEventListener("cut",O(this,Re)),document.addEventListener("paste",O(this,Ne))},Lr=function(){document.removeEventListener("copy",O(this,Ee)),document.removeEventListener("cut",O(this,Re)),document.removeEventListener("paste",O(this,Ne))},It=function(K){Object.entries(K).some(Ue=>{let[ze,Ke]=Ue;return O(this,xe)[ze]!==Ke})&&this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(O(this,xe),K)})},er=function(K){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:K})},Es=function(){if(!O(this,C)){Ie(this,C,!0);for(const K of O(this,z).values())K.enable()}},bs=function(){if(this.unselectAll(),O(this,C)){Ie(this,C,!1);for(const K of O(this,z).values())K.disable()}},Br=function(K){const ye=O(this,z).get(K.pageIndex);ye?ye.addOrRebuild(K):this.addEditor(K)},tr=function(){if(O(this,H).size===0)return!0;if(O(this,H).size===1)for(const K of O(this,H).values())return K.isEmpty();return!1},Ur=function(K){O(this,G).clear();for(const ye of K)ye.isEmpty()||(O(this,G).add(ye),ye.select());Ae(this,_e,It).call(this,{hasSelectedEditor:!0})},bt(Qe,"TRANSLATE_SMALL",1),bt(Qe,"TRANSLATE_BIG",10);let b=Qe;r.AnnotationEditorUIManager=b},(t,r,e)=>{var s=e(3),a=e(6),i=e(4),o=e(24),c=e(14),h=e(8),u=e(21),d=e(20),_=e(91),b=e(39),v=e(77),E=e(64),x=e(159),g=e(7),w=e(167),R=e(27),N=i.JSON,M=i.Number,A=i.SyntaxError,I=N&&N.parse,y=o("Object","keys"),j=Object.getOwnPropertyDescriptor,T=c("".charAt),U=c("".slice),F=c(/./.exec),H=c([].push),z=/^\d$/,de=/^[1-9]$/,se=/^(?:-|\d)$/,ue=/^[\t\n\r ]$/,Z=0,ge=1,re=function(D,B){D=v(D);var G=new S(D,0),J=G.parse(),Y=J.value,me=G.skip(ue,J.end);if(me<D.length)throw A('Unexpected extra character: "'+T(D,me)+'" after the parsed data at: '+me);return u(B)?oe({"":Y},"",B,J):Y},oe=function(D,B,G,J){var Y=D[B],me=J&&Y===J.value,Ee=me&&typeof J.source=="string"?{source:J.source}:{},Re,Ne,he,pe,fe;if(d(Y)){var W=_(Y),Q=me?J.nodes:W?[]:{};if(W)for(Re=Q.length,he=E(Y),pe=0;pe<he;pe++)be(Y,pe,oe(Y,""+pe,G,pe<Re?Q[pe]:void 0));else for(Ne=y(Y),he=E(Ne),pe=0;pe<he;pe++)fe=Ne[pe],be(Y,fe,oe(Y,fe,G,b(Q,fe)?Q[fe]:void 0))}return h(G,D,B,Y,Ee)},be=function(D,B,G){if(a){var J=j(D,B);if(J&&!J.configurable)return}G===void 0?delete D[B]:x(D,B,G)},L=function(D,B,G,J){this.value=D,this.end=B,this.source=G,this.nodes=J},S=function(D,B){this.source=D,this.index=B};S.prototype={fork:function(D){return new S(this.source,D)},parse:function(){var D=this.source,B=this.skip(ue,this.index),G=this.fork(B),J=T(D,B);if(F(se,J))return G.number();switch(J){case"{":return G.object();case"[":return G.array();case'"':return G.string();case"t":return G.keyword(!0);case"f":return G.keyword(!1);case"n":return G.keyword(null)}throw A('Unexpected character: "'+J+'" at: '+B)},node:function(D,B,G,J,Y){return new L(B,J,D?null:U(this.source,G,J),Y)},object:function(){for(var D=this.source,B=this.index+1,G=!1,J={},Y={};B<D.length;){if(B=this.until(['"',"}"],B),T(D,B)==="}"&&!G){B++;break}var me=this.fork(B).string(),Ee=me.value;B=me.end,B=this.until([":"],B)+1,B=this.skip(ue,B),me=this.fork(B).parse(),x(Y,Ee,me),x(J,Ee,me.value),B=this.until([",","}"],me.end);var Re=T(D,B);if(Re===",")G=!0,B++;else if(Re==="}"){B++;break}}return this.node(ge,J,this.index,B,Y)},array:function(){for(var D=this.source,B=this.index+1,G=!1,J=[],Y=[];B<D.length;){if(B=this.skip(ue,B),T(D,B)==="]"&&!G){B++;break}var me=this.fork(B).parse();if(H(Y,me),H(J,me.value),B=this.until([",","]"],me.end),T(D,B)===",")G=!0,B++;else if(T(D,B)==="]"){B++;break}}return this.node(ge,J,this.index,B,Y)},string:function(){var D=this.index,B=w(this.source,this.index+1);return this.node(Z,B.value,D,B.end)},number:function(){var D=this.source,B=this.index,G=B;if(T(D,G)==="-"&&G++,T(D,G)==="0")G++;else if(F(de,T(D,G)))G=this.skip(z,++G);else throw A("Failed to parse number at: "+G);if(T(D,G)==="."&&(G=this.skip(z,++G)),T(D,G)==="e"||T(D,G)==="E"){G++,(T(D,G)==="+"||T(D,G)==="-")&&G++;var J=G;if(G=this.skip(z,G),J===G)throw A("Failed to parse number's exponent value at: "+G)}return this.node(Z,M(U(D,B,G)),B,G)},keyword:function(D){var B=""+D,G=this.index,J=G+B.length;if(U(this.source,G,J)!==B)throw A("Failed to parse value at: "+G);return this.node(Z,D,G,J)},skip:function(D,B){for(var G=this.source;B<G.length&&F(D,T(G,B));B++);return B},until:function(D,B){B=this.skip(ue,B);for(var G=T(this.source,B),J=0;J<D.length;J++)if(D[J]===G)return B;throw A('Unexpected character: "'+G+'" at: '+B)}};var C=g(function(){var D="9007199254740993",B;return I(D,function(G,J,Y){B=Y.source}),B!==D}),P=R&&!g(function(){return 1/I("-0 	")!==-1/0});s({target:"JSON",stat:!0,forced:C},{parse:function(B,G){return P&&!u(G)?I(B):re(B,G)}})},(t,r,e)=>{var s=e(14),a=e(39),i=SyntaxError,o=parseInt,c=String.fromCharCode,h=s("".charAt),u=s("".slice),d=s(/./.exec),_={'\\"':'"',"\\\\":"\\","\\/":"/","\\b":"\b","\\f":"\f","\\n":`
`,"\\r":"\r","\\t":"	"},b=/^[\da-f]{4}$/i,v=/^[\u0000-\u001F]$/;t.exports=function(E,x){for(var g=!0,w="";x<E.length;){var R=h(E,x);if(R==="\\"){var N=u(E,x,x+2);if(a(_,N))w+=_[N],x+=2;else if(N==="\\u"){x+=2;var M=u(E,x,x+4);if(!d(b,M))throw i("Bad Unicode escape at: "+x);w+=c(o(M,16)),x+=4}else throw i('Unknown escape sequence: "'+N+'"')}else if(R==='"'){g=!1,x++;break}else{if(d(v,R))throw i("Bad control character in string literal at: "+x);w+=R,x++}}if(g)throw i("Unterminated string at: "+x);return{value:w,end:x}}},(t,r,e)=>{var Z,ge,re,oe,be,L,S,C,P,D,B,G,Gt,Xt,Wr,mr,xr,rr,sr;Object.defineProperty(r,"__esModule",{value:!0}),r.StatTimer=r.RenderingCancelledException=r.PixelsPerInch=r.PageViewport=r.PDFDateString=r.DOMStandardFontDataFactory=r.DOMSVGFactory=r.DOMFilterFactory=r.DOMCanvasFactory=r.DOMCMapReaderFactory=void 0,r.deprecated=y,r.getColorValues=H,r.getCurrentTransform=z,r.getCurrentTransformInverse=de,r.getFilenameFromUrl=w,r.getPdfFilenameFromUrl=R,r.getRGB=F,r.getXfaPageViewport=U,r.isDataScheme=x,r.isPdfFile=g,r.isValidFetchUrl=M,r.loadScript=I,r.noContextMenu=A,r.setLayerDimensions=se,e(2),e(93),e(101),e(102),e(105),e(107),e(109),e(113),e(116),e(123),e(89),e(84),e(86),e(87);var s=e(169),a=e(1);const i="http://www.w3.org/2000/svg",ue=class ue{};bt(ue,"CSS",96),bt(ue,"PDF",72),bt(ue,"PDF_TO_CSS_UNITS",ue.CSS/ue.PDF);let o=ue;r.PixelsPerInch=o;class c extends s.BaseFilterFactory{constructor(){let{docId:W,ownerDocument:Q=globalThis.document}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super();ke(this,G);ke(this,Z);ke(this,ge);ke(this,re);ke(this,oe);ke(this,be);ke(this,L);ke(this,S);ke(this,C);ke(this,P);ke(this,D);ke(this,B,0);Ie(this,re,W),Ie(this,oe,Q)}addFilter(W){if(!W)return"none";let Q=O(this,G,Gt).get(W);if(Q)return Q;let xe,Se,Ce,Le;if(W.length===1){const Ye=W[0],ot=new Array(256);for(let st=0;st<256;st++)ot[st]=Ye[st]/255;Le=xe=Se=Ce=ot.join(",")}else{const[Ye,ot,st]=W,ht=new Array(256),Je=new Array(256),nt=new Array(256);for(let ct=0;ct<256;ct++)ht[ct]=Ye[ct]/255,Je[ct]=ot[ct]/255,nt[ct]=st[ct]/255;xe=ht.join(","),Se=Je.join(","),Ce=nt.join(","),Le=`${xe}${Se}${Ce}`}if(Q=O(this,G,Gt).get(Le),Q)return O(this,G,Gt).set(W,Q),Q;const De=`g_${O(this,re)}_transfer_map_${qt(this,B)._++}`,_e=`url(#${De})`;O(this,G,Gt).set(W,_e),O(this,G,Gt).set(Le,_e);const Ge=Ae(this,G,mr).call(this,De);return Ae(this,G,rr).call(this,xe,Se,Ce,Ge),_e}addHCMFilter(W,Q){var ot;const xe=`${W}-${Q}`;if(O(this,L)===xe)return O(this,S);if(Ie(this,L,xe),Ie(this,S,"none"),(ot=O(this,be))==null||ot.remove(),!W||!Q)return O(this,S);const Se=Ae(this,G,sr).call(this,W);W=a.Util.makeHexColor(...Se);const Ce=Ae(this,G,sr).call(this,Q);if(Q=a.Util.makeHexColor(...Ce),O(this,G,Xt).style.color="",W==="#000000"&&Q==="#ffffff"||W===Q)return O(this,S);const Le=new Array(256);for(let st=0;st<=255;st++){const ht=st/255;Le[st]=ht<=.03928?ht/12.92:((ht+.055)/1.055)**2.4}const De=Le.join(","),_e=`g_${O(this,re)}_hcm_filter`,Ge=Ie(this,C,Ae(this,G,mr).call(this,_e));Ae(this,G,rr).call(this,De,De,De,Ge),Ae(this,G,Wr).call(this,Ge);const Ye=(st,ht)=>{const Je=Se[st]/255,nt=Ce[st]/255,ct=new Array(ht+1);for(let ft=0;ft<=ht;ft++)ct[ft]=Je+ft/ht*(nt-Je);return ct.join(",")};return Ae(this,G,rr).call(this,Ye(0,5),Ye(1,5),Ye(2,5),Ge),Ie(this,S,`url(#${_e})`),O(this,S)}addHighlightHCMFilter(W,Q,xe,Se){var nt;const Ce=`${W}-${Q}-${xe}-${Se}`;if(O(this,P)===Ce)return O(this,D);if(Ie(this,P,Ce),Ie(this,D,"none"),(nt=O(this,C))==null||nt.remove(),!W||!Q)return O(this,D);const[Le,De]=[W,Q].map(Ae(this,G,sr).bind(this));let _e=Math.round(.2126*Le[0]+.7152*Le[1]+.0722*Le[2]),Ge=Math.round(.2126*De[0]+.7152*De[1]+.0722*De[2]),[Ye,ot]=[xe,Se].map(Ae(this,G,sr).bind(this));Ge<_e&&([_e,Ge,Ye,ot]=[Ge,_e,ot,Ye]),O(this,G,Xt).style.color="";const st=(ct,ft,pt)=>{const Xe=new Array(256),Pe=(Ge-_e)/pt,je=ct/255,Qe=(ft-ct)/(255*pt);let ut=0;for(let K=0;K<=pt;K++){const ye=Math.round(_e+K*Pe),Ue=je+K*Qe;for(let ze=ut;ze<=ye;ze++)Xe[ze]=Ue;ut=ye+1}for(let K=ut;K<256;K++)Xe[K]=Xe[ut-1];return Xe.join(",")},ht=`g_${O(this,re)}_hcm_highlight_filter`,Je=Ie(this,C,Ae(this,G,mr).call(this,ht));return Ae(this,G,Wr).call(this,Je),Ae(this,G,rr).call(this,st(Ye[0],ot[0],5),st(Ye[1],ot[1],5),st(Ye[2],ot[2],5),Je),Ie(this,D,`url(#${ht})`),O(this,D)}destroy(){arguments.length>0&&arguments[0]!==void 0&&arguments[0]&&(O(this,S)||O(this,D))||(O(this,ge)&&(O(this,ge).parentNode.parentNode.remove(),Ie(this,ge,null)),O(this,Z)&&(O(this,Z).clear(),Ie(this,Z,null)),Ie(this,B,0))}}Z=new WeakMap,ge=new WeakMap,re=new WeakMap,oe=new WeakMap,be=new WeakMap,L=new WeakMap,S=new WeakMap,C=new WeakMap,P=new WeakMap,D=new WeakMap,B=new WeakMap,G=new WeakSet,Gt=function(){return O(this,Z)||Ie(this,Z,new Map)},Xt=function(){if(!O(this,ge)){const W=O(this,oe).createElement("div"),{style:Q}=W;Q.visibility="hidden",Q.contain="strict",Q.width=Q.height=0,Q.position="absolute",Q.top=Q.left=0,Q.zIndex=-1;const xe=O(this,oe).createElementNS(i,"svg");xe.setAttribute("width",0),xe.setAttribute("height",0),Ie(this,ge,O(this,oe).createElementNS(i,"defs")),W.append(xe),xe.append(O(this,ge)),O(this,oe).body.append(W)}return O(this,ge)},Wr=function(W){const Q=O(this,oe).createElementNS(i,"feColorMatrix");Q.setAttribute("type","matrix"),Q.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),W.append(Q)},mr=function(W){const Q=O(this,oe).createElementNS(i,"filter");return Q.setAttribute("color-interpolation-filters","sRGB"),Q.setAttribute("id",W),O(this,G,Xt).append(Q),Q},xr=function(W,Q,xe){const Se=O(this,oe).createElementNS(i,Q);Se.setAttribute("type","discrete"),Se.setAttribute("tableValues",xe),W.append(Se)},rr=function(W,Q,xe,Se){const Ce=O(this,oe).createElementNS(i,"feComponentTransfer");Se.append(Ce),Ae(this,G,xr).call(this,Ce,"feFuncR",W),Ae(this,G,xr).call(this,Ce,"feFuncG",Q),Ae(this,G,xr).call(this,Ce,"feFuncB",xe)},sr=function(W){return O(this,G,Xt).style.color=W,F(getComputedStyle(O(this,G,Xt)).getPropertyValue("color"))},r.DOMFilterFactory=c;class h extends s.BaseCanvasFactory{constructor(){let{ownerDocument:fe=globalThis.document}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this._document=fe}_createCanvas(fe,W){const Q=this._document.createElement("canvas");return Q.width=fe,Q.height=W,Q}}r.DOMCanvasFactory=h;async function u(pe){let fe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(M(pe,document.baseURI)){const W=await fetch(pe);if(!W.ok)throw new Error(W.statusText);return fe?new Uint8Array(await W.arrayBuffer()):(0,a.stringToBytes)(await W.text())}return new Promise((W,Q)=>{const xe=new XMLHttpRequest;xe.open("GET",pe,!0),fe&&(xe.responseType="arraybuffer"),xe.onreadystatechange=()=>{if(xe.readyState===XMLHttpRequest.DONE){if(xe.status===200||xe.status===0){let Se;if(fe&&xe.response?Se=new Uint8Array(xe.response):!fe&&xe.responseText&&(Se=(0,a.stringToBytes)(xe.responseText)),Se){W(Se);return}}Q(new Error(xe.statusText))}},xe.send(null)})}class d extends s.BaseCMapReaderFactory{_fetchData(fe,W){return u(fe,this.isCompressed).then(Q=>({cMapData:Q,compressionType:W}))}}r.DOMCMapReaderFactory=d;class _ extends s.BaseStandardFontDataFactory{_fetchData(fe){return u(fe,!0)}}r.DOMStandardFontDataFactory=_;class b extends s.BaseSVGFactory{_createSVG(fe){return document.createElementNS(i,fe)}}r.DOMSVGFactory=b;class v{constructor(fe){let{viewBox:W,scale:Q,rotation:xe,offsetX:Se=0,offsetY:Ce=0,dontFlip:Le=!1}=fe;this.viewBox=W,this.scale=Q,this.rotation=xe,this.offsetX=Se,this.offsetY=Ce;const De=(W[2]+W[0])/2,_e=(W[3]+W[1])/2;let Ge,Ye,ot,st;switch(xe%=360,xe<0&&(xe+=360),xe){case 180:Ge=-1,Ye=0,ot=0,st=1;break;case 90:Ge=0,Ye=1,ot=1,st=0;break;case 270:Ge=0,Ye=-1,ot=-1,st=0;break;case 0:Ge=1,Ye=0,ot=0,st=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}Le&&(ot=-ot,st=-st);let ht,Je,nt,ct;Ge===0?(ht=Math.abs(_e-W[1])*Q+Se,Je=Math.abs(De-W[0])*Q+Ce,nt=(W[3]-W[1])*Q,ct=(W[2]-W[0])*Q):(ht=Math.abs(De-W[0])*Q+Se,Je=Math.abs(_e-W[1])*Q+Ce,nt=(W[2]-W[0])*Q,ct=(W[3]-W[1])*Q),this.transform=[Ge*Q,Ye*Q,ot*Q,st*Q,ht-Ge*Q*De-ot*Q*_e,Je-Ye*Q*De-st*Q*_e],this.width=nt,this.height=ct}get rawDims(){const{viewBox:fe}=this;return(0,a.shadow)(this,"rawDims",{pageWidth:fe[2]-fe[0],pageHeight:fe[3]-fe[1],pageX:fe[0],pageY:fe[1]})}clone(){let{scale:fe=this.scale,rotation:W=this.rotation,offsetX:Q=this.offsetX,offsetY:xe=this.offsetY,dontFlip:Se=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return new v({viewBox:this.viewBox.slice(),scale:fe,rotation:W,offsetX:Q,offsetY:xe,dontFlip:Se})}convertToViewportPoint(fe,W){return a.Util.applyTransform([fe,W],this.transform)}convertToViewportRectangle(fe){const W=a.Util.applyTransform([fe[0],fe[1]],this.transform),Q=a.Util.applyTransform([fe[2],fe[3]],this.transform);return[W[0],W[1],Q[0],Q[1]]}convertToPdfPoint(fe,W){return a.Util.applyInverseTransform([fe,W],this.transform)}}r.PageViewport=v;class E extends a.BaseException{constructor(fe){let W=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;super(fe,"RenderingCancelledException"),this.extraDelay=W}}r.RenderingCancelledException=E;function x(pe){const fe=pe.length;let W=0;for(;W<fe&&pe[W].trim()==="";)W++;return pe.substring(W,W+5).toLowerCase()==="data:"}function g(pe){return typeof pe=="string"&&/\.pdf$/i.test(pe)}function w(pe){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1)||([pe]=pe.split(/[#?]/,1)),pe.substring(pe.lastIndexOf("/")+1)}function R(pe){let fe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"document.pdf";if(typeof pe!="string")return fe;if(x(pe))return(0,a.warn)('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),fe;const W=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,Q=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,xe=W.exec(pe);let Se=Q.exec(xe[1])||Q.exec(xe[2])||Q.exec(xe[3]);if(Se&&(Se=Se[0],Se.includes("%")))try{Se=Q.exec(decodeURIComponent(Se))[0]}catch{}return Se||fe}class N{constructor(){bt(this,"started",Object.create(null));bt(this,"times",[])}time(fe){fe in this.started&&(0,a.warn)(`Timer is already running for ${fe}`),this.started[fe]=Date.now()}timeEnd(fe){fe in this.started||(0,a.warn)(`Timer has not been started for ${fe}`),this.times.push({name:fe,start:this.started[fe],end:Date.now()}),delete this.started[fe]}toString(){const fe=[];let W=0;for(const{name:Q}of this.times)W=Math.max(Q.length,W);for(const{name:Q,start:xe,end:Se}of this.times)fe.push(`${Q.padEnd(W)} ${Se-xe}ms
`);return fe.join("")}}r.StatTimer=N;function M(pe,fe){try{const{protocol:W}=fe?new URL(pe,fe):new URL(pe);return W==="http:"||W==="https:"}catch{return!1}}function A(pe){pe.preventDefault()}function I(pe){let fe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return new Promise((W,Q)=>{const xe=document.createElement("script");xe.src=pe,xe.onload=function(Se){fe&&xe.remove(),W(Se)},xe.onerror=function(){Q(new Error(`Cannot load script at: ${xe.src}`))},(document.head||document.documentElement).append(xe)})}function y(pe){console.log("Deprecated API usage: "+pe)}let j;class T{static toDateObject(fe){if(!fe||typeof fe!="string")return null;j||(j=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const W=j.exec(fe);if(!W)return null;const Q=parseInt(W[1],10);let xe=parseInt(W[2],10);xe=xe>=1&&xe<=12?xe-1:0;let Se=parseInt(W[3],10);Se=Se>=1&&Se<=31?Se:1;let Ce=parseInt(W[4],10);Ce=Ce>=0&&Ce<=23?Ce:0;let Le=parseInt(W[5],10);Le=Le>=0&&Le<=59?Le:0;let De=parseInt(W[6],10);De=De>=0&&De<=59?De:0;const _e=W[7]||"Z";let Ge=parseInt(W[8],10);Ge=Ge>=0&&Ge<=23?Ge:0;let Ye=parseInt(W[9],10)||0;return Ye=Ye>=0&&Ye<=59?Ye:0,_e==="-"?(Ce+=Ge,Le+=Ye):_e==="+"&&(Ce-=Ge,Le-=Ye),new Date(Date.UTC(Q,xe,Se,Ce,Le,De))}}r.PDFDateString=T;function U(pe,fe){let{scale:W=1,rotation:Q=0}=fe;const{width:xe,height:Se}=pe.attributes.style,Ce=[0,0,parseInt(xe),parseInt(Se)];return new v({viewBox:Ce,scale:W,rotation:Q})}function F(pe){if(pe.startsWith("#")){const fe=parseInt(pe.slice(1),16);return[(fe&16711680)>>16,(fe&65280)>>8,fe&255]}return pe.startsWith("rgb(")?pe.slice(4,-1).split(",").map(fe=>parseInt(fe)):pe.startsWith("rgba(")?pe.slice(5,-1).split(",").map(fe=>parseInt(fe)).slice(0,3):((0,a.warn)(`Not a valid color format: "${pe}"`),[0,0,0])}function H(pe){const fe=document.createElement("span");fe.style.visibility="hidden",document.body.append(fe);for(const W of pe.keys()){fe.style.color=W;const Q=window.getComputedStyle(fe).color;pe.set(W,F(Q))}fe.remove()}function z(pe){const{a:fe,b:W,c:Q,d:xe,e:Se,f:Ce}=pe.getTransform();return[fe,W,Q,xe,Se,Ce]}function de(pe){const{a:fe,b:W,c:Q,d:xe,e:Se,f:Ce}=pe.getTransform().invertSelf();return[fe,W,Q,xe,Se,Ce]}function se(pe,fe){let W=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,Q=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0;if(fe instanceof v){const{pageWidth:xe,pageHeight:Se}=fe.rawDims,{style:Ce}=pe,Le=a.FeatureTest.isCSSRoundSupported,De=`var(--scale-factor) * ${xe}px`,_e=`var(--scale-factor) * ${Se}px`,Ge=Le?`round(${De}, 1px)`:`calc(${De})`,Ye=Le?`round(${_e}, 1px)`:`calc(${_e})`;!W||fe.rotation%180===0?(Ce.width=Ge,Ce.height=Ye):(Ce.width=Ye,Ce.height=Ge)}Q&&pe.setAttribute("data-main-rotation",fe.rotation)}},(t,r,e)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.BaseStandardFontDataFactory=r.BaseSVGFactory=r.BaseFilterFactory=r.BaseCanvasFactory=r.BaseCMapReaderFactory=void 0,e(2);var s=e(1);class a{constructor(){this.constructor===a&&(0,s.unreachable)("Cannot initialize BaseFilterFactory.")}addFilter(d){return"none"}addHCMFilter(d,_){return"none"}addHighlightHCMFilter(d,_,b,v){return"none"}destroy(){}}r.BaseFilterFactory=a;class i{constructor(){this.constructor===i&&(0,s.unreachable)("Cannot initialize BaseCanvasFactory.")}create(d,_){if(d<=0||_<=0)throw new Error("Invalid canvas size");const b=this._createCanvas(d,_);return{canvas:b,context:b.getContext("2d")}}reset(d,_,b){if(!d.canvas)throw new Error("Canvas is not specified");if(_<=0||b<=0)throw new Error("Invalid canvas size");d.canvas.width=_,d.canvas.height=b}destroy(d){if(!d.canvas)throw new Error("Canvas is not specified");d.canvas.width=0,d.canvas.height=0,d.canvas=null,d.context=null}_createCanvas(d,_){(0,s.unreachable)("Abstract method `_createCanvas` called.")}}r.BaseCanvasFactory=i;class o{constructor(d){let{baseUrl:_=null,isCompressed:b=!0}=d;this.constructor===o&&(0,s.unreachable)("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=_,this.isCompressed=b}async fetch(d){let{name:_}=d;if(!this.baseUrl)throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!_)throw new Error("CMap name must be specified.");const b=this.baseUrl+_+(this.isCompressed?".bcmap":""),v=this.isCompressed?s.CMapCompressionType.BINARY:s.CMapCompressionType.NONE;return this._fetchData(b,v).catch(E=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${b}`)})}_fetchData(d,_){(0,s.unreachable)("Abstract method `_fetchData` called.")}}r.BaseCMapReaderFactory=o;class c{constructor(d){let{baseUrl:_=null}=d;this.constructor===c&&(0,s.unreachable)("Cannot initialize BaseStandardFontDataFactory."),this.baseUrl=_}async fetch(d){let{filename:_}=d;if(!this.baseUrl)throw new Error('The standard font "baseUrl" parameter must be specified, ensure that the "standardFontDataUrl" API parameter is provided.');if(!_)throw new Error("Font filename must be specified.");const b=`${this.baseUrl}${_}`;return this._fetchData(b).catch(v=>{throw new Error(`Unable to load font data at: ${b}`)})}_fetchData(d){(0,s.unreachable)("Abstract method `_fetchData` called.")}}r.BaseStandardFontDataFactory=c;class h{constructor(){this.constructor===h&&(0,s.unreachable)("Cannot initialize BaseSVGFactory.")}create(d,_){let b=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(d<=0||_<=0)throw new Error("Invalid SVG dimensions");const v=this._createSVG("svg:svg");return v.setAttribute("version","1.1"),b||(v.setAttribute("width",`${d}px`),v.setAttribute("height",`${_}px`)),v.setAttribute("preserveAspectRatio","none"),v.setAttribute("viewBox",`0 0 ${d} ${_}`),v}createElement(d){if(typeof d!="string")throw new Error("Invalid SVG element type");return this._createSVG(d)}_createSVG(d){(0,s.unreachable)("Abstract method `_createSVG` called.")}}r.BaseSVGFactory=h},(t,r,e)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.MurmurHash3_64=void 0,e(93),e(101),e(102),e(105),e(107),e(109),e(113),e(116),e(123),e(2);var s=e(1);const a=3285377520,i=4294901760,o=65535;class c{constructor(u){this.h1=u?u&4294967295:a,this.h2=u?u&4294967295:a}update(u){let d,_;if(typeof u=="string"){d=new Uint8Array(u.length*2),_=0;for(let y=0,j=u.length;y<j;y++){const T=u.charCodeAt(y);T<=255?d[_++]=T:(d[_++]=T>>>8,d[_++]=T&255)}}else if((0,s.isArrayBuffer)(u))d=u.slice(),_=d.byteLength;else throw new Error("Wrong data format in MurmurHash3_64_update. Input must be a string or array.");const b=_>>2,v=_-b*4,E=new Uint32Array(d.buffer,0,b);let x=0,g=0,w=this.h1,R=this.h2;const N=3432918353,M=461845907,A=N&o,I=M&o;for(let y=0;y<b;y++)y&1?(x=E[y],x=x*N&i|x*A&o,x=x<<15|x>>>17,x=x*M&i|x*I&o,w^=x,w=w<<13|w>>>19,w=w*5+3864292196):(g=E[y],g=g*N&i|g*A&o,g=g<<15|g>>>17,g=g*M&i|g*I&o,R^=g,R=R<<13|R>>>19,R=R*5+3864292196);switch(x=0,v){case 3:x^=d[b*4+2]<<16;case 2:x^=d[b*4+1]<<8;case 1:x^=d[b*4],x=x*N&i|x*A&o,x=x<<15|x>>>17,x=x*M&i|x*I&o,b&1?w^=x:R^=x}this.h1=w,this.h2=R}hexdigest(){let u=this.h1,d=this.h2;return u^=d>>>1,u=u*3981806797&i|u*36045&o,d=d*4283543511&i|((d<<16|u>>>16)*2950163797&i)>>>16,u^=d>>>1,u=u*444984403&i|u*60499&o,d=d*3301882366&i|((d<<16|u>>>16)*3120437893&i)>>>16,u^=d>>>1,(u>>>0).toString(16).padStart(8,"0")+(d>>>0).toString(16).padStart(8,"0")}}r.MurmurHash3_64=c},(t,r,e)=>{var o;Object.defineProperty(r,"__esModule",{value:!0}),r.FontLoader=r.FontFaceObject=void 0,e(125),e(136),e(138),e(141),e(143),e(145),e(147),e(89),e(149);var s=e(1);class a{constructor(h){ke(this,o,new Set);let{ownerDocument:u=globalThis.document,styleElement:d=null}=h;this._document=u,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(h){this.nativeFontFaces.add(h),this._document.fonts.add(h)}removeNativeFontFace(h){this.nativeFontFaces.delete(h),this._document.fonts.delete(h)}insertRule(h){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const u=this.styleElement.sheet;u.insertRule(h,u.cssRules.length)}clear(){for(const h of this.nativeFontFaces)this._document.fonts.delete(h);this.nativeFontFaces.clear(),O(this,o).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont(h){if(!(!h||O(this,o).has(h.loadedName))){if((0,s.assert)(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:u,src:d,style:_}=h,b=new FontFace(u,d,_);this.addNativeFontFace(b);try{await b.load(),O(this,o).add(u)}catch{(0,s.warn)(`Cannot load system font: ${h.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(b)}return}(0,s.unreachable)("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(h){if(h.attached||h.missingFile&&!h.systemFontInfo)return;if(h.attached=!0,h.systemFontInfo){await this.loadSystemFont(h.systemFontInfo);return}if(this.isFontLoadingAPISupported){const d=h.createNativeFontFace();if(d){this.addNativeFontFace(d);try{await d.loaded}catch(_){throw(0,s.warn)(`Failed to load font '${d.family}': '${_}'.`),h.disableFontFace=!0,_}}return}const u=h.createFontFaceRule();if(u){if(this.insertRule(u),this.isSyncFontLoadingSupported)return;await new Promise(d=>{const _=this._queueLoadingCallback(d);this._prepareFontLoadEvent(h,_)})}}get isFontLoadingAPISupported(){var u;const h=!!((u=this._document)!=null&&u.fonts);return(0,s.shadow)(this,"isFontLoadingAPISupported",h)}get isSyncFontLoadingSupported(){let h=!1;return(s.isNodeJS||typeof navigator<"u"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(h=!0),(0,s.shadow)(this,"isSyncFontLoadingSupported",h)}_queueLoadingCallback(h){function u(){for((0,s.assert)(!_.done,"completeRequest() cannot be called twice."),_.done=!0;d.length>0&&d[0].done;){const b=d.shift();setTimeout(b.callback,0)}}const{loadingRequests:d}=this,_={done:!1,complete:u,callback:h};return d.push(_),_}get _loadTestFont(){const h=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return(0,s.shadow)(this,"_loadTestFont",h)}_prepareFontLoadEvent(h,u){function d(F,H){return F.charCodeAt(H)<<24|F.charCodeAt(H+1)<<16|F.charCodeAt(H+2)<<8|F.charCodeAt(H+3)&255}function _(F,H,z,de){const se=F.substring(0,H),ue=F.substring(H+z);return se+de+ue}let b,v;const E=this._document.createElement("canvas");E.width=1,E.height=1;const x=E.getContext("2d");let g=0;function w(F,H){if(++g>30){(0,s.warn)("Load test font never loaded."),H();return}if(x.font="30px "+F,x.fillText(".",0,20),x.getImageData(0,0,1,1).data[3]>0){H();return}setTimeout(w.bind(null,F,H))}const R=`lt${Date.now()}${this.loadTestFontId++}`;let N=this._loadTestFont;N=_(N,976,R.length,R);const A=16,I=1482184792;let y=d(N,A);for(b=0,v=R.length-3;b<v;b+=4)y=y-I+d(R,b)|0;b<R.length&&(y=y-I+d(R+"XXX",b)|0),N=_(N,A,4,(0,s.string32)(y));const j=`url(data:font/opentype;base64,${btoa(N)});`,T=`@font-face {font-family:"${R}";src:${j}}`;this.insertRule(T);const U=this._document.createElement("div");U.style.visibility="hidden",U.style.width=U.style.height="10px",U.style.position="absolute",U.style.top=U.style.left="0px";for(const F of[h.loadedName,R]){const H=this._document.createElement("span");H.textContent="Hi",H.style.fontFamily=F,U.append(H)}this._document.body.append(U),w(R,()=>{U.remove(),u.complete()})}}o=new WeakMap,r.FontLoader=a;class i{constructor(h,u){let{isEvalSupported:d=!0,disableFontFace:_=!1,ignoreErrors:b=!1,inspectFont:v=null}=u;this.compiledGlyphs=Object.create(null);for(const E in h)this[E]=h[E];this.isEvalSupported=d!==!1,this.disableFontFace=_===!0,this.ignoreErrors=b===!0,this._inspectFont=v}createNativeFontFace(){var u;if(!this.data||this.disableFontFace)return null;let h;if(!this.cssFontInfo)h=new FontFace(this.loadedName,this.data,{});else{const d={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(d.style=`oblique ${this.cssFontInfo.italicAngle}deg`),h=new FontFace(this.cssFontInfo.fontFamily,this.data,d)}return(u=this._inspectFont)==null||u.call(this,this),h}createFontFaceRule(){var _;if(!this.data||this.disableFontFace)return null;const h=(0,s.bytesToString)(this.data),u=`url(data:${this.mimetype};base64,${btoa(h)});`;let d;if(!this.cssFontInfo)d=`@font-face {font-family:"${this.loadedName}";src:${u}}`;else{let b=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(b+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),d=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${b}src:${u}}`}return(_=this._inspectFont)==null||_.call(this,this,u),d}getPathGenerator(h,u){if(this.compiledGlyphs[u]!==void 0)return this.compiledGlyphs[u];let d;try{d=h.get(this.loadedName+"_path_"+u)}catch(_){if(!this.ignoreErrors)throw _;return(0,s.warn)(`getPathGenerator - ignoring character: "${_}".`),this.compiledGlyphs[u]=function(b,v){}}if(this.isEvalSupported&&s.FeatureTest.isEvalSupported){const _=[];for(const b of d){const v=b.args!==void 0?b.args.join(","):"";_.push("c.",b.cmd,"(",v,`);
`)}return this.compiledGlyphs[u]=new Function("c","size",_.join(""))}return this.compiledGlyphs[u]=function(_,b){for(const v of d)v.cmd==="scale"&&(v.args=[b,-b]),_[v.cmd].apply(_,v.args)}}}r.FontFaceObject=i},(t,r,e)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.NodeStandardFontDataFactory=r.NodeFilterFactory=r.NodeCanvasFactory=r.NodeCMapReaderFactory=void 0,e(2),e(93),e(101),e(102),e(105),e(107),e(109),e(113),e(116),e(123);var s=e(169),a=e(1);(function(){if(!(globalThis.DOMMatrix||!a.isNodeJS))try{globalThis.DOMMatrix=require$$6.DOMMatrix}catch(_){(0,a.warn)(`Cannot polyfill \`DOMMatrix\`, rendering may be broken: "${_}".`)}})(),function(){if(!(globalThis.Path2D||!a.isNodeJS))try{const{CanvasRenderingContext2D:_}=require$$6,{polyfillPath2D:b}=requirePath2dPolyfill_esm();globalThis.CanvasRenderingContext2D=_,b(globalThis)}catch(_){(0,a.warn)(`Cannot polyfill \`Path2D\`, rendering may be broken: "${_}".`)}}();const i=function(d){return new Promise((_,b)=>{require$$6.readFile(d,(E,x)=>{if(E||!x){b(new Error(E));return}_(new Uint8Array(x))})})};class o extends s.BaseFilterFactory{}r.NodeFilterFactory=o;class c extends s.BaseCanvasFactory{_createCanvas(_,b){return require$$6.createCanvas(_,b)}}r.NodeCanvasFactory=c;class h extends s.BaseCMapReaderFactory{_fetchData(_,b){return i(_).then(v=>({cMapData:v,compressionType:b}))}}r.NodeCMapReaderFactory=h;class u extends s.BaseStandardFontDataFactory{_fetchData(_){return i(_)}}r.NodeStandardFontDataFactory=u},(t,r,e)=>{var ge,Hr,Vr;Object.defineProperty(r,"__esModule",{value:!0}),r.CanvasGraphics=void 0,e(2),e(93),e(101),e(102),e(105),e(107),e(109),e(113),e(116),e(123),e(89);var s=e(1),a=e(168),i=e(174),o=e(175);const c=16,h=100,u=4096,d=15,_=10,b=1e3,v=16;function E(L,S){if(L._removeMirroring)throw new Error("Context is already forwarding operations.");L.__originalSave=L.save,L.__originalRestore=L.restore,L.__originalRotate=L.rotate,L.__originalScale=L.scale,L.__originalTranslate=L.translate,L.__originalTransform=L.transform,L.__originalSetTransform=L.setTransform,L.__originalResetTransform=L.resetTransform,L.__originalClip=L.clip,L.__originalMoveTo=L.moveTo,L.__originalLineTo=L.lineTo,L.__originalBezierCurveTo=L.bezierCurveTo,L.__originalRect=L.rect,L.__originalClosePath=L.closePath,L.__originalBeginPath=L.beginPath,L._removeMirroring=()=>{L.save=L.__originalSave,L.restore=L.__originalRestore,L.rotate=L.__originalRotate,L.scale=L.__originalScale,L.translate=L.__originalTranslate,L.transform=L.__originalTransform,L.setTransform=L.__originalSetTransform,L.resetTransform=L.__originalResetTransform,L.clip=L.__originalClip,L.moveTo=L.__originalMoveTo,L.lineTo=L.__originalLineTo,L.bezierCurveTo=L.__originalBezierCurveTo,L.rect=L.__originalRect,L.closePath=L.__originalClosePath,L.beginPath=L.__originalBeginPath,delete L._removeMirroring},L.save=function(){S.save(),this.__originalSave()},L.restore=function(){S.restore(),this.__originalRestore()},L.translate=function(P,D){S.translate(P,D),this.__originalTranslate(P,D)},L.scale=function(P,D){S.scale(P,D),this.__originalScale(P,D)},L.transform=function(P,D,B,G,J,Y){S.transform(P,D,B,G,J,Y),this.__originalTransform(P,D,B,G,J,Y)},L.setTransform=function(P,D,B,G,J,Y){S.setTransform(P,D,B,G,J,Y),this.__originalSetTransform(P,D,B,G,J,Y)},L.resetTransform=function(){S.resetTransform(),this.__originalResetTransform()},L.rotate=function(P){S.rotate(P),this.__originalRotate(P)},L.clip=function(P){S.clip(P),this.__originalClip(P)},L.moveTo=function(C,P){S.moveTo(C,P),this.__originalMoveTo(C,P)},L.lineTo=function(C,P){S.lineTo(C,P),this.__originalLineTo(C,P)},L.bezierCurveTo=function(C,P,D,B,G,J){S.bezierCurveTo(C,P,D,B,G,J),this.__originalBezierCurveTo(C,P,D,B,G,J)},L.rect=function(C,P,D,B){S.rect(C,P,D,B),this.__originalRect(C,P,D,B)},L.closePath=function(){S.closePath(),this.__originalClosePath()},L.beginPath=function(){S.beginPath(),this.__originalBeginPath()}}class x{constructor(S){this.canvasFactory=S,this.cache=Object.create(null)}getCanvas(S,C,P){let D;return this.cache[S]!==void 0?(D=this.cache[S],this.canvasFactory.reset(D,C,P)):(D=this.canvasFactory.create(C,P),this.cache[S]=D),D}delete(S){delete this.cache[S]}clear(){for(const S in this.cache){const C=this.cache[S];this.canvasFactory.destroy(C),delete this.cache[S]}}}function g(L,S,C,P,D,B,G,J,Y,me){const[Ee,Re,Ne,he,pe,fe]=(0,a.getCurrentTransform)(L);if(Re===0&&Ne===0){const xe=G*Ee+pe,Se=Math.round(xe),Ce=J*he+fe,Le=Math.round(Ce),De=(G+Y)*Ee+pe,_e=Math.abs(Math.round(De)-Se)||1,Ge=(J+me)*he+fe,Ye=Math.abs(Math.round(Ge)-Le)||1;return L.setTransform(Math.sign(Ee),0,0,Math.sign(he),Se,Le),L.drawImage(S,C,P,D,B,0,0,_e,Ye),L.setTransform(Ee,Re,Ne,he,pe,fe),[_e,Ye]}if(Ee===0&&he===0){const xe=J*Ne+pe,Se=Math.round(xe),Ce=G*Re+fe,Le=Math.round(Ce),De=(J+me)*Ne+pe,_e=Math.abs(Math.round(De)-Se)||1,Ge=(G+Y)*Re+fe,Ye=Math.abs(Math.round(Ge)-Le)||1;return L.setTransform(0,Math.sign(Re),Math.sign(Ne),0,Se,Le),L.drawImage(S,C,P,D,B,0,0,Ye,_e),L.setTransform(Ee,Re,Ne,he,pe,fe),[Ye,_e]}L.drawImage(S,C,P,D,B,G,J,Y,me);const W=Math.hypot(Ee,Re),Q=Math.hypot(Ne,he);return[W*Y,Q*me]}function w(L){const{width:S,height:C}=L;if(S>b||C>b)return null;const P=1e3,D=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),B=S+1;let G=new Uint8Array(B*(C+1)),J,Y,me;const Ee=S+7&-8;let Re=new Uint8Array(Ee*C),Ne=0;for(const Q of L.data){let xe=128;for(;xe>0;)Re[Ne++]=Q&xe?0:255,xe>>=1}let he=0;for(Ne=0,Re[Ne]!==0&&(G[0]=1,++he),Y=1;Y<S;Y++)Re[Ne]!==Re[Ne+1]&&(G[Y]=Re[Ne]?2:1,++he),Ne++;for(Re[Ne]!==0&&(G[Y]=2,++he),J=1;J<C;J++){Ne=J*Ee,me=J*B,Re[Ne-Ee]!==Re[Ne]&&(G[me]=Re[Ne]?1:8,++he);let Q=(Re[Ne]?4:0)+(Re[Ne-Ee]?8:0);for(Y=1;Y<S;Y++)Q=(Q>>2)+(Re[Ne+1]?4:0)+(Re[Ne-Ee+1]?8:0),D[Q]&&(G[me+Y]=D[Q],++he),Ne++;if(Re[Ne-Ee]!==Re[Ne]&&(G[me+Y]=Re[Ne]?2:4,++he),he>P)return null}for(Ne=Ee*(C-1),me=J*B,Re[Ne]!==0&&(G[me]=8,++he),Y=1;Y<S;Y++)Re[Ne]!==Re[Ne+1]&&(G[me+Y]=Re[Ne]?4:8,++he),Ne++;if(Re[Ne]!==0&&(G[me+Y]=4,++he),he>P)return null;const pe=new Int32Array([0,B,-1,0,-B,0,0,0,1]),fe=new Path2D;for(J=0;he&&J<=C;J++){let Q=J*B;const xe=Q+S;for(;Q<xe&&!G[Q];)Q++;if(Q===xe)continue;fe.moveTo(Q%B,J);const Se=Q;let Ce=G[Q];do{const Le=pe[Ce];do Q+=Le;while(!G[Q]);const De=G[Q];De!==5&&De!==10?(Ce=De,G[Q]=0):(Ce=De&51*Ce>>4,G[Q]&=Ce>>2|Ce<<2),fe.lineTo(Q%B,Q/B|0),G[Q]||--he}while(Se!==Q);--J}return Re=null,G=null,function(Q){Q.save(),Q.scale(1/S,-1/C),Q.translate(0,-C),Q.fill(fe),Q.beginPath(),Q.restore()}}class R{constructor(S,C){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=s.IDENTITY_MATRIX,this.textMatrixScale=1,this.fontMatrix=s.FONT_IDENTITY_MATRIX,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=s.TextRenderingMode.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,S,C])}clone(){const S=Object.create(this);return S.clipBox=this.clipBox.slice(),S}setCurrentPoint(S,C){this.x=S,this.y=C}updatePathMinMax(S,C,P){[C,P]=s.Util.applyTransform([C,P],S),this.minX=Math.min(this.minX,C),this.minY=Math.min(this.minY,P),this.maxX=Math.max(this.maxX,C),this.maxY=Math.max(this.maxY,P)}updateRectMinMax(S,C){const P=s.Util.applyTransform(C,S),D=s.Util.applyTransform(C.slice(2),S);this.minX=Math.min(this.minX,P[0],D[0]),this.minY=Math.min(this.minY,P[1],D[1]),this.maxX=Math.max(this.maxX,P[0],D[0]),this.maxY=Math.max(this.maxY,P[1],D[1])}updateScalingPathMinMax(S,C){s.Util.scaleMinMax(S,C),this.minX=Math.min(this.minX,C[0]),this.maxX=Math.max(this.maxX,C[1]),this.minY=Math.min(this.minY,C[2]),this.maxY=Math.max(this.maxY,C[3])}updateCurvePathMinMax(S,C,P,D,B,G,J,Y,me,Ee){const Re=s.Util.bezierBoundingBox(C,P,D,B,G,J,Y,me);if(Ee){Ee[0]=Math.min(Ee[0],Re[0],Re[2]),Ee[1]=Math.max(Ee[1],Re[0],Re[2]),Ee[2]=Math.min(Ee[2],Re[1],Re[3]),Ee[3]=Math.max(Ee[3],Re[1],Re[3]);return}this.updateRectMinMax(S,Re)}getPathBoundingBox(){let S=arguments.length>0&&arguments[0]!==void 0?arguments[0]:i.PathType.FILL,C=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const P=[this.minX,this.minY,this.maxX,this.maxY];if(S===i.PathType.STROKE){C||(0,s.unreachable)("Stroke bounding box must include transform.");const D=s.Util.singularValueDecompose2dScale(C),B=D[0]*this.lineWidth/2,G=D[1]*this.lineWidth/2;P[0]-=B,P[1]-=G,P[2]+=B,P[3]+=G}return P}updateClipFromPath(){const S=s.Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(S||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(S){this.clipBox=S,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(){let S=arguments.length>0&&arguments[0]!==void 0?arguments[0]:i.PathType.FILL,C=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return s.Util.intersect(this.clipBox,this.getPathBoundingBox(S,C))}}function N(L,S){if(typeof ImageData<"u"&&S instanceof ImageData){L.putImageData(S,0,0);return}const C=S.height,P=S.width,D=C%v,B=(C-D)/v,G=D===0?B:B+1,J=L.createImageData(P,v);let Y=0,me;const Ee=S.data,Re=J.data;let Ne,he,pe,fe;if(S.kind===s.ImageKind.GRAYSCALE_1BPP){const W=Ee.byteLength,Q=new Uint32Array(Re.buffer,0,Re.byteLength>>2),xe=Q.length,Se=P+7>>3,Ce=4294967295,Le=s.FeatureTest.isLittleEndian?4278190080:255;for(Ne=0;Ne<G;Ne++){for(pe=Ne<B?v:D,me=0,he=0;he<pe;he++){const De=W-Y;let _e=0;const Ge=De>Se?P:De*8-7,Ye=Ge&-8;let ot=0,st=0;for(;_e<Ye;_e+=8)st=Ee[Y++],Q[me++]=st&128?Ce:Le,Q[me++]=st&64?Ce:Le,Q[me++]=st&32?Ce:Le,Q[me++]=st&16?Ce:Le,Q[me++]=st&8?Ce:Le,Q[me++]=st&4?Ce:Le,Q[me++]=st&2?Ce:Le,Q[me++]=st&1?Ce:Le;for(;_e<Ge;_e++)ot===0&&(st=Ee[Y++],ot=128),Q[me++]=st&ot?Ce:Le,ot>>=1}for(;me<xe;)Q[me++]=0;L.putImageData(J,0,Ne*v)}}else if(S.kind===s.ImageKind.RGBA_32BPP){for(he=0,fe=P*v*4,Ne=0;Ne<B;Ne++)Re.set(Ee.subarray(Y,Y+fe)),Y+=fe,L.putImageData(J,0,he),he+=v;Ne<G&&(fe=P*D*4,Re.set(Ee.subarray(Y,Y+fe)),L.putImageData(J,0,he))}else if(S.kind===s.ImageKind.RGB_24BPP)for(pe=v,fe=P*pe,Ne=0;Ne<G;Ne++){for(Ne>=B&&(pe=D,fe=P*pe),me=0,he=fe;he--;)Re[me++]=Ee[Y++],Re[me++]=Ee[Y++],Re[me++]=Ee[Y++],Re[me++]=255;L.putImageData(J,0,Ne*v)}else throw new Error(`bad image kind: ${S.kind}`)}function M(L,S){if(S.bitmap){L.drawImage(S.bitmap,0,0);return}const C=S.height,P=S.width,D=C%v,B=(C-D)/v,G=D===0?B:B+1,J=L.createImageData(P,v);let Y=0;const me=S.data,Ee=J.data;for(let Re=0;Re<G;Re++){const Ne=Re<B?v:D;({srcPos:Y}=(0,o.convertBlackAndWhiteToRGBA)({src:me,srcPos:Y,dest:Ee,width:P,height:Ne,nonBlackColor:0})),L.putImageData(J,0,Re*v)}}function A(L,S){const C=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const P of C)L[P]!==void 0&&(S[P]=L[P]);L.setLineDash!==void 0&&(S.setLineDash(L.getLineDash()),S.lineDashOffset=L.lineDashOffset)}function I(L){if(L.strokeStyle=L.fillStyle="#000000",L.fillRule="nonzero",L.globalAlpha=1,L.lineWidth=1,L.lineCap="butt",L.lineJoin="miter",L.miterLimit=10,L.globalCompositeOperation="source-over",L.font="10px sans-serif",L.setLineDash!==void 0&&(L.setLineDash([]),L.lineDashOffset=0),!s.isNodeJS){const{filter:S}=L;S!=="none"&&S!==""&&(L.filter="none")}}function y(L,S,C,P){const D=L.length;for(let B=3;B<D;B+=4){const G=L[B];if(G===0)L[B-3]=S,L[B-2]=C,L[B-1]=P;else if(G<255){const J=255-G;L[B-3]=L[B-3]*G+S*J>>8,L[B-2]=L[B-2]*G+C*J>>8,L[B-1]=L[B-1]*G+P*J>>8}}}function j(L,S,C){const P=L.length,D=1/255;for(let B=3;B<P;B+=4){const G=C?C[L[B]]:L[B];S[B]=S[B]*G*D|0}}function T(L,S,C){const P=L.length;for(let D=3;D<P;D+=4){const B=L[D-3]*77+L[D-2]*152+L[D-1]*28;S[D]=C?S[D]*C[B>>8]>>8:S[D]*B>>16}}function U(L,S,C,P,D,B,G,J,Y,me,Ee){const Re=!!B,Ne=Re?B[0]:0,he=Re?B[1]:0,pe=Re?B[2]:0,fe=D==="Luminosity"?T:j,Q=Math.min(P,Math.ceil(1048576/C));for(let xe=0;xe<P;xe+=Q){const Se=Math.min(Q,P-xe),Ce=L.getImageData(J-me,xe+(Y-Ee),C,Se),Le=S.getImageData(J,xe+Y,C,Se);Re&&y(Ce.data,Ne,he,pe),fe(Ce.data,Le.data,G),S.putImageData(Le,J,xe+Y)}}function F(L,S,C,P){const D=P[0],B=P[1],G=P[2]-D,J=P[3]-B;G===0||J===0||(U(S.context,C,G,J,S.subtype,S.backdrop,S.transferMap,D,B,S.offsetX,S.offsetY),L.save(),L.globalAlpha=1,L.globalCompositeOperation="source-over",L.setTransform(1,0,0,1,0,0),L.drawImage(C.canvas,0,0),L.restore())}function H(L,S){const C=s.Util.singularValueDecompose2dScale(L);C[0]=Math.fround(C[0]),C[1]=Math.fround(C[1]);const P=Math.fround((globalThis.devicePixelRatio||1)*a.PixelsPerInch.PDF_TO_CSS_UNITS);return S!==void 0?S:C[0]<=P||C[1]<=P}const z=["butt","round","square"],de=["miter","round","bevel"],se={},ue={},be=class be{constructor(S,C,P,D,B,G,J,Y){ke(this,ge);let{optionalContentConfig:me,markedContentStack:Ee=null}=G;this.ctx=S,this.current=new R(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=C,this.objs=P,this.canvasFactory=D,this.filterFactory=B,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=Ee||[],this.optionalContentConfig=me,this.cachedCanvases=new x(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=J,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=Y,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(S){let C=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return typeof S=="string"?S.startsWith("g_")?this.commonObjs.get(S):this.objs.get(S):C}beginDrawing(S){let{transform:C,viewport:P,transparency:D=!1,background:B=null}=S;const G=this.ctx.canvas.width,J=this.ctx.canvas.height,Y=this.ctx.fillStyle;if(this.ctx.fillStyle=B||"#ffffff",this.ctx.fillRect(0,0,G,J),this.ctx.fillStyle=Y,D){const me=this.cachedCanvases.getCanvas("transparent",G,J);this.compositeCtx=this.ctx,this.transparentCanvas=me.canvas,this.ctx=me.context,this.ctx.save(),this.ctx.transform(...(0,a.getCurrentTransform)(this.compositeCtx))}this.ctx.save(),I(this.ctx),C&&(this.ctx.transform(...C),this.outputScaleX=C[0],this.outputScaleY=C[0]),this.ctx.transform(...P.transform),this.viewportScale=P.scale,this.baseTransform=(0,a.getCurrentTransform)(this.ctx)}executeOperatorList(S,C,P,D){const B=S.argsArray,G=S.fnArray;let J=C||0;const Y=B.length;if(Y===J)return J;const me=Y-J>_&&typeof P=="function",Ee=me?Date.now()+d:0;let Re=0;const Ne=this.commonObjs,he=this.objs;let pe;for(;;){if(D!==void 0&&J===D.nextBreakPoint)return D.breakIt(J,P),J;if(pe=G[J],pe!==s.OPS.dependency)this[pe].apply(this,B[J]);else for(const fe of B[J]){const W=fe.startsWith("g_")?Ne:he;if(!W.has(fe))return W.get(fe,P),J}if(J++,J===Y)return J;if(me&&++Re>_){if(Date.now()>Ee)return P(),J;Re=0}}}endDrawing(){Ae(this,ge,Hr).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const S of this._cachedBitmapsMap.values()){for(const C of S.values())typeof HTMLCanvasElement<"u"&&C instanceof HTMLCanvasElement&&(C.width=C.height=0);S.clear()}this._cachedBitmapsMap.clear(),Ae(this,ge,Vr).call(this)}_scaleImage(S,C){const P=S.width,D=S.height;let B=Math.max(Math.hypot(C[0],C[1]),1),G=Math.max(Math.hypot(C[2],C[3]),1),J=P,Y=D,me="prescale1",Ee,Re;for(;B>2&&J>1||G>2&&Y>1;){let Ne=J,he=Y;B>2&&J>1&&(Ne=J>=16384?Math.floor(J/2)-1||1:Math.ceil(J/2),B/=J/Ne),G>2&&Y>1&&(he=Y>=16384?Math.floor(Y/2)-1||1:Math.ceil(Y)/2,G/=Y/he),Ee=this.cachedCanvases.getCanvas(me,Ne,he),Re=Ee.context,Re.clearRect(0,0,Ne,he),Re.drawImage(S,0,0,J,Y,0,0,Ne,he),S=Ee.canvas,J=Ne,Y=he,me=me==="prescale1"?"prescale2":"prescale1"}return{img:S,paintWidth:J,paintHeight:Y}}_createMaskCanvas(S){const C=this.ctx,{width:P,height:D}=S,B=this.current.fillColor,G=this.current.patternFill,J=(0,a.getCurrentTransform)(C);let Y,me,Ee,Re;if((S.bitmap||S.data)&&S.count>1){const _e=S.bitmap||S.data.buffer;me=JSON.stringify(G?J:[J.slice(0,4),B]),Y=this._cachedBitmapsMap.get(_e),Y||(Y=new Map,this._cachedBitmapsMap.set(_e,Y));const Ge=Y.get(me);if(Ge&&!G){const Ye=Math.round(Math.min(J[0],J[2])+J[4]),ot=Math.round(Math.min(J[1],J[3])+J[5]);return{canvas:Ge,offsetX:Ye,offsetY:ot}}Ee=Ge}Ee||(Re=this.cachedCanvases.getCanvas("maskCanvas",P,D),M(Re.context,S));let Ne=s.Util.transform(J,[1/P,0,0,-1/D,0,0]);Ne=s.Util.transform(Ne,[1,0,0,1,0,-D]);const he=s.Util.applyTransform([0,0],Ne),pe=s.Util.applyTransform([P,D],Ne),fe=s.Util.normalizeRect([he[0],he[1],pe[0],pe[1]]),W=Math.round(fe[2]-fe[0])||1,Q=Math.round(fe[3]-fe[1])||1,xe=this.cachedCanvases.getCanvas("fillCanvas",W,Q),Se=xe.context,Ce=Math.min(he[0],pe[0]),Le=Math.min(he[1],pe[1]);Se.translate(-Ce,-Le),Se.transform(...Ne),Ee||(Ee=this._scaleImage(Re.canvas,(0,a.getCurrentTransformInverse)(Se)),Ee=Ee.img,Y&&G&&Y.set(me,Ee)),Se.imageSmoothingEnabled=H((0,a.getCurrentTransform)(Se),S.interpolate),g(Se,Ee,0,0,Ee.width,Ee.height,0,0,P,D),Se.globalCompositeOperation="source-in";const De=s.Util.transform((0,a.getCurrentTransformInverse)(Se),[1,0,0,1,-Ce,-Le]);return Se.fillStyle=G?B.getPattern(C,this,De,i.PathType.FILL):B,Se.fillRect(0,0,P,D),Y&&!G&&(this.cachedCanvases.delete("fillCanvas"),Y.set(me,xe.canvas)),{canvas:xe.canvas,offsetX:Math.round(Ce),offsetY:Math.round(Le)}}setLineWidth(S){S!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=S,this.ctx.lineWidth=S}setLineCap(S){this.ctx.lineCap=z[S]}setLineJoin(S){this.ctx.lineJoin=de[S]}setMiterLimit(S){this.ctx.miterLimit=S}setDash(S,C){const P=this.ctx;P.setLineDash!==void 0&&(P.setLineDash(S),P.lineDashOffset=C)}setRenderingIntent(S){}setFlatness(S){}setGState(S){for(const[C,P]of S)switch(C){case"LW":this.setLineWidth(P);break;case"LC":this.setLineCap(P);break;case"LJ":this.setLineJoin(P);break;case"ML":this.setMiterLimit(P);break;case"D":this.setDash(P[0],P[1]);break;case"RI":this.setRenderingIntent(P);break;case"FL":this.setFlatness(P);break;case"Font":this.setFont(P[0],P[1]);break;case"CA":this.current.strokeAlpha=P;break;case"ca":this.current.fillAlpha=P,this.ctx.globalAlpha=P;break;case"BM":this.ctx.globalCompositeOperation=P;break;case"SMask":this.current.activeSMask=P?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(P);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const S=this.inSMaskMode;this.current.activeSMask&&!S?this.beginSMaskMode():!this.current.activeSMask&&S&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const S=this.ctx.canvas.width,C=this.ctx.canvas.height,P="smaskGroupAt"+this.groupLevel,D=this.cachedCanvases.getCanvas(P,S,C);this.suspendedCtx=this.ctx,this.ctx=D.context;const B=this.ctx;B.setTransform(...(0,a.getCurrentTransform)(this.suspendedCtx)),A(this.suspendedCtx,B),E(B,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),A(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(S){if(!this.current.activeSMask)return;S?(S[0]=Math.floor(S[0]),S[1]=Math.floor(S[1]),S[2]=Math.ceil(S[2]),S[3]=Math.ceil(S[3])):S=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const C=this.current.activeSMask,P=this.suspendedCtx;F(P,C,this.ctx,S),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}save(){this.inSMaskMode?(A(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const S=this.current;this.stateStack.push(S),this.current=S.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),A(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(S,C,P,D,B,G){this.ctx.transform(S,C,P,D,B,G),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(S,C,P){const D=this.ctx,B=this.current;let G=B.x,J=B.y,Y,me;const Ee=(0,a.getCurrentTransform)(D),Re=Ee[0]===0&&Ee[3]===0||Ee[1]===0&&Ee[2]===0,Ne=Re?P.slice(0):null;for(let he=0,pe=0,fe=S.length;he<fe;he++)switch(S[he]|0){case s.OPS.rectangle:G=C[pe++],J=C[pe++];const W=C[pe++],Q=C[pe++],xe=G+W,Se=J+Q;D.moveTo(G,J),W===0||Q===0?D.lineTo(xe,Se):(D.lineTo(xe,J),D.lineTo(xe,Se),D.lineTo(G,Se)),Re||B.updateRectMinMax(Ee,[G,J,xe,Se]),D.closePath();break;case s.OPS.moveTo:G=C[pe++],J=C[pe++],D.moveTo(G,J),Re||B.updatePathMinMax(Ee,G,J);break;case s.OPS.lineTo:G=C[pe++],J=C[pe++],D.lineTo(G,J),Re||B.updatePathMinMax(Ee,G,J);break;case s.OPS.curveTo:Y=G,me=J,G=C[pe+4],J=C[pe+5],D.bezierCurveTo(C[pe],C[pe+1],C[pe+2],C[pe+3],G,J),B.updateCurvePathMinMax(Ee,Y,me,C[pe],C[pe+1],C[pe+2],C[pe+3],G,J,Ne),pe+=6;break;case s.OPS.curveTo2:Y=G,me=J,D.bezierCurveTo(G,J,C[pe],C[pe+1],C[pe+2],C[pe+3]),B.updateCurvePathMinMax(Ee,Y,me,G,J,C[pe],C[pe+1],C[pe+2],C[pe+3],Ne),G=C[pe+2],J=C[pe+3],pe+=4;break;case s.OPS.curveTo3:Y=G,me=J,G=C[pe+2],J=C[pe+3],D.bezierCurveTo(C[pe],C[pe+1],G,J,G,J),B.updateCurvePathMinMax(Ee,Y,me,C[pe],C[pe+1],G,J,G,J,Ne),pe+=4;break;case s.OPS.closePath:D.closePath();break}Re&&B.updateScalingPathMinMax(Ee,Ne),B.setCurrentPoint(G,J)}closePath(){this.ctx.closePath()}stroke(){let S=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const C=this.ctx,P=this.current.strokeColor;C.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof P=="object"&&(P!=null&&P.getPattern)?(C.save(),C.strokeStyle=P.getPattern(C,this,(0,a.getCurrentTransformInverse)(C),i.PathType.STROKE),this.rescaleAndStroke(!1),C.restore()):this.rescaleAndStroke(!0)),S&&this.consumePath(this.current.getClippedPathBoundingBox()),C.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(){let S=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const C=this.ctx,P=this.current.fillColor,D=this.current.patternFill;let B=!1;D&&(C.save(),C.fillStyle=P.getPattern(C,this,(0,a.getCurrentTransformInverse)(C),i.PathType.FILL),B=!0);const G=this.current.getClippedPathBoundingBox();this.contentVisible&&G!==null&&(this.pendingEOFill?(C.fill("evenodd"),this.pendingEOFill=!1):C.fill()),B&&C.restore(),S&&this.consumePath(G)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=se}eoClip(){this.pendingClip=ue}beginText(){this.current.textMatrix=s.IDENTITY_MATRIX,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const S=this.pendingTextPaths,C=this.ctx;if(S===void 0){C.beginPath();return}C.save(),C.beginPath();for(const P of S)C.setTransform(...P.transform),C.translate(P.x,P.y),P.addToPath(C,P.fontSize);C.restore(),C.clip(),C.beginPath(),delete this.pendingTextPaths}setCharSpacing(S){this.current.charSpacing=S}setWordSpacing(S){this.current.wordSpacing=S}setHScale(S){this.current.textHScale=S/100}setLeading(S){this.current.leading=-S}setFont(S,C){var Ee;const P=this.commonObjs.get(S),D=this.current;if(!P)throw new Error(`Can't find font for ${S}`);if(D.fontMatrix=P.fontMatrix||s.FONT_IDENTITY_MATRIX,(D.fontMatrix[0]===0||D.fontMatrix[3]===0)&&(0,s.warn)("Invalid font matrix for font "+S),C<0?(C=-C,D.fontDirection=-1):D.fontDirection=1,this.current.font=P,this.current.fontSize=C,P.isType3Font)return;const B=P.loadedName||"sans-serif",G=((Ee=P.systemFontInfo)==null?void 0:Ee.css)||`"${B}", ${P.fallbackName}`;let J="normal";P.black?J="900":P.bold&&(J="bold");const Y=P.italic?"italic":"normal";let me=C;C<c?me=c:C>h&&(me=h),this.current.fontSizeScale=C/me,this.ctx.font=`${Y} ${J} ${me}px ${G}`}setTextRenderingMode(S){this.current.textRenderingMode=S}setTextRise(S){this.current.textRise=S}moveText(S,C){this.current.x=this.current.lineX+=S,this.current.y=this.current.lineY+=C}setLeadingMoveText(S,C){this.setLeading(-C),this.moveText(S,C)}setTextMatrix(S,C,P,D,B,G){this.current.textMatrix=[S,C,P,D,B,G],this.current.textMatrixScale=Math.hypot(S,C),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(S,C,P,D){const B=this.ctx,G=this.current,J=G.font,Y=G.textRenderingMode,me=G.fontSize/G.fontSizeScale,Ee=Y&s.TextRenderingMode.FILL_STROKE_MASK,Re=!!(Y&s.TextRenderingMode.ADD_TO_PATH_FLAG),Ne=G.patternFill&&!J.missingFile;let he;(J.disableFontFace||Re||Ne)&&(he=J.getPathGenerator(this.commonObjs,S)),J.disableFontFace||Ne?(B.save(),B.translate(C,P),B.beginPath(),he(B,me),D&&B.setTransform(...D),(Ee===s.TextRenderingMode.FILL||Ee===s.TextRenderingMode.FILL_STROKE)&&B.fill(),(Ee===s.TextRenderingMode.STROKE||Ee===s.TextRenderingMode.FILL_STROKE)&&B.stroke(),B.restore()):((Ee===s.TextRenderingMode.FILL||Ee===s.TextRenderingMode.FILL_STROKE)&&B.fillText(S,C,P),(Ee===s.TextRenderingMode.STROKE||Ee===s.TextRenderingMode.FILL_STROKE)&&B.strokeText(S,C,P)),Re&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:(0,a.getCurrentTransform)(B),x:C,y:P,fontSize:me,addToPath:he})}get isFontSubpixelAAEnabled(){const{context:S}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);S.scale(1.5,1),S.fillText("I",0,10);const C=S.getImageData(0,0,10,10).data;let P=!1;for(let D=3;D<C.length;D+=4)if(C[D]>0&&C[D]<255){P=!0;break}return(0,s.shadow)(this,"isFontSubpixelAAEnabled",P)}showText(S){const C=this.current,P=C.font;if(P.isType3Font)return this.showType3Text(S);const D=C.fontSize;if(D===0)return;const B=this.ctx,G=C.fontSizeScale,J=C.charSpacing,Y=C.wordSpacing,me=C.fontDirection,Ee=C.textHScale*me,Re=S.length,Ne=P.vertical,he=Ne?1:-1,pe=P.defaultVMetrics,fe=D*C.fontMatrix[0],W=C.textRenderingMode===s.TextRenderingMode.FILL&&!P.disableFontFace&&!C.patternFill;B.save(),B.transform(...C.textMatrix),B.translate(C.x,C.y+C.textRise),me>0?B.scale(Ee,-1):B.scale(Ee,1);let Q;if(C.patternFill){B.save();const De=C.fillColor.getPattern(B,this,(0,a.getCurrentTransformInverse)(B),i.PathType.FILL);Q=(0,a.getCurrentTransform)(B),B.restore(),B.fillStyle=De}let xe=C.lineWidth;const Se=C.textMatrixScale;if(Se===0||xe===0){const De=C.textRenderingMode&s.TextRenderingMode.FILL_STROKE_MASK;(De===s.TextRenderingMode.STROKE||De===s.TextRenderingMode.FILL_STROKE)&&(xe=this.getSinglePixelWidth())}else xe/=Se;if(G!==1&&(B.scale(G,G),xe/=G),B.lineWidth=xe,P.isInvalidPDFjsFont){const De=[];let _e=0;for(const Ge of S)De.push(Ge.unicode),_e+=Ge.width;B.fillText(De.join(""),0,0),C.x+=_e*fe*Ee,B.restore(),this.compose();return}let Ce=0,Le;for(Le=0;Le<Re;++Le){const De=S[Le];if(typeof De=="number"){Ce+=he*De*D/1e3;continue}let _e=!1;const Ge=(De.isSpace?Y:0)+J,Ye=De.fontChar,ot=De.accent;let st,ht,Je=De.width;if(Ne){const ct=De.vmetric||pe,ft=-(De.vmetric?ct[1]:Je*.5)*fe,pt=ct[2]*fe;Je=ct?-ct[0]:Je,st=ft/G,ht=(Ce+pt)/G}else st=Ce/G,ht=0;if(P.remeasure&&Je>0){const ct=B.measureText(Ye).width*1e3/D*G;if(Je<ct&&this.isFontSubpixelAAEnabled){const ft=Je/ct;_e=!0,B.save(),B.scale(ft,1),st/=ft}else Je!==ct&&(st+=(Je-ct)/2e3*D/G)}if(this.contentVisible&&(De.isInFont||P.missingFile)){if(W&&!ot)B.fillText(Ye,st,ht);else if(this.paintChar(Ye,st,ht,Q),ot){const ct=st+D*ot.offset.x/G,ft=ht-D*ot.offset.y/G;this.paintChar(ot.fontChar,ct,ft,Q)}}const nt=Ne?Je*fe-Ge*me:Je*fe+Ge*me;Ce+=nt,_e&&B.restore()}Ne?C.y-=Ce:C.x+=Ce*Ee,B.restore(),this.compose()}showType3Text(S){const C=this.ctx,P=this.current,D=P.font,B=P.fontSize,G=P.fontDirection,J=D.vertical?1:-1,Y=P.charSpacing,me=P.wordSpacing,Ee=P.textHScale*G,Re=P.fontMatrix||s.FONT_IDENTITY_MATRIX,Ne=S.length,he=P.textRenderingMode===s.TextRenderingMode.INVISIBLE;let pe,fe,W,Q;if(!(he||B===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,C.save(),C.transform(...P.textMatrix),C.translate(P.x,P.y),C.scale(Ee,G),pe=0;pe<Ne;++pe){if(fe=S[pe],typeof fe=="number"){Q=J*fe*B/1e3,this.ctx.translate(Q,0),P.x+=Q*Ee;continue}const xe=(fe.isSpace?me:0)+Y,Se=D.charProcOperatorList[fe.operatorListId];if(!Se){(0,s.warn)(`Type3 character "${fe.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=fe,this.save(),C.scale(B,B),C.transform(...Re),this.executeOperatorList(Se),this.restore()),W=s.Util.applyTransform([fe.width,0],Re)[0]*B+xe,C.translate(W,0),P.x+=W*Ee}C.restore(),this.processingType3=null}}setCharWidth(S,C){}setCharWidthAndBounds(S,C,P,D,B,G){this.ctx.rect(P,D,B-P,G-D),this.ctx.clip(),this.endPath()}getColorN_Pattern(S){let C;if(S[0]==="TilingPattern"){const P=S[1],D=this.baseTransform||(0,a.getCurrentTransform)(this.ctx),B={createCanvasGraphics:G=>new be(G,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};C=new i.TilingPattern(S,P,this.ctx,B,D)}else C=this._getPattern(S[1],S[2]);return C}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(S,C,P){const D=s.Util.makeHexColor(S,C,P);this.ctx.strokeStyle=D,this.current.strokeColor=D}setFillRGBColor(S,C,P){const D=s.Util.makeHexColor(S,C,P);this.ctx.fillStyle=D,this.current.fillColor=D,this.current.patternFill=!1}_getPattern(S){let C=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,P;return this.cachedPatterns.has(S)?P=this.cachedPatterns.get(S):(P=(0,i.getShadingPattern)(this.getObject(S)),this.cachedPatterns.set(S,P)),C&&(P.matrix=C),P}shadingFill(S){if(!this.contentVisible)return;const C=this.ctx;this.save();const P=this._getPattern(S);C.fillStyle=P.getPattern(C,this,(0,a.getCurrentTransformInverse)(C),i.PathType.SHADING);const D=(0,a.getCurrentTransformInverse)(C);if(D){const{width:B,height:G}=C.canvas,[J,Y,me,Ee]=s.Util.getAxialAlignedBoundingBox([0,0,B,G],D);this.ctx.fillRect(J,Y,me-J,Ee-Y)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){(0,s.unreachable)("Should not call beginInlineImage")}beginImageData(){(0,s.unreachable)("Should not call beginImageData")}paintFormXObjectBegin(S,C){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),Array.isArray(S)&&S.length===6&&this.transform(...S),this.baseTransform=(0,a.getCurrentTransform)(this.ctx),C)){const P=C[2]-C[0],D=C[3]-C[1];this.ctx.rect(C[0],C[1],P,D),this.current.updateRectMinMax((0,a.getCurrentTransform)(this.ctx),C),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(S){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const C=this.ctx;S.isolated||(0,s.info)("TODO: Support non-isolated groups."),S.knockout&&(0,s.warn)("Knockout groups not supported.");const P=(0,a.getCurrentTransform)(C);if(S.matrix&&C.transform(...S.matrix),!S.bbox)throw new Error("Bounding box is required.");let D=s.Util.getAxialAlignedBoundingBox(S.bbox,(0,a.getCurrentTransform)(C));const B=[0,0,C.canvas.width,C.canvas.height];D=s.Util.intersect(D,B)||[0,0,0,0];const G=Math.floor(D[0]),J=Math.floor(D[1]);let Y=Math.max(Math.ceil(D[2])-G,1),me=Math.max(Math.ceil(D[3])-J,1),Ee=1,Re=1;Y>u&&(Ee=Y/u,Y=u),me>u&&(Re=me/u,me=u),this.current.startNewPathAndClipBox([0,0,Y,me]);let Ne="groupAt"+this.groupLevel;S.smask&&(Ne+="_smask_"+this.smaskCounter++%2);const he=this.cachedCanvases.getCanvas(Ne,Y,me),pe=he.context;pe.scale(1/Ee,1/Re),pe.translate(-G,-J),pe.transform(...P),S.smask?this.smaskStack.push({canvas:he.canvas,context:pe,offsetX:G,offsetY:J,scaleX:Ee,scaleY:Re,subtype:S.smask.subtype,backdrop:S.smask.backdrop,transferMap:S.smask.transferMap||null,startTransformInverse:null}):(C.setTransform(1,0,0,1,0,0),C.translate(G,J),C.scale(Ee,Re),C.save()),A(C,pe),this.ctx=pe,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(C),this.groupLevel++}endGroup(S){if(!this.contentVisible)return;this.groupLevel--;const C=this.ctx,P=this.groupStack.pop();if(this.ctx=P,this.ctx.imageSmoothingEnabled=!1,S.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const D=(0,a.getCurrentTransform)(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...D);const B=s.Util.getAxialAlignedBoundingBox([0,0,C.canvas.width,C.canvas.height],D);this.ctx.drawImage(C.canvas,0,0),this.ctx.restore(),this.compose(B)}}beginAnnotation(S,C,P,D,B){if(Ae(this,ge,Hr).call(this),I(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),Array.isArray(C)&&C.length===4){const G=C[2]-C[0],J=C[3]-C[1];if(B&&this.annotationCanvasMap){P=P.slice(),P[4]-=C[0],P[5]-=C[1],C=C.slice(),C[0]=C[1]=0,C[2]=G,C[3]=J;const[Y,me]=s.Util.singularValueDecompose2dScale((0,a.getCurrentTransform)(this.ctx)),{viewportScale:Ee}=this,Re=Math.ceil(G*this.outputScaleX*Ee),Ne=Math.ceil(J*this.outputScaleY*Ee);this.annotationCanvas=this.canvasFactory.create(Re,Ne);const{canvas:he,context:pe}=this.annotationCanvas;this.annotationCanvasMap.set(S,he),this.annotationCanvas.savedCtx=this.ctx,this.ctx=pe,this.ctx.save(),this.ctx.setTransform(Y,0,0,-me,0,J*me),I(this.ctx)}else I(this.ctx),this.ctx.rect(C[0],C[1],G,J),this.ctx.clip(),this.endPath()}this.current=new R(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...P),this.transform(...D)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),Ae(this,ge,Vr).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(S){if(!this.contentVisible)return;const C=S.count;S=this.getObject(S.data,S),S.count=C;const P=this.ctx,D=this.processingType3;if(D&&(D.compiled===void 0&&(D.compiled=w(S)),D.compiled)){D.compiled(P);return}const B=this._createMaskCanvas(S),G=B.canvas;P.save(),P.setTransform(1,0,0,1,0,0),P.drawImage(G,B.offsetX,B.offsetY),P.restore(),this.compose()}paintImageMaskXObjectRepeat(S,C){let P=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,D=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,B=arguments.length>4?arguments[4]:void 0,G=arguments.length>5?arguments[5]:void 0;if(!this.contentVisible)return;S=this.getObject(S.data,S);const J=this.ctx;J.save();const Y=(0,a.getCurrentTransform)(J);J.transform(C,P,D,B,0,0);const me=this._createMaskCanvas(S);J.setTransform(1,0,0,1,me.offsetX-Y[4],me.offsetY-Y[5]);for(let Ee=0,Re=G.length;Ee<Re;Ee+=2){const Ne=s.Util.transform(Y,[C,P,D,B,G[Ee],G[Ee+1]]),[he,pe]=s.Util.applyTransform([0,0],Ne);J.drawImage(me.canvas,he,pe)}J.restore(),this.compose()}paintImageMaskXObjectGroup(S){if(!this.contentVisible)return;const C=this.ctx,P=this.current.fillColor,D=this.current.patternFill;for(const B of S){const{data:G,width:J,height:Y,transform:me}=B,Ee=this.cachedCanvases.getCanvas("maskCanvas",J,Y),Re=Ee.context;Re.save();const Ne=this.getObject(G,B);M(Re,Ne),Re.globalCompositeOperation="source-in",Re.fillStyle=D?P.getPattern(Re,this,(0,a.getCurrentTransformInverse)(C),i.PathType.FILL):P,Re.fillRect(0,0,J,Y),Re.restore(),C.save(),C.transform(...me),C.scale(1,-1),g(C,Ee.canvas,0,0,J,Y,0,-1,1,1),C.restore()}this.compose()}paintImageXObject(S){if(!this.contentVisible)return;const C=this.getObject(S);if(!C){(0,s.warn)("Dependent image isn't ready yet");return}this.paintInlineImageXObject(C)}paintImageXObjectRepeat(S,C,P,D){if(!this.contentVisible)return;const B=this.getObject(S);if(!B){(0,s.warn)("Dependent image isn't ready yet");return}const G=B.width,J=B.height,Y=[];for(let me=0,Ee=D.length;me<Ee;me+=2)Y.push({transform:[C,0,0,P,D[me],D[me+1]],x:0,y:0,w:G,h:J});this.paintInlineImageXObjectGroup(B,Y)}applyTransferMapsToCanvas(S){return this.current.transferMaps!=="none"&&(S.filter=this.current.transferMaps,S.drawImage(S.canvas,0,0),S.filter="none"),S.canvas}applyTransferMapsToBitmap(S){if(this.current.transferMaps==="none")return S.bitmap;const{bitmap:C,width:P,height:D}=S,B=this.cachedCanvases.getCanvas("inlineImage",P,D),G=B.context;return G.filter=this.current.transferMaps,G.drawImage(C,0,0),G.filter="none",B.canvas}paintInlineImageXObject(S){if(!this.contentVisible)return;const C=S.width,P=S.height,D=this.ctx;if(this.save(),!s.isNodeJS){const{filter:J}=D;J!=="none"&&J!==""&&(D.filter="none")}D.scale(1/C,-1/P);let B;if(S.bitmap)B=this.applyTransferMapsToBitmap(S);else if(typeof HTMLElement=="function"&&S instanceof HTMLElement||!S.data)B=S;else{const Y=this.cachedCanvases.getCanvas("inlineImage",C,P).context;N(Y,S),B=this.applyTransferMapsToCanvas(Y)}const G=this._scaleImage(B,(0,a.getCurrentTransformInverse)(D));D.imageSmoothingEnabled=H((0,a.getCurrentTransform)(D),S.interpolate),g(D,G.img,0,0,G.paintWidth,G.paintHeight,0,-P,C,P),this.compose(),this.restore()}paintInlineImageXObjectGroup(S,C){if(!this.contentVisible)return;const P=this.ctx;let D;if(S.bitmap)D=S.bitmap;else{const B=S.width,G=S.height,Y=this.cachedCanvases.getCanvas("inlineImage",B,G).context;N(Y,S),D=this.applyTransferMapsToCanvas(Y)}for(const B of C)P.save(),P.transform(...B.transform),P.scale(1,-1),g(P,D,B.x,B.y,B.w,B.h,0,-1,1,1),P.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(S){}markPointProps(S,C){}beginMarkedContent(S){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(S,C){S==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(C)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(S){const C=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(S);const P=this.ctx;this.pendingClip&&(C||(this.pendingClip===ue?P.clip("evenodd"):P.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),P.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const S=(0,a.getCurrentTransform)(this.ctx);if(S[1]===0&&S[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(S[0]),Math.abs(S[3]));else{const C=Math.abs(S[0]*S[3]-S[2]*S[1]),P=Math.hypot(S[0],S[2]),D=Math.hypot(S[1],S[3]);this._cachedGetSinglePixelWidth=Math.max(P,D)/C}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:S}=this.current,{a:C,b:P,c:D,d:B}=this.ctx.getTransform();let G,J;if(P===0&&D===0){const Y=Math.abs(C),me=Math.abs(B);if(Y===me)if(S===0)G=J=1/Y;else{const Ee=Y*S;G=J=Ee<1?1/Ee:1}else if(S===0)G=1/Y,J=1/me;else{const Ee=Y*S,Re=me*S;G=Ee<1?1/Ee:1,J=Re<1?1/Re:1}}else{const Y=Math.abs(C*B-P*D),me=Math.hypot(C,P),Ee=Math.hypot(D,B);if(S===0)G=Ee/Y,J=me/Y;else{const Re=S*Y;G=Ee>Re?Ee/Re:1,J=me>Re?me/Re:1}}this._cachedScaleForStroking[0]=G,this._cachedScaleForStroking[1]=J}return this._cachedScaleForStroking}rescaleAndStroke(S){const{ctx:C}=this,{lineWidth:P}=this.current,[D,B]=this.getScaleForStroking();if(C.lineWidth=P||1,D===1&&B===1){C.stroke();return}const G=C.getLineDash();if(S&&C.save(),C.scale(D,B),G.length>0){const J=Math.max(D,B);C.setLineDash(G.map(Y=>Y/J)),C.lineDashOffset/=J}C.stroke(),S&&C.restore()}isContentVisible(){for(let S=this.markedContentStack.length-1;S>=0;S--)if(!this.markedContentStack[S].visible)return!1;return!0}};ge=new WeakSet,Hr=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},Vr=function(){if(this.pageColors){const S=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(S!=="none"){const C=this.ctx.filter;this.ctx.filter=S,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=C}}};let Z=be;r.CanvasGraphics=Z;for(const L in s.OPS)Z.prototype[L]!==void 0&&(Z.prototype[s.OPS[L]]=Z.prototype[L])},(t,r,e)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.TilingPattern=r.PathType=void 0,r.getShadingPattern=v,e(2);var s=e(1),a=e(168);const i={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};r.PathType=i;function o(w,R){if(!R)return;const N=R[2]-R[0],M=R[3]-R[1],A=new Path2D;A.rect(R[0],R[1],N,M),w.clip(A)}class c{constructor(){this.constructor===c&&(0,s.unreachable)("Cannot initialize BaseShadingPattern.")}getPattern(){(0,s.unreachable)("Abstract method `getPattern` called.")}}class h extends c{constructor(R){super(),this._type=R[1],this._bbox=R[2],this._colorStops=R[3],this._p0=R[4],this._p1=R[5],this._r0=R[6],this._r1=R[7],this.matrix=null}_createGradient(R){let N;this._type==="axial"?N=R.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(N=R.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const M of this._colorStops)N.addColorStop(M[0],M[1]);return N}getPattern(R,N,M,A){let I;if(A===i.STROKE||A===i.FILL){const y=N.current.getClippedPathBoundingBox(A,(0,a.getCurrentTransform)(R))||[0,0,0,0],j=Math.ceil(y[2]-y[0])||1,T=Math.ceil(y[3]-y[1])||1,U=N.cachedCanvases.getCanvas("pattern",j,T,!0),F=U.context;F.clearRect(0,0,F.canvas.width,F.canvas.height),F.beginPath(),F.rect(0,0,F.canvas.width,F.canvas.height),F.translate(-y[0],-y[1]),M=s.Util.transform(M,[1,0,0,1,y[0],y[1]]),F.transform(...N.baseTransform),this.matrix&&F.transform(...this.matrix),o(F,this._bbox),F.fillStyle=this._createGradient(F),F.fill(),I=R.createPattern(U.canvas,"no-repeat");const H=new DOMMatrix(M);I.setTransform(H)}else o(R,this._bbox),I=this._createGradient(R);return I}}function u(w,R,N,M,A,I,y,j){const T=R.coords,U=R.colors,F=w.data,H=w.width*4;let z;T[N+1]>T[M+1]&&(z=N,N=M,M=z,z=I,I=y,y=z),T[M+1]>T[A+1]&&(z=M,M=A,A=z,z=y,y=j,j=z),T[N+1]>T[M+1]&&(z=N,N=M,M=z,z=I,I=y,y=z);const de=(T[N]+R.offsetX)*R.scaleX,se=(T[N+1]+R.offsetY)*R.scaleY,ue=(T[M]+R.offsetX)*R.scaleX,Z=(T[M+1]+R.offsetY)*R.scaleY,ge=(T[A]+R.offsetX)*R.scaleX,re=(T[A+1]+R.offsetY)*R.scaleY;if(se>=re)return;const oe=U[I],be=U[I+1],L=U[I+2],S=U[y],C=U[y+1],P=U[y+2],D=U[j],B=U[j+1],G=U[j+2],J=Math.round(se),Y=Math.round(re);let me,Ee,Re,Ne,he,pe,fe,W;for(let Q=J;Q<=Y;Q++){if(Q<Z){const De=Q<se?0:(se-Q)/(se-Z);me=de-(de-ue)*De,Ee=oe-(oe-S)*De,Re=be-(be-C)*De,Ne=L-(L-P)*De}else{let De;Q>re?De=1:Z===re?De=0:De=(Z-Q)/(Z-re),me=ue-(ue-ge)*De,Ee=S-(S-D)*De,Re=C-(C-B)*De,Ne=P-(P-G)*De}let xe;Q<se?xe=0:Q>re?xe=1:xe=(se-Q)/(se-re),he=de-(de-ge)*xe,pe=oe-(oe-D)*xe,fe=be-(be-B)*xe,W=L-(L-G)*xe;const Se=Math.round(Math.min(me,he)),Ce=Math.round(Math.max(me,he));let Le=H*Q+Se*4;for(let De=Se;De<=Ce;De++)xe=(me-De)/(me-he),xe<0?xe=0:xe>1&&(xe=1),F[Le++]=Ee-(Ee-pe)*xe|0,F[Le++]=Re-(Re-fe)*xe|0,F[Le++]=Ne-(Ne-W)*xe|0,F[Le++]=255}}function d(w,R,N){const M=R.coords,A=R.colors;let I,y;switch(R.type){case"lattice":const j=R.verticesPerRow,T=Math.floor(M.length/j)-1,U=j-1;for(I=0;I<T;I++){let F=I*j;for(let H=0;H<U;H++,F++)u(w,N,M[F],M[F+1],M[F+j],A[F],A[F+1],A[F+j]),u(w,N,M[F+j+1],M[F+1],M[F+j],A[F+j+1],A[F+1],A[F+j])}break;case"triangles":for(I=0,y=M.length;I<y;I+=3)u(w,N,M[I],M[I+1],M[I+2],A[I],A[I+1],A[I+2]);break;default:throw new Error("illegal figure")}}class _ extends c{constructor(R){super(),this._coords=R[2],this._colors=R[3],this._figures=R[4],this._bounds=R[5],this._bbox=R[7],this._background=R[8],this.matrix=null}_createMeshCanvas(R,N,M){const j=Math.floor(this._bounds[0]),T=Math.floor(this._bounds[1]),U=Math.ceil(this._bounds[2])-j,F=Math.ceil(this._bounds[3])-T,H=Math.min(Math.ceil(Math.abs(U*R[0]*1.1)),3e3),z=Math.min(Math.ceil(Math.abs(F*R[1]*1.1)),3e3),de=U/H,se=F/z,ue={coords:this._coords,colors:this._colors,offsetX:-j,offsetY:-T,scaleX:1/de,scaleY:1/se},Z=H+2*2,ge=z+2*2,re=M.getCanvas("mesh",Z,ge,!1),oe=re.context,be=oe.createImageData(H,z);if(N){const S=be.data;for(let C=0,P=S.length;C<P;C+=4)S[C]=N[0],S[C+1]=N[1],S[C+2]=N[2],S[C+3]=255}for(const S of this._figures)d(be,S,ue);return oe.putImageData(be,2,2),{canvas:re.canvas,offsetX:j-2*de,offsetY:T-2*se,scaleX:de,scaleY:se}}getPattern(R,N,M,A){o(R,this._bbox);let I;if(A===i.SHADING)I=s.Util.singularValueDecompose2dScale((0,a.getCurrentTransform)(R));else if(I=s.Util.singularValueDecompose2dScale(N.baseTransform),this.matrix){const j=s.Util.singularValueDecompose2dScale(this.matrix);I=[I[0]*j[0],I[1]*j[1]]}const y=this._createMeshCanvas(I,A===i.SHADING?null:this._background,N.cachedCanvases);return A!==i.SHADING&&(R.setTransform(...N.baseTransform),this.matrix&&R.transform(...this.matrix)),R.translate(y.offsetX,y.offsetY),R.scale(y.scaleX,y.scaleY),R.createPattern(y.canvas,"no-repeat")}}class b extends c{getPattern(){return"hotpink"}}function v(w){switch(w[0]){case"RadialAxial":return new h(w);case"Mesh":return new _(w);case"Dummy":return new b}throw new Error(`Unknown IR type: ${w[0]}`)}const E={COLORED:1,UNCOLORED:2},g=class g{constructor(R,N,M,A,I){this.operatorList=R[2],this.matrix=R[3]||[1,0,0,1,0,0],this.bbox=R[4],this.xstep=R[5],this.ystep=R[6],this.paintType=R[7],this.tilingType=R[8],this.color=N,this.ctx=M,this.canvasGraphicsFactory=A,this.baseTransform=I}createPatternCanvas(R){const N=this.operatorList,M=this.bbox,A=this.xstep,I=this.ystep,y=this.paintType,j=this.tilingType,T=this.color,U=this.canvasGraphicsFactory;(0,s.info)("TilingType: "+j);const F=M[0],H=M[1],z=M[2],de=M[3],se=s.Util.singularValueDecompose2dScale(this.matrix),ue=s.Util.singularValueDecompose2dScale(this.baseTransform),Z=[se[0]*ue[0],se[1]*ue[1]],ge=this.getSizeAndScale(A,this.ctx.canvas.width,Z[0]),re=this.getSizeAndScale(I,this.ctx.canvas.height,Z[1]),oe=R.cachedCanvases.getCanvas("pattern",ge.size,re.size,!0),be=oe.context,L=U.createCanvasGraphics(be);L.groupLevel=R.groupLevel,this.setFillAndStrokeStyleToContext(L,y,T);let S=F,C=H,P=z,D=de;return F<0&&(S=0,P+=Math.abs(F)),H<0&&(C=0,D+=Math.abs(H)),be.translate(-(ge.scale*S),-(re.scale*C)),L.transform(ge.scale,0,0,re.scale,0,0),be.save(),this.clipBbox(L,S,C,P,D),L.baseTransform=(0,a.getCurrentTransform)(L.ctx),L.executeOperatorList(N),L.endDrawing(),{canvas:oe.canvas,scaleX:ge.scale,scaleY:re.scale,offsetX:S,offsetY:C}}getSizeAndScale(R,N,M){R=Math.abs(R);const A=Math.max(g.MAX_PATTERN_SIZE,N);let I=Math.ceil(R*M);return I>=A?I=A:M=I/R,{scale:M,size:I}}clipBbox(R,N,M,A,I){const y=A-N,j=I-M;R.ctx.rect(N,M,y,j),R.current.updateRectMinMax((0,a.getCurrentTransform)(R.ctx),[N,M,A,I]),R.clip(),R.endPath()}setFillAndStrokeStyleToContext(R,N,M){const A=R.ctx,I=R.current;switch(N){case E.COLORED:const y=this.ctx;A.fillStyle=y.fillStyle,A.strokeStyle=y.strokeStyle,I.fillColor=y.fillStyle,I.strokeColor=y.strokeStyle;break;case E.UNCOLORED:const j=s.Util.makeHexColor(M[0],M[1],M[2]);A.fillStyle=j,A.strokeStyle=j,I.fillColor=j,I.strokeColor=j;break;default:throw new s.FormatError(`Unsupported paint type: ${N}`)}}getPattern(R,N,M,A){let I=M;A!==i.SHADING&&(I=s.Util.transform(I,N.baseTransform),this.matrix&&(I=s.Util.transform(I,this.matrix)));const y=this.createPatternCanvas(N);let j=new DOMMatrix(I);j=j.translate(y.offsetX,y.offsetY),j=j.scale(1/y.scaleX,1/y.scaleY);const T=R.createPattern(y.canvas,"repeat");return T.setTransform(j),T}};bt(g,"MAX_PATTERN_SIZE",3e3);let x=g;r.TilingPattern=x},(t,r,e)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.convertBlackAndWhiteToRGBA=i,r.convertToRGBA=a,r.grayToRGBA=c,e(93),e(101),e(102),e(105),e(107),e(109),e(113),e(116),e(123);var s=e(1);function a(h){switch(h.kind){case s.ImageKind.GRAYSCALE_1BPP:return i(h);case s.ImageKind.RGB_24BPP:return o(h)}return null}function i(h){let{src:u,srcPos:d=0,dest:_,width:b,height:v,nonBlackColor:E=4294967295,inverseDecode:x=!1}=h;const g=s.FeatureTest.isLittleEndian?4278190080:255,[w,R]=x?[E,g]:[g,E],N=b>>3,M=b&7,A=u.length;_=new Uint32Array(_.buffer);let I=0;for(let y=0;y<v;y++){for(const T=d+N;d<T;d++){const U=d<A?u[d]:255;_[I++]=U&128?R:w,_[I++]=U&64?R:w,_[I++]=U&32?R:w,_[I++]=U&16?R:w,_[I++]=U&8?R:w,_[I++]=U&4?R:w,_[I++]=U&2?R:w,_[I++]=U&1?R:w}if(M===0)continue;const j=d<A?u[d++]:255;for(let T=0;T<M;T++)_[I++]=j&1<<7-T?R:w}return{srcPos:d,destPos:I}}function o(h){let{src:u,srcPos:d=0,dest:_,destPos:b=0,width:v,height:E}=h,x=0;const g=u.length>>2,w=new Uint32Array(u.buffer,d,g);if(s.FeatureTest.isLittleEndian){for(;x<g-2;x+=3,b+=4){const R=w[x],N=w[x+1],M=w[x+2];_[b]=R|4278190080,_[b+1]=R>>>24|N<<8|4278190080,_[b+2]=N>>>16|M<<16|4278190080,_[b+3]=M>>>8|4278190080}for(let R=x*4,N=u.length;R<N;R+=3)_[b++]=u[R]|u[R+1]<<8|u[R+2]<<16|4278190080}else{for(;x<g-2;x+=3,b+=4){const R=w[x],N=w[x+1],M=w[x+2];_[b]=R|255,_[b+1]=R<<24|N>>>8|255,_[b+2]=N<<16|M>>>16|255,_[b+3]=M<<8|255}for(let R=x*4,N=u.length;R<N;R+=3)_[b++]=u[R]<<24|u[R+1]<<16|u[R+2]<<8|255}return{srcPos:d,destPos:b}}function c(h,u){if(s.FeatureTest.isLittleEndian)for(let d=0,_=h.length;d<_;d++)u[d]=h[d]*65793|4278190080;else for(let d=0,_=h.length;d<_;d++)u[d]=h[d]*16843008|255}},(t,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.GlobalWorkerOptions=void 0;const e=Object.create(null);r.GlobalWorkerOptions=e,e.workerPort=null,e.workerSrc=""},(t,r,e)=>{var h,ys,_s,gr;Object.defineProperty(r,"__esModule",{value:!0}),r.MessageHandler=void 0,e(2);var s=e(1);const a={DATA:1,ERROR:2},i={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function o(b){switch(b instanceof Error||typeof b=="object"&&b!==null||(0,s.unreachable)('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),b.name){case"AbortException":return new s.AbortException(b.message);case"MissingPDFException":return new s.MissingPDFException(b.message);case"PasswordException":return new s.PasswordException(b.message,b.code);case"UnexpectedResponseException":return new s.UnexpectedResponseException(b.message,b.status);case"UnknownErrorException":return new s.UnknownErrorException(b.message,b.details);default:return new s.UnknownErrorException(b.message,b.toString())}}class c{constructor(v,E,x){ke(this,h);this.sourceName=v,this.targetName=E,this.comObj=x,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=g=>{const w=g.data;if(w.targetName!==this.sourceName)return;if(w.stream){Ae(this,h,_s).call(this,w);return}if(w.callback){const N=w.callbackId,M=this.callbackCapabilities[N];if(!M)throw new Error(`Cannot resolve callback ${N}`);if(delete this.callbackCapabilities[N],w.callback===a.DATA)M.resolve(w.data);else if(w.callback===a.ERROR)M.reject(o(w.reason));else throw new Error("Unexpected callback case");return}const R=this.actionHandler[w.action];if(!R)throw new Error(`Unknown action from worker: ${w.action}`);if(w.callbackId){const N=this.sourceName,M=w.sourceName;new Promise(function(A){A(R(w.data))}).then(function(A){x.postMessage({sourceName:N,targetName:M,callback:a.DATA,callbackId:w.callbackId,data:A})},function(A){x.postMessage({sourceName:N,targetName:M,callback:a.ERROR,callbackId:w.callbackId,reason:o(A)})});return}if(w.streamId){Ae(this,h,ys).call(this,w);return}R(w.data)},x.addEventListener("message",this._onComObjOnMessage)}on(v,E){const x=this.actionHandler;if(x[v])throw new Error(`There is already an actionName called "${v}"`);x[v]=E}send(v,E,x){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:v,data:E},x)}sendWithPromise(v,E,x){const g=this.callbackId++,w=new s.PromiseCapability;this.callbackCapabilities[g]=w;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:v,callbackId:g,data:E},x)}catch(R){w.reject(R)}return w.promise}sendWithStream(v,E,x,g){const w=this.streamId++,R=this.sourceName,N=this.targetName,M=this.comObj;return new ReadableStream({start:A=>{const I=new s.PromiseCapability;return this.streamControllers[w]={controller:A,startCall:I,pullCall:null,cancelCall:null,isClosed:!1},M.postMessage({sourceName:R,targetName:N,action:v,streamId:w,data:E,desiredSize:A.desiredSize},g),I.promise},pull:A=>{const I=new s.PromiseCapability;return this.streamControllers[w].pullCall=I,M.postMessage({sourceName:R,targetName:N,stream:i.PULL,streamId:w,desiredSize:A.desiredSize}),I.promise},cancel:A=>{(0,s.assert)(A instanceof Error,"cancel must have a valid reason");const I=new s.PromiseCapability;return this.streamControllers[w].cancelCall=I,this.streamControllers[w].isClosed=!0,M.postMessage({sourceName:R,targetName:N,stream:i.CANCEL,streamId:w,reason:o(A)}),I.promise}},x)}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}h=new WeakSet,ys=function(v){const E=v.streamId,x=this.sourceName,g=v.sourceName,w=this.comObj,R=this,N=this.actionHandler[v.action],M={enqueue(A){let I=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,y=arguments.length>2?arguments[2]:void 0;if(this.isCancelled)return;const j=this.desiredSize;this.desiredSize-=I,j>0&&this.desiredSize<=0&&(this.sinkCapability=new s.PromiseCapability,this.ready=this.sinkCapability.promise),w.postMessage({sourceName:x,targetName:g,stream:i.ENQUEUE,streamId:E,chunk:A},y)},close(){this.isCancelled||(this.isCancelled=!0,w.postMessage({sourceName:x,targetName:g,stream:i.CLOSE,streamId:E}),delete R.streamSinks[E])},error(A){(0,s.assert)(A instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,w.postMessage({sourceName:x,targetName:g,stream:i.ERROR,streamId:E,reason:o(A)}))},sinkCapability:new s.PromiseCapability,onPull:null,onCancel:null,isCancelled:!1,desiredSize:v.desiredSize,ready:null};M.sinkCapability.resolve(),M.ready=M.sinkCapability.promise,this.streamSinks[E]=M,new Promise(function(A){A(N(v.data,M))}).then(function(){w.postMessage({sourceName:x,targetName:g,stream:i.START_COMPLETE,streamId:E,success:!0})},function(A){w.postMessage({sourceName:x,targetName:g,stream:i.START_COMPLETE,streamId:E,reason:o(A)})})},_s=function(v){const E=v.streamId,x=this.sourceName,g=v.sourceName,w=this.comObj,R=this.streamControllers[E],N=this.streamSinks[E];switch(v.stream){case i.START_COMPLETE:v.success?R.startCall.resolve():R.startCall.reject(o(v.reason));break;case i.PULL_COMPLETE:v.success?R.pullCall.resolve():R.pullCall.reject(o(v.reason));break;case i.PULL:if(!N){w.postMessage({sourceName:x,targetName:g,stream:i.PULL_COMPLETE,streamId:E,success:!0});break}N.desiredSize<=0&&v.desiredSize>0&&N.sinkCapability.resolve(),N.desiredSize=v.desiredSize,new Promise(function(M){var A;M((A=N.onPull)==null?void 0:A.call(N))}).then(function(){w.postMessage({sourceName:x,targetName:g,stream:i.PULL_COMPLETE,streamId:E,success:!0})},function(M){w.postMessage({sourceName:x,targetName:g,stream:i.PULL_COMPLETE,streamId:E,reason:o(M)})});break;case i.ENQUEUE:if((0,s.assert)(R,"enqueue should have stream controller"),R.isClosed)break;R.controller.enqueue(v.chunk);break;case i.CLOSE:if((0,s.assert)(R,"close should have stream controller"),R.isClosed)break;R.isClosed=!0,R.controller.close(),Ae(this,h,gr).call(this,R,E);break;case i.ERROR:(0,s.assert)(R,"error should have stream controller"),R.controller.error(o(v.reason)),Ae(this,h,gr).call(this,R,E);break;case i.CANCEL_COMPLETE:v.success?R.cancelCall.resolve():R.cancelCall.reject(o(v.reason)),Ae(this,h,gr).call(this,R,E);break;case i.CANCEL:if(!N)break;new Promise(function(M){var A;M((A=N.onCancel)==null?void 0:A.call(N,o(v.reason)))}).then(function(){w.postMessage({sourceName:x,targetName:g,stream:i.CANCEL_COMPLETE,streamId:E,success:!0})},function(M){w.postMessage({sourceName:x,targetName:g,stream:i.CANCEL_COMPLETE,streamId:E,reason:o(M)})}),N.sinkCapability.reject(o(v.reason)),N.isCancelled=!0,delete this.streamSinks[E];break;default:throw new Error("Unexpected stream case")}},gr=async function(v,E){var x,g,w;await Promise.allSettled([(x=v.startCall)==null?void 0:x.promise,(g=v.pullCall)==null?void 0:g.promise,(w=v.cancelCall)==null?void 0:w.promise]),delete this.streamControllers[E]},r.MessageHandler=c},(t,r,e)=>{var i,o;Object.defineProperty(r,"__esModule",{value:!0}),r.Metadata=void 0;var s=e(1);class a{constructor(h){ke(this,i);ke(this,o);let{parsedData:u,rawData:d}=h;Ie(this,i,u),Ie(this,o,d)}getRaw(){return O(this,o)}get(h){return O(this,i).get(h)??null}getAll(){return(0,s.objectFromMap)(O(this,i))}has(h){return O(this,i).has(h)}}i=new WeakMap,o=new WeakMap,r.Metadata=a},(t,r,e)=>{var h,u,d,_,b,v,$r;Object.defineProperty(r,"__esModule",{value:!0}),r.OptionalContentConfig=void 0;var s=e(1),a=e(170);const i=Symbol("INTERNAL");class o{constructor(g,w){ke(this,h,!0);this.name=g,this.intent=w}get visible(){return O(this,h)}_setVisible(g,w){g!==i&&(0,s.unreachable)("Internal method `_setVisible` called."),Ie(this,h,w)}}h=new WeakMap;class c{constructor(g){ke(this,v);ke(this,u,null);ke(this,d,new Map);ke(this,_,null);ke(this,b,null);if(this.name=null,this.creator=null,g!==null){this.name=g.name,this.creator=g.creator,Ie(this,b,g.order);for(const w of g.groups)O(this,d).set(w.id,new o(w.name,w.intent));if(g.baseState==="OFF")for(const w of O(this,d).values())w._setVisible(i,!1);for(const w of g.on)O(this,d).get(w)._setVisible(i,!0);for(const w of g.off)O(this,d).get(w)._setVisible(i,!1);Ie(this,_,this.getHash())}}isVisible(g){if(O(this,d).size===0)return!0;if(!g)return(0,s.warn)("Optional content group not defined."),!0;if(g.type==="OCG")return O(this,d).has(g.id)?O(this,d).get(g.id).visible:((0,s.warn)(`Optional content group not found: ${g.id}`),!0);if(g.type==="OCMD"){if(g.expression)return Ae(this,v,$r).call(this,g.expression);if(!g.policy||g.policy==="AnyOn"){for(const w of g.ids){if(!O(this,d).has(w))return(0,s.warn)(`Optional content group not found: ${w}`),!0;if(O(this,d).get(w).visible)return!0}return!1}else if(g.policy==="AllOn"){for(const w of g.ids){if(!O(this,d).has(w))return(0,s.warn)(`Optional content group not found: ${w}`),!0;if(!O(this,d).get(w).visible)return!1}return!0}else if(g.policy==="AnyOff"){for(const w of g.ids){if(!O(this,d).has(w))return(0,s.warn)(`Optional content group not found: ${w}`),!0;if(!O(this,d).get(w).visible)return!0}return!1}else if(g.policy==="AllOff"){for(const w of g.ids){if(!O(this,d).has(w))return(0,s.warn)(`Optional content group not found: ${w}`),!0;if(O(this,d).get(w).visible)return!1}return!0}return(0,s.warn)(`Unknown optional content policy ${g.policy}.`),!0}return(0,s.warn)(`Unknown group type ${g.type}.`),!0}setVisibility(g){let w=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!O(this,d).has(g)){(0,s.warn)(`Optional content group not found: ${g}`);return}O(this,d).get(g)._setVisible(i,!!w),Ie(this,u,null)}get hasInitialVisibility(){return O(this,_)===null||this.getHash()===O(this,_)}getOrder(){return O(this,d).size?O(this,b)?O(this,b).slice():[...O(this,d).keys()]:null}getGroups(){return O(this,d).size>0?(0,s.objectFromMap)(O(this,d)):null}getGroup(g){return O(this,d).get(g)||null}getHash(){if(O(this,u)!==null)return O(this,u);const g=new a.MurmurHash3_64;for(const[w,R]of O(this,d))g.update(`${w}:${R.visible}`);return Ie(this,u,g.hexdigest())}}u=new WeakMap,d=new WeakMap,_=new WeakMap,b=new WeakMap,v=new WeakSet,$r=function(g){const w=g.length;if(w<2)return!0;const R=g[0];for(let N=1;N<w;N++){const M=g[N];let A;if(Array.isArray(M))A=Ae(this,v,$r).call(this,M);else if(O(this,d).has(M))A=O(this,d).get(M).visible;else return(0,s.warn)(`Optional content group not found: ${M}`),!0;switch(R){case"And":if(!A)return!1;break;case"Or":if(A)return!0;break;case"Not":return!A;default:return!0}}return R==="And"},r.OptionalContentConfig=c},(t,r,e)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.PDFDataTransportStream=void 0,e(93),e(101),e(102),e(105),e(107),e(109),e(113),e(116),e(123),e(89);var s=e(1),a=e(168);class i{constructor(u,d){let{length:_,initialData:b,progressiveDone:v=!1,contentDispositionFilename:E=null,disableRange:x=!1,disableStream:g=!1}=u;if((0,s.assert)(d,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.'),this._queuedChunks=[],this._progressiveDone=v,this._contentDispositionFilename=E,(b==null?void 0:b.length)>0){const w=b instanceof Uint8Array&&b.byteLength===b.buffer.byteLength?b.buffer:new Uint8Array(b).buffer;this._queuedChunks.push(w)}this._pdfDataRangeTransport=d,this._isStreamingSupported=!g,this._isRangeSupported=!x,this._contentLength=_,this._fullRequestReader=null,this._rangeReaders=[],this._pdfDataRangeTransport.addRangeListener((w,R)=>{this._onReceiveData({begin:w,chunk:R})}),this._pdfDataRangeTransport.addProgressListener((w,R)=>{this._onProgress({loaded:w,total:R})}),this._pdfDataRangeTransport.addProgressiveReadListener(w=>{this._onReceiveData({chunk:w})}),this._pdfDataRangeTransport.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),this._pdfDataRangeTransport.transportReady()}_onReceiveData(u){let{begin:d,chunk:_}=u;const b=_ instanceof Uint8Array&&_.byteLength===_.buffer.byteLength?_.buffer:new Uint8Array(_).buffer;if(d===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(b):this._queuedChunks.push(b);else{const v=this._rangeReaders.some(function(E){return E._begin!==d?!1:(E._enqueue(b),!0)});(0,s.assert)(v,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var u;return((u=this._fullRequestReader)==null?void 0:u._loaded)??0}_onProgress(u){var d,_,b,v;u.total===void 0?(_=(d=this._rangeReaders[0])==null?void 0:d.onProgress)==null||_.call(d,{loaded:u.loaded}):(v=(b=this._fullRequestReader)==null?void 0:b.onProgress)==null||v.call(b,{loaded:u.loaded,total:u.total})}_onProgressiveDone(){var u;(u=this._fullRequestReader)==null||u.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(u){const d=this._rangeReaders.indexOf(u);d>=0&&this._rangeReaders.splice(d,1)}getFullReader(){(0,s.assert)(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const u=this._queuedChunks;return this._queuedChunks=null,new o(this,u,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(u,d){if(d<=this._progressiveDataLength)return null;const _=new c(this,u,d);return this._pdfDataRangeTransport.requestDataRange(u,d),this._rangeReaders.push(_),_}cancelAllRequests(u){var d;(d=this._fullRequestReader)==null||d.cancel(u);for(const _ of this._rangeReaders.slice(0))_.cancel(u);this._pdfDataRangeTransport.abort()}}r.PDFDataTransportStream=i;class o{constructor(u,d){let _=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,b=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;this._stream=u,this._done=_||!1,this._filename=(0,a.isPdfFile)(b)?b:null,this._queuedChunks=d||[],this._loaded=0;for(const v of this._queuedChunks)this._loaded+=v.byteLength;this._requests=[],this._headersReady=Promise.resolve(),u._fullRequestReader=this,this.onProgress=null}_enqueue(u){this._done||(this._requests.length>0?this._requests.shift().resolve({value:u,done:!1}):this._queuedChunks.push(u),this._loaded+=u.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const u=new s.PromiseCapability;return this._requests.push(u),u.promise}cancel(u){this._done=!0;for(const d of this._requests)d.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class c{constructor(u,d,_){this._stream=u,this._begin=d,this._end=_,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(u){if(!this._done){if(this._requests.length===0)this._queuedChunk=u;else{this._requests.shift().resolve({value:u,done:!1});for(const _ of this._requests)_.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const d=this._queuedChunk;return this._queuedChunk=null,{value:d,done:!1}}if(this._done)return{value:void 0,done:!0};const u=new s.PromiseCapability;return this._requests.push(u),u.promise}cancel(u){this._done=!0;for(const d of this._requests)d.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}},(t,r,e)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.PDFFetchStream=void 0,e(93),e(101),e(102),e(105),e(107),e(109),e(113),e(116),e(123),e(89);var s=e(1),a=e(182);function i(_,b,v){return{method:"GET",headers:_,signal:v.signal,mode:"cors",credentials:b?"include":"same-origin",redirect:"follow"}}function o(_){const b=new Headers;for(const v in _){const E=_[v];E!==void 0&&b.append(v,E)}return b}function c(_){return _ instanceof Uint8Array?_.buffer:_ instanceof ArrayBuffer?_:((0,s.warn)(`getArrayBuffer - unexpected data format: ${_}`),new Uint8Array(_).buffer)}class h{constructor(b){this.source=b,this.isHttp=/^https?:/i.test(b.url),this.httpHeaders=this.isHttp&&b.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var b;return((b=this._fullRequestReader)==null?void 0:b._loaded)??0}getFullReader(){return(0,s.assert)(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new u(this),this._fullRequestReader}getRangeReader(b,v){if(v<=this._progressiveDataLength)return null;const E=new d(this,b,v);return this._rangeRequestReaders.push(E),E}cancelAllRequests(b){var v;(v=this._fullRequestReader)==null||v.cancel(b);for(const E of this._rangeRequestReaders.slice(0))E.cancel(b)}}r.PDFFetchStream=h;class u{constructor(b){this._stream=b,this._reader=null,this._loaded=0,this._filename=null;const v=b.source;this._withCredentials=v.withCredentials||!1,this._contentLength=v.length,this._headersCapability=new s.PromiseCapability,this._disableRange=v.disableRange||!1,this._rangeChunkSize=v.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!v.disableStream,this._isRangeSupported=!v.disableRange,this._headers=o(this._stream.httpHeaders);const E=v.url;fetch(E,i(this._headers,this._withCredentials,this._abortController)).then(x=>{if(!(0,a.validateResponseStatus)(x.status))throw(0,a.createResponseStatusError)(x.status,E);this._reader=x.body.getReader(),this._headersCapability.resolve();const g=N=>x.headers.get(N),{allowRangeRequests:w,suggestedLength:R}=(0,a.validateRangeRequestCapabilities)({getResponseHeader:g,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=w,this._contentLength=R||this._contentLength,this._filename=(0,a.extractFilenameFromHeader)(g),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new s.AbortException("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var E;await this._headersCapability.promise;const{value:b,done:v}=await this._reader.read();return v?{value:b,done:v}:(this._loaded+=b.byteLength,(E=this.onProgress)==null||E.call(this,{loaded:this._loaded,total:this._contentLength}),{value:c(b),done:!1})}cancel(b){var v;(v=this._reader)==null||v.cancel(b),this._abortController.abort()}}class d{constructor(b,v,E){this._stream=b,this._reader=null,this._loaded=0;const x=b.source;this._withCredentials=x.withCredentials||!1,this._readCapability=new s.PromiseCapability,this._isStreamingSupported=!x.disableStream,this._abortController=new AbortController,this._headers=o(this._stream.httpHeaders),this._headers.append("Range",`bytes=${v}-${E-1}`);const g=x.url;fetch(g,i(this._headers,this._withCredentials,this._abortController)).then(w=>{if(!(0,a.validateResponseStatus)(w.status))throw(0,a.createResponseStatusError)(w.status,g);this._readCapability.resolve(),this._reader=w.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var E;await this._readCapability.promise;const{value:b,done:v}=await this._reader.read();return v?{value:b,done:v}:(this._loaded+=b.byteLength,(E=this.onProgress)==null||E.call(this,{loaded:this._loaded}),{value:c(b),done:!1})}cancel(b){var v;(v=this._reader)==null||v.cancel(b),this._abortController.abort()}}},(t,r,e)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.createResponseStatusError=h,r.extractFilenameFromHeader=c,r.validateRangeRequestCapabilities=o,r.validateResponseStatus=u;var s=e(1),a=e(183),i=e(168);function o(d){let{getResponseHeader:_,isHttp:b,rangeChunkSize:v,disableRange:E}=d;const x={allowRangeRequests:!1,suggestedLength:void 0},g=parseInt(_("Content-Length"),10);return!Number.isInteger(g)||(x.suggestedLength=g,g<=2*v)||E||!b||_("Accept-Ranges")!=="bytes"||(_("Content-Encoding")||"identity")!=="identity"||(x.allowRangeRequests=!0),x}function c(d){const _=d("Content-Disposition");if(_){let b=(0,a.getFilenameFromContentDispositionHeader)(_);if(b.includes("%"))try{b=decodeURIComponent(b)}catch{}if((0,i.isPdfFile)(b))return b}return null}function h(d,_){return d===404||d===0&&_.startsWith("file:")?new s.MissingPDFException('Missing PDF "'+_+'".'):new s.UnexpectedResponseException(`Unexpected server response (${d}) while retrieving PDF "${_}".`,d)}function u(d){return d===200||d===206}},(t,r,e)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.getFilenameFromContentDispositionHeader=a,e(89),e(149);var s=e(1);function a(i){let o=!0,c=h("filename\\*","i").exec(i);if(c){c=c[1];let x=b(c);return x=unescape(x),x=v(x),x=E(x),d(x)}if(c=_(i),c){const x=E(c);return d(x)}if(c=h("filename","i").exec(i),c){c=c[1];let x=b(c);return x=E(x),d(x)}function h(x,g){return new RegExp("(?:^|;)\\s*"+x+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',g)}function u(x,g){if(x){if(!/^[\x00-\xFF]+$/.test(g))return g;try{const w=new TextDecoder(x,{fatal:!0}),R=(0,s.stringToBytes)(g);g=w.decode(R),o=!1}catch{}}return g}function d(x){return o&&/[\x80-\xff]/.test(x)&&(x=u("utf-8",x),o&&(x=u("iso-8859-1",x))),x}function _(x){const g=[];let w;const R=h("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(w=R.exec(x))!==null;){let[,M,A,I]=w;if(M=parseInt(M,10),M in g){if(M===0)break;continue}g[M]=[A,I]}const N=[];for(let M=0;M<g.length&&M in g;++M){let[A,I]=g[M];I=b(I),A&&(I=unescape(I),M===0&&(I=v(I))),N.push(I)}return N.join("")}function b(x){if(x.startsWith('"')){const g=x.slice(1).split('\\"');for(let w=0;w<g.length;++w){const R=g[w].indexOf('"');R!==-1&&(g[w]=g[w].slice(0,R),g.length=w+1),g[w]=g[w].replaceAll(/\\(.)/g,"$1")}x=g.join('"')}return x}function v(x){const g=x.indexOf("'");if(g===-1)return x;const w=x.slice(0,g),N=x.slice(g+1).replace(/^[^']*'/,"");return u(w,N)}function E(x){return!x.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(x)?x:x.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(g,w,R,N){if(R==="q"||R==="Q")return N=N.replaceAll("_"," "),N=N.replaceAll(/=([0-9a-fA-F]{2})/g,function(M,A){return String.fromCharCode(parseInt(A,16))}),u(w,N);try{N=atob(N)}catch{}return u(w,N)})}return""}},(t,r,e)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.PDFNetworkStream=void 0,e(89);var s=e(1),a=e(182);const i=200,o=206;function c(b){const v=b.response;return typeof v!="string"?v:(0,s.stringToBytes)(v).buffer}class h{constructor(v){let E=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.url=v,this.isHttp=/^https?:/i.test(v),this.httpHeaders=this.isHttp&&E.httpHeaders||Object.create(null),this.withCredentials=E.withCredentials||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(v,E,x){const g={begin:v,end:E};for(const w in x)g[w]=x[w];return this.request(g)}requestFull(v){return this.request(v)}request(v){const E=new XMLHttpRequest,x=this.currXhrId++,g=this.pendingRequests[x]={xhr:E};E.open("GET",this.url),E.withCredentials=this.withCredentials;for(const w in this.httpHeaders){const R=this.httpHeaders[w];R!==void 0&&E.setRequestHeader(w,R)}return this.isHttp&&"begin"in v&&"end"in v?(E.setRequestHeader("Range",`bytes=${v.begin}-${v.end-1}`),g.expectedStatus=o):g.expectedStatus=i,E.responseType="arraybuffer",v.onError&&(E.onerror=function(w){v.onError(E.status)}),E.onreadystatechange=this.onStateChange.bind(this,x),E.onprogress=this.onProgress.bind(this,x),g.onHeadersReceived=v.onHeadersReceived,g.onDone=v.onDone,g.onError=v.onError,g.onProgress=v.onProgress,E.send(null),x}onProgress(v,E){var g;const x=this.pendingRequests[v];x&&((g=x.onProgress)==null||g.call(x,E))}onStateChange(v,E){var M,A,I;const x=this.pendingRequests[v];if(!x)return;const g=x.xhr;if(g.readyState>=2&&x.onHeadersReceived&&(x.onHeadersReceived(),delete x.onHeadersReceived),g.readyState!==4||!(v in this.pendingRequests))return;if(delete this.pendingRequests[v],g.status===0&&this.isHttp){(M=x.onError)==null||M.call(x,g.status);return}const w=g.status||i;if(!(w===i&&x.expectedStatus===o)&&w!==x.expectedStatus){(A=x.onError)==null||A.call(x,g.status);return}const N=c(g);if(w===o){const y=g.getResponseHeader("Content-Range"),j=/bytes (\d+)-(\d+)\/(\d+)/.exec(y);x.onDone({begin:parseInt(j[1],10),chunk:N})}else N?x.onDone({begin:0,chunk:N}):(I=x.onError)==null||I.call(x,g.status)}getRequestXhr(v){return this.pendingRequests[v].xhr}isPendingRequest(v){return v in this.pendingRequests}abortRequest(v){const E=this.pendingRequests[v].xhr;delete this.pendingRequests[v],E.abort()}}class u{constructor(v){this._source=v,this._manager=new h(v.url,{httpHeaders:v.httpHeaders,withCredentials:v.withCredentials}),this._rangeChunkSize=v.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(v){const E=this._rangeRequestReaders.indexOf(v);E>=0&&this._rangeRequestReaders.splice(E,1)}getFullReader(){return(0,s.assert)(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new d(this._manager,this._source),this._fullRequestReader}getRangeReader(v,E){const x=new _(this._manager,v,E);return x.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(x),x}cancelAllRequests(v){var E;(E=this._fullRequestReader)==null||E.cancel(v);for(const x of this._rangeRequestReaders.slice(0))x.cancel(v)}}r.PDFNetworkStream=u;class d{constructor(v,E){this._manager=v;const x={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=E.url,this._fullRequestId=v.requestFull(x),this._headersReceivedCapability=new s.PromiseCapability,this._disableRange=E.disableRange||!1,this._contentLength=E.length,this._rangeChunkSize=E.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const v=this._fullRequestId,E=this._manager.getRequestXhr(v),x=R=>E.getResponseHeader(R),{allowRangeRequests:g,suggestedLength:w}=(0,a.validateRangeRequestCapabilities)({getResponseHeader:x,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});g&&(this._isRangeSupported=!0),this._contentLength=w||this._contentLength,this._filename=(0,a.extractFilenameFromHeader)(x),this._isRangeSupported&&this._manager.abortRequest(v),this._headersReceivedCapability.resolve()}_onDone(v){if(v&&(this._requests.length>0?this._requests.shift().resolve({value:v.chunk,done:!1}):this._cachedChunks.push(v.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const E of this._requests)E.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(v){this._storedError=(0,a.createResponseStatusError)(v,this._url),this._headersReceivedCapability.reject(this._storedError);for(const E of this._requests)E.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(v){var E;(E=this.onProgress)==null||E.call(this,{loaded:v.loaded,total:v.lengthComputable?v.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const v=new s.PromiseCapability;return this._requests.push(v),v.promise}cancel(v){this._done=!0,this._headersReceivedCapability.reject(v);for(const E of this._requests)E.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class _{constructor(v,E,x){this._manager=v;const g={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=v.url,this._requestId=v.requestRange(E,x,g),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){var v;(v=this.onClosed)==null||v.call(this,this)}_onDone(v){const E=v.chunk;this._requests.length>0?this._requests.shift().resolve({value:E,done:!1}):this._queuedChunk=E,this._done=!0;for(const x of this._requests)x.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(v){this._storedError=(0,a.createResponseStatusError)(v,this._url);for(const E of this._requests)E.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(v){var E;this.isStreamingSupported||(E=this.onProgress)==null||E.call(this,{loaded:v.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const E=this._queuedChunk;return this._queuedChunk=null,{value:E,done:!1}}if(this._done)return{value:void 0,done:!0};const v=new s.PromiseCapability;return this._requests.push(v),v.promise}cancel(v){this._done=!0;for(const E of this._requests)E.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}},(t,r,e)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.PDFNodeStream=void 0,e(89),e(93),e(101),e(102),e(105),e(107),e(109),e(113),e(116),e(123);var s=e(1),a=e(182);const i=/^file:\/\/\/[a-zA-Z]:\//;function o(x){const g=require$$6,w=g.parse(x);return w.protocol==="file:"||w.host?w:/^[a-z]:[/\\]/i.test(x)?g.parse(`file:///${x}`):(w.host||(w.protocol="file:"),w)}class c{constructor(g){this.source=g,this.url=o(g.url),this.isHttp=this.url.protocol==="http:"||this.url.protocol==="https:",this.isFsUrl=this.url.protocol==="file:",this.httpHeaders=this.isHttp&&g.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var g;return((g=this._fullRequestReader)==null?void 0:g._loaded)??0}getFullReader(){return(0,s.assert)(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new v(this):new _(this),this._fullRequestReader}getRangeReader(g,w){if(w<=this._progressiveDataLength)return null;const R=this.isFsUrl?new E(this,g,w):new b(this,g,w);return this._rangeRequestReaders.push(R),R}cancelAllRequests(g){var w;(w=this._fullRequestReader)==null||w.cancel(g);for(const R of this._rangeRequestReaders.slice(0))R.cancel(g)}}r.PDFNodeStream=c;class h{constructor(g){this._url=g.url,this._done=!1,this._storedError=null,this.onProgress=null;const w=g.source;this._contentLength=w.length,this._loaded=0,this._filename=null,this._disableRange=w.disableRange||!1,this._rangeChunkSize=w.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!w.disableStream,this._isRangeSupported=!w.disableRange,this._readableStream=null,this._readCapability=new s.PromiseCapability,this._headersCapability=new s.PromiseCapability}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var R;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const g=this._readableStream.read();return g===null?(this._readCapability=new s.PromiseCapability,this.read()):(this._loaded+=g.length,(R=this.onProgress)==null||R.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(g).buffer,done:!1})}cancel(g){if(!this._readableStream){this._error(g);return}this._readableStream.destroy(g)}_error(g){this._storedError=g,this._readCapability.resolve()}_setReadableStream(g){this._readableStream=g,g.on("readable",()=>{this._readCapability.resolve()}),g.on("end",()=>{g.destroy(),this._done=!0,this._readCapability.resolve()}),g.on("error",w=>{this._error(w)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new s.AbortException("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class u{constructor(g){this._url=g.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=new s.PromiseCapability;const w=g.source;this._isStreamingSupported=!w.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){var R;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const g=this._readableStream.read();return g===null?(this._readCapability=new s.PromiseCapability,this.read()):(this._loaded+=g.length,(R=this.onProgress)==null||R.call(this,{loaded:this._loaded}),{value:new Uint8Array(g).buffer,done:!1})}cancel(g){if(!this._readableStream){this._error(g);return}this._readableStream.destroy(g)}_error(g){this._storedError=g,this._readCapability.resolve()}_setReadableStream(g){this._readableStream=g,g.on("readable",()=>{this._readCapability.resolve()}),g.on("end",()=>{g.destroy(),this._done=!0,this._readCapability.resolve()}),g.on("error",w=>{this._error(w)}),this._storedError&&this._readableStream.destroy(this._storedError)}}function d(x,g){return{protocol:x.protocol,auth:x.auth,host:x.hostname,port:x.port,path:x.path,method:"GET",headers:g}}class _ extends h{constructor(g){super(g);const w=R=>{if(R.statusCode===404){const I=new s.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=I,this._headersCapability.reject(I);return}this._headersCapability.resolve(),this._setReadableStream(R);const N=I=>this._readableStream.headers[I.toLowerCase()],{allowRangeRequests:M,suggestedLength:A}=(0,a.validateRangeRequestCapabilities)({getResponseHeader:N,isHttp:g.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=M,this._contentLength=A||this._contentLength,this._filename=(0,a.extractFilenameFromHeader)(N)};if(this._request=null,this._url.protocol==="http:"){const R=require$$6;this._request=R.request(d(this._url,g.httpHeaders),w)}else{const R=require$$6;this._request=R.request(d(this._url,g.httpHeaders),w)}this._request.on("error",R=>{this._storedError=R,this._headersCapability.reject(R)}),this._request.end()}}class b extends u{constructor(g,w,R){super(g),this._httpHeaders={};for(const M in g.httpHeaders){const A=g.httpHeaders[M];A!==void 0&&(this._httpHeaders[M]=A)}this._httpHeaders.Range=`bytes=${w}-${R-1}`;const N=M=>{if(M.statusCode===404){const A=new s.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=A;return}this._setReadableStream(M)};if(this._request=null,this._url.protocol==="http:"){const M=require$$6;this._request=M.request(d(this._url,this._httpHeaders),N)}else{const M=require$$6;this._request=M.request(d(this._url,this._httpHeaders),N)}this._request.on("error",M=>{this._storedError=M}),this._request.end()}}class v extends h{constructor(g){super(g);let w=decodeURIComponent(this._url.path);i.test(this._url.href)&&(w=w.replace(/^\//,""));const R=require$$6;R.lstat(w,(N,M)=>{if(N){N.code==="ENOENT"&&(N=new s.MissingPDFException(`Missing PDF "${w}".`)),this._storedError=N,this._headersCapability.reject(N);return}this._contentLength=M.size,this._setReadableStream(R.createReadStream(w)),this._headersCapability.resolve()})}}class E extends u{constructor(g,w,R){super(g);let N=decodeURIComponent(this._url.path);i.test(this._url.href)&&(N=N.replace(/^\//,""));const M=require$$6;this._setReadableStream(M.createReadStream(N,{start:w,end:R-1}))}}},(t,r,e)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.SVGGraphics=void 0,e(84),e(86),e(87),e(93),e(101),e(102),e(105),e(107),e(109),e(113),e(116),e(123),e(2),e(89),e(187);var s=e(168),a=e(1);const i={fontStyle:"normal",fontWeight:"normal",fillColor:"#000000"},o="http://www.w3.org/XML/1998/namespace",c="http://www.w3.org/1999/xlink",h=["butt","round","square"],u=["miter","round","bevel"],d=function(M){let A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",I=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(URL.createObjectURL&&typeof Blob<"u"&&!I)return URL.createObjectURL(new Blob([M],{type:A}));const y="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let j=`data:${A};base64,`;for(let T=0,U=M.length;T<U;T+=3){const F=M[T]&255,H=M[T+1]&255,z=M[T+2]&255,de=F>>2,se=(F&3)<<4|H>>4,ue=T+1<U?(H&15)<<2|z>>6:64,Z=T+2<U?z&63:64;j+=y[de]+y[se]+y[ue]+y[Z]}return j},_=function(){const M=new Uint8Array([137,80,78,71,13,10,26,10]),A=12,I=new Int32Array(256);for(let z=0;z<256;z++){let de=z;for(let se=0;se<8;se++)de=de&1?3988292384^de>>1&2147483647:de>>1&2147483647;I[z]=de}function y(z,de,se){let ue=-1;for(let Z=de;Z<se;Z++){const ge=(ue^z[Z])&255,re=I[ge];ue=ue>>>8^re}return ue^-1}function j(z,de,se,ue){let Z=ue;const ge=de.length;se[Z]=ge>>24&255,se[Z+1]=ge>>16&255,se[Z+2]=ge>>8&255,se[Z+3]=ge&255,Z+=4,se[Z]=z.charCodeAt(0)&255,se[Z+1]=z.charCodeAt(1)&255,se[Z+2]=z.charCodeAt(2)&255,se[Z+3]=z.charCodeAt(3)&255,Z+=4,se.set(de,Z),Z+=de.length;const re=y(se,ue+4,Z);se[Z]=re>>24&255,se[Z+1]=re>>16&255,se[Z+2]=re>>8&255,se[Z+3]=re&255}function T(z,de,se){let ue=1,Z=0;for(let ge=de;ge<se;++ge)ue=(ue+(z[ge]&255))%65521,Z=(Z+ue)%65521;return Z<<16|ue}function U(z){if(!a.isNodeJS)return F(z);try{const de=parseInt(process.versions.node)>=8?z:Buffer.from(z),se=require$$6.deflateSync(de,{level:9});return se instanceof Uint8Array?se:new Uint8Array(se)}catch(de){(0,a.warn)("Not compressing PNG because zlib.deflateSync is unavailable: "+de)}return F(z)}function F(z){let de=z.length;const se=65535,ue=Math.ceil(de/se),Z=new Uint8Array(2+de+ue*5+4);let ge=0;Z[ge++]=120,Z[ge++]=156;let re=0;for(;de>se;)Z[ge++]=0,Z[ge++]=255,Z[ge++]=255,Z[ge++]=0,Z[ge++]=0,Z.set(z.subarray(re,re+se),ge),ge+=se,re+=se,de-=se;Z[ge++]=1,Z[ge++]=de&255,Z[ge++]=de>>8&255,Z[ge++]=~de&65535&255,Z[ge++]=(~de&65535)>>8&255,Z.set(z.subarray(re),ge),ge+=z.length-re;const oe=T(z,0,z.length);return Z[ge++]=oe>>24&255,Z[ge++]=oe>>16&255,Z[ge++]=oe>>8&255,Z[ge++]=oe&255,Z}function H(z,de,se,ue){const Z=z.width,ge=z.height;let re,oe,be;const L=z.data;switch(de){case a.ImageKind.GRAYSCALE_1BPP:oe=0,re=1,be=Z+7>>3;break;case a.ImageKind.RGB_24BPP:oe=2,re=8,be=Z*3;break;case a.ImageKind.RGBA_32BPP:oe=6,re=8,be=Z*4;break;default:throw new Error("invalid format")}const S=new Uint8Array((1+be)*ge);let C=0,P=0;for(let me=0;me<ge;++me)S[C++]=0,S.set(L.subarray(P,P+be),C),P+=be,C+=be;if(de===a.ImageKind.GRAYSCALE_1BPP&&ue){C=0;for(let me=0;me<ge;me++){C++;for(let Ee=0;Ee<be;Ee++)S[C++]^=255}}const D=new Uint8Array([Z>>24&255,Z>>16&255,Z>>8&255,Z&255,ge>>24&255,ge>>16&255,ge>>8&255,ge&255,re,oe,0,0,0]),B=U(S),G=M.length+A*3+D.length+B.length,J=new Uint8Array(G);let Y=0;return J.set(M,Y),Y+=M.length,j("IHDR",D,J,Y),Y+=A+D.length,j("IDATA",B,J,Y),Y+=A+B.length,j("IEND",new Uint8Array(0),J,Y),d(J,"image/png",se)}return function(de,se,ue){const Z=de.kind===void 0?a.ImageKind.GRAYSCALE_1BPP:de.kind;return H(de,Z,se,ue)}}();class b{constructor(){this.fontSizeScale=1,this.fontWeight=i.fontWeight,this.fontSize=0,this.textMatrix=a.IDENTITY_MATRIX,this.fontMatrix=a.FONT_IDENTITY_MATRIX,this.leading=0,this.textRenderingMode=a.TextRenderingMode.FILL,this.textMatrixScale=1,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRise=0,this.fillColor=i.fillColor,this.strokeColor="#000000",this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.lineJoin="",this.lineCap="",this.miterLimit=0,this.dashArray=[],this.dashPhase=0,this.dependencies=[],this.activeClipUrl=null,this.clipGroup=null,this.maskId=""}clone(){return Object.create(this)}setCurrentPoint(A,I){this.x=A,this.y=I}}function v(M){let A=[];const I=[];for(const y of M){if(y.fn==="save"){A.push({fnId:92,fn:"group",items:[]}),I.push(A),A=A.at(-1).items;continue}y.fn==="restore"?A=I.pop():A.push(y)}return A}function E(M){if(Number.isInteger(M))return M.toString();const A=M.toFixed(10);let I=A.length-1;if(A[I]!=="0")return A;do I--;while(A[I]==="0");return A.substring(0,A[I]==="."?I:I+1)}function x(M){if(M[4]===0&&M[5]===0){if(M[1]===0&&M[2]===0)return M[0]===1&&M[3]===1?"":`scale(${E(M[0])} ${E(M[3])})`;if(M[0]===M[3]&&M[1]===-M[2]){const A=Math.acos(M[0])*180/Math.PI;return`rotate(${E(A)})`}}else if(M[0]===1&&M[1]===0&&M[2]===0&&M[3]===1)return`translate(${E(M[4])} ${E(M[5])})`;return`matrix(${E(M[0])} ${E(M[1])} ${E(M[2])} ${E(M[3])} ${E(M[4])} ${E(M[5])})`}let g=0,w=0,R=0;class N{constructor(A,I){let y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;(0,s.deprecated)("The SVG back-end is no longer maintained and *may* be removed in the future."),this.svgFactory=new s.DOMSVGFactory,this.current=new b,this.transformMatrix=a.IDENTITY_MATRIX,this.transformStack=[],this.extraStack=[],this.commonObjs=A,this.objs=I,this.pendingClip=null,this.pendingEOFill=!1,this.embedFonts=!1,this.embeddedFonts=Object.create(null),this.cssStyle=null,this.forceDataSchema=!!y,this._operatorIdMapping=[];for(const j in a.OPS)this._operatorIdMapping[a.OPS[j]]=j}getObject(A){let I=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return typeof A=="string"?A.startsWith("g_")?this.commonObjs.get(A):this.objs.get(A):I}save(){this.transformStack.push(this.transformMatrix);const A=this.current;this.extraStack.push(A),this.current=A.clone()}restore(){this.transformMatrix=this.transformStack.pop(),this.current=this.extraStack.pop(),this.pendingClip=null,this.tgrp=null}group(A){this.save(),this.executeOpTree(A),this.restore()}loadDependencies(A){const I=A.fnArray,y=A.argsArray;for(let j=0,T=I.length;j<T;j++)if(I[j]===a.OPS.dependency)for(const U of y[j]){const F=U.startsWith("g_")?this.commonObjs:this.objs,H=new Promise(z=>{F.get(U,z)});this.current.dependencies.push(H)}return Promise.all(this.current.dependencies)}transform(A,I,y,j,T,U){const F=[A,I,y,j,T,U];this.transformMatrix=a.Util.transform(this.transformMatrix,F),this.tgrp=null}getSVG(A,I){this.viewport=I;const y=this._initialize(I);return this.loadDependencies(A).then(()=>(this.transformMatrix=a.IDENTITY_MATRIX,this.executeOpTree(this.convertOpList(A)),y))}convertOpList(A){const I=this._operatorIdMapping,y=A.argsArray,j=A.fnArray,T=[];for(let U=0,F=j.length;U<F;U++){const H=j[U];T.push({fnId:H,fn:I[H],args:y[U]})}return v(T)}executeOpTree(A){for(const I of A){const y=I.fn,j=I.fnId,T=I.args;switch(j|0){case a.OPS.beginText:this.beginText();break;case a.OPS.dependency:break;case a.OPS.setLeading:this.setLeading(T);break;case a.OPS.setLeadingMoveText:this.setLeadingMoveText(T[0],T[1]);break;case a.OPS.setFont:this.setFont(T);break;case a.OPS.showText:this.showText(T[0]);break;case a.OPS.showSpacedText:this.showText(T[0]);break;case a.OPS.endText:this.endText();break;case a.OPS.moveText:this.moveText(T[0],T[1]);break;case a.OPS.setCharSpacing:this.setCharSpacing(T[0]);break;case a.OPS.setWordSpacing:this.setWordSpacing(T[0]);break;case a.OPS.setHScale:this.setHScale(T[0]);break;case a.OPS.setTextMatrix:this.setTextMatrix(T[0],T[1],T[2],T[3],T[4],T[5]);break;case a.OPS.setTextRise:this.setTextRise(T[0]);break;case a.OPS.setTextRenderingMode:this.setTextRenderingMode(T[0]);break;case a.OPS.setLineWidth:this.setLineWidth(T[0]);break;case a.OPS.setLineJoin:this.setLineJoin(T[0]);break;case a.OPS.setLineCap:this.setLineCap(T[0]);break;case a.OPS.setMiterLimit:this.setMiterLimit(T[0]);break;case a.OPS.setFillRGBColor:this.setFillRGBColor(T[0],T[1],T[2]);break;case a.OPS.setStrokeRGBColor:this.setStrokeRGBColor(T[0],T[1],T[2]);break;case a.OPS.setStrokeColorN:this.setStrokeColorN(T);break;case a.OPS.setFillColorN:this.setFillColorN(T);break;case a.OPS.shadingFill:this.shadingFill(T[0]);break;case a.OPS.setDash:this.setDash(T[0],T[1]);break;case a.OPS.setRenderingIntent:this.setRenderingIntent(T[0]);break;case a.OPS.setFlatness:this.setFlatness(T[0]);break;case a.OPS.setGState:this.setGState(T[0]);break;case a.OPS.fill:this.fill();break;case a.OPS.eoFill:this.eoFill();break;case a.OPS.stroke:this.stroke();break;case a.OPS.fillStroke:this.fillStroke();break;case a.OPS.eoFillStroke:this.eoFillStroke();break;case a.OPS.clip:this.clip("nonzero");break;case a.OPS.eoClip:this.clip("evenodd");break;case a.OPS.paintSolidColorImageMask:this.paintSolidColorImageMask();break;case a.OPS.paintImageXObject:this.paintImageXObject(T[0]);break;case a.OPS.paintInlineImageXObject:this.paintInlineImageXObject(T[0]);break;case a.OPS.paintImageMaskXObject:this.paintImageMaskXObject(T[0]);break;case a.OPS.paintFormXObjectBegin:this.paintFormXObjectBegin(T[0],T[1]);break;case a.OPS.paintFormXObjectEnd:this.paintFormXObjectEnd();break;case a.OPS.closePath:this.closePath();break;case a.OPS.closeStroke:this.closeStroke();break;case a.OPS.closeFillStroke:this.closeFillStroke();break;case a.OPS.closeEOFillStroke:this.closeEOFillStroke();break;case a.OPS.nextLine:this.nextLine();break;case a.OPS.transform:this.transform(T[0],T[1],T[2],T[3],T[4],T[5]);break;case a.OPS.constructPath:this.constructPath(T[0],T[1]);break;case a.OPS.endPath:this.endPath();break;case 92:this.group(I.items);break;default:(0,a.warn)(`Unimplemented operator ${y}`);break}}}setWordSpacing(A){this.current.wordSpacing=A}setCharSpacing(A){this.current.charSpacing=A}nextLine(){this.moveText(0,this.current.leading)}setTextMatrix(A,I,y,j,T,U){const F=this.current;F.textMatrix=F.lineMatrix=[A,I,y,j,T,U],F.textMatrixScale=Math.hypot(A,I),F.x=F.lineX=0,F.y=F.lineY=0,F.xcoords=[],F.ycoords=[],F.tspan=this.svgFactory.createElement("svg:tspan"),F.tspan.setAttributeNS(null,"font-family",F.fontFamily),F.tspan.setAttributeNS(null,"font-size",`${E(F.fontSize)}px`),F.tspan.setAttributeNS(null,"y",E(-F.y)),F.txtElement=this.svgFactory.createElement("svg:text"),F.txtElement.append(F.tspan)}beginText(){const A=this.current;A.x=A.lineX=0,A.y=A.lineY=0,A.textMatrix=a.IDENTITY_MATRIX,A.lineMatrix=a.IDENTITY_MATRIX,A.textMatrixScale=1,A.tspan=this.svgFactory.createElement("svg:tspan"),A.txtElement=this.svgFactory.createElement("svg:text"),A.txtgrp=this.svgFactory.createElement("svg:g"),A.xcoords=[],A.ycoords=[]}moveText(A,I){const y=this.current;y.x=y.lineX+=A,y.y=y.lineY+=I,y.xcoords=[],y.ycoords=[],y.tspan=this.svgFactory.createElement("svg:tspan"),y.tspan.setAttributeNS(null,"font-family",y.fontFamily),y.tspan.setAttributeNS(null,"font-size",`${E(y.fontSize)}px`),y.tspan.setAttributeNS(null,"y",E(-y.y))}showText(A){const I=this.current,y=I.font,j=I.fontSize;if(j===0)return;const T=I.fontSizeScale,U=I.charSpacing,F=I.wordSpacing,H=I.fontDirection,z=I.textHScale*H,de=y.vertical,se=de?1:-1,ue=y.defaultVMetrics,Z=j*I.fontMatrix[0];let ge=0;for(const be of A){if(be===null){ge+=H*F;continue}else if(typeof be=="number"){ge+=se*be*j/1e3;continue}const L=(be.isSpace?F:0)+U,S=be.fontChar;let C,P,D=be.width;if(de){let G;const J=be.vmetric||ue;G=be.vmetric?J[1]:D*.5,G=-G*Z;const Y=J[2]*Z;D=J?-J[0]:D,C=G/T,P=(ge+Y)/T}else C=ge/T,P=0;(be.isInFont||y.missingFile)&&(I.xcoords.push(I.x+C),de&&I.ycoords.push(-I.y+P),I.tspan.textContent+=S);const B=de?D*Z-L*H:D*Z+L*H;ge+=B}I.tspan.setAttributeNS(null,"x",I.xcoords.map(E).join(" ")),de?I.tspan.setAttributeNS(null,"y",I.ycoords.map(E).join(" ")):I.tspan.setAttributeNS(null,"y",E(-I.y)),de?I.y-=ge:I.x+=ge*z,I.tspan.setAttributeNS(null,"font-family",I.fontFamily),I.tspan.setAttributeNS(null,"font-size",`${E(I.fontSize)}px`),I.fontStyle!==i.fontStyle&&I.tspan.setAttributeNS(null,"font-style",I.fontStyle),I.fontWeight!==i.fontWeight&&I.tspan.setAttributeNS(null,"font-weight",I.fontWeight);const re=I.textRenderingMode&a.TextRenderingMode.FILL_STROKE_MASK;if(re===a.TextRenderingMode.FILL||re===a.TextRenderingMode.FILL_STROKE?(I.fillColor!==i.fillColor&&I.tspan.setAttributeNS(null,"fill",I.fillColor),I.fillAlpha<1&&I.tspan.setAttributeNS(null,"fill-opacity",I.fillAlpha)):I.textRenderingMode===a.TextRenderingMode.ADD_TO_PATH?I.tspan.setAttributeNS(null,"fill","transparent"):I.tspan.setAttributeNS(null,"fill","none"),re===a.TextRenderingMode.STROKE||re===a.TextRenderingMode.FILL_STROKE){const be=1/(I.textMatrixScale||1);this._setStrokeAttributes(I.tspan,be)}let oe=I.textMatrix;I.textRise!==0&&(oe=oe.slice(),oe[5]+=I.textRise),I.txtElement.setAttributeNS(null,"transform",`${x(oe)} scale(${E(z)}, -1)`),I.txtElement.setAttributeNS(o,"xml:space","preserve"),I.txtElement.append(I.tspan),I.txtgrp.append(I.txtElement),this._ensureTransformGroup().append(I.txtElement)}setLeadingMoveText(A,I){this.setLeading(-I),this.moveText(A,I)}addFontStyle(A){if(!A.data)throw new Error('addFontStyle: No font data available, ensure that the "fontExtraProperties" API parameter is set.');this.cssStyle||(this.cssStyle=this.svgFactory.createElement("svg:style"),this.cssStyle.setAttributeNS(null,"type","text/css"),this.defs.append(this.cssStyle));const I=d(A.data,A.mimetype,this.forceDataSchema);this.cssStyle.textContent+=`@font-face { font-family: "${A.loadedName}"; src: url(${I}); }
`}setFont(A){const I=this.current,y=this.commonObjs.get(A[0]);let j=A[1];I.font=y,this.embedFonts&&!y.missingFile&&!this.embeddedFonts[y.loadedName]&&(this.addFontStyle(y),this.embeddedFonts[y.loadedName]=y),I.fontMatrix=y.fontMatrix||a.FONT_IDENTITY_MATRIX;let T="normal";y.black?T="900":y.bold&&(T="bold");const U=y.italic?"italic":"normal";j<0?(j=-j,I.fontDirection=-1):I.fontDirection=1,I.fontSize=j,I.fontFamily=y.loadedName,I.fontWeight=T,I.fontStyle=U,I.tspan=this.svgFactory.createElement("svg:tspan"),I.tspan.setAttributeNS(null,"y",E(-I.y)),I.xcoords=[],I.ycoords=[]}endText(){var I;const A=this.current;A.textRenderingMode&a.TextRenderingMode.ADD_TO_PATH_FLAG&&((I=A.txtElement)!=null&&I.hasChildNodes())&&(A.element=A.txtElement,this.clip("nonzero"),this.endPath())}setLineWidth(A){A>0&&(this.current.lineWidth=A)}setLineCap(A){this.current.lineCap=h[A]}setLineJoin(A){this.current.lineJoin=u[A]}setMiterLimit(A){this.current.miterLimit=A}setStrokeAlpha(A){this.current.strokeAlpha=A}setStrokeRGBColor(A,I,y){this.current.strokeColor=a.Util.makeHexColor(A,I,y)}setFillAlpha(A){this.current.fillAlpha=A}setFillRGBColor(A,I,y){this.current.fillColor=a.Util.makeHexColor(A,I,y),this.current.tspan=this.svgFactory.createElement("svg:tspan"),this.current.xcoords=[],this.current.ycoords=[]}setStrokeColorN(A){this.current.strokeColor=this._makeColorN_Pattern(A)}setFillColorN(A){this.current.fillColor=this._makeColorN_Pattern(A)}shadingFill(A){const{width:I,height:y}=this.viewport,j=a.Util.inverseTransform(this.transformMatrix),[T,U,F,H]=a.Util.getAxialAlignedBoundingBox([0,0,I,y],j),z=this.svgFactory.createElement("svg:rect");z.setAttributeNS(null,"x",T),z.setAttributeNS(null,"y",U),z.setAttributeNS(null,"width",F-T),z.setAttributeNS(null,"height",H-U),z.setAttributeNS(null,"fill",this._makeShadingPattern(A)),this.current.fillAlpha<1&&z.setAttributeNS(null,"fill-opacity",this.current.fillAlpha),this._ensureTransformGroup().append(z)}_makeColorN_Pattern(A){return A[0]==="TilingPattern"?this._makeTilingPattern(A):this._makeShadingPattern(A)}_makeTilingPattern(A){const I=A[1],y=A[2],j=A[3]||a.IDENTITY_MATRIX,[T,U,F,H]=A[4],z=A[5],de=A[6],se=A[7],ue=`shading${R++}`,[Z,ge,re,oe]=a.Util.normalizeRect([...a.Util.applyTransform([T,U],j),...a.Util.applyTransform([F,H],j)]),[be,L]=a.Util.singularValueDecompose2dScale(j),S=z*be,C=de*L,P=this.svgFactory.createElement("svg:pattern");P.setAttributeNS(null,"id",ue),P.setAttributeNS(null,"patternUnits","userSpaceOnUse"),P.setAttributeNS(null,"width",S),P.setAttributeNS(null,"height",C),P.setAttributeNS(null,"x",`${Z}`),P.setAttributeNS(null,"y",`${ge}`);const D=this.svg,B=this.transformMatrix,G=this.current.fillColor,J=this.current.strokeColor,Y=this.svgFactory.create(re-Z,oe-ge);if(this.svg=Y,this.transformMatrix=j,se===2){const me=a.Util.makeHexColor(...I);this.current.fillColor=me,this.current.strokeColor=me}return this.executeOpTree(this.convertOpList(y)),this.svg=D,this.transformMatrix=B,this.current.fillColor=G,this.current.strokeColor=J,P.append(Y.childNodes[0]),this.defs.append(P),`url(#${ue})`}_makeShadingPattern(A){switch(typeof A=="string"&&(A=this.objs.get(A)),A[0]){case"RadialAxial":const I=`shading${R++}`,y=A[3];let j;switch(A[1]){case"axial":const T=A[4],U=A[5];j=this.svgFactory.createElement("svg:linearGradient"),j.setAttributeNS(null,"id",I),j.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),j.setAttributeNS(null,"x1",T[0]),j.setAttributeNS(null,"y1",T[1]),j.setAttributeNS(null,"x2",U[0]),j.setAttributeNS(null,"y2",U[1]);break;case"radial":const F=A[4],H=A[5],z=A[6],de=A[7];j=this.svgFactory.createElement("svg:radialGradient"),j.setAttributeNS(null,"id",I),j.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),j.setAttributeNS(null,"cx",H[0]),j.setAttributeNS(null,"cy",H[1]),j.setAttributeNS(null,"r",de),j.setAttributeNS(null,"fx",F[0]),j.setAttributeNS(null,"fy",F[1]),j.setAttributeNS(null,"fr",z);break;default:throw new Error(`Unknown RadialAxial type: ${A[1]}`)}for(const T of y){const U=this.svgFactory.createElement("svg:stop");U.setAttributeNS(null,"offset",T[0]),U.setAttributeNS(null,"stop-color",T[1]),j.append(U)}return this.defs.append(j),`url(#${I})`;case"Mesh":return(0,a.warn)("Unimplemented pattern Mesh"),null;case"Dummy":return"hotpink";default:throw new Error(`Unknown IR type: ${A[0]}`)}}setDash(A,I){this.current.dashArray=A,this.current.dashPhase=I}constructPath(A,I){const y=this.current;let j=y.x,T=y.y,U=[],F=0;for(const H of A)switch(H|0){case a.OPS.rectangle:j=I[F++],T=I[F++];const z=I[F++],de=I[F++],se=j+z,ue=T+de;U.push("M",E(j),E(T),"L",E(se),E(T),"L",E(se),E(ue),"L",E(j),E(ue),"Z");break;case a.OPS.moveTo:j=I[F++],T=I[F++],U.push("M",E(j),E(T));break;case a.OPS.lineTo:j=I[F++],T=I[F++],U.push("L",E(j),E(T));break;case a.OPS.curveTo:j=I[F+4],T=I[F+5],U.push("C",E(I[F]),E(I[F+1]),E(I[F+2]),E(I[F+3]),E(j),E(T)),F+=6;break;case a.OPS.curveTo2:U.push("C",E(j),E(T),E(I[F]),E(I[F+1]),E(I[F+2]),E(I[F+3])),j=I[F+2],T=I[F+3],F+=4;break;case a.OPS.curveTo3:j=I[F+2],T=I[F+3],U.push("C",E(I[F]),E(I[F+1]),E(j),E(T),E(j),E(T)),F+=4;break;case a.OPS.closePath:U.push("Z");break}U=U.join(" "),y.path&&A.length>0&&A[0]!==a.OPS.rectangle&&A[0]!==a.OPS.moveTo?U=y.path.getAttributeNS(null,"d")+U:(y.path=this.svgFactory.createElement("svg:path"),this._ensureTransformGroup().append(y.path)),y.path.setAttributeNS(null,"d",U),y.path.setAttributeNS(null,"fill","none"),y.element=y.path,y.setCurrentPoint(j,T)}endPath(){const A=this.current;if(A.path=null,!this.pendingClip)return;if(!A.element){this.pendingClip=null;return}const I=`clippath${g++}`,y=this.svgFactory.createElement("svg:clipPath");y.setAttributeNS(null,"id",I),y.setAttributeNS(null,"transform",x(this.transformMatrix));const j=A.element.cloneNode(!0);if(this.pendingClip==="evenodd"?j.setAttributeNS(null,"clip-rule","evenodd"):j.setAttributeNS(null,"clip-rule","nonzero"),this.pendingClip=null,y.append(j),this.defs.append(y),A.activeClipUrl){A.clipGroup=null;for(const T of this.extraStack)T.clipGroup=null;y.setAttributeNS(null,"clip-path",A.activeClipUrl)}A.activeClipUrl=`url(#${I})`,this.tgrp=null}clip(A){this.pendingClip=A}closePath(){const A=this.current;if(A.path){const I=`${A.path.getAttributeNS(null,"d")}Z`;A.path.setAttributeNS(null,"d",I)}}setLeading(A){this.current.leading=-A}setTextRise(A){this.current.textRise=A}setTextRenderingMode(A){this.current.textRenderingMode=A}setHScale(A){this.current.textHScale=A/100}setRenderingIntent(A){}setFlatness(A){}setGState(A){for(const[I,y]of A)switch(I){case"LW":this.setLineWidth(y);break;case"LC":this.setLineCap(y);break;case"LJ":this.setLineJoin(y);break;case"ML":this.setMiterLimit(y);break;case"D":this.setDash(y[0],y[1]);break;case"RI":this.setRenderingIntent(y);break;case"FL":this.setFlatness(y);break;case"Font":this.setFont(y);break;case"CA":this.setStrokeAlpha(y);break;case"ca":this.setFillAlpha(y);break;default:(0,a.warn)(`Unimplemented graphic state operator ${I}`);break}}fill(){const A=this.current;A.element&&(A.element.setAttributeNS(null,"fill",A.fillColor),A.element.setAttributeNS(null,"fill-opacity",A.fillAlpha),this.endPath())}stroke(){const A=this.current;A.element&&(this._setStrokeAttributes(A.element),A.element.setAttributeNS(null,"fill","none"),this.endPath())}_setStrokeAttributes(A){let I=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const y=this.current;let j=y.dashArray;I!==1&&j.length>0&&(j=j.map(function(T){return I*T})),A.setAttributeNS(null,"stroke",y.strokeColor),A.setAttributeNS(null,"stroke-opacity",y.strokeAlpha),A.setAttributeNS(null,"stroke-miterlimit",E(y.miterLimit)),A.setAttributeNS(null,"stroke-linecap",y.lineCap),A.setAttributeNS(null,"stroke-linejoin",y.lineJoin),A.setAttributeNS(null,"stroke-width",E(I*y.lineWidth)+"px"),A.setAttributeNS(null,"stroke-dasharray",j.map(E).join(" ")),A.setAttributeNS(null,"stroke-dashoffset",E(I*y.dashPhase)+"px")}eoFill(){var A;(A=this.current.element)==null||A.setAttributeNS(null,"fill-rule","evenodd"),this.fill()}fillStroke(){this.stroke(),this.fill()}eoFillStroke(){var A;(A=this.current.element)==null||A.setAttributeNS(null,"fill-rule","evenodd"),this.fillStroke()}closeStroke(){this.closePath(),this.stroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.closePath(),this.eoFillStroke()}paintSolidColorImageMask(){const A=this.svgFactory.createElement("svg:rect");A.setAttributeNS(null,"x","0"),A.setAttributeNS(null,"y","0"),A.setAttributeNS(null,"width","1px"),A.setAttributeNS(null,"height","1px"),A.setAttributeNS(null,"fill",this.current.fillColor),this._ensureTransformGroup().append(A)}paintImageXObject(A){const I=this.getObject(A);if(!I){(0,a.warn)(`Dependent image with object ID ${A} is not ready yet`);return}this.paintInlineImageXObject(I)}paintInlineImageXObject(A,I){const y=A.width,j=A.height,T=_(A,this.forceDataSchema,!!I),U=this.svgFactory.createElement("svg:rect");U.setAttributeNS(null,"x","0"),U.setAttributeNS(null,"y","0"),U.setAttributeNS(null,"width",E(y)),U.setAttributeNS(null,"height",E(j)),this.current.element=U,this.clip("nonzero");const F=this.svgFactory.createElement("svg:image");F.setAttributeNS(c,"xlink:href",T),F.setAttributeNS(null,"x","0"),F.setAttributeNS(null,"y",E(-j)),F.setAttributeNS(null,"width",E(y)+"px"),F.setAttributeNS(null,"height",E(j)+"px"),F.setAttributeNS(null,"transform",`scale(${E(1/y)} ${E(-1/j)})`),I?I.append(F):this._ensureTransformGroup().append(F)}paintImageMaskXObject(A){const I=this.getObject(A.data,A);if(I.bitmap){(0,a.warn)("paintImageMaskXObject: ImageBitmap support is not implemented, ensure that the `isOffscreenCanvasSupported` API parameter is disabled.");return}const y=this.current,j=I.width,T=I.height,U=y.fillColor;y.maskId=`mask${w++}`;const F=this.svgFactory.createElement("svg:mask");F.setAttributeNS(null,"id",y.maskId);const H=this.svgFactory.createElement("svg:rect");H.setAttributeNS(null,"x","0"),H.setAttributeNS(null,"y","0"),H.setAttributeNS(null,"width",E(j)),H.setAttributeNS(null,"height",E(T)),H.setAttributeNS(null,"fill",U),H.setAttributeNS(null,"mask",`url(#${y.maskId})`),this.defs.append(F),this._ensureTransformGroup().append(H),this.paintInlineImageXObject(I,F)}paintFormXObjectBegin(A,I){if(Array.isArray(A)&&A.length===6&&this.transform(A[0],A[1],A[2],A[3],A[4],A[5]),I){const y=I[2]-I[0],j=I[3]-I[1],T=this.svgFactory.createElement("svg:rect");T.setAttributeNS(null,"x",I[0]),T.setAttributeNS(null,"y",I[1]),T.setAttributeNS(null,"width",E(y)),T.setAttributeNS(null,"height",E(j)),this.current.element=T,this.clip("nonzero"),this.endPath()}}paintFormXObjectEnd(){}_initialize(A){const I=this.svgFactory.create(A.width,A.height),y=this.svgFactory.createElement("svg:defs");I.append(y),this.defs=y;const j=this.svgFactory.createElement("svg:g");return j.setAttributeNS(null,"transform",x(A.transform)),I.append(j),this.svg=j,I}_ensureClipGroup(){if(!this.current.clipGroup){const A=this.svgFactory.createElement("svg:g");A.setAttributeNS(null,"clip-path",this.current.activeClipUrl),this.svg.append(A),this.current.clipGroup=A}return this.current.clipGroup}_ensureTransformGroup(){return this.tgrp||(this.tgrp=this.svgFactory.createElement("svg:g"),this.tgrp.setAttributeNS(null,"transform",x(this.transformMatrix)),this.current.activeClipUrl?this._ensureClipGroup().append(this.tgrp):this.svg.append(this.tgrp)),this.tgrp}}r.SVGGraphics=N},(t,r,e)=>{var s=e(3),a=e(188),i=e(193);s({target:"Array",proto:!0},{group:function(c){var h=arguments.length>1?arguments[1]:void 0;return a(this,c,h)}}),i("group")},(t,r,e)=>{var s=e(99),a=e(14),i=e(13),o=e(40),c=e(18),h=e(64),u=e(189),d=e(108),_=Array,b=a([].push);t.exports=function(v,E,x,g){for(var w=o(v),R=i(w),N=s(E,x),M=u(null),A=h(R),I=0,y,j,T;A>I;I++)T=R[I],j=c(N(T,I,w)),j in M?b(M[j],T):M[j]=[T];if(g&&(y=g(w),y!==_))for(j in M)M[j]=d(y,M[j]);return M}},(t,r,e)=>{var s=e(47),a=e(190),i=e(66),o=e(55),c=e(192),h=e(43),u=e(54),d=">",_="<",b="prototype",v="script",E=u("IE_PROTO"),x=function(){},g=function(A){return _+v+d+A+_+"/"+v+d},w=function(A){A.write(g("")),A.close();var I=A.parentWindow.Object;return A=null,I},R=function(){var A=h("iframe"),I="java"+v+":",y;return A.style.display="none",c.appendChild(A),A.src=String(I),y=A.contentWindow.document,y.open(),y.write(g("document.F=Object")),y.close(),y.F},N,M=function(){try{N=new ActiveXObject("htmlfile")}catch{}M=typeof document<"u"?document.domain&&N?w(N):R():w(N);for(var A=i.length;A--;)delete M[b][i[A]];return M()};o[E]=!0,t.exports=Object.create||function(I,y){var j;return I!==null?(x[b]=s(I),j=new x,x[b]=null,j[E]=I):j=M(),y===void 0?j:a.f(j,y)}},(t,r,e)=>{var s=e(6),a=e(46),i=e(45),o=e(47),c=e(12),h=e(191);r.f=s&&!a?Object.defineProperties:function(d,_){o(d);for(var b=c(_),v=h(_),E=v.length,x=0,g;E>x;)i.f(d,g=v[x++],b[g]);return d}},(t,r,e)=>{var s=e(59),a=e(66);t.exports=Object.keys||function(o){return s(o,a)}},(t,r,e)=>{var s=e(24);t.exports=s("document","documentElement")},(t,r,e)=>{var s=e(34),a=e(189),i=e(45).f,o=s("unscopables"),c=Array.prototype;c[o]===void 0&&i(c,o,{configurable:!0,value:a(null)}),t.exports=function(h){c[o][h]=!0}},(t,r,e)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.XfaText=void 0,e(89);class s{static textContent(i){const o=[],c={items:o,styles:Object.create(null)};function h(u){var b;if(!u)return;let d=null;const _=u.name;if(_==="#text")d=u.value;else if(s.shouldBuildText(_))(b=u==null?void 0:u.attributes)!=null&&b.textContent?d=u.attributes.textContent:u.value&&(d=u.value);else return;if(d!==null&&o.push({str:d}),!!u.children)for(const v of u.children)h(v)}return h(i),c}static shouldBuildText(i){return!(i==="textarea"||i==="input"||i==="option"||i==="select")}}r.XfaText=s},(t,r,e)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.TextLayerRenderTask=void 0,r.renderTextLayer=x,r.updateTextLayer=g,e(89),e(2);var s=e(1),a=e(168);const i=1e5,o=30,c=.8,h=new Map;function u(w,R){let N;if(R&&s.FeatureTest.isOffscreenCanvasSupported)N=new OffscreenCanvas(w,w).getContext("2d",{alpha:!1});else{const M=document.createElement("canvas");M.width=M.height=w,N=M.getContext("2d",{alpha:!1})}return N}function d(w,R){const N=h.get(w);if(N)return N;const M=u(o,R);M.font=`${o}px ${w}`;const A=M.measureText("");let I=A.fontBoundingBoxAscent,y=Math.abs(A.fontBoundingBoxDescent);if(I){const T=I/(I+y);return h.set(w,T),M.canvas.width=M.canvas.height=0,T}M.strokeStyle="red",M.clearRect(0,0,o,o),M.strokeText("g",0,0);let j=M.getImageData(0,0,o,o).data;y=0;for(let T=j.length-1-3;T>=0;T-=4)if(j[T]>0){y=Math.ceil(T/4/o);break}M.clearRect(0,0,o,o),M.strokeText("A",0,o),j=M.getImageData(0,0,o,o).data,I=0;for(let T=0,U=j.length;T<U;T+=4)if(j[T]>0){I=o-Math.floor(T/4/o);break}if(M.canvas.width=M.canvas.height=0,I){const T=I/(I+y);return h.set(w,T),T}return h.set(w,c),c}function _(w,R,N){const M=document.createElement("span"),A={angle:0,canvasWidth:0,hasText:R.str!=="",hasEOL:R.hasEOL,fontSize:0};w._textDivs.push(M);const I=s.Util.transform(w._transform,R.transform);let y=Math.atan2(I[1],I[0]);const j=N[R.fontName];j.vertical&&(y+=Math.PI/2);const T=Math.hypot(I[2],I[3]),U=T*d(j.fontFamily,w._isOffscreenCanvasSupported);let F,H;y===0?(F=I[4],H=I[5]-U):(F=I[4]+U*Math.sin(y),H=I[5]-U*Math.cos(y));const z="calc(var(--scale-factor)*",de=M.style;w._container===w._rootContainer?(de.left=`${(100*F/w._pageWidth).toFixed(2)}%`,de.top=`${(100*H/w._pageHeight).toFixed(2)}%`):(de.left=`${z}${F.toFixed(2)}px)`,de.top=`${z}${H.toFixed(2)}px)`),de.fontSize=`${z}${T.toFixed(2)}px)`,de.fontFamily=j.fontFamily,A.fontSize=T,M.setAttribute("role","presentation"),M.textContent=R.str,M.dir=R.dir,w._fontInspectorEnabled&&(M.dataset.fontName=R.fontName),y!==0&&(A.angle=y*(180/Math.PI));let se=!1;if(R.str.length>1)se=!0;else if(R.str!==" "&&R.transform[0]!==R.transform[3]){const ue=Math.abs(R.transform[0]),Z=Math.abs(R.transform[3]);ue!==Z&&Math.max(ue,Z)/Math.min(ue,Z)>1.5&&(se=!0)}se&&(A.canvasWidth=j.vertical?R.height:R.width),w._textDivProperties.set(M,A),w._isReadableStream&&w._layoutText(M)}function b(w){const{div:R,scale:N,properties:M,ctx:A,prevFontSize:I,prevFontFamily:y}=w,{style:j}=R;let T="";if(M.canvasWidth!==0&&M.hasText){const{fontFamily:U}=j,{canvasWidth:F,fontSize:H}=M;(I!==H||y!==U)&&(A.font=`${H*N}px ${U}`,w.prevFontSize=H,w.prevFontFamily=U);const{width:z}=A.measureText(R.textContent);z>0&&(T=`scaleX(${F*N/z})`)}M.angle!==0&&(T=`rotate(${M.angle}deg) ${T}`),T.length>0&&(j.transform=T)}function v(w){if(w._canceled)return;const R=w._textDivs,N=w._capability;if(R.length>i){N.resolve();return}if(!w._isReadableStream)for(const A of R)w._layoutText(A);N.resolve()}class E{constructor(R){var de;let{textContentSource:N,container:M,viewport:A,textDivs:I,textDivProperties:y,textContentItemsStr:j,isOffscreenCanvasSupported:T}=R;this._textContentSource=N,this._isReadableStream=N instanceof ReadableStream,this._container=this._rootContainer=M,this._textDivs=I||[],this._textContentItemsStr=j||[],this._isOffscreenCanvasSupported=T,this._fontInspectorEnabled=!!((de=globalThis.FontInspector)!=null&&de.enabled),this._reader=null,this._textDivProperties=y||new WeakMap,this._canceled=!1,this._capability=new s.PromiseCapability,this._layoutTextParams={prevFontSize:null,prevFontFamily:null,div:null,scale:A.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:u(0,T)};const{pageWidth:U,pageHeight:F,pageX:H,pageY:z}=A.rawDims;this._transform=[1,0,0,-1,-H,z+F],this._pageWidth=U,this._pageHeight=F,(0,a.setLayerDimensions)(M,A),this._capability.promise.finally(()=>{this._layoutTextParams=null}).catch(()=>{})}get promise(){return this._capability.promise}cancel(){this._canceled=!0,this._reader&&(this._reader.cancel(new s.AbortException("TextLayer task cancelled.")).catch(()=>{}),this._reader=null),this._capability.reject(new s.AbortException("TextLayer task cancelled."))}_processItems(R,N){for(const M of R){if(M.str===void 0){if(M.type==="beginMarkedContentProps"||M.type==="beginMarkedContent"){const A=this._container;this._container=document.createElement("span"),this._container.classList.add("markedContent"),M.id!==null&&this._container.setAttribute("id",`${M.id}`),A.append(this._container)}else M.type==="endMarkedContent"&&(this._container=this._container.parentNode);continue}this._textContentItemsStr.push(M.str),_(this,M,N)}}_layoutText(R){const N=this._layoutTextParams.properties=this._textDivProperties.get(R);if(this._layoutTextParams.div=R,b(this._layoutTextParams),N.hasText&&this._container.append(R),N.hasEOL){const M=document.createElement("br");M.setAttribute("role","presentation"),this._container.append(M)}}_render(){const R=new s.PromiseCapability;let N=Object.create(null);if(this._isReadableStream){const M=()=>{this._reader.read().then(A=>{let{value:I,done:y}=A;if(y){R.resolve();return}Object.assign(N,I.styles),this._processItems(I.items,N),M()},R.reject)};this._reader=this._textContentSource.getReader(),M()}else if(this._textContentSource){const{items:M,styles:A}=this._textContentSource;this._processItems(M,A),R.resolve()}else throw new Error('No "textContentSource" parameter specified.');R.promise.then(()=>{N=null,v(this)},this._capability.reject)}}r.TextLayerRenderTask=E;function x(w){!w.textContentSource&&(w.textContent||w.textContentStream)&&((0,a.deprecated)("The TextLayerRender `textContent`/`textContentStream` parameters will be removed in the future, please use `textContentSource` instead."),w.textContentSource=w.textContent||w.textContentStream);const{container:R,viewport:N}=w,M=getComputedStyle(R),A=M.getPropertyValue("visibility"),I=parseFloat(M.getPropertyValue("--scale-factor"));A==="visible"&&(!I||Math.abs(I-N.scale)>1e-5)&&console.error("The `--scale-factor` CSS-variable must be set, to the same value as `viewport.scale`, either on the `container`-element itself or higher up in the DOM.");const y=new E(w);return y._render(),y}function g(w){let{container:R,viewport:N,textDivs:M,textDivProperties:A,isOffscreenCanvasSupported:I,mustRotate:y=!0,mustRescale:j=!0}=w;if(y&&(0,a.setLayerDimensions)(R,{rotation:N.rotation}),j){const T=u(0,I),F={prevFontSize:null,prevFontFamily:null,div:null,scale:N.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:T};for(const H of M)F.properties=A.get(H),F.div=H,b(F)}}},(t,r,e)=>{var d,_,b,v,E,x,g,w,R,N,M,zr,vr,Gr,Xr;Object.defineProperty(r,"__esModule",{value:!0}),r.AnnotationEditorLayer=void 0,e(125),e(136),e(138),e(141),e(143),e(145),e(147);var s=e(1),a=e(164),i=e(197),o=e(202),c=e(168),h=e(203);const T=class T{constructor(F){ke(this,M);ke(this,d);ke(this,_,!1);ke(this,b,null);ke(this,v,this.pointerup.bind(this));ke(this,E,this.pointerdown.bind(this));ke(this,x,new Map);ke(this,g,!1);ke(this,w,!1);ke(this,R,!1);ke(this,N);let{uiManager:H,pageIndex:z,div:de,accessibilityManager:se,annotationLayer:ue,viewport:Z,l10n:ge}=F;const re=[i.FreeTextEditor,o.InkEditor,h.StampEditor];if(!T._initialized){T._initialized=!0;for(const oe of re)oe.initialize(ge)}H.registerEditorTypes(re),Ie(this,N,H),this.pageIndex=z,this.div=de,Ie(this,d,se),Ie(this,b,ue),this.viewport=Z,O(this,N).addLayer(this)}get isEmpty(){return O(this,x).size===0}updateToolbar(F){O(this,N).updateToolbar(F)}updateMode(){let F=arguments.length>0&&arguments[0]!==void 0?arguments[0]:O(this,N).getMode();Ae(this,M,Xr).call(this),F===s.AnnotationEditorType.INK?(this.addInkEditorIfNeeded(!1),this.disableClick()):this.enableClick(),F!==s.AnnotationEditorType.NONE&&(this.div.classList.toggle("freeTextEditing",F===s.AnnotationEditorType.FREETEXT),this.div.classList.toggle("inkEditing",F===s.AnnotationEditorType.INK),this.div.classList.toggle("stampEditing",F===s.AnnotationEditorType.STAMP),this.div.hidden=!1)}addInkEditorIfNeeded(F){if(!F&&O(this,N).getMode()!==s.AnnotationEditorType.INK)return;if(!F){for(const z of O(this,x).values())if(z.isEmpty()){z.setInBackground();return}}Ae(this,M,vr).call(this,{offsetX:0,offsetY:0},!1).setInBackground()}setEditingState(F){O(this,N).setEditingState(F)}addCommands(F){O(this,N).addCommands(F)}enable(){this.div.style.pointerEvents="auto";const F=new Set;for(const z of O(this,x).values())z.enableEditing(),z.annotationElementId&&F.add(z.annotationElementId);if(!O(this,b))return;const H=O(this,b).getEditableAnnotations();for(const z of H){if(z.hide(),O(this,N).isDeletedAnnotationElement(z.data.id)||F.has(z.data.id))continue;const de=this.deserialize(z);de&&(this.addOrRebuild(de),de.enableEditing())}}disable(){var H;Ie(this,R,!0),this.div.style.pointerEvents="none";const F=new Set;for(const z of O(this,x).values()){if(z.disableEditing(),!z.annotationElementId||z.serialize()!==null){F.add(z.annotationElementId);continue}(H=this.getEditableAnnotation(z.annotationElementId))==null||H.show(),z.remove()}if(O(this,b)){const z=O(this,b).getEditableAnnotations();for(const de of z){const{id:se}=de.data;F.has(se)||O(this,N).isDeletedAnnotationElement(se)||de.show()}}Ae(this,M,Xr).call(this),this.isEmpty&&(this.div.hidden=!0),Ie(this,R,!1)}getEditableAnnotation(F){var H;return((H=O(this,b))==null?void 0:H.getEditableAnnotation(F))||null}setActiveEditor(F){O(this,N).getActive()!==F&&O(this,N).setActiveEditor(F)}enableClick(){this.div.addEventListener("pointerdown",O(this,E)),this.div.addEventListener("pointerup",O(this,v))}disableClick(){this.div.removeEventListener("pointerdown",O(this,E)),this.div.removeEventListener("pointerup",O(this,v))}attach(F){O(this,x).set(F.id,F);const{annotationElementId:H}=F;H&&O(this,N).isDeletedAnnotationElement(H)&&O(this,N).removeDeletedAnnotationElement(F)}detach(F){var H;O(this,x).delete(F.id),(H=O(this,d))==null||H.removePointerInTextLayer(F.contentDiv),!O(this,R)&&F.annotationElementId&&O(this,N).addDeletedAnnotationElement(F)}remove(F){this.detach(F),O(this,N).removeEditor(F),F.div.contains(document.activeElement)&&setTimeout(()=>{O(this,N).focusMainContainer()},0),F.div.remove(),F.isAttachedToDOM=!1,O(this,w)||this.addInkEditorIfNeeded(!1)}changeParent(F){var H;F.parent!==this&&(F.annotationElementId&&(O(this,N).addDeletedAnnotationElement(F.annotationElementId),a.AnnotationEditor.deleteAnnotationElement(F),F.annotationElementId=null),this.attach(F),(H=F.parent)==null||H.detach(F),F.setParent(this),F.div&&F.isAttachedToDOM&&(F.div.remove(),this.div.append(F.div)))}add(F){if(this.changeParent(F),O(this,N).addEditor(F),this.attach(F),!F.isAttachedToDOM){const H=F.render();this.div.append(H),F.isAttachedToDOM=!0}F.fixAndSetPosition(),F.onceAdded(),O(this,N).addToAnnotationStorage(F)}moveEditorInDOM(F){var z;if(!F.isAttachedToDOM)return;const{activeElement:H}=document;F.div.contains(H)&&(F._focusEventsAllowed=!1,setTimeout(()=>{F.div.contains(document.activeElement)?F._focusEventsAllowed=!0:(F.div.addEventListener("focusin",()=>{F._focusEventsAllowed=!0},{once:!0}),H.focus())},0)),F._structTreeParentId=(z=O(this,d))==null?void 0:z.moveElementInDOM(this.div,F.div,F.contentDiv,!0)}addOrRebuild(F){F.needsToBeRebuilt()?F.rebuild():this.add(F)}addUndoableEditor(F){const H=()=>F._uiManager.rebuild(F),z=()=>{F.remove()};this.addCommands({cmd:H,undo:z,mustExec:!1})}getNextId(){return O(this,N).getId()}pasteEditor(F,H){O(this,N).updateToolbar(F),O(this,N).updateMode(F);const{offsetX:z,offsetY:de}=Ae(this,M,Gr).call(this),se=this.getNextId(),ue=Ae(this,M,zr).call(this,{parent:this,id:se,x:z,y:de,uiManager:O(this,N),isCentered:!0,...H});ue&&this.add(ue)}deserialize(F){switch(F.annotationType??F.annotationEditorType){case s.AnnotationEditorType.FREETEXT:return i.FreeTextEditor.deserialize(F,this,O(this,N));case s.AnnotationEditorType.INK:return o.InkEditor.deserialize(F,this,O(this,N));case s.AnnotationEditorType.STAMP:return h.StampEditor.deserialize(F,this,O(this,N))}return null}addNewEditor(){Ae(this,M,vr).call(this,Ae(this,M,Gr).call(this),!0)}setSelected(F){O(this,N).setSelected(F)}toggleSelected(F){O(this,N).toggleSelected(F)}isSelected(F){return O(this,N).isSelected(F)}unselect(F){O(this,N).unselect(F)}pointerup(F){const{isMac:H}=s.FeatureTest.platform;if(!(F.button!==0||F.ctrlKey&&H)&&F.target===this.div&&O(this,g)){if(Ie(this,g,!1),!O(this,_)){Ie(this,_,!0);return}if(O(this,N).getMode()===s.AnnotationEditorType.STAMP){O(this,N).unselectAll();return}Ae(this,M,vr).call(this,F,!1)}}pointerdown(F){if(O(this,g)){Ie(this,g,!1);return}const{isMac:H}=s.FeatureTest.platform;if(F.button!==0||F.ctrlKey&&H||F.target!==this.div)return;Ie(this,g,!0);const z=O(this,N).getActive();Ie(this,_,!z||z.isEmpty())}findNewParent(F,H,z){const de=O(this,N).findParent(H,z);return de===null||de===this?!1:(de.changeParent(F),!0)}destroy(){var F,H;((F=O(this,N).getActive())==null?void 0:F.parent)===this&&(O(this,N).commitOrRemove(),O(this,N).setActiveEditor(null));for(const z of O(this,x).values())(H=O(this,d))==null||H.removePointerInTextLayer(z.contentDiv),z.setParent(null),z.isAttachedToDOM=!1,z.div.remove();this.div=null,O(this,x).clear(),O(this,N).removeLayer(this)}render(F){let{viewport:H}=F;this.viewport=H,(0,c.setLayerDimensions)(this.div,H);for(const z of O(this,N).getEditors(this.pageIndex))this.add(z);this.updateMode()}update(F){let{viewport:H}=F;O(this,N).commitOrRemove(),this.viewport=H,(0,c.setLayerDimensions)(this.div,{rotation:H.rotation}),this.updateMode()}get pageDimensions(){const{pageWidth:F,pageHeight:H}=this.viewport.rawDims;return[F,H]}};d=new WeakMap,_=new WeakMap,b=new WeakMap,v=new WeakMap,E=new WeakMap,x=new WeakMap,g=new WeakMap,w=new WeakMap,R=new WeakMap,N=new WeakMap,M=new WeakSet,zr=function(F){switch(O(this,N).getMode()){case s.AnnotationEditorType.FREETEXT:return new i.FreeTextEditor(F);case s.AnnotationEditorType.INK:return new o.InkEditor(F);case s.AnnotationEditorType.STAMP:return new h.StampEditor(F)}return null},vr=function(F,H){const z=this.getNextId(),de=Ae(this,M,zr).call(this,{parent:this,id:z,x:F.offsetX,y:F.offsetY,uiManager:O(this,N),isCentered:H});return de&&this.add(de),de},Gr=function(){const{x:F,y:H,width:z,height:de}=this.div.getBoundingClientRect(),se=Math.max(0,F),ue=Math.max(0,H),Z=Math.min(window.innerWidth,F+z),ge=Math.min(window.innerHeight,H+de),re=(se+Z)/2-F,oe=(ue+ge)/2-H,[be,L]=this.viewport.rotation%180===0?[re,oe]:[oe,re];return{offsetX:be,offsetY:L}},Xr=function(){Ie(this,w,!0);for(const F of O(this,x).values())F.isEmpty()&&F.remove();Ie(this,w,!1)},bt(T,"_initialized",!1);let u=T;r.AnnotationEditorLayer=u},(t,r,e)=>{var h,u,d,_,b,v,E,x,g,w,ws,Ss,Rs,nr,Yr,As,Kr;Object.defineProperty(r,"__esModule",{value:!0}),r.FreeTextEditor=void 0,e(89);var s=e(1),a=e(165),i=e(164),o=e(198);const T=class T extends i.AnnotationEditor{constructor(H){super({...H,name:"freeTextEditor"});ke(this,w);ke(this,h,this.editorDivBlur.bind(this));ke(this,u,this.editorDivFocus.bind(this));ke(this,d,this.editorDivInput.bind(this));ke(this,_,this.editorDivKeydown.bind(this));ke(this,b);ke(this,v,"");ke(this,E,`${this.id}-editor`);ke(this,x);ke(this,g,null);Ie(this,b,H.color||T._defaultColor||i.AnnotationEditor._defaultLineColor),Ie(this,x,H.fontSize||T._defaultFontSize)}static get _keyboardManager(){const H=T.prototype,z=ue=>ue.isEmpty(),de=a.AnnotationEditorUIManager.TRANSLATE_SMALL,se=a.AnnotationEditorUIManager.TRANSLATE_BIG;return(0,s.shadow)(this,"_keyboardManager",new a.KeyboardManager([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],H.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],H.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],H._translateEmpty,{args:[-de,0],checker:z}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],H._translateEmpty,{args:[-se,0],checker:z}],[["ArrowRight","mac+ArrowRight"],H._translateEmpty,{args:[de,0],checker:z}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],H._translateEmpty,{args:[se,0],checker:z}],[["ArrowUp","mac+ArrowUp"],H._translateEmpty,{args:[0,-de],checker:z}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],H._translateEmpty,{args:[0,-se],checker:z}],[["ArrowDown","mac+ArrowDown"],H._translateEmpty,{args:[0,de],checker:z}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],H._translateEmpty,{args:[0,se],checker:z}]]))}static initialize(H){i.AnnotationEditor.initialize(H,{strings:["free_text2_default_content","editor_free_text2_aria_label"]});const z=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(z.getPropertyValue("--freetext-padding"))}static updateDefaultParams(H,z){switch(H){case s.AnnotationEditorParamsType.FREETEXT_SIZE:T._defaultFontSize=z;break;case s.AnnotationEditorParamsType.FREETEXT_COLOR:T._defaultColor=z;break}}updateParams(H,z){switch(H){case s.AnnotationEditorParamsType.FREETEXT_SIZE:Ae(this,w,ws).call(this,z);break;case s.AnnotationEditorParamsType.FREETEXT_COLOR:Ae(this,w,Ss).call(this,z);break}}static get defaultPropertiesToUpdate(){return[[s.AnnotationEditorParamsType.FREETEXT_SIZE,T._defaultFontSize],[s.AnnotationEditorParamsType.FREETEXT_COLOR,T._defaultColor||i.AnnotationEditor._defaultLineColor]]}get propertiesToUpdate(){return[[s.AnnotationEditorParamsType.FREETEXT_SIZE,O(this,x)],[s.AnnotationEditorParamsType.FREETEXT_COLOR,O(this,b)]]}_translateEmpty(H,z){this._uiManager.translateSelectedEditors(H,z,!0)}getInitialTranslation(){const H=this.parentScale;return[-T._internalPadding*H,-(T._internalPadding+O(this,x))*H]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){this.isInEditMode()||(this.parent.setEditingState(!1),this.parent.updateToolbar(s.AnnotationEditorType.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.editorDiv.addEventListener("keydown",O(this,_)),this.editorDiv.addEventListener("focus",O(this,u)),this.editorDiv.addEventListener("blur",O(this,h)),this.editorDiv.addEventListener("input",O(this,d)))}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",O(this,E)),this._isDraggable=!0,this.editorDiv.removeEventListener("keydown",O(this,_)),this.editorDiv.removeEventListener("focus",O(this,u)),this.editorDiv.removeEventListener("blur",O(this,h)),this.editorDiv.removeEventListener("input",O(this,d)),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freeTextEditing"))}focusin(H){this._focusEventsAllowed&&(super.focusin(H),H.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(){var H;if(this.width){Ae(this,w,Kr).call(this);return}this.enableEditMode(),this.editorDiv.focus(),(H=this._initialOptions)!=null&&H.isCentered&&this.center(),this._initialOptions=null}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freeTextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const H=O(this,v),z=Ie(this,v,Ae(this,w,Rs).call(this).trimEnd());if(H===z)return;const de=se=>{if(Ie(this,v,se),!se){this.remove();return}Ae(this,w,Yr).call(this),this._uiManager.rebuild(this),Ae(this,w,nr).call(this)};this.addCommands({cmd:()=>{de(z)},undo:()=>{de(H)},mustExec:!1}),Ae(this,w,nr).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(H){this.enterInEditMode()}keydown(H){H.target===this.div&&H.key==="Enter"&&(this.enterInEditMode(),H.preventDefault())}editorDivKeydown(H){T._keyboardManager.exec(this,H)}editorDivFocus(H){this.isEditing=!0}editorDivBlur(H){this.isEditing=!1}editorDivInput(H){this.parent.div.classList.toggle("freeTextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let H,z;this.width&&(H=this.x,z=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",O(this,E)),this.enableEditing(),i.AnnotationEditor._l10nPromise.get("editor_free_text2_aria_label").then(se=>{var ue;return(ue=this.editorDiv)==null?void 0:ue.setAttribute("aria-label",se)}),i.AnnotationEditor._l10nPromise.get("free_text2_default_content").then(se=>{var ue;return(ue=this.editorDiv)==null?void 0:ue.setAttribute("default-content",se)}),this.editorDiv.contentEditable=!0;const{style:de}=this.editorDiv;if(de.fontSize=`calc(${O(this,x)}px * var(--scale-factor))`,de.color=O(this,b),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),(0,a.bindEvents)(this,this.div,["dblclick","keydown"]),this.width){const[se,ue]=this.parentDimensions;if(this.annotationElementId){const{position:Z}=O(this,g);let[ge,re]=this.getInitialTranslation();[ge,re]=this.pageTranslationToScreen(ge,re);const[oe,be]=this.pageDimensions,[L,S]=this.pageTranslation;let C,P;switch(this.rotation){case 0:C=H+(Z[0]-L)/oe,P=z+this.height-(Z[1]-S)/be;break;case 90:C=H+(Z[0]-L)/oe,P=z-(Z[1]-S)/be,[ge,re]=[re,-ge];break;case 180:C=H-this.width+(Z[0]-L)/oe,P=z-(Z[1]-S)/be,[ge,re]=[-ge,-re];break;case 270:C=H+(Z[0]-L-this.height*be)/oe,P=z+(Z[1]-S-this.width*oe)/be,[ge,re]=[-re,ge];break}this.setAt(C*se,P*ue,ge,re)}else this.setAt(H*se,z*ue,this.width*se,this.height*ue);Ae(this,w,Yr).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}get contentDiv(){return this.editorDiv}static deserialize(H,z,de){let se=null;if(H instanceof o.FreeTextAnnotationElement){const{data:{defaultAppearanceData:{fontSize:Z,fontColor:ge},rect:re,rotation:oe,id:be},textContent:L,textPosition:S,parent:{page:{pageNumber:C}}}=H;if(!L||L.length===0)return null;se=H={annotationType:s.AnnotationEditorType.FREETEXT,color:Array.from(ge),fontSize:Z,value:L.join(`
`),position:S,pageIndex:C-1,rect:re,rotation:oe,id:be,deleted:!1}}const ue=super.deserialize(H,z,de);return Ie(ue,x,H.fontSize),Ie(ue,b,s.Util.makeHexColor(...H.color)),Ie(ue,v,H.value),ue.annotationElementId=H.id||null,Ie(ue,g,se),ue}serialize(){let H=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(this.isEmpty())return null;if(this.deleted)return{pageIndex:this.pageIndex,id:this.annotationElementId,deleted:!0};const z=T._internalPadding*this.parentScale,de=this.getRect(z,z),se=i.AnnotationEditor._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:O(this,b)),ue={annotationType:s.AnnotationEditorType.FREETEXT,color:se,fontSize:O(this,x),value:O(this,v),pageIndex:this.pageIndex,rect:de,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return H?ue:this.annotationElementId&&!Ae(this,w,As).call(this,ue)?null:(ue.id=this.annotationElementId,ue)}};h=new WeakMap,u=new WeakMap,d=new WeakMap,_=new WeakMap,b=new WeakMap,v=new WeakMap,E=new WeakMap,x=new WeakMap,g=new WeakMap,w=new WeakSet,ws=function(H){const z=se=>{this.editorDiv.style.fontSize=`calc(${se}px * var(--scale-factor))`,this.translate(0,-(se-O(this,x))*this.parentScale),Ie(this,x,se),Ae(this,w,nr).call(this)},de=O(this,x);this.addCommands({cmd:()=>{z(H)},undo:()=>{z(de)},mustExec:!0,type:s.AnnotationEditorParamsType.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},Ss=function(H){const z=O(this,b);this.addCommands({cmd:()=>{Ie(this,b,this.editorDiv.style.color=H)},undo:()=>{Ie(this,b,this.editorDiv.style.color=z)},mustExec:!0,type:s.AnnotationEditorParamsType.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},Rs=function(){const H=this.editorDiv.getElementsByTagName("div");if(H.length===0)return this.editorDiv.innerText;const z=[];for(const de of H)z.push(de.innerText.replace(/\r\n?|\n/,""));return z.join(`
`)},nr=function(){const[H,z]=this.parentDimensions;let de;if(this.isAttachedToDOM)de=this.div.getBoundingClientRect();else{const{currentLayer:se,div:ue}=this,Z=ue.style.display;ue.style.display="hidden",se.div.append(this.div),de=ue.getBoundingClientRect(),ue.remove(),ue.style.display=Z}this.rotation%180===this.parentRotation%180?(this.width=de.width/H,this.height=de.height/z):(this.width=de.height/H,this.height=de.width/z),this.fixAndSetPosition()},Yr=function(){if(this.editorDiv.replaceChildren(),!!O(this,v))for(const H of O(this,v).split(`
`)){const z=document.createElement("div");z.append(H?document.createTextNode(H):document.createElement("br")),this.editorDiv.append(z)}},As=function(H){const{value:z,fontSize:de,color:se,rect:ue,pageIndex:Z}=O(this,g);return H.value!==z||H.fontSize!==de||H.rect.some((ge,re)=>Math.abs(ge-ue[re])>=1)||H.color.some((ge,re)=>ge!==se[re])||H.pageIndex!==Z},Kr=function(){let H=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(!this.annotationElementId)return;if(Ae(this,w,nr).call(this),!H&&(this.width===0||this.height===0)){setTimeout(()=>Ae(this,w,Kr).call(this,!0),0);return}const z=T._internalPadding*this.parentScale;O(this,g).rect=this.getRect(z,z)},bt(T,"_freeTextDefaultContent",""),bt(T,"_internalPadding",0),bt(T,"_defaultColor",null),bt(T,"_defaultFontSize",10),bt(T,"_type","freetext");let c=T;r.FreeTextEditor=c},(t,r,e)=>{var P,B,Ht,Ts,Y,me,Ee,Re,Ne,he,pe,fe,W,Q,xe,Se,Ce,Le,De,_e,Ge,Ye,Cs,Er,Jr,Zr,nt,ct,ft,pt,Xe,Pe,je,Qr,ut,K,ye,Ue,Ns,qr;Object.defineProperty(r,"__esModule",{value:!0}),r.StampAnnotationElement=r.InkAnnotationElement=r.FreeTextAnnotationElement=r.AnnotationLayer=void 0,e(89),e(125),e(136),e(138),e(141),e(143),e(145),e(147);var s=e(1),a=e(168),i=e(163),o=e(199),c=e(200),h=e(201);const u=1e3,d=9,_=new WeakSet;function b(Ve){return{width:Ve[2]-Ve[0],height:Ve[3]-Ve[1]}}class v{static create(ee){switch(ee.data.annotationType){case s.AnnotationType.LINK:return new x(ee);case s.AnnotationType.TEXT:return new g(ee);case s.AnnotationType.WIDGET:switch(ee.data.fieldType){case"Tx":return new R(ee);case"Btn":return ee.data.radioButton?new A(ee):ee.data.checkBox?new M(ee):new I(ee);case"Ch":return new y(ee);case"Sig":return new N(ee)}return new w(ee);case s.AnnotationType.POPUP:return new j(ee);case s.AnnotationType.FREETEXT:return new U(ee);case s.AnnotationType.LINE:return new F(ee);case s.AnnotationType.SQUARE:return new H(ee);case s.AnnotationType.CIRCLE:return new z(ee);case s.AnnotationType.POLYLINE:return new de(ee);case s.AnnotationType.CARET:return new ue(ee);case s.AnnotationType.INK:return new Z(ee);case s.AnnotationType.POLYGON:return new se(ee);case s.AnnotationType.HIGHLIGHT:return new ge(ee);case s.AnnotationType.UNDERLINE:return new re(ee);case s.AnnotationType.SQUIGGLY:return new oe(ee);case s.AnnotationType.STRIKEOUT:return new be(ee);case s.AnnotationType.STAMP:return new L(ee);case s.AnnotationType.FILEATTACHMENT:return new S(ee);default:return new E(ee)}}}const D=class D{constructor(ee){ke(this,P,!1);let{isRenderable:ne=!1,ignoreBorder:ve=!1,createQuadrilaterals:we=!1}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.isRenderable=ne,this.data=ee.data,this.layer=ee.layer,this.linkService=ee.linkService,this.downloadManager=ee.downloadManager,this.imageResourcesPath=ee.imageResourcesPath,this.renderForms=ee.renderForms,this.svgFactory=ee.svgFactory,this.annotationStorage=ee.annotationStorage,this.enableScripting=ee.enableScripting,this.hasJSActions=ee.hasJSActions,this._fieldObjects=ee.fieldObjects,this.parent=ee.parent,ne&&(this.container=this._createContainer(ve)),we&&this._createQuadrilaterals()}static _hasPopupData(ee){let{titleObj:ne,contentsObj:ve,richText:we}=ee;return!!(ne!=null&&ne.str||ve!=null&&ve.str||we!=null&&we.str)}get hasPopupData(){return D._hasPopupData(this.data)}_createContainer(ee){const{data:ne,parent:{page:ve,viewport:we}}=this,Te=document.createElement("section");Te.setAttribute("data-annotation-id",ne.id),this instanceof w||(Te.tabIndex=u),Te.style.zIndex=this.parent.zIndex++,this.data.popupRef&&Te.setAttribute("aria-haspopup","dialog"),ne.noRotate&&Te.classList.add("norotate");const{pageWidth:We,pageHeight:$e,pageX:tt,pageY:at}=we.rawDims;if(!ne.rect||this instanceof j){const{rotation:le}=ne;return!ne.hasOwnCanvas&&le!==0&&this.setRotation(le,Te),Te}const{width:V,height:ie}=b(ne.rect),te=s.Util.normalizeRect([ne.rect[0],ve.view[3]-ne.rect[1]+ve.view[1],ne.rect[2],ve.view[3]-ne.rect[3]+ve.view[1]]);if(!ee&&ne.borderStyle.width>0){Te.style.borderWidth=`${ne.borderStyle.width}px`;const le=ne.borderStyle.horizontalCornerRadius,ce=ne.borderStyle.verticalCornerRadius;if(le>0||ce>0){const He=`calc(${le}px * var(--scale-factor)) / calc(${ce}px * var(--scale-factor))`;Te.style.borderRadius=He}else if(this instanceof A){const He=`calc(${V}px * var(--scale-factor)) / calc(${ie}px * var(--scale-factor))`;Te.style.borderRadius=He}switch(ne.borderStyle.style){case s.AnnotationBorderStyleType.SOLID:Te.style.borderStyle="solid";break;case s.AnnotationBorderStyleType.DASHED:Te.style.borderStyle="dashed";break;case s.AnnotationBorderStyleType.BEVELED:(0,s.warn)("Unimplemented border style: beveled");break;case s.AnnotationBorderStyleType.INSET:(0,s.warn)("Unimplemented border style: inset");break;case s.AnnotationBorderStyleType.UNDERLINE:Te.style.borderBottomStyle="solid";break}const Fe=ne.borderColor||null;Fe?(Ie(this,P,!0),Te.style.borderColor=s.Util.makeHexColor(Fe[0]|0,Fe[1]|0,Fe[2]|0)):Te.style.borderWidth=0}Te.style.left=`${100*(te[0]-tt)/We}%`,Te.style.top=`${100*(te[1]-at)/$e}%`;const{rotation:ae}=ne;return ne.hasOwnCanvas||ae===0?(Te.style.width=`${100*V/We}%`,Te.style.height=`${100*ie/$e}%`):this.setRotation(ae,Te),Te}setRotation(ee){let ne=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.container;if(!this.data.rect)return;const{pageWidth:ve,pageHeight:we}=this.parent.viewport.rawDims,{width:Te,height:We}=b(this.data.rect);let $e,tt;ee%180===0?($e=100*Te/ve,tt=100*We/we):($e=100*We/ve,tt=100*Te/we),ne.style.width=`${$e}%`,ne.style.height=`${tt}%`,ne.setAttribute("data-main-rotation",(360-ee)%360)}get _commonActions(){const ee=(ne,ve,we)=>{const Te=we.detail[ne],We=Te[0],$e=Te.slice(1);we.target.style[ve]=o.ColorConverters[`${We}_HTML`]($e),this.annotationStorage.setValue(this.data.id,{[ve]:o.ColorConverters[`${We}_rgb`]($e)})};return(0,s.shadow)(this,"_commonActions",{display:ne=>{const{display:ve}=ne.detail,we=ve%2===1;this.container.style.visibility=we?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:we,noPrint:ve===1||ve===2})},print:ne=>{this.annotationStorage.setValue(this.data.id,{noPrint:!ne.detail.print})},hidden:ne=>{const{hidden:ve}=ne.detail;this.container.style.visibility=ve?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:ve,noView:ve})},focus:ne=>{setTimeout(()=>ne.target.focus({preventScroll:!1}),0)},userName:ne=>{ne.target.title=ne.detail.userName},readonly:ne=>{ne.target.disabled=ne.detail.readonly},required:ne=>{this._setRequired(ne.target,ne.detail.required)},bgColor:ne=>{ee("bgColor","backgroundColor",ne)},fillColor:ne=>{ee("fillColor","backgroundColor",ne)},fgColor:ne=>{ee("fgColor","color",ne)},textColor:ne=>{ee("textColor","color",ne)},borderColor:ne=>{ee("borderColor","borderColor",ne)},strokeColor:ne=>{ee("strokeColor","borderColor",ne)},rotation:ne=>{const ve=ne.detail.rotation;this.setRotation(ve),this.annotationStorage.setValue(this.data.id,{rotation:ve})}})}_dispatchEventFromSandbox(ee,ne){const ve=this._commonActions;for(const we of Object.keys(ne.detail)){const Te=ee[we]||ve[we];Te==null||Te(ne)}}_setDefaultPropertiesFromJS(ee){if(!this.enableScripting)return;const ne=this.annotationStorage.getRawValue(this.data.id);if(!ne)return;const ve=this._commonActions;for(const[we,Te]of Object.entries(ne)){const We=ve[we];if(We){const $e={detail:{[we]:Te},target:ee};We($e),delete ne[we]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:ee}=this.data;if(!ee)return;const[ne,ve,we,Te]=this.data.rect;if(ee.length===1){const[,{x:ce,y:Fe},{x:He,y:Oe}]=ee[0];if(we===ce&&Te===Fe&&ne===He&&ve===Oe)return}const{style:We}=this.container;let $e;if(O(this,P)){const{borderColor:ce,borderWidth:Fe}=We;We.borderWidth=0,$e=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${ce}" stroke-width="${Fe}">`],this.container.classList.add("hasBorder")}const tt=we-ne,at=Te-ve,{svgFactory:V}=this,ie=V.createElement("svg");ie.classList.add("quadrilateralsContainer"),ie.setAttribute("width",0),ie.setAttribute("height",0);const te=V.createElement("defs");ie.append(te);const ae=V.createElement("clipPath"),le=`clippath_${this.data.id}`;ae.setAttribute("id",le),ae.setAttribute("clipPathUnits","objectBoundingBox"),te.append(ae);for(const[,{x:ce,y:Fe},{x:He,y:Oe}]of ee){const Me=V.createElement("rect"),Be=(He-ne)/tt,Ze=(Te-Fe)/at,rt=(ce-He)/tt,lt=(Fe-Oe)/at;Me.setAttribute("x",Be),Me.setAttribute("y",Ze),Me.setAttribute("width",rt),Me.setAttribute("height",lt),ae.append(Me),$e==null||$e.push(`<rect vector-effect="non-scaling-stroke" x="${Be}" y="${Ze}" width="${rt}" height="${lt}"/>`)}O(this,P)&&($e.push("</g></svg>')"),We.backgroundImage=$e.join("")),this.container.append(ie),this.container.style.clipPath=`url(#${le})`}_createPopup(){const{container:ee,data:ne}=this;ee.setAttribute("aria-haspopup","dialog");const ve=new j({data:{color:ne.color,titleObj:ne.titleObj,modificationDate:ne.modificationDate,contentsObj:ne.contentsObj,richText:ne.richText,parentRect:ne.rect,borderStyle:0,id:`popup_${ne.id}`,rotation:ne.rotation},parent:this.parent,elements:[this]});this.parent.div.append(ve.render())}render(){(0,s.unreachable)("Abstract method `AnnotationElement.render` called")}_getElementsByName(ee){let ne=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const ve=[];if(this._fieldObjects){const we=this._fieldObjects[ee];if(we)for(const{page:Te,id:We,exportValues:$e}of we){if(Te===-1||We===ne)continue;const tt=typeof $e=="string"?$e:null,at=document.querySelector(`[data-element-id="${We}"]`);if(at&&!_.has(at)){(0,s.warn)(`_getElementsByName - element not allowed: ${We}`);continue}ve.push({id:We,exportValue:tt,domElement:at})}return ve}for(const we of document.getElementsByName(ee)){const{exportValue:Te}=we,We=we.getAttribute("data-element-id");We!==ne&&_.has(we)&&ve.push({id:We,exportValue:Te,domElement:we})}return ve}show(){var ee;this.container&&(this.container.hidden=!1),(ee=this.popup)==null||ee.maybeShow()}hide(){var ee;this.container&&(this.container.hidden=!0),(ee=this.popup)==null||ee.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const ee=this.getElementsToTriggerPopup();if(Array.isArray(ee))for(const ne of ee)ne.classList.add("highlightArea");else ee.classList.add("highlightArea")}_editOnDoubleClick(){const{annotationEditorType:ee,data:{id:ne}}=this;this.container.addEventListener("dblclick",()=>{var ve;(ve=this.linkService.eventBus)==null||ve.dispatch("switchannotationeditormode",{source:this,mode:ee,editId:ne})})}};P=new WeakMap;let E=D;class x extends E{constructor(ne){let ve=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;super(ne,{isRenderable:!0,ignoreBorder:!!(ve!=null&&ve.ignoreBorder),createQuadrilaterals:!0});ke(this,B);this.isTooltipOnly=ne.data.isTooltipOnly}render(){const{data:ne,linkService:ve}=this,we=document.createElement("a");we.setAttribute("data-element-id",ne.id);let Te=!1;return ne.url?(ve.addLinkAttributes(we,ne.url,ne.newWindow),Te=!0):ne.action?(this._bindNamedAction(we,ne.action),Te=!0):ne.attachment?(this._bindAttachment(we,ne.attachment),Te=!0):ne.setOCGState?(Ae(this,B,Ts).call(this,we,ne.setOCGState),Te=!0):ne.dest?(this._bindLink(we,ne.dest),Te=!0):(ne.actions&&(ne.actions.Action||ne.actions["Mouse Up"]||ne.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(we,ne),Te=!0),ne.resetForm?(this._bindResetFormAction(we,ne.resetForm),Te=!0):this.isTooltipOnly&&!Te&&(this._bindLink(we,""),Te=!0)),this.container.classList.add("linkAnnotation"),Te&&this.container.append(we),this.container}_bindLink(ne,ve){ne.href=this.linkService.getDestinationHash(ve),ne.onclick=()=>(ve&&this.linkService.goToDestination(ve),!1),(ve||ve==="")&&Ae(this,B,Ht).call(this)}_bindNamedAction(ne,ve){ne.href=this.linkService.getAnchorUrl(""),ne.onclick=()=>(this.linkService.executeNamedAction(ve),!1),Ae(this,B,Ht).call(this)}_bindAttachment(ne,ve){ne.href=this.linkService.getAnchorUrl(""),ne.onclick=()=>{var we;return(we=this.downloadManager)==null||we.openOrDownloadData(this.container,ve.content,ve.filename),!1},Ae(this,B,Ht).call(this)}_bindJSAction(ne,ve){ne.href=this.linkService.getAnchorUrl("");const we=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const Te of Object.keys(ve.actions)){const We=we.get(Te);We&&(ne[We]=()=>{var $e;return($e=this.linkService.eventBus)==null||$e.dispatch("dispatcheventinsandbox",{source:this,detail:{id:ve.id,name:Te}}),!1})}ne.onclick||(ne.onclick=()=>!1),Ae(this,B,Ht).call(this)}_bindResetFormAction(ne,ve){const we=ne.onclick;if(we||(ne.href=this.linkService.getAnchorUrl("")),Ae(this,B,Ht).call(this),!this._fieldObjects){(0,s.warn)('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),we||(ne.onclick=()=>!1);return}ne.onclick=()=>{var ie;we==null||we();const{fields:Te,refs:We,include:$e}=ve,tt=[];if(Te.length!==0||We.length!==0){const te=new Set(We);for(const ae of Te){const le=this._fieldObjects[ae]||[];for(const{id:ce}of le)te.add(ce)}for(const ae of Object.values(this._fieldObjects))for(const le of ae)te.has(le.id)===$e&&tt.push(le)}else for(const te of Object.values(this._fieldObjects))tt.push(...te);const at=this.annotationStorage,V=[];for(const te of tt){const{id:ae}=te;switch(V.push(ae),te.type){case"text":{const ce=te.defaultValue||"";at.setValue(ae,{value:ce});break}case"checkbox":case"radiobutton":{const ce=te.defaultValue===te.exportValues;at.setValue(ae,{value:ce});break}case"combobox":case"listbox":{const ce=te.defaultValue||"";at.setValue(ae,{value:ce});break}default:continue}const le=document.querySelector(`[data-element-id="${ae}"]`);if(le){if(!_.has(le)){(0,s.warn)(`_bindResetFormAction - element not allowed: ${ae}`);continue}}else continue;le.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((ie=this.linkService.eventBus)==null||ie.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:V,name:"ResetForm"}})),!1}}}B=new WeakSet,Ht=function(){this.container.setAttribute("data-internal-link","")},Ts=function(ne,ve){ne.href=this.linkService.getAnchorUrl(""),ne.onclick=()=>(this.linkService.executeSetOCGState(ve),!1),Ae(this,B,Ht).call(this)};class g extends E{constructor(ee){super(ee,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const ee=document.createElement("img");return ee.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",ee.alt="[{{type}} Annotation]",ee.dataset.l10nId="text_annotation_type",ee.dataset.l10nArgs=JSON.stringify({type:this.data.name}),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(ee),this.container}}class w extends E{render(){return this.data.alternativeText&&(this.container.title=this.data.alternativeText),this.container}showElementAndHideCanvas(ee){var ne;this.data.hasOwnCanvas&&(((ne=ee.previousSibling)==null?void 0:ne.nodeName)==="CANVAS"&&(ee.previousSibling.hidden=!0),ee.hidden=!1)}_getKeyModifier(ee){const{isWin:ne,isMac:ve}=s.FeatureTest.platform;return ne&&ee.ctrlKey||ve&&ee.metaKey}_setEventListener(ee,ne,ve,we,Te){ve.includes("mouse")?ee.addEventListener(ve,We=>{var $e;($e=this.linkService.eventBus)==null||$e.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:we,value:Te(We),shift:We.shiftKey,modifier:this._getKeyModifier(We)}})}):ee.addEventListener(ve,We=>{var $e;if(ve==="blur"){if(!ne.focused||!We.relatedTarget)return;ne.focused=!1}else if(ve==="focus"){if(ne.focused)return;ne.focused=!0}Te&&(($e=this.linkService.eventBus)==null||$e.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:we,value:Te(We)}}))})}_setEventListeners(ee,ne,ve,we){var Te,We,$e;for(const[tt,at]of ve)(at==="Action"||(Te=this.data.actions)!=null&&Te[at])&&((at==="Focus"||at==="Blur")&&(ne||(ne={focused:!1})),this._setEventListener(ee,ne,tt,at,we),at==="Focus"&&!((We=this.data.actions)!=null&&We.Blur)?this._setEventListener(ee,ne,"blur","Blur",null):at==="Blur"&&!(($e=this.data.actions)!=null&&$e.Focus)&&this._setEventListener(ee,ne,"focus","Focus",null))}_setBackgroundColor(ee){const ne=this.data.backgroundColor||null;ee.style.backgroundColor=ne===null?"transparent":s.Util.makeHexColor(ne[0],ne[1],ne[2])}_setTextStyle(ee){const ne=["left","center","right"],{fontColor:ve}=this.data.defaultAppearanceData,we=this.data.defaultAppearanceData.fontSize||d,Te=ee.style;let We;const $e=2,tt=at=>Math.round(10*at)/10;if(this.data.multiLine){const at=Math.abs(this.data.rect[3]-this.data.rect[1]-$e),V=Math.round(at/(s.LINE_FACTOR*we))||1,ie=at/V;We=Math.min(we,tt(ie/s.LINE_FACTOR))}else{const at=Math.abs(this.data.rect[3]-this.data.rect[1]-$e);We=Math.min(we,tt(at/s.LINE_FACTOR))}Te.fontSize=`calc(${We}px * var(--scale-factor))`,Te.color=s.Util.makeHexColor(ve[0],ve[1],ve[2]),this.data.textAlignment!==null&&(Te.textAlign=ne[this.data.textAlignment])}_setRequired(ee,ne){ne?ee.setAttribute("required",!0):ee.removeAttribute("required"),ee.setAttribute("aria-required",ne)}}class R extends w{constructor(ee){const ne=ee.renderForms||!ee.data.hasAppearance&&!!ee.data.fieldValue;super(ee,{isRenderable:ne})}setPropertyOnSiblings(ee,ne,ve,we){const Te=this.annotationStorage;for(const We of this._getElementsByName(ee.name,ee.id))We.domElement&&(We.domElement[ne]=ve),Te.setValue(We.id,{[we]:ve})}render(){var we,Te;const ee=this.annotationStorage,ne=this.data.id;this.container.classList.add("textWidgetAnnotation");let ve=null;if(this.renderForms){const We=ee.getValue(ne,{value:this.data.fieldValue});let $e=We.value||"";const tt=ee.getValue(ne,{charLimit:this.data.maxLen}).charLimit;tt&&$e.length>tt&&($e=$e.slice(0,tt));let at=We.formattedValue||((we=this.data.textContent)==null?void 0:we.join(`
`))||null;at&&this.data.comb&&(at=at.replaceAll(/\s+/g,""));const V={userValue:$e,formattedValue:at,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(ve=document.createElement("textarea"),ve.textContent=at??$e,this.data.doNotScroll&&(ve.style.overflowY="hidden")):(ve=document.createElement("input"),ve.type="text",ve.setAttribute("value",at??$e),this.data.doNotScroll&&(ve.style.overflowX="hidden")),this.data.hasOwnCanvas&&(ve.hidden=!0),_.add(ve),ve.setAttribute("data-element-id",ne),ve.disabled=this.data.readOnly,ve.name=this.data.fieldName,ve.tabIndex=u,this._setRequired(ve,this.data.required),tt&&(ve.maxLength=tt),ve.addEventListener("input",te=>{ee.setValue(ne,{value:te.target.value}),this.setPropertyOnSiblings(ve,"value",te.target.value,"value"),V.formattedValue=null}),ve.addEventListener("resetform",te=>{const ae=this.data.defaultFieldValue??"";ve.value=V.userValue=ae,V.formattedValue=null});let ie=te=>{const{formattedValue:ae}=V;ae!=null&&(te.target.value=ae),te.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){ve.addEventListener("focus",ae=>{if(V.focused)return;const{target:le}=ae;V.userValue&&(le.value=V.userValue),V.lastCommittedValue=le.value,V.commitKey=1,V.focused=!0}),ve.addEventListener("updatefromsandbox",ae=>{this.showElementAndHideCanvas(ae.target);const le={value(ce){V.userValue=ce.detail.value??"",ee.setValue(ne,{value:V.userValue.toString()}),ce.target.value=V.userValue},formattedValue(ce){const{formattedValue:Fe}=ce.detail;V.formattedValue=Fe,Fe!=null&&ce.target!==document.activeElement&&(ce.target.value=Fe),ee.setValue(ne,{formattedValue:Fe})},selRange(ce){ce.target.setSelectionRange(...ce.detail.selRange)},charLimit:ce=>{var Me;const{charLimit:Fe}=ce.detail,{target:He}=ce;if(Fe===0){He.removeAttribute("maxLength");return}He.setAttribute("maxLength",Fe);let Oe=V.userValue;!Oe||Oe.length<=Fe||(Oe=Oe.slice(0,Fe),He.value=V.userValue=Oe,ee.setValue(ne,{value:Oe}),(Me=this.linkService.eventBus)==null||Me.dispatch("dispatcheventinsandbox",{source:this,detail:{id:ne,name:"Keystroke",value:Oe,willCommit:!0,commitKey:1,selStart:He.selectionStart,selEnd:He.selectionEnd}}))}};this._dispatchEventFromSandbox(le,ae)}),ve.addEventListener("keydown",ae=>{var Fe;V.commitKey=1;let le=-1;if(ae.key==="Escape"?le=0:ae.key==="Enter"&&!this.data.multiLine?le=2:ae.key==="Tab"&&(V.commitKey=3),le===-1)return;const{value:ce}=ae.target;V.lastCommittedValue!==ce&&(V.lastCommittedValue=ce,V.userValue=ce,(Fe=this.linkService.eventBus)==null||Fe.dispatch("dispatcheventinsandbox",{source:this,detail:{id:ne,name:"Keystroke",value:ce,willCommit:!0,commitKey:le,selStart:ae.target.selectionStart,selEnd:ae.target.selectionEnd}}))});const te=ie;ie=null,ve.addEventListener("blur",ae=>{var ce;if(!V.focused||!ae.relatedTarget)return;V.focused=!1;const{value:le}=ae.target;V.userValue=le,V.lastCommittedValue!==le&&((ce=this.linkService.eventBus)==null||ce.dispatch("dispatcheventinsandbox",{source:this,detail:{id:ne,name:"Keystroke",value:le,willCommit:!0,commitKey:V.commitKey,selStart:ae.target.selectionStart,selEnd:ae.target.selectionEnd}})),te(ae)}),(Te=this.data.actions)!=null&&Te.Keystroke&&ve.addEventListener("beforeinput",ae=>{var Ze;V.lastCommittedValue=null;const{data:le,target:ce}=ae,{value:Fe,selectionStart:He,selectionEnd:Oe}=ce;let Me=He,Be=Oe;switch(ae.inputType){case"deleteWordBackward":{const rt=Fe.substring(0,He).match(/\w*[^\w]*$/);rt&&(Me-=rt[0].length);break}case"deleteWordForward":{const rt=Fe.substring(He).match(/^[^\w]*\w*/);rt&&(Be+=rt[0].length);break}case"deleteContentBackward":He===Oe&&(Me-=1);break;case"deleteContentForward":He===Oe&&(Be+=1);break}ae.preventDefault(),(Ze=this.linkService.eventBus)==null||Ze.dispatch("dispatcheventinsandbox",{source:this,detail:{id:ne,name:"Keystroke",value:Fe,change:le||"",willCommit:!1,selStart:Me,selEnd:Be}})}),this._setEventListeners(ve,V,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],ae=>ae.target.value)}if(ie&&ve.addEventListener("blur",ie),this.data.comb){const ae=(this.data.rect[2]-this.data.rect[0])/tt;ve.classList.add("comb"),ve.style.letterSpacing=`calc(${ae}px * var(--scale-factor) - 1ch)`}}else ve=document.createElement("div"),ve.textContent=this.data.fieldValue,ve.style.verticalAlign="middle",ve.style.display="table-cell";return this._setTextStyle(ve),this._setBackgroundColor(ve),this._setDefaultPropertiesFromJS(ve),this.container.append(ve),this.container}}class N extends w{constructor(ee){super(ee,{isRenderable:!!ee.data.hasOwnCanvas})}}class M extends w{constructor(ee){super(ee,{isRenderable:ee.renderForms})}render(){const ee=this.annotationStorage,ne=this.data,ve=ne.id;let we=ee.getValue(ve,{value:ne.exportValue===ne.fieldValue}).value;typeof we=="string"&&(we=we!=="Off",ee.setValue(ve,{value:we})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const Te=document.createElement("input");return _.add(Te),Te.setAttribute("data-element-id",ve),Te.disabled=ne.readOnly,this._setRequired(Te,this.data.required),Te.type="checkbox",Te.name=ne.fieldName,we&&Te.setAttribute("checked",!0),Te.setAttribute("exportValue",ne.exportValue),Te.tabIndex=u,Te.addEventListener("change",We=>{const{name:$e,checked:tt}=We.target;for(const at of this._getElementsByName($e,ve)){const V=tt&&at.exportValue===ne.exportValue;at.domElement&&(at.domElement.checked=V),ee.setValue(at.id,{value:V})}ee.setValue(ve,{value:tt})}),Te.addEventListener("resetform",We=>{const $e=ne.defaultFieldValue||"Off";We.target.checked=$e===ne.exportValue}),this.enableScripting&&this.hasJSActions&&(Te.addEventListener("updatefromsandbox",We=>{const $e={value(tt){tt.target.checked=tt.detail.value!=="Off",ee.setValue(ve,{value:tt.target.checked})}};this._dispatchEventFromSandbox($e,We)}),this._setEventListeners(Te,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],We=>We.target.checked)),this._setBackgroundColor(Te),this._setDefaultPropertiesFromJS(Te),this.container.append(Te),this.container}}class A extends w{constructor(ee){super(ee,{isRenderable:ee.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const ee=this.annotationStorage,ne=this.data,ve=ne.id;let we=ee.getValue(ve,{value:ne.fieldValue===ne.buttonValue}).value;typeof we=="string"&&(we=we!==ne.buttonValue,ee.setValue(ve,{value:we}));const Te=document.createElement("input");if(_.add(Te),Te.setAttribute("data-element-id",ve),Te.disabled=ne.readOnly,this._setRequired(Te,this.data.required),Te.type="radio",Te.name=ne.fieldName,we&&Te.setAttribute("checked",!0),Te.tabIndex=u,Te.addEventListener("change",We=>{const{name:$e,checked:tt}=We.target;for(const at of this._getElementsByName($e,ve))ee.setValue(at.id,{value:!1});ee.setValue(ve,{value:tt})}),Te.addEventListener("resetform",We=>{const $e=ne.defaultFieldValue;We.target.checked=$e!=null&&$e===ne.buttonValue}),this.enableScripting&&this.hasJSActions){const We=ne.buttonValue;Te.addEventListener("updatefromsandbox",$e=>{const tt={value:at=>{const V=We===at.detail.value;for(const ie of this._getElementsByName(at.target.name)){const te=V&&ie.id===ve;ie.domElement&&(ie.domElement.checked=te),ee.setValue(ie.id,{value:te})}}};this._dispatchEventFromSandbox(tt,$e)}),this._setEventListeners(Te,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],$e=>$e.target.checked)}return this._setBackgroundColor(Te),this._setDefaultPropertiesFromJS(Te),this.container.append(Te),this.container}}class I extends x{constructor(ee){super(ee,{ignoreBorder:ee.data.hasAppearance})}render(){const ee=super.render();ee.classList.add("buttonWidgetAnnotation","pushButton"),this.data.alternativeText&&(ee.title=this.data.alternativeText);const ne=ee.lastChild;return this.enableScripting&&this.hasJSActions&&ne&&(this._setDefaultPropertiesFromJS(ne),ne.addEventListener("updatefromsandbox",ve=>{this._dispatchEventFromSandbox({},ve)})),ee}}class y extends w{constructor(ee){super(ee,{isRenderable:ee.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const ee=this.annotationStorage,ne=this.data.id,ve=ee.getValue(ne,{value:this.data.fieldValue}),we=document.createElement("select");_.add(we),we.setAttribute("data-element-id",ne),we.disabled=this.data.readOnly,this._setRequired(we,this.data.required),we.name=this.data.fieldName,we.tabIndex=u;let Te=this.data.combo&&this.data.options.length>0;this.data.combo||(we.size=this.data.options.length,this.data.multiSelect&&(we.multiple=!0)),we.addEventListener("resetform",V=>{const ie=this.data.defaultFieldValue;for(const te of we.options)te.selected=te.value===ie});for(const V of this.data.options){const ie=document.createElement("option");ie.textContent=V.displayValue,ie.value=V.exportValue,ve.value.includes(V.exportValue)&&(ie.setAttribute("selected",!0),Te=!1),we.append(ie)}let We=null;if(Te){const V=document.createElement("option");V.value=" ",V.setAttribute("hidden",!0),V.setAttribute("selected",!0),we.prepend(V),We=()=>{V.remove(),we.removeEventListener("input",We),We=null},we.addEventListener("input",We)}const $e=V=>{const ie=V?"value":"textContent",{options:te,multiple:ae}=we;return ae?Array.prototype.filter.call(te,le=>le.selected).map(le=>le[ie]):te.selectedIndex===-1?null:te[te.selectedIndex][ie]};let tt=$e(!1);const at=V=>{const ie=V.target.options;return Array.prototype.map.call(ie,te=>({displayValue:te.textContent,exportValue:te.value}))};return this.enableScripting&&this.hasJSActions?(we.addEventListener("updatefromsandbox",V=>{const ie={value(te){We==null||We();const ae=te.detail.value,le=new Set(Array.isArray(ae)?ae:[ae]);for(const ce of we.options)ce.selected=le.has(ce.value);ee.setValue(ne,{value:$e(!0)}),tt=$e(!1)},multipleSelection(te){we.multiple=!0},remove(te){const ae=we.options,le=te.detail.remove;ae[le].selected=!1,we.remove(le),ae.length>0&&Array.prototype.findIndex.call(ae,Fe=>Fe.selected)===-1&&(ae[0].selected=!0),ee.setValue(ne,{value:$e(!0),items:at(te)}),tt=$e(!1)},clear(te){for(;we.length!==0;)we.remove(0);ee.setValue(ne,{value:null,items:[]}),tt=$e(!1)},insert(te){const{index:ae,displayValue:le,exportValue:ce}=te.detail.insert,Fe=we.children[ae],He=document.createElement("option");He.textContent=le,He.value=ce,Fe?Fe.before(He):we.append(He),ee.setValue(ne,{value:$e(!0),items:at(te)}),tt=$e(!1)},items(te){const{items:ae}=te.detail;for(;we.length!==0;)we.remove(0);for(const le of ae){const{displayValue:ce,exportValue:Fe}=le,He=document.createElement("option");He.textContent=ce,He.value=Fe,we.append(He)}we.options.length>0&&(we.options[0].selected=!0),ee.setValue(ne,{value:$e(!0),items:at(te)}),tt=$e(!1)},indices(te){const ae=new Set(te.detail.indices);for(const le of te.target.options)le.selected=ae.has(le.index);ee.setValue(ne,{value:$e(!0)}),tt=$e(!1)},editable(te){te.target.disabled=!te.detail.editable}};this._dispatchEventFromSandbox(ie,V)}),we.addEventListener("input",V=>{var te;const ie=$e(!0);ee.setValue(ne,{value:ie}),V.preventDefault(),(te=this.linkService.eventBus)==null||te.dispatch("dispatcheventinsandbox",{source:this,detail:{id:ne,name:"Keystroke",value:tt,changeEx:ie,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(we,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],V=>V.target.value)):we.addEventListener("input",function(V){ee.setValue(ne,{value:$e(!0)})}),this.data.combo&&this._setTextStyle(we),this._setBackgroundColor(we),this._setDefaultPropertiesFromJS(we),this.container.append(we),this.container}}class j extends E{constructor(ee){const{data:ne,elements:ve}=ee;super(ee,{isRenderable:E._hasPopupData(ne)}),this.elements=ve}render(){this.container.classList.add("popupAnnotation");const ee=new T({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),ne=[];for(const ve of this.elements)ve.popup=ee,ne.push(ve.data.id),ve.addHighlightArea();return this.container.setAttribute("aria-controls",ne.map(ve=>`${s.AnnotationPrefix}${ve}`).join(",")),this.container}}class T{constructor(ee){ke(this,Ye);ke(this,Y,null);ke(this,me,Ae(this,Ye,Cs).bind(this));ke(this,Ee,Ae(this,Ye,Zr).bind(this));ke(this,Re,Ae(this,Ye,Jr).bind(this));ke(this,Ne,Ae(this,Ye,Er).bind(this));ke(this,he,null);ke(this,pe,null);ke(this,fe,null);ke(this,W,null);ke(this,Q,null);ke(this,xe,null);ke(this,Se,!1);ke(this,Ce,null);ke(this,Le,null);ke(this,De,null);ke(this,_e,null);ke(this,Ge,!1);var le;let{container:ne,color:ve,elements:we,titleObj:Te,modificationDate:We,contentsObj:$e,richText:tt,parent:at,rect:V,parentRect:ie,open:te}=ee;Ie(this,pe,ne),Ie(this,_e,Te),Ie(this,fe,$e),Ie(this,De,tt),Ie(this,Q,at),Ie(this,he,ve),Ie(this,Le,V),Ie(this,xe,ie),Ie(this,W,we);const ae=a.PDFDateString.toDateObject(We);ae&&Ie(this,Y,at.l10n.get("annotation_date_string",{date:ae.toLocaleDateString(),time:ae.toLocaleTimeString()})),this.trigger=we.flatMap(ce=>ce.getElementsToTriggerPopup());for(const ce of this.trigger)ce.addEventListener("click",O(this,Ne)),ce.addEventListener("mouseenter",O(this,Re)),ce.addEventListener("mouseleave",O(this,Ee)),ce.classList.add("popupTriggerArea");for(const ce of we)(le=ce.container)==null||le.addEventListener("keydown",O(this,me));O(this,pe).hidden=!0,te&&Ae(this,Ye,Er).call(this)}render(){if(O(this,Ce))return;const{page:{view:ee},viewport:{rawDims:{pageWidth:ne,pageHeight:ve,pageX:we,pageY:Te}}}=O(this,Q),We=Ie(this,Ce,document.createElement("div"));if(We.className="popup",O(this,he)){const Me=We.style.outlineColor=s.Util.makeHexColor(...O(this,he));CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?We.style.backgroundColor=`color-mix(in srgb, ${Me} 30%, white)`:We.style.backgroundColor=s.Util.makeHexColor(...O(this,he).map(Ze=>Math.floor(.7*(255-Ze)+Ze)))}const $e=document.createElement("span");$e.className="header";const tt=document.createElement("h1");if($e.append(tt),{dir:tt.dir,str:tt.textContent}=O(this,_e),We.append($e),O(this,Y)){const Me=document.createElement("span");Me.classList.add("popupDate"),O(this,Y).then(Be=>{Me.textContent=Be}),$e.append(Me)}const at=O(this,fe),V=O(this,De);if(V!=null&&V.str&&(!(at!=null&&at.str)||at.str===V.str))h.XfaLayer.render({xfaHtml:V.html,intent:"richText",div:We}),We.lastChild.classList.add("richText","popupContent");else{const Me=this._formatContents(at);We.append(Me)}let ie=!!O(this,xe),te=ie?O(this,xe):O(this,Le);for(const Me of O(this,W))if(!te||s.Util.intersect(Me.data.rect,te)!==null){te=Me.data.rect,ie=!0;break}const ae=s.Util.normalizeRect([te[0],ee[3]-te[1]+ee[1],te[2],ee[3]-te[3]+ee[1]]),ce=ie?te[2]-te[0]+5:0,Fe=ae[0]+ce,He=ae[1],{style:Oe}=O(this,pe);Oe.left=`${100*(Fe-we)/ne}%`,Oe.top=`${100*(He-Te)/ve}%`,O(this,pe).append(We)}_formatContents(ee){let{str:ne,dir:ve}=ee;const we=document.createElement("p");we.classList.add("popupContent"),we.dir=ve;const Te=ne.split(/(?:\r\n?|\n)/);for(let We=0,$e=Te.length;We<$e;++We){const tt=Te[We];we.append(document.createTextNode(tt)),We<$e-1&&we.append(document.createElement("br"))}return we}forceHide(){Ie(this,Ge,this.isVisible),O(this,Ge)&&(O(this,pe).hidden=!0)}maybeShow(){O(this,Ge)&&(Ie(this,Ge,!1),O(this,pe).hidden=!1)}get isVisible(){return O(this,pe).hidden===!1}}Y=new WeakMap,me=new WeakMap,Ee=new WeakMap,Re=new WeakMap,Ne=new WeakMap,he=new WeakMap,pe=new WeakMap,fe=new WeakMap,W=new WeakMap,Q=new WeakMap,xe=new WeakMap,Se=new WeakMap,Ce=new WeakMap,Le=new WeakMap,De=new WeakMap,_e=new WeakMap,Ge=new WeakMap,Ye=new WeakSet,Cs=function(ee){ee.altKey||ee.shiftKey||ee.ctrlKey||ee.metaKey||(ee.key==="Enter"||ee.key==="Escape"&&O(this,Se))&&Ae(this,Ye,Er).call(this)},Er=function(){Ie(this,Se,!O(this,Se)),O(this,Se)?(Ae(this,Ye,Jr).call(this),O(this,pe).addEventListener("click",O(this,Ne)),O(this,pe).addEventListener("keydown",O(this,me))):(Ae(this,Ye,Zr).call(this),O(this,pe).removeEventListener("click",O(this,Ne)),O(this,pe).removeEventListener("keydown",O(this,me)))},Jr=function(){O(this,Ce)||this.render(),this.isVisible?O(this,Se)&&O(this,pe).classList.add("focused"):(O(this,pe).hidden=!1,O(this,pe).style.zIndex=parseInt(O(this,pe).style.zIndex)+1e3)},Zr=function(){O(this,pe).classList.remove("focused"),!(O(this,Se)||!this.isVisible)&&(O(this,pe).hidden=!0,O(this,pe).style.zIndex=parseInt(O(this,pe).style.zIndex)-1e3)};class U extends E{constructor(ee){super(ee,{isRenderable:!0,ignoreBorder:!0}),this.textContent=ee.data.textContent,this.textPosition=ee.data.textPosition,this.annotationEditorType=s.AnnotationEditorType.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const ee=document.createElement("div");ee.classList.add("annotationTextContent"),ee.setAttribute("role","comment");for(const ne of this.textContent){const ve=document.createElement("span");ve.textContent=ne,ee.append(ve)}this.container.append(ee)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}r.FreeTextAnnotationElement=U;class F extends E{constructor(ne){super(ne,{isRenderable:!0,ignoreBorder:!0});ke(this,nt,null)}render(){this.container.classList.add("lineAnnotation");const ne=this.data,{width:ve,height:we}=b(ne.rect),Te=this.svgFactory.create(ve,we,!0),We=Ie(this,nt,this.svgFactory.createElement("svg:line"));return We.setAttribute("x1",ne.rect[2]-ne.lineCoordinates[0]),We.setAttribute("y1",ne.rect[3]-ne.lineCoordinates[1]),We.setAttribute("x2",ne.rect[2]-ne.lineCoordinates[2]),We.setAttribute("y2",ne.rect[3]-ne.lineCoordinates[3]),We.setAttribute("stroke-width",ne.borderStyle.width||1),We.setAttribute("stroke","transparent"),We.setAttribute("fill","transparent"),Te.append(We),this.container.append(Te),!ne.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return O(this,nt)}addHighlightArea(){this.container.classList.add("highlightArea")}}nt=new WeakMap;class H extends E{constructor(ne){super(ne,{isRenderable:!0,ignoreBorder:!0});ke(this,ct,null)}render(){this.container.classList.add("squareAnnotation");const ne=this.data,{width:ve,height:we}=b(ne.rect),Te=this.svgFactory.create(ve,we,!0),We=ne.borderStyle.width,$e=Ie(this,ct,this.svgFactory.createElement("svg:rect"));return $e.setAttribute("x",We/2),$e.setAttribute("y",We/2),$e.setAttribute("width",ve-We),$e.setAttribute("height",we-We),$e.setAttribute("stroke-width",We||1),$e.setAttribute("stroke","transparent"),$e.setAttribute("fill","transparent"),Te.append($e),this.container.append(Te),!ne.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return O(this,ct)}addHighlightArea(){this.container.classList.add("highlightArea")}}ct=new WeakMap;class z extends E{constructor(ne){super(ne,{isRenderable:!0,ignoreBorder:!0});ke(this,ft,null)}render(){this.container.classList.add("circleAnnotation");const ne=this.data,{width:ve,height:we}=b(ne.rect),Te=this.svgFactory.create(ve,we,!0),We=ne.borderStyle.width,$e=Ie(this,ft,this.svgFactory.createElement("svg:ellipse"));return $e.setAttribute("cx",ve/2),$e.setAttribute("cy",we/2),$e.setAttribute("rx",ve/2-We/2),$e.setAttribute("ry",we/2-We/2),$e.setAttribute("stroke-width",We||1),$e.setAttribute("stroke","transparent"),$e.setAttribute("fill","transparent"),Te.append($e),this.container.append(Te),!ne.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return O(this,ft)}addHighlightArea(){this.container.classList.add("highlightArea")}}ft=new WeakMap;class de extends E{constructor(ne){super(ne,{isRenderable:!0,ignoreBorder:!0});ke(this,pt,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const ne=this.data,{width:ve,height:we}=b(ne.rect),Te=this.svgFactory.create(ve,we,!0);let We=[];for(const tt of ne.vertices){const at=tt.x-ne.rect[0],V=ne.rect[3]-tt.y;We.push(at+","+V)}We=We.join(" ");const $e=Ie(this,pt,this.svgFactory.createElement(this.svgElementName));return $e.setAttribute("points",We),$e.setAttribute("stroke-width",ne.borderStyle.width||1),$e.setAttribute("stroke","transparent"),$e.setAttribute("fill","transparent"),Te.append($e),this.container.append(Te),!ne.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return O(this,pt)}addHighlightArea(){this.container.classList.add("highlightArea")}}pt=new WeakMap;class se extends de{constructor(ee){super(ee),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class ue extends E{constructor(ee){super(ee,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class Z extends E{constructor(ne){super(ne,{isRenderable:!0,ignoreBorder:!0});ke(this,Xe,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=s.AnnotationEditorType.INK}render(){this.container.classList.add(this.containerClassName);const ne=this.data,{width:ve,height:we}=b(ne.rect),Te=this.svgFactory.create(ve,we,!0);for(const We of ne.inkLists){let $e=[];for(const at of We){const V=at.x-ne.rect[0],ie=ne.rect[3]-at.y;$e.push(`${V},${ie}`)}$e=$e.join(" ");const tt=this.svgFactory.createElement(this.svgElementName);O(this,Xe).push(tt),tt.setAttribute("points",$e),tt.setAttribute("stroke-width",ne.borderStyle.width||1),tt.setAttribute("stroke","transparent"),tt.setAttribute("fill","transparent"),!ne.popupRef&&this.hasPopupData&&this._createPopup(),Te.append(tt)}return this.container.append(Te),this.container}getElementsToTriggerPopup(){return O(this,Xe)}addHighlightArea(){this.container.classList.add("highlightArea")}}Xe=new WeakMap,r.InkAnnotationElement=Z;class ge extends E{constructor(ee){super(ee,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this.container}}class re extends E{constructor(ee){super(ee,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class oe extends E{constructor(ee){super(ee,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class be extends E{constructor(ee){super(ee,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class L extends E{constructor(ee){super(ee,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("stampAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}r.StampAnnotationElement=L;class S extends E{constructor(ne){var Te;super(ne,{isRenderable:!0});ke(this,je);ke(this,Pe,null);const{filename:ve,content:we}=this.data.file;this.filename=(0,a.getFilenameFromUrl)(ve,!0),this.content=we,(Te=this.linkService.eventBus)==null||Te.dispatch("fileattachmentannotation",{source:this,filename:ve,content:we})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:ne,data:ve}=this;let we;ve.hasAppearance||ve.fillAlpha===0?we=document.createElement("div"):(we=document.createElement("img"),we.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(ve.name)?"paperclip":"pushpin"}.svg`,ve.fillAlpha&&ve.fillAlpha<1&&(we.style=`filter: opacity(${Math.round(ve.fillAlpha*100)}%);`)),we.addEventListener("dblclick",Ae(this,je,Qr).bind(this)),Ie(this,Pe,we);const{isMac:Te}=s.FeatureTest.platform;return ne.addEventListener("keydown",We=>{We.key==="Enter"&&(Te?We.metaKey:We.ctrlKey)&&Ae(this,je,Qr).call(this)}),!ve.popupRef&&this.hasPopupData?this._createPopup():we.classList.add("popupTriggerArea"),ne.append(we),ne}getElementsToTriggerPopup(){return O(this,Pe)}addHighlightArea(){this.container.classList.add("highlightArea")}}Pe=new WeakMap,je=new WeakSet,Qr=function(){var ne;(ne=this.downloadManager)==null||ne.openOrDownloadData(this.container,this.content,this.filename)};class C{constructor(ee){ke(this,Ue);ke(this,ut,null);ke(this,K,null);ke(this,ye,new Map);let{div:ne,accessibilityManager:ve,annotationCanvasMap:we,l10n:Te,page:We,viewport:$e}=ee;this.div=ne,Ie(this,ut,ve),Ie(this,K,we),this.l10n=Te,this.page=We,this.viewport=$e,this.zIndex=0,this.l10n||(this.l10n=c.NullL10n)}async render(ee){const{annotations:ne}=ee,ve=this.div;(0,a.setLayerDimensions)(ve,this.viewport);const we=new Map,Te={data:null,layer:ve,linkService:ee.linkService,downloadManager:ee.downloadManager,imageResourcesPath:ee.imageResourcesPath||"",renderForms:ee.renderForms!==!1,svgFactory:new a.DOMSVGFactory,annotationStorage:ee.annotationStorage||new i.AnnotationStorage,enableScripting:ee.enableScripting===!0,hasJSActions:ee.hasJSActions,fieldObjects:ee.fieldObjects,parent:this,elements:null};for(const We of ne){if(We.noHTML)continue;const $e=We.annotationType===s.AnnotationType.POPUP;if($e){const V=we.get(We.id);if(!V)continue;Te.elements=V}else{const{width:V,height:ie}=b(We.rect);if(V<=0||ie<=0)continue}Te.data=We;const tt=v.create(Te);if(!tt.isRenderable)continue;if(!$e&&We.popupRef){const V=we.get(We.popupRef);V?V.push(tt):we.set(We.popupRef,[tt])}tt.annotationEditorType>0&&O(this,ye).set(tt.data.id,tt);const at=tt.render();We.hidden&&(at.style.visibility="hidden"),Ae(this,Ue,Ns).call(this,at,We.id)}Ae(this,Ue,qr).call(this),await this.l10n.translate(ve)}update(ee){let{viewport:ne}=ee;const ve=this.div;this.viewport=ne,(0,a.setLayerDimensions)(ve,{rotation:ne.rotation}),Ae(this,Ue,qr).call(this),ve.hidden=!1}getEditableAnnotations(){return Array.from(O(this,ye).values())}getEditableAnnotation(ee){return O(this,ye).get(ee)}}ut=new WeakMap,K=new WeakMap,ye=new WeakMap,Ue=new WeakSet,Ns=function(ee,ne){var we;const ve=ee.firstChild||ee;ve.id=`${s.AnnotationPrefix}${ne}`,this.div.append(ee),(we=O(this,ut))==null||we.moveElementInDOM(this.div,ee,ve,!1)},qr=function(){if(!O(this,K))return;const ee=this.div;for(const[ne,ve]of O(this,K)){const we=ee.querySelector(`[data-annotation-id="${ne}"]`);if(!we)continue;const{firstChild:Te}=we;Te?Te.nodeName==="CANVAS"?Te.replaceWith(ve):Te.before(ve):we.append(ve)}O(this,K).clear()},r.AnnotationLayer=C},(t,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.ColorConverters=void 0;function e(i){return Math.floor(Math.max(0,Math.min(1,i))*255).toString(16).padStart(2,"0")}function s(i){return Math.max(0,Math.min(255,255*i))}class a{static CMYK_G(o){let[c,h,u,d]=o;return["G",1-Math.min(1,.3*c+.59*u+.11*h+d)]}static G_CMYK(o){let[c]=o;return["CMYK",0,0,0,1-c]}static G_RGB(o){let[c]=o;return["RGB",c,c,c]}static G_rgb(o){let[c]=o;return c=s(c),[c,c,c]}static G_HTML(o){let[c]=o;const h=e(c);return`#${h}${h}${h}`}static RGB_G(o){let[c,h,u]=o;return["G",.3*c+.59*h+.11*u]}static RGB_rgb(o){return o.map(s)}static RGB_HTML(o){return`#${o.map(e).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB(o){let[c,h,u,d]=o;return["RGB",1-Math.min(1,c+d),1-Math.min(1,u+d),1-Math.min(1,h+d)]}static CMYK_rgb(o){let[c,h,u,d]=o;return[s(1-Math.min(1,c+d)),s(1-Math.min(1,u+d)),s(1-Math.min(1,h+d))]}static CMYK_HTML(o){const c=this.CMYK_RGB(o).slice(1);return this.RGB_HTML(c)}static RGB_CMYK(o){let[c,h,u]=o;const d=1-c,_=1-h,b=1-u,v=Math.min(d,_,b);return["CMYK",d,_,b,v]}}r.ColorConverters=a},(t,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.NullL10n=void 0,r.getL10nFallback=s;const e={of_pages:"of {{pagesCount}}",page_of_pages:"({{pageNumber}} of {{pagesCount}})",document_properties_kb:"{{size_kb}} KB ({{size_b}} bytes)",document_properties_mb:"{{size_mb}} MB ({{size_b}} bytes)",document_properties_date_string:"{{date}}, {{time}}",document_properties_page_size_unit_inches:"in",document_properties_page_size_unit_millimeters:"mm",document_properties_page_size_orientation_portrait:"portrait",document_properties_page_size_orientation_landscape:"landscape",document_properties_page_size_name_a3:"A3",document_properties_page_size_name_a4:"A4",document_properties_page_size_name_letter:"Letter",document_properties_page_size_name_legal:"Legal",document_properties_page_size_dimension_string:"{{width}} × {{height}} {{unit}} ({{orientation}})",document_properties_page_size_dimension_name_string:"{{width}} × {{height}} {{unit}} ({{name}}, {{orientation}})",document_properties_linearized_yes:"Yes",document_properties_linearized_no:"No",additional_layers:"Additional Layers",page_landmark:"Page {{page}}",thumb_page_title:"Page {{page}}",thumb_page_canvas:"Thumbnail of Page {{page}}",find_reached_top:"Reached top of document, continued from bottom",find_reached_bottom:"Reached end of document, continued from top","find_match_count[one]":"{{current}} of {{total}} match","find_match_count[other]":"{{current}} of {{total}} matches","find_match_count_limit[one]":"More than {{limit}} match","find_match_count_limit[other]":"More than {{limit}} matches",find_not_found:"Phrase not found",page_scale_width:"Page Width",page_scale_fit:"Page Fit",page_scale_auto:"Automatic Zoom",page_scale_actual:"Actual Size",page_scale_percent:"{{scale}}%",loading_error:"An error occurred while loading the PDF.",invalid_file_error:"Invalid or corrupted PDF file.",missing_file_error:"Missing PDF file.",unexpected_response_error:"Unexpected server response.",rendering_error:"An error occurred while rendering the page.",annotation_date_string:"{{date}}, {{time}}",printing_not_supported:"Warning: Printing is not fully supported by this browser.",printing_not_ready:"Warning: The PDF is not fully loaded for printing.",web_fonts_disabled:"Web fonts are disabled: unable to use embedded PDF fonts.",free_text2_default_content:"Start typing…",editor_free_text2_aria_label:"Text Editor",editor_ink2_aria_label:"Draw Editor",editor_ink_canvas_aria_label:"User-created image",editor_alt_text_button_label:"Alt text",editor_alt_text_edit_button_label:"Edit alt text",editor_alt_text_decorative_tooltip:"Marked as decorative"};e.print_progress_percent="{{progress}}%";function s(o,c){switch(o){case"find_match_count":o=`find_match_count[${c.total===1?"one":"other"}]`;break;case"find_match_count_limit":o=`find_match_count_limit[${c.limit===1?"one":"other"}]`;break}return e[o]||""}function a(o,c){return c?o.replaceAll(/\{\{\s*(\w+)\s*\}\}/g,(h,u)=>u in c?c[u]:"{{"+u+"}}"):o}const i={async getLanguage(){return"en-us"},async getDirection(){return"ltr"},async get(o){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:s(o,c);return a(h,c)},async translate(o){}};r.NullL10n=i},(t,r,e)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.XfaLayer=void 0,e(89);var s=e(194);class a{static setupStorage(o,c,h,u,d){const _=u.getValue(c,{value:null});switch(h.name){case"textarea":if(_.value!==null&&(o.textContent=_.value),d==="print")break;o.addEventListener("input",b=>{u.setValue(c,{value:b.target.value})});break;case"input":if(h.attributes.type==="radio"||h.attributes.type==="checkbox"){if(_.value===h.attributes.xfaOn?o.setAttribute("checked",!0):_.value===h.attributes.xfaOff&&o.removeAttribute("checked"),d==="print")break;o.addEventListener("change",b=>{u.setValue(c,{value:b.target.checked?b.target.getAttribute("xfaOn"):b.target.getAttribute("xfaOff")})})}else{if(_.value!==null&&o.setAttribute("value",_.value),d==="print")break;o.addEventListener("input",b=>{u.setValue(c,{value:b.target.value})})}break;case"select":if(_.value!==null){o.setAttribute("value",_.value);for(const b of h.children)b.attributes.value===_.value?b.attributes.selected=!0:b.attributes.hasOwnProperty("selected")&&delete b.attributes.selected}o.addEventListener("input",b=>{const v=b.target.options,E=v.selectedIndex===-1?"":v[v.selectedIndex].value;u.setValue(c,{value:E})});break}}static setAttributes(o){let{html:c,element:h,storage:u=null,intent:d,linkService:_}=o;const{attributes:b}=h,v=c instanceof HTMLAnchorElement;b.type==="radio"&&(b.name=`${b.name}-${d}`);for(const[E,x]of Object.entries(b))if(x!=null)switch(E){case"class":x.length&&c.setAttribute(E,x.join(" "));break;case"dataId":break;case"id":c.setAttribute("data-element-id",x);break;case"style":Object.assign(c.style,x);break;case"textContent":c.textContent=x;break;default:(!v||E!=="href"&&E!=="newWindow")&&c.setAttribute(E,x)}v&&_.addLinkAttributes(c,b.href,b.newWindow),u&&b.dataId&&this.setupStorage(c,b.dataId,h,u)}static render(o){var x;const c=o.annotationStorage,h=o.linkService,u=o.xfaHtml,d=o.intent||"display",_=document.createElement(u.name);u.attributes&&this.setAttributes({html:_,element:u,intent:d,linkService:h});const b=[[u,-1,_]],v=o.div;if(v.append(_),o.viewport){const g=`matrix(${o.viewport.transform.join(",")})`;v.style.transform=g}d!=="richText"&&v.setAttribute("class","xfaLayer xfaFont");const E=[];for(;b.length>0;){const[g,w,R]=b.at(-1);if(w+1===g.children.length){b.pop();continue}const N=g.children[++b.at(-1)[1]];if(N===null)continue;const{name:M}=N;if(M==="#text"){const I=document.createTextNode(N.value);E.push(I),R.append(I);continue}const A=(x=N==null?void 0:N.attributes)!=null&&x.xmlns?document.createElementNS(N.attributes.xmlns,M):document.createElement(M);if(R.append(A),N.attributes&&this.setAttributes({html:A,element:N,storage:c,intent:d,linkService:h}),N.children&&N.children.length>0)b.push([N,-1,A]);else if(N.value){const I=document.createTextNode(N.value);s.XfaText.shouldBuildText(M)&&E.push(I),A.append(I)}}for(const g of v.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))g.setAttribute("readOnly",!0);return{textDivs:E}}static update(o){const c=`matrix(${o.viewport.transform.join(",")})`;o.div.style.transform=c,o.div.hidden=!1}}r.XfaLayer=a},(t,r,e)=>{var u,d,_,b,v,E,x,g,w,R,N,M,A,I,y,js,Ps,Fs,ks,es,Is,ts,Ms,Os,Ds,Ls,Bs,Lt,rs,br,yr,Yt,ss,_r,B,Us,ns,Ws,Hs,as,wr,Kt;Object.defineProperty(r,"__esModule",{value:!0}),r.InkEditor=void 0,e(89),e(2);var s=e(1),a=e(164),i=e(198),o=e(168),c=e(165);const he=class he extends a.AnnotationEditor{constructor(W){super({...W,name:"inkEditor"});ke(this,y);ke(this,u,0);ke(this,d,0);ke(this,_,this.canvasPointermove.bind(this));ke(this,b,this.canvasPointerleave.bind(this));ke(this,v,this.canvasPointerup.bind(this));ke(this,E,this.canvasPointerdown.bind(this));ke(this,x,new Path2D);ke(this,g,!1);ke(this,w,!1);ke(this,R,!1);ke(this,N,null);ke(this,M,0);ke(this,A,0);ke(this,I,null);this.color=W.color||null,this.thickness=W.thickness||null,this.opacity=W.opacity||null,this.paths=[],this.bezierPath2D=[],this.allRawPaths=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0,this._willKeepAspectRatio=!0}static initialize(W){a.AnnotationEditor.initialize(W,{strings:["editor_ink_canvas_aria_label","editor_ink2_aria_label"]})}static updateDefaultParams(W,Q){switch(W){case s.AnnotationEditorParamsType.INK_THICKNESS:he._defaultThickness=Q;break;case s.AnnotationEditorParamsType.INK_COLOR:he._defaultColor=Q;break;case s.AnnotationEditorParamsType.INK_OPACITY:he._defaultOpacity=Q/100;break}}updateParams(W,Q){switch(W){case s.AnnotationEditorParamsType.INK_THICKNESS:Ae(this,y,js).call(this,Q);break;case s.AnnotationEditorParamsType.INK_COLOR:Ae(this,y,Ps).call(this,Q);break;case s.AnnotationEditorParamsType.INK_OPACITY:Ae(this,y,Fs).call(this,Q);break}}static get defaultPropertiesToUpdate(){return[[s.AnnotationEditorParamsType.INK_THICKNESS,he._defaultThickness],[s.AnnotationEditorParamsType.INK_COLOR,he._defaultColor||a.AnnotationEditor._defaultLineColor],[s.AnnotationEditorParamsType.INK_OPACITY,Math.round(he._defaultOpacity*100)]]}get propertiesToUpdate(){return[[s.AnnotationEditorParamsType.INK_THICKNESS,this.thickness||he._defaultThickness],[s.AnnotationEditorParamsType.INK_COLOR,this.color||he._defaultColor||a.AnnotationEditor._defaultLineColor],[s.AnnotationEditorParamsType.INK_OPACITY,Math.round(100*(this.opacity??he._defaultOpacity))]]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.canvas||(Ae(this,y,br).call(this),Ae(this,y,yr).call(this)),this.isAttachedToDOM||(this.parent.add(this),Ae(this,y,Yt).call(this)),Ae(this,y,Kt).call(this)))}remove(){this.canvas!==null&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,O(this,N).disconnect(),Ie(this,N,null),super.remove())}setParent(W){!this.parent&&W?this._uiManager.removeShouldRescale(this):this.parent&&W===null&&this._uiManager.addShouldRescale(this),super.setParent(W)}onScaleChanging(){const[W,Q]=this.parentDimensions,xe=this.width*W,Se=this.height*Q;this.setDimensions(xe,Se)}enableEditMode(){O(this,g)||this.canvas===null||(super.enableEditMode(),this._isDraggable=!1,this.canvas.addEventListener("pointerdown",O(this,E)))}disableEditMode(){!this.isInEditMode()||this.canvas===null||(super.disableEditMode(),this._isDraggable=!this.isEmpty(),this.div.classList.remove("editing"),this.canvas.removeEventListener("pointerdown",O(this,E)))}onceAdded(){this._isDraggable=!this.isEmpty()}isEmpty(){return this.paths.length===0||this.paths.length===1&&this.paths[0].length===0}commit(){O(this,g)||(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),Ie(this,g,!0),this.div.classList.add("disabled"),Ae(this,y,Kt).call(this,!0),this.makeResizable(),this.parent.addInkEditorIfNeeded(!0),this.moveInDOM(),this.div.focus({preventScroll:!0}))}focusin(W){this._focusEventsAllowed&&(super.focusin(W),this.enableEditMode())}canvasPointerdown(W){W.button!==0||!this.isInEditMode()||O(this,g)||(this.setInForeground(),W.preventDefault(),W.type!=="mouse"&&this.div.focus(),Ae(this,y,Is).call(this,W.offsetX,W.offsetY))}canvasPointermove(W){W.preventDefault(),Ae(this,y,ts).call(this,W.offsetX,W.offsetY)}canvasPointerup(W){W.preventDefault(),Ae(this,y,rs).call(this,W)}canvasPointerleave(W){Ae(this,y,rs).call(this,W)}get isResizable(){return!this.isEmpty()&&O(this,g)}render(){if(this.div)return this.div;let W,Q;this.width&&(W=this.x,Q=this.y),super.render(),a.AnnotationEditor._l10nPromise.get("editor_ink2_aria_label").then(De=>{var _e;return(_e=this.div)==null?void 0:_e.setAttribute("aria-label",De)});const[xe,Se,Ce,Le]=Ae(this,y,ks).call(this);if(this.setAt(xe,Se,0,0),this.setDims(Ce,Le),Ae(this,y,br).call(this),this.width){const[De,_e]=this.parentDimensions;this.setAspectRatio(this.width*De,this.height*_e),this.setAt(W*De,Q*_e,this.width*De,this.height*_e),Ie(this,R,!0),Ae(this,y,Yt).call(this),this.setDims(this.width*De,this.height*_e),Ae(this,y,Lt).call(this),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return Ae(this,y,yr).call(this),this.div}setDimensions(W,Q){const xe=Math.round(W),Se=Math.round(Q);if(O(this,M)===xe&&O(this,A)===Se)return;Ie(this,M,xe),Ie(this,A,Se),this.canvas.style.visibility="hidden";const[Ce,Le]=this.parentDimensions;this.width=W/Ce,this.height=Q/Le,this.fixAndSetPosition(),O(this,g)&&Ae(this,y,ss).call(this,W,Q),Ae(this,y,Yt).call(this),Ae(this,y,Lt).call(this),this.canvas.style.visibility="visible",this.fixDims()}static deserialize(W,Q,xe){var nt,ct,ft;if(W instanceof i.InkAnnotationElement)return null;const Se=super.deserialize(W,Q,xe);Se.thickness=W.thickness,Se.color=s.Util.makeHexColor(...W.color),Se.opacity=W.opacity;const[Ce,Le]=Se.pageDimensions,De=Se.width*Ce,_e=Se.height*Le,Ge=Se.parentScale,Ye=W.thickness/2;Ie(Se,g,!0),Ie(Se,M,Math.round(De)),Ie(Se,A,Math.round(_e));const{paths:ot,rect:st,rotation:ht}=W;for(let{bezier:pt}of ot){pt=Ae(nt=he,B,Ws).call(nt,pt,st,ht);const Xe=[];Se.paths.push(Xe);let Pe=Ge*(pt[0]-Ye),je=Ge*(pt[1]-Ye);for(let ut=2,K=pt.length;ut<K;ut+=6){const ye=Ge*(pt[ut]-Ye),Ue=Ge*(pt[ut+1]-Ye),ze=Ge*(pt[ut+2]-Ye),Ke=Ge*(pt[ut+3]-Ye),Ve=Ge*(pt[ut+4]-Ye),ee=Ge*(pt[ut+5]-Ye);Xe.push([[Pe,je],[ye,Ue],[ze,Ke],[Ve,ee]]),Pe=Ve,je=ee}const Qe=Ae(this,B,Us).call(this,Xe);Se.bezierPath2D.push(Qe)}const Je=Ae(ct=Se,y,as).call(ct);return Ie(Se,d,Math.max(a.AnnotationEditor.MIN_SIZE,Je[2]-Je[0])),Ie(Se,u,Math.max(a.AnnotationEditor.MIN_SIZE,Je[3]-Je[1])),Ae(ft=Se,y,ss).call(ft,De,_e),Se}serialize(){if(this.isEmpty())return null;const W=this.getRect(0,0),Q=a.AnnotationEditor._colorManager.convert(this.ctx.strokeStyle);return{annotationType:s.AnnotationEditorType.INK,color:Q,thickness:this.thickness,opacity:this.opacity,paths:Ae(this,y,Hs).call(this,this.scaleFactor/this.parentScale,this.translationX,this.translationY,W),pageIndex:this.pageIndex,rect:W,rotation:this.rotation,structTreeParentId:this._structTreeParentId}}};u=new WeakMap,d=new WeakMap,_=new WeakMap,b=new WeakMap,v=new WeakMap,E=new WeakMap,x=new WeakMap,g=new WeakMap,w=new WeakMap,R=new WeakMap,N=new WeakMap,M=new WeakMap,A=new WeakMap,I=new WeakMap,y=new WeakSet,js=function(W){const Q=this.thickness;this.addCommands({cmd:()=>{this.thickness=W,Ae(this,y,Kt).call(this)},undo:()=>{this.thickness=Q,Ae(this,y,Kt).call(this)},mustExec:!0,type:s.AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})},Ps=function(W){const Q=this.color;this.addCommands({cmd:()=>{this.color=W,Ae(this,y,Lt).call(this)},undo:()=>{this.color=Q,Ae(this,y,Lt).call(this)},mustExec:!0,type:s.AnnotationEditorParamsType.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})},Fs=function(W){W/=100;const Q=this.opacity;this.addCommands({cmd:()=>{this.opacity=W,Ae(this,y,Lt).call(this)},undo:()=>{this.opacity=Q,Ae(this,y,Lt).call(this)},mustExec:!0,type:s.AnnotationEditorParamsType.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})},ks=function(){const{parentRotation:W,parentDimensions:[Q,xe]}=this;switch(W){case 90:return[0,xe,xe,Q];case 180:return[Q,xe,Q,xe];case 270:return[Q,0,xe,Q];default:return[0,0,Q,xe]}},es=function(){const{ctx:W,color:Q,opacity:xe,thickness:Se,parentScale:Ce,scaleFactor:Le}=this;W.lineWidth=Se*Ce/Le,W.lineCap="round",W.lineJoin="round",W.miterLimit=10,W.strokeStyle=`${Q}${(0,c.opacityToHex)(xe)}`},Is=function(W,Q){this.canvas.addEventListener("contextmenu",o.noContextMenu),this.canvas.addEventListener("pointerleave",O(this,b)),this.canvas.addEventListener("pointermove",O(this,_)),this.canvas.addEventListener("pointerup",O(this,v)),this.canvas.removeEventListener("pointerdown",O(this,E)),this.isEditing=!0,O(this,R)||(Ie(this,R,!0),Ae(this,y,Yt).call(this),this.thickness||(this.thickness=he._defaultThickness),this.color||(this.color=he._defaultColor||a.AnnotationEditor._defaultLineColor),this.opacity??(this.opacity=he._defaultOpacity)),this.currentPath.push([W,Q]),Ie(this,w,!1),Ae(this,y,es).call(this),Ie(this,I,()=>{Ae(this,y,Ds).call(this),O(this,I)&&window.requestAnimationFrame(O(this,I))}),window.requestAnimationFrame(O(this,I))},ts=function(W,Q){const[xe,Se]=this.currentPath.at(-1);if(this.currentPath.length>1&&W===xe&&Q===Se)return;const Ce=this.currentPath;let Le=O(this,x);if(Ce.push([W,Q]),Ie(this,w,!0),Ce.length<=2){Le.moveTo(...Ce[0]),Le.lineTo(W,Q);return}Ce.length===3&&(Ie(this,x,Le=new Path2D),Le.moveTo(...Ce[0])),Ae(this,y,Ls).call(this,Le,...Ce.at(-3),...Ce.at(-2),W,Q)},Ms=function(){if(this.currentPath.length===0)return;const W=this.currentPath.at(-1);O(this,x).lineTo(...W)},Os=function(W,Q){Ie(this,I,null),W=Math.min(Math.max(W,0),this.canvas.width),Q=Math.min(Math.max(Q,0),this.canvas.height),Ae(this,y,ts).call(this,W,Q),Ae(this,y,Ms).call(this);let xe;if(this.currentPath.length!==1)xe=Ae(this,y,Bs).call(this);else{const _e=[W,Q];xe=[[_e,_e.slice(),_e.slice(),_e]]}const Se=O(this,x),Ce=this.currentPath;this.currentPath=[],Ie(this,x,new Path2D);const Le=()=>{this.allRawPaths.push(Ce),this.paths.push(xe),this.bezierPath2D.push(Se),this.rebuild()},De=()=>{this.allRawPaths.pop(),this.paths.pop(),this.bezierPath2D.pop(),this.paths.length===0?this.remove():(this.canvas||(Ae(this,y,br).call(this),Ae(this,y,yr).call(this)),Ae(this,y,Kt).call(this))};this.addCommands({cmd:Le,undo:De,mustExec:!0})},Ds=function(){if(!O(this,w))return;Ie(this,w,!1);const W=Math.ceil(this.thickness*this.parentScale),Q=this.currentPath.slice(-3),xe=Q.map(Le=>Le[0]),Se=Q.map(Le=>Le[1]);Math.min(...xe)-W,Math.max(...xe)+W,Math.min(...Se)-W,Math.max(...Se)+W;const{ctx:Ce}=this;Ce.save(),Ce.clearRect(0,0,this.canvas.width,this.canvas.height);for(const Le of this.bezierPath2D)Ce.stroke(Le);Ce.stroke(O(this,x)),Ce.restore()},Ls=function(W,Q,xe,Se,Ce,Le,De){const _e=(Q+Se)/2,Ge=(xe+Ce)/2,Ye=(Se+Le)/2,ot=(Ce+De)/2;W.bezierCurveTo(_e+2*(Se-_e)/3,Ge+2*(Ce-Ge)/3,Ye+2*(Se-Ye)/3,ot+2*(Ce-ot)/3,Ye,ot)},Bs=function(){const W=this.currentPath;if(W.length<=2)return[[W[0],W[0],W.at(-1),W.at(-1)]];const Q=[];let xe,[Se,Ce]=W[0];for(xe=1;xe<W.length-2;xe++){const[st,ht]=W[xe],[Je,nt]=W[xe+1],ct=(st+Je)/2,ft=(ht+nt)/2,pt=[Se+2*(st-Se)/3,Ce+2*(ht-Ce)/3],Xe=[ct+2*(st-ct)/3,ft+2*(ht-ft)/3];Q.push([[Se,Ce],pt,Xe,[ct,ft]]),[Se,Ce]=[ct,ft]}const[Le,De]=W[xe],[_e,Ge]=W[xe+1],Ye=[Se+2*(Le-Se)/3,Ce+2*(De-Ce)/3],ot=[_e+2*(Le-_e)/3,Ge+2*(De-Ge)/3];return Q.push([[Se,Ce],Ye,ot,[_e,Ge]]),Q},Lt=function(){if(this.isEmpty()){Ae(this,y,_r).call(this);return}Ae(this,y,es).call(this);const{canvas:W,ctx:Q}=this;Q.setTransform(1,0,0,1,0,0),Q.clearRect(0,0,W.width,W.height),Ae(this,y,_r).call(this);for(const xe of this.bezierPath2D)Q.stroke(xe)},rs=function(W){this.canvas.removeEventListener("pointerleave",O(this,b)),this.canvas.removeEventListener("pointermove",O(this,_)),this.canvas.removeEventListener("pointerup",O(this,v)),this.canvas.addEventListener("pointerdown",O(this,E)),setTimeout(()=>{this.canvas.removeEventListener("contextmenu",o.noContextMenu)},10),Ae(this,y,Os).call(this,W.offsetX,W.offsetY),this.addToAnnotationStorage(),this.setInBackground()},br=function(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",a.AnnotationEditor._l10nPromise.get("editor_ink_canvas_aria_label").then(W=>{var Q;return(Q=this.canvas)==null?void 0:Q.setAttribute("aria-label",W)}),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")},yr=function(){Ie(this,N,new ResizeObserver(W=>{const Q=W[0].contentRect;Q.width&&Q.height&&this.setDimensions(Q.width,Q.height)})),O(this,N).observe(this.div)},Yt=function(){if(!O(this,R))return;const[W,Q]=this.parentDimensions;this.canvas.width=Math.ceil(this.width*W),this.canvas.height=Math.ceil(this.height*Q),Ae(this,y,_r).call(this)},ss=function(W,Q){const xe=Ae(this,y,wr).call(this),Se=(W-xe)/O(this,d),Ce=(Q-xe)/O(this,u);this.scaleFactor=Math.min(Se,Ce)},_r=function(){const W=Ae(this,y,wr).call(this)/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+W,this.translationY*this.scaleFactor+W)},B=new WeakSet,Us=function(W){const Q=new Path2D;for(let xe=0,Se=W.length;xe<Se;xe++){const[Ce,Le,De,_e]=W[xe];xe===0&&Q.moveTo(...Ce),Q.bezierCurveTo(Le[0],Le[1],De[0],De[1],_e[0],_e[1])}return Q},ns=function(W,Q,xe){const[Se,Ce,Le,De]=Q;switch(xe){case 0:for(let _e=0,Ge=W.length;_e<Ge;_e+=2)W[_e]+=Se,W[_e+1]=De-W[_e+1];break;case 90:for(let _e=0,Ge=W.length;_e<Ge;_e+=2){const Ye=W[_e];W[_e]=W[_e+1]+Se,W[_e+1]=Ye+Ce}break;case 180:for(let _e=0,Ge=W.length;_e<Ge;_e+=2)W[_e]=Le-W[_e],W[_e+1]+=Ce;break;case 270:for(let _e=0,Ge=W.length;_e<Ge;_e+=2){const Ye=W[_e];W[_e]=Le-W[_e+1],W[_e+1]=De-Ye}break;default:throw new Error("Invalid rotation")}return W},Ws=function(W,Q,xe){const[Se,Ce,Le,De]=Q;switch(xe){case 0:for(let _e=0,Ge=W.length;_e<Ge;_e+=2)W[_e]-=Se,W[_e+1]=De-W[_e+1];break;case 90:for(let _e=0,Ge=W.length;_e<Ge;_e+=2){const Ye=W[_e];W[_e]=W[_e+1]-Ce,W[_e+1]=Ye-Se}break;case 180:for(let _e=0,Ge=W.length;_e<Ge;_e+=2)W[_e]=Le-W[_e],W[_e+1]-=Ce;break;case 270:for(let _e=0,Ge=W.length;_e<Ge;_e+=2){const Ye=W[_e];W[_e]=De-W[_e+1],W[_e+1]=Le-Ye}break;default:throw new Error("Invalid rotation")}return W},Hs=function(W,Q,xe,Se){var Ge,Ye;const Ce=[],Le=this.thickness/2,De=W*Q+Le,_e=W*xe+Le;for(const ot of this.paths){const st=[],ht=[];for(let Je=0,nt=ot.length;Je<nt;Je++){const[ct,ft,pt,Xe]=ot[Je],Pe=W*ct[0]+De,je=W*ct[1]+_e,Qe=W*ft[0]+De,ut=W*ft[1]+_e,K=W*pt[0]+De,ye=W*pt[1]+_e,Ue=W*Xe[0]+De,ze=W*Xe[1]+_e;Je===0&&(st.push(Pe,je),ht.push(Pe,je)),st.push(Qe,ut,K,ye,Ue,ze),ht.push(Qe,ut),Je===nt-1&&ht.push(Ue,ze)}Ce.push({bezier:Ae(Ge=he,B,ns).call(Ge,st,Se,this.rotation),points:Ae(Ye=he,B,ns).call(Ye,ht,Se,this.rotation)})}return Ce},as=function(){let W=1/0,Q=-1/0,xe=1/0,Se=-1/0;for(const Ce of this.paths)for(const[Le,De,_e,Ge]of Ce){const Ye=s.Util.bezierBoundingBox(...Le,...De,..._e,...Ge);W=Math.min(W,Ye[0]),xe=Math.min(xe,Ye[1]),Q=Math.max(Q,Ye[2]),Se=Math.max(Se,Ye[3])}return[W,xe,Q,Se]},wr=function(){return O(this,g)?Math.ceil(this.thickness*this.parentScale):0},Kt=function(){let W=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(this.isEmpty())return;if(!O(this,g)){Ae(this,y,Lt).call(this);return}const Q=Ae(this,y,as).call(this),xe=Ae(this,y,wr).call(this);Ie(this,d,Math.max(a.AnnotationEditor.MIN_SIZE,Q[2]-Q[0])),Ie(this,u,Math.max(a.AnnotationEditor.MIN_SIZE,Q[3]-Q[1]));const Se=Math.ceil(xe+O(this,d)*this.scaleFactor),Ce=Math.ceil(xe+O(this,u)*this.scaleFactor),[Le,De]=this.parentDimensions;this.width=Se/Le,this.height=Ce/De,this.setAspectRatio(Se,Ce);const _e=this.translationX,Ge=this.translationY;this.translationX=-Q[0],this.translationY=-Q[1],Ae(this,y,Yt).call(this),Ae(this,y,Lt).call(this),Ie(this,M,Se),Ie(this,A,Ce),this.setDims(Se,Ce);const Ye=W?xe/this.scaleFactor/2:0;this.translate(_e-this.translationX-Ye,Ge-this.translationY-Ye)},ke(he,B),bt(he,"_defaultColor",null),bt(he,"_defaultOpacity",1),bt(he,"_defaultThickness",1),bt(he,"_type","ink");let h=he;r.InkEditor=h},(t,r,e)=>{var h,u,d,_,b,v,E,x,g,w,R,ar,ir,Sr,is,Vs,$s,os,Rr,zs;Object.defineProperty(r,"__esModule",{value:!0}),r.StampEditor=void 0,e(149),e(152);var s=e(1),a=e(164),i=e(168),o=e(198);const H=class H extends a.AnnotationEditor{constructor(se){super({...se,name:"stampEditor"});ke(this,R);ke(this,h,null);ke(this,u,null);ke(this,d,null);ke(this,_,null);ke(this,b,null);ke(this,v,null);ke(this,E,null);ke(this,x,null);ke(this,g,!1);ke(this,w,!1);Ie(this,_,se.bitmapUrl),Ie(this,b,se.bitmapFile)}static initialize(se){a.AnnotationEditor.initialize(se)}static get supportedTypes(){const se=["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"];return(0,s.shadow)(this,"supportedTypes",se.map(ue=>`image/${ue}`))}static get supportedTypesStr(){return(0,s.shadow)(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(se){return this.supportedTypes.includes(se)}static paste(se,ue){ue.pasteEditor(s.AnnotationEditorType.STAMP,{bitmapFile:se.getAsFile()})}remove(){var se,ue;O(this,u)&&(Ie(this,h,null),this._uiManager.imageManager.deleteId(O(this,u)),(se=O(this,v))==null||se.remove(),Ie(this,v,null),(ue=O(this,E))==null||ue.disconnect(),Ie(this,E,null)),super.remove()}rebuild(){if(!this.parent){O(this,u)&&Ae(this,R,Sr).call(this);return}super.rebuild(),this.div!==null&&(O(this,u)&&Ae(this,R,Sr).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(){this._isDraggable=!0,this.div.focus()}isEmpty(){return!(O(this,d)||O(this,h)||O(this,_)||O(this,b))}get isResizable(){return!0}render(){if(this.div)return this.div;let se,ue;if(this.width&&(se=this.x,ue=this.y),super.render(),this.div.hidden=!0,O(this,h)?Ae(this,R,is).call(this):Ae(this,R,Sr).call(this),this.width){const[Z,ge]=this.parentDimensions;this.setAt(se*Z,ue*ge,this.width*Z,this.height*ge)}return this.div}static deserialize(se,ue,Z){if(se instanceof o.StampAnnotationElement)return null;const ge=super.deserialize(se,ue,Z),{rect:re,bitmapUrl:oe,bitmapId:be,isSvg:L,accessibilityData:S}=se;be&&Z.imageManager.isValidId(be)?Ie(ge,u,be):Ie(ge,_,oe),Ie(ge,g,L);const[C,P]=ge.pageDimensions;return ge.width=(re[2]-re[0])/C,ge.height=(re[3]-re[1])/P,S&&(ge.altTextData=S),ge}serialize(){let se=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,ue=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(this.isEmpty())return null;const Z={annotationType:s.AnnotationEditorType.STAMP,bitmapId:O(this,u),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:O(this,g),structTreeParentId:this._structTreeParentId};if(se)return Z.bitmapUrl=Ae(this,R,Rr).call(this,!0),Z.accessibilityData=this.altTextData,Z;const{decorative:ge,altText:re}=this.altTextData;if(!ge&&re&&(Z.accessibilityData={type:"Figure",alt:re}),ue===null)return Z;ue.stamps||(ue.stamps=new Map);const oe=O(this,g)?(Z.rect[2]-Z.rect[0])*(Z.rect[3]-Z.rect[1]):null;if(!ue.stamps.has(O(this,u)))ue.stamps.set(O(this,u),{area:oe,serialized:Z}),Z.bitmap=Ae(this,R,Rr).call(this,!1);else if(O(this,g)){const be=ue.stamps.get(O(this,u));oe>be.area&&(be.area=oe,be.serialized.bitmap.close(),be.serialized.bitmap=Ae(this,R,Rr).call(this,!1))}return Z}};h=new WeakMap,u=new WeakMap,d=new WeakMap,_=new WeakMap,b=new WeakMap,v=new WeakMap,E=new WeakMap,x=new WeakMap,g=new WeakMap,w=new WeakMap,R=new WeakSet,ar=function(se){let ue=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!se){this.remove();return}Ie(this,h,se.bitmap),ue||(Ie(this,u,se.id),Ie(this,g,se.isSvg)),Ae(this,R,is).call(this)},ir=function(){Ie(this,d,null),this._uiManager.enableWaiting(!1),O(this,v)&&this.div.focus()},Sr=function(){if(O(this,u)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(O(this,u)).then(ue=>Ae(this,R,ar).call(this,ue,!0)).finally(()=>Ae(this,R,ir).call(this));return}if(O(this,_)){const ue=O(this,_);Ie(this,_,null),this._uiManager.enableWaiting(!0),Ie(this,d,this._uiManager.imageManager.getFromUrl(ue).then(Z=>Ae(this,R,ar).call(this,Z)).finally(()=>Ae(this,R,ir).call(this)));return}if(O(this,b)){const ue=O(this,b);Ie(this,b,null),this._uiManager.enableWaiting(!0),Ie(this,d,this._uiManager.imageManager.getFromFile(ue).then(Z=>Ae(this,R,ar).call(this,Z)).finally(()=>Ae(this,R,ir).call(this)));return}const se=document.createElement("input");se.type="file",se.accept=H.supportedTypesStr,Ie(this,d,new Promise(ue=>{se.addEventListener("change",async()=>{if(!se.files||se.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const Z=await this._uiManager.imageManager.getFromFile(se.files[0]);Ae(this,R,ar).call(this,Z)}ue()}),se.addEventListener("cancel",()=>{this.remove(),ue()})}).finally(()=>Ae(this,R,ir).call(this))),se.click()},is=function(){const{div:se}=this;let{width:ue,height:Z}=O(this,h);const[ge,re]=this.pageDimensions,oe=.75;if(this.width)ue=this.width*ge,Z=this.height*re;else if(ue>oe*ge||Z>oe*re){const C=Math.min(oe*ge/ue,oe*re/Z);ue*=C,Z*=C}const[be,L]=this.parentDimensions;this.setDims(ue*be/ge,Z*L/re),this._uiManager.enableWaiting(!1);const S=Ie(this,v,document.createElement("canvas"));se.append(S),se.hidden=!1,Ae(this,R,os).call(this,ue,Z),Ae(this,R,zs).call(this),O(this,w)||(this.parent.addUndoableEditor(this),Ie(this,w,!0)),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",subtype:this.editorType,data:{action:"inserted_image"}}}),this.addAltTextButton()},Vs=function(se,ue){var oe;const[Z,ge]=this.parentDimensions;this.width=se/Z,this.height=ue/ge,this.setDims(se,ue),(oe=this._initialOptions)!=null&&oe.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,O(this,x)!==null&&clearTimeout(O(this,x)),Ie(this,x,setTimeout(()=>{Ie(this,x,null),Ae(this,R,os).call(this,se,ue)},200))},$s=function(se,ue){const{width:Z,height:ge}=O(this,h);let re=Z,oe=ge,be=O(this,h);for(;re>2*se||oe>2*ue;){const L=re,S=oe;re>2*se&&(re=re>=16384?Math.floor(re/2)-1:Math.ceil(re/2)),oe>2*ue&&(oe=oe>=16384?Math.floor(oe/2)-1:Math.ceil(oe/2));const C=new OffscreenCanvas(re,oe);C.getContext("2d").drawImage(be,0,0,L,S,0,0,re,oe),be=C.transferToImageBitmap()}return be},os=function(se,ue){se=Math.ceil(se),ue=Math.ceil(ue);const Z=O(this,v);if(!Z||Z.width===se&&Z.height===ue)return;Z.width=se,Z.height=ue;const ge=O(this,g)?O(this,h):Ae(this,R,$s).call(this,se,ue),re=Z.getContext("2d");re.filter=this._uiManager.hcmFilter,re.drawImage(ge,0,0,ge.width,ge.height,0,0,se,ue)},Rr=function(se){if(se){if(O(this,g)){const ge=this._uiManager.imageManager.getSvgUrl(O(this,u));if(ge)return ge}const ue=document.createElement("canvas");return{width:ue.width,height:ue.height}=O(this,h),ue.getContext("2d").drawImage(O(this,h),0,0),ue.toDataURL()}if(O(this,g)){const[ue,Z]=this.pageDimensions,ge=Math.round(this.width*ue*i.PixelsPerInch.PDF_TO_CSS_UNITS),re=Math.round(this.height*Z*i.PixelsPerInch.PDF_TO_CSS_UNITS),oe=new OffscreenCanvas(ge,re);return oe.getContext("2d").drawImage(O(this,h),0,0,O(this,h).width,O(this,h).height,0,0,ge,re),oe.transferToImageBitmap()}return structuredClone(O(this,h))},zs=function(){Ie(this,E,new ResizeObserver(se=>{const ue=se[0].contentRect;ue.width&&ue.height&&Ae(this,R,Vs).call(this,ue.width,ue.height)})),O(this,E).observe(this.div)},bt(H,"_type","stamp");let c=H;r.StampEditor=c}],__webpack_module_cache__={};function __w_pdfjs_require__(t){var r=__webpack_module_cache__[t];if(r!==void 0)return r.exports;var e=__webpack_module_cache__[t]={exports:{}};return __webpack_modules__[t].call(e.exports,e,e.exports,__w_pdfjs_require__),e.exports}var __webpack_exports__={};return(()=>{var t=__webpack_exports__;Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"AbortException",{enumerable:!0,get:function(){return r.AbortException}}),Object.defineProperty(t,"AnnotationEditorLayer",{enumerable:!0,get:function(){return i.AnnotationEditorLayer}}),Object.defineProperty(t,"AnnotationEditorParamsType",{enumerable:!0,get:function(){return r.AnnotationEditorParamsType}}),Object.defineProperty(t,"AnnotationEditorType",{enumerable:!0,get:function(){return r.AnnotationEditorType}}),Object.defineProperty(t,"AnnotationEditorUIManager",{enumerable:!0,get:function(){return o.AnnotationEditorUIManager}}),Object.defineProperty(t,"AnnotationLayer",{enumerable:!0,get:function(){return c.AnnotationLayer}}),Object.defineProperty(t,"AnnotationMode",{enumerable:!0,get:function(){return r.AnnotationMode}}),Object.defineProperty(t,"CMapCompressionType",{enumerable:!0,get:function(){return r.CMapCompressionType}}),Object.defineProperty(t,"DOMSVGFactory",{enumerable:!0,get:function(){return s.DOMSVGFactory}}),Object.defineProperty(t,"FeatureTest",{enumerable:!0,get:function(){return r.FeatureTest}}),Object.defineProperty(t,"GlobalWorkerOptions",{enumerable:!0,get:function(){return h.GlobalWorkerOptions}}),Object.defineProperty(t,"ImageKind",{enumerable:!0,get:function(){return r.ImageKind}}),Object.defineProperty(t,"InvalidPDFException",{enumerable:!0,get:function(){return r.InvalidPDFException}}),Object.defineProperty(t,"MissingPDFException",{enumerable:!0,get:function(){return r.MissingPDFException}}),Object.defineProperty(t,"OPS",{enumerable:!0,get:function(){return r.OPS}}),Object.defineProperty(t,"PDFDataRangeTransport",{enumerable:!0,get:function(){return e.PDFDataRangeTransport}}),Object.defineProperty(t,"PDFDateString",{enumerable:!0,get:function(){return s.PDFDateString}}),Object.defineProperty(t,"PDFWorker",{enumerable:!0,get:function(){return e.PDFWorker}}),Object.defineProperty(t,"PasswordResponses",{enumerable:!0,get:function(){return r.PasswordResponses}}),Object.defineProperty(t,"PermissionFlag",{enumerable:!0,get:function(){return r.PermissionFlag}}),Object.defineProperty(t,"PixelsPerInch",{enumerable:!0,get:function(){return s.PixelsPerInch}}),Object.defineProperty(t,"PromiseCapability",{enumerable:!0,get:function(){return r.PromiseCapability}}),Object.defineProperty(t,"RenderingCancelledException",{enumerable:!0,get:function(){return s.RenderingCancelledException}}),Object.defineProperty(t,"SVGGraphics",{enumerable:!0,get:function(){return e.SVGGraphics}}),Object.defineProperty(t,"UnexpectedResponseException",{enumerable:!0,get:function(){return r.UnexpectedResponseException}}),Object.defineProperty(t,"Util",{enumerable:!0,get:function(){return r.Util}}),Object.defineProperty(t,"VerbosityLevel",{enumerable:!0,get:function(){return r.VerbosityLevel}}),Object.defineProperty(t,"XfaLayer",{enumerable:!0,get:function(){return u.XfaLayer}}),Object.defineProperty(t,"build",{enumerable:!0,get:function(){return e.build}}),Object.defineProperty(t,"createValidAbsoluteUrl",{enumerable:!0,get:function(){return r.createValidAbsoluteUrl}}),Object.defineProperty(t,"getDocument",{enumerable:!0,get:function(){return e.getDocument}}),Object.defineProperty(t,"getFilenameFromUrl",{enumerable:!0,get:function(){return s.getFilenameFromUrl}}),Object.defineProperty(t,"getPdfFilenameFromUrl",{enumerable:!0,get:function(){return s.getPdfFilenameFromUrl}}),Object.defineProperty(t,"getXfaPageViewport",{enumerable:!0,get:function(){return s.getXfaPageViewport}}),Object.defineProperty(t,"isDataScheme",{enumerable:!0,get:function(){return s.isDataScheme}}),Object.defineProperty(t,"isPdfFile",{enumerable:!0,get:function(){return s.isPdfFile}}),Object.defineProperty(t,"loadScript",{enumerable:!0,get:function(){return s.loadScript}}),Object.defineProperty(t,"noContextMenu",{enumerable:!0,get:function(){return s.noContextMenu}}),Object.defineProperty(t,"normalizeUnicode",{enumerable:!0,get:function(){return r.normalizeUnicode}}),Object.defineProperty(t,"renderTextLayer",{enumerable:!0,get:function(){return a.renderTextLayer}}),Object.defineProperty(t,"setLayerDimensions",{enumerable:!0,get:function(){return s.setLayerDimensions}}),Object.defineProperty(t,"shadow",{enumerable:!0,get:function(){return r.shadow}}),Object.defineProperty(t,"updateTextLayer",{enumerable:!0,get:function(){return a.updateTextLayer}}),Object.defineProperty(t,"version",{enumerable:!0,get:function(){return e.version}});var r=__w_pdfjs_require__(1),e=__w_pdfjs_require__(124),s=__w_pdfjs_require__(168),a=__w_pdfjs_require__(195),i=__w_pdfjs_require__(196),o=__w_pdfjs_require__(165),c=__w_pdfjs_require__(198),h=__w_pdfjs_require__(176),u=__w_pdfjs_require__(201)})(),__webpack_exports__})())})(pdf);var pdfExports=pdf.exports;typeof window<"u"&&!pdfExports.GlobalWorkerOptions.workerSrc&&(pdfExports.GlobalWorkerOptions.workerSrc="//cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js");function PdfToExcelConverter(){const[t,r]=reactExports.useState(!1),[e,s]=reactExports.useState(null),[a,i]=reactExports.useState(null),[o,c]=reactExports.useState([]),[h,u]=reactExports.useState(!1),d=b=>{console.log("📄 Total de elementos de texto:",b.length),console.log("📄 Primeros 10 elementos:",b.slice(0,10));const v=b.slice(0,100).map(M=>M.str).join(" ");console.log("📄 Texto preview (primeros 100):",v);const E=new Map,x=3;b.forEach(M=>{const A=Math.round(M.transform[5]/x)*x;E.has(A)||E.set(A,[]),E.get(A).push(M)});const g=[];Array.from(E.entries()).sort((M,A)=>A[0]-M[0]).forEach(([M,A])=>{const y=A.sort((j,T)=>j.transform[4]-T.transform[4]).map(j=>j.str).join(" ");g.push(y)}),console.log("📄 Líneas extraídas:",g.slice(0,20));const w=[];let R="",N="";for(const M of g){const A=M.trim();if(!A||/glass|cristal|seguro|insurance/i.test(A))continue;const I=A.match(/(Business\s*Parcel|Economy\s*Parcel|Euro\s*Business\s*Parcel|EuroBusinessParc|Parcel\s*Shop|Express|Eurobusiness|Courier)/i);if(I){R=I[0].trim().replace(/\s+/g," "),console.log("🚚 Servicio:",R);continue}const y=A.match(/\b(PROVINCIAL|REGIONAL|NACIONAL|CEUTA|MELILLA|GIBRALTAR|ANDORRA|PENINSULA|BALEARES)\b/i);if(y){N=y[1].trim(),console.log("📍 Zona:",N);continue}const j=A.match(/(\d+(?:-\d+)?)\s*kg/i)||A.match(/\b(0-1|1-3|3-5|5-10|10-15|15\+?|\+15)\b/i);if(!j||!R||!N)continue;let T=j[1];T==="1"?T="0-1":T==="3"?T="1-3":T==="5"?T="3-5":T==="10"?T="5-10":T==="15"?T="10-15":(T==="+"||T==="+15"||T==="15+")&&(T="15-99");const U=A.match(/\d+[.,]\d{2}/g);if(console.log("🔢 Línea con peso:",A,"→ números:",U),U&&U.length>=6){const F={servicio:R,zona:N,peso:T+"kg",recogida:U[0].replace(",","."),arrastre:U[1].replace(",","."),entrega:U[2].replace(",","."),salidas:U[3].replace(",","."),recogidas:U[4].replace(",","."),interciudad:U[5].replace(",",".")};console.log("✅ Fila:",F),w.push(F)}}return console.log(`📊 Total filas: ${w.length}`),w},_=async b=>{var E;const v=(E=b.target.files)==null?void 0:E[0];if(!v||!v.name.toLowerCase().endsWith(".pdf")){i("Selecciona un archivo PDF válido");return}r(!0),i(null),s(null),c([]),u(!1);try{const x=await v.arrayBuffer(),w=await pdfExports.getDocument({data:x}).promise,R=[];for(let F=1;F<=w.numPages;F++){const z=await(await w.getPage(F)).getTextContent();R.push(...z.items)}const N=d(R);if(N.length===0)throw new Error("No se encontraron tarifas. Usa un PDF de GLS 2025.");c(N);const A=[["Servicio","Zona","Peso","Recogida","Arrastre","Entrega","Salidas","Recogidas","Interciudad"],...N.map(F=>Object.values(F))],I=utils.aoa_to_sheet(A);I["!cols"]=Array(9).fill({wch:14});const y=utils.book_new();utils.book_append_sheet(y,I,"Tarifas");const j=writeSync(y,{bookType:"xlsx",type:"array"}),T=new Blob([j],{type:"application/octet-stream"}),U=URL.createObjectURL(T);s(U)}catch(x){i(x instanceof Error?x.message:"Error al procesar el PDF")}finally{r(!1)}};return jsxRuntimeExports.jsxs("div",{className:"p-6 bg-white rounded-lg border border-gray-200",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[jsxRuntimeExports.jsx(FileSpreadsheet,{className:"w-6 h-6 text-green-600"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"PDF to Excel"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600",children:"Sin errores, sin warnings, 100% local"})]})]}),jsxRuntimeExports.jsx("input",{type:"file",accept:".pdf",onChange:_,disabled:t,className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 disabled:opacity-50"}),t&&jsxRuntimeExports.jsxs("div",{className:"mt-4 p-4 bg-blue-50 rounded-lg flex items-center gap-3",children:[jsxRuntimeExports.jsx(Loader2,{className:"w-5 h-5 animate-spin text-blue-600"}),jsxRuntimeExports.jsx("p",{className:"text-sm",children:"Procesando PDF..."})]}),a&&jsxRuntimeExports.jsxs("div",{className:"mt-4 p-4 bg-red-50 rounded-lg flex items-start gap-3",children:[jsxRuntimeExports.jsx(AlertCircle,{className:"w-5 h-5 text-red-600 mt-0.5"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-red-700",children:a})]}),e&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:"mt-4 p-4 bg-green-50 rounded-lg flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx(CheckCircle2,{className:"w-5 h-5 text-green-600"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("p",{className:"text-sm font-medium text-green-900",children:["¡Listo! ",o.length," filas"]}),jsxRuntimeExports.jsxs("button",{onClick:()=>u(!h),className:"text-xs text-green-700 underline",children:[h?"Ocultar":"Ver"," vista previa"]})]})]}),jsxRuntimeExports.jsxs("a",{href:e,download:"tarifas_gls.xlsx",className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white text-sm font-medium rounded-md hover:bg-green-700",children:[jsxRuntimeExports.jsx(Download,{className:"w-4 h-4"}),"Descargar"]})]}),h&&jsxRuntimeExports.jsx("div",{className:"mt-4 max-h-64 overflow-auto border rounded",children:jsxRuntimeExports.jsxs("table",{className:"w-full text-xs",children:[jsxRuntimeExports.jsx("thead",{className:"bg-gray-100 sticky top-0",children:jsxRuntimeExports.jsx("tr",{children:["Servicio","Zona","Peso","Rec","Arr","Ent","Sal","Recog","Int"].map(b=>jsxRuntimeExports.jsx("th",{className:"px-2 py-1 text-left font-medium",children:b},b))})}),jsxRuntimeExports.jsx("tbody",{children:o.slice(0,20).map((b,v)=>jsxRuntimeExports.jsxs("tr",{className:"border-t",children:[jsxRuntimeExports.jsx("td",{className:"px-2 py-1",children:b.servicio}),jsxRuntimeExports.jsx("td",{className:"px-2 py-1",children:b.zona}),jsxRuntimeExports.jsx("td",{className:"px-2 py-1",children:b.peso}),jsxRuntimeExports.jsx("td",{className:"px-2 py-1",children:b.recogida}),jsxRuntimeExports.jsx("td",{className:"px-2 py-1",children:b.arrastre}),jsxRuntimeExports.jsx("td",{className:"px-2 py-1",children:b.entrega}),jsxRuntimeExports.jsx("td",{className:"px-2 py-1",children:b.salidas}),jsxRuntimeExports.jsx("td",{className:"px-2 py-1",children:b.recogidas}),jsxRuntimeExports.jsx("td",{className:"px-2 py-1",children:b.interciudad})]},v))})]})})]})]})}function UserSettingsPanel({onClose:t}){const{userData:r}=useAuth(),[e,s]=reactExports.useState("preferences"),[a,i]=reactExports.useState(!1),o=[{id:"preferences",label:"Preferencias",icon:Settings},{id:"profile",label:"Perfil",icon:User},{id:"subscription",label:"Suscripción",icon:CreditCard},{id:"pdf-converter",label:"PDF a Excel",icon:FileSpreadsheet}];return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Configuración"}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[r==null?void 0:r.full_name," • ",r==null?void 0:r.role]})]}),jsxRuntimeExports.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:jsxRuntimeExports.jsx(X,{className:"h-6 w-6 text-gray-500"})})]}),!a&&jsxRuntimeExports.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[jsxRuntimeExports.jsxs("div",{className:"w-64 border-r border-gray-200 p-4 space-y-1",children:[o.map(c=>{const h=c.icon;return jsxRuntimeExports.jsxs("button",{onClick:()=>s(c.id),className:`w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition-colors ${e===c.id?"bg-blue-50 text-blue-700":"text-gray-700 hover:bg-gray-50"}`,children:[jsxRuntimeExports.jsx(h,{className:"h-5 w-5"}),jsxRuntimeExports.jsx("span",{className:"font-medium",children:c.label})]},c.id)}),jsxRuntimeExports.jsxs("button",{onClick:()=>i(!0),className:"w-full flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:[jsxRuntimeExports.jsx(Settings,{className:"h-5 w-5"}),jsxRuntimeExports.jsx("span",{className:"font-medium",children:"Tabla de Costes Personalizada"})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[e==="preferences"&&jsxRuntimeExports.jsx(PreferencesTab,{}),e==="profile"&&jsxRuntimeExports.jsx(ProfileTab,{}),e==="subscription"&&jsxRuntimeExports.jsx(SubscriptionTab,{}),e==="pdf-converter"&&jsxRuntimeExports.jsx(PdfToExcelConverter,{})]})]}),a&&jsxRuntimeExports.jsx(CustomTariffsEditor,{onClose:()=>i(!1)})]})})}function AdminPanel(){const[t,r]=reactExports.useState("users"),[e,s]=reactExports.useState([]),[a,i]=reactExports.useState([]),[o,c]=reactExports.useState(!1),[h,u]=reactExports.useState(null),[d,_]=reactExports.useState(""),[b,v]=reactExports.useState(1),[E,x]=reactExports.useState(30),[g,w]=reactExports.useState(""),[R,N]=reactExports.useState(""),[M,A]=reactExports.useState(1),[I,y]=reactExports.useState(30),[j,T]=reactExports.useState(null);reactExports.useEffect(()=>{t==="users"?U():t==="promo-codes"&&F()},[t]);async function U(){c(!0);try{const{data:Z,error:ge}=await supabase.from("user_profiles").select("*").order("created_at",{ascending:!1});if(ge)throw ge;s(Z||[])}catch(Z){se("error",Z.message)}finally{c(!1)}}async function F(){c(!0);try{const{data:Z,error:ge}=await supabase.from("promotional_codes").select("*").order("created_at",{ascending:!1});if(ge)throw ge;i(Z||[])}catch(Z){se("error",Z.message)}finally{c(!1)}}async function H(){if(!d||!d.includes("@")){se("error","Email inválido");return}c(!0);try{const Z=localStorage.getItem("user_session");if(!Z)throw new Error("No hay sesión activa");const{sessionToken:ge}=JSON.parse(Z),re=await fetch("https://eyvhuoldrjfntkffpkfm.supabase.co/functions/v1/admin-create-user",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${ge}`},body:JSON.stringify({email:d.toLowerCase().trim(),tier:b,durationDays:E})}),oe=await re.json();if(!re.ok)throw new Error(oe.error||"Error al crear usuario");se("success",`Usuario ${d} creado correctamente`),_(""),v(1),x(30),U()}catch(Z){se("error",Z.message)}finally{c(!1)}}async function z(){if(!g||g.length<4){se("error","El código debe tener al menos 4 caracteres");return}if(!R){se("error","La descripción es obligatoria");return}c(!0);try{const{data:Z}=await supabase.auth.getUser();if(!Z.user)throw new Error("No autenticado");const{error:ge}=await supabase.from("promotional_codes").insert({code:g.toUpperCase().trim(),description:R,tier:M,duration_days:I,max_uses:j,is_active:!0,created_by:Z.user.id});if(ge)throw ge;se("success",`Código promocional ${g} creado`),w(""),N(""),A(1),y(30),T(null),F()}catch(Z){se("error",Z.message)}finally{c(!1)}}async function de(Z,ge){c(!0);try{const{error:re}=await supabase.from("promotional_codes").update({is_active:!ge}).eq("id",Z);if(re)throw re;se("success",`Código ${ge?"desactivado":"activado"}`),F()}catch(re){se("error",re.message)}finally{c(!1)}}function se(Z,ge){u({type:Z,text:ge}),setTimeout(()=>u(null),5e3)}function ue(Z){return["Básico","Pro","Business","Enterprise","Unlimited"][Z-1]||"Desconocido"}return jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200",children:[h&&jsxRuntimeExports.jsx("div",{className:`p-4 mb-4 rounded-lg ${h.type==="success"?"bg-green-50 text-green-800":"bg-red-50 text-red-800"}`,children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(AlertCircle,{className:"h-5 w-5"}),jsxRuntimeExports.jsx("span",{children:h.text})]})}),jsxRuntimeExports.jsx("div",{className:"border-b border-gray-200",children:jsxRuntimeExports.jsxs("nav",{className:"flex -mb-px",children:[jsxRuntimeExports.jsx("button",{onClick:()=>r("users"),className:`px-6 py-4 text-sm font-medium border-b-2 transition-colors ${t==="users"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(Users,{className:"h-4 w-4"}),"Usuarios"]})}),jsxRuntimeExports.jsx("button",{onClick:()=>r("create-user"),className:`px-6 py-4 text-sm font-medium border-b-2 transition-colors ${t==="create-user"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(UserPlus,{className:"h-4 w-4"}),"Crear Usuario"]})}),jsxRuntimeExports.jsx("button",{onClick:()=>r("promo-codes"),className:`px-6 py-4 text-sm font-medium border-b-2 transition-colors ${t==="promo-codes"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(Gift,{className:"h-4 w-4"}),"Códigos Promo"]})})]})}),jsxRuntimeExports.jsxs("div",{className:"p-6",children:[t==="users"&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Usuarios Registrados"}),o?jsxRuntimeExports.jsx("p",{className:"text-gray-500",children:"Cargando..."}):e.length===0?jsxRuntimeExports.jsx("p",{className:"text-gray-500",children:"No hay usuarios registrados"}):jsxRuntimeExports.jsx("div",{className:"overflow-x-auto",children:jsxRuntimeExports.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[jsxRuntimeExports.jsx("thead",{className:"bg-gray-50",children:jsxRuntimeExports.jsxs("tr",{children:[jsxRuntimeExports.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Email"}),jsxRuntimeExports.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Tier"}),jsxRuntimeExports.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Dispositivos"}),jsxRuntimeExports.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Estado"}),jsxRuntimeExports.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Expira"}),jsxRuntimeExports.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Pago"})]})}),jsxRuntimeExports.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:e.map(Z=>jsxRuntimeExports.jsxs("tr",{className:"hover:bg-gray-50",children:[jsxRuntimeExports.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:Z.email}),jsxRuntimeExports.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:ue(Z.subscription_tier)}),jsxRuntimeExports.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:Z.max_devices}),jsxRuntimeExports.jsx("td",{className:"px-4 py-3 text-sm",children:jsxRuntimeExports.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${Z.subscription_status==="active"?"bg-green-100 text-green-800":Z.subscription_status==="trial"?"bg-blue-100 text-blue-800":"bg-red-100 text-red-800"}`,children:Z.subscription_status})}),jsxRuntimeExports.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:new Date(Z.subscription_end_date).toLocaleDateString()}),jsxRuntimeExports.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:Z.payment_method||"-"})]},Z.id))})]})})]}),t==="create-user"&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h2",{className:"text-xl font-semibold mb-6",children:"Crear Usuario Manualmente"}),jsxRuntimeExports.jsxs("div",{className:"max-w-md space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[jsxRuntimeExports.jsx(Mail,{className:"inline h-4 w-4 mr-1"}),"Email"]}),jsxRuntimeExports.jsx("input",{type:"email",value:d,onChange:Z=>_(Z.target.value),placeholder:"usuario@gls-spain.es",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[jsxRuntimeExports.jsx(CreditCard,{className:"inline h-4 w-4 mr-1"}),"Tier de Suscripción"]}),jsxRuntimeExports.jsxs("select",{value:b,onChange:Z=>v(parseInt(Z.target.value)),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[jsxRuntimeExports.jsx("option",{value:1,children:"Básico (1 dispositivo)"}),jsxRuntimeExports.jsx("option",{value:2,children:"Pro (3 dispositivos)"}),jsxRuntimeExports.jsx("option",{value:3,children:"Business (5 dispositivos)"}),jsxRuntimeExports.jsx("option",{value:4,children:"Enterprise (8 dispositivos)"}),jsxRuntimeExports.jsx("option",{value:5,children:"Unlimited (12 dispositivos)"})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[jsxRuntimeExports.jsx(Calendar,{className:"inline h-4 w-4 mr-1"}),"Duración (días)"]}),jsxRuntimeExports.jsx("input",{type:"number",value:E,onChange:Z=>x(parseInt(Z.target.value)),min:"1",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),jsxRuntimeExports.jsx("button",{onClick:H,disabled:o,className:"w-full px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:o?"Creando...":"Crear Usuario"})]})]}),t==="promo-codes"&&jsxRuntimeExports.jsxs("div",{className:"space-y-8",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h2",{className:"text-xl font-semibold mb-6",children:"Crear Código Promocional"}),jsxRuntimeExports.jsxs("div",{className:"max-w-md space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Código"}),jsxRuntimeExports.jsx("input",{type:"text",value:g,onChange:Z=>w(Z.target.value.toUpperCase()),placeholder:"GLS2025FREE",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Descripción"}),jsxRuntimeExports.jsx("input",{type:"text",value:R,onChange:Z=>N(Z.target.value),placeholder:"Acceso gratuito 30 días",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tier"}),jsxRuntimeExports.jsxs("select",{value:M,onChange:Z=>A(parseInt(Z.target.value)),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[jsxRuntimeExports.jsx("option",{value:1,children:"Básico (1 dispositivo)"}),jsxRuntimeExports.jsx("option",{value:2,children:"Pro (3 dispositivos)"}),jsxRuntimeExports.jsx("option",{value:3,children:"Business (5 dispositivos)"}),jsxRuntimeExports.jsx("option",{value:4,children:"Enterprise (8 dispositivos)"}),jsxRuntimeExports.jsx("option",{value:5,children:"Unlimited (12 dispositivos)"})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Duración (días)"}),jsxRuntimeExports.jsx("input",{type:"number",value:I,onChange:Z=>y(parseInt(Z.target.value)),min:"1",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Máximo de usos (vacío = ilimitado)"}),jsxRuntimeExports.jsx("input",{type:"number",value:j||"",onChange:Z=>T(Z.target.value?parseInt(Z.target.value):null),min:"1",placeholder:"Ilimitado",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),jsxRuntimeExports.jsx("button",{onClick:z,disabled:o,className:"w-full px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:o?"Creando...":"Crear Código Promocional"})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Códigos Promocionales Existentes"}),o?jsxRuntimeExports.jsx("p",{className:"text-gray-500",children:"Cargando..."}):a.length===0?jsxRuntimeExports.jsx("p",{className:"text-gray-500",children:"No hay códigos promocionales"}):jsxRuntimeExports.jsx("div",{className:"overflow-x-auto",children:jsxRuntimeExports.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[jsxRuntimeExports.jsx("thead",{className:"bg-gray-50",children:jsxRuntimeExports.jsxs("tr",{children:[jsxRuntimeExports.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Código"}),jsxRuntimeExports.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Descripción"}),jsxRuntimeExports.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Tier"}),jsxRuntimeExports.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Días"}),jsxRuntimeExports.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Usos"}),jsxRuntimeExports.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Estado"}),jsxRuntimeExports.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Acciones"})]})}),jsxRuntimeExports.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:a.map(Z=>jsxRuntimeExports.jsxs("tr",{className:"hover:bg-gray-50",children:[jsxRuntimeExports.jsx("td",{className:"px-4 py-3 text-sm font-mono font-semibold text-gray-900",children:Z.code}),jsxRuntimeExports.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:Z.description}),jsxRuntimeExports.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:ue(Z.tier)}),jsxRuntimeExports.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:Z.duration_days}),jsxRuntimeExports.jsxs("td",{className:"px-4 py-3 text-sm text-gray-900",children:[Z.current_uses," / ",Z.max_uses||"∞"]}),jsxRuntimeExports.jsx("td",{className:"px-4 py-3 text-sm",children:jsxRuntimeExports.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${Z.is_active?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:Z.is_active?"Activo":"Inactivo"})}),jsxRuntimeExports.jsx("td",{className:"px-4 py-3 text-sm",children:jsxRuntimeExports.jsx("button",{onClick:()=>de(Z.id,Z.is_active),disabled:o,className:"text-blue-600 hover:text-blue-800 disabled:opacity-50",children:Z.is_active?"Desactivar":"Activar"})})]},Z.id))})]})})]})]})]})]})}function useCommercialPlans(){const{user:t}=useAuth(),[r,e]=reactExports.useState([]),[s,a]=reactExports.useState(!1),[i,o]=reactExports.useState(null),c=reactExports.useCallback(async()=>{if(!t){e([]);return}a(!0),o(null);try{const{data:_,error:b}=await supabase.from("custom_commercial_plans").select("*").eq("user_id",t.id).order("created_at",{ascending:!1});if(b)throw b;e(_||[])}catch(_){console.error("Error loading commercial plans:",_),o(_ instanceof Error?_.message:"Error al cargar planes comerciales")}finally{a(!1)}},[t]);reactExports.useEffect(()=>{c()},[c]);const h=reactExports.useCallback(async(_,b)=>{if(!t)throw new Error("Usuario no autenticado");a(!0),o(null);try{const{data:v,error:E}=await supabase.from("custom_commercial_plans").insert({user_id:t.id,plan_name:_,discounts:b}).select().single();if(E)throw E;return await c(),v}catch(v){console.error("Error creating commercial plan:",v);const E=v instanceof Error?v.message:"Error al crear plan comercial";throw o(E),new Error(E)}finally{a(!1)}},[t,c]),u=reactExports.useCallback(async(_,b,v)=>{if(!t)throw new Error("Usuario no autenticado");a(!0),o(null);try{const{data:E,error:x}=await supabase.from("custom_commercial_plans").update({plan_name:b,discounts:v}).eq("id",_).eq("user_id",t.id).select().single();if(x)throw x;return await c(),E}catch(E){console.error("Error updating commercial plan:",E);const x=E instanceof Error?E.message:"Error al actualizar plan comercial";throw o(x),new Error(x)}finally{a(!1)}},[t,c]),d=reactExports.useCallback(async _=>{if(!t)throw new Error("Usuario no autenticado");a(!0),o(null);try{const{error:b}=await supabase.from("custom_commercial_plans").delete().eq("id",_).eq("user_id",t.id);if(b)throw b;await c()}catch(b){console.error("Error deleting commercial plan:",b);const v=b instanceof Error?b.message:"Error al eliminar plan comercial";throw o(v),new Error(v)}finally{a(!1)}},[t,c]);return{plans:r,loading:s,error:i,loadPlans:c,createPlan:h,updatePlan:u,deletePlan:d}}const DOMESTIC_SERVICES=["Express8:30","Express10:30","Express14:00","Express19:00","BusinessParcel","EconomyParcel"],DOMESTIC_WEIGHT_RANGES=["1kg","3kg","5kg","10kg","15kg","additional"],INTERNATIONAL_WEIGHT_RANGES=["under15kg","15kg","additional"],EMPTY_PLAN_DISCOUNTS={domestic:{"Express8:30":{"1kg":0,"3kg":0,"5kg":0,"10kg":0,"15kg":0,additional:0},"Express10:30":{"1kg":0,"3kg":0,"5kg":0,"10kg":0,"15kg":0,additional:0},"Express14:00":{"1kg":0,"3kg":0,"5kg":0,"10kg":0,"15kg":0,additional:0},"Express19:00":{"1kg":0,"3kg":0,"5kg":0,"10kg":0,"15kg":0,additional:0},BusinessParcel:{"1kg":0,"3kg":0,"5kg":0,"10kg":0,"15kg":0,additional:0},EconomyParcel:{"1kg":0,"3kg":0,"5kg":0,"10kg":0,"15kg":0,additional:0}},international:{EuroBusinessParcel:{under15kg:0,"15kg":0,additional:0}}},SERVICE_DISPLAY_NAMES={"Express8:30":"Express 8:30","Express10:30":"Express 10:30","Express14:00":"Express 14:00","Express19:00":"Express 19:00",BusinessParcel:"Business Parcel",EconomyParcel:"Economy Parcel",EuroBusinessParcel:"Euro Business Parcel"},WEIGHT_RANGE_DISPLAY_NAMES={"1kg":"1 kg","3kg":"3 kg","5kg":"5 kg","10kg":"10 kg","15kg":"15 kg",additional:"kg adic.",under15kg:"< 15 kg"};function CommercialPlansManager({onClose:t,onPlanSelected:r}){const{plans:e,loading:s,error:a,createPlan:i,updatePlan:o,deletePlan:c}=useCommercialPlans(),[h,u]=reactExports.useState(null),[d,_]=reactExports.useState(null),[b,v]=reactExports.useState(""),[E,x]=reactExports.useState(JSON.parse(JSON.stringify(EMPTY_PLAN_DISCOUNTS))),[g,w]=reactExports.useState(!1),[R,N]=reactExports.useState(null),M=()=>{u(null),_(null),v(""),x(JSON.parse(JSON.stringify(EMPTY_PLAN_DISCOUNTS))),N(null)},A=()=>{M(),u("create")},I=z=>{u("edit"),_(z.id),v(z.plan_name),x(JSON.parse(JSON.stringify(z.discounts))),N(null)},y=async z=>{if(confirm("¿Estás seguro de que deseas eliminar este plan comercial? Esta acción no se puede deshacer."))try{await c(z),r&&r(null)}catch(de){alert("Error al eliminar el plan: "+(de instanceof Error?de.message:"Error desconocido"))}},j=(z,de,se)=>{const ue=se===""?0:parseFloat(se);isNaN(ue)||ue<0||ue>100||x(Z=>({...Z,domestic:{...Z.domestic,[z]:{...Z.domestic[z],[de]:ue}}}))},T=(z,de)=>{const se=de===""?0:parseFloat(de);isNaN(se)||se<0||se>100||x(ue=>({...ue,international:{EuroBusinessParcel:{...ue.international.EuroBusinessParcel,[z]:se}}}))},U=(z,de)=>{x(se=>({...se,domestic:{...se.domestic,[de]:{...se.domestic[z]}}}))},F=()=>b.trim()?b.length>100?(N("El nombre del plan no puede superar 100 caracteres"),!1):e.some(de=>de.plan_name.toLowerCase()===b.toLowerCase()&&de.id!==d)?(N("Ya existe un plan con este nombre"),!1):(N(null),!0):(N("El nombre del plan es obligatorio"),!1),H=async()=>{if(F()){w(!0);try{if(h==="create"){const z=await i(b,E);r&&z&&r(z)}else if(h==="edit"&&d){const z=await o(d,b,E);r&&z&&r(z)}M()}catch(z){alert("Error al guardar el plan: "+(z instanceof Error?z.message:"Error desconocido"))}finally{w(!1)}}};return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-6xl max-h-[90vh] overflow-hidden flex flex-col",children:[jsxRuntimeExports.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 text-white p-6 flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold",children:"Gestión de Planes Comerciales"}),jsxRuntimeExports.jsx("p",{className:"text-blue-100 text-sm mt-1",children:"Crea, modifica o elimina tus planes personalizados"})]}),jsxRuntimeExports.jsx("button",{onClick:t,className:"p-2 hover:bg-blue-500 rounded-lg transition-colors","aria-label":"Cerrar",children:jsxRuntimeExports.jsx(X,{size:24})})]}),jsxRuntimeExports.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[a&&jsxRuntimeExports.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-4",children:a}),!h&&jsxRuntimeExports.jsxs("div",{className:"mb-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-4",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Planes Existentes"}),jsxRuntimeExports.jsxs("button",{onClick:A,className:"flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors",disabled:s,children:[jsxRuntimeExports.jsx(Plus,{size:18}),"Crear Nuevo Plan"]})]}),s?jsxRuntimeExports.jsx("div",{className:"text-center py-8 text-gray-500",children:"Cargando planes..."}):e.length===0?jsxRuntimeExports.jsx("div",{className:"text-center py-8 text-gray-500 bg-gray-50 rounded-lg",children:"No tienes planes personalizados. Crea uno nuevo para empezar."}):jsxRuntimeExports.jsx("div",{className:"grid gap-3",children:e.map(z=>jsxRuntimeExports.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("h4",{className:"font-semibold text-gray-800",children:z.plan_name}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Creado: ",new Date(z.created_at).toLocaleDateString("es-ES"),z.updated_at!==z.created_at&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[" • Actualizado: ",new Date(z.updated_at).toLocaleDateString("es-ES")]})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("button",{onClick:()=>I(z),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Editar plan",children:jsxRuntimeExports.jsx(Pen,{size:18})}),jsxRuntimeExports.jsx("button",{onClick:()=>y(z.id),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Eliminar plan",children:jsxRuntimeExports.jsx(Trash2,{size:18})})]})]})},z.id))})]}),h&&jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsxs("div",{className:"mb-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-4",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:h==="create"?"Crear Nuevo Plan":"Editar Plan"}),jsxRuntimeExports.jsx("button",{onClick:M,className:"text-gray-600 hover:text-gray-800 transition-colors",children:"Cancelar"})]}),jsxRuntimeExports.jsxs("div",{className:"mb-6",children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nombre del Plan *"}),jsxRuntimeExports.jsx("input",{type:"text",value:b,onChange:z=>v(z.target.value),placeholder:"Ej: Plan Q1 2025, Plan Cliente Premium...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",maxLength:100}),R&&jsxRuntimeExports.jsx("p",{className:"text-red-600 text-sm mt-1",children:R})]}),jsxRuntimeExports.jsxs("div",{className:"mb-6",children:[jsxRuntimeExports.jsxs("h4",{className:"font-semibold text-gray-800 mb-3 flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:"bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm",children:"Doméstico"}),jsxRuntimeExports.jsx("span",{className:"text-sm text-gray-500",children:"Provincial, regional y península (excluye intercity)"})]}),jsxRuntimeExports.jsx("div",{className:"overflow-x-auto",children:jsxRuntimeExports.jsxs("table",{className:"w-full border-collapse",children:[jsxRuntimeExports.jsx("thead",{children:jsxRuntimeExports.jsxs("tr",{className:"bg-gray-50",children:[jsxRuntimeExports.jsx("th",{className:"border border-gray-300 px-3 py-2 text-left text-sm font-semibold",children:"Servicio"}),DOMESTIC_WEIGHT_RANGES.map(z=>jsxRuntimeExports.jsx("th",{className:"border border-gray-300 px-3 py-2 text-center text-sm font-semibold",children:WEIGHT_RANGE_DISPLAY_NAMES[z]},z)),jsxRuntimeExports.jsx("th",{className:"border border-gray-300 px-3 py-2 text-center text-sm font-semibold w-16",children:"Acción"})]})}),jsxRuntimeExports.jsx("tbody",{children:DOMESTIC_SERVICES.map((z,de)=>jsxRuntimeExports.jsxs("tr",{className:de%2===0?"bg-white":"bg-gray-50",children:[jsxRuntimeExports.jsx("td",{className:"border border-gray-300 px-3 py-2 font-medium text-sm",children:SERVICE_DISPLAY_NAMES[z]}),DOMESTIC_WEIGHT_RANGES.map(se=>jsxRuntimeExports.jsx("td",{className:"border border-gray-300 px-1 py-1",children:jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("input",{type:"number",min:"0",max:"100",step:"0.1",value:E.domestic[z][se]||"",onChange:ue=>j(z,se,ue.target.value),className:"w-full px-2 py-1 pr-6 text-center border border-gray-200 rounded focus:ring-1 focus:ring-blue-500 focus:border-transparent text-sm",placeholder:"0"}),jsxRuntimeExports.jsx("span",{className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-500 text-xs pointer-events-none",children:"%"})]})},se)),jsxRuntimeExports.jsx("td",{className:"border border-gray-300 px-1 py-1 text-center",children:de>0&&jsxRuntimeExports.jsx("button",{onClick:()=>U(DOMESTIC_SERVICES[de-1],z),className:"p-1 text-blue-600 hover:bg-blue-50 rounded transition-colors",title:"Copiar fila anterior",children:jsxRuntimeExports.jsx(Copy,{size:14})})})]},z))})]})})]}),jsxRuntimeExports.jsxs("div",{className:"mb-6",children:[jsxRuntimeExports.jsxs("h4",{className:"font-semibold text-gray-800 mb-3 flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:"bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm",children:"Internacional"}),jsxRuntimeExports.jsx("span",{className:"text-sm text-gray-500",children:"Aplica únicamente a Portugal"})]}),jsxRuntimeExports.jsx("div",{className:"overflow-x-auto",children:jsxRuntimeExports.jsxs("table",{className:"w-full border-collapse",children:[jsxRuntimeExports.jsx("thead",{children:jsxRuntimeExports.jsxs("tr",{className:"bg-gray-50",children:[jsxRuntimeExports.jsx("th",{className:"border border-gray-300 px-3 py-2 text-left text-sm font-semibold",children:"Servicio"}),INTERNATIONAL_WEIGHT_RANGES.map(z=>jsxRuntimeExports.jsx("th",{className:"border border-gray-300 px-3 py-2 text-center text-sm font-semibold",children:WEIGHT_RANGE_DISPLAY_NAMES[z]},z))]})}),jsxRuntimeExports.jsx("tbody",{children:jsxRuntimeExports.jsxs("tr",{className:"bg-white",children:[jsxRuntimeExports.jsx("td",{className:"border border-gray-300 px-3 py-2 font-medium text-sm",children:SERVICE_DISPLAY_NAMES.EuroBusinessParcel}),INTERNATIONAL_WEIGHT_RANGES.map(z=>jsxRuntimeExports.jsx("td",{className:"border border-gray-300 px-1 py-1",children:jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("input",{type:"number",min:"0",max:"100",step:"0.1",value:E.international.EuroBusinessParcel[z]||"",onChange:de=>T(z,de.target.value),className:"w-full px-2 py-1 pr-6 text-center border border-gray-200 rounded focus:ring-1 focus:ring-blue-500 focus:border-transparent text-sm",placeholder:"0"}),jsxRuntimeExports.jsx("span",{className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-500 text-xs pointer-events-none",children:"%"})]})},z))]})})]})}),jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"* Valores vacíos se consideran 0%. Los descuentos se aplican sobre la tarifa base."})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-end gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:M,className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",disabled:g,children:"Cancelar"}),jsxRuntimeExports.jsxs("button",{onClick:H,disabled:g||!b.trim(),className:"flex items-center gap-2 bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[jsxRuntimeExports.jsx(Save,{size:18}),g?"Guardando...":"Guardar Plan"]})]})]})})]})]})})}const SERVICE_NAME_MAP={"Urg8:30H Courier":"Express8:30","Urg10H Courier":"Express10:30","Urg14H Courier":"Express14:00","Urg19H Courier":"Express19:00","Business Parcel":"BusinessParcel","Economy Parcel":"EconomyParcel"};function getCustomPlanDiscountForWeight(t,r,e){if(!t)return 0;const s=SERVICE_NAME_MAP[r];if(!s)return 0;const a=t.discounts.domestic[s];if(!a)return 0;let i;return e<=1?i="1kg":e<=3?i="3kg":e<=5?i="5kg":e<=10?i="10kg":e<=15?i="15kg":i="additional",a[i]||0}function getCustomPlanDiscountForInternational(t,r,e){if(!t||r!=="EuroBusiness Parcel")return 0;const s=t.discounts.international.EuroBusinessParcel;if(!s)return 0;let a;return e<15?a="under15kg":e===15?a="15kg":a="additional",s[a]||0}const ALLOWED_ZONES_FOR_DISCOUNT=new Set(["Provincial","Regional","Nacional"]),ARR_FIELD_MAP={Provincial:"provincial_arr",Regional:"regional_arr",Nacional:"nacional_arr",Portugal:"portugal_arr"};function getTariffNumericValue(t,r){const e=t[r];return typeof e=="number"&&Number.isFinite(e)?e:null}function roundUp(t){return!Number.isFinite(t)||t<=0?0:Math.ceil(t*100-1e-9)/100}function calculateCustomPlanDiscount(t,r,e,s,a,i){if(!r||i==="interciudad")return 0;const o=e==="EuroBusiness Parcel",c=s==="Portugal";if(c&&!o||!c&&!ALLOWED_ZONES_FOR_DISCOUNT.has(s))return 0;const h=ARR_FIELD_MAP[s];if(!h)return 0;let u;if(o&&c?u=getCustomPlanDiscountForInternational(r,e,a):u=getCustomPlanDiscountForWeight(r,e,a),u===0)return 0;const d=Math.ceil(a);if(d<=0)return 0;const _=[...t].filter(g=>g.service_name===e).sort((g,w)=>g.weight_from-w.weight_from);if(!_.length)return 0;const b=_.find(g=>g.weight_from<=d&&(g.weight_to===null||g.weight_to===void 0||g.weight_to>=d)&&g.weight_from!==999);if(!b)return 0;const v=getTariffNumericValue(b,h);if(!v||!Number.isFinite(v))return 0;const E=v*(u/100),x=b.weight_to??b.weight_from;if(d>x){const g=_.find(w=>w.weight_from===999);if(g){const w=getTariffNumericValue(g,h);if(w&&Number.isFinite(w)){const R=d-x,N=Math.ceil(R),M=w*(u/100)*N;return roundUp(E+M)}}}return roundUp(E)}function getCustomPlanDisplayInfo(t){return t?{name:t.plan_name,description:"Plan comercial personalizado"}:{name:"Sin plan personalizado",description:"No hay plan personalizado aplicado"}}function PackageManager({packages:t,onChange:r,selectedService:e,onClearPackages:s}){const a=React.useCallback(v=>{typeof r=="function"&&r(v)},[r]),i=()=>{const v={id:Date.now().toString(),weight:1,finalWeight:1,quantity:1,dimensions:{height:10,width:10,length:10}};a([...t,v])},o=v=>{t.length>1&&a(t.filter(E=>E.id!==v))},c=(v,E)=>{a(t.map(x=>{if(x.id!==v)return x;const g=x.volumetricWeight?Math.max(E,x.volumetricWeight):E;return{...x,weight:E,finalWeight:g}}))},h=(v,E)=>{const x=e?getConversionFactorForService(e):167,g=calculateVolumetricWeight(E.height,E.width,E.length,x);a(t.map(w=>w.id===v?{...w,dimensions:E,volumetricWeight:g,finalWeight:Math.max(w.weight,g)}:w))},u=(v,E)=>{const x=Math.max(1,Math.round(Number.isFinite(E)?E:1));a(t.map(g=>g.id===v?{...g,quantity:x}:g))},d=t.reduce((v,E)=>v+Math.max(1,Math.round(E.quantity??1)),0),_=t.reduce((v,E)=>v+E.weight*Math.max(1,Math.round(E.quantity??1)),0),b=t.reduce((v,E)=>v+(E.finalWeight||E.weight)*Math.max(1,Math.round(E.quantity??1)),0);return jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 lg:p-8",children:[jsxRuntimeExports.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-start md:justify-between",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center text-xl font-semibold text-gray-900",children:[jsxRuntimeExports.jsx(Package,{className:"h-5 w-5 mr-2 text-blue-600"}),"Gestión de Bultos"]}),jsxRuntimeExports.jsx("p",{className:"mt-2 text-sm text-gray-600 md:mt-1 md:ml-7",children:"La tabla de costes se actualizará automáticamente al indicar pesos, medidas y ajustes necesarios."})]}),jsxRuntimeExports.jsxs("div",{className:"flex flex-wrap gap-2",children:[jsxRuntimeExports.jsxs("button",{onClick:i,type:"button",className:"flex items-center px-4 py-2 text-sm bg-blue-600 text-white rounded-lg shadow-sm hover:bg-blue-700 transition-colors",children:[jsxRuntimeExports.jsx(Plus,{className:"h-4 w-4 mr-1"}),"Añadir"]}),t.length>1&&jsxRuntimeExports.jsx("button",{onClick:s,type:"button",className:"flex items-center px-4 py-2 text-sm bg-gray-100 text-gray-700 rounded-lg shadow-sm hover:bg-gray-200 transition-colors",children:"Limpiar bultos"})]})]}),t.length===1&&jsxRuntimeExports.jsxs("div",{className:"mt-4 mb-4 p-3 bg-blue-50 rounded-lg",children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-blue-900 mb-2",children:"Bultos idénticos (atajo rápido)"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-2",children:[jsxRuntimeExports.jsx("input",{type:"number",min:"1",max:"100",step:"1",value:t[0].quantity??1,onChange:v=>u(t[0].id,Number(v.target.value)),className:"w-20 px-2 py-1 text-sm border border-blue-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),jsxRuntimeExports.jsxs("span",{className:"text-sm text-blue-700",children:["bultos de ",t[0].weight," kg",t[0].dimensions&&jsxRuntimeExports.jsxs("span",{children:[" ","(",t[0].dimensions.height,"×",t[0].dimensions.width,"×",t[0].dimensions.length," cm)"]})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-6",children:[jsxRuntimeExports.jsx("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-3",children:t.map((v,E)=>{var g,w,R;const x=Math.max(1,Math.round(v.quantity??1));return jsxRuntimeExports.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 flex flex-col h-full",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-3",children:[jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>{t.length>1&&o(v.id)},disabled:t.length<=1,className:`text-sm font-medium text-left ${t.length>1?"text-gray-900 hover:text-red-600 focus:outline-none focus-visible:ring-2 focus-visible:ring-red-200 rounded":"text-gray-900 cursor-default"}`,title:t.length>1?"Pulsa para eliminar este bulto":void 0,children:jsxRuntimeExports.jsxs("span",{className:"flex items-center",children:[jsxRuntimeExports.jsxs("span",{children:["Bulto ",E+1]}),x>1&&jsxRuntimeExports.jsxs("span",{className:"ml-2 text-xs font-semibold text-blue-600",children:["×",x]}),t.length>1&&jsxRuntimeExports.jsx("span",{className:"ml-2 text-[11px] font-normal text-red-500",children:"(pulsa para eliminar)"})]})}),t.length>1&&jsxRuntimeExports.jsx("button",{type:"button",onClick:N=>{N.stopPropagation(),o(v.id)},className:"text-red-600 hover:text-red-800 p-1",title:"Eliminar bulto",children:jsxRuntimeExports.jsx(Minus,{className:"h-4 w-4"})})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-4 flex-1",children:[jsxRuntimeExports.jsxs("div",{className:"flex flex-wrap items-end gap-3",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Peso real (kg)"}),jsxRuntimeExports.jsx("input",{type:"number",value:v.weight,onChange:N=>c(v.id,Number(N.target.value)),min:"0.1",max:"1000",step:"0.1",className:"w-20 px-2 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Peso"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Cantidad"}),jsxRuntimeExports.jsx("input",{type:"number",min:"1",step:"1",value:x,onChange:N=>u(v.id,Number(N.target.value)),className:"w-16 px-2 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Unidades"})]}),jsxRuntimeExports.jsxs("div",{className:"text-xs text-gray-600",children:[jsxRuntimeExports.jsx("span",{className:"block font-medium text-gray-900",children:"Peso facturado"}),jsxRuntimeExports.jsx("span",{className:`text-sm ${v.finalWeight&&v.finalWeight>v.weight?"text-blue-600 font-semibold":"text-gray-900"}`,children:formatWeight(v.finalWeight||v.weight)}),jsxRuntimeExports.jsx("span",{className:"block mt-0.5",children:v.finalWeight&&v.finalWeight>v.weight?"Se aplica peso volumétrico.":"Coincide con el peso real."})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("label",{className:"block text-xs font-medium text-gray-700 mb-2 flex items-center",children:[jsxRuntimeExports.jsx(Ruler,{className:"h-4 w-4 mr-1 text-blue-600"}),"Medidas (cm)"]}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("span",{className:"w-16 text-xs font-medium text-gray-600",children:"Alto"}),jsxRuntimeExports.jsx("input",{type:"number",value:((g=v.dimensions)==null?void 0:g.height)||10,onChange:N=>{var M,A;return h(v.id,{height:Number(N.target.value),width:((M=v.dimensions)==null?void 0:M.width)||10,length:((A=v.dimensions)==null?void 0:A.length)||10})},min:"1",max:"99999",step:"0.1",className:"w-20 px-2 py-1 text-sm border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 focus:border-transparent",placeholder:"Alto"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("span",{className:"w-16 text-xs font-medium text-gray-600",children:"Ancho"}),jsxRuntimeExports.jsx("input",{type:"number",value:((w=v.dimensions)==null?void 0:w.width)||10,onChange:N=>{var M,A;return h(v.id,{height:((M=v.dimensions)==null?void 0:M.height)||10,width:Number(N.target.value),length:((A=v.dimensions)==null?void 0:A.length)||10})},min:"1",max:"99999",step:"0.1",className:"w-20 px-2 py-1 text-sm border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 focus:border-transparent",placeholder:"Ancho"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("span",{className:"w-16 text-xs font-medium text-gray-600",children:"Largo"}),jsxRuntimeExports.jsx("input",{type:"number",value:((R=v.dimensions)==null?void 0:R.length)||10,onChange:N=>{var M,A;return h(v.id,{height:((M=v.dimensions)==null?void 0:M.height)||10,width:((A=v.dimensions)==null?void 0:A.width)||10,length:Number(N.target.value)})},min:"1",max:"99999",step:"0.1",className:"w-20 px-2 py-1 text-sm border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 focus:border-transparent",placeholder:"Largo"})]})]})]}),v.volumetricWeight&&jsxRuntimeExports.jsx("div",{className:"text-xs text-gray-600 bg-gray-50 border border-gray-200 rounded-lg p-3",children:jsxRuntimeExports.jsxs("div",{className:"flex flex-wrap gap-x-6 gap-y-1",children:[jsxRuntimeExports.jsxs("span",{children:["⚖️ Peso volumétrico: ",formatWeight(v.volumetricWeight)]}),v.dimensions&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("span",{children:["📐 ",formatDimensions(v.dimensions.height,v.dimensions.width,v.dimensions.length)]}),jsxRuntimeExports.jsxs("span",{children:["📦 Volumen: ",formatVolume(v.dimensions.height,v.dimensions.width,v.dimensions.length)]})]})]})})]})]},v.id)})}),jsxRuntimeExports.jsx("div",{className:"pt-4 border-t border-gray-200",children:jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsxs("span",{className:"text-gray-600",children:["Total: ",d," bulto",d>1?"s":""]})}),jsxRuntimeExports.jsxs("div",{className:"space-y-1",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-gray-600",children:"Peso real:"}),jsxRuntimeExports.jsx("span",{className:"font-medium text-gray-900",children:formatWeight(_)})]}),b!==_&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-gray-600",children:"Peso facturado:"}),jsxRuntimeExports.jsx("span",{className:"font-medium text-blue-600",children:formatWeight(b)})]})]})]})}),t.some(v=>v.weight<=0)&&jsxRuntimeExports.jsx("div",{className:"p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-yellow-800",children:"⚠️ Algunos bultos tienen peso inválido. El peso debe ser mayor a 0 kg."})}),t.some(v=>v.weight>30)&&jsxRuntimeExports.jsx("div",{className:"p-3 bg-orange-50 border border-orange-200 rounded-lg",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-orange-800",children:"⚠️ Algunos bultos exceden el peso máximo típico (30 kg). Verifica las tarifas disponibles."})}),t.some(v=>v.volumetricWeight&&v.volumetricWeight>v.weight)&&jsxRuntimeExports.jsx("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-lg",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-blue-800",children:"ℹ️ Se está aplicando peso volumétrico en algunos bultos. El peso facturado será el mayor entre peso real y volumétrico."})})]})]})}function CostBreakdownTable({costBreakdowns:t,marginPercentage:r,packages:e,showCosts:s,showPvp:a,shippingMode:i,additionalPvp:o=0,additionalPvpLabel:c,saturdayActive:h=!1,saturdayPvp:u=0,onProvincialCostChange:d,provincialCostOverride:_=null,onMarginChange:b,planSelected:v=!1,discountSummaryValue:E,discountSummaryDescription:x}){const g=Array.isArray(e)?e:[],w=g.reduce((W,Q)=>W+Math.max(1,Math.round(Q.quantity??1)),0),R=g.reduce((W,Q)=>W+(Q.finalWeight||Q.weight)*Math.max(1,Math.round(Q.quantity??1)),0),[N,M]=reactExports.useState(7),[A,I]=reactExports.useState(1.5),[y,j]=reactExports.useState(8),[T,U]=reactExports.useState(!0),[F,H]=reactExports.useState(21),[z,de]=reactExports.useState(null),se=reactExports.useMemo(()=>{if(!t)return[];const W=1-r/100,Q=W>0,xe=T?1+F/100:1;return Object.entries(t).map(([Se,Ce])=>{const Le=Ce.status==="calculated",De=Le&&Q?Ce.totalCost/W:0,_e=Le?roundUp$1(De):0,Ge=Le?roundUp$1(_e*(N/100)):0,Ye=Le?roundUp$1(_e*(A/100)):0,ot=Le?roundUp$1(_e*(y/100)):0,st=Le?roundUp$1(o):0,ht=Le&&h?roundUp$1(u):0,Je=Le?roundUp$1(_e+Ge+Ye+ot+st+ht):0,nt=Le?roundUp$1(Je*xe):0,ct=Le?Je-Ce.totalCost:0,ft=Le?ct>=0?roundUp$1(ct):-roundUp$1(Math.abs(ct)):0;return{zone:Se,breakdown:Ce,basePvp:Number.isFinite(_e)?_e:0,energyCharge:Number.isFinite(Ge)?Ge:0,climateCharge:Number.isFinite(Ye)?Ye:0,insuranceCharge:Number.isFinite(ot)?ot:0,saturdayCharge:Number.isFinite(ht)?ht:0,pvpSinIva:Number.isFinite(Je)?Je:0,pvpConIva:Number.isFinite(nt)?nt:0,marginAmount:Number.isFinite(ft)?ft:0}})},[t,r,N,A,y,T,F,o,h,u]),ue=h||se.some(W=>W.breakdown.status==="calculated"&&W.breakdown.saturdayCost>0),Z=se.some(W=>W.breakdown.status==="calculated"&&W.breakdown.mileageCost>0),ge=se.filter(W=>W.breakdown.status==="calculated"&&W.pvpSinIva>0),re=ge.map(W=>W.pvpSinIva),oe=ge.map(W=>W.pvpConIva),be=re.length?Math.min(...re):0,L=re.length?Math.max(...re):0,S=oe.length?Math.min(...oe):0,C=oe.length?Math.max(...oe):0,P=re.length>0,D=T?`PVP CON IVA (${F}%)`:"PVP CON IVA (no aplicado)",B=Math.min(Math.max(r,0),100),G=`calc(${B}% - 16px)`,J="linear-gradient(90deg, #dc2626 0%, #f97316 20%, #facc15 38%, #bbf7d0 40%, #4ade80 75%, #16a34a 100%)",Y=reactExports.useMemo(()=>{const W=P?jsxRuntimeExports.jsxs("div",{className:"text-xs text-gray-500 space-y-0.5",children:[jsxRuntimeExports.jsxs("p",{children:["PVP sin IVA: ",formatCurrency(be)," - ",formatCurrency(L)]}),T&&jsxRuntimeExports.jsxs("p",{children:["PVP con IVA: ",formatCurrency(S)," - ",formatCurrency(C)]})]}):jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500",children:"Pendiente de datos"}),Q=E??"Sin descuentos aplicados",xe=x!=null?typeof x=="string"?jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500",children:x}):x:jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500",children:"Sin descuentos aplicados"});return[{title:"Total Bultos",value:w,description:jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-500",children:formatWeight(R)}),Icon:Calculator,iconClassName:"text-blue-600"},{title:"Margen Objetivo",value:formatPercentage(r),description:jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-500",children:"Sobre venta"}),Icon:TrendingUp,iconClassName:"text-green-600"},{title:"Zonas Calculadas",value:se.length,description:W,Icon:Euro,iconClassName:"text-purple-600"},{title:"Descuento Coste Aplicado",value:Q,description:xe,Icon:Percent,iconClassName:"text-orange-500"}]},[se.length,T,P,r,C,L,S,be,w,R,E,x]),me=W=>Q=>{const xe=Number(Q.target.value);W(Number.isNaN(xe)?0:xe)},Ee=W=>{const Q=Number(W.target.value);Number.isNaN(Q)||b==null||b(Q)};reactExports.useEffect(()=>{if(!z)return;se.some(Q=>Q.zone===z)||de(null)},[se,z]);const Re=W=>{const Q=Number(W.target.value);H(Number.isNaN(Q)?F:Q)},Ne=W=>({maxHeight:W?"5000px":"0px",opacity:W?1:0,transform:W?"translateY(0)":"translateY(-8px)",transition:"max-height 0.6s ease, opacity 0.3s ease, transform 0.3s ease",overflow:"hidden",pointerEvents:W?"auto":"none"}),he=(W,Q)=>{if(Q.status==="not_available")return jsxRuntimeExports.jsx("span",{className:"text-red-600 font-semibold",children:"NO"});if(Q.status==="idle")return jsxRuntimeExports.jsx("span",{className:"text-gray-400",children:"—"});const xe=Number.isFinite(W)?W:0,Se=formatCurrency(Math.abs(xe));return xe<0?jsxRuntimeExports.jsxs("span",{className:"text-red-600",children:["-",Se]}):Se},pe=(W,Q,xe)=>{if(xe.status==="not_available")return jsxRuntimeExports.jsx("span",{className:"text-red-600 font-semibold",children:"NO"});if(xe.status==="idle")return jsxRuntimeExports.jsx("span",{className:"text-gray-400",children:"—"});const Se=Number.isFinite(W)?W:0,Ce=Number.isFinite(Q)?Q:0,Le=formatCurrency(Math.abs(Ce)),De=Ce<0?jsxRuntimeExports.jsxs("span",{className:"text-red-600",children:["-",Le]}):jsxRuntimeExports.jsx("span",{className:"text-gray-900",children:Le});return jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-end leading-tight",children:[De,jsxRuntimeExports.jsx("span",{className:"text-[11px] text-gray-500",children:formatPercentage(Se)})]})},fe=W=>{const{breakdown:Q,zone:xe}=W;if(Q.status==="not_available"||Q.status==="idle"||!d||xe!=="Provincial")return he(Q.initialCost,Q);const Se=v?roundUp$1(Math.max(0,Q.initialCost-Q.linearDiscount)):_??Q.initialCost;if(v||!d)return he(Se,Q);const Ce=Le=>{const De=Le.target.value;if(De===""){d(null);return}const _e=Number(De);d(Number.isNaN(_e)?null:_e)};return jsxRuntimeExports.jsx("input",{type:"number",step:"0.01",min:"0",value:Number.isFinite(Se)?Se:0,onChange:Ce,className:"w-full max-w-[140px] text-right px-2 py-1 border border-blue-200 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",title:"Si tu provincia tiene un coste especial sustituye el coste inicial calculado en base a peso/medidas para que los cálculos se actualicen."})};return jsxRuntimeExports.jsxs("div",{className:"space-y-8",children:[(s||a)&&jsxRuntimeExports.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:Y.map(({title:W,value:Q,description:xe,Icon:Se,iconClassName:Ce})=>jsxRuntimeExports.jsx("div",{className:"bg-white rounded-lg shadow-md p-5",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-gray-600",children:W}),jsxRuntimeExports.jsx("p",{className:"text-2xl font-bold text-gray-900",children:Q}),xe]}),jsxRuntimeExports.jsx(Se,{className:`h-8 w-8 ${Ce}`})]})},W))}),jsxRuntimeExports.jsx("div",{style:Ne(s),"aria-hidden":!s,className:"transition-all",children:s&&jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[jsxRuntimeExports.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex flex-wrap items-center justify-between gap-3",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Desglose de Costes por Zona de Destino"}),jsxRuntimeExports.jsxs("span",{className:"inline-flex items-center px-3 py-1 text-xs font-semibold uppercase tracking-wide text-blue-700 bg-blue-50 border border-blue-200 rounded-full",children:["Modo: ",SHIPPING_MODE_LABELS[i]]})]}),jsxRuntimeExports.jsx("div",{className:"overflow-x-auto",children:jsxRuntimeExports.jsxs("table",{className:"min-w-full table-auto text-sm",children:[jsxRuntimeExports.jsx("thead",{className:"bg-gray-50",children:jsxRuntimeExports.jsxs("tr",{children:[jsxRuntimeExports.jsx("th",{className:"px-3 py-2 text-left text-[11px] font-semibold text-gray-500 uppercase tracking-tight leading-snug sticky left-0 bg-gray-50 z-10",children:"Zona de Destino"}),jsxRuntimeExports.jsxs("th",{className:"px-3 py-2 text-right text-[11px] font-semibold text-gray-500 uppercase tracking-tight leading-snug",children:["Coste Inicial",jsxRuntimeExports.jsx("br",{}),"calculado en base al peso y medidas indicadas"]}),jsxRuntimeExports.jsxs("th",{className:"px-3 py-2 text-right text-[11px] font-semibold text-gray-500 uppercase tracking-tight leading-snug",children:["Descuento",jsxRuntimeExports.jsx("br",{}),"lineal"]}),jsxRuntimeExports.jsxs("th",{className:"px-3 py-2 text-right text-[11px] font-semibold text-gray-500 uppercase tracking-tight leading-snug",children:["Climate Protect",jsxRuntimeExports.jsx("br",{}),"1,5%"]}),jsxRuntimeExports.jsxs("th",{className:"px-3 py-2 text-right text-[11px] font-semibold text-gray-500 uppercase tracking-tight leading-snug",children:["Canon Red",jsxRuntimeExports.jsx("br",{}),"(Fijo) 0,27€"]}),jsxRuntimeExports.jsxs("th",{className:"px-3 py-2 text-right text-[11px] font-semibold text-gray-500 uppercase tracking-tight leading-snug",children:["Canon Digital",jsxRuntimeExports.jsx("br",{}),"(Fijo) 0,06€"]}),jsxRuntimeExports.jsxs("th",{className:"px-3 py-2 text-right text-[11px] font-semibold text-gray-500 uppercase tracking-tight leading-snug",children:["No Vol.",jsxRuntimeExports.jsx("br",{}),"(FIJO) 0,04€"]}),jsxRuntimeExports.jsxs("th",{className:"px-3 py-2 text-right text-[11px] font-semibold text-gray-500 uppercase tracking-tight leading-snug",children:["Ampl. Cobertura",jsxRuntimeExports.jsx("br",{}),"(1,95%)"]}),jsxRuntimeExports.jsxs("th",{className:"px-3 py-2 text-right text-[11px] font-semibold text-gray-500 uppercase tracking-tight leading-snug",children:["Energía",jsxRuntimeExports.jsx("br",{}),"(7,50%)"]}),jsxRuntimeExports.jsxs("th",{className:"px-3 py-2 text-right text-[11px] font-semibold text-gray-500 uppercase tracking-tight leading-snug",children:["Suplementos",jsxRuntimeExports.jsx("br",{}),"(Variable)"]}),jsxRuntimeExports.jsxs("th",{className:"px-3 py-2 text-right text-[11px] font-semibold text-gray-500 uppercase tracking-tight leading-snug",children:["Irregular",jsxRuntimeExports.jsx("br",{}),"(Variable)"]}),Z&&jsxRuntimeExports.jsx("th",{className:"px-3 py-2 text-right text-[11px] font-semibold text-gray-500 uppercase tracking-tight leading-snug",children:"Kilometraje"}),ue&&jsxRuntimeExports.jsxs("th",{className:"px-3 py-2 text-right text-[11px] font-semibold text-gray-500 uppercase tracking-tight leading-snug",children:["Ent. Sáb",jsxRuntimeExports.jsx("br",{}),"(Coste)"]}),jsxRuntimeExports.jsx("th",{className:"px-3 py-2 text-right text-[11px] font-semibold text-gray-500 uppercase tracking-tight leading-snug",children:"Total suma de conceptos anteriores"}),jsxRuntimeExports.jsxs("th",{className:"px-3 py-2 text-right text-[11px] font-semibold text-gray-500 uppercase tracking-tight leading-snug",children:["Incr. 2024",jsxRuntimeExports.jsx("br",{}),"(%)"]}),jsxRuntimeExports.jsxs("th",{className:"px-3 py-2 text-right text-[11px] font-semibold text-gray-500 uppercase tracking-tight leading-snug",children:["Incr. 2025",jsxRuntimeExports.jsx("br",{}),"(%)"]}),jsxRuntimeExports.jsxs("th",{className:"px-3 py-2 text-right text-[11px] font-semibold text-gray-500 uppercase tracking-tight leading-snug",children:["Incr. 2026",jsxRuntimeExports.jsx("br",{}),"(%) editable"]}),jsxRuntimeExports.jsxs("th",{className:"px-3 py-2 text-right text-[11px] font-semibold text-gray-500 uppercase tracking-tight leading-snug",children:["SPC en €",jsxRuntimeExports.jsx("br",{}),"(editable)"]}),jsxRuntimeExports.jsxs("th",{className:"px-3 py-2 text-right text-[11px] font-bold text-blue-600 uppercase tracking-tight leading-snug",children:["TOTAL COSTE",jsxRuntimeExports.jsx("br",{}),"(Suma de todo lo anterior)"]})]})}),jsxRuntimeExports.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:se.map(W=>jsxRuntimeExports.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[jsxRuntimeExports.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-sm font-medium text-gray-900 sticky left-0 bg-white z-10",children:W.zone}),jsxRuntimeExports.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-sm text-gray-900 text-right font-medium",children:fe(W)}),jsxRuntimeExports.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-sm text-gray-600 text-right",children:he(-W.breakdown.linearDiscount,W.breakdown)}),jsxRuntimeExports.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-sm text-gray-600 text-right",children:he(W.breakdown.climateProtect,W.breakdown)}),jsxRuntimeExports.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-sm text-gray-600 text-right",children:he(W.breakdown.canonRed,W.breakdown)}),jsxRuntimeExports.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-sm text-gray-600 text-right",children:he(W.breakdown.canonDigital,W.breakdown)}),jsxRuntimeExports.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-sm text-gray-600 text-right",children:he(W.breakdown.noVol,W.breakdown)}),jsxRuntimeExports.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-sm text-gray-600 text-right",children:he(W.breakdown.amplCobertura,W.breakdown)}),jsxRuntimeExports.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-sm text-gray-600 text-right",children:he(W.breakdown.energia,W.breakdown)}),jsxRuntimeExports.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-sm text-gray-600 text-right",children:he(W.breakdown.suplementos,W.breakdown)}),jsxRuntimeExports.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-sm text-gray-600 text-right",children:he(W.breakdown.irregular,W.breakdown)}),Z&&jsxRuntimeExports.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-sm text-gray-600 text-right",children:he(W.breakdown.mileageCost,W.breakdown)}),ue&&jsxRuntimeExports.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-sm text-gray-600 text-right",children:he(W.breakdown.saturdayCost,W.breakdown)}),jsxRuntimeExports.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-sm text-gray-900 text-right font-medium",children:he(W.breakdown.subtotal,W.breakdown)}),jsxRuntimeExports.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-sm text-gray-600 text-right",children:pe(W.breakdown.incr2024Percent,W.breakdown.incr2024,W.breakdown)}),jsxRuntimeExports.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-sm text-gray-600 text-right",children:pe(W.breakdown.incr2025Percent,W.breakdown.incr2025,W.breakdown)}),jsxRuntimeExports.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-sm text-gray-600 text-right",children:pe(W.breakdown.incr2026Percent,W.breakdown.incr2026,W.breakdown)}),jsxRuntimeExports.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-sm text-gray-600 text-right",children:he(W.breakdown.spc,W.breakdown)}),jsxRuntimeExports.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-sm text-blue-600 text-right font-bold",children:he(W.breakdown.totalCost,W.breakdown)})]},W.zone))})]})})]})}),jsxRuntimeExports.jsx("div",{style:Ne(a),"aria-hidden":!a,className:"transition-all",children:a&&jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 space-y-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Análisis Comparativo"}),jsxRuntimeExports.jsxs("span",{className:"text-sm text-gray-500",children:["Zonas evaluadas: ",se.length]})]}),o>0&&jsxRuntimeExports.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg px-4 py-3 text-sm text-red-800 flex items-center justify-between",children:jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"font-semibold uppercase tracking-wide text-xs text-red-700",children:c??"Cargos adicionales"}),jsxRuntimeExports.jsxs("p",{children:["Se añaden ",formatCurrency(o)," al PVP total para este envío."]})]})}),h&&u>0&&jsxRuntimeExports.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg px-4 py-3 text-sm text-blue-800 flex items-center justify-between",children:jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"font-semibold uppercase tracking-wide text-xs text-blue-700",children:"Entrega en sábado"}),jsxRuntimeExports.jsxs("p",{children:["Se añaden ",formatCurrency(u)," al PVP total para cubrir la entrega en sábado."]})]})}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Suplemento de energía (%)"}),jsxRuntimeExports.jsx("input",{type:"number",min:"0",step:"0.1",value:N,onChange:me(M),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Se aplica sobre el PVP base calculado con el margen."})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Climate Protect (%)"}),jsxRuntimeExports.jsx("input",{type:"number",min:"0",step:"0.1",value:A,onChange:me(I),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Ajusta el recargo del 1,5% para protección climática."})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Seguro Opcional (%)"}),jsxRuntimeExports.jsx("input",{type:"number",min:"0",step:"0.1",value:y,onChange:me(j),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Incremento editable para cubrir seguros adicionales."})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-stretch",children:[jsxRuntimeExports.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 md:basis-1/4 md:max-w-[25%]",children:[jsxRuntimeExports.jsx("p",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2",children:"Margen objetivo sobre venta"}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("div",{className:"absolute inset-0 rounded-full pointer-events-none",style:{background:J}}),jsxRuntimeExports.jsx("input",{type:"range",min:0,max:100,step:.1,value:B,onChange:Ee,className:"relative w-full appearance-none h-2 rounded-full bg-transparent focus:outline-none","aria-label":"Margen objetivo sobre venta","aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":Number.isFinite(r)?r:0,list:"margin-percentage-ticks"}),jsxRuntimeExports.jsx("div",{className:"absolute -top-7",style:{left:G},children:jsxRuntimeExports.jsx("span",{className:"px-2 py-1 rounded-md bg-gray-900 text-white text-xs shadow",children:formatPercentage(r)})})]}),jsxRuntimeExports.jsx("datalist",{id:"margin-percentage-ticks",children:Array.from({length:21}).map((W,Q)=>{const xe=Q*5;return jsxRuntimeExports.jsx("option",{value:xe,label:`${xe}%`},xe)})})]}),jsxRuntimeExports.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 flex flex-wrap items-center gap-4 justify-end md:basis-3/4 md:max-w-[75%]",children:[jsxRuntimeExports.jsxs("div",{className:"mr-auto",children:[jsxRuntimeExports.jsx("p",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide",children:"PVP SIN IVA"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600",children:"Los suplementos editables se suman al PVP calculado con el margen seleccionado."})]}),jsxRuntimeExports.jsxs("label",{className:"flex items-center space-x-2 text-sm font-medium text-gray-700",children:[jsxRuntimeExports.jsx("input",{type:"checkbox",className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500",checked:T,onChange:W=>U(W.target.checked)}),jsxRuntimeExports.jsx("span",{children:"Aplicar IVA al resultado"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-2",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-gray-600",children:"IVA"}),jsxRuntimeExports.jsxs("select",{value:F,onChange:Re,disabled:!T,className:"px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:text-gray-500",children:[jsxRuntimeExports.jsx("option",{value:21,children:"21%"}),jsxRuntimeExports.jsx("option",{value:0,children:"0%"}),jsxRuntimeExports.jsx("option",{value:4,children:"4%"}),jsxRuntimeExports.jsx("option",{value:7,children:"7%"})]})]}),jsxRuntimeExports.jsx("div",{className:"text-xs text-gray-500",children:T?`Mostrando también PVP con IVA (${F}%).`:"Mostrando únicamente PVP sin IVA."})]})]}),jsxRuntimeExports.jsx("div",{className:"overflow-x-auto",children:jsxRuntimeExports.jsxs("table",{className:"min-w-full table-auto text-sm",children:[jsxRuntimeExports.jsx("thead",{className:"bg-gray-50",children:jsxRuntimeExports.jsxs("tr",{children:[jsxRuntimeExports.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Zona de Destino"}),jsxRuntimeExports.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Coste"}),jsxRuntimeExports.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"PVP base"}),jsxRuntimeExports.jsxs("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:["Sup. energía (",formatPercentage(N),")"]}),jsxRuntimeExports.jsxs("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:["Climate Protect (",formatPercentage(A),")"]}),jsxRuntimeExports.jsxs("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:["Seguro Opcional (",formatPercentage(y),")"]}),ue&&jsxRuntimeExports.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Ent. Sáb"}),jsxRuntimeExports.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Margen (sin IVA)"}),jsxRuntimeExports.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:D})]})}),jsxRuntimeExports.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:se.map(W=>jsxRuntimeExports.jsxs("tr",{className:`${z===W.zone?"bg-green-50":""} hover:bg-gray-50 transition-colors cursor-pointer`,role:"button",tabIndex:0,onClick:()=>de(W.zone),onKeyDown:Q=>{(Q.key==="Enter"||Q.key===" ")&&(Q.preventDefault(),de(W.zone))},children:[jsxRuntimeExports.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900",children:W.zone}),jsxRuntimeExports.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-700 text-right",children:he(W.breakdown.totalCost,W.breakdown)}),jsxRuntimeExports.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-700 text-right",children:he(W.basePvp,W.breakdown)}),jsxRuntimeExports.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-700 text-right",children:he(W.energyCharge,W.breakdown)}),jsxRuntimeExports.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-700 text-right",children:he(W.climateCharge,W.breakdown)}),jsxRuntimeExports.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-700 text-right",children:he(W.insuranceCharge,W.breakdown)}),ue&&jsxRuntimeExports.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-700 text-right",children:he(W.saturdayCharge,W.breakdown)}),jsxRuntimeExports.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900 text-right",children:he(W.marginAmount,W.breakdown)}),jsxRuntimeExports.jsx("td",{className:`px-4 py-3 whitespace-nowrap text-sm font-semibold text-right ${T?"text-blue-600":"text-gray-500"}`,children:he(W.pvpConIva,W.breakdown)})]},`${W.zone}-analysis`))})]})}),ge.length===0&&jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-500",children:"La tabla de costes se actualizará automáticamente al indicar pesos, medidas y ajustes necesarios."})]})}),!s&&!a&&jsxRuntimeExports.jsx("div",{className:"bg-white border border-dashed border-gray-300 rounded-lg p-6 text-center text-sm text-gray-500",children:"Usa los botones «Ver costes» o «Ver PVP» para desplegar la información."})]})}const __vite_import_meta_env__$1={},SOP_LOG_ENABLED=typeof import.meta<"u"&&typeof __vite_import_meta_env__$1<"u"&&!1,sopLog$1=(...t)=>{SOP_LOG_ENABLED&&console.log("[SOP]",...t)},SERVICE_NAME_ALIASES$1={"express 8 30":"Urg8:30H Courier","express 830":"Urg8:30H Courier","express8 30":"Urg8:30H Courier","express 10 30":"Urg10H Courier","express 1030":"Urg10H Courier","express10 30":"Urg10H Courier","express 14 00":"Urg14H Courier","express 1400":"Urg14H Courier","express14 00":"Urg14H Courier","express 19 00":"Urg19H Courier","express 1900":"Urg19H Courier","express19 00":"Urg19H Courier","business parcel":"Business Parcel","economy parcel":"Economy Parcel",maritimo:"Marítimo","maritimo maritimo":"Marítimo","parcel shop":"Parcel Shop","eurobusiness parcel":"EuroBusiness Parcel"},FTP_FILE_URL$1="https://www.logicalogistica.com/area-privada/base%20SOP%20FTP.xlsx",BASE_RANGE_ALIASES$1={provincial:"provincial",prov:"provincial",regional:"regional",reg:"regional",nacional:"nacional",nacional_:"nacional",pen:"nacional",peninsula:"nacional",portugal:"portugal",port:"portugal",andorra:"andorra",gibraltar:"gibraltar",canarias_mayores:"canarias_mayores",can_my:"canarias_mayores",canarias_menores:"canarias_menores",can_mn:"canarias_menores",baleares_mayores:"baleares_mayores",bal_my:"baleares_mayores",baleares_menores:"baleares_menores",bal_mn:"baleares_menores",ceuta:"ceuta",melilla:"melilla",madeira_mayores:"madeira_mayores",madeira_mayores_maritimo:"madeira_mayores",madeiramayores:"madeira_mayores",madeiramayoresmaritimo:"madeira_mayores",mad_my:"madeira_mayores",madeira_menores:"madeira_menores",madeira_menores_maritimo:"madeira_menores",madeiramenores:"madeira_menores",madeiramenoresmaritimo:"madeira_menores",mad_mn:"madeira_menores",azores_mayores:"azores_mayores",azores_mayores_maritimo:"azores_mayores",azoresmayores:"azores_mayores",azoresmayoresmaritimo:"azores_mayores",az_my:"azores_mayores",azores_menores:"azores_menores",azores_menores_maritimo:"azores_menores",azoresmenores:"azores_menores",azoresmenoresmaritimo:"azores_menores",az_mn:"azores_menores"},DEFAULT_FORM={clientName:"",agencyNameNumber:"",agencyAddress:"",agencyPostalTown:"",agencyProvince:"",agencyEmail:"",validFrom:"",validTo:"",reimbursementPercent:"",reimbursementMinimum:"",reimbursementFixed:"",reimbursementMax:"",energySurcharge:"7.50",climateProtect:"1.5",optionalInsurance:"8"},createServiceKey$1=t=>t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/[^a-z0-9]+/g," ").trim(),resolveExcelServiceKey$1=t=>{const r=createServiceKey$1(t);if(!r)return null;const s=SERVICE_NAME_ALIASES$1[r]??t;return createServiceKey$1(s)||null},formatWeightKey=t=>t==null?"null":Number.isInteger(t)?String(t):t.toString(),createTariffMapKey=(t,r,e,s)=>`${createServiceKey$1(t)}|${r}|${formatWeightKey(e)}|${formatWeightKey(s)}`;function normalizeRangeName$1(t){if(!t)return null;const r=t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/_+/g,"_").replace(/^_|_$/g,"");let e="sal",s=r;const a=s.match(/_(sal|rec|int)$/);a?(e=a[1],s=s.slice(0,-a[0].length)):/_recogida?/.test(s)||/_rec\b/.test(s)?(e="rec",s=s.replace(/_recogida?/,"").replace(/_rec\b/,"")):/_interciudad/.test(s)||/_inter/.test(s)||/_int$/.test(s)?(e="int",s=s.replace(/_interciudad/,"").replace(/_inter/,"").replace(/_int$/,"")):/_salida/.test(s)&&(e="sal",s=s.replace(/_salida/,"")),s=s.replace(/_+/g,"_").replace(/^_|_$/g,"");const o=[s,s.replace(/_/g," "),s.replace(/_/g,"")].reduce((c,h)=>c||(BASE_RANGE_ALIASES$1[h]??null),null);return o?`${o}_${e}`:null}function parseNumber(t){if(t==null)return null;if(typeof t=="number")return Number.isNaN(t)?null:t;if(typeof t=="object"&&t!==null&&"result"in t){const s=t.result;return parseNumber(s)}const r=String(t).replace(/[^0-9.,-]/g,"").replace(",","."),e=Number(r);return Number.isNaN(e)?null:e}function parseWeightBound(t,r){if(typeof t=="string"){const e=t.toLowerCase();if(e.includes("kg")&&e.includes("adc"))return r==="to"?999:parseNumber(t)??15}return parseNumber(t)}function downloadBuffer(t,r,e){const s=t instanceof ArrayBuffer?new Blob([t],{type:e}):new Blob([t],{type:e}),a=URL.createObjectURL(s),i=document.createElement("a");i.href=a,i.download=r,i.click(),URL.revokeObjectURL(a)}const SOPGenerator=({tariffs:t,marginPercentage:r,discountPlans:e,selectedPlanGroup:s,linearDiscount:a,spc:i,variableSurcharge:o,irregularSurcharge:c,increment2026:h,selectedService:u,provincialCostOverride:d,disabled:_})=>{const{user:b}=useAuth(),{preferences:v}=usePreferences(),E=Array.isArray(t)?t:[],x=reactExports.useMemo(()=>Array.isArray(e)?e:[],[e]),g=_||E.length===0,[w,R]=reactExports.useState(!1),[N,M]=reactExports.useState(DEFAULT_FORM),[A,I]=reactExports.useState(null),[y,j]=reactExports.useState(!1),[T,U]=reactExports.useState(!1),[F,H]=reactExports.useState(null),[z,de]=reactExports.useState(s),[se,ue]=reactExports.useState(null),[Z,ge]=reactExports.useState(!1),re=!!F,oe=reactExports.useMemo(()=>{const he=new Map;return x.forEach(pe=>{const fe=getPlanGroupKey(pe);he.has(fe)||he.set(fe,pe.plan_name)}),Array.from(he.entries())},[x]),be=oe.some(([he])=>he===z)?z:"",L=N.reimbursementFixed.trim()!=="",S=N.reimbursementPercent.trim()!=="";reactExports.useEffect(()=>{if(!w){I(null);return}(async()=>{j(!0),I(null);try{const pe=await fetch(FTP_FILE_URL$1);if(!pe.ok)throw new Error("No se pudo descargar el modelo SOP desde el FTP corporativo.");const fe=await pe.arrayBuffer();H(fe);const W=new exceljs_minExports.Workbook;if(await W.xlsx.load(fe),!W.getWorksheet("General"))throw new Error("La plantilla descargada no contiene la hoja 'General'.")}catch(pe){console.error(pe),I(pe instanceof Error?pe.message:"No se pudo preparar el modelo SOP.")}finally{j(!1)}})()},[w]);const C=()=>{if(!g){if(v){const he={...DEFAULT_FORM,agencyNameNumber:v.agency_name_number||"",agencyAddress:v.agency_address||"",agencyPostalTown:v.agency_postal_town||"",agencyProvince:v.agency_province||"",agencyEmail:v.agency_email||""},pe=!!(v.agency_name_number||v.agency_address||v.agency_postal_town||v.agency_province||v.agency_email);M(he),ge(pe)}R(!0)}},P=()=>{R(!1),M(DEFAULT_FORM),H(null),I(null),U(!1),j(!1),de(s),ue(null),ge(!1)};reactExports.useEffect(()=>{if(w){const he=oe.some(([pe])=>pe===s);de(he?s:"")}},[w,s,oe]),reactExports.useEffect(()=>{if(!w)return;if(!be){ue(null);return}const he=x.find(pe=>getPlanGroupKey(pe)===be);if(he){const pe=getCustomPlanMessage(he.id);ue(pe??null)}else ue(null)},[w,be,x]);const D=(he,pe)=>{M(fe=>({...fe,[he]:pe}))},B=he=>{M(pe=>({...pe,reimbursementPercent:he,reimbursementFixed:he.trim()?"":pe.reimbursementFixed}))},G=he=>{M(pe=>({...pe,reimbursementFixed:he,reimbursementPercent:he.trim()?"":pe.reimbursementPercent}))},J=async()=>{if(!F)throw new Error("Descarga del modelo SOP incompleta.");const he=new exceljs_minExports.Workbook;return await he.xlsx.load(F.slice(0)),Y(he),me(he),Ee(he),he.calcProperties.fullCalcOnLoad=!0,he},Y=he=>{sopLog$1("build-table:start",{tariffs:E.length,marginPercentage:r,planGroup:be,linearDiscount:a,spc:i,variableSurcharge:o,irregularSurcharge:c,increment2026:h,selectedService:u,provincialCostOverride:d});const pe=buildVirtualTariffTable(E,{marginPercentage:r,planGroup:be,discountPlans:x,linearDiscount:be?0:a,spc:i,variableSurcharge:o,irregularSurcharge:c,increment2026:h,selectedService:u,provincialCostOverride:be?null:d}),fe=new Map;pe.forEach(Q=>{const xe=createTariffMapKey(Q.service_name,Q.zone,Q.weight_from,Q.weight_to??null);fe.set(xe,Q.pvp)});const W=he.getWorksheet("General");if(!W)throw new Error("La hoja 'General' no está disponible en la plantilla descargada.");W.eachRow((Q,xe)=>{if(xe===1)return;const Se=Q.getCell("A").value,Ce=Q.getCell("F").value,Le=parseWeightBound(Se,"from"),De=parseWeightBound(Ce,"to"),_e=String(Q.getCell("C").value??"").trim(),Ge=String(Q.getCell("D").value??"").trim();if(!_e||Le===null){Q.getCell("G").value=null;return}const Ye=normalizeRangeName$1(Ge);if(!Ye){Q.getCell("G").value=null;return}const ot=resolveExcelServiceKey$1(_e);if(!ot){Q.getCell("G").value=null;return}const st=createTariffMapKey(ot,Ye,Le,De),ht=fe.get(st);if(typeof ht=="number"){const Je=Number(ht.toFixed(2));Q.getCell("G").value=Je;const nt=String(Q.getCell("H").value??"").trim(),ct=String(Q.getCell("I").value??"").trim();if(nt&&ct){const ft=he.getWorksheet(nt);if(ft){const pt=ft.getCell(ct);pt.value=Je,sopLog$1("write-target",{service:_e,zone:Ye,weight_from:Le,weight_to:De,sheet:nt,cell:ct,value:Je})}}sopLog$1("write-row",{service:_e,zone:Ye,weight_from:Le,weight_to:De,value:Je})}else Q.getCell("G").value=null,sopLog$1("write-row",{service:_e,zone:Ye,weight_from:Le,weight_to:De,value:null})})},me=he=>{sopLog$1("base-exp:start","Iniciando escritura en hoja base exp");const pe=he.getWorksheet("General");if(!pe){sopLog$1("base-exp:error","La hoja General no está disponible");return}const fe=he.getWorksheet("base exp");if(!fe){sopLog$1("base-exp:error","La hoja base exp no existe en el workbook");return}let W=0,Q=0;pe.eachRow((xe,Se)=>{if(Se!==1)try{const Ce=xe.getCell("G").value,Le=String(xe.getCell("J").value??"").trim(),De=String(xe.getCell("K").value??"").trim(),_e=String(xe.getCell("L").value??"").trim();if(!Le||Le.toLowerCase()!=="base exp")return;const Ge=parseNumber(Ce);if(Ge===null){Q++,sopLog$1("base-exp:skip-row",{row:Se,reason:"Valor PVP no numérico",pvpValue:Ce});return}if(!De||!_e){Q++,sopLog$1("base-exp:skip-row",{row:Se,reason:"Celdas K o L vacías",cellK:De,cellL:_e});return}const Ye=Number(Ge.toFixed(2)),ot=fe.getCell(De),st=fe.getCell(_e);ot.value=Ye,st.value=Ye,W++;const ht=String(xe.getCell("C").value??"").trim(),Je=String(xe.getCell("D").value??"").trim(),nt=xe.getCell("A").value,ct=xe.getCell("F").value;sopLog$1("base-exp:write-success",{row:Se,service:ht,zone:Je,weight_from:nt,weight_to:ct,pvp:Ye,cellK:De,cellL:_e})}catch(Ce){Q++,sopLog$1("base-exp:write-error",{row:Se,error:Ce instanceof Error?Ce.message:String(Ce)})}}),sopLog$1("base-exp:complete",{totalProcessed:W,totalSkipped:Q})},Ee=he=>{const pe=Ve=>{const ee=[Ve];return Ve.startsWith("_")&&ee.push(Ve.slice(1)),Ve.includes("Retun")&&ee.push(Ve.replace("Retun","Return")),Ve.includes("(martitimo)")&&(ee.push(Ve.replace("(martitimo)","(maritimo)")),ee.push(Ve.replace("(martitimo)","(marítimo)"))),Ve.includes("(maritimo)")&&ee.push(Ve.replace("(maritimo)","(marítimo)")),ee.reduce((ne,ve)=>ne??he.getWorksheet(ve),null)},fe=(Ve,ee,ne)=>{Ve.forEach(({sheet:ve,cell:we})=>{const Te=pe(ve);if(!Te)return;const We=Te.getCell(we);if(ne!=null&&ne.percent){if(ee===null||ee==="")We.value=null;else{const $e=typeof ee=="number"?ee:parseNumber(ee);$e===null?We.value=null:(We.value=Number(($e/100).toFixed(6)),We.numFmt="0.00%")}return}ee===null||ee===""?We.value="":We.value=ee})},W=new Date().toISOString().slice(0,10),Q=new Date;Q.setMonth(11,31);const xe=Q.toISOString().slice(0,10),Se=N.validFrom||W,Ce=N.validTo||xe,Le=parseNumber(N.reimbursementPercent),De=parseNumber(N.reimbursementMinimum),_e=parseNumber(N.reimbursementMax),Ge=parseNumber(N.reimbursementFixed),Ye=parseNumber(N.optionalInsurance),ot=parseNumber(N.energySurcharge),st=parseNumber(N.climateProtect);fe([{sheet:"Express 8_30",cell:"H7"},{sheet:"Express 10_30",cell:"H7"},{sheet:"Express 14.00",cell:"H7"},{sheet:"Express19.00",cell:"L9"},{sheet:"BusinessParcel",cell:"L9"},{sheet:"BusinessParcel_Tránsito",cell:"H9"},{sheet:"_EconomyParcel",cell:"H9"},{sheet:"_EconomyParcel (martitimo)",cell:"H9"},{sheet:"EconomyParcel (maritimo)",cell:"H9"},{sheet:"ShopDeliveryService & ShopRetun",cell:"H6"}],N.clientName||""),fe([{sheet:"Express 8_30",cell:"C7"},{sheet:"Express 10_30",cell:"C7"},{sheet:"Express 14.00",cell:"C7"},{sheet:"Express19.00",cell:"D9"},{sheet:"BusinessParcel",cell:"D9"},{sheet:"BusinessParcel_Tránsito",cell:"D9"},{sheet:"_EconomyParcel",cell:"D9"},{sheet:"_EconomyParcel (martitimo)",cell:"D9"},{sheet:"EconomyParcel (maritimo)",cell:"D9"},{sheet:"ShopDeliveryService & ShopRetun",cell:"C6"}],N.agencyNameNumber||""),fe([{sheet:"Express 8_30",cell:"C8"},{sheet:"Express 10_30",cell:"C8"},{sheet:"Express 14.00",cell:"C8"},{sheet:"Express19.00",cell:"D10"},{sheet:"BusinessParcel",cell:"D10"},{sheet:"BusinessParcel_Tránsito",cell:"D10"},{sheet:"_EconomyParcel",cell:"D10"},{sheet:"_EconomyParcel (martitimo)",cell:"D10"},{sheet:"EconomyParcel (maritimo)",cell:"D10"},{sheet:"ShopDeliveryService & ShopRetun",cell:"C7"}],Se),fe([{sheet:"Express 8_30",cell:"H8"},{sheet:"Express 10_30",cell:"H8"},{sheet:"Express 14.00",cell:"H8"},{sheet:"Express19.00",cell:"L10"},{sheet:"BusinessParcel",cell:"L10"},{sheet:"BusinessParcel_Tránsito",cell:"H10"},{sheet:"_EconomyParcel",cell:"H10"},{sheet:"_EconomyParcel (martitimo)",cell:"H10"},{sheet:"EconomyParcel (maritimo)",cell:"H10"},{sheet:"ShopDeliveryService & ShopRetun",cell:"H7"}],Ce);const ft=[{sheet:"Express 8_30",cell:"F38"},{sheet:"Express 10_30",cell:"F39"},{sheet:"Express 14.00",cell:"G46"},{sheet:"Express19.00",cell:"L36"},{sheet:"BusinessParcel",cell:"L39"},{sheet:"_EconomyParcel",cell:"F37"},{sheet:"_EconomyParcel (martitimo)",cell:"G41"},{sheet:"EconomyParcel (maritimo)",cell:"G41"}];sopLog$1("commissionTargets values:",{reimbursementFixed:Ge,reimbursementPercent:Le,valueToWrite:Ge!==0?"":Le!==null?Le.toFixed(2):"",rawReimbursementPercent:N.reimbursementPercent});const pt=Ge!==0?"":Le!==null?Le.toFixed(2):"";fe(ft,pt,{percent:!0}),fe([{sheet:"Express 8_30",cell:"G38"},{sheet:"Express 10_30",cell:"G39"},{sheet:"Express 14.00",cell:"H46"},{sheet:"Express19.00",cell:"N36"},{sheet:"BusinessParcel",cell:"N39"},{sheet:"_EconomyParcel",cell:"G37"},{sheet:"_EconomyParcel (martitimo)",cell:"H41"},{sheet:"EconomyParcel (maritimo)",cell:"H41"}],De!==null?De.toFixed(2):"",{}),fe([{sheet:"Express 8_30",cell:"H38"},{sheet:"Express 10_30",cell:"H39"},{sheet:"Express 14.00",cell:"I46"},{sheet:"Express19.00",cell:"P36"},{sheet:"BusinessParcel",cell:"P39"},{sheet:"_EconomyParcel",cell:"H37"},{sheet:"_EconomyParcel (martitimo)",cell:"I41"},{sheet:"EconomyParcel (maritimo)",cell:"I41"}],_e!==null?_e.toFixed(2):"",{});const je=[{sheet:"Express 8_30",cell:"I38"},{sheet:"Express 10_30",cell:"I39"},{sheet:"Express 14.00",cell:"J46"},{sheet:"Express19.00",cell:"R36"},{sheet:"BusinessParcel",cell:"R39"},{sheet:"_EconomyParcel",cell:"I37"},{sheet:"_EconomyParcel (martitimo)",cell:"J41"},{sheet:"EconomyParcel (maritimo)",cell:"J41"}];sopLog$1("fixedTargets values:",{reimbursementFixed:Ge,reimbursementPercent:Le,valueToWrite:Le!==0?"":Ge!==null?Ge.toFixed(2):"",rawReimbursementFixed:N.reimbursementFixed});const Qe=Le!==0?"":Ge!==null?Ge.toFixed(2):"";fe(je,Qe,{}),fe([{sheet:"Express 8_30",cell:"I43"},{sheet:"Express 10_30",cell:"I44"},{sheet:"Express 14.00",cell:"J50"},{sheet:"Express19.00",cell:"R44"},{sheet:"BusinessParcel",cell:"R44"},{sheet:"_EconomyParcel",cell:"I43"},{sheet:"_EconomyParcel (martitimo)",cell:"J43"},{sheet:"EconomyParcel (maritimo)",cell:"J43"}],Ye!==null?Ye.toFixed(2):"",{percent:!0}),fe([{sheet:"Costes_Adicionales",cell:"G5"}],ot!==null?ot.toFixed(2):null,{percent:!0}),fe([{sheet:"Costes_Adicionales",cell:"G7"}],st!==null?st.toFixed(2):null,{percent:!0});const Ue=pe("cierre personalizado");Ue&&(Ue.getCell("H50").value=N.agencyAddress||"",Ue.getCell("H51").value=N.agencyPostalTown||"",Ue.getCell("H52").value=N.agencyProvince||"",Ue.getCell("H53").value=N.agencyEmail||"");const ze=pe("BusinessParcel_Tránsito");if(ze){for(let Ve=18;Ve<=53;Ve+=1){const ee=Ve-16;ze.getCell(`C${Ve}`).value={formula:`IFERROR(INDEX($N$2:$N$1222, S${ee}), "")`},ze.getCell(`D${Ve}`).value={formula:`IFERROR(INDEX($O$2:$O$1222, S${ee}), "")`}}ze.getCell("H13").value=N.agencyProvince}const Ke=(Ve,ee,ne,ve)=>{const we=Ve.getWorksheet(ee);if(!we)throw new Error(`La hoja '${ee}' no está disponible en la plantilla descargada.`);const Te=we.getCell(ne);if(!Te||!Te.value||typeof Te.value!="object"||!Te.value.formula)throw new Error(`La celda '${ne}' en la hoja '${ee}' no contiene una fórmula.`);const We=Te.value.formula,$e=ne.match(/\d+/);if(!$e)throw new Error(`La referencia de celda de origen '${ne}' es inválida.`);const tt=parseInt($e[0],10),[at,V]=ve.split(":"),ie=at.match(/[A-Z]+/),te=at.match(/\d+/),ae=V.match(/[A-Z]+/),le=V.match(/\d+/);if(!ie||!te||!ae||!le)throw new Error(`Rango '${ve}' inválido.`);const ce=ie[0].charCodeAt(0),Fe=ae[0].charCodeAt(0),He=parseInt(te[0],10),Oe=parseInt(le[0],10),Me=new RegExp(`([A-Z]+)${tt}(?!\\$)`,"g");for(let Be=He;Be<=Oe;Be++)for(let Ze=ce;Ze<=Fe;Ze++){const rt=String.fromCharCode(Ze)+Be,lt=we.getCell(rt),et=We.replace(Me,`$1${Be}`);lt&&(lt.value={formula:et})}};Ke(he,"BusinessParcel_Tránsito","Q2","Q3:Q1211"),Ke(he,"BusinessParcel_Tránsito","R2","R3:R1211"),Ke(he,"BusinessParcel_Tránsito","S2","S3:S1211")},Re=()=>N.clientName.trim()?N.agencyNameNumber.trim()?(I(null),!0):(I("Debes indicar el nombre y número de agencia."),!1):(I("Debes indicar el nombre del cliente o tarifa."),!1),Ne=async()=>{if(Re()&&!(typeof window<"u"&&!window.confirm('Se va a proceder a descargar el Soporte de Oferta (SOP) con los datos indicados. RECUERDE que debe revisar el resto de suplementos y costes indicados en las hojas antes de proceder a su impresión y/o envío al cliente, principal atención a las hojas: "Aduanas" y "Costes Adicionales".'))){U(!0),I(null);try{const he=await J();he.worksheets.forEach(Q=>{Q.eachRow({includeEmpty:!0},xe=>{xe.eachCell({includeEmpty:!0},Se=>{let Ce=Se.value;if(Ce&&typeof Ce=="object"){if("formula"in Ce)return;"result"in Ce&&Ce.result!==void 0?Ce=Ce.result:"text"in Ce?Ce=Ce.text:Ce=null}Se.value=Ce??null})})});const pe=he.getWorksheet("General");pe&&(pe.state="hidden",sopLog$1("hide-sheet","Hoja General oculta"));const fe=he.getWorksheet("base exp");fe&&(fe.state="hidden",sopLog$1("hide-sheet","Hoja base exp oculta"));const W=await he.xlsx.writeBuffer();downloadBuffer(W,`SOP_${Date.now()}.xlsx`,"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"),trackSOPDownload(b==null?void 0:b.id)}catch(he){console.error(he),I(he instanceof Error?he.message:"No se pudo generar el Excel de SOP.")}finally{U(!1)}}};return jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("button",{type:"button",onClick:C,disabled:g,className:`inline-flex items-center gap-2 px-4 py-2 rounded-lg border text-sm font-semibold transition-colors ${g?"bg-gray-200 text-gray-500 border-gray-200 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white border-blue-600"}`,children:[jsxRuntimeExports.jsx(FileSpreadsheet,{className:"h-4 w-4"}),"Generar SOP"]}),w&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col",children:[jsxRuntimeExports.jsxs("div",{className:"px-6 py-2 border-b border-gray-200 flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Generar documentación SOP"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500",children:"Completa los datos comerciales y descarga el Excel actualizado. El SOP cargará los datos de la pantalla principal (%Margen y demás datos aplicados)"}),jsxRuntimeExports.jsxs("p",{className:"text-xs mt-1 text-gray-500",children:[jsxRuntimeExports.jsx("span",{className:"font-bold text-red-600",children:"¡ATENCIÓN!"})," los datos del panel 'Comparador Comercial' sólo son exportable con Mini-SOP."]})]}),jsxRuntimeExports.jsx("button",{type:"button",onClick:P,className:"text-sm text-gray-500 hover:text-gray-700",children:"Cerrar"})]}),jsxRuntimeExports.jsxs("div",{className:"flex-1 overflow-y-auto px-6 py-4 space-y-6",children:[Z&&jsxRuntimeExports.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3 flex items-center gap-2",children:[jsxRuntimeExports.jsx("div",{className:"flex-shrink-0 w-2 h-2 bg-green-500 rounded-full"}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-green-800",children:[jsxRuntimeExports.jsx("strong",{children:"Datos precargados desde tu perfil."})," Puedes editarlos si es necesario."]})]}),y&&jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[jsxRuntimeExports.jsx(Loader2,{className:"h-4 w-4 animate-spin"}),"Descargando plantilla corporativa..."]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end",children:[jsxRuntimeExports.jsx("div",{className:"md:col-span-2",children:jsxRuntimeExports.jsxs("label",{className:"block text-xs font-semibold text-gray-600",children:["Plan comercial aplicable",jsxRuntimeExports.jsxs("select",{value:be,onChange:he=>de(he.target.value),className:"mt-1 w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[jsxRuntimeExports.jsx("option",{value:"",children:"Sin plan"}),oe.map(([he,pe])=>jsxRuntimeExports.jsx("option",{value:he,children:pe},he))]})]})}),se&&jsxRuntimeExports.jsx("div",{className:"text-xs text-blue-600 md:text-right",children:se})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsxs("label",{className:"block",children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-semibold text-gray-600",children:"Cliente / Tarifa (obligatorio)"}),jsxRuntimeExports.jsx("input",{type:"text",value:N.clientName,onChange:he=>D("clientName",he.target.value),className:"mt-1 w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Nombre del cliente o nombre para la tarifa"})]}),jsxRuntimeExports.jsxs("label",{className:"block",children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-semibold text-gray-600",children:"Nombre y nº de agencia (obligatorio)"}),jsxRuntimeExports.jsx("input",{type:"text",value:N.agencyNameNumber,onChange:he=>D("agencyNameNumber",he.target.value),className:"mt-1 w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Datos de tu agencia"})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[jsxRuntimeExports.jsxs("label",{className:"block",children:[jsxRuntimeExports.jsxs("span",{className:"text-xs font-semibold text-gray-600",children:["Validez desde",jsxRuntimeExports.jsx("span",{className:"ml-1 text-gray-400",children:"(en blanco HOY)"})]}),jsxRuntimeExports.jsx("input",{type:"date",value:N.validFrom,onChange:he=>D("validFrom",he.target.value),className:"mt-1 w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),jsxRuntimeExports.jsxs("label",{className:"block",children:[jsxRuntimeExports.jsxs("span",{className:"text-xs font-semibold text-gray-600",children:["Validez hasta",jsxRuntimeExports.jsx("span",{className:"ml-1 text-gray-400",children:"(en blanco 31/12/xx)"})]}),jsxRuntimeExports.jsx("input",{type:"date",value:N.validTo,onChange:he=>D("validTo",he.target.value),className:"mt-1 w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsxs("label",{className:"block",children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-semibold text-gray-600",children:"Dirección de la agencia"}),jsxRuntimeExports.jsx("input",{type:"text",value:N.agencyAddress,onChange:he=>D("agencyAddress",he.target.value),className:"mt-1 w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Calle y número"})]}),jsxRuntimeExports.jsxs("label",{className:"block",children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-semibold text-gray-600",children:"CP & Población"}),jsxRuntimeExports.jsx("input",{type:"text",value:N.agencyPostalTown,onChange:he=>D("agencyPostalTown",he.target.value),className:"mt-1 w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"ej: 28540 Valdemoro (Madrid)"})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[jsxRuntimeExports.jsxs("label",{className:"block",children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-semibold text-gray-600",children:"Provincia"}),jsxRuntimeExports.jsx("input",{type:"text",value:N.agencyProvince,onChange:he=>D("agencyProvince",he.target.value),className:"mt-1 w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),jsxRuntimeExports.jsxs("label",{className:"block",children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-semibold text-gray-600",children:"Email contacto agencia"}),jsxRuntimeExports.jsx("input",{type:"email",value:N.agencyEmail,onChange:he=>D("agencyEmail",he.target.value),className:"mt-1 w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[jsxRuntimeExports.jsxs("label",{className:"block",children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-semibold text-gray-600",children:"Comisión reembolsos (%)"}),jsxRuntimeExports.jsx("input",{type:"number",step:"0.01",value:N.reimbursementPercent,onChange:he=>B(he.target.value),disabled:L,className:`mt-1 w-full border rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent ${L?"bg-gray-100 text-gray-500 cursor-not-allowed border-gray-200":"border-gray-300"}`})]}),jsxRuntimeExports.jsxs("label",{className:"block",children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-semibold text-gray-600",children:"Importe mínimo (€)"}),jsxRuntimeExports.jsx("input",{type:"number",step:"0.01",value:N.reimbursementMinimum,onChange:he=>D("reimbursementMinimum",he.target.value),className:"mt-1 w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),jsxRuntimeExports.jsxs("label",{className:"block",children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-semibold text-gray-600",children:"Importe máximo (€)"}),jsxRuntimeExports.jsx("input",{type:"number",step:"0.01",value:N.reimbursementMax,onChange:he=>D("reimbursementMax",he.target.value),className:"mt-1 w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[jsxRuntimeExports.jsxs("label",{className:"block",children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-semibold text-gray-600",children:"Importe fijo (€)"}),jsxRuntimeExports.jsx("input",{type:"number",step:"0.01",value:N.reimbursementFixed,onChange:he=>G(he.target.value),disabled:S,className:`mt-1 w-full border rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent ${S?"bg-gray-100 text-gray-500 cursor-not-allowed border-gray-200":"border-gray-300"}`})]}),jsxRuntimeExports.jsxs("label",{className:"block",children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-semibold text-gray-600",children:"Suplemento de energía (%)"}),jsxRuntimeExports.jsx("input",{type:"number",step:"0.01",value:N.energySurcharge,onChange:he=>D("energySurcharge",he.target.value),className:"mt-1 w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),jsxRuntimeExports.jsxs("label",{className:"block",children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-semibold text-gray-600",children:"Climate Protect (%)"}),jsxRuntimeExports.jsx("input",{type:"number",step:"0.01",value:N.climateProtect,onChange:he=>D("climateProtect",he.target.value),className:"mt-1 w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),jsxRuntimeExports.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:jsxRuntimeExports.jsxs("label",{className:"block",children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-semibold text-gray-600",children:"Seguro opcional (%)"}),jsxRuntimeExports.jsx("input",{type:"number",step:"0.01",value:N.optionalInsurance,onChange:he=>D("optionalInsurance",he.target.value),className:"mt-1 w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),A&&jsxRuntimeExports.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 text-sm rounded-lg p-3",children:A})]}),jsxRuntimeExports.jsxs("div",{className:"px-6 py-4 border-t border-gray-200 flex items-center justify-between",children:[jsxRuntimeExports.jsx("div",{className:"text-xs text-gray-500",children:"La descarga genera un SOP completo con los datos indicados."}),jsxRuntimeExports.jsxs("button",{type:"button",onClick:Ne,disabled:!re||T,className:`inline-flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-semibold transition-colors ${!re||T?"bg-gray-200 text-gray-500 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white"}`,children:[T?jsxRuntimeExports.jsx(Loader2,{className:"h-4 w-4 animate-spin"}):jsxRuntimeExports.jsx(Download,{className:"h-4 w-4"}),"Descargar Excel"]})]})]})})]})},FTP_FILE_URL="https://www.logicalogistica.com/area-privada/base%20SOP%20FTP.xlsx",SERVICE_NAME_ALIASES={"express 8 30":"Urg8:30H Courier","express 830":"Urg8:30H Courier","express8 30":"Urg8:30H Courier","express 10 30":"Urg10H Courier","express 1030":"Urg10H Courier","express10 30":"Urg10H Courier","express 14 00":"Urg14H Courier","express 1400":"Urg14H Courier","express14 00":"Urg14H Courier","express 19 00":"Urg19H Courier","express 1900":"Urg19H Courier","express19 00":"Urg19H Courier","business parcel":"Business Parcel","economy parcel":"Economy Parcel",maritimo:"Marítimo","maritimo maritimo":"Marítimo","parcel shop":"Parcel Shop","eurobusiness parcel":"EuroBusiness Parcel"},BASE_RANGE_ALIASES={provincial:"provincial",prov:"provincial",regional:"regional",reg:"regional",nacional:"nacional",nacional_:"nacional",pen:"nacional",peninsula:"nacional",portugal:"portugal",port:"portugal",andorra:"andorra",gibraltar:"gibraltar",canarias_mayores:"canarias_mayores",can_my:"canarias_mayores",canarias_menores:"canarias_menores",can_mn:"canarias_menores",baleares_mayores:"baleares_mayores",bal_my:"baleares_mayores",baleares_menores:"baleares_menores",bal_mn:"baleares_menores",ceuta:"ceuta",melilla:"melilla",madeira_mayores:"madeira_mayores",madeira_mayores_maritimo:"madeira_mayores",madeiramayores:"madeira_mayores",madeiramayoresmaritimo:"madeira_mayores",mad_my:"madeira_mayores",madeira_menores:"madeira_menores",madeira_menores_maritimo:"madeira_menores",madeiramenores:"madeira_menores",madeiramenoresmaritimo:"madeira_menores",mad_mn:"madeira_menores",azores_mayores:"azores_mayores",azores_mayores_maritimo:"azores_mayores",azoresmayores:"azores_mayores",azoresmayoresmaritimo:"azores_mayores",az_my:"azores_mayores",azores_menores:"azores_menores",azores_menores_maritimo:"azores_menores",azoresmenores:"azores_menores",azoresmenoresmaritimo:"azores_menores",az_mn:"azores_menores"},createServiceKey=t=>t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/[^a-z0-9]+/g," ").trim(),resolveExcelServiceKey=t=>{const r=createServiceKey(t);if(!r)return null;const s=SERVICE_NAME_ALIASES[r]??t;return createServiceKey(s)||null},normalizeRangeName=t=>{if(!t)return null;const r=t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/_+/g,"_").replace(/^_|_$/g,"");let e="sal",s=r;const a=s.match(/_(sal|rec|int)$/);a?(e=a[1],s=s.slice(0,-a[0].length)):/_recogida?/.test(s)||/_rec\b/.test(s)?(e="rec",s=s.replace(/_recogida?/,"").replace(/_rec\b/,"")):/_interciudad/.test(s)||/_inter/.test(s)||/_int$/.test(s)?(e="int",s=s.replace(/_interciudad/,"").replace(/_inter/,"").replace(/_int$/,"")):/_salida/.test(s)&&(e="sal",s=s.replace(/_salida/,"")),s=s.replace(/_+/g,"_").replace(/^_|_$/g,"");const o=[s,s.replace(/_/g," "),s.replace(/_/g,"")].reduce((c,h)=>c||(BASE_RANGE_ALIASES[h]??null),null);return o?`${o}_${e}`:null},sanitizeFileName=t=>t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9\- ]/gi," ").trim().replace(/\s+/g,"-").toLowerCase(),__vite_import_meta_env__={},COMPARATOR_ZONE_TO_DB={"Prov.":"provincial","Reg.":"regional","Pen.":"nacional","Port.":"portugal","Can.My.":"canarias_mayores","Can.Mn.":"canarias_menores","Bal.My.":"baleares_mayores","Bal.Mn.":"baleares_menores",Ceuta:"ceuta",Melilla:"melilla"},COMPARATOR_COLUMN_TO_WEIGHT={"0 a 1kg":{from:0,to:1},"1 a 3kg":{from:1,to:3},"3 a 5kg":{from:3,to:5},"5 a 10kg":{from:5,to:10},"10 a 15kg":{from:10,to:15},"kg. adc":{from:15,to:999}},SOP_DEBUG_ENABLED=typeof import.meta<"u"&&typeof __vite_import_meta_env__<"u"&&!1,sopLog=(...t)=>{SOP_DEBUG_ENABLED&&console.log("[ComparatorMiniSOP]",...t)},findPriceInOfferTable=(t,r,e,s)=>{for(const[a,i]of Object.entries(COMPARATOR_ZONE_TO_DB)){if(i!==r)continue;const o=t[a];if(o){for(const[c,h]of Object.entries(COMPARATOR_COLUMN_TO_WEIGHT))if(h.from===e&&h.to===s){const u=o[c];if(Number.isFinite(u)&&u>0)return u}}}return null},writeToGeneralSheet=(t,r,e)=>{let s=0;const a=createServiceKey(r);return sopLog("Writing to General sheet for service:",r,"(key:",a,")"),t.eachRow((i,o)=>{if(o===1)return;const c=i.getCell("A").value,h=i.getCell("C").value,u=i.getCell("D").value,d=i.getCell("F").value;if(!h||!u)return;const _=resolveExcelServiceKey(String(h));if(!_||_!==a)return;const b=String(u).trim(),v=normalizeRangeName(b);if(!v){sopLog(`  Row ${o}: Could not resolve zone "${b}"`);return}const E=v.replace(/_(sal|rec|int)$/,""),x=Number(c),g=Number(d);if(!Number.isFinite(x)||!Number.isFinite(g))return;const w=findPriceInOfferTable(e,E,x,g);w!==null&&(i.getCell("G").value=Number(w.toFixed(2)),s++,sopLog(`  Row ${o}: ${v} ${x}-${g} = ${w.toFixed(2)}`))}),sopLog(`Updated ${s} cells in General sheet`),s},copyPricesToServiceSheet=(t,r,e)=>{let s=0;const a=createServiceKey(e);return sopLog("Copying prices to service sheet:",r.name),t.eachRow((i,o)=>{if(o===1)return;const c=i.getCell("C").value;if(!c)return;const h=resolveExcelServiceKey(String(c));if(!h||h!==a)return;const u=i.getCell("G").value,d=i.getCell("H").value,_=i.getCell("I").value;if(!u||!d||!_||typeof u!="number"||u<=0)return;const b=String(d).trim(),v=String(_).trim();if(b.toLowerCase()===r.name.toLowerCase())try{const E=r.getCell(v);E.value=Number(u.toFixed(2)),s++,sopLog(`  Copied ${u.toFixed(2)} to ${v}`)}catch(E){sopLog(`  Error copying to ${v}:`,E)}}),sopLog(`Copied ${s} prices to service sheet`),s},findServiceSheetFromGeneral=(t,r,e)=>{const s=createServiceKey(e),a=new Map;if(sopLog("Finding service sheet from General column H for service:",e),t.eachRow((o,c)=>{if(c===1)return;const h=o.getCell("C").value;if(!h)return;const u=resolveExcelServiceKey(String(h));if(!u||u!==s)return;const d=String(o.getCell("H").value??"").trim();d&&a.set(d,(a.get(d)||0)+1)}),a.size===0)return sopLog("  ✗ No sheet references found in General for this service"),null;const i=Array.from(a.entries()).sort((o,c)=>c[1]-o[1]);sopLog("  Sheet references found:",i);for(const[o,c]of i){const h=r.getWorksheet(o);if(h)return sopLog(`  ✓ Found sheet: "${o}" (${c} references)`),h}return sopLog("  ✗ No matching worksheet found for referenced sheet names"),null},ComparatorMiniSOPGenerator=({serviceName:t,offerTable:r})=>{const{user:e}=useAuth(),[s,a]=reactExports.useState(!1),[i,o]=reactExports.useState(!1),[c,h]=reactExports.useState(null),u=t||"Servicio",d=reactExports.useMemo(()=>{const b=sanitizeFileName(u),v=new Date().toISOString().split("T")[0];return b?`mini-sop-${b}-${v}.xlsx`:`mini-sop-${v}.xlsx`},[u]),_=async()=>{h(null),o(!0);try{sopLog("=== Starting MiniSOP generation ==="),sopLog("Service:",u),sopLog("Offer table:",r),sopLog("Step 1: Downloading template from FTP...");const b=await fetch(FTP_FILE_URL);if(!b.ok)throw new Error(`Failed to download template: ${b.statusText}`);const v=await b.arrayBuffer();sopLog("Step 2: Loading workbook...");const E=new exceljs_minExports.Workbook;await E.xlsx.load(v),sopLog("Step 3: Finding General sheet...");const x=E.getWorksheet("General");if(!x)throw new Error('No se encontró la hoja "General" en el archivo base del FTP');if(sopLog("Step 4: Writing prices to General sheet..."),writeToGeneralSheet(x,u,r)===0)throw new Error("No se pudieron escribir precios en la hoja General. Verifica que el servicio existe en el Excel.");sopLog("Step 5: Finding service-specific sheet from General references...");const w=findServiceSheetFromGeneral(x,E,u);if(!w)throw new Error(`No se encontró la hoja del servicio "${u}" en el Excel. Verifica que la hoja "General" contiene referencias válidas en la columna H para este servicio.`);if(sopLog("Step 6: Copying prices to service sheet..."),copyPricesToServiceSheet(x,w,u)===0)throw new Error('No se pudieron copiar precios a la hoja del servicio. Verifica las referencias en "General".');sopLog("Step 7: Hiding all sheets except the service sheet...");const N=w.name;let M=0;E.worksheets.forEach(T=>{T.name===N?(T.state="visible",sopLog(`  ✓ Keeping visible: "${T.name}"`)):(T.state="hidden",M++,sopLog(`  ○ Hiding: "${T.name}"`))}),sopLog(`  Hidden ${M} sheets, keeping "${N}" visible`),sopLog("Step 8: Setting service sheet as active sheet..."),E.views=[{activeTab:E.worksheets.findIndex(T=>T.name===N)}],sopLog("Step 9: Generating Excel buffer from modified workbook...");const A=await E.xlsx.writeBuffer();sopLog("Step 10: Downloading file...");const I=new Blob([A],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),y=URL.createObjectURL(I),j=document.createElement("a");j.href=y,j.download=d,j.click(),URL.revokeObjectURL(y),trackMiniSOPDownload(e==null?void 0:e.id),sopLog("=== MiniSOP generation complete ==="),a(!1)}catch(b){const v=b instanceof Error?b.message:"Error desconocido al generar MiniSOP";console.error("MiniSOP export failed:",b),h(v)}finally{o(!1)}};return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("button",{type:"button",onClick:()=>a(!0),className:"inline-flex items-center px-3 py-1.5 rounded-md bg-emerald-600 text-white text-xs font-semibold shadow hover:bg-emerald-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-emerald-500",children:[jsxRuntimeExports.jsx(FileSpreadsheet,{className:"h-3.5 w-3.5 mr-1.5"}),"Generar MiniSOP"]}),s&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 px-4",children:jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-lg w-full p-6 space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start justify-between",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Generar MiniSOP del Comparador"}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Se generará un Excel con la hoja del servicio ",jsxRuntimeExports.jsxs("span",{className:"font-semibold",children:["«",u,"»"]})," correspondiente a los precios mostrados."]})]}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>{a(!1),h(null)},className:"text-gray-500 hover:text-gray-700","aria-label":"Cerrar",disabled:i,children:jsxRuntimeExports.jsx(X,{className:"h-5 w-5"})})]}),jsxRuntimeExports.jsxs("div",{className:"rounded-md bg-blue-50 border border-blue-100 px-4 py-3 space-y-2",children:[jsxRuntimeExports.jsx("p",{className:"text-sm text-blue-900",children:jsxRuntimeExports.jsx("strong",{children:"Proceso:"})}),jsxRuntimeExports.jsxs("ol",{className:"text-sm text-blue-900 list-decimal list-inside space-y-1",children:[jsxRuntimeExports.jsx("li",{children:"Se procederá a la creación de una hoja SOP"}),jsxRuntimeExports.jsx("li",{children:'Revisa los precios en el panel "Precios a Ofrecer"'}),jsxRuntimeExports.jsx("li",{children:"El sistema copiará los precios a la hoja específica"}),jsxRuntimeExports.jsx("li",{children:"Se generará un Excel con solo esa hoja"}),jsxRuntimeExports.jsx("li",{children:"Puedes repetir el proceso con otros servicios y unificar después desde Excel para obtener un SOP completamente personalizado servicio a servicio"})]})]}),c&&jsxRuntimeExports.jsxs("div",{className:"rounded-md bg-red-50 border border-red-200 px-4 py-3 flex items-start gap-2",children:[jsxRuntimeExports.jsx(AlertCircle,{className:"h-5 w-5 text-red-600 flex-shrink-0 mt-0.5"}),jsxRuntimeExports.jsxs("div",{className:"text-sm text-red-900",children:[jsxRuntimeExports.jsx("p",{className:"font-semibold",children:"Error al generar MiniSOP:"}),jsxRuntimeExports.jsx("p",{className:"mt-1",children:c})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-end gap-2",children:[jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>{a(!1),h(null)},className:"inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200",disabled:i,children:"Cancelar"}),jsxRuntimeExports.jsx("button",{type:"button",onClick:_,className:"inline-flex items-center px-4 py-2 text-sm font-semibold text-white bg-emerald-600 rounded-md hover:bg-emerald-700 disabled:opacity-50 disabled:cursor-not-allowed",disabled:i,children:i?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"Generando..."]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Download,{className:"h-4 w-4 mr-2"}),"Descargar MiniSOP"]})})]})]})})]})},COMPARATOR_ZONES=["Prov.","Reg.","Pen.","Port.","Can.My.","Can.Mn.","Bal.My.","Bal.Mn.","Ceuta","Melilla"],COMPARATOR_COLUMNS=["0 a 1kg","1 a 3kg","3 a 5kg","5 a 10kg","10 a 15kg","kg. adc"],EDITABLE_BLOCKS=["competition","offer"],buildEditableSequence=()=>EDITABLE_BLOCKS.flatMap(t=>COMPARATOR_ZONES.flatMap(r=>COMPARATOR_COLUMNS.map(e=>({block:t,zone:r,column:e})))),getCellId=(t,r,e)=>`${t}__${r}__${e}`,blockHeaders={competition:{color:"bg-yellow-200",title:"Precios competencia",subtitle:"¡Recuerda! Otro GLS no es tu competencia."},agency:{color:"bg-blue-200",title:"Costes base agencia",subtitle:"Se actualiza según tarifa y plan asociado"},offer:{color:"bg-green-200",title:"Precios a ofrecer"}},PANEL_MARGIN=16,SLIDER_TICKS=Array.from({length:21},(t,r)=>r*5),sliderStyles=`
.comparator-slider {
  -webkit-appearance: none;
  appearance: none;
  width: 100%;
  height: 8px;
  background: transparent;
  cursor: pointer;
}

.comparator-slider:focus {
  outline: none;
}

.comparator-slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  height: 18px;
  width: 18px;
  border-radius: 9999px;
  background: #1d4ed8;
  border: 3px solid #ffffff;
  box-shadow: 0 0 0 1px rgba(29, 78, 216, 0.6);
}

.comparator-slider::-moz-range-thumb {
  height: 18px;
  width: 18px;
  border-radius: 9999px;
  background: #1d4ed8;
  border: 3px solid #ffffff;
  box-shadow: 0 0 0 1px rgba(29, 78, 216, 0.6);
}

.comparator-slider::-webkit-slider-runnable-track,
.comparator-slider::-moz-range-track {
  background: transparent;
}
`,CommercialComparatorPanel=({isOpen:t,onClose:r,tables:e,onValueChange:s,availableServices:a,selectedService:i,onServiceChange:o,discountPlans:c,selectedPlan:h,onPlanChange:u,offerMargin:d,onOfferMarginChange:_,offerAverageMargin:b,onReset:v,onMatchCompetition:E,sopLauncher:x})=>{const g=reactExports.useRef(null),w=reactExports.useRef(null),R=reactExports.useRef({pointerId:null,offsetX:0,offsetY:0}),[N,M]=reactExports.useState({x:PANEL_MARGIN,y:PANEL_MARGIN}),[A,I]=reactExports.useState(!1),[y,j]=reactExports.useState(null),[T,U]=reactExports.useState(""),F=reactExports.useMemo(buildEditableSequence,[]),[H,z]=reactExports.useState(()=>d.toFixed(2)),de="linear-gradient(90deg, #dc2626 0%, #f97316 20%, #facc15 35%, #bbf7d0 40%, #86efac 70%, #166534 100%)",se=Math.min(98,Math.max(2,d)),ue="w-full rounded-md border px-1.5 py-1 text-right text-[11px] focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition-colors",Z=P=>(Number.isFinite(P)?P:0).toLocaleString("es-ES",{minimumFractionDigits:2,maximumFractionDigits:2}),ge=P=>{const D=P.trim();if(!D)return 0;const B=D.includes(",")?D.replace(/\./g,"").replace(",","."):D,G=Number.parseFloat(B);return!Number.isFinite(G)||G<0?0:roundUp$1(G)},re=(P,D,B,G)=>{j({block:P,zone:D,column:B}),U(Z(G))},oe=()=>{if(!y)return;const{block:P,zone:D,column:B}=y,G=e[P][D][B],J=ge(T);Math.abs(J-G)>.004&&s(P,D,B,J),j(null)},be=(P,D)=>{const B=F.findIndex(me=>me.block===P.block&&me.zone===P.zone&&me.column===P.column);if(B===-1)return!1;const G=B+D;if(G<0||G>=F.length)return!1;const J=F[G],Y=e[J.block][J.zone][J.column];return re(J.block,J.zone,J.column,Y),requestAnimationFrame(()=>{var Re;const me=`input[data-cell-id="${getCellId(J.block,J.zone,J.column)}"]`,Ee=(Re=w.current)==null?void 0:Re.querySelector(me);Ee==null||Ee.focus(),Ee==null||Ee.select()}),!0},L=(P,D,B)=>{const J=Number.isFinite(D),Y=Number.isFinite(B),me={cellClass:"",inputClass:"border-gray-300 text-gray-900 bg-white"};if(J&&P<D-.01){const Ee=D-P,Re=Math.max(D,1),Ne=Math.min(Ee/Re,1);return Ne>.5?{cellClass:"bg-green-300/70",inputClass:"border-green-500 text-green-900 bg-white/70"}:Ne>.2?{cellClass:"bg-green-200/70",inputClass:"border-green-400 text-green-900 bg-white/70"}:{cellClass:"bg-green-100/70",inputClass:"border-green-300 text-green-900 bg-white/70"}}if(Y&&P>=(J?D-.01:P-.01)&&P<=B+.01){const Ee=Math.abs(B-P),Re=Math.max(B,1);return Math.min(Ee/Re,1)<.05?{cellClass:"bg-yellow-200/60",inputClass:"border-yellow-400 text-yellow-900 bg-white/70"}:{cellClass:"bg-yellow-100/60",inputClass:"border-yellow-300 text-yellow-900 bg-white/70"}}return me};reactExports.useEffect(()=>{var D;if(!t){j(null),U(""),z(d.toFixed(2));return}const P=B=>{B.key==="Escape"&&r()};return document.addEventListener("keydown",P),(D=g.current)==null||D.focus(),()=>{document.removeEventListener("keydown",P)}},[t,r,d]),reactExports.useEffect(()=>{t&&z(d.toFixed(2))},[t,d]),reactExports.useLayoutEffect(()=>{t&&requestAnimationFrame(()=>{var me,Ee;const{innerWidth:P,innerHeight:D}=window,B=((me=w.current)==null?void 0:me.offsetWidth)??0,G=((Ee=w.current)==null?void 0:Ee.offsetHeight)??0,J=Math.max((P-B)/2,PANEL_MARGIN),Y=Math.max((D-G)/2,PANEL_MARGIN);M({x:J,y:Y})})},[t]),reactExports.useEffect(()=>{if(!A)return;const P=B=>{M(G=>{var Re,Ne;const J=((Re=w.current)==null?void 0:Re.offsetWidth)??0,Y=((Ne=w.current)==null?void 0:Ne.offsetHeight)??0,me=Math.max(window.innerWidth-J-PANEL_MARGIN,PANEL_MARGIN),Ee=Math.max(window.innerHeight-Y-PANEL_MARGIN,PANEL_MARGIN);return{x:Math.min(Math.max(B.clientX-R.current.offsetX,PANEL_MARGIN),me),y:Math.min(Math.max(B.clientY-R.current.offsetY,PANEL_MARGIN),Ee)}})},D=B=>{if(R.current.pointerId!==null&&w.current)try{w.current.releasePointerCapture(R.current.pointerId)}catch{}R.current.pointerId=null,I(!1)};return window.addEventListener("pointermove",P),window.addEventListener("pointerup",D,{once:!0}),()=>{window.removeEventListener("pointermove",P),window.removeEventListener("pointerup",D)}},[A]);const S=P=>{if(w.current){if(P.target instanceof HTMLElement){const D=P.target.closest("button,select,input");if(D&&D!==P.currentTarget)return}R.current={pointerId:P.pointerId,offsetX:P.clientX-N.x,offsetY:P.clientY-N.y};try{w.current.setPointerCapture(P.pointerId)}catch{}I(!0)}},C=P=>{P.target instanceof HTMLElement&&P.target.closest("button,select,input")||S(P)};return t?jsxRuntimeExports.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[jsxRuntimeExports.jsx("style",{children:sliderStyles}),jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-black/40",role:"presentation",onClick:r}),jsxRuntimeExports.jsxs("aside",{ref:w,className:"absolute w-[98vw] max-w-[1400px] bg-white shadow-2xl border border-gray-200 rounded-2xl",style:{left:N.x,top:N.y},"aria-modal":"true",role:"dialog",children:[jsxRuntimeExports.jsx("div",{className:"border-b border-gray-200 px-6 py-4 rounded-t-2xl bg-white",children:jsxRuntimeExports.jsxs("div",{className:"flex flex-col gap-3",onPointerDown:C,children:[jsxRuntimeExports.jsx("div",{className:"flex items-start justify-between gap-3",children:jsxRuntimeExports.jsxs("div",{className:"flex flex-col",children:[jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Comparador comercial"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-500",children:"Introduce y compara precios manuales frente a los costes calculados."})]})}),jsxRuntimeExports.jsxs("div",{className:"grid w-full grid-cols-[auto_auto_auto_minmax(0,1fr)_auto_auto] items-end gap-3",children:[jsxRuntimeExports.jsx("button",{type:"button",ref:g,onClick:r,className:"inline-flex items-center px-3 py-2 text-sm font-medium text-gray-600 bg-gray-100 rounded-md hover:bg-gray-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-blue-500",children:"Cerrar"}),jsxRuntimeExports.jsxs("label",{className:"text-[11px] font-medium text-gray-800 w-44",children:["Servicio a comparar",jsxRuntimeExports.jsx("select",{className:"mt-1 w-full rounded-md border border-gray-300 px-2 py-1 text-sm focus:border-blue-500 focus:ring-1 focus:ring-blue-500",value:i,onChange:P=>o(P.target.value),children:a.map(P=>jsxRuntimeExports.jsx("option",{value:P,children:P},P))})]}),jsxRuntimeExports.jsxs("label",{className:"text-[11px] font-medium text-gray-800 w-48",children:["Plan comercial aplicable",jsxRuntimeExports.jsxs("select",{className:"mt-1 w-full rounded-md border border-gray-300 px-2 py-1 text-sm focus:border-blue-500 focus:ring-1 focus:ring-blue-500",value:h,onChange:P=>u(P.target.value),children:[jsxRuntimeExports.jsx("option",{value:"",children:"Sin plan"}),c.map(P=>jsxRuntimeExports.jsx("option",{value:P.id,children:P.plan_name},P.id))]})]}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col w-full min-w-[18rem]",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between text-[11px] text-gray-800",children:[jsxRuntimeExports.jsx("span",{children:"Margen objetivo sobre venta"}),jsxRuntimeExports.jsxs("span",{className:"font-semibold",children:[d.toFixed(0),"%"]})]}),jsxRuntimeExports.jsxs("div",{className:"relative w-full pt-5",children:[jsxRuntimeExports.jsx("div",{className:"absolute inset-x-0 top-1/2 h-2 -translate-y-1/2 rounded-full",style:{background:de},"aria-hidden":"true"}),jsxRuntimeExports.jsx("input",{type:"range",min:0,max:100,step:1,value:d,onChange:P=>{const D=Number(P.target.value);_(D),z(D.toFixed(2))},className:"comparator-slider relative z-10 w-full","aria-label":"Margen objetivo sobre venta"}),jsxRuntimeExports.jsx("div",{className:"absolute top-0 flex",style:{left:`${se}%`,transform:"translateX(-50%) translateY(-90%)"},"aria-hidden":"true",children:jsxRuntimeExports.jsxs("span",{className:"px-2 py-1 text-[10px] font-semibold text-white bg-gray-900 rounded-full shadow",children:[d.toFixed(0),"%"]})})]}),jsxRuntimeExports.jsx("div",{className:"grid text-[9px] text-gray-600",style:{gridTemplateColumns:"repeat(21, minmax(0, 1fr))"},"aria-hidden":"true",children:SLIDER_TICKS.map(P=>jsxRuntimeExports.jsx("span",{className:"text-center",children:P},P))}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between text-[11px] text-gray-800",children:[jsxRuntimeExports.jsx("span",{children:"Margen medio actual"}),jsxRuntimeExports.jsxs("span",{className:"font-semibold",children:[b.toFixed(2),"%"]})]}),jsxRuntimeExports.jsxs("label",{className:"mt-2 text-[11px] font-medium text-gray-800",children:["Margen deseado (%)",jsxRuntimeExports.jsx("input",{type:"text",inputMode:"decimal",pattern:"[0-9.,]*",value:H,onChange:P=>{z(P.target.value)},onBlur:()=>{const P=ge(H),D=Math.min(100,Math.max(0,P));_(D),z(D.toFixed(2))},onKeyDown:P=>{if(P.key==="Enter"){P.preventDefault();const D=ge(H),B=Math.min(100,Math.max(0,D));_(B),z(B.toFixed(2))}},className:"mt-1 w-full rounded-md border border-gray-300 px-2 py-1 text-sm text-right focus:border-blue-500 focus:ring-1 focus:ring-blue-500"})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex flex-wrap items-center justify-end gap-3 text-[11px] text-gray-600",children:[x,jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>{j(null),U(""),v()},className:"inline-flex items-center px-3 py-2 text-sm font-medium text-blue-600 bg-blue-50 rounded-md hover:bg-blue-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-blue-500",children:"Limpiar"}),jsxRuntimeExports.jsx("span",{className:"max-w-xs text-left",children:"Para reiniciar por completo y perder los cambios, cierre el comparador y pulse «Limpiar datos» en el panel principal."})]})]})]})}),jsxRuntimeExports.jsxs("div",{className:"px-6 py-6 space-y-8 max-h-[82vh] overflow-y-auto",children:[jsxRuntimeExports.jsx("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-6",children:["competition","agency","offer"].map(P=>jsxRuntimeExports.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-xl shadow-sm",children:[jsxRuntimeExports.jsx("div",{className:`${blockHeaders[P].color} px-4 py-3 border-b border-gray-200 rounded-t-xl`,children:jsxRuntimeExports.jsxs("div",{className:"flex items-start justify-between gap-3",children:[jsxRuntimeExports.jsxs("div",{className:"space-y-1.5",children:[jsxRuntimeExports.jsx("h3",{className:"text-sm font-semibold text-gray-900 uppercase tracking-wide",children:blockHeaders[P].title}),jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-700 font-medium",children:blockHeaders[P].subtitle})]}),P==="offer"&&jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("button",{type:"button",onClick:E,className:"inline-flex items-center px-3 py-1.5 rounded-md bg-green-600 text-white text-xs font-semibold shadow hover:bg-green-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-green-500",children:"Ajustar a la competencia"}),jsxRuntimeExports.jsx(ComparatorMiniSOPGenerator,{serviceName:i,offerTable:e.offer})]})]})}),jsxRuntimeExports.jsx("div",{className:"p-4",children:jsxRuntimeExports.jsxs("table",{className:"w-full table-fixed text-[11px]",children:[jsxRuntimeExports.jsx("thead",{children:jsxRuntimeExports.jsxs("tr",{children:[jsxRuntimeExports.jsx("th",{className:"text-left font-semibold text-gray-700 pb-2 pr-2",children:"Zona"}),COMPARATOR_COLUMNS.map(D=>jsxRuntimeExports.jsx("th",{className:"text-center font-semibold text-gray-700 pb-2 px-1",children:D},D))]})}),jsxRuntimeExports.jsx("tbody",{className:"divide-y divide-gray-200",children:COMPARATOR_ZONES.map(D=>jsxRuntimeExports.jsxs("tr",{children:[jsxRuntimeExports.jsx("th",{className:"text-left font-medium text-gray-700 py-2 pr-2",children:D}),COMPARATOR_COLUMNS.map(B=>{const G=e[P][D][B],J=Number.isFinite(G)?Number(G):0;if(P==="competition")return jsxRuntimeExports.jsx("td",{className:"px-1 py-1.5",children:jsxRuntimeExports.jsx("input",{type:"text",inputMode:"decimal",pattern:"[0-9.,]*","data-cell-id":getCellId(P,D,B),value:y&&y.block===P&&y.zone===D&&y.column===B?T:Z(J),onFocus:Re=>{re(P,D,B,J),Re.target.select()},onBlur:()=>{oe()},onKeyDown:Re=>{if(Re.key==="Enter"&&(Re.preventDefault(),oe()),Re.key==="Tab"){const Ne={block:P,zone:D,column:B};oe(),be(Ne,Re.shiftKey?-1:1)&&Re.preventDefault()}},onChange:Re=>{y&&y.block===P&&y.zone===D&&y.column===B||re(P,D,B,J),U(Re.target.value)},className:`${ue} border-gray-300 text-gray-900 bg-white`})},B);if(P==="offer"){const Re=e.competition[D][B],Ne=e.agency[D][B],{cellClass:he,inputClass:pe}=L(J,Number(Re),Number(Ne));return jsxRuntimeExports.jsx("td",{className:`px-1 py-1.5 text-right text-[11px] ${he}`,children:jsxRuntimeExports.jsx("input",{type:"text",inputMode:"decimal",pattern:"[0-9.,]*","data-cell-id":getCellId(P,D,B),value:y&&y.block===P&&y.zone===D&&y.column===B?T:Z(J),onFocus:fe=>{re(P,D,B,J),fe.target.select()},onBlur:()=>{oe()},onKeyDown:fe=>{if(fe.key==="Enter"&&(fe.preventDefault(),oe()),fe.key==="Tab"){const W={block:P,zone:D,column:B};oe(),be(W,fe.shiftKey?-1:1)&&fe.preventDefault()}},onChange:fe=>{y&&y.block===P&&y.zone===D&&y.column===B||re(P,D,B,J),U(fe.target.value)},className:`${ue} ${pe}`})},B)}const Y=e.competition[D][B],me=J-(Number.isFinite(Y)?Number(Y):0);let Ee="";if(me>.01){const Re=Number.isFinite(Y)?Math.max(Number(Y),.01):1,Ne=Math.min(me/Re,1);Ne>.5?Ee=" bg-red-300":Ne>.2?Ee=" bg-red-200":Ee=" bg-red-100"}return jsxRuntimeExports.jsx("td",{className:`px-1 py-1.5 text-right text-[11px]${Ee}`,children:jsxRuntimeExports.jsx("span",{className:"inline-block w-full rounded-md border border-transparent bg-white/60 px-1 py-1 text-right font-semibold text-gray-900",children:J.toLocaleString("es-ES",{minimumFractionDigits:2,maximumFractionDigits:2})})},B)})]},D))})]})})]},P))}),jsxRuntimeExports.jsxs("div",{className:"mt-4 flex flex-wrap gap-4 text-[11px] text-gray-600",children:[jsxRuntimeExports.jsxs("span",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:"h-3 w-3 rounded bg-yellow-200/60 border border-yellow-400","aria-hidden":"true"}),"Margen igual o inferior al coste."]}),jsxRuntimeExports.jsxs("span",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:"h-3 w-3 rounded bg-green-200/70 border border-green-400","aria-hidden":"true"}),"PVP inferior al precio de la competencia."]}),jsxRuntimeExports.jsxs("span",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:"h-3 w-3 rounded bg-red-200 border border-red-400","aria-hidden":"true"}),"Coste agencia superior a la competencia."]})]})]})]})]}):null},buildEmptyBreakdowns=()=>{const t={};return DESTINATION_ZONES.forEach(r=>{t[r]=createEmptyCostBreakdown()}),t},createDefaultPackage=()=>({id:`pkg-${Date.now().toString(36)}`,weight:1,finalWeight:1,quantity:1}),createEmptyComparatorTable=()=>COMPARATOR_ZONES.reduce((t,r)=>(t[r]=COMPARATOR_COLUMNS.reduce((e,s)=>(e[s]=0,e),{}),t),{}),createInitialComparatorState=()=>({competition:createEmptyComparatorTable(),agency:createEmptyComparatorTable(),offer:createEmptyComparatorTable()}),createEmptyComparatorManualFlags=()=>COMPARATOR_ZONES.reduce((t,r)=>(t[r]=COMPARATOR_COLUMNS.reduce((e,s)=>(e[s]=!1,e),{}),t),{}),COMPARATOR_ZONE_TO_DESTINATION={"Prov.":"Provincial","Reg.":"Regional","Pen.":"Nacional","Port.":"Portugal","Can.My.":"Canarias Mayores","Can.Mn.":"Canarias Menores","Bal.My.":"Baleares Mayores","Bal.Mn.":"Baleares Menores",Ceuta:"Ceuta",Melilla:"Melilla"},COMPARATOR_COLUMN_WEIGHTS={"0 a 1kg":1,"1 a 3kg":3,"3 a 5kg":5,"5 a 10kg":10,"10 a 15kg":15,"kg. adc":16},SERVICE_INCREMENT_RULES={"Urg8:30H Courier":{base:9,overrides:{"Canarias Mayores":10,"Canarias Menores":10}},"Urg10H Courier":{base:9,overrides:{"Canarias Mayores":10,"Canarias Menores":10,"Baleares Mayores":10,"Baleares Menores":10}},"Urg14H Courier":{base:9,overrides:{"Canarias Mayores":10,"Canarias Menores":10,"Baleares Mayores":10,"Baleares Menores":10}},"Urg19H Courier":{base:6,overrides:{"Canarias Mayores":10,"Canarias Menores":10,"Baleares Mayores":10,"Baleares Menores":10}},"Economy Parcel":{base:2,overrides:{"Canarias Mayores":4,"Canarias Menores":4,"Baleares Mayores":4,"Baleares Menores":4}},Marítimo:{base:4,overrides:{}},"Business Parcel":{base:0,overrides:{"Canarias Mayores":4,"Canarias Menores":4}},"EuroBusiness Parcel":{base:0,overrides:{}},"Parcel Shop":{base:0,overrides:{}}},EXPRESS_SERVICES=new Set(["Urg8:30H Courier","Urg10H Courier","Urg14H Courier"]),SERVICE_INCREMENT_2025_RULES={"Urg8:30H Courier":{Provincial:5,Regional:5,Nacional:5,Portugal:5,"Baleares Mayores":5,"Baleares Menores":5},"Urg10H Courier":{Provincial:5,Regional:5,Nacional:5,Portugal:5,"Baleares Mayores":5,"Baleares Menores":5},"Urg14H Courier":{Provincial:5,Regional:5,Nacional:5,Portugal:5,"Baleares Mayores":5,"Baleares Menores":5},"Urg19H Courier":{Provincial:3,Regional:3,Nacional:3,Portugal:3,Andorra:3,Gibraltar:3}},UNIVERSAL_2025_OVERRIDES={"Canarias Mayores":3,"Canarias Menores":3,"Baleares Mayores":3,"Baleares Menores":3},ISLAND_ONLY_2025_SERVICES=new Set(["Business Parcel","Economy Parcel","Marítimo","Parcel Shop"]),IRREGULAR_SURCHARGE=7,ZERO_MILEAGE_TOTALS={cost:0,sale:0},computeMileageTotals=(t,r,e,s,a)=>{if(!(s==="Urg10H Courier"||s==="Urg14H Courier"&&a)||!Number.isFinite(t)||t<=0)return ZERO_MILEAGE_TOTALS;const o=Number.isFinite(r)?r:0;return{cost:roundUp$1(t*e),sale:roundUp$1(t*o)}},getServiceIncrementConfig=t=>{const r=SERVICE_INCREMENT_RULES[t];return r?{base:r.base,overrides:r.overrides??{}}:{base:0,overrides:{}}},getZoneIncrement=(t,r)=>{const e=getServiceIncrementConfig(t);return e.overrides[r]??e.base},getZoneIncrement2025=(t,r)=>{const e=SERVICE_INCREMENT_2025_RULES[t],s=(e==null?void 0:e[r])??0;if(t==="EuroBusiness Parcel")return s;const a=UNIVERSAL_2025_OVERRIDES[r]??0;return Math.max(s,a)},getMaxIncrement2025ForService=t=>DESTINATION_ZONES.reduce((r,e)=>Math.max(r,getZoneIncrement2025(t,e)),0),TariffCalculator=()=>{var cs;const{userData:t,signOut:r}=useAuth(),{viewMode:e,setViewMode:s,isAdminView:a}=useViewMode(),[i,o]=reactExports.useState(!1),[c,h]=reactExports.useState(!1),[u,d]=reactExports.useState(!1),[_,b]=reactExports.useState(0),{tariffs:v=[],loading:E=!0}=useTariffs(void 0,!1,!0,_)??{},{discountPlans:x=[]}=useDiscountPlans()??{},{activeStates:g=[],refetch:w}=useCustomTariffsActive(t==null?void 0:t.id)??{},{preferences:R}=usePreferences(),[N,M]=reactExports.useState(STATIC_SERVICES[0]),A=reactExports.useMemo(()=>g.some(qe=>qe.service_name===N&&qe.is_active),[g,N]),[I,y]=reactExports.useState(40),[j,T]=reactExports.useState(""),[U,F]=reactExports.useState(""),H=reactExports.useRef(null),[z,de]=reactExports.useState(()=>[createDefaultPackage()]),[se,ue]=reactExports.useState("salida"),[Z,ge]=reactExports.useState(0),[re,oe]=reactExports.useState(0),[be,L]=reactExports.useState(0),[S,C]=reactExports.useState(0),[P,D]=reactExports.useState(0),[B,G]=reactExports.useState(0),[J,Y]=reactExports.useState(0),[me,Ee]=reactExports.useState({}),[Re,Ne]=reactExports.useState(!1),[he,pe]=reactExports.useState(!1),[fe,W]=reactExports.useState(0),[Q,xe]=reactExports.useState(null),[Se,Ce]=reactExports.useState(()=>buildEmptyBreakdowns()),[Le,De]=reactExports.useState([]),[_e,Ge]=reactExports.useState([]),[Ye,ot]=reactExports.useState(!1),[st,ht]=reactExports.useState(!1),[Je,nt]=reactExports.useState(!1),[ct,ft]=reactExports.useState(()=>createInitialComparatorState()),[pt,Xe]=reactExports.useState(40),[Pe,je]=reactExports.useState(()=>createEmptyComparatorManualFlags()),[Qe,ut]=reactExports.useState(N),K=reactExports.useRef(!1),[ye,Ue]=reactExports.useState(!1),{plans:ze,loadPlans:Ke}=useCommercialPlans(),[Ve,ee]=reactExports.useState(null),ne=reactExports.useMemo(()=>ze.find(qe=>qe.id===Ve)||null,[ze,Ve]),ve=reactExports.useMemo(()=>{const qe=ze.flatMap(it=>["Urg8:30H Courier","Urg10H Courier","Urg14H Courier","Urg19H Courier","Business Parcel","Economy Parcel","EuroBusiness Parcel"].map(xt=>({id:`user-plan-${it.id}-${xt}`,plan_name:it.plan_name,service_name:xt,discount_type:"custom",discount_value:0,min_volume:0,applies_to:"cost",is_active:!0,created_at:it.created_at,_userPlanId:it.id})));return[...x,...CUSTOM_DISCOUNT_PLANS,...qe]},[x,ze]),we=reactExports.useMemo(()=>ve.filter(qe=>qe.service_name===N&&qe.is_active),[ve,N]),Te=reactExports.useMemo(()=>findPlanForServiceGroup(ve,U,N)??null,[ve,U,N]),We=reactExports.useMemo(()=>{if(!U)return"";const qe=ve.find(it=>getPlanGroupKey(it)===U);return(qe==null?void 0:qe.plan_name)??""},[ve,U]),$e=reactExports.useMemo(()=>ve.filter(qe=>qe.service_name===Qe&&qe.is_active),[ve,Qe]),tt=reactExports.useMemo(()=>findPlanForServiceGroup(ve,U,Qe)??null,[ve,U,Qe]),at=(tt==null?void 0:tt.id)??"",V=reactExports.useMemo(()=>getServiceIncrementConfig(N),[N]),ie=reactExports.useMemo(()=>getMaxIncrement2025ForService(N),[N]),te=reactExports.useMemo(()=>{let qe=0,it=!1;z.forEach(xt=>{var gt,Ft,jt;const Et=Math.max(1,Math.round(xt.quantity??1));if(Et<=0)return;const At=((gt=xt.dimensions)==null?void 0:gt.height)??0,yt=((Ft=xt.dimensions)==null?void 0:Ft.width)??0,_t=((jt=xt.dimensions)==null?void 0:jt.length)??0,Ct=At+yt+_t,Tt=Math.max(At,yt,_t),wt=xt.weight??0;(Ct>300||Tt>200||wt>40)&&(qe+=Et),Tt>120&&(it=!0)});const vt=qe*IRREGULAR_SURCHARGE;return{irregularCount:qe,autoIrregularCost:vt,hasIrregularPackages:qe>0,hasNonEncintablePackages:it}},[z]);reactExports.useEffect(()=>{C(te.autoIrregularCost)},[te.autoIrregularCost]);const ae=reactExports.useMemo(()=>EXPRESS_SERVICES.has(N)&&te.hasIrregularPackages,[te.hasIrregularPackages,N]),le=te.hasNonEncintablePackages,ce=.34,Fe=reactExports.useMemo(()=>computeMileageTotals(B,J,ce,N,he),[B,J,ce,he,N]),He=Fe.cost,Oe=Fe.sale,Me=N==="Urg10H Courier"||N==="Urg14H Courier"&&he,Be=reactExports.useMemo(()=>{if(E||!Qe)return createEmptyComparatorTable();const qe=v.filter(Tt=>Tt.service_name===Qe);if(!qe.length)return createEmptyComparatorTable();const it=isParcelShopService(Qe),vt=U||ne||it?0:P,xt=Qe==="Urg14H Courier"&&he?2.5:0,At=!!(at?getCustomPlanDefinition(at):void 0),yt=getEnergyRateForService(Qe),_t=(Tt,wt,Nt,gt)=>{if(Tt<=0)return null;const jt=computeZoneCostForPackage({weight:Tt},Qe,wt,se,qe);if(!jt.available)return null;const Ot=roundUp$1(jt.cost),kt=jt.finalWeight??Tt;let Vt=0;if(tt)if(tt.id.startsWith("user-plan-")){const lr=tt._userPlanId,Zt=ze.find(cr=>cr.id===lr);Zt&&(Vt=calculateCustomPlanDiscount(qe,Zt,Qe,wt,kt,se))}else(tt.discount_type!=="custom"||At)&&(Vt=calculatePlanDiscountForWeight(qe,Qe,wt,tt,kt,se));return calculateCostBreakdown(Ot,Nt,gt,Z,re,be,S,vt,xt,0,{planDiscountAmount:Vt,energyRate:yt,serviceName:Qe})},Ct=createEmptyComparatorTable();return COMPARATOR_ZONES.forEach(Tt=>{const wt=COMPARATOR_ZONE_TO_DESTINATION[Tt];if(!wt)return;const Nt=getZoneIncrement(Qe,wt),gt=getZoneIncrement2025(Qe,wt);COMPARATOR_COLUMNS.forEach(Ft=>{let jt=0;if(Ft==="kg. adc"){const Ot=_t(15,wt,Nt,gt),kt=_t(COMPARATOR_COLUMN_WEIGHTS[Ft],wt,Nt,gt);Ot&&kt?jt=roundUp$1(Math.max(0,kt.totalCost-Ot.totalCost)):kt&&(jt=roundUp$1(kt.totalCost))}else{const Ot=COMPARATOR_COLUMN_WEIGHTS[Ft],kt=_t(Ot,wt,Nt,gt);kt&&(jt=roundUp$1(kt.totalCost))}Ct[Tt][Ft]=Number.isFinite(jt)?jt:0})}),Ct},[Qe,Z,S,P,he,at,tt,U,se,re,be,v,E,ze,ne]),Ze=reactExports.useMemo(()=>({...ct,agency:Be}),[Be,ct]);reactExports.useEffect(()=>{je(createEmptyComparatorManualFlags())},[Qe,at]),reactExports.useEffect(()=>{if(K.current){K.current=!1;return}ft(qe=>{let it=!1;const vt=COMPARATOR_ZONES.reduce((xt,Et)=>{const At=qe.offer[Et];let yt=!1;const _t={...At};return COMPARATOR_COLUMNS.forEach(Ct=>{if(Pe[Et][Ct])return;const Tt=Be[Et][Ct],wt=Math.max(1-pt/100,.01),Nt=Number.isFinite(Tt)?roundUp$1(Tt/wt):0;Math.abs(_t[Ct]-Nt)>.005&&(_t[Ct]=Nt,yt=!0)}),yt?(it=!0,xt[Et]=_t):xt[Et]=At,xt},{});return it?{...qe,offer:vt}:qe})},[Be,Pe,pt]);const rt=reactExports.useMemo(()=>{let qe=0,it=0;COMPARATOR_ZONES.forEach(xt=>{COMPARATOR_COLUMNS.forEach(Et=>{const At=Be[xt][Et],yt=ct.offer[xt][Et];if(Number.isFinite(At)&&Number.isFinite(yt)&&yt>0){const _t=COMPARATOR_COLUMN_WEIGHTS[Et];qe+=At*_t,it+=yt*_t}})});const vt=it>0?(it-qe)/it*100:0;return{totalCost:qe,totalOffer:it,margin:vt}},[Be,ct.offer]),lt=reactExports.useMemo(()=>{if(Te){if(Te.discount_type==="custom"){let qe=0,it=0;z.forEach(xt=>{const Et=Math.max(1,Math.round(xt.quantity??1));if(Et<=0)return;const At=xt.finalWeight??xt.weight??0,yt=getCustomPlanPercentage(Te.id,N,At);qe+=yt*Et,it+=Et});const vt=it>0?qe/it:0;return{value:Te.plan_name,description:it>0&&vt>0?`Descuento medio aplicado: ${formatPercentage(vt)}`:"Aplicado según tramo de peso"}}if(Te.discount_type==="percentage")return{value:Te.plan_name,description:`-${formatPercentage(Te.discount_value)} sobre coste base`};if(Te.discount_type==="fixed")return{value:Te.plan_name,description:`-${formatCurrency(Te.discount_value)} por envío`}}if(ne){const qe=getCustomPlanDisplayInfo(ne);return{value:qe.name,description:qe.description}}return U?{value:We||"Plan comercial seleccionado",description:"No aplica descuento directo para este servicio"}:P>0?{value:`-${formatPercentage(P)}`,description:"Descuento lineal sobre coste base"}:{value:"Sin descuentos aplicados",description:void 0}},[ne,Te,z,N,P,U,We]),et=qe=>qe.map(it=>({...it,finalWeight:it.finalWeight??it.weight,quantity:Math.max(1,Math.round(it.quantity??1))})),dt=(qe="")=>jsxRuntimeExports.jsxs("div",{className:`bg-white rounded-lg shadow-md p-4 space-y-3 ${qe}`,children:[jsxRuntimeExports.jsxs("h3",{className:"text-base font-semibold text-gray-900 flex items-center",children:[jsxRuntimeExports.jsx(Package,{className:"h-4 w-4 mr-2 text-blue-600"}),"Configuración del Envío"]}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[(()=>{const it=N==="Urg14H Courier",vt=N==="Urg14H Courier"&&he;return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo de Servicio"}),jsxRuntimeExports.jsx("select",{value:N,onChange:xt=>M(xt.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:STATIC_SERVICES.map(xt=>jsxRuntimeExports.jsx("option",{value:xt,children:xt},xt))})]}),it&&jsxRuntimeExports.jsxs("div",{className:"flex flex-col gap-2 rounded-md border border-blue-100 bg-blue-50 px-3 py-2",children:[jsxRuntimeExports.jsxs("label",{className:"inline-flex items-center text-sm font-medium text-blue-900",children:[jsxRuntimeExports.jsx("input",{type:"checkbox",className:"mr-2 h-4 w-4 rounded border-blue-300 text-blue-600 focus:ring-blue-500",checked:he,onChange:xt=>pe(xt.target.checked)}),"Entrega en sábado disponible"]}),vt&&jsxRuntimeExports.jsxs("div",{className:"pl-6",children:[jsxRuntimeExports.jsx("label",{className:"block text-xs font-semibold text-blue-900 mb-1",children:"PVP entrega sábado (€)"}),jsxRuntimeExports.jsx("input",{type:"number",min:"0",step:"0.01",value:fe,onChange:xt=>W(Number(xt.target.value)||0),className:"w-full px-3 py-2 border border-blue-200 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"})]})]})]})})(),jsxRuntimeExports.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[jsxRuntimeExports.jsxs("div",{className:"sm:basis-[30%] sm:max-w-[30%]",children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Margen Deseado (%)"}),jsxRuntimeExports.jsx("input",{type:"number",value:I,onChange:it=>y(Number(it.target.value)),min:"0",max:"100",step:"0.1",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Margen sobre venta"})]}),jsxRuntimeExports.jsxs("div",{className:"sm:basis-[70%] sm:max-w-[70%]",children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Selección Plan Comercial Aplicable"}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsxs("select",{value:Ve?`user-plan-${Ve}`:(Te==null?void 0:Te.id)||"",onChange:it=>{const vt=it.target.value;vt.startsWith("user-plan-")?(ee(vt.replace("user-plan-","")),F(""),T("")):(ee(null),ls(vt))},disabled:we.length===0&&ze.length===0,className:`flex-1 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${we.length===0&&ze.length===0?"border-gray-200 bg-gray-50 text-gray-500 cursor-not-allowed":"border-gray-300"}`,children:[jsxRuntimeExports.jsx("option",{value:"",children:we.length===0&&ze.length===0?"Sin planes disponibles":"Sin descuento"}),we.length>0&&jsxRuntimeExports.jsx("optgroup",{label:"Planes del Sistema",children:we.map(it=>jsxRuntimeExports.jsxs("option",{value:it.id,children:[it.plan_name,it.discount_type!=="custom"?` (-${it.discount_value}${it.discount_type==="percentage"?"%":"€"})`:""]},it.id))}),ze.length>0&&jsxRuntimeExports.jsx("optgroup",{label:"Planes Personalizados",children:ze.map(it=>jsxRuntimeExports.jsxs("option",{value:`user-plan-${it.id}`,children:[it.plan_name," (Personalizado)"]},`user-plan-${it.id}`))})]}),jsxRuntimeExports.jsxs("button",{onClick:()=>Ue(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2 whitespace-nowrap text-sm font-medium",title:"Gestionar planes comerciales personalizados",children:[jsxRuntimeExports.jsx(Sliders,{size:16}),jsxRuntimeExports.jsx("span",{className:"hidden sm:inline",children:"Gestionar"})]})]})]})]})]})]}),mt=(qe="")=>{const it=V.overrides["Canarias Mayores"]??V.base,vt=V.overrides["Canarias Menores"]??V.base,xt=V.overrides["Baleares Mayores"]??V.base,Et=V.overrides["Baleares Menores"]??V.base,At=it!==V.base||vt!==V.base,yt=xt!==V.base||Et!==V.base,_t=ISLAND_ONLY_2025_SERVICES.has(N),Ct=_t?0:ie,Tt=UNIVERSAL_2025_OVERRIDES["Canarias Mayores"],wt=UNIVERSAL_2025_OVERRIDES["Baleares Mayores"],Nt=!!U;return jsxRuntimeExports.jsxs("div",{className:`bg-white rounded-lg shadow-md p-4 ${qe}`,children:[jsxRuntimeExports.jsx("h3",{className:"text-base font-semibold text-gray-900 mb-3",children:"Ajustes de Coste"}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-xs font-semibold text-gray-700 mb-1 uppercase tracking-wide",children:"Incr. 2024 (%)"}),jsxRuntimeExports.jsx("input",{type:"text",readOnly:!0,value:`${V.base.toFixed(2)} %`,className:"w-full px-2 py-1.5 border border-gray-200 rounded-md bg-gray-50 text-sm font-semibold text-gray-900"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-xs font-semibold text-gray-700 mb-1 uppercase tracking-wide",children:"Incr. 2025 (%)"}),jsxRuntimeExports.jsx("input",{type:"text",readOnly:!0,value:`${Ct.toFixed(2)} %`,className:"w-full px-2 py-1.5 border border-gray-200 rounded-md bg-gray-50 text-sm font-semibold text-gray-900"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-xs font-semibold text-gray-700 mb-1 uppercase tracking-wide",children:"Incr. 2026 (%)"}),jsxRuntimeExports.jsx("input",{type:"number",value:Z,onChange:gt=>ge(Number(gt.target.value)),step:"0.1",className:"w-full px-2 py-1.5 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-xs font-semibold text-gray-700 mb-1 uppercase tracking-wide",children:"SPC (€)"}),jsxRuntimeExports.jsx("input",{type:"number",value:re,onChange:gt=>oe(Number(gt.target.value)),step:"0.01",className:"w-full px-2 py-1.5 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-xs font-semibold text-gray-700 mb-1 uppercase tracking-wide",children:"Otros (€)"}),jsxRuntimeExports.jsx("input",{type:"number",value:be,onChange:gt=>L(Number(gt.target.value)),step:"0.01",className:"w-full px-2 py-1.5 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Costes adicionales: cajas, bolsas, etiquetas,..."})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-xs font-semibold text-gray-700 mb-1 uppercase tracking-wide",children:"Irregular (€)"}),jsxRuntimeExports.jsx("input",{type:"text",readOnly:!0,value:formatCurrency(S),className:"w-full px-2 py-1.5 border border-gray-200 rounded-md bg-gray-50 text-sm font-semibold text-gray-900"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Se aplica automáticamente 7 € por cada bulto irregular detectado."})]}),jsxRuntimeExports.jsxs("div",{className:"col-span-2 sm:col-span-1",children:[jsxRuntimeExports.jsx("label",{className:"block text-xs font-semibold text-gray-700 mb-1 uppercase tracking-wide",children:"Descuento lineal (%)"}),jsxRuntimeExports.jsx("input",{type:"number",value:Nt?0:P,onChange:gt=>D(Number(gt.target.value)),min:"0",step:"0.1",disabled:Nt,className:`w-full px-2 py-1.5 border rounded-md text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent ${Nt?"border-gray-200 bg-gray-50 text-gray-400 cursor-not-allowed":"border-gray-300"}`}),jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500 mt-1",children:Nt?"Los planes comerciales desactivan el descuento lineal manual.":"Se resta al coste inicial antes de recargos e incrementos."})]}),At&&jsxRuntimeExports.jsxs("div",{className:"col-span-2 sm:col-span-1",children:[jsxRuntimeExports.jsx("label",{className:"block text-xs font-semibold text-gray-700 mb-1 uppercase tracking-wide",children:"Canarias (Incr. 2024)"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700",children:[jsxRuntimeExports.jsxs("span",{className:"flex-1 px-2 py-1 border border-gray-200 rounded-md bg-gray-50",children:["Mayores: ",it.toFixed(2),"%"]}),jsxRuntimeExports.jsxs("span",{className:"flex-1 px-2 py-1 border border-gray-200 rounded-md bg-gray-50",children:["Menores: ",vt.toFixed(2),"%"]})]})]}),yt&&jsxRuntimeExports.jsxs("div",{className:"col-span-2 sm:col-span-1",children:[jsxRuntimeExports.jsx("label",{className:"block text-xs font-semibold text-gray-700 mb-1 uppercase tracking-wide",children:"Baleares (Incr. 2024)"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700",children:[jsxRuntimeExports.jsxs("span",{className:"flex-1 px-2 py-1 border border-gray-200 rounded-md bg-gray-50",children:["Mayores: ",xt.toFixed(2),"%"]}),jsxRuntimeExports.jsxs("span",{className:"flex-1 px-2 py-1 border border-gray-200 rounded-md bg-gray-50",children:["Menores: ",Et.toFixed(2),"%"]})]})]}),_t&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:"col-span-2 sm:col-span-1",children:[jsxRuntimeExports.jsx("label",{className:"block text-xs font-semibold text-gray-700 mb-1 uppercase tracking-wide",children:"Canarias (Incr. 2025)"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700",children:[jsxRuntimeExports.jsxs("span",{className:"flex-1 px-2 py-1 border border-gray-200 rounded-md bg-gray-50",children:["Mayores: ",Tt.toFixed(2),"%"]}),jsxRuntimeExports.jsxs("span",{className:"flex-1 px-2 py-1 border border-gray-200 rounded-md bg-gray-50",children:["Menores: ",Tt.toFixed(2),"%"]})]})]}),jsxRuntimeExports.jsxs("div",{className:"col-span-2 sm:col-span-1",children:[jsxRuntimeExports.jsx("label",{className:"block text-xs font-semibold text-gray-700 mb-1 uppercase tracking-wide",children:"Baleares (Incr. 2025)"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700",children:[jsxRuntimeExports.jsxs("span",{className:"flex-1 px-2 py-1 border border-gray-200 rounded-md bg-gray-50",children:["Mayores: ",wt.toFixed(2),"%"]}),jsxRuntimeExports.jsxs("span",{className:"flex-1 px-2 py-1 border border-gray-200 rounded-md bg-gray-50",children:["Menores: ",wt.toFixed(2),"%"]})]})]})]})]})]})},St=qe=>{de(et(qe)),trackPackageCalculation(t==null?void 0:t.id)},Rt=qe=>{if(qe===null||Number.isNaN(qe)){xe(null);return}xe(Math.max(0,qe))},Pt=()=>{de(qe=>{if(qe.length===0)return[createDefaultPackage()];const[it]=et(qe);return[it]})},Bt=()=>{M(STATIC_SERVICES[0]),y(40),T(""),F(""),ue("salida"),ge(0),oe(0),L(0),C(0),D(0),G(0),Y(0),Ee({}),de([createDefaultPackage()]),Ce(buildEmptyBreakdowns()),De([]),Ge([]),ot(!1),ht(!1),pe(!1),W(0),xe(null),ft(createInitialComparatorState()),je(createEmptyComparatorManualFlags()),Xe(40),ut(STATIC_SERVICES[0])},Ut=()=>{ot(qe=>!qe)},Wt=()=>{ht(qe=>!qe)},Dt=(qe,it,vt,xt)=>{if(qe==="agency")return;const Et=Number.isFinite(xt)?Math.max(0,xt):0;qe==="offer"&&je(At=>({...At,[it]:{...At[it],[vt]:!0}})),ft(At=>({...At,[qe]:{...At[qe],[it]:{...At[qe][it],[vt]:Et}}}))},Jt=qe=>{const it=Math.min(100,Math.max(0,qe));Xe(it)},Mt=()=>{ft(createInitialComparatorState()),je(createEmptyComparatorManualFlags()),Xe(40)},Gs=()=>{let qe=!1;COMPARATOR_ZONES.forEach(yt=>{COMPARATOR_COLUMNS.forEach(_t=>{const Ct=ct.competition[yt][_t];(!Number.isFinite(Ct)||Ct<=0)&&(qe=!0)})});let it=!0;qe&&(it=window.confirm('Existen celdas sin precio en "Precios competencia". Pulsa Aceptar para rellenarlas con el coste base calculado o Cancelar para dejarlas a 0,00.'));const vt=createEmptyComparatorTable();let xt=0,Et=0;COMPARATOR_ZONES.forEach(yt=>{COMPARATOR_COLUMNS.forEach(_t=>{const Ct=Be[yt][_t],Tt=ct.competition[yt][_t],wt=Number.isFinite(Ct)?Ct:0,Nt=Number.isFinite(Tt)?Tt:0;let gt=Nt;if(Nt<=0&&(gt=it?wt:0),wt>0&&gt>0&&gt<wt&&(gt=wt),gt>0){const Ft=roundUp$1(gt);if(vt[yt][_t]=Ft,wt>0){const jt=COMPARATOR_COLUMN_WEIGHTS[_t];xt+=wt*jt,Et+=Ft*jt}}else vt[yt][_t]=0})}),ft(yt=>({...yt,offer:vt})),je(createEmptyComparatorManualFlags());const At=Et>0?(Et-xt)/Et*100:0;K.current=!0,Xe(Math.min(100,Math.max(0,At)))},ls=reactExports.useCallback(qe=>{if(!qe){F(""),T("");return}const it=ve.find(vt=>vt.id===qe);if(!it){F(""),T("");return}F(getPlanGroupKey(it)),T(it.id)},[ve]),Xs=()=>{typeof window<"u"&&window.scrollTo({top:0,behavior:"smooth"})},Ys=()=>{Ee(qe=>({...qe,[N]:!0})),Ne(!1)},Ks=async()=>{await r(),h(!1)},Js=()=>{s(e==="admin"?"user":"admin"),h(!1)},Zs=async()=>{if(t)try{if(!A){const{data:it}=await supabase.from("custom_tariffs").select("id").eq("user_id",t.id).eq("service_name",N).limit(1);if(!it||it.length===0){window.alert(`No tienes una tabla de costes personalizada creada para este servicio.

Para crear tu tabla personalizada ve a:
Usuario → Configuración → Tarifas Personalizadas`);return}}const qe=g.find(it=>it.service_name===N);qe?await supabase.from("custom_tariffs_active").update({is_active:!qe.is_active}).eq("id",qe.id):await supabase.from("custom_tariffs_active").insert([{user_id:t.id,service_name:N,is_active:!0}]),await w(),b(it=>it+1)}catch(qe){console.error("Error toggling custom tariff state:",qe),window.alert("Error al cambiar el estado de la tabla personalizada")}},or=(t==null?void 0:t.is_admin)||!1;return reactExports.useEffect(()=>{if(!U){j!==""&&T("");return}Te?Te.id!==j&&T(Te.id):j!==""&&T("")},[Te,U,j]),reactExports.useEffect(()=>{if(!j){H.current=null;return}const qe=getCustomPlanMessage(j);qe&&H.current!==j&&(window.alert(qe),H.current=j)},[j]),reactExports.useEffect(()=>{Te&&xe(null)},[Te]),reactExports.useEffect(()=>{U&&D(0)},[U]),reactExports.useEffect(()=>{Ve&&(D(0),F(""),T(""))},[Ve]),reactExports.useEffect(()=>{N!=="Urg14H Courier"&&pe(!1)},[N]),reactExports.useEffect(()=>{ut(N)},[N]),reactExports.useEffect(()=>{(!he||N!=="Urg14H Courier")&&W(0)},[he,N]),reactExports.useEffect(()=>{const qe=Me&&!me[N];Ne(!!qe)},[me,he,N,Me]),reactExports.useEffect(()=>{if(E){Ce(buildEmptyBreakdowns()),De([]),Ge([]);return}if(!N){Ce(buildEmptyBreakdowns()),De([]),Ge([]);return}if(!z.some(gt=>(gt.finalWeight??gt.weight)>0)){Ce(buildEmptyBreakdowns()),De([]),Ge([]);return}const it=buildEmptyBreakdowns(),vt=new Set,xt=new Set,Et=v.filter(gt=>gt.service_name===N),At=!!Te||!!ne,yt=isParcelShopService(N),_t=At||yt?0:P,Ct=he&&N==="Urg14H Courier",Tt=Ct?2.5:0,wt=He>0?He:0,Nt=getEnergyRateForService(N);DESTINATION_ZONES.forEach(gt=>{let Ft=0,jt=0,Ot="idle",kt=Et.length===0,Vt=!1;const us=getZoneIncrement(N,gt),lr=getZoneIncrement2025(N,gt);let Zt=!0;for(const ur of z){if(!Zt)continue;const dr=Math.max(1,Math.round(ur.quantity??1));if(dr<=0)continue;const $t=computeZoneCostForPackage(ur,N,gt,se,Et);if(!$t.available){Ot="not_available",$t.reason==="missing_tariff"&&(kt=!0),$t.reason==="restriction"&&(Vt=!0),Zt=!1;continue}Ot="calculated";const en=roundUp$1($t.cost);if(Ft+=en*dr,ne){const Ar=$t.finalWeight??ur.weight??0,Qt=calculateCustomPlanDiscount(Et,ne,N,gt,Ar,se);Qt>0&&(jt+=Qt*dr)}else if(Te){const Ar=$t.finalWeight??ur.weight??0,Qt=calculatePlanDiscountForWeight(Et,N,gt,Te,Ar,se);Qt>0&&(jt+=Qt*dr)}}if(Ot==="not_available"||kt){it[gt]=createEmptyCostBreakdown("not_available"),kt&&vt.add(gt),Vt&&xt.add(gt);return}if(Ot==="idle"){it[gt]=createEmptyCostBreakdown("idle");return}const cr=gt==="Provincial"&&Q!==null&&!j?Q:null,Qs=cr!==null?0:_t,qs=Te||ne?jt:0;it[gt]=calculateCostBreakdown(Ft,us,lr,Z,re,be,S,Qs,Ct?Tt:0,wt,{planDiscountAmount:qs,energyRate:Nt,baseOverride:cr,serviceName:N})}),Ce(it),De(Array.from(vt).sort()),Ge(Array.from(xt).sort())},[v,E,N,z,Z,re,be,S,se,Te,P,he,Q,He]),reactExports.useEffect(()=>{R&&(R.fixed_spc_value!==null&&R.fixed_spc_value!==void 0&&oe(R.fixed_spc_value),R.fixed_discount_percentage!==null&&R.fixed_discount_percentage!==void 0&&R.fixed_discount_percentage>0&&D(R.fixed_discount_percentage))},[R]),reactExports.useEffect(()=>{const qe=!U&&!Ve,it=(R==null?void 0:R.fixed_discount_percentage)&&R.fixed_discount_percentage>0;qe&&it&&P===0&&D(R.fixed_discount_percentage)},[U,Ve,R,P]),jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-gray-50",children:[jsxRuntimeExports.jsx("header",{className:"bg-white shadow-sm border-b border-gray-200 sticky top-0 z-40",children:jsxRuntimeExports.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-3",children:[jsxRuntimeExports.jsx(Calculator,{className:"h-8 w-8 text-blue-600"}),jsxRuntimeExports.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Calculadora de Tarifas"}),or&&!a&&jsxRuntimeExports.jsx("span",{className:"ml-3 px-2 py-1 text-xs font-semibold bg-orange-100 text-orange-800 rounded-full",children:"Modo Usuario"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-3",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-gray-500 hidden sm:inline",children:"Sistema de Cálculo de Tarifas"}),jsxRuntimeExports.jsx(SOPGenerator,{tariffs:v,marginPercentage:I,discountPlans:ve,selectedPlanGroup:U,linearDiscount:Te?0:P,spc:re,variableSurcharge:0,irregularSurcharge:0,increment2026:Z,selectedService:N,provincialCostOverride:Q,disabled:!v.length}),jsxRuntimeExports.jsxs("div",{className:"hidden sm:flex items-center text-sm text-gray-700",children:[jsxRuntimeExports.jsx(User,{className:"h-4 w-4 mr-2 text-gray-400"}),jsxRuntimeExports.jsx("span",{className:"font-medium",children:t==null?void 0:t.full_name})]}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("button",{onClick:()=>h(!c),className:"flex items-center space-x-2 px-3 py-2 rounded-lg hover:bg-gray-100 transition-colors",children:jsxRuntimeExports.jsx("div",{className:"w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center",children:jsxRuntimeExports.jsx("span",{className:"text-sm font-bold text-white",children:((cs=t==null?void 0:t.full_name)==null?void 0:cs.split(" ").map(qe=>qe[0]).join("").toUpperCase().slice(0,2))||(t==null?void 0:t.email.charAt(0).toUpperCase())})})}),c&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>h(!1)}),jsxRuntimeExports.jsxs("div",{className:"absolute right-0 mt-2 w-56 bg-white rounded-lg shadow-lg border border-gray-200 py-1 z-20",children:[jsxRuntimeExports.jsxs("div",{className:"px-4 py-3 border-b border-gray-200",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-gray-900",children:t==null?void 0:t.full_name}),jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500",children:t==null?void 0:t.email})]}),jsxRuntimeExports.jsxs("button",{onClick:()=>{o(!0),h(!1)},className:"flex items-center w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors",children:[jsxRuntimeExports.jsx(Settings,{className:"h-4 w-4 mr-3 text-gray-400"}),"Configuración"]}),or&&a&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"border-t border-gray-200 my-1"}),jsxRuntimeExports.jsxs("button",{onClick:()=>{d(!0),h(!1)},className:"flex items-center w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors",children:[jsxRuntimeExports.jsx(Settings,{className:"h-4 w-4 mr-3 text-gray-400"}),"Panel de Administración"]})]}),or&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"border-t border-gray-200 my-1"}),jsxRuntimeExports.jsx("div",{className:"px-4 py-2",children:jsxRuntimeExports.jsxs("label",{className:"flex items-center justify-between cursor-pointer",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center",children:[jsxRuntimeExports.jsx(Eye,{className:"h-4 w-4 mr-3 text-gray-400"}),jsxRuntimeExports.jsx("span",{className:"text-sm text-gray-700",children:"Ver como Usuario"})]}),jsxRuntimeExports.jsx("button",{onClick:Js,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 ${a?"bg-gray-200":"bg-blue-600"}`,children:jsxRuntimeExports.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${a?"translate-x-1":"translate-x-6"}`})})]})})]}),jsxRuntimeExports.jsx("div",{className:"border-t border-gray-200 mt-1 pt-1",children:jsxRuntimeExports.jsxs("button",{onClick:Ks,className:"flex items-center w-full px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition-colors",children:[jsxRuntimeExports.jsx(LogOut,{className:"h-4 w-4 mr-3"}),"Cerrar sesión"]})})]})]})]})]})]})})}),A?jsxRuntimeExports.jsx("div",{className:"bg-green-50 border-b border-green-200 px-4 sm:px-6 lg:px-8 py-2",children:jsxRuntimeExports.jsxs("div",{className:"max-w-7xl mx-auto flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:"inline-block w-2 h-2 bg-green-600 rounded-full animate-pulse"}),jsxRuntimeExports.jsxs("span",{className:"text-sm font-medium text-green-900",children:["Estado actual: Usando tabla personalizada para ",N]})]})}):jsxRuntimeExports.jsx("div",{className:"bg-gray-50 border-b border-gray-200 px-4 sm:px-6 lg:px-8 py-2",children:jsxRuntimeExports.jsxs("div",{className:"max-w-7xl mx-auto flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:"inline-block w-2 h-2 bg-gray-400 rounded-full"}),jsxRuntimeExports.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["Estado actual: Usando tabla oficial para ",N]})]})}),i&&jsxRuntimeExports.jsx(UserSettingsPanel,{onClose:()=>o(!1)}),or&&a&&u&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-7xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Panel de Administración"}),jsxRuntimeExports.jsx("button",{onClick:()=>d(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:jsxRuntimeExports.jsx("svg",{className:"h-6 w-6 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:jsxRuntimeExports.jsx(AdminPanel,{})})]})}),jsxRuntimeExports.jsxs("div",{className:"px-4 sm:px-6 lg:px-8 py-8 space-y-8",children:[jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[dt(),mt()]}),jsxRuntimeExports.jsx("div",{className:"flex justify-end",children:jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>nt(!0),className:"inline-flex items-center gap-2 rounded-lg bg-blue-600 px-4 py-2 text-sm font-semibold text-white shadow hover:bg-blue-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-blue-500",children:"COMPARADOR COMERCIAL"})}),jsxRuntimeExports.jsx(PackageManager,{packages:z,onChange:St,selectedService:N,onClearPackages:Pt}),Me&&jsxRuntimeExports.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(MapPin,{className:"h-5 w-5 text-red-600"}),jsxRuntimeExports.jsx("h4",{className:"text-sm font-semibold text-red-700 uppercase tracking-wide",children:"Kilometraje adicional"}),jsxRuntimeExports.jsx("span",{className:"text-xs text-red-600 font-medium",children:"¡Atención!, posibles cargos por kilometraje"})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-5 gap-3 text-sm",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-xs font-semibold text-red-700 mb-1 uppercase tracking-wide",children:"Kms"}),jsxRuntimeExports.jsx("input",{type:"number",min:"0",step:"0.1",value:B,onChange:qe=>G(Number(qe.target.value)||0),className:"w-full px-2 py-1.5 border border-red-200 rounded-md focus:ring-2 focus:ring-red-400 focus:border-transparent"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-xs font-semibold text-red-700 mb-1 uppercase tracking-wide",children:"Coste por km (€)"}),jsxRuntimeExports.jsx("input",{type:"text",readOnly:!0,value:ce.toFixed(2),className:"w-full px-2 py-1.5 border border-red-200 rounded-md bg-red-100 text-red-800 font-semibold"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-xs font-semibold text-red-700 mb-1 uppercase tracking-wide",children:"PVP por km (€)"}),jsxRuntimeExports.jsx("input",{type:"number",min:"0",step:"0.01",value:J,onChange:qe=>Y(Number(qe.target.value)||0),className:"w-full px-2 py-1.5 border border-red-200 rounded-md focus:ring-2 focus:ring-red-400 focus:border-transparent"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-xs font-semibold text-red-700 mb-1 uppercase tracking-wide",children:"Total Coste (€)"}),jsxRuntimeExports.jsx("input",{type:"text",readOnly:!0,value:formatCurrency(He),className:"w-full px-2 py-1.5 border border-red-200 rounded-md bg-red-100 text-red-800 font-semibold"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-xs font-semibold text-red-700 mb-1 uppercase tracking-wide",children:"Total Venta (€)"}),jsxRuntimeExports.jsx("input",{type:"text",readOnly:!0,value:formatCurrency(Oe),className:"w-full px-2 py-1.5 border border-red-200 rounded-md bg-red-100 text-red-800 font-semibold"})]})]}),jsxRuntimeExports.jsx("p",{className:"text-xs font-semibold text-red-700 text-right uppercase tracking-wide",children:"Sumado al total PVP"})]}),jsxRuntimeExports.jsx("div",{className:"sticky top-28 z-30",children:jsxRuntimeExports.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-4 bg-white/80 backdrop-blur-sm border border-gray-200 rounded-full px-5 py-3 shadow",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 bg-blue-50 border border-blue-200 rounded-full px-4 py-2 shadow-inner",children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-semibold uppercase tracking-wide text-blue-800",children:"Modalidad"}),SHIPPING_MODES.map(qe=>{const it=se===qe;return jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>ue(qe),className:`px-3 py-1.5 text-sm font-semibold rounded-full transition-colors ${it?"bg-blue-600 text-white shadow":"bg-white text-blue-700 hover:bg-blue-100"}`,children:SHIPPING_MODE_LABELS[qe]},qe)})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsxs("button",{type:"button",onClick:Zs,className:`inline-flex items-center gap-2 px-4 py-2 text-sm font-medium rounded-full transition-colors ${A?"bg-green-600 text-white hover:bg-green-700":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:[A?jsxRuntimeExports.jsx(Eye,{className:"h-4 w-4"}):jsxRuntimeExports.jsx(EyeOff,{className:"h-4 w-4"}),A?"Tabla Personalizada Activa":"Tabla Oficial Activa"]}),jsxRuntimeExports.jsx("button",{type:"button",onClick:Ut,className:`px-4 py-2 text-sm font-medium rounded-full transition-colors ${Ye?"bg-blue-600 text-white":"bg-blue-50 text-blue-700 hover:bg-blue-100"}`,children:Ye?"Ocultar costes":"Ver costes"}),jsxRuntimeExports.jsx("button",{type:"button",onClick:Wt,className:`px-4 py-2 text-sm font-medium rounded-full transition-colors ${st?"bg-purple-600 text-white":"bg-purple-50 text-purple-700 hover:bg-purple-100"}`,children:st?"Ocultar PVP":"Ver PVP"}),jsxRuntimeExports.jsx("button",{type:"button",onClick:Bt,className:"px-4 py-2 text-sm font-medium rounded-full bg-gray-100 text-gray-700 hover:bg-gray-200 transition-colors",children:"Limpiar datos"})]})]})}),ae&&jsxRuntimeExports.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 flex items-start",children:[jsxRuntimeExports.jsx(AlertCircle,{className:"h-5 w-5 text-yellow-600 mr-3 mt-0.5"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-yellow-900",children:"SE HA DETECTADO UNO O VARIOS BULTOS IRREGULARES EN LA EXPEDICIÓN. TENGA EN CUENTA QUE EL TIEMPO DE TRÁNSITO SERÁ DE FPE+1."})]}),le&&jsxRuntimeExports.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 flex items-start",children:[jsxRuntimeExports.jsx(AlertCircle,{className:"h-5 w-5 text-red-600 mr-3 mt-0.5"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-red-900",children:"DETECTADO UNO O VARIOS BULTOS NO ENCINTABLES. TENER EN CUENTA POSIBLES SANCIONES, RECARGOS Y +FPE."})]}),Le.length>0&&jsxRuntimeExports.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 flex items-start",children:[jsxRuntimeExports.jsx(AlertCircle,{className:"h-5 w-5 text-yellow-600 mr-3 mt-0.5"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-yellow-900",children:'Zonas no aplicables al servicio se marcan como "NO".'})]}),_e.length>0&&jsxRuntimeExports.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 flex items-start",children:[jsxRuntimeExports.jsx(AlertCircle,{className:"h-5 w-5 text-red-600 mr-3 mt-0.5"}),jsxRuntimeExports.jsxs("div",{className:"text-sm text-red-900",children:[jsxRuntimeExports.jsx("p",{className:"font-medium",children:"Reglas del servicio impiden estas combinaciones."}),jsxRuntimeExports.jsxs("p",{children:["El servicio ",jsxRuntimeExports.jsx("span",{className:"font-semibold",children:N}),' marca como "NO" las zonas',jsxRuntimeExports.jsxs("span",{className:"font-semibold",children:[" ",_e.join(", ")]})," para los bultos introducidos."]})]})]}),jsxRuntimeExports.jsx("div",{className:`${!Ye&&!st?"lg:sticky lg:top-36":""}`,children:jsxRuntimeExports.jsx(CostBreakdownTable,{costBreakdowns:Se,marginPercentage:I,packages:z,showCosts:Ye,showPvp:st,shippingMode:se,additionalPvp:Oe,additionalPvpLabel:Me&&Oe>0?"Kilometraje adicional":void 0,saturdayActive:he&&N==="Urg14H Courier",saturdayPvp:he&&N==="Urg14H Courier"?fe:0,onProvincialCostChange:Rt,provincialCostOverride:Q,onMarginChange:y,planSelected:!!U||!!ne,discountSummaryValue:lt.value,discountSummaryDescription:lt.description})})]}),jsxRuntimeExports.jsx(CommercialComparatorPanel,{isOpen:Je,onClose:()=>nt(!1),tables:Ze,onValueChange:Dt,availableServices:STATIC_SERVICES,selectedService:Qe,onServiceChange:ut,discountPlans:$e,selectedPlan:at,onPlanChange:ls,offerMargin:pt,onOfferMarginChange:Jt,offerAverageMargin:rt.margin,onReset:Mt,onMatchCompetition:Gs,sopLauncher:jsxRuntimeExports.jsx(SOPGenerator,{tariffs:v,marginPercentage:I,discountPlans:ve,selectedPlanGroup:U,linearDiscount:Te?0:P,spc:re,variableSurcharge:0,irregularSurcharge:0,increment2026:Z,selectedService:N,provincialCostOverride:Q,disabled:!v.length})}),jsxRuntimeExports.jsx("button",{type:"button",onClick:Xs,className:"fixed bottom-6 right-6 z-40 inline-flex items-center justify-center w-12 h-12 rounded-full bg-blue-600 text-white shadow-lg hover:bg-blue-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-blue-500","aria-label":"Volver arriba",children:jsxRuntimeExports.jsx(ArrowUp,{className:"h-5 w-5"})}),Re&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 px-4",children:jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-sm w-full p-6 space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx(MapPin,{className:"h-6 w-6 text-red-600"}),jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"¡Atención!"})]}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-700",children:"El servicio seleccionado puede generar cargos adicionales por kilometraje. Revisa los datos antes de confirmar el envío."}),jsxRuntimeExports.jsx("button",{type:"button",onClick:Ys,className:"w-full inline-flex justify-center items-center px-4 py-2 text-sm font-semibold text-white bg-red-600 rounded-md hover:bg-red-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-red-500",children:"Entendido"})]})}),ye&&jsxRuntimeExports.jsx(CommercialPlansManager,{onClose:()=>{Ue(!1),Ke()},onPlanSelected:qe=>{qe&&console.log("Plan seleccionado:",qe),Ue(!1),Ke()}})]})};function PricingPage({onBack:t,userEmail:r}){const{user:e}=useAuth(),[s,a]=reactExports.useState(!0),[i,o]=reactExports.useState(!1),c=r||(e==null?void 0:e.email),h=async(u,d)=>{if(!c){alert("Email requerido. Por favor, inicia sesión o introduce tu email.");return}o(!0);try{const _=await fetch("https://eyvhuoldrjfntkffpkfm.supabase.co/functions/v1/create-checkout-session",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV5dmh1b2xkcmpmbnRrZmZwa2ZtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg2Mzk3MjgsImV4cCI6MjA3NDIxNTcyOH0.3zYeVfbaU71HNYQK_29Qki1fnQhLGccFtIFDZn_x2Es"},body:JSON.stringify({tier:u,paymentType:d,userId:e==null?void 0:e.id,email:c})}),b=await _.json();if(!_.ok)throw new Error(b.error||"Error al crear sesión de pago");if(b.checkoutUrl)window.location.href=b.checkoutUrl;else throw new Error("No se recibió URL de checkout")}catch(_){console.error("Error selecting plan:",_),alert(_ instanceof Error?_.message:"Error al procesar el pago. Por favor, inténtalo de nuevo."),o(!1)}};return jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-green-50",children:jsxRuntimeExports.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-12",children:[t&&jsxRuntimeExports.jsxs("button",{onClick:t,className:"mb-8 flex items-center gap-2 text-gray-600 hover:text-gray-900 transition-colors",children:[jsxRuntimeExports.jsx(ArrowLeft,{className:"h-5 w-5"}),"Volver"]}),r&&!e&&jsxRuntimeExports.jsx("div",{className:"max-w-3xl mx-auto mb-6 bg-blue-50 border border-blue-200 rounded-xl p-4",children:jsxRuntimeExports.jsxs("p",{className:"text-sm text-blue-900 text-center",children:[jsxRuntimeExports.jsx("span",{className:"font-semibold",children:"Comprando como:"})," ",r,jsxRuntimeExports.jsx("br",{}),jsxRuntimeExports.jsx("span",{className:"text-blue-700 text-xs",children:"Recibirás un código de acceso por email tras completar el pago"})]})}),jsxRuntimeExports.jsxs("div",{className:"text-center mb-4",children:[jsxRuntimeExports.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-blue-600 rounded-3xl mb-6 shadow-lg",children:jsxRuntimeExports.jsx(Calculator,{className:"h-10 w-10 text-white"})}),jsxRuntimeExports.jsx("h1",{className:"text-5xl font-bold text-gray-900 mb-4",children:"Elige tu plan ideal"}),jsxRuntimeExports.jsx("p",{className:"text-xl text-gray-600 max-w-3xl mx-auto mb-2",children:"Pago flexible: mensual o anual con hasta 2 meses gratis"}),jsxRuntimeExports.jsx("p",{className:"text-lg text-gray-500 max-w-2xl mx-auto",children:"Herramienta especializada para empresarios GLS con ROI en días"})]}),jsxRuntimeExports.jsx(PricingToggle,{isAnnual:s,onToggle:a}),jsxRuntimeExports.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 mb-12",children:pricingPlans.map(u=>jsxRuntimeExports.jsx(PlanCard,{plan:u,isAnnual:s,onSelect:h,isLoading:i},u.id))}),jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-8 mb-8",children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6 text-center",children:"¿Por qué elegir nuestra calculadora?"}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-blue-100 rounded-2xl mb-4",children:jsxRuntimeExports.jsx(Calculator,{className:"h-8 w-8 text-blue-600"})}),jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Precisión Total"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600",children:"Cálculos exactos incluyendo costes ocultos e incrementos que otras herramientas ignoran"})]}),jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-green-100 rounded-2xl mb-4",children:jsxRuntimeExports.jsx(Shield,{className:"h-8 w-8 text-green-600"})}),jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Ahorro Inmediato"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600",children:"Recupera tu inversión en días con un solo uso diario en mostrador"})]}),jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-orange-100 rounded-2xl mb-4",children:jsxRuntimeExports.jsx(Calculator,{className:"h-8 w-8 text-orange-600"})}),jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Comparativa Competitiva"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600",children:"Genera propuestas profesionales y comparativas con la competencia en minutos"})]})]})]}),s&&jsxRuntimeExports.jsx("div",{className:"bg-gradient-to-r from-green-50 to-blue-50 border-2 border-green-200 rounded-2xl p-6 mb-8",children:jsxRuntimeExports.jsxs("p",{className:"text-center text-gray-800",children:[jsxRuntimeExports.jsx("span",{className:"font-bold text-green-700",children:"Plan Corporativo:"})," Hasta 58% más barato por dispositivo que planes individuales"]})}),jsxRuntimeExports.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-6 text-center",children:[jsxRuntimeExports.jsxs("p",{className:"text-sm text-gray-700",children:[jsxRuntimeExports.jsx("span",{className:"font-semibold",children:"Precios sin IVA."})," Pago seguro procesado por Stripe. Cancela en cualquier momento."]}),jsxRuntimeExports.jsx("p",{className:"text-sm text-blue-800 mt-2 font-medium",children:"Solo usuarios @gls-spain.es • Soporte técnico incluido • Actualizaciones automáticas"})]}),jsxRuntimeExports.jsxs("p",{className:"mt-8 text-center text-xs text-gray-500",children:["© ",new Date().getFullYear()," Lógica Logística. Todos los derechos reservados."]})]})})}const MOTIVATIONAL_MESSAGES=["Todo va bien, solo unos segundos más...","Configurando tu suscripción...","Activando tu cuenta...","Preparando tus dispositivos...","Casi listo, últimos ajustes...","Verificando tu pago con Stripe...","Creando tu perfil de usuario...","Sincronizando tus datos..."],PHASE_MESSAGES=[{time:0,message:"Procesando tu pago con Stripe...",progress:25},{time:30,message:"Confirmando pago y creando tu cuenta...",progress:50},{time:60,message:"Activando tu suscripción en nuestros servidores...",progress:75},{time:90,message:"Casi listo, últimos ajustes...",progress:90}];function PaymentSuccess(){const t=useNavigate(),[r,e]=reactExports.useState(null),[s,a]=reactExports.useState(!0),[i,o]=reactExports.useState(0),[c,h]=reactExports.useState(0),[u,d]=reactExports.useState(""),[_,b]=reactExports.useState(""),v=120,E=3e3,x=8e3,g=I=>{for(let y=PHASE_MESSAGES.length-1;y>=0;y--)if(I>=PHASE_MESSAGES[y].time)return PHASE_MESSAGES[y];return PHASE_MESSAGES[0]};reactExports.useEffect(()=>{const I=new URLSearchParams(window.location.search),y=I.get("session_id"),j=I.get("email");if(!y){e({status:"error",message:"No se encontró ID de sesión",error:"Falta el parámetro session_id en la URL"}),a(!1);return}if(!j){e({status:"error",message:"No se encontró email",error:"Falta el parámetro email en la URL"}),a(!1);return}d(y),b(j);const T={email:j,sessionId:y,timestamp:new Date().toISOString()};localStorage.setItem("pending_activation",JSON.stringify(T))},[]),reactExports.useEffect(()=>{if(!_||!s)return;const I=async()=>{try{const T=await(await fetch(`https://eyvhuoldrjfntkffpkfm.supabase.co/functions/v1/check-user-activation-status?email=${encodeURIComponent(_)}&session_id=${encodeURIComponent(u)}`,{method:"GET",headers:{Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV5dmh1b2xkcmpmbnRrZmZwa2ZtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg2Mzk3MjgsImV4cCI6MjA3NDIxNTcyOH0.3zYeVfbaU71HNYQK_29Qki1fnQhLGccFtIFDZn_x2Es","Content-Type":"application/json"}})).json();T.status==="active"?(e({status:"active",message:T.message,user:T.user}),a(!1),localStorage.removeItem("pending_activation"),localStorage.setItem("recently_activated",JSON.stringify({email:_,timestamp:new Date().toISOString()})),setTimeout(()=>{t("/")},2e3)):T.status==="pending"?e({status:"pending",message:T.message}):e({status:"error",message:T.message||"Error al verificar activación",error:T.error})}catch(j){console.error("Error checking activation status:",j),e({status:"error",message:"Error de conexión",error:j instanceof Error?j.message:"Error desconocido"})}};I();const y=setInterval(()=>{i<v&&I()},E);return()=>clearInterval(y)},[_,u,s,i,t]),reactExports.useEffect(()=>{if(!s)return;const I=setInterval(()=>{o(y=>{const j=y+1;return j>=v&&(a(!1),e({status:"timeout",message:"El proceso de activación está tardando más de lo esperado",error:"Timeout después de 120 segundos"})),j})},1e3);return()=>clearInterval(I)},[s]),reactExports.useEffect(()=>{const I=setInterval(()=>{h(y=>(y+1)%MOTIVATIONAL_MESSAGES.length)},x);return()=>clearInterval(I)},[]);const w=()=>{a(!0),o(0),e(null)},R=()=>{localStorage.removeItem("pending_activation"),localStorage.setItem("recently_activated",JSON.stringify({email:_,timestamp:new Date().toISOString()})),t("/")},N=()=>{const I=encodeURIComponent("Problema con activación de cuenta"),y=encodeURIComponent(`Hola,

He completado el pago pero mi cuenta no se ha activado.

Detalles:
- Email: ${_}
- Session ID: ${u}
- Timestamp: ${new Date().toISOString()}

Por favor, ayúdenme a resolver este problema.

Gracias.`);window.location.href=`mailto:dcprats@gmail.com?subject=${I}&body=${y}`};if((r==null?void 0:r.status)==="active")return jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-gradient-to-br from-green-50 via-white to-blue-50 flex items-center justify-center p-4",children:jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-12 text-center max-w-md w-full",children:[jsxRuntimeExports.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-green-100 rounded-full mb-6 animate-bounce",children:jsxRuntimeExports.jsx(CheckCircle,{className:"h-12 w-12 text-green-600"})}),jsxRuntimeExports.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"¡Cuenta activada!"}),jsxRuntimeExports.jsx("p",{className:"text-lg text-gray-600 mb-8",children:"Tu suscripción está lista. Redirigiendo al login..."}),r.user&&jsxRuntimeExports.jsxs("div",{className:"bg-gray-50 rounded-xl p-6 mb-8 text-left",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Detalles de tu suscripción"}),jsxRuntimeExports.jsxs("div",{className:"space-y-2 text-sm",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-gray-600",children:"Plan:"}),jsxRuntimeExports.jsxs("span",{className:"font-semibold text-gray-900",children:["Tier ",r.user.subscription_tier]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-gray-600",children:"Dispositivos:"}),jsxRuntimeExports.jsxs("span",{className:"font-semibold text-gray-900",children:[r.user.max_devices," ",r.user.max_devices===1?"dispositivo":"dispositivos"]})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-gray-500",children:[jsxRuntimeExports.jsx(Loader2,{className:"h-4 w-4 animate-spin"}),jsxRuntimeExports.jsx("span",{children:"Redirigiendo..."})]})]})});if((r==null?void 0:r.status)==="timeout"||(r==null?void 0:r.status)==="error")return jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-gradient-to-br from-orange-50 via-white to-red-50 flex items-center justify-center p-4",children:jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-12 text-center max-w-lg w-full",children:[jsxRuntimeExports.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-orange-100 rounded-full mb-6",children:jsxRuntimeExports.jsx(AlertCircle,{className:"h-8 w-8 text-orange-600"})}),jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:r.status==="timeout"?"Activación en proceso":"Error temporal"}),jsxRuntimeExports.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-6",children:[jsxRuntimeExports.jsx("p",{className:"text-sm text-green-800 font-semibold mb-1",children:"✓ Tu pago se procesó correctamente"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-green-700",children:"El cargo ya está confirmado en Stripe"})]}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 mb-6",children:r.message}),u&&jsxRuntimeExports.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 mb-6 text-left",children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-600 mb-2",children:"Para soporte técnico:"}),jsxRuntimeExports.jsxs("p",{className:"text-xs font-mono text-gray-900 break-all",children:["Session ID: ",u]}),jsxRuntimeExports.jsxs("p",{className:"text-xs font-mono text-gray-900 mt-1",children:["Email: ",_]})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsxs("button",{onClick:w,className:"w-full flex items-center justify-center gap-2 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:[jsxRuntimeExports.jsx(RefreshCw,{className:"h-5 w-5"}),"Reintentar verificación"]}),jsxRuntimeExports.jsxs("button",{onClick:R,className:"w-full flex items-center justify-center gap-2 px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium",children:[jsxRuntimeExports.jsx(Home,{className:"h-5 w-5"}),"Ir al login (intentar en 5 min)"]}),jsxRuntimeExports.jsxs("button",{onClick:N,className:"w-full flex items-center justify-center gap-2 px-6 py-3 bg-white text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors font-medium",children:[jsxRuntimeExports.jsx(Mail,{className:"h-5 w-5"}),"Contactar soporte"]})]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500 mt-6",children:"En la mayoría de casos, tu cuenta se activará en pocos minutos. Puedes cerrar esta ventana e intentar hacer login más tarde."})]})});const M=g(i),A=Math.min(95,M.progress+(i-M.time)*.5);return jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-green-50 flex items-center justify-center p-4",children:jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-12 text-center max-w-md w-full",children:[jsxRuntimeExports.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-blue-100 rounded-full mb-6",children:jsxRuntimeExports.jsx(Loader2,{className:"h-12 w-12 text-blue-600 animate-spin"})}),jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:M.message}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600 mb-6 animate-pulse",children:MOTIVATIONAL_MESSAGES[c]}),jsxRuntimeExports.jsxs("div",{className:"mb-6",children:[jsxRuntimeExports.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3 mb-2 overflow-hidden",children:jsxRuntimeExports.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-green-500 h-3 rounded-full transition-all duration-1000 ease-out",style:{width:`${A}%`}})}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-gray-500",children:[i,"s / ",v,"s"]})]}),jsxRuntimeExports.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:[jsxRuntimeExports.jsx("p",{className:"text-sm text-blue-900 font-semibold mb-1",children:"¿Por qué tarda?"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-blue-800",children:"Stripe procesa tu pago y luego nuestro sistema crea tu cuenta automáticamente. Este proceso suele tardar entre 10-30 segundos."})]}),i>60&&jsxRuntimeExports.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 animate-fade-in",children:jsxRuntimeExports.jsxs("p",{className:"text-xs text-green-800",children:[jsxRuntimeExports.jsx("strong",{children:"Tranquilo, todo va bien."})," Algunos pagos tardan un poco más en procesarse. Si prefieres, puedes cerrar esta ventana e intentar hacer login en unos minutos."]})}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-gray-400 mt-6",children:["Email: ",_]})]})})}function PDFUploadGate(){const{user:t}=useAuth(),[r,e]=reactExports.useState(null),[s,a]=reactExports.useState("idle"),[i,o]=reactExports.useState(null),[c,h]=reactExports.useState(!1),u=reactExports.useRef(null),d=g=>{if(g){if(g.type!=="application/pdf"){o("Por favor, selecciona un archivo PDF válido.");return}if(g.size>10*1024*1024){o("El archivo es demasiado grande. El tamaño máximo es 10MB.");return}e(g),o(null)}},_=g=>{g.preventDefault(),h(!0)},b=()=>{h(!1)},v=g=>{g.preventDefault(),h(!1);const w=g.dataTransfer.files[0];d(w)},E=async()=>{if(!(!r||!t)){a("uploading"),o(null);try{const g=new FormData;g.append("pdf",r),g.append("userId",t.id),a("validating");const N=await fetch("https://eyvhuoldrjfntkffpkfm.supabase.co/functions/v1/upload-and-validate-tariff",{method:"POST",headers:{Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV5dmh1b2xkcmpmbnRrZmZwa2ZtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg2Mzk3MjgsImV4cCI6MjA3NDIxNTcyOH0.3zYeVfbaU71HNYQK_29Qki1fnQhLGccFtIFDZn_x2Es"},body:g});if(!N.ok){const A=await N.json();throw new Error(A.error||"Error al procesar el archivo")}const M=await N.json();M.is_activated?(a("success"),setTimeout(()=>{window.location.reload()},2e3)):(a("error"),o(M.message||"El PDF no pudo ser validado correctamente"))}catch(g){console.error("Upload error:",g),a("error"),o(g.message||"Error al procesar el archivo. Por favor, intenta de nuevo.")}}},x=()=>{switch(s){case"uploading":return jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[jsxRuntimeExports.jsx(Loader,{className:"w-16 h-16 text-blue-600 animate-spin mb-4"}),jsxRuntimeExports.jsx("p",{className:"text-lg font-medium text-gray-700",children:"Subiendo archivo..."}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Por favor, espera un momento"})]});case"validating":return jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[jsxRuntimeExports.jsx(Loader,{className:"w-16 h-16 text-blue-600 animate-spin mb-4"}),jsxRuntimeExports.jsx("p",{className:"text-lg font-medium text-gray-700",children:"Validando documento..."}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Verificando que sea la tarifa oficial GLS 2025"})]});case"success":return jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[jsxRuntimeExports.jsx(CheckCircle,{className:"w-16 h-16 text-green-600 mb-4"}),jsxRuntimeExports.jsx("p",{className:"text-lg font-medium text-gray-700",children:"¡PDF validado correctamente!"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Redirigiendo a la aplicación..."})]});case"error":return jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[jsxRuntimeExports.jsx(XCircle,{className:"w-16 h-16 text-red-600 mb-4"}),jsxRuntimeExports.jsx("p",{className:"text-lg font-medium text-gray-700",children:"Error de validación"}),i&&jsxRuntimeExports.jsx("div",{className:"mt-4 p-4 bg-red-50 border border-red-200 rounded-lg max-w-md",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-red-700",children:i})}),jsxRuntimeExports.jsx("button",{onClick:()=>{a("idle"),o(null),e(null)},className:"mt-6 px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Intentar de nuevo"})]});default:return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{onDragOver:_,onDragLeave:b,onDrop:v,onClick:()=>{var g;return(g=u.current)==null?void 0:g.click()},className:`border-2 border-dashed rounded-lg p-12 text-center cursor-pointer transition-all ${c?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-blue-400 hover:bg-gray-50"}`,children:[jsxRuntimeExports.jsx("input",{ref:u,type:"file",accept:".pdf",onChange:g=>{var w;return d(((w=g.target.files)==null?void 0:w[0])||null)},className:"hidden"}),r?jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center",children:[jsxRuntimeExports.jsx(FileText,{className:"w-16 h-16 text-blue-600 mb-4"}),jsxRuntimeExports.jsx("p",{className:"text-lg font-medium text-gray-700",children:r.name}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:[(r.size/1024/1024).toFixed(2)," MB"]})]}):jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center",children:[jsxRuntimeExports.jsx(Upload,{className:"w-16 h-16 text-gray-400 mb-4"}),jsxRuntimeExports.jsx("p",{className:"text-lg font-medium text-gray-700",children:"Arrastra tu PDF aquí o haz clic para seleccionar"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"PDF de tarifa oficial GLS 2025 (máximo 10MB)"})]})]}),r&&jsxRuntimeExports.jsx("button",{onClick:E,className:"w-full mt-6 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:"Validar y continuar"}),i&&jsxRuntimeExports.jsx("div",{className:"mt-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-red-700",children:i})})]})}};return jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-blue-50 flex items-center justify-center p-4",children:jsxRuntimeExports.jsx("div",{className:"max-w-2xl w-full",children:jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:[jsxRuntimeExports.jsxs("div",{className:"text-center mb-8",children:[jsxRuntimeExports.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-3",children:"Configuración Inicial"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600",children:"Para comenzar a utilizar la aplicación, necesitamos validar tu tarifa oficial de costes GLS 2025."}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Esta verificación es necesaria por motivos de seguridad y para garantizar la precisión de los cálculos."})]}),x(),jsxRuntimeExports.jsx("div",{className:"mt-8 pt-6 border-t border-gray-200",children:jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500 text-center",children:"Tu archivo será procesado de forma segura y almacenado únicamente para validación."})})]})})})}function isSubscriptionActive(t){if(!t)return!1;const{subscription_status:r,subscription_end_date:e}=t;return r==="cancelled"?!1:r==="active"||r==="trial"?new Date(e)>new Date:!1}function isSubscriptionExpired(t){return new Date(t)<=new Date}function canAccessCalculator(t){if(!t)return!1;const r=isSubscriptionActive(t),e=!isSubscriptionExpired(t.subscription_end_date);return r&&e}function useRequireActivation(){const{user:t,isAuthenticated:r}=useAuth(),[e,s]=reactExports.useState(!1),[a,i]=reactExports.useState(!0),[o,c]=reactExports.useState(null);reactExports.useEffect(()=>{if(!r||!t){i(!1),s(!1);return}h()},[t,r]);const h=async()=>{if(t)try{i(!0),c(null),console.log("[useRequireActivation] Checking activation for user:",t.id);const{data:u,error:d}=await supabase.functions.invoke("check-tariff-activation",{body:{userId:t.id}});if(d)throw console.error("[useRequireActivation] Function error:",d),d;console.log("[useRequireActivation] Activation status:",u),s((u==null?void 0:u.is_activated)||!1)}catch(u){console.error("[useRequireActivation] Error checking activation status:",u),c(u.message),s(!1)}finally{i(!1)}};return{isActivated:e,isLoading:a,error:o}}function MainContent(){const{isAuthenticated:t,isLoading:r,userData:e}=useAuth(),{isActivated:s,isLoading:a}=useRequireActivation(),[i,o]=reactExports.useState(!1),[c,h]=reactExports.useState(""),u=_=>{h(_),o(!0)},d=()=>{o(!1),h("")};return r||a?jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx(Loader2,{className:"h-12 w-12 animate-spin text-blue-600 mx-auto mb-4"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600",children:"Cargando..."})]})}):t?t&&!e?jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx(Loader2,{className:"h-12 w-12 animate-spin text-blue-600 mx-auto mb-4"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600",children:"Cargando perfil..."})]})}):canAccessCalculator(e)?s?jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-gray-50",children:jsxRuntimeExports.jsx(TariffCalculator,{})}):jsxRuntimeExports.jsx(PDFUploadGate,{}):jsxRuntimeExports.jsx(PricingPage,{userEmail:e==null?void 0:e.email}):i?jsxRuntimeExports.jsx(PricingPage,{onBack:d,userEmail:c}):jsxRuntimeExports.jsx(LoginContainer,{onShowPricing:u})}function AppContent(){return jsxRuntimeExports.jsxs(Routes,{children:[jsxRuntimeExports.jsx(Route,{path:"/",element:jsxRuntimeExports.jsx(MainContent,{})}),jsxRuntimeExports.jsx(Route,{path:"/payment-success",element:jsxRuntimeExports.jsx(PaymentSuccess,{})}),jsxRuntimeExports.jsx(Route,{path:"/pricing",element:jsxRuntimeExports.jsx(PricingPage,{})})]})}function App(){return jsxRuntimeExports.jsx(BrowserRouter,{basename:"/area-privada2/calculadora",future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:jsxRuntimeExports.jsx(AuthProvider,{children:jsxRuntimeExports.jsx(PreferencesProvider,{children:jsxRuntimeExports.jsx(ViewModeProvider,{children:jsxRuntimeExports.jsx(AppContent,{})})})})})}createRoot(document.getElementById("root")).render(jsxRuntimeExports.jsx(reactExports.StrictMode,{children:jsxRuntimeExports.jsx(App,{})}));

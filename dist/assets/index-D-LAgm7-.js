var dn=Object.defineProperty;var ms=t=>{throw TypeError(t)};var hn=(t,r,e)=>r in t?dn(t,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[r]=e;var wt=(t,r,e)=>hn(t,typeof r!="symbol"?r+"":r,e),jr=(t,r,e)=>r.has(t)||ms("Cannot "+e);var M=(t,r,e)=>(jr(t,r,"read from private field"),e?e.call(t):r.get(t)),Ie=(t,r,e)=>r.has(t)?ms("Cannot add the same private member more than once"):r instanceof WeakSet?r.add(t):r.set(t,e),ke=(t,r,e,s)=>(jr(t,r,"write to private field"),s?s.call(t,e):r.set(t,e),e),Ae=(t,r,e)=>(jr(t,r,"access private method"),e);var lr=(t,r,e,s)=>({set _(a){ke(t,r,a,e)},get _(){return M(t,r,s)}});import{r as reactExports,a as reactDomExports,R as React,g as getAugmentedNamespace,c as commonjsGlobal,u as useNavigate,B as BrowserRouter,b as Routes,d as Route}from"./react-vendor-CRwc5v4Q.js";import{c as createClient}from"./supabase-NSeaGaan.js";import{M as Mail,L as Loader2,A as ArrowLeft,a as AlertCircle,C as Calculator,b as ArrowRight,X,c as CheckCircle,S as Save,B as Building,d as Calendar,F as FileSpreadsheet,e as FileText,T as TrendingUp,f as Smartphone,g as Check,I as Info,h as Shield,i as CreditCard,U as Users,E as Eye,R as RotateCcw,j as Trash2,k as AlertTriangle,l as CheckCircle2,D as Download,m as Settings,n as User,o as UserPlus,G as Gift,P as Plus,p as Pen,q as Copy,r as Package,s as Minus,t as Ruler,u as Euro,v as Percent,w as LogOut,x as MapPin,y as EyeOff,z as ArrowUp,H as Sliders,J as RefreshCw,K as Home,N as Upload,O as XCircle,Q as Loader}from"./icons-tAUUpNDI.js";import{c as commonjsRequire,e as exceljs_minExports}from"./excel-Brlu1TUx.js";var jsxRuntime={exports:{}},reactJsxRuntime_production_min={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var f=reactExports,k=Symbol.for("react.element"),l=Symbol.for("react.fragment"),m$1=Object.prototype.hasOwnProperty,n=f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p={key:!0,ref:!0,__self:!0,__source:!0};function q(t,r,e){var s,a={},i=null,o=null;e!==void 0&&(i=""+e),r.key!==void 0&&(i=""+r.key),r.ref!==void 0&&(o=r.ref);for(s in r)m$1.call(r,s)&&!p.hasOwnProperty(s)&&(a[s]=r[s]);if(t&&t.defaultProps)for(s in r=t.defaultProps,r)a[s]===void 0&&(a[s]=r[s]);return{$$typeof:k,type:t,key:i,ref:o,props:a,_owner:n.current}}reactJsxRuntime_production_min.Fragment=l;reactJsxRuntime_production_min.jsx=q;reactJsxRuntime_production_min.jsxs=q;jsxRuntime.exports=reactJsxRuntime_production_min;var jsxRuntimeExports=jsxRuntime.exports,createRoot,m=reactDomExports;createRoot=m.createRoot,m.hydrateRoot;const supabaseUrl="https://eyvhuoldrjfntkffpkfm.supabase.co",supabaseAnonKey="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV5dmh1b2xkcmpmbnRrZmZwa2ZtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg2Mzk3MjgsImV4cCI6MjA3NDIxNTcyOH0.3zYeVfbaU71HNYQK_29Qki1fnQhLGccFtIFDZn_x2Es",supabase=createClient(supabaseUrl,supabaseAnonKey),EUROPE_DESTINATIONS=["Alemania","Austria","Belgica","Bulgaria","Chipre","Corcega","Croacia","Dinamarca","Eslovaquia","Eslovenia","Estonia","Finlandia","Francia","Grecia","Hungria","Irlanda","Italia","Letonia","Liechtenstein","Lituania","Luxemburgo","Malta","Monaco","Noruega","Paises Bajos","Polonia","Reino Unido Z1","Reino Unido Z2","Republica Checa","Rumania","San Marino","Serbia","Suecia","Suiza","Vaticano"],EUROPE_ZONE_COLORS={A:"#22c55e",B:"#3b82f6",C:"#f97316",D:"#ec4899",E:"#9ca3af",F:"#6b7280",G:"#eab308",H:"#06b6d4"},EUROPE_ZONE_DATA={Alemania:{name:"Alemania",iso:"DE",zone:"A",ttr:"2-3"},Austria:{name:"Austria",iso:"AT",zone:"C",ttr:"3-4"},Belgica:{name:"Belgica",iso:"BE",zone:"A",ttr:"2-3"},Bulgaria:{name:"Bulgaria",iso:"BG",zone:"F",ttr:"4-5"},Chipre:{name:"Chipre",iso:"CY",zone:"H",ttr:"5-6"},Corcega:{name:"Corcega",iso:"FR2",zone:"G",ttr:"2-3",displayName:"Corcega (Francia)"},Croacia:{name:"Croacia",iso:"HR",zone:"D",ttr:"3-4"},Dinamarca:{name:"Dinamarca",iso:"DK",zone:"D",ttr:"3-4"},Eslovaquia:{name:"Eslovaquia",iso:"SK",zone:"D",ttr:"2-3"},Eslovenia:{name:"Eslovenia",iso:"SI",zone:"D",ttr:"3-4"},Estonia:{name:"Estonia",iso:"EE",zone:"F",ttr:"4-5"},Finlandia:{name:"Finlandia",iso:"FI",zone:"G",ttr:"5-7"},Francia:{name:"Francia",iso:"FR",zone:"B",ttr:"1-2"},Grecia:{name:"Grecia",iso:"GR",zone:"F",ttr:"6-8"},Hungria:{name:"Hungria",iso:"HU",zone:"D",ttr:"2-3"},Irlanda:{name:"Irlanda",iso:"IE",zone:"G",ttr:"4-5"},Italia:{name:"Italia",iso:"IT",zone:"B",ttr:"2-3"},Letonia:{name:"Letonia",iso:"LV",zone:"E",ttr:"5-7"},Liechtenstein:{name:"Liechtenstein",iso:"LI",zone:"E",ttr:"2-3"},Lituania:{name:"Lituania",iso:"LT",zone:"D",ttr:"4-5"},Luxemburgo:{name:"Luxemburgo",iso:"LU",zone:"C",ttr:"2-3"},Malta:{name:"Malta",iso:"MT",zone:"H",ttr:"4-5"},Monaco:{name:"Monaco",iso:"MC",zone:"E",ttr:"1-2"},Noruega:{name:"Noruega",iso:"NO",zone:"G",ttr:"4-6"},"Paises Bajos":{name:"Paises Bajos",iso:"NL",zone:"A",ttr:"2-3"},Polonia:{name:"Polonia",iso:"PL",zone:"A",ttr:"3-4"},"Reino Unido Z1":{name:"Reino Unido Z1",iso:"GB1",zone:"E",ttr:"3-4",displayName:"Reino Unido (Gales, Inglaterra)"},"Reino Unido Z2":{name:"Reino Unido Z2",iso:"GB2",zone:"E",ttr:"4-5",displayName:"Reino Unido (Escocia, Irlanda N., Islas)"},"Republica Checa":{name:"Republica Checa",iso:"CZ",zone:"C",ttr:"2-3"},Rumania:{name:"Rumania",iso:"RO",zone:"D",ttr:"4-5"},"San Marino":{name:"San Marino",iso:"SM",zone:"E",ttr:"2-3"},Serbia:{name:"Serbia",iso:"RS",zone:"H",ttr:"4-5"},Suecia:{name:"Suecia",iso:"SE",zone:"G",ttr:"4-6"},Suiza:{name:"Suiza",iso:"CH",zone:"E",ttr:"3-4"},Vaticano:{name:"Vaticano",iso:"VA",zone:"E",ttr:"4-5"}};function getEuropeDestinationsByZone(){const t={A:[],B:[],C:[],D:[],E:[],F:[],G:[],H:[]};for(const[r,e]of Object.entries(EUROPE_ZONE_DATA))t[e.zone].push(r);return t}function sortEuropeDestinationsByZone(t,r){return[...t].sort((e,s)=>{var o,c,x,u,h;if(r){if(e===r)return-1;if(s===r)return 1;const _=((o=EUROPE_ZONE_DATA[e])==null?void 0:o.zone)||"Z",v=((c=EUROPE_ZONE_DATA[s])==null?void 0:c.zone)||"Z",b=(x=EUROPE_ZONE_DATA[r])==null?void 0:x.zone;if(b){if(_===b&&v!==b)return-1;if(v===b&&_!==b)return 1}}const a=((u=EUROPE_ZONE_DATA[e])==null?void 0:u.zone)||"Z",i=((h=EUROPE_ZONE_DATA[s])==null?void 0:h.zone)||"Z";return a!==i?a.localeCompare(i):e.localeCompare(s,"es")})}const ALLOWED_DOMAIN="@gls-spain.es",ADMIN_EMAIL="dcprats@gmail.com",TEST_USER_EMAIL="damaso.prats@logicalogistica.com",ALLOWED_EXCEPTIONS=[ADMIN_EMAIL,TEST_USER_EMAIL];function isAllowedEmail(t){const r=t.toLowerCase().trim();return!!(ALLOWED_EXCEPTIONS.includes(r)||r.endsWith(ALLOWED_DOMAIN))}const INVALID_EMAIL_ERROR="Solo usuarios @gls-spain.es pueden iniciar sesión",AuthContext=reactExports.createContext(void 0);function AuthProvider({children:t}){const[r,e]=reactExports.useState(null),[s,a]=reactExports.useState(null),[i,o]=reactExports.useState(!0),[c,x]=reactExports.useState(null);reactExports.useEffect(()=>{async function E(){try{const d=localStorage.getItem("user_session");if(d)try{const g=JSON.parse(d);if(g.expiresAt&&new Date(g.expiresAt)<new Date){localStorage.removeItem("user_session"),x("Tu sesión ha expirado. Por favor, inicia sesión nuevamente.");return}e({id:g.id,email:g.email}),await u(g.id)}catch{localStorage.removeItem("user_session")}}finally{o(!1)}}E()},[]),reactExports.useEffect(()=>{let E=null;return r&&(E=window.setInterval(()=>{const d=localStorage.getItem("user_session");if(d)try{const g=JSON.parse(d);g.expiresAt&&new Date(g.expiresAt)<new Date&&(localStorage.removeItem("user_session"),e(null),a(null),x("Tu sesión ha expirado después de 24 horas. Por favor, inicia sesión nuevamente."))}catch(g){console.error("Error checking session expiry:",g)}},6e4)),()=>{E!==null&&clearInterval(E)}},[r]);async function u(E){try{const{data:d,error:g}=await supabase.from("user_profiles").select("*").eq("id",E).maybeSingle();if(g)throw g;if(d){const y=d.email.split("@")[0].split(".").map(R=>R.charAt(0).toUpperCase()+R.slice(1)).join(" ");a({id:d.id,email:d.email,full_name:y,subscription_status:d.subscription_status,subscription_tier:d.subscription_tier,max_devices:d.max_devices,subscription_end_date:d.subscription_end_date,subscription_interval:d.subscription_interval||"monthly",payment_method:d.payment_method,is_admin:d.email==="dcprats@gmail.com"})}}catch(d){console.error("Error loading user profile:",d)}}async function h(E){try{if(!isAllowedEmail(E))return{success:!1,error:INVALID_EMAIL_ERROR};const d=`${navigator.userAgent}-${screen.width}x${screen.height}`,y=await(await fetch("https://eyvhuoldrjfntkffpkfm.supabase.co/functions/v1/check-active-session",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV5dmh1b2xkcmpmbnRrZmZwa2ZtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg2Mzk3MjgsImV4cCI6MjA3NDIxNTcyOH0.3zYeVfbaU71HNYQK_29Qki1fnQhLGccFtIFDZn_x2Es"},body:JSON.stringify({email:E.toLowerCase().trim(),deviceFingerprint:d})})).json();if(y.hasActiveSession){const F={id:y.user.id,email:y.user.email,sessionToken:y.sessionToken,expiresAt:y.user.expiresAt};return localStorage.setItem("user_session",JSON.stringify(F)),e({id:y.user.id,email:y.user.email}),await u(y.user.id),{success:!0,autoLogin:!0}}const R=await fetch("https://eyvhuoldrjfntkffpkfm.supabase.co/functions/v1/send-login-code",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV5dmh1b2xkcmpmbnRrZmZwa2ZtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg2Mzk3MjgsImV4cCI6MjA3NDIxNTcyOH0.3zYeVfbaU71HNYQK_29Qki1fnQhLGccFtIFDZn_x2Es"},body:JSON.stringify({email:E.toLowerCase().trim()})}),P=await R.json();return R.ok?(P.code&&console.log(`Código de inicio de sesión para ${E}: ${P.code}`),{success:!0}):{success:!1,error:P.error||"Error al enviar código",errorCode:P.errorCode,email:P.email}}catch(d){return console.error("Error sending code:",d),{success:!1,error:"Error de conexión"}}}async function _(E,d){try{const g=`${navigator.userAgent}-${screen.width}x${screen.height}`,y=`${navigator.platform} - ${navigator.userAgent.substring(0,50)}`,R=await fetch("https://eyvhuoldrjfntkffpkfm.supabase.co/functions/v1/verify-login-code",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV5dmh1b2xkcmpmbnRrZmZwa2ZtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg2Mzk3MjgsImV4cCI6MjA3NDIxNTcyOH0.3zYeVfbaU71HNYQK_29Qki1fnQhLGccFtIFDZn_x2Es"},body:JSON.stringify({email:E.toLowerCase().trim(),code:d,deviceFingerprint:g,deviceName:y})}),P=await R.json();if(!R.ok)return{success:!1,error:P.error||"Código incorrecto"};const F={id:P.user.id,email:P.user.email,sessionToken:P.sessionToken,expiresAt:P.user.expiresAt};return localStorage.setItem("user_session",JSON.stringify(F)),e({id:P.user.id,email:P.user.email}),x(null),await u(P.user.id),{success:!0}}catch(g){return console.error("Error verifying code:",g),{success:!1,error:"Error de conexión"}}}async function v(){localStorage.removeItem("user_session"),e(null),a(null),x(null)}const b={user:r,userData:s,isAuthenticated:!!r,isLoading:i,sendLoginCode:h,verifyCode:_,signOut:v,sessionExpiredMessage:c};return jsxRuntimeExports.jsx(AuthContext.Provider,{value:b,children:t})}function useAuth(){const t=reactExports.useContext(AuthContext);if(t===void 0)throw new Error("useAuth must be used within an AuthProvider");return t}const PreferencesContext=reactExports.createContext(void 0);function PreferencesProvider({children:t}){const{user:r,isAuthenticated:e}=useAuth(),[s,a]=reactExports.useState(null),[i,o]=reactExports.useState(!1);reactExports.useEffect(()=>{e&&r?c():a(null)},[e,r]);async function c(){if(r!=null&&r.id){o(!0);try{const{data:_,error:v}=await supabase.from("user_preferences").select("*").eq("user_id",r.id).maybeSingle();if(v)throw v;if(_)a(_);else{const{data:b,error:E}=await supabase.from("user_preferences").insert({user_id:r.id,fixed_spc_value:null,fixed_discount_percentage:null,default_service_packages:[],ui_theme:"light"}).select().single();if(E)throw E;a(b)}}catch(_){console.error("Error loading preferences:",_)}finally{o(!1)}}}async function x(_){if(!(r!=null&&r.id))return!1;try{const{data:v,error:b}=await supabase.from("user_preferences").update(_).eq("user_id",r.id).select().single();if(b)throw b;return v?(a(v),!0):!1}catch(v){return console.error("Error updating preferences:",v),!1}}async function u(){await c()}const h={preferences:s,isLoading:i,updatePreferences:x,refreshPreferences:u};return jsxRuntimeExports.jsx(PreferencesContext.Provider,{value:h,children:t})}function usePreferences(){const t=reactExports.useContext(PreferencesContext);if(t===void 0)throw new Error("usePreferences must be used within a PreferencesProvider");return t}const ViewModeContext=reactExports.createContext(void 0);function ViewModeProvider({children:t}){const[r,e]=reactExports.useState(()=>{const a=localStorage.getItem("admin_view_mode");return a==="user"||a==="admin"?a:"admin"}),s=a=>{e(a),localStorage.setItem("admin_view_mode",a)};return reactExports.useEffect(()=>{const a=i=>{i.key==="admin_view_mode"&&(i.newValue==="admin"||i.newValue==="user")&&e(i.newValue)};return window.addEventListener("storage",a),()=>window.removeEventListener("storage",a)},[]),jsxRuntimeExports.jsx(ViewModeContext.Provider,{value:{viewMode:r,setViewMode:s,isAdminView:r==="admin"},children:t})}function useViewMode(){const t=reactExports.useContext(ViewModeContext);if(t===void 0)throw new Error("useViewMode must be used within a ViewModeProvider");return t}function EmailInputForm({onSubmit:t,initialEmail:r=""}){const[e,s]=reactExports.useState(r),[a,i]=reactExports.useState(!1),[o,c]=reactExports.useState(""),x=async u=>{if(u.preventDefault(),c(""),!e||!e.includes("@")){c("Por favor introduce un email válido");return}i(!0);try{await t(e)}catch(h){c(h.message||"Error al enviar código")}finally{i(!1)}};return jsxRuntimeExports.jsxs("form",{onSubmit:x,className:"space-y-6",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-2",children:"Email corporativo"}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:jsxRuntimeExports.jsx(Mail,{className:"h-5 w-5 text-gray-400"})}),jsxRuntimeExports.jsx("input",{id:"email",type:"email",value:e,onChange:u=>s(u.target.value),disabled:a,className:"block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed transition-colors",placeholder:"tu@empresa.com",autoComplete:"email",autoFocus:!0})]}),o&&jsxRuntimeExports.jsx("p",{className:"mt-2 text-sm text-red-600",children:o})]}),jsxRuntimeExports.jsx("button",{type:"submit",disabled:a,className:"w-full flex items-center justify-center px-4 py-3 border border-transparent text-base font-medium rounded-lg text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:a?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Loader2,{className:"animate-spin -ml-1 mr-3 h-5 w-5"}),"Enviando código..."]}):"Enviar código de acceso"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-center text-gray-500",children:"Recibirás un código de 6 dígitos válido durante 15 minutos"})]})}function CodeVerificationForm({email:t,onVerify:r,onBack:e,devCode:s}){const[a,i]=reactExports.useState(["","","","","",""]),[o,c]=reactExports.useState(!1),[x,u]=reactExports.useState(""),h=reactExports.useRef([]);reactExports.useEffect(()=>{var d;(d=h.current[0])==null||d.focus()},[]);const _=(d,g)=>{var R;if(!/^\d*$/.test(g))return;const y=[...a];y[d]=g.slice(-1),i(y),u(""),g&&d<5&&((R=h.current[d+1])==null||R.focus()),y.every(P=>P!=="")&&E(y.join(""))},v=(d,g)=>{var y;g.key==="Backspace"&&!a[d]&&d>0&&((y=h.current[d-1])==null||y.focus())},b=d=>{d.preventDefault();const g=d.clipboardData.getData("text").replace(/\D/g,"").slice(0,6);if(g.length===6){const y=g.split("");i(y),E(g)}},E=async d=>{var g;if(d.length===6){c(!0),u("");try{await r(d)}catch(y){u(y.message||"Código inválido"),i(["","","","","",""]),(g=h.current[0])==null||g.focus()}finally{c(!1)}}};return jsxRuntimeExports.jsxs("div",{className:"space-y-6",children:[jsxRuntimeExports.jsxs("button",{type:"button",onClick:e,disabled:o,className:"flex items-center text-sm text-gray-600 hover:text-gray-900 transition-colors disabled:opacity-50",children:[jsxRuntimeExports.jsx(ArrowLeft,{className:"h-4 w-4 mr-1"}),"Volver"]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Introduce el código"}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-gray-600",children:["Enviado a ",jsxRuntimeExports.jsx("span",{className:"font-medium",children:t})]})]}),s&&jsxRuntimeExports.jsx("div",{className:"p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:jsxRuntimeExports.jsxs("p",{className:"text-sm text-yellow-800",children:[jsxRuntimeExports.jsx("strong",{children:"DEV MODE:"})," Código: ",jsxRuntimeExports.jsx("span",{className:"font-mono font-bold",children:s})]})}),jsxRuntimeExports.jsx("div",{className:"flex gap-2 justify-center",onPaste:b,children:a.map((d,g)=>jsxRuntimeExports.jsx("input",{ref:y=>h.current[g]=y,type:"text",inputMode:"numeric",maxLength:1,value:d,onChange:y=>_(g,y.target.value),onKeyDown:y=>v(g,y),disabled:o,className:"w-12 h-14 text-center text-2xl font-bold border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-100 disabled:cursor-not-allowed transition-all"},g))}),x&&jsxRuntimeExports.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-red-800",children:x})}),o&&jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-center text-sm text-gray-600",children:[jsxRuntimeExports.jsx(Loader2,{className:"animate-spin mr-2 h-4 w-4"}),"Verificando código..."]}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-center text-gray-500",children:["¿No recibiste el código?"," ",jsxRuntimeExports.jsx("button",{type:"button",onClick:e,disabled:o,className:"text-blue-600 hover:text-blue-700 font-medium disabled:opacity-50",children:"Reenviar"})]})]})}function UnregisteredUserView({email:t,onViewPricing:r,onBackToLogin:e}){return jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-blue-50 flex items-center justify-center p-4",children:jsxRuntimeExports.jsxs("div",{className:"w-full max-w-2xl",children:[jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8 space-y-6",children:[jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-yellow-100 rounded-2xl mb-4",children:jsxRuntimeExports.jsx(AlertCircle,{className:"h-8 w-8 text-yellow-600"})}),jsxRuntimeExports.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Usuario No Registrado"}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["El email ",jsxRuntimeExports.jsx("span",{className:"font-semibold text-gray-900",children:t})," no está dado de alta en el sistema"]})]}),jsxRuntimeExports.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-6",children:[jsxRuntimeExports.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[jsxRuntimeExports.jsx(Calculator,{className:"h-5 w-5 text-blue-600"}),"¿Por qué elegir nuestra calculadora?"]}),jsxRuntimeExports.jsxs("ul",{className:"space-y-2 text-sm text-gray-700",children:[jsxRuntimeExports.jsxs("li",{className:"flex items-start gap-2",children:[jsxRuntimeExports.jsx("span",{className:"text-blue-600 font-bold mt-0.5",children:"•"}),jsxRuntimeExports.jsxs("span",{children:[jsxRuntimeExports.jsx("strong",{children:"Precisión Total:"})," Cálculos exactos incluyendo costes ocultos e incrementos"]})]}),jsxRuntimeExports.jsxs("li",{className:"flex items-start gap-2",children:[jsxRuntimeExports.jsx("span",{className:"text-blue-600 font-bold mt-0.5",children:"•"}),jsxRuntimeExports.jsxs("span",{children:[jsxRuntimeExports.jsx("strong",{children:"Ahorro Inmediato:"})," Recupera tu inversión en días con un solo uso diario"]})]}),jsxRuntimeExports.jsxs("li",{className:"flex items-start gap-2",children:[jsxRuntimeExports.jsx("span",{className:"text-blue-600 font-bold mt-0.5",children:"•"}),jsxRuntimeExports.jsxs("span",{children:[jsxRuntimeExports.jsx("strong",{children:"Comparativa Competitiva:"})," Genera propuestas profesionales en minutos"]})]}),jsxRuntimeExports.jsxs("li",{className:"flex items-start gap-2",children:[jsxRuntimeExports.jsx("span",{className:"text-blue-600 font-bold mt-0.5",children:"•"}),jsxRuntimeExports.jsxs("span",{children:[jsxRuntimeExports.jsx("strong",{children:"Multi-dispositivo:"})," Accede desde todos tus dispositivos"]})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsxs("button",{onClick:r,className:"w-full flex items-center justify-center gap-2 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium shadow-md hover:shadow-lg",children:["Ver Planes y Precios",jsxRuntimeExports.jsx(ArrowRight,{className:"h-5 w-5"})]}),jsxRuntimeExports.jsxs("button",{onClick:e,className:"w-full flex items-center justify-center gap-2 px-6 py-3 bg-white text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors font-medium",children:[jsxRuntimeExports.jsx(ArrowLeft,{className:"h-5 w-5"}),"Volver al Login"]})]}),jsxRuntimeExports.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-xl p-4",children:jsxRuntimeExports.jsxs("p",{className:"text-xs text-gray-600 text-center",children:[jsxRuntimeExports.jsx("strong",{children:"¿Ya tienes una cuenta?"})," Si crees que esto es un error, contacta con el administrador en"," ",jsxRuntimeExports.jsx("a",{href:"mailto:dcprats@gmail.com",className:"text-blue-600 hover:underline",children:"dcprats@gmail.com"})]})})]}),jsxRuntimeExports.jsxs("p",{className:"mt-6 text-center text-xs text-gray-500",children:["© ",new Date().getFullYear()," Lógica Logística. Todos los derechos reservados."]})]})})}function LoginContainer({onShowPricing:t}={}){const{sendLoginCode:r,verifyCode:e,sessionExpiredMessage:s}=useAuth(),[a,i]=reactExports.useState("email"),[o,c]=reactExports.useState(""),[x,u]=reactExports.useState(),[h,_]=reactExports.useState(null),[v,b]=reactExports.useState(""),[E,d]=reactExports.useState(!1);reactExports.useEffect(()=>{const F=localStorage.getItem("recently_activated");if(F)try{const S=JSON.parse(F),I=new Date(S.timestamp).getTime(),w=new Date().getTime(),j=5*60*1e3;w-I<j?(b(S.email),d(!0),setTimeout(()=>{d(!1)},8e3)):localStorage.removeItem("recently_activated")}catch(S){console.error("Error parsing recently_activated:",S),localStorage.removeItem("recently_activated")}},[]);const g=async F=>{c(F);const S=await r(F);if(S.success){if(S.autoLogin)return;S.code&&u(S.code),i("code")}else if(S.errorCode==="USER_NOT_FOUND")_({email:S.email||F}),i("unregistered");else throw new Error(S.error||"Error al enviar código")},y=async F=>{const S=await e(o,F);if(!S.success)throw new Error(S.error||"Código inválido")},R=()=>{i("email"),u(void 0),_(null)},P=()=>{t&&h&&t(h.email)};return a==="unregistered"&&h?jsxRuntimeExports.jsx(UnregisteredUserView,{email:h.email,onViewPricing:P,onBackToLogin:R}):jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-blue-50 flex items-center justify-center p-4",children:jsxRuntimeExports.jsxs("div",{className:"w-full max-w-md",children:[jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8 space-y-8",children:[jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-blue-600 rounded-2xl mb-4",children:jsxRuntimeExports.jsx(Calculator,{className:"h-8 w-8 text-white"})}),jsxRuntimeExports.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Calculadora de Tarifas"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600",children:"Accede a tu cuenta corporativa"})]}),s&&jsxRuntimeExports.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-amber-800 text-center",children:s})}),E&&jsxRuntimeExports.jsxs("div",{className:"bg-green-50 border-2 border-green-500 rounded-xl p-4 mb-6 relative animate-fade-in shadow-lg",children:[jsxRuntimeExports.jsx("button",{onClick:()=>d(!1),className:"absolute top-2 right-2 text-green-700 hover:text-green-900 transition-colors",children:jsxRuntimeExports.jsx(X,{className:"h-5 w-5"})}),jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-3",children:[jsxRuntimeExports.jsx("div",{className:"flex-shrink-0 mt-0.5",children:jsxRuntimeExports.jsx(CheckCircle,{className:"h-6 w-6 text-green-600"})}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("h3",{className:"text-sm font-bold text-green-900 mb-1",children:"¡Bienvenido! Tu cuenta está lista"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-green-800",children:"Introduce tu email para recibir el código de acceso y empezar a usar la calculadora."})]})]})]}),a==="email"&&jsxRuntimeExports.jsx(EmailInputForm,{onSubmit:g,initialEmail:v}),a==="code"&&jsxRuntimeExports.jsx(CodeVerificationForm,{email:o,onVerify:y,onBack:R,devCode:x})]}),jsxRuntimeExports.jsxs("p",{className:"mt-6 text-center text-xs text-gray-500",children:["© ",new Date().getFullYear()," Lógica Logística. Todos los derechos reservados."]})]})})}const DEBOUNCE_DELAY=6e4,pendingActivities=new Map,debounceTimers=new Map;async function sendActivityToServer(t,r){try{const e=await fetch("https://eyvhuoldrjfntkffpkfm.supabase.co/functions/v1/track-user-activity",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV5dmh1b2xkcmpmbnRrZmZwa2ZtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg2Mzk3MjgsImV4cCI6MjA3NDIxNTcyOH0.3zYeVfbaU71HNYQK_29Qki1fnQhLGccFtIFDZn_x2Es"},body:JSON.stringify({user_id:t,activity_type:r})});if(!e.ok){const s=await e.json().catch(()=>({}));console.warn("[Tracking] Error al registrar actividad:",s)}}catch(e){console.warn("[Tracking] Error de red al registrar actividad:",e)}}function trackActivity(t,r){if(!t)return;const e=`${t}-${r}`;if(r==="calculation"){const s=debounceTimers.get(e);s&&clearTimeout(s),pendingActivities.set(e,{userId:t,type:r,timestamp:Date.now()});const a=setTimeout(()=>{const i=pendingActivities.get(e);i&&(sendActivityToServer(i.userId,i.type),pendingActivities.delete(e),debounceTimers.delete(e))},DEBOUNCE_DELAY);debounceTimers.set(e,a)}else sendActivityToServer(t,r)}function trackPackageCalculation(t){trackActivity(t,"calculation")}function trackSOPDownload(t){trackActivity(t,"sop_download")}function trackMiniSOPDownload(t){trackActivity(t,"minisop_download")}function PreferencesTab(){const{preferences:t,updatePreferences:r,isLoading:e}=usePreferences(),[s,a]=reactExports.useState({fixed_spc_value:"",fixed_discount_percentage:""}),[i,o]=reactExports.useState(!1),[c,x]=reactExports.useState(!1);reactExports.useEffect(()=>{var h,_;t&&a({fixed_spc_value:((h=t.fixed_spc_value)==null?void 0:h.toString())||"",fixed_discount_percentage:((_=t.fixed_discount_percentage)==null?void 0:_.toString())||""})},[t]);const u=async()=>{o(!0),x(!1);const h={fixed_spc_value:s.fixed_spc_value?parseFloat(s.fixed_spc_value):null,fixed_discount_percentage:s.fixed_discount_percentage?parseFloat(s.fixed_discount_percentage):null},_=await r(h);o(!1),_&&(x(!0),setTimeout(()=>x(!1),3e3))};return e?jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center h-64",children:jsxRuntimeExports.jsx(Loader2,{className:"h-8 w-8 animate-spin text-blue-600"})}):jsxRuntimeExports.jsxs("div",{className:"space-y-6",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Preferencias de cálculo"}),jsxRuntimeExports.jsxs("div",{className:"space-y-6 bg-gray-50 rounded-lg p-6",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{htmlFor:"fixed_spc_value",className:"block text-sm font-medium text-gray-700 mb-2",children:"Valor SPC fijo (opcional)"}),jsxRuntimeExports.jsx("input",{type:"number",id:"fixed_spc_value",step:"0.01",value:s.fixed_spc_value,onChange:h=>a({...s,fixed_spc_value:h.target.value}),placeholder:"Ej: 1.50",className:"block w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Si estableces un valor (positivo o negativo), los cálculos usarán este SPC automáticamente"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{htmlFor:"fixed_discount_percentage",className:"block text-sm font-medium text-gray-700 mb-2",children:"Descuento lineal fijo % (opcional)"}),jsxRuntimeExports.jsx("input",{type:"number",id:"fixed_discount_percentage",step:"0.1",min:"0",max:"100",value:s.fixed_discount_percentage,onChange:h=>a({...s,fixed_discount_percentage:h.target.value}),placeholder:"Ej: 5.0",className:"block w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Si estableces un valor, los cálculos aplicarán este descuento automáticamente (debe ser positivo)"})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-200",children:[c&&jsxRuntimeExports.jsxs("div",{className:"flex items-center text-green-600",children:[jsxRuntimeExports.jsx(CheckCircle,{className:"h-5 w-5 mr-2"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-medium",children:"Preferencias guardadas"})]}),jsxRuntimeExports.jsx("button",{onClick:u,disabled:i,className:"ml-auto flex items-center px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:i?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Loader2,{className:"animate-spin -ml-1 mr-2 h-5 w-5"}),"Guardando..."]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Save,{className:"-ml-1 mr-2 h-5 w-5"}),"Guardar cambios"]})})]})]})}function useUserStats(){const{user:t,isAuthenticated:r}=useAuth(),[e,s]=reactExports.useState(null),[a,i]=reactExports.useState([]),[o,c]=reactExports.useState(!1),[x,u]=reactExports.useState(null);reactExports.useEffect(()=>{r&&t?h():(s(null),i([]))},[r,t]);async function h(){if(t!=null&&t.id){c(!0),u(null);try{const{data:v,error:b}=await supabase.rpc("get_user_activity_summary",{p_user_id:t.id}).maybeSingle();if(b)throw b;s(v?{total_sop:v.total_sop||0,total_minisop:v.total_minisop||0,total_calculations:v.total_calculations||0,days_active:v.days_active||0,average_calculations_per_day:v.average_calculations_per_day||0,first_activity:v.first_activity,last_activity:v.last_activity}:{total_sop:0,total_minisop:0,total_calculations:0,days_active:0,average_calculations_per_day:0,first_activity:null,last_activity:null});const{data:E,error:d}=await supabase.from("user_daily_activity").select("activity_date, calculation_count, sop_count, minisop_count").eq("user_id",t.id).order("activity_date",{ascending:!1}).limit(7);if(d)throw d;i(E||[])}catch(v){console.error("Error loading user stats:",v),u(v instanceof Error?v.message:"Error al cargar estadísticas"),s({total_sop:0,total_minisop:0,total_calculations:0,days_active:0,average_calculations_per_day:0,first_activity:null,last_activity:null})}finally{c(!1)}}}async function _(){await h()}return{stats:e,dailyActivity:a,isLoading:o,error:x,refreshStats:_}}function ProfileTab(){var d;const{userData:t,user:r}=useAuth(),{preferences:e,updatePreferences:s}=usePreferences(),{stats:a,isLoading:i}=useUserStats(),[o,c]=reactExports.useState({agency_name_number:(e==null?void 0:e.agency_name_number)||"",agency_address:(e==null?void 0:e.agency_address)||"",agency_postal_town:(e==null?void 0:e.agency_postal_town)||"",agency_province:(e==null?void 0:e.agency_province)||"",agency_email:(e==null?void 0:e.agency_email)||""}),[x,u]=reactExports.useState(!1),[h,_]=reactExports.useState(null);if(!t)return jsxRuntimeExports.jsx("div",{children:"Cargando..."});const v=(g,y)=>{c(R=>({...R,[g]:y})),_(null)},b=async()=>{if(o.agency_email&&!E(o.agency_email)){_({type:"error",text:"El email no es válido"});return}u(!0),_(null);try{const g=await s({agency_name_number:o.agency_name_number||null,agency_address:o.agency_address||null,agency_postal_town:o.agency_postal_town||null,agency_province:o.agency_province||null,agency_email:o.agency_email||null});_(g?{type:"success",text:"Datos de agencia guardados correctamente"}:{type:"error",text:"Error al guardar los datos"})}catch{_({type:"error",text:"Error al guardar los datos"})}finally{u(!1)}},E=g=>/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(g);return jsxRuntimeExports.jsxs("div",{className:"space-y-6",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Información del perfil"}),jsxRuntimeExports.jsxs("div",{className:"bg-gray-50 rounded-lg p-6 space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-4",children:[jsxRuntimeExports.jsx("div",{className:"flex-shrink-0",children:jsxRuntimeExports.jsx("div",{className:"w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center",children:jsxRuntimeExports.jsx("span",{className:"text-2xl font-bold text-white",children:t.full_name.split(" ").map(g=>g[0]).join("").toUpperCase().slice(0,2)})})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h4",{className:"text-xl font-semibold text-gray-900",children:t.full_name}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600",children:t.is_admin?"Administrador":"Usuario"})]})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 gap-4 pt-4 border-t border-gray-200",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-3",children:[jsxRuntimeExports.jsx(Mail,{className:"h-5 w-5 text-gray-400"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500",children:"Email"}),jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-gray-900",children:t.email})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-3",children:[jsxRuntimeExports.jsx(Building,{className:"h-5 w-5 text-gray-400"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500",children:"Plan"}),jsxRuntimeExports.jsxs("p",{className:"text-sm font-medium text-gray-900",children:["Tier ",t.subscription_tier," (",t.max_devices," dispositivos)"]})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-3",children:[jsxRuntimeExports.jsx(Calendar,{className:"h-5 w-5 text-gray-400"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500",children:"Cuenta creada"}),jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-gray-900",children:r!=null&&r.created_at?new Date(r.created_at).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}):"N/A"})]})]})]})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Datos de la Agencia"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Estos datos se utilizarán para autocompletar los formularios de SOP"}),jsxRuntimeExports.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6 space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre y número de agencia"}),jsxRuntimeExports.jsx("input",{type:"text",value:o.agency_name_number,onChange:g=>v("agency_name_number",g.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ej: Agencia Madrid 001"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Dirección (Calle y número)"}),jsxRuntimeExports.jsx("input",{type:"text",value:o.agency_address,onChange:g=>v("agency_address",g.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ej: Calle Principal 123"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CP y Población"}),jsxRuntimeExports.jsx("input",{type:"text",value:o.agency_postal_town,onChange:g=>v("agency_postal_town",g.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ej: 28540 Valdemoro (Madrid)"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Provincia"}),jsxRuntimeExports.jsx("input",{type:"text",value:o.agency_province,onChange:g=>v("agency_province",g.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ej: Madrid"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email de contacto agencia"}),jsxRuntimeExports.jsx("input",{type:"email",value:o.agency_email,onChange:g=>v("agency_email",g.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ej: agencia@ejemplo.com"})]}),h&&jsxRuntimeExports.jsx("div",{className:`rounded-lg p-3 text-sm ${h.type==="success"?"bg-green-50 text-green-800 border border-green-200":"bg-red-50 text-red-800 border border-red-200"}`,children:h.text}),jsxRuntimeExports.jsx("div",{className:"flex justify-end pt-2",children:jsxRuntimeExports.jsx("button",{onClick:b,disabled:x,className:`inline-flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-semibold transition-colors ${x?"bg-gray-200 text-gray-500 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white"}`,children:x?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Loader2,{className:"h-4 w-4 animate-spin"}),"Guardando..."]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Save,{className:"h-4 w-4"}),"Guardar cambios"]})})})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Estadísticas de Uso"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Métricas de uso de la herramienta"}),i?jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center py-8",children:jsxRuntimeExports.jsx(Loader2,{className:"h-8 w-8 animate-spin text-blue-600"})}):jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[jsxRuntimeExports.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 border border-blue-200 rounded-lg p-4",children:[jsxRuntimeExports.jsx("div",{className:"flex items-center justify-between mb-2",children:jsxRuntimeExports.jsx(FileSpreadsheet,{className:"h-8 w-8 text-blue-600"})}),jsxRuntimeExports.jsx("p",{className:"text-2xl font-bold text-blue-900",children:(a==null?void 0:a.total_sop)||0}),jsxRuntimeExports.jsx("p",{className:"text-sm text-blue-700",children:"SOP generados"})]}),jsxRuntimeExports.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-green-100 border border-green-200 rounded-lg p-4",children:[jsxRuntimeExports.jsx("div",{className:"flex items-center justify-between mb-2",children:jsxRuntimeExports.jsx(FileText,{className:"h-8 w-8 text-green-600"})}),jsxRuntimeExports.jsx("p",{className:"text-2xl font-bold text-green-900",children:(a==null?void 0:a.total_minisop)||0}),jsxRuntimeExports.jsx("p",{className:"text-sm text-green-700",children:"Mini-SOP generados"})]}),jsxRuntimeExports.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-purple-100 border border-purple-200 rounded-lg p-4",children:[jsxRuntimeExports.jsx("div",{className:"flex items-center justify-between mb-2",children:jsxRuntimeExports.jsx(Calculator,{className:"h-8 w-8 text-purple-600"})}),jsxRuntimeExports.jsx("p",{className:"text-2xl font-bold text-purple-900",children:(a==null?void 0:a.total_calculations)||0}),jsxRuntimeExports.jsx("p",{className:"text-sm text-purple-700",children:"Cálculos realizados"})]}),jsxRuntimeExports.jsxs("div",{className:"bg-gradient-to-br from-orange-50 to-orange-100 border border-orange-200 rounded-lg p-4",children:[jsxRuntimeExports.jsx("div",{className:"flex items-center justify-between mb-2",children:jsxRuntimeExports.jsx(TrendingUp,{className:"h-8 w-8 text-orange-600"})}),jsxRuntimeExports.jsx("p",{className:"text-2xl font-bold text-orange-900",children:((d=a==null?void 0:a.average_calculations_per_day)==null?void 0:d.toFixed(1))||"0"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-orange-700",children:"Promedio diario"}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-orange-600 mt-1",children:[(a==null?void 0:a.days_active)||0," días activos"]})]})]}),a&&(a.total_sop>0||a.total_calculations>0)&&jsxRuntimeExports.jsxs("div",{className:"mt-4 bg-blue-50 border border-blue-200 rounded-lg p-4",children:[jsxRuntimeExports.jsxs("p",{className:"text-sm text-blue-800",children:[jsxRuntimeExports.jsx("strong",{children:"Primera actividad:"})," ",a.first_activity?new Date(a.first_activity).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}):"Sin actividad registrada"]}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-blue-800 mt-1",children:[jsxRuntimeExports.jsx("strong",{children:"Última actividad:"})," ",a.last_activity?new Date(a.last_activity).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}):"Sin actividad registrada"]})]})]})]})}const pricingPlans=[{id:"plan-1",tier:1,name:"Plan Básico",monthlyPrice:90,annualPrice:990,devices:1,monthlyIfPaidMonthly:90*12,monthsFree:1,pricePerDevicePerYear:990,savingsPerDeviceVsPlan1:0,savingsPercentage:8.3,badge:"Básico"},{id:"plan-2",tier:2,name:"Plan Profesional",monthlyPrice:180,annualPrice:1890,devices:3,monthlyIfPaidMonthly:180*12,monthsFree:1.5,pricePerDevicePerYear:630,savingsPerDeviceVsPlan1:360,savingsPercentage:12.5,badge:"Popular"},{id:"plan-3",tier:3,name:"Plan Empresa",monthlyPrice:270,annualPrice:2700,devices:5,monthlyIfPaidMonthly:270*12,monthsFree:2,pricePerDevicePerYear:540,savingsPerDeviceVsPlan1:450,savingsPercentage:16.7},{id:"plan-4",tier:4,name:"Plan Corporativo",monthlyPrice:315,annualPrice:3150,devices:8,monthlyIfPaidMonthly:315*12,monthsFree:2,pricePerDevicePerYear:393.75,savingsPerDeviceVsPlan1:596.25,savingsPercentage:16.7,isBestValue:!0,badge:"MEJOR VALOR"}],getAnnualSavings=t=>t.monthlyIfPaidMonthly-t.annualPrice;pricingPlans.map(t=>({title:`${t.devices} ${t.devices===1?"dispositivo":"dispositivos"}`,subtitle:`${t.monthsFree} ${t.monthsFree===1?"mes":"meses"} gratis`,price:`€${t.annualPrice.toLocaleString()}/año`,perDevice:`€${Math.round(t.pricePerDevicePerYear)}/dispositivo`,savings:t.savingsPerDeviceVsPlan1>0?`Ahorras €${t.savingsPerDeviceVsPlan1.toFixed(0)} por dispositivo`:null}));const getPlanByTier=t=>pricingPlans.find(r=>r.tier===t);function PricingToggle({isAnnual:t,onToggle:r}){return jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-center gap-4 mb-12",children:[jsxRuntimeExports.jsx("span",{className:`text-lg font-medium transition-colors ${t?"text-gray-500":"text-gray-900"}`,children:"Mensual"}),jsxRuntimeExports.jsx("button",{onClick:()=>r(!t),className:"relative inline-flex h-8 w-16 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",style:{backgroundColor:t?"#16a34a":"#9ca3af"},role:"switch","aria-checked":t,"aria-label":"Cambiar entre pago mensual y anual",children:jsxRuntimeExports.jsx("span",{className:`inline-block h-6 w-6 transform rounded-full bg-white shadow-lg transition-transform ${t?"translate-x-9":"translate-x-1"}`})}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:`text-lg font-medium transition-colors ${t?"text-gray-900":"text-gray-500"}`,children:"Anual"}),t&&jsxRuntimeExports.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-semibold bg-green-100 text-green-800 animate-pulse",children:"Ahorra hasta 16.7%"})]})]})}function PlanCard({plan:t,isAnnual:r,onSelect:e,isLoading:s,viewOnly:a=!1,isCurrentPlan:i=!1}){const[o,c]=reactExports.useState(!1),x=async()=>{if(!a){c(!0);try{await e(t.tier,r?"annual":"monthly")}finally{c(!1)}}},u=r?t.annualPrice:t.monthlyPrice,h=Math.round(r?t.pricePerDevicePerYear:t.monthlyPrice*12/t.devices),_=r?Math.round(t.annualPrice/12):null,v=r?getAnnualSavings(t):null,b=t.isBestValue?"bg-green-600":t.badge==="Popular"?"bg-blue-600":"bg-gray-600",E=t.isBestValue?"bg-green-600 hover:bg-green-700":"bg-gray-900 hover:bg-gray-800";return jsxRuntimeExports.jsxs("div",{className:`relative bg-white rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 flex flex-col ${t.isBestValue?"ring-2 ring-green-600 scale-105":""} ${i?"ring-2 ring-blue-600":""}`,children:[i&&jsxRuntimeExports.jsx("div",{className:"absolute -top-4 left-1/2 transform -translate-x-1/2",children:jsxRuntimeExports.jsx("span",{className:"bg-blue-600 text-white text-xs font-bold px-4 py-1 rounded-full shadow-lg",children:"Tu plan actual"})}),t.badge&&!i&&jsxRuntimeExports.jsx("div",{className:"absolute -top-4 left-1/2 transform -translate-x-1/2",children:jsxRuntimeExports.jsx("span",{className:`${b} text-white text-xs font-bold px-4 py-1 rounded-full shadow-lg`,children:t.badge})}),jsxRuntimeExports.jsxs("div",{className:"p-8 flex-1 flex flex-col",children:[jsxRuntimeExports.jsxs("div",{className:"text-center mb-6",children:[jsxRuntimeExports.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-2",children:t.name}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-center gap-2 text-gray-600",children:[jsxRuntimeExports.jsx(Smartphone,{className:"h-4 w-4"}),jsxRuntimeExports.jsxs("span",{className:"text-sm",children:[t.devices," ",t.devices===1?"dispositivo":"dispositivos"]})]})]}),jsxRuntimeExports.jsxs("div",{className:"text-center mb-6",children:[jsxRuntimeExports.jsxs("div",{className:"mb-2",children:[jsxRuntimeExports.jsxs("span",{className:"text-5xl font-bold text-gray-900",children:["€",u]}),jsxRuntimeExports.jsxs("span",{className:"text-gray-600 text-lg",children:["/",r?"año":"mes"]})]}),r&&_&&jsxRuntimeExports.jsxs("p",{className:"text-sm text-gray-600",children:["Equivale a ",jsxRuntimeExports.jsxs("span",{className:"font-semibold",children:["€",_,"/mes"]})]}),!r&&jsxRuntimeExports.jsxs("p",{className:"text-sm text-gray-500",children:["€",t.monthlyPrice*12,"/año sin descuento"]})]}),r&&t.monthsFree>0&&jsxRuntimeExports.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3 mb-6",children:[jsxRuntimeExports.jsxs("p",{className:"text-green-800 font-semibold text-sm text-center",children:[t.monthsFree," ",t.monthsFree===1?"mes":"meses"," gratis"]}),jsxRuntimeExports.jsxs("p",{className:"text-green-700 text-xs text-center mt-1",children:["Pagas ",12-t.monthsFree,", usas 12"]})]}),r&&v&&v>0&&jsxRuntimeExports.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-6",children:[jsxRuntimeExports.jsxs("p",{className:"text-blue-800 font-semibold text-sm text-center",children:["Ahorras €",v," al año"]}),jsxRuntimeExports.jsx("p",{className:"text-blue-700 text-xs text-center mt-1",children:"vs. pago mensual"})]}),jsxRuntimeExports.jsxs("div",{className:"mb-6",children:[jsxRuntimeExports.jsxs("p",{className:"text-center text-sm text-gray-600",children:[jsxRuntimeExports.jsxs("span",{className:"font-semibold text-gray-900",children:["€",h,"/dispositivo"]}),"/año"]}),t.savingsPerDeviceVsPlan1>0&&jsxRuntimeExports.jsxs("p",{className:"text-center text-xs text-green-600 mt-1",children:["Ahorras €",t.savingsPerDeviceVsPlan1.toFixed(0)," vs. Plan Básico"]})]}),a?jsxRuntimeExports.jsx("div",{className:"w-full bg-gray-100 text-gray-600 font-semibold py-4 px-6 rounded-xl text-center",children:i?"Plan activo":"Contacta comercial para cambiar"}):jsxRuntimeExports.jsx("button",{onClick:x,disabled:o||s,className:`w-full ${E} text-white font-semibold py-4 px-6 rounded-xl transition-all duration-200 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none flex items-center justify-center gap-2`,children:o?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Loader2,{className:"h-5 w-5 animate-spin"}),"Procesando..."]}):`Seleccionar ${t.name}`}),jsxRuntimeExports.jsxs("div",{className:"mt-8 space-y-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-3",children:[jsxRuntimeExports.jsx(Check,{className:"h-5 w-5 text-green-600 flex-shrink-0 mt-0.5"}),jsxRuntimeExports.jsxs("span",{className:"text-sm text-gray-700",children:[t.devices," ",t.devices===1?"dispositivo activo":"dispositivos activos"]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-3",children:[jsxRuntimeExports.jsx(Check,{className:"h-5 w-5 text-green-600 flex-shrink-0 mt-0.5"}),jsxRuntimeExports.jsx("span",{className:"text-sm text-gray-700",children:"Soporte técnico 24/7"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-3",children:[jsxRuntimeExports.jsx(Check,{className:"h-5 w-5 text-green-600 flex-shrink-0 mt-0.5"}),jsxRuntimeExports.jsx("span",{className:"text-sm text-gray-700",children:"Actualizaciones automáticas incluidas"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-3",children:[jsxRuntimeExports.jsx(Check,{className:"h-5 w-5 text-green-600 flex-shrink-0 mt-0.5"}),jsxRuntimeExports.jsx("span",{className:"text-sm text-gray-700",children:"Comparador comercial y generador de tarifas"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-3",children:[jsxRuntimeExports.jsx(Check,{className:"h-5 w-5 text-green-600 flex-shrink-0 mt-0.5"}),jsxRuntimeExports.jsx("span",{className:"text-sm text-gray-700",children:"Exportación a Excel/PDF"})]})]})]})]})}function PlanViewModal({isOpen:t,onClose:r,currentTier:e}){const[s,a]=reactExports.useState(!0);if(!t)return null;const i=()=>{};return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0",children:[jsxRuntimeExports.jsx("div",{className:"fixed inset-0 transition-opacity bg-gray-500 bg-opacity-75",onClick:r}),jsxRuntimeExports.jsx("span",{className:"hidden sm:inline-block sm:align-middle sm:h-screen",children:"​"}),jsxRuntimeExports.jsxs("div",{className:"inline-block w-full max-w-7xl my-8 overflow-hidden text-left align-middle transition-all transform bg-white shadow-xl rounded-2xl",children:[jsxRuntimeExports.jsxs("div",{className:"sticky top-0 z-10 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center w-10 h-10 bg-blue-100 rounded-lg",children:jsxRuntimeExports.jsx(Calculator,{className:"h-6 w-6 text-blue-600"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Planes disponibles"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600",children:"Comparativa de precios y características"})]})]}),jsxRuntimeExports.jsx("button",{onClick:r,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:jsxRuntimeExports.jsx(X,{className:"h-6 w-6"})})]}),jsxRuntimeExports.jsxs("div",{className:"px-6 py-8 max-h-[calc(100vh-12rem)] overflow-y-auto",children:[jsxRuntimeExports.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4 mb-6 flex items-start gap-3",children:[jsxRuntimeExports.jsx(Info,{className:"h-5 w-5 text-blue-600 flex-shrink-0 mt-0.5"}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("p",{className:"text-sm text-blue-900 font-medium",children:"Esta es una vista informativa de los planes disponibles"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-blue-800 mt-1",children:"Para cambiar de plan, actualizar métodos de pago o consultar facturas, por favor contacta con el departamento comercial."})]})]}),jsxRuntimeExports.jsx("div",{className:"mb-6",children:jsxRuntimeExports.jsx(PricingToggle,{isAnnual:s,onToggle:a})}),jsxRuntimeExports.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 mb-8",children:pricingPlans.map(o=>jsxRuntimeExports.jsx(PlanCard,{plan:o,isAnnual:s,onSelect:i,viewOnly:!0,isCurrentPlan:e===o.tier},o.id))}),jsxRuntimeExports.jsxs("div",{className:"bg-gray-50 rounded-xl p-6",children:[jsxRuntimeExports.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[jsxRuntimeExports.jsx(Shield,{className:"h-5 w-5 text-gray-700"}),"Beneficios incluidos en todos los planes"]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[jsxRuntimeExports.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:"Precisión Total"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600",children:"Cálculos exactos incluyendo costes ocultos e incrementos"})]}),jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[jsxRuntimeExports.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:"Ahorro Inmediato"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600",children:"Recupera tu inversión en días con un solo uso diario"})]}),jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[jsxRuntimeExports.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:"Comparativa Competitiva"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600",children:"Genera propuestas profesionales en minutos"})]})]})]}),s&&jsxRuntimeExports.jsx("div",{className:"bg-gradient-to-r from-green-50 to-blue-50 border-2 border-green-200 rounded-xl p-4 mt-6",children:jsxRuntimeExports.jsxs("p",{className:"text-center text-gray-800",children:[jsxRuntimeExports.jsx("span",{className:"font-bold text-green-700",children:"Plan Corporativo:"})," Hasta 58% más barato por dispositivo que planes individuales"]})})]}),jsxRuntimeExports.jsx("div",{className:"sticky bottom-0 bg-gray-50 border-t border-gray-200 px-6 py-4 flex justify-end",children:jsxRuntimeExports.jsx("button",{onClick:r,className:"px-6 py-2.5 bg-gray-900 text-white font-semibold rounded-lg hover:bg-gray-800 transition-colors",children:"Cerrar"})})]})]})})}function SubscriptionTab(){const{userData:t}=useAuth(),[r,e]=reactExports.useState([]),[s,a]=reactExports.useState(!0),[i,o]=reactExports.useState(!1);reactExports.useEffect(()=>{t!=null&&t.id&&c()},[t]);async function c(){try{const y=await fetch("https://eyvhuoldrjfntkffpkfm.supabase.co/functions/v1/get-active-sessions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV5dmh1b2xkcmpmbnRrZmZwa2ZtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg2Mzk3MjgsImV4cCI6MjA3NDIxNTcyOH0.3zYeVfbaU71HNYQK_29Qki1fnQhLGccFtIFDZn_x2Es"},body:JSON.stringify({userId:t.id})}),R=await y.json();if(!y.ok){console.error("Error loading sessions:",R.error);return}e(R.sessions||[])}catch(y){console.error("Error:",y)}finally{a(!1)}}if(!t)return jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center h-64",children:jsxRuntimeExports.jsx(Loader2,{className:"h-8 w-8 animate-spin text-blue-600"})});const x={active:{label:"Activa",color:"text-green-600 bg-green-50 border-green-200",icon:CheckCircle},trial:{label:"Periodo de prueba",color:"text-blue-600 bg-blue-50 border-blue-200",icon:CheckCircle},past_due:{label:"Pago pendiente",color:"text-yellow-600 bg-yellow-50 border-yellow-200",icon:AlertCircle},cancelled:{label:"Cancelada",color:"text-red-600 bg-red-50 border-red-200",icon:AlertCircle}},u={stripe:"Pago con tarjeta",manual:"Transferencia bancaria",promo:"Código promocional",trial:"Periodo de prueba gratuito",admin_grant:"Acceso administrativo"},h=getPlanByTier(t.subscription_tier),_=t.is_admin||t.email==="dcprats@gmail.com",v=x[t.subscription_status]||x.active,b=v.icon,E=t.subscription_end_date?new Date(t.subscription_end_date):null,d=E?Math.ceil((E.getTime()-new Date().getTime())/(1e3*60*60*24)):null,g=t.max_devices>0?r.length/t.max_devices*100:0;return jsxRuntimeExports.jsxs("div",{className:"space-y-6",children:[_&&jsxRuntimeExports.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 rounded-lg p-6 text-white",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-3",children:[jsxRuntimeExports.jsx(Shield,{className:"h-8 w-8"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-xl font-bold",children:"Cuenta Administrador"}),jsxRuntimeExports.jsx("p",{className:"text-blue-100 text-sm",children:"Acceso completo al sistema"})]})]})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Información de suscripción"}),jsxRuntimeExports.jsxs("div",{className:"bg-gray-50 rounded-lg p-6 space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:`flex items-center space-x-2 px-3 py-2 rounded-lg border ${v.color}`,children:[jsxRuntimeExports.jsx(b,{className:"h-5 w-5"}),jsxRuntimeExports.jsx("span",{className:"font-medium",children:v.label})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 pt-4 border-t border-gray-200",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start space-x-3",children:[jsxRuntimeExports.jsx(CreditCard,{className:"h-5 w-5 text-gray-400 mt-1"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500",children:"Plan contratado"}),jsxRuntimeExports.jsx("p",{className:"text-lg font-semibold text-gray-900",children:_?"Plan Administrador":(h==null?void 0:h.name)||`Tier ${t.subscription_tier}`}),h&&!_&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600 mt-1",children:t.subscription_interval==="annual"?`${h.annualPrice}€/año (Plan Anual)`:`${h.monthlyPrice}€/mes (Plan Mensual)`}),t.subscription_interval==="annual"&&jsxRuntimeExports.jsxs("p",{className:"text-xs text-green-600 mt-0.5 font-medium",children:["Ahorro: ",h.monthlyPrice*12-h.annualPrice,"€/año"]})]}),_&&jsxRuntimeExports.jsx("p",{className:"text-sm text-blue-600 mt-1 font-medium",children:"Sin coste · Acceso permanente"})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-start space-x-3",children:[jsxRuntimeExports.jsx(Smartphone,{className:"h-5 w-5 text-gray-400 mt-1"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500",children:"Dispositivos"}),jsxRuntimeExports.jsxs("p",{className:"text-lg font-semibold text-gray-900",children:[t.max_devices," ",t.max_devices===1?"dispositivo":"dispositivos"]}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Tier ",t.subscription_tier]})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-start space-x-3",children:[jsxRuntimeExports.jsx(CreditCard,{className:"h-5 w-5 text-gray-400 mt-1"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500",children:"Método de pago"}),jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-gray-900 mt-1",children:u[t.payment_method]||t.payment_method})]})]}),E&&!_&&jsxRuntimeExports.jsxs("div",{className:"flex items-start space-x-3",children:[jsxRuntimeExports.jsx(Calendar,{className:"h-5 w-5 text-gray-400 mt-1"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500",children:d&&d>0?t.subscription_interval==="annual"?"Renovación anual":"Renovación mensual":"Fecha de expiración"}),jsxRuntimeExports.jsx("p",{className:"text-lg font-semibold text-gray-900",children:E.toLocaleDateString("es-ES",{day:"numeric",month:"long",year:"numeric"})}),d!==null&&d>0&&jsxRuntimeExports.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[d," ",d===1?"día":"días"," restantes"]}),d!==null&&d<=0&&jsxRuntimeExports.jsx("p",{className:"text-sm text-red-600 mt-1 font-medium",children:"Suscripción expirada"}),d!==null&&d>0&&d<=7&&jsxRuntimeExports.jsx("p",{className:"text-sm text-yellow-600 mt-1 font-medium",children:"Renovación próxima"})]})]}),_&&jsxRuntimeExports.jsxs("div",{className:"flex items-start space-x-3",children:[jsxRuntimeExports.jsx(Calendar,{className:"h-5 w-5 text-gray-400 mt-1"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500",children:"Validez"}),jsxRuntimeExports.jsx("p",{className:"text-lg font-semibold text-gray-900",children:"Permanente"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-blue-600 mt-1",children:"Sin fecha de expiración"})]})]})]})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Dispositivos conectados"}),jsxRuntimeExports.jsxs("div",{className:"bg-gray-50 rounded-lg p-6 space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-2",children:[jsxRuntimeExports.jsx(Users,{className:"h-5 w-5 text-gray-600"}),jsxRuntimeExports.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[r.length," de ",t.max_devices," en uso"]})]}),jsxRuntimeExports.jsxs("span",{className:"text-sm text-gray-600",children:[Math.round(g),"% capacidad"]})]}),jsxRuntimeExports.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:jsxRuntimeExports.jsx("div",{className:`h-3 rounded-full transition-all duration-300 ${g>=90?"bg-red-600":g>=70?"bg-yellow-600":"bg-green-600"}`,style:{width:`${Math.min(g,100)}%`}})}),s?jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center py-4",children:jsxRuntimeExports.jsx(Loader2,{className:"h-6 w-6 animate-spin text-blue-600"})}):r.length>0?jsxRuntimeExports.jsxs("div",{className:"space-y-2 pt-2",children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500 uppercase font-medium",children:"Sesiones activas"}),r.map(y=>jsxRuntimeExports.jsx("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border border-gray-200",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-3",children:[jsxRuntimeExports.jsx(Smartphone,{className:"h-4 w-4 text-gray-400"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-gray-900",children:y.device_name||"Dispositivo desconocido"}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-gray-500",children:["Última actividad: ",new Date(y.last_authenticated_at).toLocaleString("es-ES")]})]})]})},y.id))]}):jsxRuntimeExports.jsx("div",{className:"text-center py-4",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600",children:"No hay dispositivos conectados actualmente"})}),g===100&&!_&&jsxRuntimeExports.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 mt-4",children:jsxRuntimeExports.jsxs("p",{className:"text-sm text-red-800",children:[jsxRuntimeExports.jsx("strong",{children:"Capacidad completa:"})," ",t.max_devices===1?"Tu único dispositivo está en uso. Actualiza tu suscripción para permitir más sesiones simultáneas.":`Todos tus ${t.max_devices} dispositivos disponibles están en uso. Actualiza tu suscripción si necesitas más dispositivos simultáneos.`]})}),g>=90&&g<100&&!_&&jsxRuntimeExports.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3 mt-4",children:jsxRuntimeExports.jsxs("p",{className:"text-sm text-yellow-800",children:[jsxRuntimeExports.jsx("strong",{children:"Cerca del límite:"})," Estás usando casi todos tus dispositivos disponibles. Considera actualizar tu plan si necesitas más dispositivos simultáneos."]})}),g>=70&&g<90&&!_&&jsxRuntimeExports.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mt-4",children:jsxRuntimeExports.jsxs("p",{className:"text-sm text-blue-800",children:[jsxRuntimeExports.jsx("strong",{children:"Alto uso:"})," Estás utilizando la mayor parte de tus dispositivos disponibles."]})})]})]}),!_&&jsxRuntimeExports.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:jsxRuntimeExports.jsxs("div",{className:"flex items-start justify-between gap-4",children:[jsxRuntimeExports.jsx("div",{className:"flex-1",children:jsxRuntimeExports.jsxs("p",{className:"text-sm text-blue-800",children:[jsxRuntimeExports.jsx("strong",{children:"Gestión de facturación:"})," Para modificar tu plan, actualizar métodos de pago o consultar facturas, contacta con el departamento comercial."]})}),jsxRuntimeExports.jsxs("button",{onClick:()=>o(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white text-sm font-semibold rounded-lg hover:bg-blue-700 transition-colors whitespace-nowrap",children:[jsxRuntimeExports.jsx(Eye,{className:"h-4 w-4"}),"Ver planes"]})]})}),jsxRuntimeExports.jsx(PlanViewModal,{isOpen:i,onClose:()=>o(!1),currentTier:t==null?void 0:t.subscription_tier}),!_&&h&&jsxRuntimeExports.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[jsxRuntimeExports.jsx("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Detalles del plan"}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-gray-500",children:"Precio mensual"}),jsxRuntimeExports.jsxs("p",{className:"font-semibold text-gray-900",children:[h.monthlyPrice,"€/mes"]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-gray-500",children:"Precio anual"}),jsxRuntimeExports.jsxs("p",{className:"font-semibold text-gray-900",children:[h.annualPrice,"€/año"]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-gray-500",children:"Ahorro anual"}),jsxRuntimeExports.jsxs("p",{className:"font-semibold text-green-600",children:[h.monthlyPrice*12-h.annualPrice,"€"]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-gray-500",children:"Precio por dispositivo"}),jsxRuntimeExports.jsxs("p",{className:"font-semibold text-gray-900",children:[Math.round(h.pricePerDevicePerYear),"€/año"]})]})]})]})]})}function useTariffs(t,r=!1,e=!1,s){const[a,i]=reactExports.useState([]),[o,c]=reactExports.useState(!0),[x,u]=reactExports.useState(null);return reactExports.useEffect(()=>{(async()=>{try{const{data:_,error:v}=await supabase.from("tariffs").select("*");if(v)throw v;let b=(_||[]).map(E=>({...E,weight_from:parseFloat(E.weight_from)||0,weight_to:E.weight_to?parseFloat(E.weight_to):null})).sort((E,d)=>E.service_name!==d.service_name?E.service_name.localeCompare(d.service_name):E.weight_from-d.weight_from);if(e)try{const{data:E}=await supabase.from("custom_tariffs").select("*"),{data:d}=await supabase.from("custom_tariffs_active").select("*").eq("is_active",!0);if(E&&d&&d.length>0){const g=new Set(d.map(y=>y.service_name));b=mergeCustomTariffs(b,E,g)}}catch(E){console.error("Error loading custom tariffs, using standard tariffs:",E)}i(b)}catch(_){u(_ instanceof Error?_.message:"Error fetching tariffs")}finally{c(!1)}})()},[t,r,e,s]),{tariffs:a,loading:o,error:x}}function applyCustomOverrides(t,r){const e=JSON.parse(JSON.stringify(t));for(const s of r){const a=e.filter(i=>{const o=i.service_name===s.service_name,c=i.weight_from>=s.weight_from&&(s.weight_to===null||i.weight_to===null||i.weight_from<=s.weight_to);return o&&c});for(const i of a)s.cost_factor_name in i&&(i[s.cost_factor_name]=s.override_value)}return e}function mergeCustomTariffs(t,r,e){const s=JSON.parse(JSON.stringify(t));for(const a of r){if(!e.has(a.service_name))continue;const i=s.findIndex(o=>o.service_name===a.service_name&&o.weight_from.toString()===a.weight_from&&(o.weight_to===null&&a.weight_to==="999"||o.weight_to!==null&&o.weight_to.toString()===a.weight_to));if(i!==-1){const o=s[i];Object.keys(a).forEach(c=>{if(c!=="id"&&c!=="user_id"&&c!=="service_name"&&c!=="weight_from"&&c!=="weight_to"&&c!=="created_at"&&c!=="updated_at"){const x=a[c];x!=null&&(o[c]=x)}}),s[i]=o}}return s}function useDiscountPlans(){const[t,r]=reactExports.useState([]),[e,s]=reactExports.useState(!0),[a,i]=reactExports.useState(null);return reactExports.useEffect(()=>{(async()=>{try{const{data:c,error:x}=await supabase.from("discount_plans").select("*").eq("is_active",!0).order("plan_name",{ascending:!0});if(x)throw x;r(c||[])}catch(c){i(c instanceof Error?c.message:"Error fetching discount plans")}finally{s(!1)}})()},[]),{discountPlans:t,loading:e,error:a}}function useCustomTariffs(t){const[r,e]=reactExports.useState([]),[s,a]=reactExports.useState(!0),[i,o]=reactExports.useState(null);return reactExports.useEffect(()=>{(async()=>{try{let x=supabase.from("custom_tariffs").select("*");t&&(x=x.eq("user_id",t));const{data:u,error:h}=await x.order("service_name",{ascending:!0}).order("weight_from",{ascending:!0});if(h)throw h;e(u||[])}catch(x){o(x instanceof Error?x.message:"Error fetching custom tariffs")}finally{a(!1)}})()},[t]),{customTariffs:r,loading:s,error:i,refetch:async()=>{a(!0);try{let c=supabase.from("custom_tariffs").select("*");t&&(c=c.eq("user_id",t));const{data:x,error:u}=await c.order("service_name",{ascending:!0}).order("weight_from",{ascending:!0});if(u)throw u;e(x||[]),o(null)}catch(c){o(c instanceof Error?c.message:"Error fetching custom tariffs")}finally{a(!1)}}}}function useCustomTariffsActive(t){const[r,e]=reactExports.useState([]),[s,a]=reactExports.useState(!0),[i,o]=reactExports.useState(null);return reactExports.useEffect(()=>{(async()=>{try{let x=supabase.from("custom_tariffs_active").select("*");t&&(x=x.eq("user_id",t));const{data:u,error:h}=await x.order("service_name",{ascending:!0});if(h)throw h;e(u||[])}catch(x){o(x instanceof Error?x.message:"Error fetching custom tariffs active states")}finally{a(!1)}})()},[t]),{activeStates:r,loading:s,error:i,refetch:async()=>{a(!0);try{let c=supabase.from("custom_tariffs_active").select("*");t&&(c=c.eq("user_id",t));const{data:x,error:u}=await c.order("service_name",{ascending:!0});if(u)throw u;e(x||[]),o(null)}catch(c){o(c instanceof Error?c.message:"Error fetching custom tariffs active states")}finally{a(!1)}}}}function useInternationalEuropeTariffs(){const[t,r]=reactExports.useState([]),[e,s]=reactExports.useState(!0),[a,i]=reactExports.useState(null);return reactExports.useEffect(()=>{(async()=>{try{const{data:c,error:x}=await supabase.from("tariffs_international_europe").select("id, service_name, weight_from, weight_to, country, cost").order("country",{ascending:!0}).order("weight_from",{ascending:!0});if(x)throw x;r(c||[])}catch(c){i(c instanceof Error?c.message:"Error fetching international europe tariffs")}finally{s(!1)}})()},[]),{tariffs:t,loading:e,error:a}}function calculateInternationalEuropeCost(t,r,e){const s=Math.ceil(Math.max(e,0));if(s<=0)return 0;const a=t.filter(_=>_.country===r);if(!a.length)return null;const i=[...a].sort((_,v)=>_.weight_from-v.weight_from),o=i.filter(_=>_.weight_to!==null),c=i.find(_=>_.weight_to===null),x=o.length>0?o[o.length-1]:null,u=(x==null?void 0:x.weight_to)??0;let h=null;for(const _ of o){const v=_.weight_from===0;if(v&&s<=(_.weight_to??0)){h=_;break}if(!v&&s>_.weight_from&&s<=(_.weight_to??0)){h=_;break}}if(h)return h.cost;if(s>u&&c&&x){const _=s-u;return x.cost+_*c.cost}return null}const RAW_CUSTOM_PLANS=[{baseId:"custom-plan-integral-2026",planName:"Plan Integral 2026",message:"Válida desde 01/01/26",services:{"Urg8:30H Courier":{upto1:35,upto3:35,upto5:35,upto10:35,upto15:35,additional:15},"Urg10H Courier":{upto1:50,upto3:50,upto5:40,upto10:40,upto15:40,additional:15},"Urg14H Courier":{upto1:50,upto3:50,upto5:40,upto10:35,upto15:35,additional:15},"Urg19H Courier":{upto1:50,upto3:50,upto5:40,upto10:35,upto15:35,additional:15},"Business Parcel":{upto1:60,upto3:60,upto5:50,upto10:50,upto15:50,additional:40},"Economy Parcel":{upto1:40,upto3:40,upto5:40,upto10:40,upto15:40,additional:35}}},{baseId:"custom-plan-integral-2025-plus10",planName:"Plan Integral 2025 +10",message:"Válida sólo hasta 31/12/25",services:{"Urg8:30H Courier":{upto1:45,upto3:45,upto5:45,upto10:45,upto15:45,additional:25},"Urg10H Courier":{upto1:60,upto3:60,upto5:50,upto10:50,upto15:50,additional:25},"Urg14H Courier":{upto1:60,upto3:60,upto5:50,upto10:45,upto15:45,additional:25},"Urg19H Courier":{upto1:60,upto3:60,upto5:50,upto10:45,upto15:45,additional:25},"Business Parcel":{upto1:70,upto3:70,upto5:60,upto10:60,upto15:60,additional:50},"Economy Parcel":{upto1:50,upto3:50,upto5:50,upto10:50,upto15:50,additional:45}}}],toServiceKey=t=>t.toLowerCase().replace(/\s+/g,"-"),CUSTOM_PLAN_ENTRIES=RAW_CUSTOM_PLANS.flatMap(t=>Object.entries(t.services).map(([r,e])=>{const s=`${t.baseId}-${toServiceKey(r)}`,a={id:s,plan_name:t.planName,service_name:r,discount_type:"custom",discount_value:0,min_volume:0,max_volume:void 0,applies_to:"cost",is_active:!0,created_at:"1970-01-01T00:00:00Z"};return{id:s,discountPlan:a,message:t.message,percentages:e}})),CUSTOM_DISCOUNT_PLANS=CUSTOM_PLAN_ENTRIES.map(t=>t.discountPlan),CUSTOM_PLAN_MAP=new Map(CUSTOM_PLAN_ENTRIES.map(t=>[t.id,t]));new Set(CUSTOM_PLAN_ENTRIES.map(t=>t.id));const getCustomPlanDefinition=t=>CUSTOM_PLAN_MAP.get(t),getCustomPlanMessage=t=>{var r;return(r=CUSTOM_PLAN_MAP.get(t))==null?void 0:r.message},getWeightBracket=t=>{const r=Math.ceil(Math.max(0,t));return r<=1?"upto1":r<=3?"upto3":r<=5?"upto5":r<=10?"upto10":r<=15?"upto15":"additional"},getCustomPlanPercentage=(t,r,e)=>{const s=CUSTOM_PLAN_MAP.get(t);if(!s||s.discountPlan.service_name!==r)return 0;const a=getWeightBracket(e);return s.percentages[a]??0},normalizePlanGroupKey=t=>t.trim().toLowerCase(),getPlanGroupKey=t=>normalizePlanGroupKey(t.plan_name),findPlanForServiceGroup=(t,r,e)=>{if(!r)return;const s=normalizePlanGroupKey(r);return t.find(a=>normalizePlanGroupKey(a.plan_name)===s&&a.service_name===e)},sopLog$2=(...t)=>{console.log("[SOP]",...t)},STATIC_SERVICES=["Urg8:30H Courier","Urg10H Courier","Urg14H Courier","Urg19H Courier","Business Parcel","EuroBusiness Parcel","Economy Parcel","Marítimo","Parcel Shop","EuroBusiness Parcel Internacional"],INTERNATIONAL_EUROPE_SERVICE="EuroBusiness Parcel Internacional",isInternationalEuropeService=t=>t===INTERNATIONAL_EUROPE_SERVICE,DESTINATION_ZONES=["Provincial","Regional","Nacional","Portugal","Madeira Mayores","Madeira Menores","Azores Mayores","Azores Menores","Andorra","Gibraltar","Canarias Mayores","Canarias Menores","Baleares Mayores","Baleares Menores","Ceuta","Melilla"],ZONE_KEY_MAP={Provincial:"provincial",Regional:"regional",Nacional:"nacional",Portugal:"portugal","Madeira Mayores":"madeira_mayores","Madeira Menores":"madeira_menores","Azores Mayores":"azores_mayores","Azores Menores":"azores_menores",Andorra:"andorra",Gibraltar:"gibraltar","Canarias Mayores":"canarias_mayores","Canarias Menores":"canarias_menores","Baleares Mayores":"baleares_mayores","Baleares Menores":"baleares_menores",Ceuta:"ceuta",Melilla:"melilla"},SHIPPING_MODES=["salida","recogida","interciudad"],SHIPPING_MODE_LABELS={salida:"Salida",recogida:"Recogida",interciudad:"Interciudad"},SHIPPING_MODE_SUFFIX={salida:"sal",recogida:"rec",interciudad:"int"},BUSINESS_ISLAND_ZONES=new Set(["Canarias Mayores","Canarias Menores","Baleares Mayores","Baleares Menores"]),MARITIME_SPECIAL_ZONES=new Set(["Azores Mayores","Azores Menores","Madeira Mayores","Madeira Menores"]),OPEN_RANGE_THRESHOLD=999,EPSILON=1e-9,CENT_FACTOR=100,roundUp$1=t=>!Number.isFinite(t)||t<=0?0:Math.ceil(t*CENT_FACTOR-EPSILON)/CENT_FACTOR,INTERMEDIATE_FACTOR=1e6,roundIntermediate=t=>!Number.isFinite(t)||t<=0?0:Math.round(t*INTERMEDIATE_FACTOR)/INTERMEDIATE_FACTOR,getEnergyRateForService=t=>t==="Economy Parcel"||t==="Marítimo"?0:.0705,normalizeServiceName=t=>t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim().toLowerCase(),isMaritimeService=t=>normalizeServiceName(t)==="maritimo",isBusinessParcelService=t=>normalizeServiceName(t)==="business parcel",isParcelShopService=t=>normalizeServiceName(t)==="parcel shop",COST_FIELD_MAP={Provincial:{salida:"provincial_sal",recogida:"provincial_rec",interciudad:"provincial_int"},Regional:{salida:"regional_sal",recogida:"regional_rec",interciudad:"regional_int"},Nacional:{salida:"nacional_sal",recogida:"nacional_rec",interciudad:"nacional_int"},Portugal:{salida:"portugal_sal",recogida:"portugal_rec",interciudad:"portugal_int"},"Madeira Mayores":{salida:"madeira_mayores_sal",recogida:"madeira_mayores_rec",interciudad:"madeira_mayores_int"},"Madeira Menores":{salida:"madeira_menores_sal",recogida:"madeira_menores_rec",interciudad:"madeira_menores_int"},"Azores Mayores":{salida:"azores_mayores_sal",recogida:"azores_mayores_rec",interciudad:"azores_mayores_int"},"Azores Menores":{salida:"azores_menores_sal",recogida:"azores_menores_rec",interciudad:"azores_menores_int"},Andorra:{salida:"andorra_sal",recogida:"andorra_rec",interciudad:"andorra_int"},Gibraltar:{salida:"gibraltar_sal",recogida:"gibraltar_rec",interciudad:"gibraltar_int"},"Canarias Mayores":{salida:"canarias_mayores_sal",recogida:"canarias_mayores_rec",interciudad:"canarias_mayores_int"},"Canarias Menores":{salida:"canarias_menores_sal",recogida:"canarias_menores_rec",interciudad:"canarias_menores_int"},"Baleares Mayores":{salida:"baleares_mayores_sal",recogida:"baleares_mayores_rec",interciudad:"baleares_mayores_int"},"Baleares Menores":{salida:"baleares_menores_sal",recogida:"baleares_menores_rec",interciudad:"baleares_menores_int"},Ceuta:{salida:"ceuta_sal",recogida:"ceuta_rec",interciudad:"ceuta_int"},Melilla:{salida:"melilla_sal",recogida:"melilla_rec",interciudad:"melilla_int"}},ARR_FIELD_MAP$1={Provincial:"provincial_arr",Regional:"regional_arr",Nacional:"nacional_arr",Portugal:"portugal_arr","Madeira Mayores":"madeira_mayores_arr","Madeira Menores":"madeira_menores_arr","Azores Mayores":"azores_mayores_arr","Azores Menores":"azores_menores_arr",Andorra:"andorra_arr",Gibraltar:"gibraltar_arr","Canarias Mayores":"canarias_mayores_arr","Canarias Menores":"canarias_menores_arr","Baleares Mayores":"baleares_mayores_arr","Baleares Menores":"baleares_menores_arr",Ceuta:"ceuta_arr",Melilla:"melilla_arr"},SERVICE_INCREMENT_RULES$1={"Urg8:30H Courier":{base:9,overrides:{"Canarias Mayores":10,"Canarias Menores":10}},"Urg10H Courier":{base:9,overrides:{"Canarias Mayores":10,"Canarias Menores":10,"Baleares Mayores":10,"Baleares Menores":10}},"Urg14H Courier":{base:9,overrides:{"Canarias Mayores":10,"Canarias Menores":10,"Baleares Mayores":10,"Baleares Menores":10}},"Urg19H Courier":{base:6,overrides:{"Canarias Mayores":10,"Canarias Menores":10,"Baleares Mayores":10,"Baleares Menores":10}},"Economy Parcel":{base:2,overrides:{"Canarias Mayores":4,"Canarias Menores":4,"Baleares Mayores":4,"Baleares Menores":4}},Marítimo:{base:4,overrides:{}},"Business Parcel":{base:0,overrides:{"Canarias Mayores":4,"Canarias Menores":4}},"EuroBusiness Parcel":{base:0,overrides:{}},"Parcel Shop":{base:0,overrides:{}}},SERVICE_INCREMENT_2025_RULES$1={"Urg8:30H Courier":{Provincial:5,Regional:5,Nacional:5,Portugal:5,"Baleares Mayores":5,"Baleares Menores":5},"Urg10H Courier":{Provincial:5,Regional:5,Nacional:5,Portugal:5,"Baleares Mayores":5,"Baleares Menores":5},"Urg14H Courier":{Provincial:5,Regional:5,Nacional:5,Portugal:5,"Baleares Mayores":5,"Baleares Menores":5},"Urg19H Courier":{Provincial:3,Regional:3,Nacional:3,Portugal:3,Andorra:3,Gibraltar:3}},UNIVERSAL_INCREMENT_2025_OVERRIDES={"Canarias Mayores":3,"Canarias Menores":3,"Baleares Mayores":3,"Baleares Menores":3},getServiceIncrementConfig$1=t=>{const r=SERVICE_INCREMENT_RULES$1[t];return r?{base:r.base,overrides:r.overrides??{}}:{base:0,overrides:{}}},getZoneIncrement2024=(t,r)=>{const e=getServiceIncrementConfig$1(t);return e.overrides[r]??e.base},getZoneIncrement2025$1=(t,r)=>{const e=SERVICE_INCREMENT_2025_RULES$1[t],s=(e==null?void 0:e[r])??0;if(t==="EuroBusiness Parcel")return s;const a=UNIVERSAL_INCREMENT_2025_OVERRIDES[r]??0;return Math.max(s,a)},BASE_COST_BREAKDOWN={initialCost:0,linearDiscount:0,climateProtect:0,canonRed:0,canonDigital:0,noVol:0,amplCobertura:0,energia:0,suplementos:0,irregular:0,mileageCost:0,saturdayCost:0,subtotal:0,incr2024:0,incr2025:0,incr2026:0,incr2024Percent:0,incr2025Percent:0,incr2026Percent:0,spc:0,totalCost:0};function createEmptyCostBreakdown(t="idle"){return{...BASE_COST_BREAKDOWN,status:t}}function calculateVolumetricWeight(t,r,e,s){return t*r*e/1e6*s}function getFinalWeight(t,r){const e=r!==void 0?Math.max(t,r):t;return e<=0?0:Math.ceil(e)}function getConversionFactorForService(t,r){return isMaritimeService(t)||isBusinessParcelService(t)&&r&&BUSINESS_ISLAND_ZONES.has(r)?333:167}function calculateCostBreakdown(t,r=0,e=0,s=0,a=0,i=0,o=0,c=0,x=0,u=0,h={}){const{planDiscountAmount:_=0,energyRate:v=.0705,baseOverride:b=null,serviceName:E,isPlusOneRange:d=!1,arrValue:g=null,useIntermediateRounding:y=!0}=h,R=E?isParcelShopService(E):!1,P=t>0?t:0,F=R?0:c,S=_>0,I=F>0&&!S,w=b!==null&&Number.isFinite(b);let j=P,C=P,V=0;if(w)j=Math.max(0,b),C=j,V=0,y&&(j=roundIntermediate(j),C=roundIntermediate(C));else if(S){const Y=y?roundIntermediate(_):roundUp$1(_);V=Math.min(P,Y),C=Math.max(0,P-V),j=C,y&&(C=roundIntermediate(C),j=roundIntermediate(j))}else if(I){const Y=P,G=y?roundIntermediate(Y*(F/100)):roundUp$1(Y*(F/100));V=Math.min(P,G),j=P,C=P}else j=P,C=P,V=0;let O=0,H=0,z=0,pe=0,ee=0,he=0,re=0,me=0,te=0;R||(O=y?roundIntermediate(j*.015):roundUp$1(j*.015),ee=y?roundIntermediate(j*.0195):roundUp$1(j*.0195),v>0&&(he=y?roundIntermediate(j*v):roundUp$1(j*v)),r>0&&(re=y?roundIntermediate(j*(r/100)):roundUp$1(j*(r/100))),e>0&&(me=y?roundIntermediate(j*(e/100)):roundUp$1(j*(e/100))),s>0&&(te=y?roundIntermediate(j*(s/100)):roundUp$1(j*(s/100))),d||(H=roundUp$1(.27),z=roundUp$1(.06),pe=roundUp$1(.04)));const ce=i>0?y?roundIntermediate(i):roundUp$1(i):0,ye=o>0?y?roundIntermediate(o):roundUp$1(o):0,L=u>0?y?roundIntermediate(u):roundUp$1(u):0,N=x>0?y?roundIntermediate(x):roundUp$1(x):0,T=!d&&a>0?y?roundIntermediate(a):roundUp$1(a):0;let A;I&&!S&&!w?A=C+O+H+z+pe+ee+he+ce+ye+L+N-V:A=C+O+H+z+pe+ee+he+ce+ye+L+N;const D=y?roundIntermediate(A):roundUp$1(A),B=D+re+me+te+T,U=roundUp$1(B);return{initialCost:P,linearDiscount:V,climateProtect:O,canonRed:H,canonDigital:z,noVol:pe,amplCobertura:ee,energia:he,suplementos:ce,irregular:ye,mileageCost:L,saturdayCost:N,subtotal:D,incr2024:re,incr2025:me,incr2026:te,incr2024Percent:r,incr2025Percent:e,incr2026Percent:s,spc:T,totalCost:U,status:"calculated"}}const INTERNATIONAL_EUROPE_LIMITS={dimensionLimits:[60,80,200],maxPerimeter:300,maxWeight:40,maxWeightGB:30};function assignDimensionsToLimits(t){const r=[...t].sort((a,i)=>a-i),e=[...INTERNATIONAL_EUROPE_LIMITS.dimensionLimits].sort((a,i)=>a-i),s=[!1,!1,!1];for(let a=0;a<r.length;a++){const i=r[a];let o=!1;for(let c=0;c<e.length;c++)if(!s[c]&&i<=e[c]){s[c]=!0,o=!0;break}if(!o){const c=e.filter((u,h)=>!s[h]),x=c.length>0?Math.max(...c):e[e.length-1];return{valid:!1,failedIndex:a,failedValue:i,availableLimit:x}}}return{valid:!0,failedIndex:null,failedValue:null,availableLimit:null}}function validateInternationalEuropePackage(t,r,e,s,a){const i=[],o=INTERNATIONAL_EUROPE_LIMITS,c=[t,r,e].filter(h=>h>0);if(c.length===3){const h=assignDimensionsToLimits(c);!h.valid&&h.failedValue!==null&&i.push(`Dimension ${h.failedValue}cm excede limite disponible ${h.availableLimit}cm`);const _=[...c].sort((E,d)=>E-d),v=_[2],b=2*_[0]+2*_[1]+v;b>o.maxPerimeter&&i.push(`Perimetro ${b}cm > max ${o.maxPerimeter}cm`)}const x=a.toLowerCase().includes("reino unido")||a.toLowerCase().includes("gb")||a.toLowerCase().includes("uk")||a.toLowerCase().includes("gran bretaña"),u=x?o.maxWeightGB:o.maxWeight;return s>u&&i.push(`Peso ${s}kg > max ${u}kg${x?" (GB)":""}`),{valid:i.length===0,errors:i}}const INTL_EUROPE_MODE_SURCHARGE={salida:0,recogida:5,interciudad:3};function calculateInternationalEuropeCostBreakdown(t,r=0,e=0,s=0,a="salida",i=1){const o=Math.max(1,Math.round(i)),c=INTL_EUROPE_MODE_SURCHARGE[a]??0,x=roundUp$1(c*o),h=(t>0?t:0)+x,_=roundUp$1(h*.015),v=r>0?roundUp$1(r*o):0,b=e>0?roundUp$1(e*o):0,E=s>0?roundUp$1(s*o):0,d=roundUp$1(h+_+b+E),g=roundUp$1(d+v);return{initialCost:h,linearDiscount:0,climateProtect:_,canonRed:0,canonDigital:0,noVol:0,amplCobertura:0,energia:0,suplementos:b,irregular:E,mileageCost:0,saturdayCost:0,subtotal:d,incr2024:0,incr2025:0,incr2026:0,incr2024Percent:0,incr2025Percent:0,incr2026Percent:0,spc:v,totalCost:g,status:"calculated"}}const buildFieldCandidates=t=>{const r=new Set([t]);return t.includes("national")&&r.add(t.replace("national","nacional")),t.includes("nacional")&&r.add(t.replace("nacional","national")),t.includes("price")&&r.add(t.replace("price","precio")),t.endsWith("_sal")&&r.add(t.replace("_sal","_salida")),t.endsWith("_rec")&&r.add(t.replace("_rec","_recogida")),t.endsWith("_int")&&r.add(t.replace("_int","_interciudad")),Array.from(r)},getTariffNumericValue$1=(t,r)=>{const e=Array.isArray(r)?r.flatMap(buildFieldCandidates):buildFieldCandidates(r),s=Array.from(new Set(e)),a=t;for(const i of s){const o=a[i];if(o==null)continue;if(typeof o=="number"){if(Number.isFinite(o))return o;continue}const c=Number(o);if(Number.isFinite(c))return c}return null},isPlusOneRange=t=>t.weight_to===null||t.weight_to===void 0||t.weight_to<=t.weight_from||t.weight_from>=15&&t.weight_to>=OPEN_RANGE_THRESHOLD,extractPlusOneCost=(t,r,e,s)=>{var c;if(!t.length)return null;const i=[...[...t].sort((x,u)=>x.weight_from-u.weight_from)].reverse().find(isPlusOneRange);if(!i)return null;const o=(c=COST_FIELD_MAP[r])==null?void 0:c[e];return o?getTariffNumericValue$1(i,o):null},calculatePercentualSupplements=(t,r=.0705,e=!1)=>{if(e||t<=0)return{climateProtect:0,amplCobertura:0,energia:0,total:0};const s=roundUp$1(t),a=roundUp$1(s*.015),i=roundUp$1(s*.0195),o=r>0?roundUp$1(s*r):0,c=roundUp$1(a+i+o);return{climateProtect:a,amplCobertura:i,energia:o,total:c}},getAdditionalStep=(t,r)=>isMaritimeService(t)&&MARITIME_SPECIAL_ZONES.has(r)?10:1,resolveTariffCost=(t,r,e,s,a)=>{if(!t.length)return null;const i=Math.max(e,0),o=Math.ceil(i);if(o<=0)return 0;const c=[...t].sort((S,I)=>S.weight_from-I.weight_from),u=c.filter(S=>!isPlusOneRange(S)).map(S=>({from:S.weight_from,to:S.weight_to??null,cost:getTariffNumericValue$1(S,r)})).filter(S=>S.cost!==null);if(!u.length)return null;const h=[...c].reverse().find(isPlusOneRange)??null,_=h?getTariffNumericValue$1(h,r):null,v=getAdditionalStep(s,a),b=u[0];let d=u.find(S=>{const I=S.to??S.from;return S.from===0?o>=S.from&&o<=I:o>S.from&&o<=I});d||(o<b.from?d=b:d=[...u].reverse().find(S=>{const I=S.to??S.from;return S.from===0?o>=S.from&&o<=I:o>S.from&&o<=I})??b);const g=d??b,y=g.cost??0,R=g.to??g.from;if(o<=R)return y;if(_===null)return null;const P=Math.max(0,o-R);if(P<=0)return y;const F=Math.ceil(P/v);return y+F*_};function computeZoneCostForPackage(t,r,e,s,a){var h;if(isParcelShopService(r)){const _=t.weight>30,v=t.dimensions?t.dimensions.height+t.dimensions.width+t.dimensions.length>150:!1;if(_||v)return{available:!1,cost:0,reason:"restriction"}}const i=(h=COST_FIELD_MAP[e])==null?void 0:h[s];if(!i)return{available:!1,cost:0,reason:"missing_tariff"};const o=getConversionFactorForService(r,e),c=t.dimensions?calculateVolumetricWeight(t.dimensions.height,t.dimensions.width,t.dimensions.length,o):void 0,x=getFinalWeight(t.weight,c),u=resolveTariffCost(a,i,x,r,e);return u===null?{available:!1,cost:0,reason:"missing_tariff",finalWeight:x}:{available:!0,cost:u,finalWeight:x}}function formatCurrency(t){return new Intl.NumberFormat("es-ES",{style:"currency",currency:"EUR",minimumFractionDigits:2,maximumFractionDigits:2}).format(t)}function formatPercentage(t){return`${t.toFixed(2)}%`}function formatWeight(t){return`${t.toFixed(2)} kg`}function formatDimensions(t,r,e){return`${t} × ${r} × ${e} cm`}function formatVolume(t,r,e){return`${(t*r*e/1e6).toFixed(4)} m³`}const getZoneKey=t=>ZONE_KEY_MAP[t],getZoneCostFromTariff=(t,r,e="salida")=>{var a;const s=(a=COST_FIELD_MAP[r])==null?void 0:a[e];return s?getTariffNumericValue$1(t,s):null},getZoneArrFromTariff=(t,r)=>{const e=ARR_FIELD_MAP$1[r];return e?getTariffNumericValue$1(t,e):null},resolvePlanWeightForTariffRow=(t,r,e)=>{const s=getLastFiniteTariff(t);if(isPlusOneRange(r)){const o=s?s.weight_to??s.weight_from:r.weight_from,c=getAdditionalStep(r.service_name,e);return o+c}if(r.weight_to!==null&&r.weight_to!==void 0)return r.weight_to;const a=s?s.weight_to??s.weight_from:r.weight_from,i=getAdditionalStep(r.service_name,e);return a+i},getPlanPercentageForWeight=(t,r,e)=>{if(t.discount_type==="custom"){const s=getCustomPlanDefinition(t.id);return!s||s.discountPlan.service_name!==r?0:getCustomPlanPercentage(t.id,r,e)}return t.discount_type==="percentage"?t.discount_value??0:0},getLastFiniteTariff=t=>{const r=t.filter(e=>e.weight_to!==null&&e.weight_to!==void 0).sort((e,s)=>(e.weight_to??0)-(s.weight_to??0));return r.length?r[r.length-1]:null},resolvePlanCostDetails=(t,r,e,s)=>{if(!t.length)return null;const a=[...t].sort((v,b)=>v.weight_from-b.weight_from),i=a.filter(v=>!isPlusOneRange(v));if(!i.length)return null;const o=Math.ceil(Math.max(s,0)),c=[...a].reverse().find(isPlusOneRange)??null,x=getAdditionalStep(r,e);let u=i.find(v=>{const b=v.weight_to??v.weight_from;return v.weight_from===0?o>=v.weight_from&&o<=b:o>v.weight_from&&o<=b});if(u||(o<i[0].weight_from?u=i[0]:u=[...i].reverse().find(v=>v.weight_from<=o)??i[i.length-1]),!u)return null;const h=u.weight_to??u.weight_from,_=o>h&&c?Math.ceil(Math.max(0,o-h)/Math.max(1,x)):0;return{baseTariff:u,baseThreshold:h,additionalTariff:c,additionalUnits:_,step:Math.max(1,x)}},ALLOWED_ZONES_FOR_PLAN_DISCOUNT=new Set(["Provincial","Regional","Nacional"]),calculatePlanDiscountForWeight=(t,r,e,s,a,i)=>{if(!s)return 0;if(s.discount_type==="fixed")return s.discount_value>0?roundUp$1(s.discount_value):0;if(i==="interciudad")return 0;const o=r==="EuroBusiness Parcel",c=e==="Portugal";if(c&&!o||!c&&!ALLOWED_ZONES_FOR_PLAN_DISCOUNT.has(e))return 0;const x=ARR_FIELD_MAP$1[e];if(!x)return 0;const u=resolvePlanCostDetails(t,r,e,a);if(!u)return 0;const h=(E,d,g=1)=>!E||d<=0||g<=0?0:roundUp$1(E*(d/100)*g),_=E=>getPlanPercentageForWeight(s,r,E);let v=0;const b=getTariffNumericValue$1(u.baseTariff,x);if(Number.isFinite(b)){const E=_(u.baseThreshold);v+=h(b,E)}if(u.additionalUnits>0&&u.additionalTariff){const E=getTariffNumericValue$1(u.additionalTariff,x);if(Number.isFinite(E)){const d=_(u.baseThreshold+u.step);v+=h(E,d,u.additionalUnits)}}return v};function buildVirtualTariffTable(t,r){const e=[];if(!Array.isArray(t)||t.length===0)return e;const{marginPercentage:s,planGroup:a="",discountPlans:i=[],linearDiscount:o=0,spc:c=0,variableSurcharge:x=0,irregularSurcharge:u=0,increment2026:h=0,selectedService:_="",provincialCostOverride:v=null}=r,b=a?normalizePlanGroupKey(a):"",E=Number.isFinite(s)?s:0,d=E<100?1-E/100:0,g=new Map;t.forEach(y=>{const R=g.get(y.service_name);R?R.push(y):g.set(y.service_name,[y])});for(const y of t)for(const R of DESTINATION_ZONES)for(const P of SHIPPING_MODES){const S=getZoneCostFromTariff(y,R,P);if(S===null)continue;const I=b?findPlanForServiceGroup(i,b,y.service_name):void 0,w=!!I,j=_===y.service_name,C=!w&&j&&v!==null,V=w||C?0:o;let O=0,H=null;if(I){const T=g.get(y.service_name)??[y],A=resolvePlanWeightForTariffRow(T,y,R);if(isPlusOneRange(y)){const D=getLastFiniteTariff(T),B=D?D.weight_to??D.weight_from:y.weight_from,U=calculatePlanDiscountForWeight(T,y.service_name,R,I,A),Y=calculatePlanDiscountForWeight(T,y.service_name,R,I,B);O=Math.max(0,U-Y)}else O=calculatePlanDiscountForWeight(T,y.service_name,R,I,A);H=A}const z=C&&R==="Provincial"?v:null,pe=isPlusOneRange(y),ee=getZoneArrFromTariff(y,R),he=getZoneIncrement2024(y.service_name,R),re=getZoneIncrement2025$1(y.service_name,R),me=calculateCostBreakdown(S,he,re,h,c,x,u,V,0,0,{planDiscountAmount:O,energyRate:getEnergyRateForService(y.service_name),baseOverride:z,isPlusOneRange:pe,arrValue:ee,useIntermediateRounding:!0,serviceName:y.service_name}),te=me.totalCost,ce=d>0?te/d:te,ye=roundUp$1(ce),L=`${getZoneKey(R)}_${SHIPPING_MODE_SUFFIX[P]}`,N=ee!=null&&ee>0?"ARR":"COST";pe&&R==="Provincial"&&P==="salida"&&(y.service_name==="Urg10H Courier"||y.service_name==="Urg19H Courier")&&console.log(`[SOP-DIAG] ${y.service_name} Provincial plusOne:`,{baseCost:S,incr2024Pct:he,incr2025Pct:re,incr2024Amount:me.incr2024,incr2025Amount:me.incr2025,totalCost:me.totalCost,pvp:ye}),sopLog$2("virtual-row",{service:y.service_name,zone:R,mode:P,weight_from:y.weight_from,weight_to:y.weight_to,isPlusOneRange:pe,baseCost:S,arrValue:ee,discountCalculatedOn:N,incr2024Pct:he,incr2025Pct:re,planWeight:H,planApplied:(I==null?void 0:I.plan_name)??null,planDiscountAmount:O,linearDiscountApplied:V,baseOverride:z,supplements:{climateProtect:me.climateProtect,canonRed:me.canonRed,canonDigital:me.canonDigital,noVol:me.noVol,amplCobertura:me.amplCobertura,energia:me.energia,suplementos:me.suplementos,irregular:me.irregular,spc:c,incr2024:me.incr2024,incr2025:me.incr2025,incr2026:me.incr2026},totalCost:me.totalCost,marginPercentage:E,pvp:ye,note:pe?"plusOne: discounts on ARR (fallback COST), percentual supplements on discounted cost, no fixed supplements":"full shipment: discounts on ARR (fallback COST), all supplements on original cost, fixed supplements applied"}),e.push({service_name:y.service_name,zone:L,weight_from:y.weight_from,weight_to:y.weight_to,pvp:ye})}return e}const WEIGHT_RANGES=[{from:"0",to:"1",label:"0-1kg"},{from:"1",to:"3",label:"1-3kg"},{from:"3",to:"5",label:"3-5kg"},{from:"5",to:"10",label:"5-10kg"},{from:"10",to:"15",label:"10-15kg"},{from:"15",to:"999",label:"15-999kg"}],DESTINATIONS=[{key:"provincial",label:"Prov.",columns:[{field:"provincial_sal",label:"Sal"},{field:"provincial_rec",label:"Rec"},{field:"provincial_int",label:"Int"},{field:"provincial_arr",label:"Arr"}]},{key:"regional",label:"Reg.",columns:[{field:"regional_sal",label:"Sal"},{field:"regional_rec",label:"Rec"},{field:"regional_int",label:"Int"},{field:"regional_arr",label:"Arr"}]},{key:"nacional",label:"Nac.",columns:[{field:"nacional_sal",label:"Sal"},{field:"nacional_rec",label:"Rec"},{field:"nacional_int",label:"Int"},{field:"nacional_arr",label:"Arr"}]},{key:"portugal",label:"Port.",columns:[{field:"portugal_sal",label:"Sal"},{field:"portugal_rec",label:"Rec"},{field:"portugal_int",label:"Int"},{field:"portugal_arr",label:"Arr"}]},{key:"canarias_mayores",label:"Can.My.",columns:[{field:"canarias_mayores_sal",label:"Sal"},{field:"canarias_mayores_rec",label:"Rec"},{field:"canarias_mayores_int",label:"Int"},{field:"canarias_mayores_arr",label:"Arr"}]},{key:"canarias_menores",label:"Can.Mn.",columns:[{field:"canarias_menores_sal",label:"Sal"},{field:"canarias_menores_rec",label:"Rec"},{field:"canarias_menores_int",label:"Int"},{field:"canarias_menores_arr",label:"Arr"}]},{key:"baleares_mayores",label:"Bal.My.",columns:[{field:"baleares_mayores_sal",label:"Sal"},{field:"baleares_mayores_rec",label:"Rec"},{field:"baleares_mayores_int",label:"Int"},{field:"baleares_mayores_arr",label:"Arr"}]},{key:"baleares_menores",label:"Bal.Mn.",columns:[{field:"baleares_menores_sal",label:"Sal"},{field:"baleares_menores_rec",label:"Rec"},{field:"baleares_menores_int",label:"Int"},{field:"baleares_menores_arr",label:"Arr"}]},{key:"ceuta",label:"Ceuta",columns:[{field:"ceuta_sal",label:"Sal"},{field:"ceuta_rec",label:"Rec"},{field:"ceuta_int",label:"Int"},{field:"ceuta_arr",label:"Arr"}]},{key:"melilla",label:"Melilla",columns:[{field:"melilla_sal",label:"Sal"},{field:"melilla_rec",label:"Rec"},{field:"melilla_int",label:"Int"},{field:"melilla_arr",label:"Arr"}]}],CustomTariffsEditor=({onClose:t})=>{const{userData:r}=useAuth(),{customTariffs:e,refetch:s}=useCustomTariffs(r==null?void 0:r.id),{activeStates:a,refetch:i}=useCustomTariffsActive(r==null?void 0:r.id),{tariffs:o}=useTariffs(),[c,x]=reactExports.useState(STATIC_SERVICES[0]),[u,h]=reactExports.useState({}),[_,v]=reactExports.useState(null),[b,E]=reactExports.useState(""),[d,g]=reactExports.useState(!1),[y,R]=reactExports.useState(!1),[P,F]=reactExports.useState(null),[S,I]=reactExports.useState(!1);reactExports.useMemo(()=>a.some(A=>A.service_name===c&&A.is_active),[a,c]);const w=reactExports.useCallback(()=>{const A={};WEIGHT_RANGES.forEach(D=>{DESTINATIONS.forEach(B=>{B.columns.forEach(U=>{const Y=`${D.from}_${D.to}_${U.field}`,G=e.find(fe=>fe.service_name===c&&fe.weight_from===D.from&&fe.weight_to===D.to);if(G&&G[U.field]!==void 0)A[Y]=G[U.field];else{const fe=o.find(xe=>xe.service_name===c&&xe.weight_from.toString()===D.from&&(xe.weight_to===null?D.to==="999":xe.weight_to.toString()===D.to));if(fe){const xe=fe[U.field];A[Y]=xe!=null?Number(xe):null}else A[Y]=null}})})}),h(A),g(!1)},[e,c,o]);reactExports.useEffect(()=>{w()},[w]);const j=A=>A==null?"":A.toFixed(2),C=A=>{const D=A.trim();if(!D)return null;const B=D.replace(",","."),U=parseFloat(B);return isNaN(U)||U<0?null:Math.round(U*100)/100},V=A=>u[A]??null,O=(A,D)=>{h(B=>({...B,[A]:D})),g(!0)},H=A=>{const[D,B,U]=A.split("_"),Y=u[A],G=o.find(Ce=>Ce.service_name===c&&Ce.weight_from.toString()===D&&(Ce.weight_to===null?B==="999":Ce.weight_to.toString()===B));if(!G)return!1;const fe=G[U],xe=fe!=null?Number(fe):null;return(Y!=null?Number(Y):null)!==xe},z=()=>{const A=[];return DESTINATIONS.forEach(D=>{WEIGHT_RANGES.forEach(B=>{D.columns.forEach(U=>{A.push(`${B.from}_${B.to}_${U.field}`)})})}),A},pe=reactExports.useMemo(z,[]),ee=(A,D)=>{const B=pe.indexOf(A);if(B===-1)return!1;const U=B+D;if(U<0||U>=pe.length)return!1;const Y=pe[U];return v(Y),E(j(V(Y))),setTimeout(()=>{const G=document.querySelector(`input[data-cell-key="${Y}"]`);G&&(G.focus(),G.select())},0),!0},he=()=>{if(!_)return;const A=C(b);O(_,A),v(null),E("")},re=()=>{v(null),E("")},me=A=>{v(A),E(j(V(A)))},te=()=>{he()},ce=(A,D)=>{A.key==="Enter"?(A.preventDefault(),he(),ee(D,1)):A.key==="Tab"?(A.preventDefault(),he(),ee(D,A.shiftKey?-1:1)):A.key==="Escape"&&(A.preventDefault(),re())},ye=async()=>{if(r){R(!0),F(null);try{const{data:A}=await supabase.from("custom_tariffs").select("*").eq("user_id",r.id).eq("service_name",c),D=new Map((A==null?void 0:A.map(xe=>[`${xe.weight_from}_${xe.weight_to}`,xe]))||[]),B=[],U=[];let Y=0,G=0;if(WEIGHT_RANGES.forEach(xe=>{const Se=o.find(Q=>Q.service_name===c&&Q.weight_from.toString()===xe.from&&(Q.weight_to===null?xe.to==="999":Q.weight_to.toString()===xe.to)),Ce=`${xe.from}_${xe.to}`,Me=D.get(Ce),be={user_id:r.id,service_name:c,weight_from:xe.from,weight_to:xe.to};let ae=!1,J=0,oe=!0;DESTINATIONS.forEach(Q=>{Q.columns.forEach(ge=>{const Te=`${xe.from}_${xe.to}_${ge.field}`,Le=u[Te],Re=Se?Se[ge.field]:null,Ee=Re!=null?Number(Re):null,ze=Le!=null?Number(Le):null,Xe=Me&&Me[ge.field]!==void 0?Me[ge.field]:null;ze!==Ee&&(oe=!1),ze!==Ee?(be[ge.field]=ze,ae=!0,J++):Xe!==null&&Xe!==Ee?(be[ge.field]=Xe,ae=!0):be[ge.field]=Ee})}),oe&&Me?(U.push(Me.id),G++):ae&&(Me&&(be.id=Me.id),B.push(be),Y+=J)}),B.length===0&&U.length===0){F("No hay cambios para guardar"),setTimeout(()=>F(null),3e3),R(!1);return}if(U.length>0){const{error:xe}=await supabase.from("custom_tariffs").delete().in("id",U);if(xe)throw console.error("Error deleting restored tariff rows:",xe),xe}for(const xe of B)if(xe.id){const{id:Se,...Ce}=xe,{error:Me}=await supabase.from("custom_tariffs").update(Ce).eq("id",Se);if(Me)throw console.error("Error updating tariff row:",Me),Me}else{const{error:Se}=await supabase.from("custom_tariffs").insert([xe]);if(Se)throw console.error("Error inserting tariff row:",Se),Se}await s(),g(!1);const fe=[];Y>0&&fe.push(`${Y} campo(s) modificado(s) en ${B.length} rango(s)`),G>0&&fe.push(`${G} rango(s) restaurado(s) a oficial`),F(fe.join(" • ")),setTimeout(()=>F(null),3e3)}catch(A){console.error("Error saving custom tariffs:",A);let D="Error al guardar las tarifas";A!=null&&A.message&&(A.message.includes("row-level security")?D="Error de permisos. Por favor, cierra sesión y vuelve a iniciar.":A.message.includes("duplicate key")?D="Ya existe una tarifa personalizada para este rango de peso.":D=`Error: ${A.message}`),F(D),setTimeout(()=>F(null),5e3)}finally{R(!1)}}},L=async()=>{if(!window.confirm("¿Deseas restaurar los valores oficiales para este servicio? Esto sobrescribirá los valores actuales."))return;const A={};WEIGHT_RANGES.forEach(D=>{DESTINATIONS.forEach(B=>{B.columns.forEach(U=>{const Y=`${D.from}_${D.to}_${U.field}`,G=o.find(fe=>fe.service_name===c&&fe.weight_from.toString()===D.from&&(fe.weight_to===null?D.to==="999":fe.weight_to.toString()===D.to));if(G){const fe=G[U.field];A[Y]=fe!=null?Number(fe):null}else A[Y]=null})})}),h(A),g(!0)},N=async()=>{if(window.confirm("¿Deseas limpiar todas las tarifas personalizadas de este servicio? Esta acción no se puede deshacer.")&&r)try{await supabase.from("custom_tariffs").delete().eq("user_id",r.id).eq("service_name",c),await s(),w(),F("Tarifas eliminadas correctamente"),setTimeout(()=>F(null),3e3)}catch(A){console.error("Error clearing custom tariffs:",A),F("Error al eliminar las tarifas"),setTimeout(()=>F(null),5e3)}},T=async()=>{if(window.confirm(`¡ATENCIÓN! Esta acción eliminará TODAS las tarifas personalizadas de TODOS los servicios.

Esta operación NO afecta a la tabla de costes oficial, solo a tus personalizaciones.

¿Estás seguro de que deseas continuar?`)&&r){I(!0),F(null);try{const{error:D}=await supabase.from("custom_tariffs").delete().eq("user_id",r.id);if(D)throw D;const{error:B}=await supabase.from("custom_tariffs_active").delete().eq("user_id",r.id);if(B)throw B;await s(),await i(),w(),F("Todas las tarifas personalizadas han sido eliminadas correctamente"),setTimeout(()=>F(null),4e3)}catch(D){console.error("Error clearing all custom tariffs:",D),F("Error al eliminar las tarifas personalizadas"),setTimeout(()=>F(null),5e3)}finally{I(!1)}}};return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-[95vw] max-h-[95vh] overflow-hidden flex flex-col",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Tabla de Costes Personalizada"}),jsxRuntimeExports.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:jsxRuntimeExports.jsx(X,{className:"h-6 w-6 text-gray-500"})})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4",children:jsxRuntimeExports.jsxs("p",{className:"text-sm text-blue-900 text-center leading-relaxed",children:[". Costes de Salida (Sal), Recogida (Rec) e Interciudad (Int) son costes totales.",jsxRuntimeExports.jsx("br",{}),"Arrastres (Arr) solo se tendrá en cuenta para la aplicación de planes comerciales",jsxRuntimeExports.jsx("br",{}),'PUEDES MODIFICAR ESTA TABLA Y GUARDARLA. ESTARÁ DISPONIBLE COMO TARIFA "PERSONALIZADA".']})}),jsxRuntimeExports.jsx("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Servicio a editar"}),jsxRuntimeExports.jsx("select",{value:c,onChange:A=>{d&&!window.confirm("Tienes cambios sin guardar. ¿Deseas cambiar de servicio de todas formas?")||x(A.target.value)},className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",children:STATIC_SERVICES.map(A=>jsxRuntimeExports.jsx("option",{value:A,children:A},A))})]})}),P&&jsxRuntimeExports.jsx("div",{className:`rounded-lg p-3 text-sm font-medium ${P.includes("Error")?"bg-red-50 text-red-900 border border-red-200":"bg-green-50 text-green-900 border border-green-200"}`,children:P}),jsxRuntimeExports.jsx("div",{className:"overflow-x-auto border border-gray-200 rounded-lg",children:jsxRuntimeExports.jsxs("table",{className:"min-w-full text-xs",children:[jsxRuntimeExports.jsxs("thead",{children:[jsxRuntimeExports.jsxs("tr",{className:"bg-gray-100",children:[jsxRuntimeExports.jsx("th",{className:"sticky left-0 z-10 bg-gray-100 px-3 py-2 text-left font-semibold text-gray-700 border-r border-gray-300",children:"Peso"}),DESTINATIONS.map(A=>jsxRuntimeExports.jsx("th",{colSpan:A.columns.length,className:"px-2 py-2 text-center font-semibold text-gray-700 border-r border-gray-300",children:A.label},A.key))]}),jsxRuntimeExports.jsxs("tr",{className:"bg-gray-50",children:[jsxRuntimeExports.jsx("th",{className:"sticky left-0 z-10 bg-gray-50 px-3 py-2 border-r border-gray-300"}),DESTINATIONS.map(A=>jsxRuntimeExports.jsx(React.Fragment,{children:A.columns.map(D=>jsxRuntimeExports.jsx("th",{className:`px-1 py-1 text-center text-xs font-medium border-r border-gray-200 ${D.label==="Arr"?"text-red-700 bg-red-50":"text-gray-600"}`,children:D.label},D.field))},A.key))]})]}),jsxRuntimeExports.jsx("tbody",{className:"divide-y divide-gray-200",children:WEIGHT_RANGES.map(A=>jsxRuntimeExports.jsxs("tr",{className:"hover:bg-gray-50",children:[jsxRuntimeExports.jsx("td",{className:"sticky left-0 z-10 bg-white px-3 py-2 font-medium text-gray-700 border-r border-gray-300",children:A.label}),DESTINATIONS.map(D=>jsxRuntimeExports.jsx(React.Fragment,{children:D.columns.map(B=>{const U=`${A.from}_${A.to}_${B.field}`,Y=_===U,G=V(U),fe=B.label==="Arr",xe=H(U);return jsxRuntimeExports.jsx("td",{className:`px-1 py-1 border-r border-gray-200 ${fe?"bg-red-50":""}`,children:jsxRuntimeExports.jsx("input",{type:"text",inputMode:"decimal","data-cell-key":U,value:Y?b:j(G),onFocus:()=>me(U),onBlur:te,onChange:Se=>Y&&E(Se.target.value),onKeyDown:Se=>ce(Se,U),className:`w-full px-1 py-1 text-right text-xs border border-gray-300 rounded focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition-colors ${fe?"text-red-700 font-semibold":""} ${xe?"bg-amber-50 font-medium":"bg-white"}`,style:{minWidth:"60px"}})},B.field)})},D.key))]},`${A.from}_${A.to}`))})]})})]})}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between gap-3 flex-wrap border-t p-6 bg-gray-50",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsxs("button",{onClick:L,className:"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:[jsxRuntimeExports.jsx(RotateCcw,{className:"h-4 w-4"}),"Restaurar Oficial"]}),jsxRuntimeExports.jsxs("button",{onClick:N,className:"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-red-700 bg-red-50 rounded-lg hover:bg-red-100 transition-colors",children:[jsxRuntimeExports.jsx(Trash2,{className:"h-4 w-4"}),"Limpiar Servicio"]}),jsxRuntimeExports.jsxs("button",{onClick:T,disabled:S,className:"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-lg hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[jsxRuntimeExports.jsx(AlertTriangle,{className:"h-4 w-4"}),S?"Eliminando...":"LIMPIAR TOTAL"]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[d&&jsxRuntimeExports.jsx("span",{className:"text-sm text-orange-600 font-medium",children:"Cambios pendientes sin guardar"}),jsxRuntimeExports.jsxs("button",{onClick:ye,disabled:!d||y,className:"inline-flex items-center gap-2 px-6 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[jsxRuntimeExports.jsx(Save,{className:"h-4 w-4"}),y?"Guardando...":"GRABAR"]}),jsxRuntimeExports.jsx("button",{onClick:t,className:"inline-flex items-center gap-2 px-6 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"CERRAR"})]})]})]})})};/*! xlsx.js (C) 2013-present SheetJS -- http://sheetjs.com */var XLSX={};XLSX.version="0.18.5";var current_ansi=1252,VALID_ANSI=[874,932,936,949,950,1250,1251,1252,1253,1254,1255,1256,1257,1258,1e4],set_ansi=function(t){VALID_ANSI.indexOf(t)!=-1&&(current_ansi=t)};function reset_ansi(){set_ansi(1252)}var set_cp=function(t){set_ansi(t)};function reset_cp(){set_cp(1200),reset_ansi()}var _getchar=function(r){return String.fromCharCode(r)},_getansi=function(r){return String.fromCharCode(r)},$cptable,Base64_map="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function Base64_encode(t){for(var r="",e=0,s=0,a=0,i=0,o=0,c=0,x=0,u=0;u<t.length;)e=t.charCodeAt(u++),i=e>>2,s=t.charCodeAt(u++),o=(e&3)<<4|s>>4,a=t.charCodeAt(u++),c=(s&15)<<2|a>>6,x=a&63,isNaN(s)?c=x=64:isNaN(a)&&(x=64),r+=Base64_map.charAt(i)+Base64_map.charAt(o)+Base64_map.charAt(c)+Base64_map.charAt(x);return r}function Base64_decode(t){var r="",e=0,s=0,a=0,i=0,o=0,c=0,x=0;t=t.replace(/[^\w\+\/\=]/g,"");for(var u=0;u<t.length;)i=Base64_map.indexOf(t.charAt(u++)),o=Base64_map.indexOf(t.charAt(u++)),e=i<<2|o>>4,r+=String.fromCharCode(e),c=Base64_map.indexOf(t.charAt(u++)),s=(o&15)<<4|c>>2,c!==64&&(r+=String.fromCharCode(s)),x=Base64_map.indexOf(t.charAt(u++)),a=(c&3)<<6|x,x!==64&&(r+=String.fromCharCode(a));return r}var has_buf=function(){return typeof Buffer<"u"&&typeof process<"u"&&typeof process.versions<"u"&&!!process.versions.node}(),Buffer_from=function(){if(typeof Buffer<"u"){var t=!Buffer.from;if(!t)try{Buffer.from("foo","utf8")}catch{t=!0}return t?function(r,e){return e?new Buffer(r,e):new Buffer(r)}:Buffer.from.bind(Buffer)}return function(){}}();function new_raw_buf(t){return has_buf?Buffer.alloc?Buffer.alloc(t):new Buffer(t):typeof Uint8Array<"u"?new Uint8Array(t):new Array(t)}function new_unsafe_buf(t){return has_buf?Buffer.allocUnsafe?Buffer.allocUnsafe(t):new Buffer(t):typeof Uint8Array<"u"?new Uint8Array(t):new Array(t)}var s2a=function(r){return has_buf?Buffer_from(r,"binary"):r.split("").map(function(e){return e.charCodeAt(0)&255})};function s2ab(t){if(typeof ArrayBuffer>"u")return s2a(t);for(var r=new ArrayBuffer(t.length),e=new Uint8Array(r),s=0;s!=t.length;++s)e[s]=t.charCodeAt(s)&255;return r}function a2s(t){if(Array.isArray(t))return t.map(function(s){return String.fromCharCode(s)}).join("");for(var r=[],e=0;e<t.length;++e)r[e]=String.fromCharCode(t[e]);return r.join("")}function a2u(t){if(typeof Uint8Array>"u")throw new Error("Unsupported");return new Uint8Array(t)}var bconcat=has_buf?function(t){return Buffer.concat(t.map(function(r){return Buffer.isBuffer(r)?r:Buffer_from(r)}))}:function(t){if(typeof Uint8Array<"u"){var r=0,e=0;for(r=0;r<t.length;++r)e+=t[r].length;var s=new Uint8Array(e),a=0;for(r=0,e=0;r<t.length;e+=a,++r)if(a=t[r].length,t[r]instanceof Uint8Array)s.set(t[r],e);else{if(typeof t[r]=="string")throw"wtf";s.set(new Uint8Array(t[r]),e)}return s}return[].concat.apply([],t.map(function(i){return Array.isArray(i)?i:[].slice.call(i)}))};function utf8decode(t){for(var r=[],e=0,s=t.length+250,a=new_raw_buf(t.length+255),i=0;i<t.length;++i){var o=t.charCodeAt(i);if(o<128)a[e++]=o;else if(o<2048)a[e++]=192|o>>6&31,a[e++]=128|o&63;else if(o>=55296&&o<57344){o=(o&1023)+64;var c=t.charCodeAt(++i)&1023;a[e++]=240|o>>8&7,a[e++]=128|o>>2&63,a[e++]=128|c>>6&15|(o&3)<<4,a[e++]=128|c&63}else a[e++]=224|o>>12&15,a[e++]=128|o>>6&63,a[e++]=128|o&63;e>s&&(r.push(a.slice(0,e)),e=0,a=new_raw_buf(65535),s=65530)}return r.push(a.slice(0,e)),bconcat(r)}var chr0=/\u0000/g,chr1=/[\u0001-\u0006]/g;function _strrev(t){for(var r="",e=t.length-1;e>=0;)r+=t.charAt(e--);return r}function pad0(t,r){var e=""+t;return e.length>=r?e:fill("0",r-e.length)+e}function pad_(t,r){var e=""+t;return e.length>=r?e:fill(" ",r-e.length)+e}function rpad_(t,r){var e=""+t;return e.length>=r?e:e+fill(" ",r-e.length)}function pad0r1(t,r){var e=""+Math.round(t);return e.length>=r?e:fill("0",r-e.length)+e}function pad0r2(t,r){var e=""+t;return e.length>=r?e:fill("0",r-e.length)+e}var p2_32=Math.pow(2,32);function pad0r(t,r){if(t>p2_32||t<-p2_32)return pad0r1(t,r);var e=Math.round(t);return pad0r2(e,r)}function SSF_isgeneral(t,r){return r=r||0,t.length>=7+r&&(t.charCodeAt(r)|32)===103&&(t.charCodeAt(r+1)|32)===101&&(t.charCodeAt(r+2)|32)===110&&(t.charCodeAt(r+3)|32)===101&&(t.charCodeAt(r+4)|32)===114&&(t.charCodeAt(r+5)|32)===97&&(t.charCodeAt(r+6)|32)===108}var days=[["Sun","Sunday"],["Mon","Monday"],["Tue","Tuesday"],["Wed","Wednesday"],["Thu","Thursday"],["Fri","Friday"],["Sat","Saturday"]],months=[["J","Jan","January"],["F","Feb","February"],["M","Mar","March"],["A","Apr","April"],["M","May","May"],["J","Jun","June"],["J","Jul","July"],["A","Aug","August"],["S","Sep","September"],["O","Oct","October"],["N","Nov","November"],["D","Dec","December"]];function SSF_init_table(t){return t||(t={}),t[0]="General",t[1]="0",t[2]="0.00",t[3]="#,##0",t[4]="#,##0.00",t[9]="0%",t[10]="0.00%",t[11]="0.00E+00",t[12]="# ?/?",t[13]="# ??/??",t[14]="m/d/yy",t[15]="d-mmm-yy",t[16]="d-mmm",t[17]="mmm-yy",t[18]="h:mm AM/PM",t[19]="h:mm:ss AM/PM",t[20]="h:mm",t[21]="h:mm:ss",t[22]="m/d/yy h:mm",t[37]="#,##0 ;(#,##0)",t[38]="#,##0 ;[Red](#,##0)",t[39]="#,##0.00;(#,##0.00)",t[40]="#,##0.00;[Red](#,##0.00)",t[45]="mm:ss",t[46]="[h]:mm:ss",t[47]="mmss.0",t[48]="##0.0E+0",t[49]="@",t[56]='"上午/下午 "hh"時"mm"分"ss"秒 "',t}var table_fmt={0:"General",1:"0",2:"0.00",3:"#,##0",4:"#,##0.00",9:"0%",10:"0.00%",11:"0.00E+00",12:"# ?/?",13:"# ??/??",14:"m/d/yy",15:"d-mmm-yy",16:"d-mmm",17:"mmm-yy",18:"h:mm AM/PM",19:"h:mm:ss AM/PM",20:"h:mm",21:"h:mm:ss",22:"m/d/yy h:mm",37:"#,##0 ;(#,##0)",38:"#,##0 ;[Red](#,##0)",39:"#,##0.00;(#,##0.00)",40:"#,##0.00;[Red](#,##0.00)",45:"mm:ss",46:"[h]:mm:ss",47:"mmss.0",48:"##0.0E+0",49:"@",56:'"上午/下午 "hh"時"mm"分"ss"秒 "'},SSF_default_map={5:37,6:38,7:39,8:40,23:0,24:0,25:0,26:0,27:14,28:14,29:14,30:14,31:14,50:14,51:14,52:14,53:14,54:14,55:14,56:14,57:14,58:14,59:1,60:2,61:3,62:4,67:9,68:10,69:12,70:13,71:14,72:14,73:15,74:16,75:17,76:20,77:21,78:22,79:45,80:46,81:47,82:0},SSF_default_str={5:'"$"#,##0_);\\("$"#,##0\\)',63:'"$"#,##0_);\\("$"#,##0\\)',6:'"$"#,##0_);[Red]\\("$"#,##0\\)',64:'"$"#,##0_);[Red]\\("$"#,##0\\)',7:'"$"#,##0.00_);\\("$"#,##0.00\\)',65:'"$"#,##0.00_);\\("$"#,##0.00\\)',8:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',66:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',41:'_(* #,##0_);_(* \\(#,##0\\);_(* "-"_);_(@_)',42:'_("$"* #,##0_);_("$"* \\(#,##0\\);_("$"* "-"_);_(@_)',43:'_(* #,##0.00_);_(* \\(#,##0.00\\);_(* "-"??_);_(@_)',44:'_("$"* #,##0.00_);_("$"* \\(#,##0.00\\);_("$"* "-"??_);_(@_)'};function SSF_frac(t,r,e){for(var s=t<0?-1:1,a=t*s,i=0,o=1,c=0,x=1,u=0,h=0,_=Math.floor(a);u<r&&(_=Math.floor(a),c=_*o+i,h=_*u+x,!(a-_<5e-8));)a=1/(a-_),i=o,o=c,x=u,u=h;if(h>r&&(u>r?(h=x,c=i):(h=u,c=o)),!e)return[0,s*c,h];var v=Math.floor(s*c/h);return[v,s*c-v*h,h]}function SSF_parse_date_code(t,r,e){if(t>2958465||t<0)return null;var s=t|0,a=Math.floor(86400*(t-s)),i=0,o=[],c={D:s,T:a,u:86400*(t-s)-a,y:0,m:0,d:0,H:0,M:0,S:0,q:0};if(Math.abs(c.u)<1e-6&&(c.u=0),r&&r.date1904&&(s+=1462),c.u>.9999&&(c.u=0,++a==86400&&(c.T=a=0,++s,++c.D)),s===60)o=e?[1317,10,29]:[1900,2,29],i=3;else if(s===0)o=e?[1317,8,29]:[1900,1,0],i=6;else{s>60&&--s;var x=new Date(1900,0,1);x.setDate(x.getDate()+s-1),o=[x.getFullYear(),x.getMonth()+1,x.getDate()],i=x.getDay(),s<60&&(i=(i+6)%7),e&&(i=SSF_fix_hijri(x,o))}return c.y=o[0],c.m=o[1],c.d=o[2],c.S=a%60,a=Math.floor(a/60),c.M=a%60,a=Math.floor(a/60),c.H=a,c.q=i,c}var SSFbasedate=new Date(1899,11,31,0,0,0),SSFdnthresh=SSFbasedate.getTime(),SSFbase1904=new Date(1900,2,1,0,0,0);function datenum_local(t,r){var e=t.getTime();return r?e-=1461*24*60*60*1e3:t>=SSFbase1904&&(e+=24*60*60*1e3),(e-(SSFdnthresh+(t.getTimezoneOffset()-SSFbasedate.getTimezoneOffset())*6e4))/(24*60*60*1e3)}function SSF_strip_decimal(t){return t.indexOf(".")==-1?t:t.replace(/(?:\.0*|(\.\d*[1-9])0+)$/,"$1")}function SSF_normalize_exp(t){return t.indexOf("E")==-1?t:t.replace(/(?:\.0*|(\.\d*[1-9])0+)[Ee]/,"$1E").replace(/(E[+-])(\d)$/,"$10$2")}function SSF_small_exp(t){var r=t<0?12:11,e=SSF_strip_decimal(t.toFixed(12));return e.length<=r||(e=t.toPrecision(10),e.length<=r)?e:t.toExponential(5)}function SSF_large_exp(t){var r=SSF_strip_decimal(t.toFixed(11));return r.length>(t<0?12:11)||r==="0"||r==="-0"?t.toPrecision(6):r}function SSF_general_num(t){var r=Math.floor(Math.log(Math.abs(t))*Math.LOG10E),e;return r>=-4&&r<=-1?e=t.toPrecision(10+r):Math.abs(r)<=9?e=SSF_small_exp(t):r===10?e=t.toFixed(10).substr(0,12):e=SSF_large_exp(t),SSF_strip_decimal(SSF_normalize_exp(e.toUpperCase()))}function SSF_general(t,r){switch(typeof t){case"string":return t;case"boolean":return t?"TRUE":"FALSE";case"number":return(t|0)===t?t.toString(10):SSF_general_num(t);case"undefined":return"";case"object":if(t==null)return"";if(t instanceof Date)return SSF_format(14,datenum_local(t,r&&r.date1904),r)}throw new Error("unsupported value in General format: "+t)}function SSF_fix_hijri(t,r){r[0]-=581;var e=t.getDay();return t<60&&(e=(e+6)%7),e}function SSF_write_date(t,r,e,s){var a="",i=0,o=0,c=e.y,x,u=0;switch(t){case 98:c=e.y+543;case 121:switch(r.length){case 1:case 2:x=c%100,u=2;break;default:x=c%1e4,u=4;break}break;case 109:switch(r.length){case 1:case 2:x=e.m,u=r.length;break;case 3:return months[e.m-1][1];case 5:return months[e.m-1][0];default:return months[e.m-1][2]}break;case 100:switch(r.length){case 1:case 2:x=e.d,u=r.length;break;case 3:return days[e.q][0];default:return days[e.q][1]}break;case 104:switch(r.length){case 1:case 2:x=1+(e.H+11)%12,u=r.length;break;default:throw"bad hour format: "+r}break;case 72:switch(r.length){case 1:case 2:x=e.H,u=r.length;break;default:throw"bad hour format: "+r}break;case 77:switch(r.length){case 1:case 2:x=e.M,u=r.length;break;default:throw"bad minute format: "+r}break;case 115:if(r!="s"&&r!="ss"&&r!=".0"&&r!=".00"&&r!=".000")throw"bad second format: "+r;return e.u===0&&(r=="s"||r=="ss")?pad0(e.S,r.length):(s>=2?o=s===3?1e3:100:o=s===1?10:1,i=Math.round(o*(e.S+e.u)),i>=60*o&&(i=0),r==="s"?i===0?"0":""+i/o:(a=pad0(i,2+s),r==="ss"?a.substr(0,2):"."+a.substr(2,r.length-1)));case 90:switch(r){case"[h]":case"[hh]":x=e.D*24+e.H;break;case"[m]":case"[mm]":x=(e.D*24+e.H)*60+e.M;break;case"[s]":case"[ss]":x=((e.D*24+e.H)*60+e.M)*60+Math.round(e.S+e.u);break;default:throw"bad abstime format: "+r}u=r.length===3?1:2;break;case 101:x=c,u=1;break}var h=u>0?pad0(x,u):"";return h}function commaify(t){var r=3;if(t.length<=r)return t;for(var e=t.length%r,s=t.substr(0,e);e!=t.length;e+=r)s+=(s.length>0?",":"")+t.substr(e,r);return s}var pct1=/%/g;function write_num_pct(t,r,e){var s=r.replace(pct1,""),a=r.length-s.length;return write_num(t,s,e*Math.pow(10,2*a))+fill("%",a)}function write_num_cm(t,r,e){for(var s=r.length-1;r.charCodeAt(s-1)===44;)--s;return write_num(t,r.substr(0,s),e/Math.pow(10,3*(r.length-s)))}function write_num_exp(t,r){var e,s=t.indexOf("E")-t.indexOf(".")-1;if(t.match(/^#+0.0E\+0$/)){if(r==0)return"0.0E+0";if(r<0)return"-"+write_num_exp(t,-r);var a=t.indexOf(".");a===-1&&(a=t.indexOf("E"));var i=Math.floor(Math.log(r)*Math.LOG10E)%a;if(i<0&&(i+=a),e=(r/Math.pow(10,i)).toPrecision(s+1+(a+i)%a),e.indexOf("e")===-1){var o=Math.floor(Math.log(r)*Math.LOG10E);for(e.indexOf(".")===-1?e=e.charAt(0)+"."+e.substr(1)+"E+"+(o-e.length+i):e+="E+"+(o-i);e.substr(0,2)==="0.";)e=e.charAt(0)+e.substr(2,a)+"."+e.substr(2+a),e=e.replace(/^0+([1-9])/,"$1").replace(/^0+\./,"0.");e=e.replace(/\+-/,"-")}e=e.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(c,x,u,h){return x+u+h.substr(0,(a+i)%a)+"."+h.substr(i)+"E"})}else e=r.toExponential(s);return t.match(/E\+00$/)&&e.match(/e[+-]\d$/)&&(e=e.substr(0,e.length-1)+"0"+e.charAt(e.length-1)),t.match(/E\-/)&&e.match(/e\+/)&&(e=e.replace(/e\+/,"e")),e.replace("e","E")}var frac1=/# (\?+)( ?)\/( ?)(\d+)/;function write_num_f1(t,r,e){var s=parseInt(t[4],10),a=Math.round(r*s),i=Math.floor(a/s),o=a-i*s,c=s;return e+(i===0?"":""+i)+" "+(o===0?fill(" ",t[1].length+1+t[4].length):pad_(o,t[1].length)+t[2]+"/"+t[3]+pad0(c,t[4].length))}function write_num_f2(t,r,e){return e+(r===0?"":""+r)+fill(" ",t[1].length+2+t[4].length)}var dec1=/^#*0*\.([0#]+)/,closeparen=/\).*[0#]/,phone=/\(###\) ###\\?-####/;function hashq(t){for(var r="",e,s=0;s!=t.length;++s)switch(e=t.charCodeAt(s)){case 35:break;case 63:r+=" ";break;case 48:r+="0";break;default:r+=String.fromCharCode(e)}return r}function rnd(t,r){var e=Math.pow(10,r);return""+Math.round(t*e)/e}function dec(t,r){var e=t-Math.floor(t),s=Math.pow(10,r);return r<(""+Math.round(e*s)).length?0:Math.round(e*s)}function carry(t,r){return r<(""+Math.round((t-Math.floor(t))*Math.pow(10,r))).length?1:0}function flr(t){return t<2147483647&&t>-2147483648?""+(t>=0?t|0:t-1|0):""+Math.floor(t)}function write_num_flt(t,r,e){if(t.charCodeAt(0)===40&&!r.match(closeparen)){var s=r.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return e>=0?write_num_flt("n",s,e):"("+write_num_flt("n",s,-e)+")"}if(r.charCodeAt(r.length-1)===44)return write_num_cm(t,r,e);if(r.indexOf("%")!==-1)return write_num_pct(t,r,e);if(r.indexOf("E")!==-1)return write_num_exp(r,e);if(r.charCodeAt(0)===36)return"$"+write_num_flt(t,r.substr(r.charAt(1)==" "?2:1),e);var a,i,o,c,x=Math.abs(e),u=e<0?"-":"";if(r.match(/^00+$/))return u+pad0r(x,r.length);if(r.match(/^[#?]+$/))return a=pad0r(e,0),a==="0"&&(a=""),a.length>r.length?a:hashq(r.substr(0,r.length-a.length))+a;if(i=r.match(frac1))return write_num_f1(i,x,u);if(r.match(/^#+0+$/))return u+pad0r(x,r.length-r.indexOf("0"));if(i=r.match(dec1))return a=rnd(e,i[1].length).replace(/^([^\.]+)$/,"$1."+hashq(i[1])).replace(/\.$/,"."+hashq(i[1])).replace(/\.(\d*)$/,function(E,d){return"."+d+fill("0",hashq(i[1]).length-d.length)}),r.indexOf("0.")!==-1?a:a.replace(/^0\./,".");if(r=r.replace(/^#+([0.])/,"$1"),i=r.match(/^(0*)\.(#*)$/))return u+rnd(x,i[2].length).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,i[1].length?"0.":".");if(i=r.match(/^#{1,3},##0(\.?)$/))return u+commaify(pad0r(x,0));if(i=r.match(/^#,##0\.([#0]*0)$/))return e<0?"-"+write_num_flt(t,r,-e):commaify(""+(Math.floor(e)+carry(e,i[1].length)))+"."+pad0(dec(e,i[1].length),i[1].length);if(i=r.match(/^#,#*,#0/))return write_num_flt(t,r.replace(/^#,#*,/,""),e);if(i=r.match(/^([0#]+)(\\?-([0#]+))+$/))return a=_strrev(write_num_flt(t,r.replace(/[\\-]/g,""),e)),o=0,_strrev(_strrev(r.replace(/\\/g,"")).replace(/[0#]/g,function(E){return o<a.length?a.charAt(o++):E==="0"?"0":""}));if(r.match(phone))return a=write_num_flt(t,"##########",e),"("+a.substr(0,3)+") "+a.substr(3,3)+"-"+a.substr(6);var h="";if(i=r.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return o=Math.min(i[4].length,7),c=SSF_frac(x,Math.pow(10,o)-1,!1),a=""+u,h=write_num("n",i[1],c[1]),h.charAt(h.length-1)==" "&&(h=h.substr(0,h.length-1)+"0"),a+=h+i[2]+"/"+i[3],h=rpad_(c[2],o),h.length<i[4].length&&(h=hashq(i[4].substr(i[4].length-h.length))+h),a+=h,a;if(i=r.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return o=Math.min(Math.max(i[1].length,i[4].length),7),c=SSF_frac(x,Math.pow(10,o)-1,!0),u+(c[0]||(c[1]?"":"0"))+" "+(c[1]?pad_(c[1],o)+i[2]+"/"+i[3]+rpad_(c[2],o):fill(" ",2*o+1+i[2].length+i[3].length));if(i=r.match(/^[#0?]+$/))return a=pad0r(e,0),r.length<=a.length?a:hashq(r.substr(0,r.length-a.length))+a;if(i=r.match(/^([#0?]+)\.([#0]+)$/)){a=""+e.toFixed(Math.min(i[2].length,10)).replace(/([^0])0+$/,"$1"),o=a.indexOf(".");var _=r.indexOf(".")-o,v=r.length-a.length-_;return hashq(r.substr(0,_)+a+r.substr(r.length-v))}if(i=r.match(/^00,000\.([#0]*0)$/))return o=dec(e,i[1].length),e<0?"-"+write_num_flt(t,r,-e):commaify(flr(e)).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(E){return"00,"+(E.length<3?pad0(0,3-E.length):"")+E})+"."+pad0(o,i[1].length);switch(r){case"###,##0.00":return write_num_flt(t,"#,##0.00",e);case"###,###":case"##,###":case"#,###":var b=commaify(pad0r(x,0));return b!=="0"?u+b:"";case"###,###.00":return write_num_flt(t,"###,##0.00",e).replace(/^0\./,".");case"#,###.00":return write_num_flt(t,"#,##0.00",e).replace(/^0\./,".")}throw new Error("unsupported format |"+r+"|")}function write_num_cm2(t,r,e){for(var s=r.length-1;r.charCodeAt(s-1)===44;)--s;return write_num(t,r.substr(0,s),e/Math.pow(10,3*(r.length-s)))}function write_num_pct2(t,r,e){var s=r.replace(pct1,""),a=r.length-s.length;return write_num(t,s,e*Math.pow(10,2*a))+fill("%",a)}function write_num_exp2(t,r){var e,s=t.indexOf("E")-t.indexOf(".")-1;if(t.match(/^#+0.0E\+0$/)){if(r==0)return"0.0E+0";if(r<0)return"-"+write_num_exp2(t,-r);var a=t.indexOf(".");a===-1&&(a=t.indexOf("E"));var i=Math.floor(Math.log(r)*Math.LOG10E)%a;if(i<0&&(i+=a),e=(r/Math.pow(10,i)).toPrecision(s+1+(a+i)%a),!e.match(/[Ee]/)){var o=Math.floor(Math.log(r)*Math.LOG10E);e.indexOf(".")===-1?e=e.charAt(0)+"."+e.substr(1)+"E+"+(o-e.length+i):e+="E+"+(o-i),e=e.replace(/\+-/,"-")}e=e.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(c,x,u,h){return x+u+h.substr(0,(a+i)%a)+"."+h.substr(i)+"E"})}else e=r.toExponential(s);return t.match(/E\+00$/)&&e.match(/e[+-]\d$/)&&(e=e.substr(0,e.length-1)+"0"+e.charAt(e.length-1)),t.match(/E\-/)&&e.match(/e\+/)&&(e=e.replace(/e\+/,"e")),e.replace("e","E")}function write_num_int(t,r,e){if(t.charCodeAt(0)===40&&!r.match(closeparen)){var s=r.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return e>=0?write_num_int("n",s,e):"("+write_num_int("n",s,-e)+")"}if(r.charCodeAt(r.length-1)===44)return write_num_cm2(t,r,e);if(r.indexOf("%")!==-1)return write_num_pct2(t,r,e);if(r.indexOf("E")!==-1)return write_num_exp2(r,e);if(r.charCodeAt(0)===36)return"$"+write_num_int(t,r.substr(r.charAt(1)==" "?2:1),e);var a,i,o,c,x=Math.abs(e),u=e<0?"-":"";if(r.match(/^00+$/))return u+pad0(x,r.length);if(r.match(/^[#?]+$/))return a=""+e,e===0&&(a=""),a.length>r.length?a:hashq(r.substr(0,r.length-a.length))+a;if(i=r.match(frac1))return write_num_f2(i,x,u);if(r.match(/^#+0+$/))return u+pad0(x,r.length-r.indexOf("0"));if(i=r.match(dec1))return a=(""+e).replace(/^([^\.]+)$/,"$1."+hashq(i[1])).replace(/\.$/,"."+hashq(i[1])),a=a.replace(/\.(\d*)$/,function(E,d){return"."+d+fill("0",hashq(i[1]).length-d.length)}),r.indexOf("0.")!==-1?a:a.replace(/^0\./,".");if(r=r.replace(/^#+([0.])/,"$1"),i=r.match(/^(0*)\.(#*)$/))return u+(""+x).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,i[1].length?"0.":".");if(i=r.match(/^#{1,3},##0(\.?)$/))return u+commaify(""+x);if(i=r.match(/^#,##0\.([#0]*0)$/))return e<0?"-"+write_num_int(t,r,-e):commaify(""+e)+"."+fill("0",i[1].length);if(i=r.match(/^#,#*,#0/))return write_num_int(t,r.replace(/^#,#*,/,""),e);if(i=r.match(/^([0#]+)(\\?-([0#]+))+$/))return a=_strrev(write_num_int(t,r.replace(/[\\-]/g,""),e)),o=0,_strrev(_strrev(r.replace(/\\/g,"")).replace(/[0#]/g,function(E){return o<a.length?a.charAt(o++):E==="0"?"0":""}));if(r.match(phone))return a=write_num_int(t,"##########",e),"("+a.substr(0,3)+") "+a.substr(3,3)+"-"+a.substr(6);var h="";if(i=r.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return o=Math.min(i[4].length,7),c=SSF_frac(x,Math.pow(10,o)-1,!1),a=""+u,h=write_num("n",i[1],c[1]),h.charAt(h.length-1)==" "&&(h=h.substr(0,h.length-1)+"0"),a+=h+i[2]+"/"+i[3],h=rpad_(c[2],o),h.length<i[4].length&&(h=hashq(i[4].substr(i[4].length-h.length))+h),a+=h,a;if(i=r.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return o=Math.min(Math.max(i[1].length,i[4].length),7),c=SSF_frac(x,Math.pow(10,o)-1,!0),u+(c[0]||(c[1]?"":"0"))+" "+(c[1]?pad_(c[1],o)+i[2]+"/"+i[3]+rpad_(c[2],o):fill(" ",2*o+1+i[2].length+i[3].length));if(i=r.match(/^[#0?]+$/))return a=""+e,r.length<=a.length?a:hashq(r.substr(0,r.length-a.length))+a;if(i=r.match(/^([#0]+)\.([#0]+)$/)){a=""+e.toFixed(Math.min(i[2].length,10)).replace(/([^0])0+$/,"$1"),o=a.indexOf(".");var _=r.indexOf(".")-o,v=r.length-a.length-_;return hashq(r.substr(0,_)+a+r.substr(r.length-v))}if(i=r.match(/^00,000\.([#0]*0)$/))return e<0?"-"+write_num_int(t,r,-e):commaify(""+e).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(E){return"00,"+(E.length<3?pad0(0,3-E.length):"")+E})+"."+pad0(0,i[1].length);switch(r){case"###,###":case"##,###":case"#,###":var b=commaify(""+x);return b!=="0"?u+b:"";default:if(r.match(/\.[0#?]*$/))return write_num_int(t,r.slice(0,r.lastIndexOf(".")),e)+hashq(r.slice(r.lastIndexOf(".")))}throw new Error("unsupported format |"+r+"|")}function write_num(t,r,e){return(e|0)===e?write_num_int(t,r,e):write_num_flt(t,r,e)}function SSF_split_fmt(t){for(var r=[],e=!1,s=0,a=0;s<t.length;++s)switch(t.charCodeAt(s)){case 34:e=!e;break;case 95:case 42:case 92:++s;break;case 59:r[r.length]=t.substr(a,s-a),a=s+1}if(r[r.length]=t.substr(a),e===!0)throw new Error("Format |"+t+"| unterminated string ");return r}var SSF_abstime=/\[[HhMmSs\u0E0A\u0E19\u0E17]*\]/;function fmt_is_date(t){for(var r=0,e="",s="";r<t.length;)switch(e=t.charAt(r)){case"G":SSF_isgeneral(t,r)&&(r+=6),r++;break;case'"':for(;t.charCodeAt(++r)!==34&&r<t.length;);++r;break;case"\\":r+=2;break;case"_":r+=2;break;case"@":++r;break;case"B":case"b":if(t.charAt(r+1)==="1"||t.charAt(r+1)==="2")return!0;case"M":case"D":case"Y":case"H":case"S":case"E":case"m":case"d":case"y":case"h":case"s":case"e":case"g":return!0;case"A":case"a":case"上":if(t.substr(r,3).toUpperCase()==="A/P"||t.substr(r,5).toUpperCase()==="AM/PM"||t.substr(r,5).toUpperCase()==="上午/下午")return!0;++r;break;case"[":for(s=e;t.charAt(r++)!=="]"&&r<t.length;)s+=t.charAt(r);if(s.match(SSF_abstime))return!0;break;case".":case"0":case"#":for(;r<t.length&&("0#?.,E+-%".indexOf(e=t.charAt(++r))>-1||e=="\\"&&t.charAt(r+1)=="-"&&"0#".indexOf(t.charAt(r+2))>-1););break;case"?":for(;t.charAt(++r)===e;);break;case"*":++r,(t.charAt(r)==" "||t.charAt(r)=="*")&&++r;break;case"(":case")":++r;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(;r<t.length&&"0123456789".indexOf(t.charAt(++r))>-1;);break;case" ":++r;break;default:++r;break}return!1}function eval_fmt(t,r,e,s){for(var a=[],i="",o=0,c="",x="t",u,h,_,v="H";o<t.length;)switch(c=t.charAt(o)){case"G":if(!SSF_isgeneral(t,o))throw new Error("unrecognized character "+c+" in "+t);a[a.length]={t:"G",v:"General"},o+=7;break;case'"':for(i="";(_=t.charCodeAt(++o))!==34&&o<t.length;)i+=String.fromCharCode(_);a[a.length]={t:"t",v:i},++o;break;case"\\":var b=t.charAt(++o),E=b==="("||b===")"?b:"t";a[a.length]={t:E,v:b},++o;break;case"_":a[a.length]={t:"t",v:" "},o+=2;break;case"@":a[a.length]={t:"T",v:r},++o;break;case"B":case"b":if(t.charAt(o+1)==="1"||t.charAt(o+1)==="2"){if(u==null&&(u=SSF_parse_date_code(r,e,t.charAt(o+1)==="2"),u==null))return"";a[a.length]={t:"X",v:t.substr(o,2)},x=c,o+=2;break}case"M":case"D":case"Y":case"H":case"S":case"E":c=c.toLowerCase();case"m":case"d":case"y":case"h":case"s":case"e":case"g":if(r<0||u==null&&(u=SSF_parse_date_code(r,e),u==null))return"";for(i=c;++o<t.length&&t.charAt(o).toLowerCase()===c;)i+=c;c==="m"&&x.toLowerCase()==="h"&&(c="M"),c==="h"&&(c=v),a[a.length]={t:c,v:i},x=c;break;case"A":case"a":case"上":var d={t:c,v:c};if(u==null&&(u=SSF_parse_date_code(r,e)),t.substr(o,3).toUpperCase()==="A/P"?(u!=null&&(d.v=u.H>=12?"P":"A"),d.t="T",v="h",o+=3):t.substr(o,5).toUpperCase()==="AM/PM"?(u!=null&&(d.v=u.H>=12?"PM":"AM"),d.t="T",o+=5,v="h"):t.substr(o,5).toUpperCase()==="上午/下午"?(u!=null&&(d.v=u.H>=12?"下午":"上午"),d.t="T",o+=5,v="h"):(d.t="t",++o),u==null&&d.t==="T")return"";a[a.length]=d,x=c;break;case"[":for(i=c;t.charAt(o++)!=="]"&&o<t.length;)i+=t.charAt(o);if(i.slice(-1)!=="]")throw'unterminated "[" block: |'+i+"|";if(i.match(SSF_abstime)){if(u==null&&(u=SSF_parse_date_code(r,e),u==null))return"";a[a.length]={t:"Z",v:i.toLowerCase()},x=i.charAt(1)}else i.indexOf("$")>-1&&(i=(i.match(/\$([^-\[\]]*)/)||[])[1]||"$",fmt_is_date(t)||(a[a.length]={t:"t",v:i}));break;case".":if(u!=null){for(i=c;++o<t.length&&(c=t.charAt(o))==="0";)i+=c;a[a.length]={t:"s",v:i};break}case"0":case"#":for(i=c;++o<t.length&&"0#?.,E+-%".indexOf(c=t.charAt(o))>-1;)i+=c;a[a.length]={t:"n",v:i};break;case"?":for(i=c;t.charAt(++o)===c;)i+=c;a[a.length]={t:c,v:i},x=c;break;case"*":++o,(t.charAt(o)==" "||t.charAt(o)=="*")&&++o;break;case"(":case")":a[a.length]={t:s===1?"t":c,v:c},++o;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(i=c;o<t.length&&"0123456789".indexOf(t.charAt(++o))>-1;)i+=t.charAt(o);a[a.length]={t:"D",v:i};break;case" ":a[a.length]={t:c,v:c},++o;break;case"$":a[a.length]={t:"t",v:"$"},++o;break;default:if(",$-+/():!^&'~{}<>=€acfijklopqrtuvwxzP".indexOf(c)===-1)throw new Error("unrecognized character "+c+" in "+t);a[a.length]={t:"t",v:c},++o;break}var g=0,y=0,R;for(o=a.length-1,x="t";o>=0;--o)switch(a[o].t){case"h":case"H":a[o].t=v,x="h",g<1&&(g=1);break;case"s":(R=a[o].v.match(/\.0+$/))&&(y=Math.max(y,R[0].length-1)),g<3&&(g=3);case"d":case"y":case"M":case"e":x=a[o].t;break;case"m":x==="s"&&(a[o].t="M",g<2&&(g=2));break;case"X":break;case"Z":g<1&&a[o].v.match(/[Hh]/)&&(g=1),g<2&&a[o].v.match(/[Mm]/)&&(g=2),g<3&&a[o].v.match(/[Ss]/)&&(g=3)}switch(g){case 0:break;case 1:u.u>=.5&&(u.u=0,++u.S),u.S>=60&&(u.S=0,++u.M),u.M>=60&&(u.M=0,++u.H);break;case 2:u.u>=.5&&(u.u=0,++u.S),u.S>=60&&(u.S=0,++u.M);break}var P="",F;for(o=0;o<a.length;++o)switch(a[o].t){case"t":case"T":case" ":case"D":break;case"X":a[o].v="",a[o].t=";";break;case"d":case"m":case"y":case"h":case"H":case"M":case"s":case"e":case"b":case"Z":a[o].v=SSF_write_date(a[o].t.charCodeAt(0),a[o].v,u,y),a[o].t="t";break;case"n":case"?":for(F=o+1;a[F]!=null&&((c=a[F].t)==="?"||c==="D"||(c===" "||c==="t")&&a[F+1]!=null&&(a[F+1].t==="?"||a[F+1].t==="t"&&a[F+1].v==="/")||a[o].t==="("&&(c===" "||c==="n"||c===")")||c==="t"&&(a[F].v==="/"||a[F].v===" "&&a[F+1]!=null&&a[F+1].t=="?"));)a[o].v+=a[F].v,a[F]={v:"",t:";"},++F;P+=a[o].v,o=F-1;break;case"G":a[o].t="t",a[o].v=SSF_general(r,e);break}var S="",I,w;if(P.length>0){P.charCodeAt(0)==40?(I=r<0&&P.charCodeAt(0)===45?-r:r,w=write_num("n",P,I)):(I=r<0&&s>1?-r:r,w=write_num("n",P,I),I<0&&a[0]&&a[0].t=="t"&&(w=w.substr(1),a[0].v="-"+a[0].v)),F=w.length-1;var j=a.length;for(o=0;o<a.length;++o)if(a[o]!=null&&a[o].t!="t"&&a[o].v.indexOf(".")>-1){j=o;break}var C=a.length;if(j===a.length&&w.indexOf("E")===-1){for(o=a.length-1;o>=0;--o)a[o]==null||"n?".indexOf(a[o].t)===-1||(F>=a[o].v.length-1?(F-=a[o].v.length,a[o].v=w.substr(F+1,a[o].v.length)):F<0?a[o].v="":(a[o].v=w.substr(0,F+1),F=-1),a[o].t="t",C=o);F>=0&&C<a.length&&(a[C].v=w.substr(0,F+1)+a[C].v)}else if(j!==a.length&&w.indexOf("E")===-1){for(F=w.indexOf(".")-1,o=j;o>=0;--o)if(!(a[o]==null||"n?".indexOf(a[o].t)===-1)){for(h=a[o].v.indexOf(".")>-1&&o===j?a[o].v.indexOf(".")-1:a[o].v.length-1,S=a[o].v.substr(h+1);h>=0;--h)F>=0&&(a[o].v.charAt(h)==="0"||a[o].v.charAt(h)==="#")&&(S=w.charAt(F--)+S);a[o].v=S,a[o].t="t",C=o}for(F>=0&&C<a.length&&(a[C].v=w.substr(0,F+1)+a[C].v),F=w.indexOf(".")+1,o=j;o<a.length;++o)if(!(a[o]==null||"n?(".indexOf(a[o].t)===-1&&o!==j)){for(h=a[o].v.indexOf(".")>-1&&o===j?a[o].v.indexOf(".")+1:0,S=a[o].v.substr(0,h);h<a[o].v.length;++h)F<w.length&&(S+=w.charAt(F++));a[o].v=S,a[o].t="t",C=o}}}for(o=0;o<a.length;++o)a[o]!=null&&"n?".indexOf(a[o].t)>-1&&(I=s>1&&r<0&&o>0&&a[o-1].v==="-"?-r:r,a[o].v=write_num(a[o].t,a[o].v,I),a[o].t="t");var V="";for(o=0;o!==a.length;++o)a[o]!=null&&(V+=a[o].v);return V}var cfregex2=/\[(=|>[=]?|<[>=]?)(-?\d+(?:\.\d*)?)\]/;function chkcond(t,r){if(r==null)return!1;var e=parseFloat(r[2]);switch(r[1]){case"=":if(t==e)return!0;break;case">":if(t>e)return!0;break;case"<":if(t<e)return!0;break;case"<>":if(t!=e)return!0;break;case">=":if(t>=e)return!0;break;case"<=":if(t<=e)return!0;break}return!1}function choose_fmt(t,r){var e=SSF_split_fmt(t),s=e.length,a=e[s-1].indexOf("@");if(s<4&&a>-1&&--s,e.length>4)throw new Error("cannot find right format for |"+e.join("|")+"|");if(typeof r!="number")return[4,e.length===4||a>-1?e[e.length-1]:"@"];switch(e.length){case 1:e=a>-1?["General","General","General",e[0]]:[e[0],e[0],e[0],"@"];break;case 2:e=a>-1?[e[0],e[0],e[0],e[1]]:[e[0],e[1],e[0],"@"];break;case 3:e=a>-1?[e[0],e[1],e[0],e[2]]:[e[0],e[1],e[2],"@"];break}var i=r>0?e[0]:r<0?e[1]:e[2];if(e[0].indexOf("[")===-1&&e[1].indexOf("[")===-1)return[s,i];if(e[0].match(/\[[=<>]/)!=null||e[1].match(/\[[=<>]/)!=null){var o=e[0].match(cfregex2),c=e[1].match(cfregex2);return chkcond(r,o)?[s,e[0]]:chkcond(r,c)?[s,e[1]]:[s,e[o!=null&&c!=null?2:1]]}return[s,i]}function SSF_format(t,r,e){e==null&&(e={});var s="";switch(typeof t){case"string":t=="m/d/yy"&&e.dateNF?s=e.dateNF:s=t;break;case"number":t==14&&e.dateNF?s=e.dateNF:s=(e.table!=null?e.table:table_fmt)[t],s==null&&(s=e.table&&e.table[SSF_default_map[t]]||table_fmt[SSF_default_map[t]]),s==null&&(s=SSF_default_str[t]||"General");break}if(SSF_isgeneral(s,0))return SSF_general(r,e);r instanceof Date&&(r=datenum_local(r,e.date1904));var a=choose_fmt(s,r);if(SSF_isgeneral(a[1]))return SSF_general(r,e);if(r===!0)r="TRUE";else if(r===!1)r="FALSE";else if(r===""||r==null)return"";return eval_fmt(a[1],r,e,a[0])}function SSF_load(t,r){if(typeof r!="number"){r=+r||-1;for(var e=0;e<392;++e){if(table_fmt[e]==null){r<0&&(r=e);continue}if(table_fmt[e]==t){r=e;break}}r<0&&(r=391)}return table_fmt[r]=t,r}function SSF_load_table(t){for(var r=0;r!=392;++r)t[r]!==void 0&&SSF_load(t[r],r)}function make_ssf(){table_fmt=SSF_init_table()}var dateNFregex=/[dD]+|[mM]+|[yYeE]+|[Hh]+|[Ss]+/g;function dateNF_regex(t){var r=typeof t=="number"?table_fmt[t]:t;return r=r.replace(dateNFregex,"(\\d+)"),new RegExp("^"+r+"$")}function dateNF_fix(t,r,e){var s=-1,a=-1,i=-1,o=-1,c=-1,x=-1;(r.match(dateNFregex)||[]).forEach(function(_,v){var b=parseInt(e[v+1],10);switch(_.toLowerCase().charAt(0)){case"y":s=b;break;case"d":i=b;break;case"h":o=b;break;case"s":x=b;break;case"m":o>=0?c=b:a=b;break}}),x>=0&&c==-1&&a>=0&&(c=a,a=-1);var u=(""+(s>=0?s:new Date().getFullYear())).slice(-4)+"-"+("00"+(a>=1?a:1)).slice(-2)+"-"+("00"+(i>=1?i:1)).slice(-2);u.length==7&&(u="0"+u),u.length==8&&(u="20"+u);var h=("00"+(o>=0?o:0)).slice(-2)+":"+("00"+(c>=0?c:0)).slice(-2)+":"+("00"+(x>=0?x:0)).slice(-2);return o==-1&&c==-1&&x==-1?u:s==-1&&a==-1&&i==-1?h:u+"T"+h}var CRC32=function(){var t={};t.version="1.2.0";function r(){for(var w=0,j=new Array(256),C=0;C!=256;++C)w=C,w=w&1?-306674912^w>>>1:w>>>1,w=w&1?-306674912^w>>>1:w>>>1,w=w&1?-306674912^w>>>1:w>>>1,w=w&1?-306674912^w>>>1:w>>>1,w=w&1?-306674912^w>>>1:w>>>1,w=w&1?-306674912^w>>>1:w>>>1,w=w&1?-306674912^w>>>1:w>>>1,w=w&1?-306674912^w>>>1:w>>>1,j[C]=w;return typeof Int32Array<"u"?new Int32Array(j):j}var e=r();function s(w){var j=0,C=0,V=0,O=typeof Int32Array<"u"?new Int32Array(4096):new Array(4096);for(V=0;V!=256;++V)O[V]=w[V];for(V=0;V!=256;++V)for(C=w[V],j=256+V;j<4096;j+=256)C=O[j]=C>>>8^w[C&255];var H=[];for(V=1;V!=16;++V)H[V-1]=typeof Int32Array<"u"?O.subarray(V*256,V*256+256):O.slice(V*256,V*256+256);return H}var a=s(e),i=a[0],o=a[1],c=a[2],x=a[3],u=a[4],h=a[5],_=a[6],v=a[7],b=a[8],E=a[9],d=a[10],g=a[11],y=a[12],R=a[13],P=a[14];function F(w,j){for(var C=j^-1,V=0,O=w.length;V<O;)C=C>>>8^e[(C^w.charCodeAt(V++))&255];return~C}function S(w,j){for(var C=j^-1,V=w.length-15,O=0;O<V;)C=P[w[O++]^C&255]^R[w[O++]^C>>8&255]^y[w[O++]^C>>16&255]^g[w[O++]^C>>>24]^d[w[O++]]^E[w[O++]]^b[w[O++]]^v[w[O++]]^_[w[O++]]^h[w[O++]]^u[w[O++]]^x[w[O++]]^c[w[O++]]^o[w[O++]]^i[w[O++]]^e[w[O++]];for(V+=15;O<V;)C=C>>>8^e[(C^w[O++])&255];return~C}function I(w,j){for(var C=j^-1,V=0,O=w.length,H=0,z=0;V<O;)H=w.charCodeAt(V++),H<128?C=C>>>8^e[(C^H)&255]:H<2048?(C=C>>>8^e[(C^(192|H>>6&31))&255],C=C>>>8^e[(C^(128|H&63))&255]):H>=55296&&H<57344?(H=(H&1023)+64,z=w.charCodeAt(V++)&1023,C=C>>>8^e[(C^(240|H>>8&7))&255],C=C>>>8^e[(C^(128|H>>2&63))&255],C=C>>>8^e[(C^(128|z>>6&15|(H&3)<<4))&255],C=C>>>8^e[(C^(128|z&63))&255]):(C=C>>>8^e[(C^(224|H>>12&15))&255],C=C>>>8^e[(C^(128|H>>6&63))&255],C=C>>>8^e[(C^(128|H&63))&255]);return~C}return t.table=e,t.bstr=F,t.buf=S,t.str=I,t}(),CFB=function(){var r={};r.version="1.2.1";function e(W,le){for(var Z=W.split("/"),ie=le.split("/"),de=0,ue=0,Pe=Math.min(Z.length,ie.length);de<Pe;++de){if(ue=Z[de].length-ie[de].length)return ue;if(Z[de]!=ie[de])return Z[de]<ie[de]?-1:1}return Z.length-ie.length}function s(W){if(W.charAt(W.length-1)=="/")return W.slice(0,-1).indexOf("/")===-1?W:s(W.slice(0,-1));var le=W.lastIndexOf("/");return le===-1?W:W.slice(0,le+1)}function a(W){if(W.charAt(W.length-1)=="/")return a(W.slice(0,-1));var le=W.lastIndexOf("/");return le===-1?W:W.slice(le+1)}function i(W,le){typeof le=="string"&&(le=new Date(le));var Z=le.getHours();Z=Z<<6|le.getMinutes(),Z=Z<<5|le.getSeconds()>>>1,W.write_shift(2,Z);var ie=le.getFullYear()-1980;ie=ie<<4|le.getMonth()+1,ie=ie<<5|le.getDate(),W.write_shift(2,ie)}function o(W){var le=W.read_shift(2)&65535,Z=W.read_shift(2)&65535,ie=new Date,de=Z&31;Z>>>=5;var ue=Z&15;Z>>>=4,ie.setMilliseconds(0),ie.setFullYear(Z+1980),ie.setMonth(ue-1),ie.setDate(de);var Pe=le&31;le>>>=5;var Be=le&63;return le>>>=6,ie.setHours(le),ie.setMinutes(Be),ie.setSeconds(Pe<<1),ie}function c(W){prep_blob(W,0);for(var le={},Z=0;W.l<=W.length-4;){var ie=W.read_shift(2),de=W.read_shift(2),ue=W.l+de,Pe={};switch(ie){case 21589:Z=W.read_shift(1),Z&1&&(Pe.mtime=W.read_shift(4)),de>5&&(Z&2&&(Pe.atime=W.read_shift(4)),Z&4&&(Pe.ctime=W.read_shift(4))),Pe.mtime&&(Pe.mt=new Date(Pe.mtime*1e3));break}W.l=ue,le[ie]=Pe}return le}var x;function u(){return x||(x={})}function h(W,le){if(W[0]==80&&W[1]==75)return ct(W,le);if((W[0]|32)==109&&(W[1]|32)==105)return ve(W,le);if(W.length<512)throw new Error("CFB file size "+W.length+" < 512");var Z=3,ie=512,de=0,ue=0,Pe=0,Be=0,De=0,Oe=[],Ve=W.slice(0,512);prep_blob(Ve,0);var Je=_(Ve);switch(Z=Je[0],Z){case 3:ie=512;break;case 4:ie=4096;break;case 0:if(Je[1]==0)return ct(W,le);default:throw new Error("Major Version: Expected 3 or 4 saw "+Z)}ie!==512&&(Ve=W.slice(0,ie),prep_blob(Ve,28));var et=W.slice(0,ie);v(Ve,Z);var ut=Ve.read_shift(4,"i");if(Z===3&&ut!==0)throw new Error("# Directory Sectors: Expected 0 saw "+ut);Ve.l+=4,Pe=Ve.read_shift(4,"i"),Ve.l+=4,Ve.chk("00100000","Mini Stream Cutoff Size: "),Be=Ve.read_shift(4,"i"),de=Ve.read_shift(4,"i"),De=Ve.read_shift(4,"i"),ue=Ve.read_shift(4,"i");for(var rt=-1,lt=0;lt<109&&(rt=Ve.read_shift(4,"i"),!(rt<0));++lt)Oe[lt]=rt;var mt=b(W,ie);g(De,ue,mt,ie,Oe);var _t=R(mt,Pe,Oe,ie);_t[Pe].name="!Directory",de>0&&Be!==z&&(_t[Be].name="!MiniFAT"),_t[Oe[0]].name="!FAT",_t.fat_addrs=Oe,_t.ssz=ie;var St={},jt=[],Gt=[],Xt=[];P(Pe,_t,mt,jt,de,St,Gt,Be),E(Gt,Xt,jt),jt.shift();var Kt={FileIndex:Gt,FullPaths:Xt};return le&&le.raw&&(Kt.raw={header:et,sectors:mt}),Kt}function _(W){if(W[W.l]==80&&W[W.l+1]==75)return[0,0];W.chk(pe,"Header Signature: "),W.l+=16;var le=W.read_shift(2,"u");return[W.read_shift(2,"u"),le]}function v(W,le){var Z=9;switch(W.l+=2,Z=W.read_shift(2)){case 9:if(le!=3)throw new Error("Sector Shift: Expected 9 saw "+Z);break;case 12:if(le!=4)throw new Error("Sector Shift: Expected 12 saw "+Z);break;default:throw new Error("Sector Shift: Expected 9 or 12 saw "+Z)}W.chk("0600","Mini Sector Shift: "),W.chk("000000000000","Reserved: ")}function b(W,le){for(var Z=Math.ceil(W.length/le)-1,ie=[],de=1;de<Z;++de)ie[de-1]=W.slice(de*le,(de+1)*le);return ie[Z-1]=W.slice(Z*le),ie}function E(W,le,Z){for(var ie=0,de=0,ue=0,Pe=0,Be=0,De=Z.length,Oe=[],Ve=[];ie<De;++ie)Oe[ie]=Ve[ie]=ie,le[ie]=Z[ie];for(;Be<Ve.length;++Be)ie=Ve[Be],de=W[ie].L,ue=W[ie].R,Pe=W[ie].C,Oe[ie]===ie&&(de!==-1&&Oe[de]!==de&&(Oe[ie]=Oe[de]),ue!==-1&&Oe[ue]!==ue&&(Oe[ie]=Oe[ue])),Pe!==-1&&(Oe[Pe]=ie),de!==-1&&ie!=Oe[ie]&&(Oe[de]=Oe[ie],Ve.lastIndexOf(de)<Be&&Ve.push(de)),ue!==-1&&ie!=Oe[ie]&&(Oe[ue]=Oe[ie],Ve.lastIndexOf(ue)<Be&&Ve.push(ue));for(ie=1;ie<De;++ie)Oe[ie]===ie&&(ue!==-1&&Oe[ue]!==ue?Oe[ie]=Oe[ue]:de!==-1&&Oe[de]!==de&&(Oe[ie]=Oe[de]));for(ie=1;ie<De;++ie)if(W[ie].type!==0){if(Be=ie,Be!=Oe[Be])do Be=Oe[Be],le[ie]=le[Be]+"/"+le[ie];while(Be!==0&&Oe[Be]!==-1&&Be!=Oe[Be]);Oe[ie]=-1}for(le[0]+="/",ie=1;ie<De;++ie)W[ie].type!==2&&(le[ie]+="/")}function d(W,le,Z){for(var ie=W.start,de=W.size,ue=[],Pe=ie;Z&&de>0&&Pe>=0;)ue.push(le.slice(Pe*H,Pe*H+H)),de-=H,Pe=__readInt32LE(Z,Pe*4);return ue.length===0?new_buf(0):bconcat(ue).slice(0,W.size)}function g(W,le,Z,ie,de){var ue=z;if(W===z){if(le!==0)throw new Error("DIFAT chain shorter than expected")}else if(W!==-1){var Pe=Z[W],Be=(ie>>>2)-1;if(!Pe)return;for(var De=0;De<Be&&(ue=__readInt32LE(Pe,De*4))!==z;++De)de.push(ue);g(__readInt32LE(Pe,ie-4),le-1,Z,ie,de)}}function y(W,le,Z,ie,de){var ue=[],Pe=[];de||(de=[]);var Be=ie-1,De=0,Oe=0;for(De=le;De>=0;){de[De]=!0,ue[ue.length]=De,Pe.push(W[De]);var Ve=Z[Math.floor(De*4/ie)];if(Oe=De*4&Be,ie<4+Oe)throw new Error("FAT boundary crossed: "+De+" 4 "+ie);if(!W[Ve])break;De=__readInt32LE(W[Ve],Oe)}return{nodes:ue,data:__toBuffer([Pe])}}function R(W,le,Z,ie){var de=W.length,ue=[],Pe=[],Be=[],De=[],Oe=ie-1,Ve=0,Je=0,et=0,ut=0;for(Ve=0;Ve<de;++Ve)if(Be=[],et=Ve+le,et>=de&&(et-=de),!Pe[et]){De=[];var rt=[];for(Je=et;Je>=0;){rt[Je]=!0,Pe[Je]=!0,Be[Be.length]=Je,De.push(W[Je]);var lt=Z[Math.floor(Je*4/ie)];if(ut=Je*4&Oe,ie<4+ut)throw new Error("FAT boundary crossed: "+Je+" 4 "+ie);if(!W[lt]||(Je=__readInt32LE(W[lt],ut),rt[Je]))break}ue[et]={nodes:Be,data:__toBuffer([De])}}return ue}function P(W,le,Z,ie,de,ue,Pe,Be){for(var De=0,Oe=ie.length?2:0,Ve=le[W].data,Je=0,et=0,ut;Je<Ve.length;Je+=128){var rt=Ve.slice(Je,Je+128);prep_blob(rt,64),et=rt.read_shift(2),ut=__utf16le(rt,0,et-Oe),ie.push(ut);var lt={name:ut,type:rt.read_shift(1),color:rt.read_shift(1),L:rt.read_shift(4,"i"),R:rt.read_shift(4,"i"),C:rt.read_shift(4,"i"),clsid:rt.read_shift(16),state:rt.read_shift(4,"i"),start:0,size:0},mt=rt.read_shift(2)+rt.read_shift(2)+rt.read_shift(2)+rt.read_shift(2);mt!==0&&(lt.ct=F(rt,rt.l-8));var _t=rt.read_shift(2)+rt.read_shift(2)+rt.read_shift(2)+rt.read_shift(2);_t!==0&&(lt.mt=F(rt,rt.l-8)),lt.start=rt.read_shift(4,"i"),lt.size=rt.read_shift(4,"i"),lt.size<0&&lt.start<0&&(lt.size=lt.type=0,lt.start=z,lt.name=""),lt.type===5?(De=lt.start,de>0&&De!==z&&(le[De].name="!StreamData")):lt.size>=4096?(lt.storage="fat",le[lt.start]===void 0&&(le[lt.start]=y(Z,lt.start,le.fat_addrs,le.ssz)),le[lt.start].name=lt.name,lt.content=le[lt.start].data.slice(0,lt.size)):(lt.storage="minifat",lt.size<0?lt.size=0:De!==z&&lt.start!==z&&le[De]&&(lt.content=d(lt,le[De].data,(le[Be]||{}).data))),lt.content&&prep_blob(lt.content,0),ue[ut]=lt,Pe.push(lt)}}function F(W,le){return new Date((__readUInt32LE(W,le+4)/1e7*Math.pow(2,32)+__readUInt32LE(W,le)/1e7-11644473600)*1e3)}function S(W,le){return u(),h(x.readFileSync(W),le)}function I(W,le){var Z=le&&le.type;switch(Z||has_buf&&Buffer.isBuffer(W)&&(Z="buffer"),Z||"base64"){case"file":return S(W,le);case"base64":return h(s2a(Base64_decode(W)),le);case"binary":return h(s2a(W),le)}return h(W,le)}function w(W,le){var Z=le||{},ie=Z.root||"Root Entry";if(W.FullPaths||(W.FullPaths=[]),W.FileIndex||(W.FileIndex=[]),W.FullPaths.length!==W.FileIndex.length)throw new Error("inconsistent CFB structure");W.FullPaths.length===0&&(W.FullPaths[0]=ie+"/",W.FileIndex[0]={name:ie,type:5}),Z.CLSID&&(W.FileIndex[0].clsid=Z.CLSID),j(W)}function j(W){var le="Sh33tJ5";if(!CFB.find(W,"/"+le)){var Z=new_buf(4);Z[0]=55,Z[1]=Z[3]=50,Z[2]=54,W.FileIndex.push({name:le,type:2,content:Z,size:4,L:69,R:69,C:69}),W.FullPaths.push(W.FullPaths[0]+le),C(W)}}function C(W,le){w(W);for(var Z=!1,ie=!1,de=W.FullPaths.length-1;de>=0;--de){var ue=W.FileIndex[de];switch(ue.type){case 0:ie?Z=!0:(W.FileIndex.pop(),W.FullPaths.pop());break;case 1:case 2:case 5:ie=!0,isNaN(ue.R*ue.L*ue.C)&&(Z=!0),ue.R>-1&&ue.L>-1&&ue.R==ue.L&&(Z=!0);break;default:Z=!0;break}}if(!(!Z&&!le)){var Pe=new Date(1987,1,19),Be=0,De=Object.create?Object.create(null):{},Oe=[];for(de=0;de<W.FullPaths.length;++de)De[W.FullPaths[de]]=!0,W.FileIndex[de].type!==0&&Oe.push([W.FullPaths[de],W.FileIndex[de]]);for(de=0;de<Oe.length;++de){var Ve=s(Oe[de][0]);ie=De[Ve],ie||(Oe.push([Ve,{name:a(Ve).replace("/",""),type:1,clsid:he,ct:Pe,mt:Pe,content:null}]),De[Ve]=!0)}for(Oe.sort(function(ut,rt){return e(ut[0],rt[0])}),W.FullPaths=[],W.FileIndex=[],de=0;de<Oe.length;++de)W.FullPaths[de]=Oe[de][0],W.FileIndex[de]=Oe[de][1];for(de=0;de<Oe.length;++de){var Je=W.FileIndex[de],et=W.FullPaths[de];if(Je.name=a(et).replace("/",""),Je.L=Je.R=Je.C=-(Je.color=1),Je.size=Je.content?Je.content.length:0,Je.start=0,Je.clsid=Je.clsid||he,de===0)Je.C=Oe.length>1?1:-1,Je.size=0,Je.type=5;else if(et.slice(-1)=="/"){for(Be=de+1;Be<Oe.length&&s(W.FullPaths[Be])!=et;++Be);for(Je.C=Be>=Oe.length?-1:Be,Be=de+1;Be<Oe.length&&s(W.FullPaths[Be])!=s(et);++Be);Je.R=Be>=Oe.length?-1:Be,Je.type=1}else s(W.FullPaths[de+1]||"")==s(et)&&(Je.R=de+1),Je.type=2}}}function V(W,le){var Z=le||{};if(Z.fileType=="mad")return we(W,Z);switch(C(W),Z.fileType){case"zip":return _e(W,Z)}var ie=function(ut){for(var rt=0,lt=0,mt=0;mt<ut.FileIndex.length;++mt){var _t=ut.FileIndex[mt];if(_t.content){var St=_t.content.length;St>0&&(St<4096?rt+=St+63>>6:lt+=St+511>>9)}}for(var jt=ut.FullPaths.length+3>>2,Gt=rt+7>>3,Xt=rt+127>>7,Kt=Gt+lt+jt+Xt,Ht=Kt+127>>7,ir=Ht<=109?0:Math.ceil((Ht-109)/127);Kt+Ht+ir+127>>7>Ht;)ir=++Ht<=109?0:Math.ceil((Ht-109)/127);var Bt=[1,ir,Ht,Xt,jt,lt,rt,0];return ut.FileIndex[0].size=rt<<6,Bt[7]=(ut.FileIndex[0].start=Bt[0]+Bt[1]+Bt[2]+Bt[3]+Bt[4]+Bt[5])+(Bt[6]+7>>3),Bt}(W),de=new_buf(ie[7]<<9),ue=0,Pe=0;{for(ue=0;ue<8;++ue)de.write_shift(1,ee[ue]);for(ue=0;ue<8;++ue)de.write_shift(2,0);for(de.write_shift(2,62),de.write_shift(2,3),de.write_shift(2,65534),de.write_shift(2,9),de.write_shift(2,6),ue=0;ue<3;++ue)de.write_shift(2,0);for(de.write_shift(4,0),de.write_shift(4,ie[2]),de.write_shift(4,ie[0]+ie[1]+ie[2]+ie[3]-1),de.write_shift(4,0),de.write_shift(4,4096),de.write_shift(4,ie[3]?ie[0]+ie[1]+ie[2]-1:z),de.write_shift(4,ie[3]),de.write_shift(-4,ie[1]?ie[0]-1:z),de.write_shift(4,ie[1]),ue=0;ue<109;++ue)de.write_shift(-4,ue<ie[2]?ie[1]+ue:-1)}if(ie[1])for(Pe=0;Pe<ie[1];++Pe){for(;ue<236+Pe*127;++ue)de.write_shift(-4,ue<ie[2]?ie[1]+ue:-1);de.write_shift(-4,Pe===ie[1]-1?z:Pe+1)}var Be=function(ut){for(Pe+=ut;ue<Pe-1;++ue)de.write_shift(-4,ue+1);ut&&(++ue,de.write_shift(-4,z))};for(Pe=ue=0,Pe+=ie[1];ue<Pe;++ue)de.write_shift(-4,re.DIFSECT);for(Pe+=ie[2];ue<Pe;++ue)de.write_shift(-4,re.FATSECT);Be(ie[3]),Be(ie[4]);for(var De=0,Oe=0,Ve=W.FileIndex[0];De<W.FileIndex.length;++De)Ve=W.FileIndex[De],Ve.content&&(Oe=Ve.content.length,!(Oe<4096)&&(Ve.start=Pe,Be(Oe+511>>9)));for(Be(ie[6]+7>>3);de.l&511;)de.write_shift(-4,re.ENDOFCHAIN);for(Pe=ue=0,De=0;De<W.FileIndex.length;++De)Ve=W.FileIndex[De],Ve.content&&(Oe=Ve.content.length,!(!Oe||Oe>=4096)&&(Ve.start=Pe,Be(Oe+63>>6)));for(;de.l&511;)de.write_shift(-4,re.ENDOFCHAIN);for(ue=0;ue<ie[4]<<2;++ue){var Je=W.FullPaths[ue];if(!Je||Je.length===0){for(De=0;De<17;++De)de.write_shift(4,0);for(De=0;De<3;++De)de.write_shift(4,-1);for(De=0;De<12;++De)de.write_shift(4,0);continue}Ve=W.FileIndex[ue],ue===0&&(Ve.start=Ve.size?Ve.start-1:z);var et=ue===0&&Z.root||Ve.name;if(Oe=2*(et.length+1),de.write_shift(64,et,"utf16le"),de.write_shift(2,Oe),de.write_shift(1,Ve.type),de.write_shift(1,Ve.color),de.write_shift(-4,Ve.L),de.write_shift(-4,Ve.R),de.write_shift(-4,Ve.C),Ve.clsid)de.write_shift(16,Ve.clsid,"hex");else for(De=0;De<4;++De)de.write_shift(4,0);de.write_shift(4,Ve.state||0),de.write_shift(4,0),de.write_shift(4,0),de.write_shift(4,0),de.write_shift(4,0),de.write_shift(4,Ve.start),de.write_shift(4,Ve.size),de.write_shift(4,0)}for(ue=1;ue<W.FileIndex.length;++ue)if(Ve=W.FileIndex[ue],Ve.size>=4096)if(de.l=Ve.start+1<<9,has_buf&&Buffer.isBuffer(Ve.content))Ve.content.copy(de,de.l,0,Ve.size),de.l+=Ve.size+511&-512;else{for(De=0;De<Ve.size;++De)de.write_shift(1,Ve.content[De]);for(;De&511;++De)de.write_shift(1,0)}for(ue=1;ue<W.FileIndex.length;++ue)if(Ve=W.FileIndex[ue],Ve.size>0&&Ve.size<4096)if(has_buf&&Buffer.isBuffer(Ve.content))Ve.content.copy(de,de.l,0,Ve.size),de.l+=Ve.size+63&-64;else{for(De=0;De<Ve.size;++De)de.write_shift(1,Ve.content[De]);for(;De&63;++De)de.write_shift(1,0)}if(has_buf)de.l=de.length;else for(;de.l<de.length;)de.write_shift(1,0);return de}function O(W,le){var Z=W.FullPaths.map(function(De){return De.toUpperCase()}),ie=Z.map(function(De){var Oe=De.split("/");return Oe[Oe.length-(De.slice(-1)=="/"?2:1)]}),de=!1;le.charCodeAt(0)===47?(de=!0,le=Z[0].slice(0,-1)+le):de=le.indexOf("/")!==-1;var ue=le.toUpperCase(),Pe=de===!0?Z.indexOf(ue):ie.indexOf(ue);if(Pe!==-1)return W.FileIndex[Pe];var Be=!ue.match(chr1);for(ue=ue.replace(chr0,""),Be&&(ue=ue.replace(chr1,"!")),Pe=0;Pe<Z.length;++Pe)if((Be?Z[Pe].replace(chr1,"!"):Z[Pe]).replace(chr0,"")==ue||(Be?ie[Pe].replace(chr1,"!"):ie[Pe]).replace(chr0,"")==ue)return W.FileIndex[Pe];return null}var H=64,z=-2,pe="d0cf11e0a1b11ae1",ee=[208,207,17,224,161,177,26,225],he="00000000000000000000000000000000",re={MAXREGSECT:-6,DIFSECT:-4,FATSECT:-3,ENDOFCHAIN:z,FREESECT:-1,HEADER_SIGNATURE:pe,HEADER_MINOR_VERSION:"3e00",MAXREGSID:-6,NOSTREAM:-1,HEADER_CLSID:he,EntryTypes:["unknown","storage","stream","lockbytes","property","root"]};function me(W,le,Z){u();var ie=V(W,Z);x.writeFileSync(le,ie)}function te(W){for(var le=new Array(W.length),Z=0;Z<W.length;++Z)le[Z]=String.fromCharCode(W[Z]);return le.join("")}function ce(W,le){var Z=V(W,le);switch(le&&le.type||"buffer"){case"file":return u(),x.writeFileSync(le.filename,Z),Z;case"binary":return typeof Z=="string"?Z:te(Z);case"base64":return Base64_encode(typeof Z=="string"?Z:te(Z));case"buffer":if(has_buf)return Buffer.isBuffer(Z)?Z:Buffer_from(Z);case"array":return typeof Z=="string"?s2a(Z):Z}return Z}var ye;function L(W){try{var le=W.InflateRaw,Z=new le;if(Z._processChunk(new Uint8Array([3,0]),Z._finishFlushFlag),Z.bytesRead)ye=W;else throw new Error("zlib does not expose bytesRead")}catch(ie){console.error("cannot use native zlib: "+(ie.message||ie))}}function N(W,le){if(!ye)return je(W,le);var Z=ye.InflateRaw,ie=new Z,de=ie._processChunk(W.slice(W.l),ie._finishFlushFlag);return W.l+=ie.bytesRead,de}function T(W){return ye?ye.deflateRawSync(W):dt(W)}var A=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],D=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258],B=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577];function U(W){var le=(W<<1|W<<11)&139536|(W<<5|W<<15)&558144;return(le>>16|le>>8|le)&255}for(var Y=typeof Uint8Array<"u",G=Y?new Uint8Array(256):[],fe=0;fe<256;++fe)G[fe]=U(fe);function xe(W,le){var Z=G[W&255];return le<=8?Z>>>8-le:(Z=Z<<8|G[W>>8&255],le<=16?Z>>>16-le:(Z=Z<<8|G[W>>16&255],Z>>>24-le))}function Se(W,le){var Z=le&7,ie=le>>>3;return(W[ie]|(Z<=6?0:W[ie+1]<<8))>>>Z&3}function Ce(W,le){var Z=le&7,ie=le>>>3;return(W[ie]|(Z<=5?0:W[ie+1]<<8))>>>Z&7}function Me(W,le){var Z=le&7,ie=le>>>3;return(W[ie]|(Z<=4?0:W[ie+1]<<8))>>>Z&15}function be(W,le){var Z=le&7,ie=le>>>3;return(W[ie]|(Z<=3?0:W[ie+1]<<8))>>>Z&31}function ae(W,le){var Z=le&7,ie=le>>>3;return(W[ie]|(Z<=1?0:W[ie+1]<<8))>>>Z&127}function J(W,le,Z){var ie=le&7,de=le>>>3,ue=(1<<Z)-1,Pe=W[de]>>>ie;return Z<8-ie||(Pe|=W[de+1]<<8-ie,Z<16-ie)||(Pe|=W[de+2]<<16-ie,Z<24-ie)||(Pe|=W[de+3]<<24-ie),Pe&ue}function oe(W,le,Z){var ie=le&7,de=le>>>3;return ie<=5?W[de]|=(Z&7)<<ie:(W[de]|=Z<<ie&255,W[de+1]=(Z&7)>>8-ie),le+3}function Q(W,le,Z){var ie=le&7,de=le>>>3;return Z=(Z&1)<<ie,W[de]|=Z,le+1}function ge(W,le,Z){var ie=le&7,de=le>>>3;return Z<<=ie,W[de]|=Z&255,Z>>>=8,W[de+1]=Z,le+8}function Te(W,le,Z){var ie=le&7,de=le>>>3;return Z<<=ie,W[de]|=Z&255,Z>>>=8,W[de+1]=Z&255,W[de+2]=Z>>>8,le+16}function Le(W,le){var Z=W.length,ie=2*Z>le?2*Z:le+5,de=0;if(Z>=le)return W;if(has_buf){var ue=new_unsafe_buf(ie);if(W.copy)W.copy(ue);else for(;de<W.length;++de)ue[de]=W[de];return ue}else if(Y){var Pe=new Uint8Array(ie);if(Pe.set)Pe.set(W);else for(;de<Z;++de)Pe[de]=W[de];return Pe}return W.length=ie,W}function Re(W){for(var le=new Array(W),Z=0;Z<W;++Z)le[Z]=0;return le}function Ee(W,le,Z){var ie=1,de=0,ue=0,Pe=0,Be=0,De=W.length,Oe=Y?new Uint16Array(32):Re(32);for(ue=0;ue<32;++ue)Oe[ue]=0;for(ue=De;ue<Z;++ue)W[ue]=0;De=W.length;var Ve=Y?new Uint16Array(De):Re(De);for(ue=0;ue<De;++ue)Oe[de=W[ue]]++,ie<de&&(ie=de),Ve[ue]=0;for(Oe[0]=0,ue=1;ue<=ie;++ue)Oe[ue+16]=Be=Be+Oe[ue-1]<<1;for(ue=0;ue<De;++ue)Be=W[ue],Be!=0&&(Ve[ue]=Oe[Be+16]++);var Je=0;for(ue=0;ue<De;++ue)if(Je=W[ue],Je!=0)for(Be=xe(Ve[ue],ie)>>ie-Je,Pe=(1<<ie+4-Je)-1;Pe>=0;--Pe)le[Be|Pe<<Je]=Je&15|ue<<4;return ie}var ze=Y?new Uint16Array(512):Re(512),Xe=Y?new Uint16Array(32):Re(32);if(!Y){for(var tt=0;tt<512;++tt)ze[tt]=0;for(tt=0;tt<32;++tt)Xe[tt]=0}(function(){for(var W=[],le=0;le<32;le++)W.push(5);Ee(W,Xe,32);var Z=[];for(le=0;le<=143;le++)Z.push(8);for(;le<=255;le++)Z.push(9);for(;le<=279;le++)Z.push(7);for(;le<=287;le++)Z.push(8);Ee(Z,ze,288)})();var qe=function(){for(var le=Y?new Uint8Array(32768):[],Z=0,ie=0;Z<B.length-1;++Z)for(;ie<B[Z+1];++ie)le[ie]=Z;for(;ie<32768;++ie)le[ie]=29;var de=Y?new Uint8Array(259):[];for(Z=0,ie=0;Z<D.length-1;++Z)for(;ie<D[Z+1];++ie)de[ie]=Z;function ue(Be,De){for(var Oe=0;Oe<Be.length;){var Ve=Math.min(65535,Be.length-Oe),Je=Oe+Ve==Be.length;for(De.write_shift(1,+Je),De.write_shift(2,Ve),De.write_shift(2,~Ve&65535);Ve-- >0;)De[De.l++]=Be[Oe++]}return De.l}function Pe(Be,De){for(var Oe=0,Ve=0,Je=Y?new Uint16Array(32768):[];Ve<Be.length;){var et=Math.min(65535,Be.length-Ve);if(et<10){for(Oe=oe(De,Oe,+(Ve+et==Be.length)),Oe&7&&(Oe+=8-(Oe&7)),De.l=Oe/8|0,De.write_shift(2,et),De.write_shift(2,~et&65535);et-- >0;)De[De.l++]=Be[Ve++];Oe=De.l*8;continue}Oe=oe(De,Oe,+(Ve+et==Be.length)+2);for(var ut=0;et-- >0;){var rt=Be[Ve];ut=(ut<<5^rt)&32767;var lt=-1,mt=0;if((lt=Je[ut])&&(lt|=Ve&-32768,lt>Ve&&(lt-=32768),lt<Ve))for(;Be[lt+mt]==Be[Ve+mt]&&mt<250;)++mt;if(mt>2){rt=de[mt],rt<=22?Oe=ge(De,Oe,G[rt+1]>>1)-1:(ge(De,Oe,3),Oe+=5,ge(De,Oe,G[rt-23]>>5),Oe+=3);var _t=rt<8?0:rt-4>>2;_t>0&&(Te(De,Oe,mt-D[rt]),Oe+=_t),rt=le[Ve-lt],Oe=ge(De,Oe,G[rt]>>3),Oe-=3;var St=rt<4?0:rt-2>>1;St>0&&(Te(De,Oe,Ve-lt-B[rt]),Oe+=St);for(var jt=0;jt<mt;++jt)Je[ut]=Ve&32767,ut=(ut<<5^Be[Ve])&32767,++Ve;et-=mt-1}else rt<=143?rt=rt+48:Oe=Q(De,Oe,1),Oe=ge(De,Oe,G[rt]),Je[ut]=Ve&32767,++Ve}Oe=ge(De,Oe,0)-1}return De.l=(Oe+7)/8|0,De.l}return function(De,Oe){return De.length<8?ue(De,Oe):Pe(De,Oe)}}();function dt(W){var le=new_buf(50+Math.floor(W.length*1.1)),Z=qe(W,le);return le.slice(0,Z)}var Ze=Y?new Uint16Array(32768):Re(32768),nt=Y?new Uint16Array(32768):Re(32768),ht=Y?new Uint16Array(128):Re(128),ft=1,pt=1;function Ge(W,le){var Z=be(W,le)+257;le+=5;var ie=be(W,le)+1;le+=5;var de=Me(W,le)+4;le+=4;for(var ue=0,Pe=Y?new Uint8Array(19):Re(19),Be=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],De=1,Oe=Y?new Uint8Array(8):Re(8),Ve=Y?new Uint8Array(8):Re(8),Je=Pe.length,et=0;et<de;++et)Pe[A[et]]=ue=Ce(W,le),De<ue&&(De=ue),Oe[ue]++,le+=3;var ut=0;for(Oe[0]=0,et=1;et<=De;++et)Ve[et]=ut=ut+Oe[et-1]<<1;for(et=0;et<Je;++et)(ut=Pe[et])!=0&&(Be[et]=Ve[ut]++);var rt=0;for(et=0;et<Je;++et)if(rt=Pe[et],rt!=0){ut=G[Be[et]]>>8-rt;for(var lt=(1<<7-rt)-1;lt>=0;--lt)ht[ut|lt<<rt]=rt&7|et<<3}var mt=[];for(De=1;mt.length<Z+ie;)switch(ut=ht[ae(W,le)],le+=ut&7,ut>>>=3){case 16:for(ue=3+Se(W,le),le+=2,ut=mt[mt.length-1];ue-- >0;)mt.push(ut);break;case 17:for(ue=3+Ce(W,le),le+=3;ue-- >0;)mt.push(0);break;case 18:for(ue=11+ae(W,le),le+=7;ue-- >0;)mt.push(0);break;default:mt.push(ut),De<ut&&(De=ut);break}var _t=mt.slice(0,Z),St=mt.slice(Z);for(et=Z;et<286;++et)_t[et]=0;for(et=ie;et<30;++et)St[et]=0;return ft=Ee(_t,Ze,286),pt=Ee(St,nt,30),le}function Ne(W,le){if(W[0]==3&&!(W[1]&3))return[new_raw_buf(le),2];for(var Z=0,ie=0,de=new_unsafe_buf(le||1<<18),ue=0,Pe=de.length>>>0,Be=0,De=0;!(ie&1);){if(ie=Ce(W,Z),Z+=3,ie>>>1)ie>>1==1?(Be=9,De=5):(Z=Ge(W,Z),Be=ft,De=pt);else{Z&7&&(Z+=8-(Z&7));var Oe=W[Z>>>3]|W[(Z>>>3)+1]<<8;if(Z+=32,Oe>0)for(!le&&Pe<ue+Oe&&(de=Le(de,ue+Oe),Pe=de.length);Oe-- >0;)de[ue++]=W[Z>>>3],Z+=8;continue}for(;;){!le&&Pe<ue+32767&&(de=Le(de,ue+32767),Pe=de.length);var Ve=J(W,Z,Be),Je=ie>>>1==1?ze[Ve]:Ze[Ve];if(Z+=Je&15,Je>>>=4,!(Je>>>8&255))de[ue++]=Je;else{if(Je==256)break;Je-=257;var et=Je<8?0:Je-4>>2;et>5&&(et=0);var ut=ue+D[Je];et>0&&(ut+=J(W,Z,et),Z+=et),Ve=J(W,Z,De),Je=ie>>>1==1?Xe[Ve]:nt[Ve],Z+=Je&15,Je>>>=4;var rt=Je<4?0:Je-2>>1,lt=B[Je];for(rt>0&&(lt+=J(W,Z,rt),Z+=rt),!le&&Pe<ut&&(de=Le(de,ut+100),Pe=de.length);ue<ut;)de[ue]=de[ue-lt],++ue}}}return le?[de,Z+7>>>3]:[de.slice(0,ue),Z+7>>>3]}function je(W,le){var Z=W.slice(W.l||0),ie=Ne(Z,le);return W.l+=ie[1],ie[0]}function st(W,le){if(W)typeof console<"u"&&console.error(le);else throw new Error(le)}function ct(W,le){var Z=W;prep_blob(Z,0);var ie=[],de=[],ue={FileIndex:ie,FullPaths:de};w(ue,{root:le.root});for(var Pe=Z.length-4;(Z[Pe]!=80||Z[Pe+1]!=75||Z[Pe+2]!=5||Z[Pe+3]!=6)&&Pe>=0;)--Pe;Z.l=Pe+4,Z.l+=4;var Be=Z.read_shift(2);Z.l+=6;var De=Z.read_shift(4);for(Z.l=De,Pe=0;Pe<Be;++Pe){Z.l+=20;var Oe=Z.read_shift(4),Ve=Z.read_shift(4),Je=Z.read_shift(2),et=Z.read_shift(2),ut=Z.read_shift(2);Z.l+=8;var rt=Z.read_shift(4),lt=c(Z.slice(Z.l+Je,Z.l+Je+et));Z.l+=Je+et+ut;var mt=Z.l;Z.l=rt+4,K(Z,Oe,Ve,ue,lt),Z.l=mt}return ue}function K(W,le,Z,ie,de){W.l+=2;var ue=W.read_shift(2),Pe=W.read_shift(2),Be=o(W);if(ue&8257)throw new Error("Unsupported ZIP encryption");for(var De=W.read_shift(4),Oe=W.read_shift(4),Ve=W.read_shift(4),Je=W.read_shift(2),et=W.read_shift(2),ut="",rt=0;rt<Je;++rt)ut+=String.fromCharCode(W[W.l++]);if(et){var lt=c(W.slice(W.l,W.l+et));(lt[21589]||{}).mt&&(Be=lt[21589].mt),((de||{})[21589]||{}).mt&&(Be=de[21589].mt)}W.l+=et;var mt=W.slice(W.l,W.l+Oe);switch(Pe){case 8:mt=N(W,Ve);break;case 0:break;default:throw new Error("Unsupported ZIP Compression method "+Pe)}var _t=!1;ue&8&&(De=W.read_shift(4),De==134695760&&(De=W.read_shift(4),_t=!0),Oe=W.read_shift(4),Ve=W.read_shift(4)),Oe!=le&&st(_t,"Bad compressed size: "+le+" != "+Oe),Ve!=Z&&st(_t,"Bad uncompressed size: "+Z+" != "+Ve),He(ie,ut,mt,{unsafe:!0,mt:Be})}function _e(W,le){var Z=le||{},ie=[],de=[],ue=new_buf(1),Pe=Z.compression?8:0,Be=0,De=0,Oe=0,Ve=0,Je=0,et=W.FullPaths[0],ut=et,rt=W.FileIndex[0],lt=[],mt=0;for(De=1;De<W.FullPaths.length;++De)if(ut=W.FullPaths[De].slice(et.length),rt=W.FileIndex[De],!(!rt.size||!rt.content||ut=="Sh33tJ5")){var _t=Ve,St=new_buf(ut.length);for(Oe=0;Oe<ut.length;++Oe)St.write_shift(1,ut.charCodeAt(Oe)&127);St=St.slice(0,St.l),lt[Je]=CRC32.buf(rt.content,0);var jt=rt.content;Pe==8&&(jt=T(jt)),ue=new_buf(30),ue.write_shift(4,67324752),ue.write_shift(2,20),ue.write_shift(2,Be),ue.write_shift(2,Pe),rt.mt?i(ue,rt.mt):ue.write_shift(4,0),ue.write_shift(-4,lt[Je]),ue.write_shift(4,jt.length),ue.write_shift(4,rt.content.length),ue.write_shift(2,St.length),ue.write_shift(2,0),Ve+=ue.length,ie.push(ue),Ve+=St.length,ie.push(St),Ve+=jt.length,ie.push(jt),ue=new_buf(46),ue.write_shift(4,33639248),ue.write_shift(2,0),ue.write_shift(2,20),ue.write_shift(2,Be),ue.write_shift(2,Pe),ue.write_shift(4,0),ue.write_shift(-4,lt[Je]),ue.write_shift(4,jt.length),ue.write_shift(4,rt.content.length),ue.write_shift(2,St.length),ue.write_shift(2,0),ue.write_shift(2,0),ue.write_shift(2,0),ue.write_shift(2,0),ue.write_shift(4,0),ue.write_shift(4,_t),mt+=ue.l,de.push(ue),mt+=St.length,de.push(St),++Je}return ue=new_buf(22),ue.write_shift(4,101010256),ue.write_shift(2,0),ue.write_shift(2,0),ue.write_shift(2,Je),ue.write_shift(2,Je),ue.write_shift(4,mt),ue.write_shift(4,Ve),ue.write_shift(2,0),bconcat([bconcat(ie),bconcat(de),ue])}var We={htm:"text/html",xml:"text/xml",gif:"image/gif",jpg:"image/jpeg",png:"image/png",mso:"application/x-mso",thmx:"application/vnd.ms-officetheme",sh33tj5:"application/octet-stream"};function Ke(W,le){if(W.ctype)return W.ctype;var Z=W.name||"",ie=Z.match(/\.([^\.]+)$/);return ie&&We[ie[1]]||le&&(ie=(Z=le).match(/[\.\\]([^\.\\])+$/),ie&&We[ie[1]])?We[ie[1]]:"application/octet-stream"}function Ye(W){for(var le=Base64_encode(W),Z=[],ie=0;ie<le.length;ie+=76)Z.push(le.slice(ie,ie+76));return Z.join(`\r
`)+`\r
`}function $e(W){var le=W.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF=]/g,function(Oe){var Ve=Oe.charCodeAt(0).toString(16).toUpperCase();return"="+(Ve.length==1?"0"+Ve:Ve)});le=le.replace(/ $/mg,"=20").replace(/\t$/mg,"=09"),le.charAt(0)==`
`&&(le="=0D"+le.slice(1)),le=le.replace(/\r(?!\n)/mg,"=0D").replace(/\n\n/mg,`
=0A`).replace(/([^\r\n])\n/mg,"$1=0A");for(var Z=[],ie=le.split(`\r
`),de=0;de<ie.length;++de){var ue=ie[de];if(ue.length==0){Z.push("");continue}for(var Pe=0;Pe<ue.length;){var Be=76,De=ue.slice(Pe,Pe+Be);De.charAt(Be-1)=="="?Be--:De.charAt(Be-2)=="="?Be-=2:De.charAt(Be-3)=="="&&(Be-=3),De=ue.slice(Pe,Pe+Be),Pe+=Be,Pe<ue.length&&(De+="="),Z.push(De)}}return Z.join(`\r
`)}function ne(W){for(var le=[],Z=0;Z<W.length;++Z){for(var ie=W[Z];Z<=W.length&&ie.charAt(ie.length-1)=="=";)ie=ie.slice(0,ie.length-1)+W[++Z];le.push(ie)}for(var de=0;de<le.length;++de)le[de]=le[de].replace(/[=][0-9A-Fa-f]{2}/g,function(ue){return String.fromCharCode(parseInt(ue.slice(1),16))});return s2a(le.join(`\r
`))}function se(W,le,Z){for(var ie="",de="",ue="",Pe,Be=0;Be<10;++Be){var De=le[Be];if(!De||De.match(/^\s*$/))break;var Oe=De.match(/^(.*?):\s*([^\s].*)$/);if(Oe)switch(Oe[1].toLowerCase()){case"content-location":ie=Oe[2].trim();break;case"content-type":ue=Oe[2].trim();break;case"content-transfer-encoding":de=Oe[2].trim();break}}switch(++Be,de.toLowerCase()){case"base64":Pe=s2a(Base64_decode(le.slice(Be).join("")));break;case"quoted-printable":Pe=ne(le.slice(Be));break;default:throw new Error("Unsupported Content-Transfer-Encoding "+de)}var Ve=He(W,ie.slice(Z.length),Pe,{unsafe:!0});ue&&(Ve.ctype=ue)}function ve(W,le){if(te(W.slice(0,13)).toLowerCase()!="mime-version:")throw new Error("Unsupported MAD header");var Z=le&&le.root||"",ie=(has_buf&&Buffer.isBuffer(W)?W.toString("binary"):te(W)).split(`\r
`),de=0,ue="";for(de=0;de<ie.length;++de)if(ue=ie[de],!!/^Content-Location:/i.test(ue)&&(ue=ue.slice(ue.indexOf("file")),Z||(Z=ue.slice(0,ue.lastIndexOf("/")+1)),ue.slice(0,Z.length)!=Z))for(;Z.length>0&&(Z=Z.slice(0,Z.length-1),Z=Z.slice(0,Z.lastIndexOf("/")+1),ue.slice(0,Z.length)!=Z););var Pe=(ie[1]||"").match(/boundary="(.*?)"/);if(!Pe)throw new Error("MAD cannot find boundary");var Be="--"+(Pe[1]||""),De=[],Oe=[],Ve={FileIndex:De,FullPaths:Oe};w(Ve);var Je,et=0;for(de=0;de<ie.length;++de){var ut=ie[de];ut!==Be&&ut!==Be+"--"||(et++&&se(Ve,ie.slice(Je,de),Z),Je=de)}return Ve}function we(W,le){var Z=le||{},ie=Z.boundary||"SheetJS";ie="------="+ie;for(var de=["MIME-Version: 1.0",'Content-Type: multipart/related; boundary="'+ie.slice(2)+'"',"","",""],ue=W.FullPaths[0],Pe=ue,Be=W.FileIndex[0],De=1;De<W.FullPaths.length;++De)if(Pe=W.FullPaths[De].slice(ue.length),Be=W.FileIndex[De],!(!Be.size||!Be.content||Pe=="Sh33tJ5")){Pe=Pe.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF]/g,function(mt){return"_x"+mt.charCodeAt(0).toString(16)+"_"}).replace(/[\u0080-\uFFFF]/g,function(mt){return"_u"+mt.charCodeAt(0).toString(16)+"_"});for(var Oe=Be.content,Ve=has_buf&&Buffer.isBuffer(Oe)?Oe.toString("binary"):te(Oe),Je=0,et=Math.min(1024,Ve.length),ut=0,rt=0;rt<=et;++rt)(ut=Ve.charCodeAt(rt))>=32&&ut<128&&++Je;var lt=Je>=et*4/5;de.push(ie),de.push("Content-Location: "+(Z.root||"file:///C:/SheetJS/")+Pe),de.push("Content-Transfer-Encoding: "+(lt?"quoted-printable":"base64")),de.push("Content-Type: "+Ke(Be,Pe)),de.push(""),de.push(lt?$e(Ve):Ye(Ve))}return de.push(ie+`--\r
`),de.join(`\r
`)}function Fe(W){var le={};return w(le,W),le}function He(W,le,Z,ie){var de=ie&&ie.unsafe;de||w(W);var ue=!de&&CFB.find(W,le);if(!ue){var Pe=W.FullPaths[0];le.slice(0,Pe.length)==Pe?Pe=le:(Pe.slice(-1)!="/"&&(Pe+="/"),Pe=(Pe+le).replace("//","/")),ue={name:a(le),type:2},W.FileIndex.push(ue),W.FullPaths.push(Pe),de||CFB.utils.cfb_gc(W)}return ue.content=Z,ue.size=Z?Z.length:0,ie&&(ie.CLSID&&(ue.clsid=ie.CLSID),ie.mt&&(ue.mt=ie.mt),ie.ct&&(ue.ct=ie.ct)),ue}function Ue(W,le){w(W);var Z=CFB.find(W,le);if(Z){for(var ie=0;ie<W.FileIndex.length;++ie)if(W.FileIndex[ie]==Z)return W.FileIndex.splice(ie,1),W.FullPaths.splice(ie,1),!0}return!1}function at(W,le,Z){w(W);var ie=CFB.find(W,le);if(ie){for(var de=0;de<W.FileIndex.length;++de)if(W.FileIndex[de]==ie)return W.FileIndex[de].name=a(Z),W.FullPaths[de]=Z,!0}return!1}function it(W){C(W,!0)}return r.find=O,r.read=I,r.parse=h,r.write=ce,r.writeFile=me,r.utils={cfb_new:Fe,cfb_add:He,cfb_del:Ue,cfb_mov:at,cfb_gc:it,ReadShift,CheckField,prep_blob,bconcat,use_zlib:L,_deflateRaw:dt,_inflateRaw:je,consts:re},r}();function blobify(t){return typeof t=="string"?s2ab(t):Array.isArray(t)?a2u(t):t}function write_dl(t,r,e){if(typeof Deno<"u"){if(e&&typeof r=="string")switch(e){case"utf8":r=new TextEncoder(e).encode(r);break;case"binary":r=s2ab(r);break;default:throw new Error("Unsupported encoding "+e)}return Deno.writeFileSync(t,r)}var s=e=="utf8"?utf8write(r):r;if(typeof IE_SaveFile<"u")return IE_SaveFile(s,t);if(typeof Blob<"u"){var a=new Blob([blobify(s)],{type:"application/octet-stream"});if(typeof navigator<"u"&&navigator.msSaveBlob)return navigator.msSaveBlob(a,t);if(typeof saveAs<"u")return saveAs(a,t);if(typeof URL<"u"&&typeof document<"u"&&document.createElement&&URL.createObjectURL){var i=URL.createObjectURL(a);if(typeof chrome=="object"&&typeof(chrome.downloads||{}).download=="function")return URL.revokeObjectURL&&typeof setTimeout<"u"&&setTimeout(function(){URL.revokeObjectURL(i)},6e4),chrome.downloads.download({url:i,filename:t,saveAs:!0});var o=document.createElement("a");if(o.download!=null)return o.download=t,o.href=i,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL&&typeof setTimeout<"u"&&setTimeout(function(){URL.revokeObjectURL(i)},6e4),i}}if(typeof $<"u"&&typeof File<"u"&&typeof Folder<"u")try{var c=File(t);return c.open("w"),c.encoding="binary",Array.isArray(r)&&(r=a2s(r)),c.write(r),c.close(),r}catch(x){if(!x.message||!x.message.match(/onstruct/))throw x}throw new Error("cannot save file "+t)}function keys(t){for(var r=Object.keys(t),e=[],s=0;s<r.length;++s)Object.prototype.hasOwnProperty.call(t,r[s])&&e.push(r[s]);return e}function evert_key(t,r){for(var e=[],s=keys(t),a=0;a!==s.length;++a)e[t[s[a]][r]]==null&&(e[t[s[a]][r]]=s[a]);return e}function evert(t){for(var r=[],e=keys(t),s=0;s!==e.length;++s)r[t[e[s]]]=e[s];return r}function evert_num(t){for(var r=[],e=keys(t),s=0;s!==e.length;++s)r[t[e[s]]]=parseInt(e[s],10);return r}function evert_arr(t){for(var r=[],e=keys(t),s=0;s!==e.length;++s)r[t[e[s]]]==null&&(r[t[e[s]]]=[]),r[t[e[s]]].push(e[s]);return r}var basedate=new Date(1899,11,30,0,0,0);function datenum(t,r){var e=t.getTime(),s=basedate.getTime()+(t.getTimezoneOffset()-basedate.getTimezoneOffset())*6e4;return(e-s)/(24*60*60*1e3)}var refdate=new Date,dnthresh=basedate.getTime()+(refdate.getTimezoneOffset()-basedate.getTimezoneOffset())*6e4,refoffset=refdate.getTimezoneOffset();function numdate(t){var r=new Date;return r.setTime(t*24*60*60*1e3+dnthresh),r.getTimezoneOffset()!==refoffset&&r.setTime(r.getTime()+(r.getTimezoneOffset()-refoffset)*6e4),r}var good_pd_date_1=new Date("2017-02-19T19:06:09.000Z"),good_pd_date=isNaN(good_pd_date_1.getFullYear())?new Date("2/19/17"):good_pd_date_1,good_pd=good_pd_date.getFullYear()==2017;function parseDate(t,r){var e=new Date(t);if(good_pd)return r>0?e.setTime(e.getTime()+e.getTimezoneOffset()*60*1e3):r<0&&e.setTime(e.getTime()-e.getTimezoneOffset()*60*1e3),e;if(t instanceof Date)return t;if(good_pd_date.getFullYear()==1917&&!isNaN(e.getFullYear())){var s=e.getFullYear();return t.indexOf(""+s)>-1||e.setFullYear(e.getFullYear()+100),e}var a=t.match(/\d+/g)||["2017","2","19","0","0","0"],i=new Date(+a[0],+a[1]-1,+a[2],+a[3]||0,+a[4]||0,+a[5]||0);return t.indexOf("Z")>-1&&(i=new Date(i.getTime()-i.getTimezoneOffset()*60*1e3)),i}function cc2str(t,r){if(has_buf&&Buffer.isBuffer(t))return t.toString("binary");if(typeof TextDecoder<"u")try{var e={"€":"","‚":"",ƒ:"","„":"","…":"","†":"","‡":"","ˆ":"","‰":"",Š:"","‹":"",Œ:"",Ž:"","‘":"","’":"","“":"","”":"","•":"","–":"","—":"","˜":"","™":"",š:"","›":"",œ:"",ž:"",Ÿ:""};return Array.isArray(t)&&(t=new Uint8Array(t)),new TextDecoder("latin1").decode(t).replace(/[€‚ƒ„…†‡ˆ‰Š‹ŒŽ‘’“”•–—˜™š›œžŸ]/g,function(i){return e[i]||i})}catch{}for(var s=[],a=0;a!=t.length;++a)s.push(String.fromCharCode(t[a]));return s.join("")}function dup(t){if(typeof JSON<"u"&&!Array.isArray(t))return JSON.parse(JSON.stringify(t));if(typeof t!="object"||t==null)return t;if(t instanceof Date)return new Date(t.getTime());var r={};for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(r[e]=dup(t[e]));return r}function fill(t,r){for(var e="";e.length<r;)e+=t;return e}function fuzzynum(t){var r=Number(t);if(!isNaN(r))return isFinite(r)?r:NaN;if(!/\d/.test(t))return r;var e=1,s=t.replace(/([\d]),([\d])/g,"$1$2").replace(/[$]/g,"").replace(/[%]/g,function(){return e*=100,""});return!isNaN(r=Number(s))||(s=s.replace(/[(](.*)[)]/,function(a,i){return e=-e,i}),!isNaN(r=Number(s)))?r/e:r}var lower_months=["january","february","march","april","may","june","july","august","september","october","november","december"];function fuzzydate(t){var r=new Date(t),e=new Date(NaN),s=r.getYear(),a=r.getMonth(),i=r.getDate();if(isNaN(i))return e;var o=t.toLowerCase();if(o.match(/jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec/)){if(o=o.replace(/[^a-z]/g,"").replace(/([^a-z]|^)[ap]m?([^a-z]|$)/,""),o.length>3&&lower_months.indexOf(o)==-1)return e}else if(o.match(/[a-z]/))return e;return s<0||s>8099?e:(a>0||i>1)&&s!=101?r:t.match(/[^-0-9:,\/\\]/)?e:r}function zip_add_file(t,r,e){if(t.FullPaths){if(typeof e=="string"){var s;return has_buf?s=Buffer_from(e):s=utf8decode(e),CFB.utils.cfb_add(t,r,s)}CFB.utils.cfb_add(t,r,e)}else t.file(r,e)}function zip_new(){return CFB.utils.cfb_new()}var XML_HEADER=`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\r
`,encodings={"&quot;":'"',"&apos;":"'","&gt;":">","&lt;":"<","&amp;":"&"},rencoding=evert(encodings),decregex=/[&<>'"]/g,charegex=/[\u0000-\u0008\u000b-\u001f]/g;function escapexml(t){var r=t+"";return r.replace(decregex,function(e){return rencoding[e]}).replace(charegex,function(e){return"_x"+("000"+e.charCodeAt(0).toString(16)).slice(-4)+"_"})}function escapexmltag(t){return escapexml(t).replace(/ /g,"_x0020_")}var htmlcharegex=/[\u0000-\u001f]/g;function escapehtml(t){var r=t+"";return r.replace(decregex,function(e){return rencoding[e]}).replace(/\n/g,"<br/>").replace(htmlcharegex,function(e){return"&#x"+("000"+e.charCodeAt(0).toString(16)).slice(-4)+";"})}function escapexlml(t){var r=t+"";return r.replace(decregex,function(e){return rencoding[e]}).replace(htmlcharegex,function(e){return"&#x"+e.charCodeAt(0).toString(16).toUpperCase()+";"})}function xlml_unfixstr(t){return t.replace(/(\r\n|[\r\n])/g,"&#10;")}function parsexmlbool(t){switch(t){case 1:case!0:case"1":case"true":case"TRUE":return!0;default:return!1}}function utf8reada(t){for(var r="",e=0,s=0,a=0,i=0,o=0,c=0;e<t.length;){if(s=t.charCodeAt(e++),s<128){r+=String.fromCharCode(s);continue}if(a=t.charCodeAt(e++),s>191&&s<224){o=(s&31)<<6,o|=a&63,r+=String.fromCharCode(o);continue}if(i=t.charCodeAt(e++),s<240){r+=String.fromCharCode((s&15)<<12|(a&63)<<6|i&63);continue}o=t.charCodeAt(e++),c=((s&7)<<18|(a&63)<<12|(i&63)<<6|o&63)-65536,r+=String.fromCharCode(55296+(c>>>10&1023)),r+=String.fromCharCode(56320+(c&1023))}return r}function utf8readb(t){var r=new_raw_buf(2*t.length),e,s,a=1,i=0,o=0,c;for(s=0;s<t.length;s+=a)a=1,(c=t.charCodeAt(s))<128?e=c:c<224?(e=(c&31)*64+(t.charCodeAt(s+1)&63),a=2):c<240?(e=(c&15)*4096+(t.charCodeAt(s+1)&63)*64+(t.charCodeAt(s+2)&63),a=3):(a=4,e=(c&7)*262144+(t.charCodeAt(s+1)&63)*4096+(t.charCodeAt(s+2)&63)*64+(t.charCodeAt(s+3)&63),e-=65536,o=55296+(e>>>10&1023),e=56320+(e&1023)),o!==0&&(r[i++]=o&255,r[i++]=o>>>8,o=0),r[i++]=e%256,r[i++]=e>>>8;return r.slice(0,i).toString("ucs2")}function utf8readc(t){return Buffer_from(t,"binary").toString("utf8")}var utf8corpus="foo bar bazâð£",utf8read=has_buf&&(utf8readc(utf8corpus)==utf8reada(utf8corpus)&&utf8readc||utf8readb(utf8corpus)==utf8reada(utf8corpus)&&utf8readb)||utf8reada,utf8write=has_buf?function(t){return Buffer_from(t,"utf8").toString("binary")}:function(t){for(var r=[],e=0,s=0,a=0;e<t.length;)switch(s=t.charCodeAt(e++),!0){case s<128:r.push(String.fromCharCode(s));break;case s<2048:r.push(String.fromCharCode(192+(s>>6))),r.push(String.fromCharCode(128+(s&63)));break;case(s>=55296&&s<57344):s-=55296,a=t.charCodeAt(e++)-56320+(s<<10),r.push(String.fromCharCode(240+(a>>18&7))),r.push(String.fromCharCode(144+(a>>12&63))),r.push(String.fromCharCode(128+(a>>6&63))),r.push(String.fromCharCode(128+(a&63)));break;default:r.push(String.fromCharCode(224+(s>>12))),r.push(String.fromCharCode(128+(s>>6&63))),r.push(String.fromCharCode(128+(s&63)))}return r.join("")},htmldecode=function(){var t=[["nbsp"," "],["middot","·"],["quot",'"'],["apos","'"],["gt",">"],["lt","<"],["amp","&"]].map(function(r){return[new RegExp("&"+r[0]+";","ig"),r[1]]});return function(e){for(var s=e.replace(/^[\t\n\r ]+/,"").replace(/[\t\n\r ]+$/,"").replace(/>\s+/g,">").replace(/\s+</g,"<").replace(/[\t\n\r ]+/g," ").replace(/<\s*[bB][rR]\s*\/?>/g,`
`).replace(/<[^>]*>/g,""),a=0;a<t.length;++a)s=s.replace(t[a][0],t[a][1]);return s}}(),wtregex=/(^\s|\s$|\n)/;function writetag(t,r){return"<"+t+(r.match(wtregex)?' xml:space="preserve"':"")+">"+r+"</"+t+">"}function wxt_helper(t){return keys(t).map(function(r){return" "+r+'="'+t[r]+'"'}).join("")}function writextag(t,r,e){return"<"+t+(e!=null?wxt_helper(e):"")+(r!=null?(r.match(wtregex)?' xml:space="preserve"':"")+">"+r+"</"+t:"/")+">"}function write_w3cdtf(t,r){try{return t.toISOString().replace(/\.\d*/,"")}catch(e){if(r)throw e}return""}function write_vt(t,r){switch(typeof t){case"string":var e=writextag("vt:lpwstr",escapexml(t));return e=e.replace(/&quot;/g,"_x0022_"),e;case"number":return writextag((t|0)==t?"vt:i4":"vt:r8",escapexml(String(t)));case"boolean":return writextag("vt:bool",t?"true":"false")}if(t instanceof Date)return writextag("vt:filetime",write_w3cdtf(t));throw new Error("Unable to serialize "+t)}var XMLNS={CORE_PROPS:"http://schemas.openxmlformats.org/package/2006/metadata/core-properties",CUST_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/custom-properties",EXT_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/extended-properties",CT:"http://schemas.openxmlformats.org/package/2006/content-types",RELS:"http://schemas.openxmlformats.org/package/2006/relationships",TCMNT:"http://schemas.microsoft.com/office/spreadsheetml/2018/threadedcomments",dc:"http://purl.org/dc/elements/1.1/",dcterms:"http://purl.org/dc/terms/",dcmitype:"http://purl.org/dc/dcmitype/",r:"http://schemas.openxmlformats.org/officeDocument/2006/relationships",vt:"http://schemas.openxmlformats.org/officeDocument/2006/docPropsVTypes",xsi:"http://www.w3.org/2001/XMLSchema-instance",xsd:"http://www.w3.org/2001/XMLSchema"},XMLNS_main=["http://schemas.openxmlformats.org/spreadsheetml/2006/main","http://purl.oclc.org/ooxml/spreadsheetml/main","http://schemas.microsoft.com/office/excel/2006/main","http://schemas.microsoft.com/office/excel/2006/2"],XLMLNS={o:"urn:schemas-microsoft-com:office:office",x:"urn:schemas-microsoft-com:office:excel",ss:"urn:schemas-microsoft-com:office:spreadsheet",dt:"uuid:C2F41010-65B3-11d1-A29F-00AA00C14882",mv:"http://macVmlSchemaUri",v:"urn:schemas-microsoft-com:vml",html:"http://www.w3.org/TR/REC-html40"};function read_double_le(t,r){for(var e=1-2*(t[r+7]>>>7),s=((t[r+7]&127)<<4)+(t[r+6]>>>4&15),a=t[r+6]&15,i=5;i>=0;--i)a=a*256+t[r+i];return s==2047?a==0?e*(1/0):NaN:(s==0?s=-1022:(s-=1023,a+=Math.pow(2,52)),e*Math.pow(2,s-52)*a)}function write_double_le(t,r,e){var s=(r<0||1/r==-1/0?1:0)<<7,a=0,i=0,o=s?-r:r;isFinite(o)?o==0?a=i=0:(a=Math.floor(Math.log(o)/Math.LN2),i=o*Math.pow(2,52-a),a<=-1023&&(!isFinite(i)||i<Math.pow(2,52))?a=-1022:(i-=Math.pow(2,52),a+=1023)):(a=2047,i=isNaN(r)?26985:0);for(var c=0;c<=5;++c,i/=256)t[e+c]=i&255;t[e+6]=(a&15)<<4|i&15,t[e+7]=a>>4|s}var ___toBuffer=function(t){for(var r=[],e=10240,s=0;s<t[0].length;++s)if(t[0][s])for(var a=0,i=t[0][s].length;a<i;a+=e)r.push.apply(r,t[0][s].slice(a,a+e));return r},__toBuffer=has_buf?function(t){return t[0].length>0&&Buffer.isBuffer(t[0][0])?Buffer.concat(t[0].map(function(r){return Buffer.isBuffer(r)?r:Buffer_from(r)})):___toBuffer(t)}:___toBuffer,___utf16le=function(t,r,e){for(var s=[],a=r;a<e;a+=2)s.push(String.fromCharCode(__readUInt16LE(t,a)));return s.join("").replace(chr0,"")},__utf16le=has_buf?function(t,r,e){return Buffer.isBuffer(t)?t.toString("utf16le",r,e).replace(chr0,""):___utf16le(t,r,e)}:___utf16le,___hexlify=function(t,r,e){for(var s=[],a=r;a<r+e;++a)s.push(("0"+t[a].toString(16)).slice(-2));return s.join("")},__hexlify=has_buf?function(t,r,e){return Buffer.isBuffer(t)?t.toString("hex",r,r+e):___hexlify(t,r,e)}:___hexlify,___utf8=function(t,r,e){for(var s=[],a=r;a<e;a++)s.push(String.fromCharCode(__readUInt8(t,a)));return s.join("")},__utf8=has_buf?function(r,e,s){return Buffer.isBuffer(r)?r.toString("utf8",e,s):___utf8(r,e,s)}:___utf8,___lpstr=function(t,r){var e=__readUInt32LE(t,r);return e>0?__utf8(t,r+4,r+4+e-1):""},__lpstr=___lpstr,___cpstr=function(t,r){var e=__readUInt32LE(t,r);return e>0?__utf8(t,r+4,r+4+e-1):""},__cpstr=___cpstr,___lpwstr=function(t,r){var e=2*__readUInt32LE(t,r);return e>0?__utf8(t,r+4,r+4+e-1):""},__lpwstr=___lpwstr,___lpp4=function(r,e){var s=__readUInt32LE(r,e);return s>0?__utf16le(r,e+4,e+4+s):""},__lpp4=___lpp4,___8lpp4=function(t,r){var e=__readUInt32LE(t,r);return e>0?__utf8(t,r+4,r+4+e):""},__8lpp4=___8lpp4,___double=function(t,r){return read_double_le(t,r)},__double=___double,is_buf=function(r){return Array.isArray(r)||typeof Uint8Array<"u"&&r instanceof Uint8Array};has_buf&&(__lpstr=function(r,e){if(!Buffer.isBuffer(r))return ___lpstr(r,e);var s=r.readUInt32LE(e);return s>0?r.toString("utf8",e+4,e+4+s-1):""},__cpstr=function(r,e){if(!Buffer.isBuffer(r))return ___cpstr(r,e);var s=r.readUInt32LE(e);return s>0?r.toString("utf8",e+4,e+4+s-1):""},__lpwstr=function(r,e){if(!Buffer.isBuffer(r))return ___lpwstr(r,e);var s=2*r.readUInt32LE(e);return r.toString("utf16le",e+4,e+4+s-1)},__lpp4=function(r,e){if(!Buffer.isBuffer(r))return ___lpp4(r,e);var s=r.readUInt32LE(e);return r.toString("utf16le",e+4,e+4+s)},__8lpp4=function(r,e){if(!Buffer.isBuffer(r))return ___8lpp4(r,e);var s=r.readUInt32LE(e);return r.toString("utf8",e+4,e+4+s)},__double=function(r,e){return Buffer.isBuffer(r)?r.readDoubleLE(e):___double(r,e)},is_buf=function(r){return Buffer.isBuffer(r)||Array.isArray(r)||typeof Uint8Array<"u"&&r instanceof Uint8Array});var __readUInt8=function(t,r){return t[r]},__readUInt16LE=function(t,r){return t[r+1]*256+t[r]},__readInt16LE=function(t,r){var e=t[r+1]*256+t[r];return e<32768?e:(65535-e+1)*-1},__readUInt32LE=function(t,r){return t[r+3]*(1<<24)+(t[r+2]<<16)+(t[r+1]<<8)+t[r]},__readInt32LE=function(t,r){return t[r+3]<<24|t[r+2]<<16|t[r+1]<<8|t[r]},__readInt32BE=function(t,r){return t[r]<<24|t[r+1]<<16|t[r+2]<<8|t[r+3]};function ReadShift(t,r){var e="",s,a,i=[],o,c,x,u;switch(r){case"dbcs":if(u=this.l,has_buf&&Buffer.isBuffer(this))e=this.slice(this.l,this.l+2*t).toString("utf16le");else for(x=0;x<t;++x)e+=String.fromCharCode(__readUInt16LE(this,u)),u+=2;t*=2;break;case"utf8":e=__utf8(this,this.l,this.l+t);break;case"utf16le":t*=2,e=__utf16le(this,this.l,this.l+t);break;case"wstr":return ReadShift.call(this,t,"dbcs");case"lpstr-ansi":e=__lpstr(this,this.l),t=4+__readUInt32LE(this,this.l);break;case"lpstr-cp":e=__cpstr(this,this.l),t=4+__readUInt32LE(this,this.l);break;case"lpwstr":e=__lpwstr(this,this.l),t=4+2*__readUInt32LE(this,this.l);break;case"lpp4":t=4+__readUInt32LE(this,this.l),e=__lpp4(this,this.l),t&2&&(t+=2);break;case"8lpp4":t=4+__readUInt32LE(this,this.l),e=__8lpp4(this,this.l),t&3&&(t+=4-(t&3));break;case"cstr":for(t=0,e="";(o=__readUInt8(this,this.l+t++))!==0;)i.push(_getchar(o));e=i.join("");break;case"_wstr":for(t=0,e="";(o=__readUInt16LE(this,this.l+t))!==0;)i.push(_getchar(o)),t+=2;t+=2,e=i.join("");break;case"dbcs-cont":for(e="",u=this.l,x=0;x<t;++x){if(this.lens&&this.lens.indexOf(u)!==-1)return o=__readUInt8(this,u),this.l=u+1,c=ReadShift.call(this,t-x,o?"dbcs-cont":"sbcs-cont"),i.join("")+c;i.push(_getchar(__readUInt16LE(this,u))),u+=2}e=i.join(""),t*=2;break;case"cpstr":case"sbcs-cont":for(e="",u=this.l,x=0;x!=t;++x){if(this.lens&&this.lens.indexOf(u)!==-1)return o=__readUInt8(this,u),this.l=u+1,c=ReadShift.call(this,t-x,o?"dbcs-cont":"sbcs-cont"),i.join("")+c;i.push(_getchar(__readUInt8(this,u))),u+=1}e=i.join("");break;default:switch(t){case 1:return s=__readUInt8(this,this.l),this.l++,s;case 2:return s=(r==="i"?__readInt16LE:__readUInt16LE)(this,this.l),this.l+=2,s;case 4:case-4:return r==="i"||!(this[this.l+3]&128)?(s=(t>0?__readInt32LE:__readInt32BE)(this,this.l),this.l+=4,s):(a=__readUInt32LE(this,this.l),this.l+=4,a);case 8:case-8:if(r==="f")return t==8?a=__double(this,this.l):a=__double([this[this.l+7],this[this.l+6],this[this.l+5],this[this.l+4],this[this.l+3],this[this.l+2],this[this.l+1],this[this.l+0]],0),this.l+=8,a;t=8;case 16:e=__hexlify(this,this.l,t);break}}return this.l+=t,e}var __writeUInt32LE=function(t,r,e){t[e]=r&255,t[e+1]=r>>>8&255,t[e+2]=r>>>16&255,t[e+3]=r>>>24&255},__writeInt32LE=function(t,r,e){t[e]=r&255,t[e+1]=r>>8&255,t[e+2]=r>>16&255,t[e+3]=r>>24&255},__writeUInt16LE=function(t,r,e){t[e]=r&255,t[e+1]=r>>>8&255};function WriteShift(t,r,e){var s=0,a=0;if(e==="dbcs"){for(a=0;a!=r.length;++a)__writeUInt16LE(this,r.charCodeAt(a),this.l+2*a);s=2*r.length}else if(e==="sbcs"){for(r=r.replace(/[^\x00-\x7F]/g,"_"),a=0;a!=r.length;++a)this[this.l+a]=r.charCodeAt(a)&255;s=r.length}else if(e==="hex"){for(;a<t;++a)this[this.l++]=parseInt(r.slice(2*a,2*a+2),16)||0;return this}else if(e==="utf16le"){var i=Math.min(this.l+t,this.length);for(a=0;a<Math.min(r.length,t);++a){var o=r.charCodeAt(a);this[this.l++]=o&255,this[this.l++]=o>>8}for(;this.l<i;)this[this.l++]=0;return this}else switch(t){case 1:s=1,this[this.l]=r&255;break;case 2:s=2,this[this.l]=r&255,r>>>=8,this[this.l+1]=r&255;break;case 3:s=3,this[this.l]=r&255,r>>>=8,this[this.l+1]=r&255,r>>>=8,this[this.l+2]=r&255;break;case 4:s=4,__writeUInt32LE(this,r,this.l);break;case 8:if(s=8,e==="f"){write_double_le(this,r,this.l);break}case 16:break;case-4:s=4,__writeInt32LE(this,r,this.l);break}return this.l+=s,this}function CheckField(t,r){var e=__hexlify(this,this.l,t.length>>1);if(e!==t)throw new Error(r+"Expected "+t+" saw "+e);this.l+=t.length>>1}function prep_blob(t,r){t.l=r,t.read_shift=ReadShift,t.chk=CheckField,t.write_shift=WriteShift}function parsenoop(t,r){t.l+=r}function new_buf(t){var r=new_raw_buf(t);return prep_blob(r,0),r}function buf_array(){var t=[],r=has_buf?256:2048,e=function(u){var h=new_buf(u);return prep_blob(h,0),h},s=e(r),a=function(){s&&(s.length>s.l&&(s=s.slice(0,s.l),s.l=s.length),s.length>0&&t.push(s),s=null)},i=function(u){return s&&u<s.length-s.l?s:(a(),s=e(Math.max(u+1,r)))},o=function(){return a(),bconcat(t)},c=function(u){a(),s=u,s.l==null&&(s.l=s.length),i(r)};return{next:i,push:c,end:o,_bufs:t}}function write_record(t,r,e,s){var a=+r,i;if(!isNaN(a)){s||(s=XLSBRecordEnum[a].p||(e||[]).length||0),i=1+(a>=128?1:0)+1,s>=128&&++i,s>=16384&&++i,s>=2097152&&++i;var o=t.next(i);a<=127?o.write_shift(1,a):(o.write_shift(1,(a&127)+128),o.write_shift(1,a>>7));for(var c=0;c!=4;++c)if(s>=128)o.write_shift(1,(s&127)+128),s>>=7;else{o.write_shift(1,s);break}s>0&&is_buf(e)&&t.push(e)}}function shift_cell_xls(t,r,e){var s=dup(t);if(r.s?(s.cRel&&(s.c+=r.s.c),s.rRel&&(s.r+=r.s.r)):(s.cRel&&(s.c+=r.c),s.rRel&&(s.r+=r.r)),!e||e.biff<12){for(;s.c>=256;)s.c-=256;for(;s.r>=65536;)s.r-=65536}return s}function shift_range_xls(t,r,e){var s=dup(t);return s.s=shift_cell_xls(s.s,r.s,e),s.e=shift_cell_xls(s.e,r.s,e),s}function encode_cell_xls(t,r){if(t.cRel&&t.c<0)for(t=dup(t);t.c<0;)t.c+=r>8?16384:256;if(t.rRel&&t.r<0)for(t=dup(t);t.r<0;)t.r+=r>8?1048576:r>5?65536:16384;var e=encode_cell(t);return!t.cRel&&t.cRel!=null&&(e=fix_col(e)),!t.rRel&&t.rRel!=null&&(e=fix_row(e)),e}function encode_range_xls(t,r){return t.s.r==0&&!t.s.rRel&&t.e.r==(r.biff>=12?1048575:r.biff>=8?65536:16384)&&!t.e.rRel?(t.s.cRel?"":"$")+encode_col(t.s.c)+":"+(t.e.cRel?"":"$")+encode_col(t.e.c):t.s.c==0&&!t.s.cRel&&t.e.c==(r.biff>=12?16383:255)&&!t.e.cRel?(t.s.rRel?"":"$")+encode_row(t.s.r)+":"+(t.e.rRel?"":"$")+encode_row(t.e.r):encode_cell_xls(t.s,r.biff)+":"+encode_cell_xls(t.e,r.biff)}function decode_row(t){return parseInt(unfix_row(t),10)-1}function encode_row(t){return""+(t+1)}function fix_row(t){return t.replace(/([A-Z]|^)(\d+)$/,"$1$$$2")}function unfix_row(t){return t.replace(/\$(\d+)$/,"$1")}function decode_col(t){for(var r=unfix_col(t),e=0,s=0;s!==r.length;++s)e=26*e+r.charCodeAt(s)-64;return e-1}function encode_col(t){if(t<0)throw new Error("invalid column "+t);var r="";for(++t;t;t=Math.floor((t-1)/26))r=String.fromCharCode((t-1)%26+65)+r;return r}function fix_col(t){return t.replace(/^([A-Z])/,"$$$1")}function unfix_col(t){return t.replace(/^\$([A-Z])/,"$1")}function split_cell(t){return t.replace(/(\$?[A-Z]*)(\$?\d*)/,"$1,$2").split(",")}function decode_cell(t){for(var r=0,e=0,s=0;s<t.length;++s){var a=t.charCodeAt(s);a>=48&&a<=57?r=10*r+(a-48):a>=65&&a<=90&&(e=26*e+(a-64))}return{c:e-1,r:r-1}}function encode_cell(t){for(var r=t.c+1,e="";r;r=(r-1)/26|0)e=String.fromCharCode((r-1)%26+65)+e;return e+(t.r+1)}function decode_range(t){var r=t.indexOf(":");return r==-1?{s:decode_cell(t),e:decode_cell(t)}:{s:decode_cell(t.slice(0,r)),e:decode_cell(t.slice(r+1))}}function encode_range(t,r){return typeof r>"u"||typeof r=="number"?encode_range(t.s,t.e):(typeof t!="string"&&(t=encode_cell(t)),typeof r!="string"&&(r=encode_cell(r)),t==r?t:t+":"+r)}function safe_decode_range(t){var r={s:{c:0,r:0},e:{c:0,r:0}},e=0,s=0,a=0,i=t.length;for(e=0;s<i&&!((a=t.charCodeAt(s)-64)<1||a>26);++s)e=26*e+a;for(r.s.c=--e,e=0;s<i&&!((a=t.charCodeAt(s)-48)<0||a>9);++s)e=10*e+a;if(r.s.r=--e,s===i||a!=10)return r.e.c=r.s.c,r.e.r=r.s.r,r;for(++s,e=0;s!=i&&!((a=t.charCodeAt(s)-64)<1||a>26);++s)e=26*e+a;for(r.e.c=--e,e=0;s!=i&&!((a=t.charCodeAt(s)-48)<0||a>9);++s)e=10*e+a;return r.e.r=--e,r}function safe_format_cell(t,r){var e=t.t=="d"&&r instanceof Date;if(t.z!=null)try{return t.w=SSF_format(t.z,e?datenum(r):r)}catch{}try{return t.w=SSF_format((t.XF||{}).numFmtId||(e?14:0),e?datenum(r):r)}catch{return""+r}}function format_cell(t,r,e){return t==null||t.t==null||t.t=="z"?"":t.w!==void 0?t.w:(t.t=="d"&&!t.z&&e&&e.dateNF&&(t.z=e.dateNF),t.t=="e"?BErr[t.v]||t.v:r==null?safe_format_cell(t,t.v):safe_format_cell(t,r))}function sheet_to_workbook(t,r){var e=r&&r.sheet?r.sheet:"Sheet1",s={};return s[e]=t,{SheetNames:[e],Sheets:s}}function sheet_add_aoa(t,r,e){var s=e||{},a=t?Array.isArray(t):s.dense,i=t||(a?[]:{}),o=0,c=0;if(i&&s.origin!=null){if(typeof s.origin=="number")o=s.origin;else{var x=typeof s.origin=="string"?decode_cell(s.origin):s.origin;o=x.r,c=x.c}i["!ref"]||(i["!ref"]="A1:A1")}var u={s:{c:1e7,r:1e7},e:{c:0,r:0}};if(i["!ref"]){var h=safe_decode_range(i["!ref"]);u.s.c=h.s.c,u.s.r=h.s.r,u.e.c=Math.max(u.e.c,h.e.c),u.e.r=Math.max(u.e.r,h.e.r),o==-1&&(u.e.r=o=h.e.r+1)}for(var _=0;_!=r.length;++_)if(r[_]){if(!Array.isArray(r[_]))throw new Error("aoa_to_sheet expects an array of arrays");for(var v=0;v!=r[_].length;++v)if(!(typeof r[_][v]>"u")){var b={v:r[_][v]},E=o+_,d=c+v;if(u.s.r>E&&(u.s.r=E),u.s.c>d&&(u.s.c=d),u.e.r<E&&(u.e.r=E),u.e.c<d&&(u.e.c=d),r[_][v]&&typeof r[_][v]=="object"&&!Array.isArray(r[_][v])&&!(r[_][v]instanceof Date))b=r[_][v];else if(Array.isArray(b.v)&&(b.f=r[_][v][1],b.v=b.v[0]),b.v===null)if(b.f)b.t="n";else if(s.nullError)b.t="e",b.v=0;else if(s.sheetStubs)b.t="z";else continue;else typeof b.v=="number"?b.t="n":typeof b.v=="boolean"?b.t="b":b.v instanceof Date?(b.z=s.dateNF||table_fmt[14],s.cellDates?(b.t="d",b.w=SSF_format(b.z,datenum(b.v))):(b.t="n",b.v=datenum(b.v),b.w=SSF_format(b.z,b.v))):b.t="s";if(a)i[E]||(i[E]=[]),i[E][d]&&i[E][d].z&&(b.z=i[E][d].z),i[E][d]=b;else{var g=encode_cell({c:d,r:E});i[g]&&i[g].z&&(b.z=i[g].z),i[g]=b}}}return u.s.c<1e7&&(i["!ref"]=encode_range(u)),i}function aoa_to_sheet(t,r){return sheet_add_aoa(null,t,r)}function parse_Int32LE(t){return t.read_shift(4,"i")}function write_UInt32LE(t,r){return r||(r=new_buf(4)),r.write_shift(4,t),r}function parse_XLWideString(t){var r=t.read_shift(4);return r===0?"":t.read_shift(r,"dbcs")}function write_XLWideString(t,r){var e=!1;return r==null&&(e=!0,r=new_buf(4+2*t.length)),r.write_shift(4,t.length),t.length>0&&r.write_shift(0,t,"dbcs"),e?r.slice(0,r.l):r}function parse_StrRun(t){return{ich:t.read_shift(2),ifnt:t.read_shift(2)}}function write_StrRun(t,r){return r||(r=new_buf(4)),r.write_shift(2,0),r.write_shift(2,0),r}function parse_RichStr(t,r){var e=t.l,s=t.read_shift(1),a=parse_XLWideString(t),i=[],o={t:a,h:a};if(s&1){for(var c=t.read_shift(4),x=0;x!=c;++x)i.push(parse_StrRun(t));o.r=i}else o.r=[{ich:0,ifnt:0}];return t.l=e+r,o}function write_RichStr(t,r){var e=!1;return r==null&&(e=!0,r=new_buf(15+4*t.t.length)),r.write_shift(1,0),write_XLWideString(t.t,r),e?r.slice(0,r.l):r}var parse_BrtCommentText=parse_RichStr;function write_BrtCommentText(t,r){var e=!1;return r==null&&(e=!0,r=new_buf(23+4*t.t.length)),r.write_shift(1,1),write_XLWideString(t.t,r),r.write_shift(4,1),write_StrRun({},r),e?r.slice(0,r.l):r}function parse_XLSBCell(t){var r=t.read_shift(4),e=t.read_shift(2);return e+=t.read_shift(1)<<16,t.l++,{c:r,iStyleRef:e}}function write_XLSBCell(t,r){return r==null&&(r=new_buf(8)),r.write_shift(-4,t.c),r.write_shift(3,t.iStyleRef||t.s),r.write_shift(1,0),r}function parse_XLSBShortCell(t){var r=t.read_shift(2);return r+=t.read_shift(1)<<16,t.l++,{c:-1,iStyleRef:r}}function write_XLSBShortCell(t,r){return r==null&&(r=new_buf(4)),r.write_shift(3,t.iStyleRef||t.s),r.write_shift(1,0),r}var parse_XLSBCodeName=parse_XLWideString,write_XLSBCodeName=write_XLWideString;function parse_XLNullableWideString(t){var r=t.read_shift(4);return r===0||r===4294967295?"":t.read_shift(r,"dbcs")}function write_XLNullableWideString(t,r){var e=!1;return r==null&&(e=!0,r=new_buf(127)),r.write_shift(4,t.length>0?t.length:4294967295),t.length>0&&r.write_shift(0,t,"dbcs"),e?r.slice(0,r.l):r}var parse_XLNameWideString=parse_XLWideString,parse_RelID=parse_XLNullableWideString,write_RelID=write_XLNullableWideString;function parse_RkNumber(t){var r=t.slice(t.l,t.l+4),e=r[0]&1,s=r[0]&2;t.l+=4;var a=s===0?__double([0,0,0,0,r[0]&252,r[1],r[2],r[3]],0):__readInt32LE(r,0)>>2;return e?a/100:a}function write_RkNumber(t,r){r==null&&(r=new_buf(4));var e=0,s=0,a=t*100;if(t==(t|0)&&t>=-536870912&&t<1<<29?s=1:a==(a|0)&&a>=-536870912&&a<1<<29&&(s=1,e=1),s)r.write_shift(-4,((e?a:t)<<2)+(e+2));else throw new Error("unsupported RkNumber "+t)}function parse_RfX(t){var r={s:{},e:{}};return r.s.r=t.read_shift(4),r.e.r=t.read_shift(4),r.s.c=t.read_shift(4),r.e.c=t.read_shift(4),r}function write_RfX(t,r){return r||(r=new_buf(16)),r.write_shift(4,t.s.r),r.write_shift(4,t.e.r),r.write_shift(4,t.s.c),r.write_shift(4,t.e.c),r}var parse_UncheckedRfX=parse_RfX,write_UncheckedRfX=write_RfX;function parse_Xnum(t){if(t.length-t.l<8)throw"XLS Xnum Buffer underflow";return t.read_shift(8,"f")}function write_Xnum(t,r){return(r||new_buf(8)).write_shift(8,t,"f")}function parse_BrtColor(t){var r={},e=t.read_shift(1),s=e>>>1,a=t.read_shift(1),i=t.read_shift(2,"i"),o=t.read_shift(1),c=t.read_shift(1),x=t.read_shift(1);switch(t.l++,s){case 0:r.auto=1;break;case 1:r.index=a;var u=XLSIcv[a];u&&(r.rgb=rgb2Hex(u));break;case 2:r.rgb=rgb2Hex([o,c,x]);break;case 3:r.theme=a;break}return i!=0&&(r.tint=i>0?i/32767:i/32768),r}function write_BrtColor(t,r){if(r||(r=new_buf(8)),!t||t.auto)return r.write_shift(4,0),r.write_shift(4,0),r;t.index!=null?(r.write_shift(1,2),r.write_shift(1,t.index)):t.theme!=null?(r.write_shift(1,6),r.write_shift(1,t.theme)):(r.write_shift(1,5),r.write_shift(1,0));var e=t.tint||0;if(e>0?e*=32767:e<0&&(e*=32768),r.write_shift(2,e),!t.rgb||t.theme!=null)r.write_shift(2,0),r.write_shift(1,0),r.write_shift(1,0);else{var s=t.rgb||"FFFFFF";typeof s=="number"&&(s=("000000"+s.toString(16)).slice(-6)),r.write_shift(1,parseInt(s.slice(0,2),16)),r.write_shift(1,parseInt(s.slice(2,4),16)),r.write_shift(1,parseInt(s.slice(4,6),16)),r.write_shift(1,255)}return r}function parse_FontFlags(t){var r=t.read_shift(1);t.l++;var e={fBold:r&1,fItalic:r&2,fUnderline:r&4,fStrikeout:r&8,fOutline:r&16,fShadow:r&32,fCondense:r&64,fExtend:r&128};return e}function write_FontFlags(t,r){r||(r=new_buf(2));var e=(t.italic?2:0)|(t.strike?8:0)|(t.outline?16:0)|(t.shadow?32:0)|(t.condense?64:0)|(t.extend?128:0);return r.write_shift(1,e),r.write_shift(1,0),r}var VT_I2=2,VT_I4=3,VT_BOOL=11,VT_UI4=19,VT_FILETIME=64,VT_BLOB=65,VT_CF=71,VT_VECTOR_VARIANT=4108,VT_VECTOR_LPSTR=4126,VT_STRING=80,DocSummaryPIDDSI={1:{n:"CodePage",t:VT_I2},2:{n:"Category",t:VT_STRING},3:{n:"PresentationFormat",t:VT_STRING},4:{n:"ByteCount",t:VT_I4},5:{n:"LineCount",t:VT_I4},6:{n:"ParagraphCount",t:VT_I4},7:{n:"SlideCount",t:VT_I4},8:{n:"NoteCount",t:VT_I4},9:{n:"HiddenCount",t:VT_I4},10:{n:"MultimediaClipCount",t:VT_I4},11:{n:"ScaleCrop",t:VT_BOOL},12:{n:"HeadingPairs",t:VT_VECTOR_VARIANT},13:{n:"TitlesOfParts",t:VT_VECTOR_LPSTR},14:{n:"Manager",t:VT_STRING},15:{n:"Company",t:VT_STRING},16:{n:"LinksUpToDate",t:VT_BOOL},17:{n:"CharacterCount",t:VT_I4},19:{n:"SharedDoc",t:VT_BOOL},22:{n:"HyperlinksChanged",t:VT_BOOL},23:{n:"AppVersion",t:VT_I4,p:"version"},24:{n:"DigSig",t:VT_BLOB},26:{n:"ContentType",t:VT_STRING},27:{n:"ContentStatus",t:VT_STRING},28:{n:"Language",t:VT_STRING},29:{n:"Version",t:VT_STRING},255:{},2147483648:{n:"Locale",t:VT_UI4},2147483651:{n:"Behavior",t:VT_UI4},1919054434:{}},SummaryPIDSI={1:{n:"CodePage",t:VT_I2},2:{n:"Title",t:VT_STRING},3:{n:"Subject",t:VT_STRING},4:{n:"Author",t:VT_STRING},5:{n:"Keywords",t:VT_STRING},6:{n:"Comments",t:VT_STRING},7:{n:"Template",t:VT_STRING},8:{n:"LastAuthor",t:VT_STRING},9:{n:"RevNumber",t:VT_STRING},10:{n:"EditTime",t:VT_FILETIME},11:{n:"LastPrinted",t:VT_FILETIME},12:{n:"CreatedDate",t:VT_FILETIME},13:{n:"ModifiedDate",t:VT_FILETIME},14:{n:"PageCount",t:VT_I4},15:{n:"WordCount",t:VT_I4},16:{n:"CharCount",t:VT_I4},17:{n:"Thumbnail",t:VT_CF},18:{n:"Application",t:VT_STRING},19:{n:"DocSecurity",t:VT_I4},255:{},2147483648:{n:"Locale",t:VT_UI4},2147483651:{n:"Behavior",t:VT_UI4},1919054434:{}};function rgbify(t){return t.map(function(r){return[r>>16&255,r>>8&255,r&255]})}var _XLSIcv=rgbify([0,16777215,16711680,65280,255,16776960,16711935,65535,0,16777215,16711680,65280,255,16776960,16711935,65535,8388608,32768,128,8421376,8388736,32896,12632256,8421504,10066431,10040166,16777164,13434879,6684774,16744576,26316,13421823,128,16711935,16776960,65535,8388736,8388608,32896,255,52479,13434879,13434828,16777113,10079487,16751052,13408767,16764057,3368703,3394764,10079232,16763904,16750848,16737792,6710937,9868950,13158,3381606,13056,3355392,10040064,10040166,3355545,3355443,16777215,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),XLSIcv=dup(_XLSIcv),BErr={0:"#NULL!",7:"#DIV/0!",15:"#VALUE!",23:"#REF!",29:"#NAME?",36:"#NUM!",42:"#N/A",43:"#GETTING_DATA",255:"#WTF?"},ct2type={"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml":"workbooks","application/vnd.ms-excel.sheet.macroEnabled.main+xml":"workbooks","application/vnd.ms-excel.sheet.binary.macroEnabled.main":"workbooks","application/vnd.ms-excel.addin.macroEnabled.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml":"sheets","application/vnd.ms-excel.worksheet":"sheets","application/vnd.ms-excel.binIndexWs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml":"charts","application/vnd.ms-excel.chartsheet":"charts","application/vnd.ms-excel.macrosheet+xml":"macros","application/vnd.ms-excel.macrosheet":"macros","application/vnd.ms-excel.intlmacrosheet":"TODO","application/vnd.ms-excel.binIndexMs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml":"dialogs","application/vnd.ms-excel.dialogsheet":"dialogs","application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml":"strs","application/vnd.ms-excel.sharedStrings":"strs","application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml":"styles","application/vnd.ms-excel.styles":"styles","application/vnd.openxmlformats-package.core-properties+xml":"coreprops","application/vnd.openxmlformats-officedocument.custom-properties+xml":"custprops","application/vnd.openxmlformats-officedocument.extended-properties+xml":"extprops","application/vnd.openxmlformats-officedocument.customXmlProperties+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.customProperty":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml":"comments","application/vnd.ms-excel.comments":"comments","application/vnd.ms-excel.threadedcomments+xml":"threadedcomments","application/vnd.ms-excel.person+xml":"people","application/vnd.openxmlformats-officedocument.spreadsheetml.sheetMetadata+xml":"metadata","application/vnd.ms-excel.sheetMetadata":"metadata","application/vnd.ms-excel.pivotTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotTable+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.chart+xml":"TODO","application/vnd.ms-office.chartcolorstyle+xml":"TODO","application/vnd.ms-office.chartstyle+xml":"TODO","application/vnd.ms-office.chartex+xml":"TODO","application/vnd.ms-excel.calcChain":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.calcChain+xml":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.printerSettings":"TODO","application/vnd.ms-office.activeX":"TODO","application/vnd.ms-office.activeX+xml":"TODO","application/vnd.ms-excel.attachedToolbars":"TODO","application/vnd.ms-excel.connections":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.connections+xml":"TODO","application/vnd.ms-excel.externalLink":"links","application/vnd.openxmlformats-officedocument.spreadsheetml.externalLink+xml":"links","application/vnd.ms-excel.pivotCacheDefinition":"TODO","application/vnd.ms-excel.pivotCacheRecords":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheDefinition+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheRecords+xml":"TODO","application/vnd.ms-excel.queryTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.queryTable+xml":"TODO","application/vnd.ms-excel.userNames":"TODO","application/vnd.ms-excel.revisionHeaders":"TODO","application/vnd.ms-excel.revisionLog":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionHeaders+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionLog+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.userNames+xml":"TODO","application/vnd.ms-excel.tableSingleCells":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.tableSingleCells+xml":"TODO","application/vnd.ms-excel.slicer":"TODO","application/vnd.ms-excel.slicerCache":"TODO","application/vnd.ms-excel.slicer+xml":"TODO","application/vnd.ms-excel.slicerCache+xml":"TODO","application/vnd.ms-excel.wsSortMap":"TODO","application/vnd.ms-excel.table":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.table+xml":"TODO","application/vnd.openxmlformats-officedocument.theme+xml":"themes","application/vnd.openxmlformats-officedocument.themeOverride+xml":"TODO","application/vnd.ms-excel.Timeline+xml":"TODO","application/vnd.ms-excel.TimelineCache+xml":"TODO","application/vnd.ms-office.vbaProject":"vba","application/vnd.ms-office.vbaProjectSignature":"TODO","application/vnd.ms-office.volatileDependencies":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.volatileDependencies+xml":"TODO","application/vnd.ms-excel.controlproperties+xml":"TODO","application/vnd.openxmlformats-officedocument.model+data":"TODO","application/vnd.ms-excel.Survey+xml":"TODO","application/vnd.openxmlformats-officedocument.drawing+xml":"drawings","application/vnd.openxmlformats-officedocument.drawingml.chartshapes+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramColors+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramData+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramLayout+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramStyle+xml":"TODO","application/vnd.openxmlformats-officedocument.vmlDrawing":"TODO","application/vnd.openxmlformats-package.relationships+xml":"rels","application/vnd.openxmlformats-officedocument.oleObject":"TODO","image/png":"TODO",sheet:"js"},CT_LIST={workbooks:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml",xlsm:"application/vnd.ms-excel.sheet.macroEnabled.main+xml",xlsb:"application/vnd.ms-excel.sheet.binary.macroEnabled.main",xlam:"application/vnd.ms-excel.addin.macroEnabled.main+xml",xltx:"application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml"},strs:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml",xlsb:"application/vnd.ms-excel.sharedStrings"},comments:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml",xlsb:"application/vnd.ms-excel.comments"},sheets:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml",xlsb:"application/vnd.ms-excel.worksheet"},charts:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml",xlsb:"application/vnd.ms-excel.chartsheet"},dialogs:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml",xlsb:"application/vnd.ms-excel.dialogsheet"},macros:{xlsx:"application/vnd.ms-excel.macrosheet+xml",xlsb:"application/vnd.ms-excel.macrosheet"},metadata:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheetMetadata+xml",xlsb:"application/vnd.ms-excel.sheetMetadata"},styles:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml",xlsb:"application/vnd.ms-excel.styles"}};function new_ct(){return{workbooks:[],sheets:[],charts:[],dialogs:[],macros:[],rels:[],strs:[],comments:[],threadedcomments:[],links:[],coreprops:[],extprops:[],custprops:[],themes:[],styles:[],calcchains:[],vba:[],drawings:[],metadata:[],people:[],TODO:[],xmlns:""}}function write_ct(t,r){var e=evert_arr(ct2type),s=[],a;s[s.length]=XML_HEADER,s[s.length]=writextag("Types",null,{xmlns:XMLNS.CT,"xmlns:xsd":XMLNS.xsd,"xmlns:xsi":XMLNS.xsi}),s=s.concat([["xml","application/xml"],["bin","application/vnd.ms-excel.sheet.binary.macroEnabled.main"],["vml","application/vnd.openxmlformats-officedocument.vmlDrawing"],["data","application/vnd.openxmlformats-officedocument.model+data"],["bmp","image/bmp"],["png","image/png"],["gif","image/gif"],["emf","image/x-emf"],["wmf","image/x-wmf"],["jpg","image/jpeg"],["jpeg","image/jpeg"],["tif","image/tiff"],["tiff","image/tiff"],["pdf","application/pdf"],["rels","application/vnd.openxmlformats-package.relationships+xml"]].map(function(x){return writextag("Default",null,{Extension:x[0],ContentType:x[1]})}));var i=function(x){t[x]&&t[x].length>0&&(a=t[x][0],s[s.length]=writextag("Override",null,{PartName:(a[0]=="/"?"":"/")+a,ContentType:CT_LIST[x][r.bookType]||CT_LIST[x].xlsx}))},o=function(x){(t[x]||[]).forEach(function(u){s[s.length]=writextag("Override",null,{PartName:(u[0]=="/"?"":"/")+u,ContentType:CT_LIST[x][r.bookType]||CT_LIST[x].xlsx})})},c=function(x){(t[x]||[]).forEach(function(u){s[s.length]=writextag("Override",null,{PartName:(u[0]=="/"?"":"/")+u,ContentType:e[x][0]})})};return i("workbooks"),o("sheets"),o("charts"),c("themes"),["strs","styles"].forEach(i),["coreprops","extprops","custprops"].forEach(c),c("vba"),c("comments"),c("threadedcomments"),c("drawings"),o("metadata"),c("people"),s.length>2&&(s[s.length]="</Types>",s[1]=s[1].replace("/>",">")),s.join("")}var RELS={WB:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument",HLINK:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/hyperlink",VML:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/vmlDrawing",XPATH:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/externalLinkPath",XMISS:"http://schemas.microsoft.com/office/2006/relationships/xlExternalLinkPath/xlPathMissing",CMNT:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/comments",CORE_PROPS:"http://schemas.openxmlformats.org/package/2006/relationships/metadata/core-properties",EXT_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/extended-properties",CUST_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/custom-properties",SST:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sharedStrings",STY:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles",THEME:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/theme",WS:["http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet","http://purl.oclc.org/ooxml/officeDocument/relationships/worksheet"],DRAW:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/drawing",XLMETA:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sheetMetadata",TCMNT:"http://schemas.microsoft.com/office/2017/10/relationships/threadedComment",PEOPLE:"http://schemas.microsoft.com/office/2017/10/relationships/person",VBA:"http://schemas.microsoft.com/office/2006/relationships/vbaProject"};function get_rels_path(t){var r=t.lastIndexOf("/");return t.slice(0,r+1)+"_rels/"+t.slice(r+1)+".rels"}function write_rels(t){var r=[XML_HEADER,writextag("Relationships",null,{xmlns:XMLNS.RELS})];return keys(t["!id"]).forEach(function(e){r[r.length]=writextag("Relationship",null,t["!id"][e])}),r.length>2&&(r[r.length]="</Relationships>",r[1]=r[1].replace("/>",">")),r.join("")}function add_rels(t,r,e,s,a,i){if(a||(a={}),t["!id"]||(t["!id"]={}),t["!idx"]||(t["!idx"]=1),r<0)for(r=t["!idx"];t["!id"]["rId"+r];++r);if(t["!idx"]=r+1,a.Id="rId"+r,a.Type=s,a.Target=e,[RELS.HLINK,RELS.XPATH,RELS.XMISS].indexOf(a.Type)>-1&&(a.TargetMode="External"),t["!id"][a.Id])throw new Error("Cannot rewrite rId "+r);return t["!id"][a.Id]=a,t[("/"+a.Target).replace("//","/")]=a,r}function write_manifest(t){var r=[XML_HEADER];r.push(`<manifest:manifest xmlns:manifest="urn:oasis:names:tc:opendocument:xmlns:manifest:1.0" manifest:version="1.2">
`),r.push(`  <manifest:file-entry manifest:full-path="/" manifest:version="1.2" manifest:media-type="application/vnd.oasis.opendocument.spreadsheet"/>
`);for(var e=0;e<t.length;++e)r.push('  <manifest:file-entry manifest:full-path="'+t[e][0]+'" manifest:media-type="'+t[e][1]+`"/>
`);return r.push("</manifest:manifest>"),r.join("")}function write_rdf_type(t,r,e){return['  <rdf:Description rdf:about="'+t+`">
`,'    <rdf:type rdf:resource="http://docs.oasis-open.org/ns/office/1.2/meta/'+(e||"odf")+"#"+r+`"/>
`,`  </rdf:Description>
`].join("")}function write_rdf_has(t,r){return['  <rdf:Description rdf:about="'+t+`">
`,'    <ns0:hasPart xmlns:ns0="http://docs.oasis-open.org/ns/office/1.2/meta/pkg#" rdf:resource="'+r+`"/>
`,`  </rdf:Description>
`].join("")}function write_rdf(t){var r=[XML_HEADER];r.push(`<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
`);for(var e=0;e!=t.length;++e)r.push(write_rdf_type(t[e][0],t[e][1])),r.push(write_rdf_has("",t[e][0]));return r.push(write_rdf_type("","Document","pkg")),r.push("</rdf:RDF>"),r.join("")}function write_meta_ods(){return'<office:document-meta xmlns:office="urn:oasis:names:tc:opendocument:xmlns:office:1.0" xmlns:meta="urn:oasis:names:tc:opendocument:xmlns:meta:1.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:xlink="http://www.w3.org/1999/xlink" office:version="1.2"><office:meta><meta:generator>SheetJS '+XLSX.version+"</meta:generator></office:meta></office:document-meta>"}var CORE_PROPS=[["cp:category","Category"],["cp:contentStatus","ContentStatus"],["cp:keywords","Keywords"],["cp:lastModifiedBy","LastAuthor"],["cp:lastPrinted","LastPrinted"],["cp:revision","RevNumber"],["cp:version","Version"],["dc:creator","Author"],["dc:description","Comments"],["dc:identifier","Identifier"],["dc:language","Language"],["dc:subject","Subject"],["dc:title","Title"],["dcterms:created","CreatedDate","date"],["dcterms:modified","ModifiedDate","date"]];function cp_doit(t,r,e,s,a){a[t]!=null||r==null||r===""||(a[t]=r,r=escapexml(r),s[s.length]=e?writextag(t,r,e):writetag(t,r))}function write_core_props(t,r){var e=r||{},s=[XML_HEADER,writextag("cp:coreProperties",null,{"xmlns:cp":XMLNS.CORE_PROPS,"xmlns:dc":XMLNS.dc,"xmlns:dcterms":XMLNS.dcterms,"xmlns:dcmitype":XMLNS.dcmitype,"xmlns:xsi":XMLNS.xsi})],a={};if(!t&&!e.Props)return s.join("");t&&(t.CreatedDate!=null&&cp_doit("dcterms:created",typeof t.CreatedDate=="string"?t.CreatedDate:write_w3cdtf(t.CreatedDate,e.WTF),{"xsi:type":"dcterms:W3CDTF"},s,a),t.ModifiedDate!=null&&cp_doit("dcterms:modified",typeof t.ModifiedDate=="string"?t.ModifiedDate:write_w3cdtf(t.ModifiedDate,e.WTF),{"xsi:type":"dcterms:W3CDTF"},s,a));for(var i=0;i!=CORE_PROPS.length;++i){var o=CORE_PROPS[i],c=e.Props&&e.Props[o[1]]!=null?e.Props[o[1]]:t?t[o[1]]:null;c===!0?c="1":c===!1?c="0":typeof c=="number"&&(c=String(c)),c!=null&&cp_doit(o[0],c,null,s,a)}return s.length>2&&(s[s.length]="</cp:coreProperties>",s[1]=s[1].replace("/>",">")),s.join("")}var EXT_PROPS=[["Application","Application","string"],["AppVersion","AppVersion","string"],["Company","Company","string"],["DocSecurity","DocSecurity","string"],["Manager","Manager","string"],["HyperlinksChanged","HyperlinksChanged","bool"],["SharedDoc","SharedDoc","bool"],["LinksUpToDate","LinksUpToDate","bool"],["ScaleCrop","ScaleCrop","bool"],["HeadingPairs","HeadingPairs","raw"],["TitlesOfParts","TitlesOfParts","raw"]],PseudoPropsPairs=["Worksheets","SheetNames","NamedRanges","DefinedNames","Chartsheets","ChartNames"];function write_ext_props(t){var r=[],e=writextag;return t||(t={}),t.Application="SheetJS",r[r.length]=XML_HEADER,r[r.length]=writextag("Properties",null,{xmlns:XMLNS.EXT_PROPS,"xmlns:vt":XMLNS.vt}),EXT_PROPS.forEach(function(s){if(t[s[1]]!==void 0){var a;switch(s[2]){case"string":a=escapexml(String(t[s[1]]));break;case"bool":a=t[s[1]]?"true":"false";break}a!==void 0&&(r[r.length]=e(s[0],a))}}),r[r.length]=e("HeadingPairs",e("vt:vector",e("vt:variant","<vt:lpstr>Worksheets</vt:lpstr>")+e("vt:variant",e("vt:i4",String(t.Worksheets))),{size:2,baseType:"variant"})),r[r.length]=e("TitlesOfParts",e("vt:vector",t.SheetNames.map(function(s){return"<vt:lpstr>"+escapexml(s)+"</vt:lpstr>"}).join(""),{size:t.Worksheets,baseType:"lpstr"})),r.length>2&&(r[r.length]="</Properties>",r[1]=r[1].replace("/>",">")),r.join("")}function write_cust_props(t){var r=[XML_HEADER,writextag("Properties",null,{xmlns:XMLNS.CUST_PROPS,"xmlns:vt":XMLNS.vt})];if(!t)return r.join("");var e=1;return keys(t).forEach(function(a){++e,r[r.length]=writextag("property",write_vt(t[a]),{fmtid:"{D5CDD505-2E9C-101B-9397-08002B2CF9AE}",pid:e,name:escapexml(a)})}),r.length>2&&(r[r.length]="</Properties>",r[1]=r[1].replace("/>",">")),r.join("")}var XLMLDocPropsMap={Title:"Title",Subject:"Subject",Author:"Author",Keywords:"Keywords",Comments:"Description",LastAuthor:"LastAuthor",RevNumber:"Revision",Application:"AppName",LastPrinted:"LastPrinted",CreatedDate:"Created",ModifiedDate:"LastSaved",Category:"Category",Manager:"Manager",Company:"Company",AppVersion:"Version",ContentStatus:"ContentStatus",Identifier:"Identifier",Language:"Language"};function xlml_write_docprops(t,r){var e=[];return keys(XLMLDocPropsMap).map(function(s){for(var a=0;a<CORE_PROPS.length;++a)if(CORE_PROPS[a][1]==s)return CORE_PROPS[a];for(a=0;a<EXT_PROPS.length;++a)if(EXT_PROPS[a][1]==s)return EXT_PROPS[a];throw s}).forEach(function(s){if(t[s[1]]!=null){var a=r&&r.Props&&r.Props[s[1]]!=null?r.Props[s[1]]:t[s[1]];switch(s[2]){case"date":a=new Date(a).toISOString().replace(/\.\d*Z/,"Z");break}typeof a=="number"?a=String(a):a===!0||a===!1?a=a?"1":"0":a instanceof Date&&(a=new Date(a).toISOString().replace(/\.\d*Z/,"")),e.push(writetag(XLMLDocPropsMap[s[1]]||s[1],a))}}),writextag("DocumentProperties",e.join(""),{xmlns:XLMLNS.o})}function xlml_write_custprops(t,r){var e=["Worksheets","SheetNames"],s="CustomDocumentProperties",a=[];return t&&keys(t).forEach(function(i){if(Object.prototype.hasOwnProperty.call(t,i)){for(var o=0;o<CORE_PROPS.length;++o)if(i==CORE_PROPS[o][1])return;for(o=0;o<EXT_PROPS.length;++o)if(i==EXT_PROPS[o][1])return;for(o=0;o<e.length;++o)if(i==e[o])return;var c=t[i],x="string";typeof c=="number"?(x="float",c=String(c)):c===!0||c===!1?(x="boolean",c=c?"1":"0"):c=String(c),a.push(writextag(escapexmltag(i),c,{"dt:dt":x}))}}),r&&keys(r).forEach(function(i){if(Object.prototype.hasOwnProperty.call(r,i)&&!(t&&Object.prototype.hasOwnProperty.call(t,i))){var o=r[i],c="string";typeof o=="number"?(c="float",o=String(o)):o===!0||o===!1?(c="boolean",o=o?"1":"0"):o instanceof Date?(c="dateTime.tz",o=o.toISOString()):o=String(o),a.push(writextag(escapexmltag(i),o,{"dt:dt":c}))}}),"<"+s+' xmlns="'+XLMLNS.o+'">'+a.join("")+"</"+s+">"}function write_FILETIME(t){var r=typeof t=="string"?new Date(Date.parse(t)):t,e=r.getTime()/1e3+11644473600,s=e%Math.pow(2,32),a=(e-s)/Math.pow(2,32);s*=1e7,a*=1e7;var i=s/Math.pow(2,32)|0;i>0&&(s=s%Math.pow(2,32),a+=i);var o=new_buf(8);return o.write_shift(4,s),o.write_shift(4,a),o}function write_TypedPropertyValue(t,r){var e=new_buf(4),s=new_buf(4);switch(e.write_shift(4,t==80?31:t),t){case 3:s.write_shift(-4,r);break;case 5:s=new_buf(8),s.write_shift(8,r,"f");break;case 11:s.write_shift(4,r?1:0);break;case 64:s=write_FILETIME(r);break;case 31:case 80:for(s=new_buf(4+2*(r.length+1)+(r.length%2?0:2)),s.write_shift(4,r.length+1),s.write_shift(0,r,"dbcs");s.l!=s.length;)s.write_shift(1,0);break;default:throw new Error("TypedPropertyValue unrecognized type "+t+" "+r)}return bconcat([e,s])}var XLSPSSkip=["CodePage","Thumbnail","_PID_LINKBASE","_PID_HLINKS","SystemIdentifier","FMTID"];function guess_property_type(t){switch(typeof t){case"boolean":return 11;case"number":return(t|0)==t?3:5;case"string":return 31;case"object":if(t instanceof Date)return 64;break}return-1}function write_PropertySet(t,r,e){var s=new_buf(8),a=[],i=[],o=8,c=0,x=new_buf(8),u=new_buf(8);if(x.write_shift(4,2),x.write_shift(4,1200),u.write_shift(4,1),i.push(x),a.push(u),o+=8+x.length,!r){u=new_buf(8),u.write_shift(4,0),a.unshift(u);var h=[new_buf(4)];for(h[0].write_shift(4,t.length),c=0;c<t.length;++c){var _=t[c][0];for(x=new_buf(8+2*(_.length+1)+(_.length%2?0:2)),x.write_shift(4,c+2),x.write_shift(4,_.length+1),x.write_shift(0,_,"dbcs");x.l!=x.length;)x.write_shift(1,0);h.push(x)}x=bconcat(h),i.unshift(x),o+=8+x.length}for(c=0;c<t.length;++c)if(!(r&&!r[t[c][0]])&&!(XLSPSSkip.indexOf(t[c][0])>-1||PseudoPropsPairs.indexOf(t[c][0])>-1)&&t[c][1]!=null){var v=t[c][1],b=0;if(r){b=+r[t[c][0]];var E=e[b];if(E.p=="version"&&typeof v=="string"){var d=v.split(".");v=(+d[0]<<16)+(+d[1]||0)}x=write_TypedPropertyValue(E.t,v)}else{var g=guess_property_type(v);g==-1&&(g=31,v=String(v)),x=write_TypedPropertyValue(g,v)}i.push(x),u=new_buf(8),u.write_shift(4,r?b:2+c),a.push(u),o+=8+x.length}var y=8*(i.length+1);for(c=0;c<i.length;++c)a[c].write_shift(4,y),y+=i[c].length;return s.write_shift(4,o),s.write_shift(4,i.length),bconcat([s].concat(a).concat(i))}function write_PropertySetStream(t,r,e,s,a,i){var o=new_buf(a?68:48),c=[o];o.write_shift(2,65534),o.write_shift(2,0),o.write_shift(4,842412599),o.write_shift(16,CFB.utils.consts.HEADER_CLSID,"hex"),o.write_shift(4,a?2:1),o.write_shift(16,r,"hex"),o.write_shift(4,a?68:48);var x=write_PropertySet(t,e,s);if(c.push(x),a){var u=write_PropertySet(a,null,null);o.write_shift(16,i,"hex"),o.write_shift(4,68+x.length),c.push(u)}return bconcat(c)}function writezeroes(t,r){r||(r=new_buf(t));for(var e=0;e<t;++e)r.write_shift(1,0);return r}function parsebool(t,r){return t.read_shift(r)===1}function writebool(t,r){return r||(r=new_buf(2)),r.write_shift(2,+!!t),r}function parseuint16(t){return t.read_shift(2,"u")}function writeuint16(t,r){return r||(r=new_buf(2)),r.write_shift(2,t),r}function write_Bes(t,r,e){return e||(e=new_buf(2)),e.write_shift(1,r=="e"?+t:+!!t),e.write_shift(1,r=="e"?1:0),e}function parse_ShortXLUnicodeString(t,r,e){var s=t.read_shift(e&&e.biff>=12?2:1),a="sbcs-cont";if(e&&e.biff>=8,!e||e.biff==8){var i=t.read_shift(1);i&&(a="dbcs-cont")}else e.biff==12&&(a="wstr");e.biff>=2&&e.biff<=5&&(a="cpstr");var o=s?t.read_shift(s,a):"";return o}function write_XLUnicodeRichExtendedString(t){var r=t.t||"",e=new_buf(3);e.write_shift(2,r.length),e.write_shift(1,1);var s=new_buf(2*r.length);s.write_shift(2*r.length,r,"utf16le");var a=[e,s];return bconcat(a)}function parse_XLUnicodeStringNoCch(t,r,e){var s;if(e){if(e.biff>=2&&e.biff<=5)return t.read_shift(r,"cpstr");if(e.biff>=12)return t.read_shift(r,"dbcs-cont")}var a=t.read_shift(1);return a===0?s=t.read_shift(r,"sbcs-cont"):s=t.read_shift(r,"dbcs-cont"),s}function parse_XLUnicodeString(t,r,e){var s=t.read_shift(e&&e.biff==2?1:2);return s===0?(t.l++,""):parse_XLUnicodeStringNoCch(t,s,e)}function parse_XLUnicodeString2(t,r,e){if(e.biff>5)return parse_XLUnicodeString(t,r,e);var s=t.read_shift(1);return s===0?(t.l++,""):t.read_shift(s,e.biff<=4||!t.lens?"cpstr":"sbcs-cont")}function write_XLUnicodeString(t,r,e){return e||(e=new_buf(3+2*t.length)),e.write_shift(2,t.length),e.write_shift(1,1),e.write_shift(31,t,"utf16le"),e}function write_HyperlinkString(t,r){r||(r=new_buf(6+t.length*2)),r.write_shift(4,1+t.length);for(var e=0;e<t.length;++e)r.write_shift(2,t.charCodeAt(e));return r.write_shift(2,0),r}function write_Hyperlink(t){var r=new_buf(512),e=0,s=t.Target;s.slice(0,7)=="file://"&&(s=s.slice(7));var a=s.indexOf("#"),i=a>-1?31:23;switch(s.charAt(0)){case"#":i=28;break;case".":i&=-3;break}r.write_shift(4,2),r.write_shift(4,i);var o=[8,6815827,6619237,4849780,83];for(e=0;e<o.length;++e)r.write_shift(4,o[e]);if(i==28)s=s.slice(1),write_HyperlinkString(s,r);else if(i&2){for(o="e0 c9 ea 79 f9 ba ce 11 8c 82 00 aa 00 4b a9 0b".split(" "),e=0;e<o.length;++e)r.write_shift(1,parseInt(o[e],16));var c=a>-1?s.slice(0,a):s;for(r.write_shift(4,2*(c.length+1)),e=0;e<c.length;++e)r.write_shift(2,c.charCodeAt(e));r.write_shift(2,0),i&8&&write_HyperlinkString(a>-1?s.slice(a+1):"",r)}else{for(o="03 03 00 00 00 00 00 00 c0 00 00 00 00 00 00 46".split(" "),e=0;e<o.length;++e)r.write_shift(1,parseInt(o[e],16));for(var x=0;s.slice(x*3,x*3+3)=="../"||s.slice(x*3,x*3+3)=="..\\";)++x;for(r.write_shift(2,x),r.write_shift(4,s.length-3*x+1),e=0;e<s.length-3*x;++e)r.write_shift(1,s.charCodeAt(e+3*x)&255);for(r.write_shift(1,0),r.write_shift(2,65535),r.write_shift(2,57005),e=0;e<6;++e)r.write_shift(4,0)}return r.slice(0,r.l)}function write_XLSCell(t,r,e,s){return s||(s=new_buf(6)),s.write_shift(2,t),s.write_shift(2,r),s.write_shift(2,e||0),s}function parse_XTI(t,r,e){var s=e.biff>8?4:2,a=t.read_shift(s),i=t.read_shift(s,"i"),o=t.read_shift(s,"i");return[a,i,o]}function parse_Ref8U(t){var r=t.read_shift(2),e=t.read_shift(2),s=t.read_shift(2),a=t.read_shift(2);return{s:{c:s,r},e:{c:a,r:e}}}function write_Ref8U(t,r){return r||(r=new_buf(8)),r.write_shift(2,t.s.r),r.write_shift(2,t.e.r),r.write_shift(2,t.s.c),r.write_shift(2,t.e.c),r}function write_BOF(t,r,e){var s=1536,a=16;switch(e.bookType){case"biff8":break;case"biff5":s=1280,a=8;break;case"biff4":s=4,a=6;break;case"biff3":s=3,a=6;break;case"biff2":s=2,a=4;break;case"xla":break;default:throw new Error("unsupported BIFF version")}var i=new_buf(a);return i.write_shift(2,s),i.write_shift(2,r),a>4&&i.write_shift(2,29282),a>6&&i.write_shift(2,1997),a>8&&(i.write_shift(2,49161),i.write_shift(2,1),i.write_shift(2,1798),i.write_shift(2,0)),i}function write_WriteAccess(t,r){var e=!r||r.biff==8,s=new_buf(e?112:54);for(s.write_shift(r.biff==8?2:1,7),e&&s.write_shift(1,0),s.write_shift(4,859007059),s.write_shift(4,5458548|(e?0:536870912));s.l<s.length;)s.write_shift(1,e?0:32);return s}function write_BoundSheet8(t,r){var e=!r||r.biff>=8?2:1,s=new_buf(8+e*t.name.length);s.write_shift(4,t.pos),s.write_shift(1,t.hs||0),s.write_shift(1,t.dt),s.write_shift(1,t.name.length),r.biff>=8&&s.write_shift(1,1),s.write_shift(e*t.name.length,t.name,r.biff<8?"sbcs":"utf16le");var a=s.slice(0,s.l);return a.l=s.l,a}function write_SST(t,r){var e=new_buf(8);e.write_shift(4,t.Count),e.write_shift(4,t.Unique);for(var s=[],a=0;a<t.length;++a)s[a]=write_XLUnicodeRichExtendedString(t[a]);var i=bconcat([e].concat(s));return i.parts=[e.length].concat(s.map(function(o){return o.length})),i}function write_Window1(){var t=new_buf(18);return t.write_shift(2,0),t.write_shift(2,0),t.write_shift(2,29280),t.write_shift(2,17600),t.write_shift(2,56),t.write_shift(2,0),t.write_shift(2,0),t.write_shift(2,1),t.write_shift(2,500),t}function write_Window2(t){var r=new_buf(18),e=1718;return t&&t.RTL&&(e|=64),r.write_shift(2,e),r.write_shift(4,0),r.write_shift(4,64),r.write_shift(4,0),r.write_shift(4,0),r}function write_Font(t,r){var e=t.name||"Arial",s=r&&r.biff==5,a=s?15+e.length:16+2*e.length,i=new_buf(a);return i.write_shift(2,t.sz*20),i.write_shift(4,0),i.write_shift(2,400),i.write_shift(4,0),i.write_shift(2,0),i.write_shift(1,e.length),s||i.write_shift(1,1),i.write_shift((s?1:2)*e.length,e,s?"sbcs":"utf16le"),i}function write_LabelSst(t,r,e,s){var a=new_buf(10);return write_XLSCell(t,r,s,a),a.write_shift(4,e),a}function write_Label(t,r,e,s,a){var i=!a||a.biff==8,o=new_buf(8+ +i+(1+i)*e.length);return write_XLSCell(t,r,s,o),o.write_shift(2,e.length),i&&o.write_shift(1,1),o.write_shift((1+i)*e.length,e,i?"utf16le":"sbcs"),o}function write_Format(t,r,e,s){var a=e&&e.biff==5;s||(s=new_buf(a?3+r.length:5+2*r.length)),s.write_shift(2,t),s.write_shift(a?1:2,r.length),a||s.write_shift(1,1),s.write_shift((a?1:2)*r.length,r,a?"sbcs":"utf16le");var i=s.length>s.l?s.slice(0,s.l):s;return i.l==null&&(i.l=i.length),i}function write_Dimensions(t,r){var e=r.biff==8||!r.biff?4:2,s=new_buf(2*e+6);return s.write_shift(e,t.s.r),s.write_shift(e,t.e.r+1),s.write_shift(2,t.s.c),s.write_shift(2,t.e.c+1),s.write_shift(2,0),s}function write_XF(t,r,e,s){var a=e&&e.biff==5;s||(s=new_buf(a?16:20)),s.write_shift(2,0),t.style?(s.write_shift(2,t.numFmtId||0),s.write_shift(2,65524)):(s.write_shift(2,t.numFmtId||0),s.write_shift(2,r<<4));var i=0;return t.numFmtId>0&&a&&(i|=1024),s.write_shift(4,i),s.write_shift(4,0),a||s.write_shift(4,0),s.write_shift(2,0),s}function write_Guts(t){var r=new_buf(8);return r.write_shift(4,0),r.write_shift(2,0),r.write_shift(2,0),r}function write_BoolErr(t,r,e,s,a,i){var o=new_buf(8);return write_XLSCell(t,r,s,o),write_Bes(e,i,o),o}function write_Number(t,r,e,s){var a=new_buf(14);return write_XLSCell(t,r,s,a),write_Xnum(e,a),a}function parse_ExternSheet(t,r,e){if(e.biff<8)return parse_BIFF5ExternSheet(t,r,e);for(var s=[],a=t.l+r,i=t.read_shift(e.biff>8?4:2);i--!==0;)s.push(parse_XTI(t,e.biff>8?12:6,e));if(t.l!=a)throw new Error("Bad ExternSheet: "+t.l+" != "+a);return s}function parse_BIFF5ExternSheet(t,r,e){t[t.l+1]==3&&t[t.l]++;var s=parse_ShortXLUnicodeString(t,r,e);return s.charCodeAt(0)==3?s.slice(1):s}function write_MergeCells(t){var r=new_buf(2+t.length*8);r.write_shift(2,t.length);for(var e=0;e<t.length;++e)write_Ref8U(t[e],r);return r}function write_HLink(t){var r=new_buf(24),e=decode_cell(t[0]);r.write_shift(2,e.r),r.write_shift(2,e.r),r.write_shift(2,e.c),r.write_shift(2,e.c);for(var s="d0 c9 ea 79 f9 ba ce 11 8c 82 00 aa 00 4b a9 0b".split(" "),a=0;a<16;++a)r.write_shift(1,parseInt(s[a],16));return bconcat([r,write_Hyperlink(t[1])])}function write_HLinkTooltip(t){var r=t[1].Tooltip,e=new_buf(10+2*(r.length+1));e.write_shift(2,2048);var s=decode_cell(t[0]);e.write_shift(2,s.r),e.write_shift(2,s.r),e.write_shift(2,s.c),e.write_shift(2,s.c);for(var a=0;a<r.length;++a)e.write_shift(2,r.charCodeAt(a));return e.write_shift(2,0),e}function write_Country(t){return t||(t=new_buf(4)),t.write_shift(2,1),t.write_shift(2,1),t}function parse_ColInfo(t,r,e){if(!e.cellStyles)return parsenoop(t,r);var s=e&&e.biff>=12?4:2,a=t.read_shift(s),i=t.read_shift(s),o=t.read_shift(s),c=t.read_shift(s),x=t.read_shift(2);s==2&&(t.l+=2);var u={s:a,e:i,w:o,ixfe:c,flags:x};return(e.biff>=5||!e.biff)&&(u.level=x>>8&7),u}function write_ColInfo(t,r){var e=new_buf(12);e.write_shift(2,r),e.write_shift(2,r),e.write_shift(2,t.width*256),e.write_shift(2,0);var s=0;return t.hidden&&(s|=1),e.write_shift(1,s),s=t.level||0,e.write_shift(1,s),e.write_shift(2,0),e}function write_RRTabId(t){for(var r=new_buf(2*t),e=0;e<t;++e)r.write_shift(2,e+1);return r}function write_BIFF2NUM(t,r,e){var s=new_buf(15);return write_BIFF2Cell(s,t,r),s.write_shift(8,e,"f"),s}function write_BIFF2INT(t,r,e){var s=new_buf(9);return write_BIFF2Cell(s,t,r),s.write_shift(2,e),s}var DBF=function(){var t={1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127,8:865,9:437,10:850,11:437,13:437,14:850,15:437,16:850,17:437,18:850,19:932,20:850,21:437,22:850,23:865,24:437,25:437,26:850,27:437,28:863,29:850,31:852,34:852,35:852,36:860,37:850,38:866,55:850,64:852,77:936,78:949,79:950,80:874,87:1252,88:1252,89:1252,108:863,134:737,135:852,136:857,204:1257,255:16969},r=evert({1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127});function e(c,x){var u=[],h=new_raw_buf(1);switch(x.type){case"base64":h=s2a(Base64_decode(c));break;case"binary":h=s2a(c);break;case"buffer":case"array":h=c;break}prep_blob(h,0);var _=h.read_shift(1),v=!!(_&136),b=!1,E=!1;switch(_){case 2:break;case 3:break;case 48:b=!0,v=!0;break;case 49:b=!0,v=!0;break;case 131:break;case 139:break;case 140:E=!0;break;case 245:break;default:throw new Error("DBF Unsupported Version: "+_.toString(16))}var d=0,g=521;_==2&&(d=h.read_shift(2)),h.l+=3,_!=2&&(d=h.read_shift(4)),d>1048576&&(d=1e6),_!=2&&(g=h.read_shift(2));var y=h.read_shift(2),R=x.codepage||1252;_!=2&&(h.l+=16,h.read_shift(1),h[h.l]!==0&&(R=t[h[h.l]]),h.l+=1,h.l+=2),E&&(h.l+=36);for(var P=[],F={},S=Math.min(h.length,_==2?521:g-10-(b?264:0)),I=E?32:11;h.l<S&&h[h.l]!=13;)switch(F={},F.name=$cptable.utils.decode(R,h.slice(h.l,h.l+I)).replace(/[\u0000\r\n].*$/g,""),h.l+=I,F.type=String.fromCharCode(h.read_shift(1)),_!=2&&!E&&(F.offset=h.read_shift(4)),F.len=h.read_shift(1),_==2&&(F.offset=h.read_shift(2)),F.dec=h.read_shift(1),F.name.length&&P.push(F),_!=2&&(h.l+=E?13:14),F.type){case"B":(!b||F.len!=8)&&x.WTF&&console.log("Skipping "+F.name+":"+F.type);break;case"G":case"P":x.WTF&&console.log("Skipping "+F.name+":"+F.type);break;case"+":case"0":case"@":case"C":case"D":case"F":case"I":case"L":case"M":case"N":case"O":case"T":case"Y":break;default:throw new Error("Unknown Field Type: "+F.type)}if(h[h.l]!==13&&(h.l=g-1),h.read_shift(1)!==13)throw new Error("DBF Terminator not found "+h.l+" "+h[h.l]);h.l=g;var w=0,j=0;for(u[0]=[],j=0;j!=P.length;++j)u[0][j]=P[j].name;for(;d-- >0;){if(h[h.l]===42){h.l+=y;continue}for(++h.l,u[++w]=[],j=0,j=0;j!=P.length;++j){var C=h.slice(h.l,h.l+P[j].len);h.l+=P[j].len,prep_blob(C,0);var V=$cptable.utils.decode(R,C);switch(P[j].type){case"C":V.trim().length&&(u[w][j]=V.replace(/\s+$/,""));break;case"D":V.length===8?u[w][j]=new Date(+V.slice(0,4),+V.slice(4,6)-1,+V.slice(6,8)):u[w][j]=V;break;case"F":u[w][j]=parseFloat(V.trim());break;case"+":case"I":u[w][j]=E?C.read_shift(-4,"i")^2147483648:C.read_shift(4,"i");break;case"L":switch(V.trim().toUpperCase()){case"Y":case"T":u[w][j]=!0;break;case"N":case"F":u[w][j]=!1;break;case"":case"?":break;default:throw new Error("DBF Unrecognized L:|"+V+"|")}break;case"M":if(!v)throw new Error("DBF Unexpected MEMO for type "+_.toString(16));u[w][j]="##MEMO##"+(E?parseInt(V.trim(),10):C.read_shift(4));break;case"N":V=V.replace(/\u0000/g,"").trim(),V&&V!="."&&(u[w][j]=+V||0);break;case"@":u[w][j]=new Date(C.read_shift(-8,"f")-621356832e5);break;case"T":u[w][j]=new Date((C.read_shift(4)-2440588)*864e5+C.read_shift(4));break;case"Y":u[w][j]=C.read_shift(4,"i")/1e4+C.read_shift(4,"i")/1e4*Math.pow(2,32);break;case"O":u[w][j]=-C.read_shift(-8,"f");break;case"B":if(b&&P[j].len==8){u[w][j]=C.read_shift(8,"f");break}case"G":case"P":C.l+=P[j].len;break;case"0":if(P[j].name==="_NullFlags")break;default:throw new Error("DBF Unsupported data type "+P[j].type)}}}if(_!=2&&h.l<h.length&&h[h.l++]!=26)throw new Error("DBF EOF Marker missing "+(h.l-1)+" of "+h.length+" "+h[h.l-1].toString(16));return x&&x.sheetRows&&(u=u.slice(0,x.sheetRows)),x.DBF=P,u}function s(c,x){var u=x||{};u.dateNF||(u.dateNF="yyyymmdd");var h=aoa_to_sheet(e(c,u),u);return h["!cols"]=u.DBF.map(function(_){return{wch:_.len,DBF:_}}),delete u.DBF,h}function a(c,x){try{return sheet_to_workbook(s(c,x),x)}catch(u){if(x&&x.WTF)throw u}return{SheetNames:[],Sheets:{}}}var i={B:8,C:250,L:1,D:8,"?":0,"":0};function o(c,x){var u=x||{};if(+u.codepage>=0&&set_cp(+u.codepage),u.type=="string")throw new Error("Cannot write DBF to JS string");var h=buf_array(),_=sheet_to_json(c,{header:1,raw:!0,cellDates:!0}),v=_[0],b=_.slice(1),E=c["!cols"]||[],d=0,g=0,y=0,R=1;for(d=0;d<v.length;++d){if(((E[d]||{}).DBF||{}).name){v[d]=E[d].DBF.name,++y;continue}if(v[d]!=null){if(++y,typeof v[d]=="number"&&(v[d]=v[d].toString(10)),typeof v[d]!="string")throw new Error("DBF Invalid column name "+v[d]+" |"+typeof v[d]+"|");if(v.indexOf(v[d])!==d){for(g=0;g<1024;++g)if(v.indexOf(v[d]+"_"+g)==-1){v[d]+="_"+g;break}}}}var P=safe_decode_range(c["!ref"]),F=[],S=[],I=[];for(d=0;d<=P.e.c-P.s.c;++d){var w="",j="",C=0,V=[];for(g=0;g<b.length;++g)b[g][d]!=null&&V.push(b[g][d]);if(V.length==0||v[d]==null){F[d]="?";continue}for(g=0;g<V.length;++g){switch(typeof V[g]){case"number":j="B";break;case"string":j="C";break;case"boolean":j="L";break;case"object":j=V[g]instanceof Date?"D":"C";break;default:j="C"}C=Math.max(C,String(V[g]).length),w=w&&w!=j?"C":j}C>250&&(C=250),j=((E[d]||{}).DBF||{}).type,j=="C"&&E[d].DBF.len>C&&(C=E[d].DBF.len),w=="B"&&j=="N"&&(w="N",I[d]=E[d].DBF.dec,C=E[d].DBF.len),S[d]=w=="C"||j=="N"?C:i[w]||0,R+=S[d],F[d]=w}var O=h.next(32);for(O.write_shift(4,318902576),O.write_shift(4,b.length),O.write_shift(2,296+32*y),O.write_shift(2,R),d=0;d<4;++d)O.write_shift(4,0);for(O.write_shift(4,0|(+r[current_ansi]||3)<<8),d=0,g=0;d<v.length;++d)if(v[d]!=null){var H=h.next(32),z=(v[d].slice(-10)+"\0\0\0\0\0\0\0\0\0\0\0").slice(0,11);H.write_shift(1,z,"sbcs"),H.write_shift(1,F[d]=="?"?"C":F[d],"sbcs"),H.write_shift(4,g),H.write_shift(1,S[d]||i[F[d]]||0),H.write_shift(1,I[d]||0),H.write_shift(1,2),H.write_shift(4,0),H.write_shift(1,0),H.write_shift(4,0),H.write_shift(4,0),g+=S[d]||i[F[d]]||0}var pe=h.next(264);for(pe.write_shift(4,13),d=0;d<65;++d)pe.write_shift(4,0);for(d=0;d<b.length;++d){var ee=h.next(R);for(ee.write_shift(1,0),g=0;g<v.length;++g)if(v[g]!=null)switch(F[g]){case"L":ee.write_shift(1,b[d][g]==null?63:b[d][g]?84:70);break;case"B":ee.write_shift(8,b[d][g]||0,"f");break;case"N":var he="0";for(typeof b[d][g]=="number"&&(he=b[d][g].toFixed(I[g]||0)),y=0;y<S[g]-he.length;++y)ee.write_shift(1,32);ee.write_shift(1,he,"sbcs");break;case"D":b[d][g]?(ee.write_shift(4,("0000"+b[d][g].getFullYear()).slice(-4),"sbcs"),ee.write_shift(2,("00"+(b[d][g].getMonth()+1)).slice(-2),"sbcs"),ee.write_shift(2,("00"+b[d][g].getDate()).slice(-2),"sbcs")):ee.write_shift(8,"00000000","sbcs");break;case"C":var re=String(b[d][g]!=null?b[d][g]:"").slice(0,S[g]);for(ee.write_shift(1,re,"sbcs"),y=0;y<S[g]-re.length;++y)ee.write_shift(1,32);break}}return h.next(1).write_shift(1,26),h.end()}return{to_workbook:a,to_sheet:s,from_sheet:o}}(),SYLK=function(){var t={AA:"À",BA:"Á",CA:"Â",DA:195,HA:"Ä",JA:197,AE:"È",BE:"É",CE:"Ê",HE:"Ë",AI:"Ì",BI:"Í",CI:"Î",HI:"Ï",AO:"Ò",BO:"Ó",CO:"Ô",DO:213,HO:"Ö",AU:"Ù",BU:"Ú",CU:"Û",HU:"Ü",Aa:"à",Ba:"á",Ca:"â",Da:227,Ha:"ä",Ja:229,Ae:"è",Be:"é",Ce:"ê",He:"ë",Ai:"ì",Bi:"í",Ci:"î",Hi:"ï",Ao:"ò",Bo:"ó",Co:"ô",Do:245,Ho:"ö",Au:"ù",Bu:"ú",Cu:"û",Hu:"ü",KC:"Ç",Kc:"ç",q:"æ",z:"œ",a:"Æ",j:"Œ",DN:209,Dn:241,Hy:255,S:169,c:170,R:174,"B ":180,0:176,1:177,2:178,3:179,5:181,6:182,7:183,Q:185,k:186,b:208,i:216,l:222,s:240,y:248,"!":161,'"':162,"#":163,"(":164,"%":165,"'":167,"H ":168,"+":171,";":187,"<":188,"=":189,">":190,"?":191,"{":223},r=new RegExp("\x1BN("+keys(t).join("|").replace(/\|\|\|/,"|\\||").replace(/([?()+])/g,"\\$1")+"|\\|)","gm"),e=function(v,b){var E=t[b];return typeof E=="number"?_getansi(E):E},s=function(v,b,E){var d=b.charCodeAt(0)-32<<4|E.charCodeAt(0)-48;return d==59?v:_getansi(d)};t["|"]=254;function a(v,b){switch(b.type){case"base64":return i(Base64_decode(v),b);case"binary":return i(v,b);case"buffer":return i(has_buf&&Buffer.isBuffer(v)?v.toString("binary"):a2s(v),b);case"array":return i(cc2str(v),b)}throw new Error("Unrecognized type "+b.type)}function i(v,b){var E=v.split(/[\n\r]+/),d=-1,g=-1,y=0,R=0,P=[],F=[],S=null,I={},w=[],j=[],C=[],V=0,O;for(+b.codepage>=0&&set_cp(+b.codepage);y!==E.length;++y){V=0;var H=E[y].trim().replace(/\x1B([\x20-\x2F])([\x30-\x3F])/g,s).replace(r,e),z=H.replace(/;;/g,"\0").split(";").map(function(A){return A.replace(/\u0000/g,";")}),pe=z[0],ee;if(H.length>0)switch(pe){case"ID":break;case"E":break;case"B":break;case"O":break;case"W":break;case"P":z[1].charAt(0)=="P"&&F.push(H.slice(3).replace(/;;/g,";"));break;case"C":var he=!1,re=!1,me=!1,te=!1,ce=-1,ye=-1;for(R=1;R<z.length;++R)switch(z[R].charAt(0)){case"A":break;case"X":g=parseInt(z[R].slice(1))-1,re=!0;break;case"Y":for(d=parseInt(z[R].slice(1))-1,re||(g=0),O=P.length;O<=d;++O)P[O]=[];break;case"K":ee=z[R].slice(1),ee.charAt(0)==='"'?ee=ee.slice(1,ee.length-1):ee==="TRUE"?ee=!0:ee==="FALSE"?ee=!1:isNaN(fuzzynum(ee))?isNaN(fuzzydate(ee).getDate())||(ee=parseDate(ee)):(ee=fuzzynum(ee),S!==null&&fmt_is_date(S)&&(ee=numdate(ee))),he=!0;break;case"E":te=!0;var L=rc_to_a1(z[R].slice(1),{r:d,c:g});P[d][g]=[P[d][g],L];break;case"S":me=!0,P[d][g]=[P[d][g],"S5S"];break;case"G":break;case"R":ce=parseInt(z[R].slice(1))-1;break;case"C":ye=parseInt(z[R].slice(1))-1;break;default:if(b&&b.WTF)throw new Error("SYLK bad record "+H)}if(he&&(P[d][g]&&P[d][g].length==2?P[d][g][0]=ee:P[d][g]=ee,S=null),me){if(te)throw new Error("SYLK shared formula cannot have own formula");var N=ce>-1&&P[ce][ye];if(!N||!N[1])throw new Error("SYLK shared formula cannot find base");P[d][g][1]=shift_formula_str(N[1],{r:d-ce,c:g-ye})}break;case"F":var T=0;for(R=1;R<z.length;++R)switch(z[R].charAt(0)){case"X":g=parseInt(z[R].slice(1))-1,++T;break;case"Y":for(d=parseInt(z[R].slice(1))-1,O=P.length;O<=d;++O)P[O]=[];break;case"M":V=parseInt(z[R].slice(1))/20;break;case"F":break;case"G":break;case"P":S=F[parseInt(z[R].slice(1))];break;case"S":break;case"D":break;case"N":break;case"W":for(C=z[R].slice(1).split(" "),O=parseInt(C[0],10);O<=parseInt(C[1],10);++O)V=parseInt(C[2],10),j[O-1]=V===0?{hidden:!0}:{wch:V},process_col(j[O-1]);break;case"C":g=parseInt(z[R].slice(1))-1,j[g]||(j[g]={});break;case"R":d=parseInt(z[R].slice(1))-1,w[d]||(w[d]={}),V>0?(w[d].hpt=V,w[d].hpx=pt2px(V)):V===0&&(w[d].hidden=!0);break;default:if(b&&b.WTF)throw new Error("SYLK bad record "+H)}T<1&&(S=null);break;default:if(b&&b.WTF)throw new Error("SYLK bad record "+H)}}return w.length>0&&(I["!rows"]=w),j.length>0&&(I["!cols"]=j),b&&b.sheetRows&&(P=P.slice(0,b.sheetRows)),[P,I]}function o(v,b){var E=a(v,b),d=E[0],g=E[1],y=aoa_to_sheet(d,b);return keys(g).forEach(function(R){y[R]=g[R]}),y}function c(v,b){return sheet_to_workbook(o(v,b),b)}function x(v,b,E,d){var g="C;Y"+(E+1)+";X"+(d+1)+";K";switch(v.t){case"n":g+=v.v||0,v.f&&!v.F&&(g+=";E"+a1_to_rc(v.f,{r:E,c:d}));break;case"b":g+=v.v?"TRUE":"FALSE";break;case"e":g+=v.w||v.v;break;case"d":g+='"'+(v.w||v.v)+'"';break;case"s":g+='"'+v.v.replace(/"/g,"").replace(/;/g,";;")+'"';break}return g}function u(v,b){b.forEach(function(E,d){var g="F;W"+(d+1)+" "+(d+1)+" ";E.hidden?g+="0":(typeof E.width=="number"&&!E.wpx&&(E.wpx=width2px(E.width)),typeof E.wpx=="number"&&!E.wch&&(E.wch=px2char(E.wpx)),typeof E.wch=="number"&&(g+=Math.round(E.wch))),g.charAt(g.length-1)!=" "&&v.push(g)})}function h(v,b){b.forEach(function(E,d){var g="F;";E.hidden?g+="M0;":E.hpt?g+="M"+20*E.hpt+";":E.hpx&&(g+="M"+20*px2pt(E.hpx)+";"),g.length>2&&v.push(g+"R"+(d+1))})}function _(v,b){var E=["ID;PWXL;N;E"],d=[],g=safe_decode_range(v["!ref"]),y,R=Array.isArray(v),P=`\r
`;E.push("P;PGeneral"),E.push("F;P0;DG0G8;M255"),v["!cols"]&&u(E,v["!cols"]),v["!rows"]&&h(E,v["!rows"]),E.push("B;Y"+(g.e.r-g.s.r+1)+";X"+(g.e.c-g.s.c+1)+";D"+[g.s.c,g.s.r,g.e.c,g.e.r].join(" "));for(var F=g.s.r;F<=g.e.r;++F)for(var S=g.s.c;S<=g.e.c;++S){var I=encode_cell({r:F,c:S});y=R?(v[F]||[])[S]:v[I],!(!y||y.v==null&&(!y.f||y.F))&&d.push(x(y,v,F,S))}return E.join(P)+P+d.join(P)+P+"E"+P}return{to_workbook:c,to_sheet:o,from_sheet:_}}(),DIF=function(){function t(i,o){switch(o.type){case"base64":return r(Base64_decode(i),o);case"binary":return r(i,o);case"buffer":return r(has_buf&&Buffer.isBuffer(i)?i.toString("binary"):a2s(i),o);case"array":return r(cc2str(i),o)}throw new Error("Unrecognized type "+o.type)}function r(i,o){for(var c=i.split(`
`),x=-1,u=-1,h=0,_=[];h!==c.length;++h){if(c[h].trim()==="BOT"){_[++x]=[],u=0;continue}if(!(x<0)){var v=c[h].trim().split(","),b=v[0],E=v[1];++h;for(var d=c[h]||"";(d.match(/["]/g)||[]).length&1&&h<c.length-1;)d+=`
`+c[++h];switch(d=d.trim(),+b){case-1:if(d==="BOT"){_[++x]=[],u=0;continue}else if(d!=="EOD")throw new Error("Unrecognized DIF special command "+d);break;case 0:d==="TRUE"?_[x][u]=!0:d==="FALSE"?_[x][u]=!1:isNaN(fuzzynum(E))?isNaN(fuzzydate(E).getDate())?_[x][u]=E:_[x][u]=parseDate(E):_[x][u]=fuzzynum(E),++u;break;case 1:d=d.slice(1,d.length-1),d=d.replace(/""/g,'"'),d&&d.match(/^=".*"$/)&&(d=d.slice(2,-1)),_[x][u++]=d!==""?d:null;break}if(d==="EOD")break}}return o&&o.sheetRows&&(_=_.slice(0,o.sheetRows)),_}function e(i,o){return aoa_to_sheet(t(i,o),o)}function s(i,o){return sheet_to_workbook(e(i,o),o)}var a=function(){var i=function(x,u,h,_,v){x.push(u),x.push(h+","+_),x.push('"'+v.replace(/"/g,'""')+'"')},o=function(x,u,h,_){x.push(u+","+h),x.push(u==1?'"'+_.replace(/"/g,'""')+'"':_)};return function(x){var u=[],h=safe_decode_range(x["!ref"]),_,v=Array.isArray(x);i(u,"TABLE",0,1,"sheetjs"),i(u,"VECTORS",0,h.e.r-h.s.r+1,""),i(u,"TUPLES",0,h.e.c-h.s.c+1,""),i(u,"DATA",0,0,"");for(var b=h.s.r;b<=h.e.r;++b){o(u,-1,0,"BOT");for(var E=h.s.c;E<=h.e.c;++E){var d=encode_cell({r:b,c:E});if(_=v?(x[b]||[])[E]:x[d],!_){o(u,1,0,"");continue}switch(_.t){case"n":var g=_.w;!g&&_.v!=null&&(g=_.v),g==null?_.f&&!_.F?o(u,1,0,"="+_.f):o(u,1,0,""):o(u,0,g,"V");break;case"b":o(u,0,_.v?1:0,_.v?"TRUE":"FALSE");break;case"s":o(u,1,0,isNaN(_.v)?_.v:'="'+_.v+'"');break;case"d":_.w||(_.w=SSF_format(_.z||table_fmt[14],datenum(parseDate(_.v)))),o(u,0,_.w,"V");break;default:o(u,1,0,"")}}}o(u,-1,0,"EOD");var y=`\r
`,R=u.join(y);return R}}();return{to_workbook:s,to_sheet:e,from_sheet:a}}(),ETH=function(){function t(_){return _.replace(/\\b/g,"\\").replace(/\\c/g,":").replace(/\\n/g,`
`)}function r(_){return _.replace(/\\/g,"\\b").replace(/:/g,"\\c").replace(/\n/g,"\\n")}function e(_,v){for(var b=_.split(`
`),E=-1,d=-1,g=0,y=[];g!==b.length;++g){var R=b[g].trim().split(":");if(R[0]==="cell"){var P=decode_cell(R[1]);if(y.length<=P.r)for(E=y.length;E<=P.r;++E)y[E]||(y[E]=[]);switch(E=P.r,d=P.c,R[2]){case"t":y[E][d]=t(R[3]);break;case"v":y[E][d]=+R[3];break;case"vtf":var F=R[R.length-1];case"vtc":switch(R[3]){case"nl":y[E][d]=!!+R[4];break;default:y[E][d]=+R[4];break}R[2]=="vtf"&&(y[E][d]=[y[E][d],F])}}}return v&&v.sheetRows&&(y=y.slice(0,v.sheetRows)),y}function s(_,v){return aoa_to_sheet(e(_,v),v)}function a(_,v){return sheet_to_workbook(s(_,v),v)}var i=["socialcalc:version:1.5","MIME-Version: 1.0","Content-Type: multipart/mixed; boundary=SocialCalcSpreadsheetControlSave"].join(`
`),o=["--SocialCalcSpreadsheetControlSave","Content-type: text/plain; charset=UTF-8"].join(`
`)+`
`,c=["# SocialCalc Spreadsheet Control Save","part:sheet"].join(`
`),x="--SocialCalcSpreadsheetControlSave--";function u(_){if(!_||!_["!ref"])return"";for(var v=[],b=[],E,d="",g=decode_range(_["!ref"]),y=Array.isArray(_),R=g.s.r;R<=g.e.r;++R)for(var P=g.s.c;P<=g.e.c;++P)if(d=encode_cell({r:R,c:P}),E=y?(_[R]||[])[P]:_[d],!(!E||E.v==null||E.t==="z")){switch(b=["cell",d,"t"],E.t){case"s":case"str":b.push(r(E.v));break;case"n":E.f?(b[2]="vtf",b[3]="n",b[4]=E.v,b[5]=r(E.f)):(b[2]="v",b[3]=E.v);break;case"b":b[2]="vt"+(E.f?"f":"c"),b[3]="nl",b[4]=E.v?"1":"0",b[5]=r(E.f||(E.v?"TRUE":"FALSE"));break;case"d":var F=datenum(parseDate(E.v));b[2]="vtc",b[3]="nd",b[4]=""+F,b[5]=E.w||SSF_format(E.z||table_fmt[14],F);break;case"e":continue}v.push(b.join(":"))}return v.push("sheet:c:"+(g.e.c-g.s.c+1)+":r:"+(g.e.r-g.s.r+1)+":tvf:1"),v.push("valueformat:1:text-wiki"),v.join(`
`)}function h(_){return[i,o,c,o,u(_),x].join(`
`)}return{to_workbook:a,to_sheet:s,from_sheet:h}}(),PRN=function(){function t(h,_,v,b,E){E.raw?_[v][b]=h:h===""||(h==="TRUE"?_[v][b]=!0:h==="FALSE"?_[v][b]=!1:isNaN(fuzzynum(h))?isNaN(fuzzydate(h).getDate())?_[v][b]=h:_[v][b]=parseDate(h):_[v][b]=fuzzynum(h))}function r(h,_){var v=_||{},b=[];if(!h||h.length===0)return b;for(var E=h.split(/[\r\n]/),d=E.length-1;d>=0&&E[d].length===0;)--d;for(var g=10,y=0,R=0;R<=d;++R)y=E[R].indexOf(" "),y==-1?y=E[R].length:y++,g=Math.max(g,y);for(R=0;R<=d;++R){b[R]=[];var P=0;for(t(E[R].slice(0,g).trim(),b,R,P,v),P=1;P<=(E[R].length-g)/10+1;++P)t(E[R].slice(g+(P-1)*10,g+P*10).trim(),b,R,P,v)}return v.sheetRows&&(b=b.slice(0,v.sheetRows)),b}var e={44:",",9:"	",59:";",124:"|"},s={44:3,9:2,59:1,124:0};function a(h){for(var _={},v=!1,b=0,E=0;b<h.length;++b)(E=h.charCodeAt(b))==34?v=!v:!v&&E in e&&(_[E]=(_[E]||0)+1);E=[];for(b in _)Object.prototype.hasOwnProperty.call(_,b)&&E.push([_[b],b]);if(!E.length){_=s;for(b in _)Object.prototype.hasOwnProperty.call(_,b)&&E.push([_[b],b])}return E.sort(function(d,g){return d[0]-g[0]||s[d[1]]-s[g[1]]}),e[E.pop()[1]]||44}function i(h,_){var v=_||{},b="",E=v.dense?[]:{},d={s:{c:0,r:0},e:{c:0,r:0}};h.slice(0,4)=="sep="?h.charCodeAt(5)==13&&h.charCodeAt(6)==10?(b=h.charAt(4),h=h.slice(7)):h.charCodeAt(5)==13||h.charCodeAt(5)==10?(b=h.charAt(4),h=h.slice(6)):b=a(h.slice(0,1024)):v&&v.FS?b=v.FS:b=a(h.slice(0,1024));var g=0,y=0,R=0,P=0,F=0,S=b.charCodeAt(0),I=!1,w=0,j=h.charCodeAt(0);h=h.replace(/\r\n/mg,`
`);var C=v.dateNF!=null?dateNF_regex(v.dateNF):null;function V(){var O=h.slice(P,F),H={};if(O.charAt(0)=='"'&&O.charAt(O.length-1)=='"'&&(O=O.slice(1,-1).replace(/""/g,'"')),O.length===0)H.t="z";else if(v.raw)H.t="s",H.v=O;else if(O.trim().length===0)H.t="s",H.v=O;else if(O.charCodeAt(0)==61)O.charCodeAt(1)==34&&O.charCodeAt(O.length-1)==34?(H.t="s",H.v=O.slice(2,-1).replace(/""/g,'"')):fuzzyfmla(O)?(H.t="n",H.f=O.slice(1)):(H.t="s",H.v=O);else if(O=="TRUE")H.t="b",H.v=!0;else if(O=="FALSE")H.t="b",H.v=!1;else if(!isNaN(R=fuzzynum(O)))H.t="n",v.cellText!==!1&&(H.w=O),H.v=R;else if(!isNaN(fuzzydate(O).getDate())||C&&O.match(C)){H.z=v.dateNF||table_fmt[14];var z=0;C&&O.match(C)&&(O=dateNF_fix(O,v.dateNF,O.match(C)||[]),z=1),v.cellDates?(H.t="d",H.v=parseDate(O,z)):(H.t="n",H.v=datenum(parseDate(O,z))),v.cellText!==!1&&(H.w=SSF_format(H.z,H.v instanceof Date?datenum(H.v):H.v)),v.cellNF||delete H.z}else H.t="s",H.v=O;if(H.t=="z"||(v.dense?(E[g]||(E[g]=[]),E[g][y]=H):E[encode_cell({c:y,r:g})]=H),P=F+1,j=h.charCodeAt(P),d.e.c<y&&(d.e.c=y),d.e.r<g&&(d.e.r=g),w==S)++y;else if(y=0,++g,v.sheetRows&&v.sheetRows<=g)return!0}e:for(;F<h.length;++F)switch(w=h.charCodeAt(F)){case 34:j===34&&(I=!I);break;case S:case 10:case 13:if(!I&&V())break e;break}return F-P>0&&V(),E["!ref"]=encode_range(d),E}function o(h,_){return!(_&&_.PRN)||_.FS||h.slice(0,4)=="sep="||h.indexOf("	")>=0||h.indexOf(",")>=0||h.indexOf(";")>=0?i(h,_):aoa_to_sheet(r(h,_),_)}function c(h,_){var v="",b=_.type=="string"?[0,0,0,0]:firstbyte(h,_);switch(_.type){case"base64":v=Base64_decode(h);break;case"binary":v=h;break;case"buffer":_.codepage==65001?v=h.toString("utf8"):_.codepage&&typeof $cptable<"u"||(v=has_buf&&Buffer.isBuffer(h)?h.toString("binary"):a2s(h));break;case"array":v=cc2str(h);break;case"string":v=h;break;default:throw new Error("Unrecognized type "+_.type)}return b[0]==239&&b[1]==187&&b[2]==191?v=utf8read(v.slice(3)):_.type!="string"&&_.type!="buffer"&&_.codepage==65001?v=utf8read(v):_.type=="binary"&&typeof $cptable<"u",v.slice(0,19)=="socialcalc:version:"?ETH.to_sheet(_.type=="string"?v:utf8read(v),_):o(v,_)}function x(h,_){return sheet_to_workbook(c(h,_),_)}function u(h){for(var _=[],v=safe_decode_range(h["!ref"]),b,E=Array.isArray(h),d=v.s.r;d<=v.e.r;++d){for(var g=[],y=v.s.c;y<=v.e.c;++y){var R=encode_cell({r:d,c:y});if(b=E?(h[d]||[])[y]:h[R],!b||b.v==null){g.push("          ");continue}for(var P=(b.w||(format_cell(b),b.w)||"").slice(0,10);P.length<10;)P+=" ";g.push(P+(y===0?" ":""))}_.push(g.join(""))}return _.join(`
`)}return{to_workbook:x,to_sheet:c,from_sheet:u}}(),WK_=function(){function t(L,N,T){if(L){prep_blob(L,L.l||0);for(var A=T.Enum||ce;L.l<L.length;){var D=L.read_shift(2),B=A[D]||A[65535],U=L.read_shift(2),Y=L.l+U,G=B.f&&B.f(L,U,T);if(L.l=Y,N(G,B,D))return}}}function r(L,N){switch(N.type){case"base64":return e(s2a(Base64_decode(L)),N);case"binary":return e(s2a(L),N);case"buffer":case"array":return e(L,N)}throw"Unsupported type "+N.type}function e(L,N){if(!L)return L;var T=N||{},A=T.dense?[]:{},D="Sheet1",B="",U=0,Y={},G=[],fe=[],xe={s:{r:0,c:0},e:{r:0,c:0}},Se=T.sheetRows||0;if(L[2]==0&&(L[3]==8||L[3]==9)&&L.length>=16&&L[14]==5&&L[15]===108)throw new Error("Unsupported Works 3 for Mac file");if(L[2]==2)T.Enum=ce,t(L,function(ae,J,oe){switch(oe){case 0:T.vers=ae,ae>=4096&&(T.qpro=!0);break;case 6:xe=ae;break;case 204:ae&&(B=ae);break;case 222:B=ae;break;case 15:case 51:T.qpro||(ae[1].v=ae[1].v.slice(1));case 13:case 14:case 16:oe==14&&(ae[2]&112)==112&&(ae[2]&15)>1&&(ae[2]&15)<15&&(ae[1].z=T.dateNF||table_fmt[14],T.cellDates&&(ae[1].t="d",ae[1].v=numdate(ae[1].v))),T.qpro&&ae[3]>U&&(A["!ref"]=encode_range(xe),Y[D]=A,G.push(D),A=T.dense?[]:{},xe={s:{r:0,c:0},e:{r:0,c:0}},U=ae[3],D=B||"Sheet"+(U+1),B="");var Q=T.dense?(A[ae[0].r]||[])[ae[0].c]:A[encode_cell(ae[0])];if(Q){Q.t=ae[1].t,Q.v=ae[1].v,ae[1].z!=null&&(Q.z=ae[1].z),ae[1].f!=null&&(Q.f=ae[1].f);break}T.dense?(A[ae[0].r]||(A[ae[0].r]=[]),A[ae[0].r][ae[0].c]=ae[1]):A[encode_cell(ae[0])]=ae[1];break}},T);else if(L[2]==26||L[2]==14)T.Enum=ye,L[2]==14&&(T.qpro=!0,L.l=0),t(L,function(ae,J,oe){switch(oe){case 204:D=ae;break;case 22:ae[1].v=ae[1].v.slice(1);case 23:case 24:case 25:case 37:case 39:case 40:if(ae[3]>U&&(A["!ref"]=encode_range(xe),Y[D]=A,G.push(D),A=T.dense?[]:{},xe={s:{r:0,c:0},e:{r:0,c:0}},U=ae[3],D="Sheet"+(U+1)),Se>0&&ae[0].r>=Se)break;T.dense?(A[ae[0].r]||(A[ae[0].r]=[]),A[ae[0].r][ae[0].c]=ae[1]):A[encode_cell(ae[0])]=ae[1],xe.e.c<ae[0].c&&(xe.e.c=ae[0].c),xe.e.r<ae[0].r&&(xe.e.r=ae[0].r);break;case 27:ae[14e3]&&(fe[ae[14e3][0]]=ae[14e3][1]);break;case 1537:fe[ae[0]]=ae[1],ae[0]==U&&(D=ae[1]);break}},T);else throw new Error("Unrecognized LOTUS BOF "+L[2]);if(A["!ref"]=encode_range(xe),Y[B||D]=A,G.push(B||D),!fe.length)return{SheetNames:G,Sheets:Y};for(var Ce={},Me=[],be=0;be<fe.length;++be)Y[G[be]]?(Me.push(fe[be]||G[be]),Ce[fe[be]]=Y[fe[be]]||Y[G[be]]):(Me.push(fe[be]),Ce[fe[be]]={"!ref":"A1"});return{SheetNames:Me,Sheets:Ce}}function s(L,N){var T=N||{};if(+T.codepage>=0&&set_cp(+T.codepage),T.type=="string")throw new Error("Cannot write WK1 to JS string");var A=buf_array(),D=safe_decode_range(L["!ref"]),B=Array.isArray(L),U=[];write_biff_rec(A,0,i(1030)),write_biff_rec(A,6,x(D));for(var Y=Math.min(D.e.r,8191),G=D.s.r;G<=Y;++G)for(var fe=encode_row(G),xe=D.s.c;xe<=D.e.c;++xe){G===D.s.r&&(U[xe]=encode_col(xe));var Se=U[xe]+fe,Ce=B?(L[G]||[])[xe]:L[Se];if(!(!Ce||Ce.t=="z"))if(Ce.t=="n")(Ce.v|0)==Ce.v&&Ce.v>=-32768&&Ce.v<=32767?write_biff_rec(A,13,b(G,xe,Ce.v)):write_biff_rec(A,14,d(G,xe,Ce.v));else{var Me=format_cell(Ce);write_biff_rec(A,15,_(G,xe,Me.slice(0,239)))}}return write_biff_rec(A,1),A.end()}function a(L,N){var T=N||{};if(+T.codepage>=0&&set_cp(+T.codepage),T.type=="string")throw new Error("Cannot write WK3 to JS string");var A=buf_array();write_biff_rec(A,0,o(L));for(var D=0,B=0;D<L.SheetNames.length;++D)(L.Sheets[L.SheetNames[D]]||{})["!ref"]&&write_biff_rec(A,27,te(L.SheetNames[D],B++));var U=0;for(D=0;D<L.SheetNames.length;++D){var Y=L.Sheets[L.SheetNames[D]];if(!(!Y||!Y["!ref"])){for(var G=safe_decode_range(Y["!ref"]),fe=Array.isArray(Y),xe=[],Se=Math.min(G.e.r,8191),Ce=G.s.r;Ce<=Se;++Ce)for(var Me=encode_row(Ce),be=G.s.c;be<=G.e.c;++be){Ce===G.s.r&&(xe[be]=encode_col(be));var ae=xe[be]+Me,J=fe?(Y[Ce]||[])[be]:Y[ae];if(!(!J||J.t=="z"))if(J.t=="n")write_biff_rec(A,23,V(Ce,be,U,J.v));else{var oe=format_cell(J);write_biff_rec(A,22,w(Ce,be,U,oe.slice(0,239)))}}++U}}return write_biff_rec(A,1),A.end()}function i(L){var N=new_buf(2);return N.write_shift(2,L),N}function o(L){var N=new_buf(26);N.write_shift(2,4096),N.write_shift(2,4),N.write_shift(4,0);for(var T=0,A=0,D=0,B=0;B<L.SheetNames.length;++B){var U=L.SheetNames[B],Y=L.Sheets[U];if(!(!Y||!Y["!ref"])){++D;var G=decode_range(Y["!ref"]);T<G.e.r&&(T=G.e.r),A<G.e.c&&(A=G.e.c)}}return T>8191&&(T=8191),N.write_shift(2,T),N.write_shift(1,D),N.write_shift(1,A),N.write_shift(2,0),N.write_shift(2,0),N.write_shift(1,1),N.write_shift(1,2),N.write_shift(4,0),N.write_shift(4,0),N}function c(L,N,T){var A={s:{c:0,r:0},e:{c:0,r:0}};return N==8&&T.qpro?(A.s.c=L.read_shift(1),L.l++,A.s.r=L.read_shift(2),A.e.c=L.read_shift(1),L.l++,A.e.r=L.read_shift(2),A):(A.s.c=L.read_shift(2),A.s.r=L.read_shift(2),N==12&&T.qpro&&(L.l+=2),A.e.c=L.read_shift(2),A.e.r=L.read_shift(2),N==12&&T.qpro&&(L.l+=2),A.s.c==65535&&(A.s.c=A.e.c=A.s.r=A.e.r=0),A)}function x(L){var N=new_buf(8);return N.write_shift(2,L.s.c),N.write_shift(2,L.s.r),N.write_shift(2,L.e.c),N.write_shift(2,L.e.r),N}function u(L,N,T){var A=[{c:0,r:0},{t:"n",v:0},0,0];return T.qpro&&T.vers!=20768?(A[0].c=L.read_shift(1),A[3]=L.read_shift(1),A[0].r=L.read_shift(2),L.l+=2):(A[2]=L.read_shift(1),A[0].c=L.read_shift(2),A[0].r=L.read_shift(2)),A}function h(L,N,T){var A=L.l+N,D=u(L,N,T);if(D[1].t="s",T.vers==20768){L.l++;var B=L.read_shift(1);return D[1].v=L.read_shift(B,"utf8"),D}return T.qpro&&L.l++,D[1].v=L.read_shift(A-L.l,"cstr"),D}function _(L,N,T){var A=new_buf(7+T.length);A.write_shift(1,255),A.write_shift(2,N),A.write_shift(2,L),A.write_shift(1,39);for(var D=0;D<A.length;++D){var B=T.charCodeAt(D);A.write_shift(1,B>=128?95:B)}return A.write_shift(1,0),A}function v(L,N,T){var A=u(L,N,T);return A[1].v=L.read_shift(2,"i"),A}function b(L,N,T){var A=new_buf(7);return A.write_shift(1,255),A.write_shift(2,N),A.write_shift(2,L),A.write_shift(2,T,"i"),A}function E(L,N,T){var A=u(L,N,T);return A[1].v=L.read_shift(8,"f"),A}function d(L,N,T){var A=new_buf(13);return A.write_shift(1,255),A.write_shift(2,N),A.write_shift(2,L),A.write_shift(8,T,"f"),A}function g(L,N,T){var A=L.l+N,D=u(L,N,T);if(D[1].v=L.read_shift(8,"f"),T.qpro)L.l=A;else{var B=L.read_shift(2);F(L.slice(L.l,L.l+B),D),L.l+=B}return D}function y(L,N,T){var A=N&32768;return N&=-32769,N=(A?L:0)+(N>=8192?N-16384:N),(A?"":"$")+(T?encode_col(N):encode_row(N))}var R={51:["FALSE",0],52:["TRUE",0],70:["LEN",1],80:["SUM",69],81:["AVERAGEA",69],82:["COUNTA",69],83:["MINA",69],84:["MAXA",69],111:["T",1]},P=["","","","","","","","","","+","-","*","/","^","=","<>","<=",">=","<",">","","","","","&","","","","","","",""];function F(L,N){prep_blob(L,0);for(var T=[],A=0,D="",B="",U="",Y="";L.l<L.length;){var G=L[L.l++];switch(G){case 0:T.push(L.read_shift(8,"f"));break;case 1:B=y(N[0].c,L.read_shift(2),!0),D=y(N[0].r,L.read_shift(2),!1),T.push(B+D);break;case 2:{var fe=y(N[0].c,L.read_shift(2),!0),xe=y(N[0].r,L.read_shift(2),!1);B=y(N[0].c,L.read_shift(2),!0),D=y(N[0].r,L.read_shift(2),!1),T.push(fe+xe+":"+B+D)}break;case 3:if(L.l<L.length){console.error("WK1 premature formula end");return}break;case 4:T.push("("+T.pop()+")");break;case 5:T.push(L.read_shift(2));break;case 6:{for(var Se="";G=L[L.l++];)Se+=String.fromCharCode(G);T.push('"'+Se.replace(/"/g,'""')+'"')}break;case 8:T.push("-"+T.pop());break;case 23:T.push("+"+T.pop());break;case 22:T.push("NOT("+T.pop()+")");break;case 20:case 21:Y=T.pop(),U=T.pop(),T.push(["AND","OR"][G-20]+"("+U+","+Y+")");break;default:if(G<32&&P[G])Y=T.pop(),U=T.pop(),T.push(U+P[G]+Y);else if(R[G]){if(A=R[G][1],A==69&&(A=L[L.l++]),A>T.length){console.error("WK1 bad formula parse 0x"+G.toString(16)+":|"+T.join("|")+"|");return}var Ce=T.slice(-A);T.length-=A,T.push(R[G][0]+"("+Ce.join(",")+")")}else return G<=7?console.error("WK1 invalid opcode "+G.toString(16)):G<=24?console.error("WK1 unsupported op "+G.toString(16)):G<=30?console.error("WK1 invalid opcode "+G.toString(16)):G<=115?console.error("WK1 unsupported function opcode "+G.toString(16)):console.error("WK1 unrecognized opcode "+G.toString(16))}}T.length==1?N[1].f=""+T[0]:console.error("WK1 bad formula parse |"+T.join("|")+"|")}function S(L){var N=[{c:0,r:0},{t:"n",v:0},0];return N[0].r=L.read_shift(2),N[3]=L[L.l++],N[0].c=L[L.l++],N}function I(L,N){var T=S(L);return T[1].t="s",T[1].v=L.read_shift(N-4,"cstr"),T}function w(L,N,T,A){var D=new_buf(6+A.length);D.write_shift(2,L),D.write_shift(1,T),D.write_shift(1,N),D.write_shift(1,39);for(var B=0;B<A.length;++B){var U=A.charCodeAt(B);D.write_shift(1,U>=128?95:U)}return D.write_shift(1,0),D}function j(L,N){var T=S(L);T[1].v=L.read_shift(2);var A=T[1].v>>1;if(T[1].v&1)switch(A&7){case 0:A=(A>>3)*5e3;break;case 1:A=(A>>3)*500;break;case 2:A=(A>>3)/20;break;case 3:A=(A>>3)/200;break;case 4:A=(A>>3)/2e3;break;case 5:A=(A>>3)/2e4;break;case 6:A=(A>>3)/16;break;case 7:A=(A>>3)/64;break}return T[1].v=A,T}function C(L,N){var T=S(L),A=L.read_shift(4),D=L.read_shift(4),B=L.read_shift(2);if(B==65535)return A===0&&D===3221225472?(T[1].t="e",T[1].v=15):A===0&&D===3489660928?(T[1].t="e",T[1].v=42):T[1].v=0,T;var U=B&32768;return B=(B&32767)-16446,T[1].v=(1-U*2)*(D*Math.pow(2,B+32)+A*Math.pow(2,B)),T}function V(L,N,T,A){var D=new_buf(14);if(D.write_shift(2,L),D.write_shift(1,T),D.write_shift(1,N),A==0)return D.write_shift(4,0),D.write_shift(4,0),D.write_shift(2,65535),D;var B=0,U=0,Y=0,G=0;return A<0&&(B=1,A=-A),U=Math.log2(A)|0,A/=Math.pow(2,U-31),G=A>>>0,G&2147483648||(A/=2,++U,G=A>>>0),A-=G,G|=2147483648,G>>>=0,A*=Math.pow(2,32),Y=A>>>0,D.write_shift(4,Y),D.write_shift(4,G),U+=16383+(B?32768:0),D.write_shift(2,U),D}function O(L,N){var T=C(L);return L.l+=N-14,T}function H(L,N){var T=S(L),A=L.read_shift(4);return T[1].v=A>>6,T}function z(L,N){var T=S(L),A=L.read_shift(8,"f");return T[1].v=A,T}function pe(L,N){var T=z(L);return L.l+=N-10,T}function ee(L,N){return L[L.l+N-1]==0?L.read_shift(N,"cstr"):""}function he(L,N){var T=L[L.l++];T>N-1&&(T=N-1);for(var A="";A.length<T;)A+=String.fromCharCode(L[L.l++]);return A}function re(L,N,T){if(!(!T.qpro||N<21)){var A=L.read_shift(1);L.l+=17,L.l+=1,L.l+=2;var D=L.read_shift(N-21,"cstr");return[A,D]}}function me(L,N){for(var T={},A=L.l+N;L.l<A;){var D=L.read_shift(2);if(D==14e3){for(T[D]=[0,""],T[D][0]=L.read_shift(2);L[L.l];)T[D][1]+=String.fromCharCode(L[L.l]),L.l++;L.l++}}return T}function te(L,N){var T=new_buf(5+L.length);T.write_shift(2,14e3),T.write_shift(2,N);for(var A=0;A<L.length;++A){var D=L.charCodeAt(A);T[T.l++]=D>127?95:D}return T[T.l++]=0,T}var ce={0:{n:"BOF",f:parseuint16},1:{n:"EOF"},2:{n:"CALCMODE"},3:{n:"CALCORDER"},4:{n:"SPLIT"},5:{n:"SYNC"},6:{n:"RANGE",f:c},7:{n:"WINDOW1"},8:{n:"COLW1"},9:{n:"WINTWO"},10:{n:"COLW2"},11:{n:"NAME"},12:{n:"BLANK"},13:{n:"INTEGER",f:v},14:{n:"NUMBER",f:E},15:{n:"LABEL",f:h},16:{n:"FORMULA",f:g},24:{n:"TABLE"},25:{n:"ORANGE"},26:{n:"PRANGE"},27:{n:"SRANGE"},28:{n:"FRANGE"},29:{n:"KRANGE1"},32:{n:"HRANGE"},35:{n:"KRANGE2"},36:{n:"PROTEC"},37:{n:"FOOTER"},38:{n:"HEADER"},39:{n:"SETUP"},40:{n:"MARGINS"},41:{n:"LABELFMT"},42:{n:"TITLES"},43:{n:"SHEETJS"},45:{n:"GRAPH"},46:{n:"NGRAPH"},47:{n:"CALCCOUNT"},48:{n:"UNFORMATTED"},49:{n:"CURSORW12"},50:{n:"WINDOW"},51:{n:"STRING",f:h},55:{n:"PASSWORD"},56:{n:"LOCKED"},60:{n:"QUERY"},61:{n:"QUERYNAME"},62:{n:"PRINT"},63:{n:"PRINTNAME"},64:{n:"GRAPH2"},65:{n:"GRAPHNAME"},66:{n:"ZOOM"},67:{n:"SYMSPLIT"},68:{n:"NSROWS"},69:{n:"NSCOLS"},70:{n:"RULER"},71:{n:"NNAME"},72:{n:"ACOMM"},73:{n:"AMACRO"},74:{n:"PARSE"},102:{n:"PRANGES??"},103:{n:"RRANGES??"},104:{n:"FNAME??"},105:{n:"MRANGES??"},204:{n:"SHEETNAMECS",f:ee},222:{n:"SHEETNAMELP",f:he},65535:{n:""}},ye={0:{n:"BOF"},1:{n:"EOF"},2:{n:"PASSWORD"},3:{n:"CALCSET"},4:{n:"WINDOWSET"},5:{n:"SHEETCELLPTR"},6:{n:"SHEETLAYOUT"},7:{n:"COLUMNWIDTH"},8:{n:"HIDDENCOLUMN"},9:{n:"USERRANGE"},10:{n:"SYSTEMRANGE"},11:{n:"ZEROFORCE"},12:{n:"SORTKEYDIR"},13:{n:"FILESEAL"},14:{n:"DATAFILLNUMS"},15:{n:"PRINTMAIN"},16:{n:"PRINTSTRING"},17:{n:"GRAPHMAIN"},18:{n:"GRAPHSTRING"},19:{n:"??"},20:{n:"ERRCELL"},21:{n:"NACELL"},22:{n:"LABEL16",f:I},23:{n:"NUMBER17",f:C},24:{n:"NUMBER18",f:j},25:{n:"FORMULA19",f:O},26:{n:"FORMULA1A"},27:{n:"XFORMAT",f:me},28:{n:"DTLABELMISC"},29:{n:"DTLABELCELL"},30:{n:"GRAPHWINDOW"},31:{n:"CPA"},32:{n:"LPLAUTO"},33:{n:"QUERY"},34:{n:"HIDDENSHEET"},35:{n:"??"},37:{n:"NUMBER25",f:H},38:{n:"??"},39:{n:"NUMBER27",f:z},40:{n:"FORMULA28",f:pe},142:{n:"??"},147:{n:"??"},150:{n:"??"},151:{n:"??"},152:{n:"??"},153:{n:"??"},154:{n:"??"},155:{n:"??"},156:{n:"??"},163:{n:"??"},174:{n:"??"},175:{n:"??"},176:{n:"??"},177:{n:"??"},184:{n:"??"},185:{n:"??"},186:{n:"??"},187:{n:"??"},188:{n:"??"},195:{n:"??"},201:{n:"??"},204:{n:"SHEETNAMECS",f:ee},205:{n:"??"},206:{n:"??"},207:{n:"??"},208:{n:"??"},256:{n:"??"},259:{n:"??"},260:{n:"??"},261:{n:"??"},262:{n:"??"},263:{n:"??"},265:{n:"??"},266:{n:"??"},267:{n:"??"},268:{n:"??"},270:{n:"??"},271:{n:"??"},384:{n:"??"},389:{n:"??"},390:{n:"??"},393:{n:"??"},396:{n:"??"},512:{n:"??"},514:{n:"??"},513:{n:"??"},516:{n:"??"},517:{n:"??"},640:{n:"??"},641:{n:"??"},642:{n:"??"},643:{n:"??"},644:{n:"??"},645:{n:"??"},646:{n:"??"},647:{n:"??"},648:{n:"??"},658:{n:"??"},659:{n:"??"},660:{n:"??"},661:{n:"??"},662:{n:"??"},665:{n:"??"},666:{n:"??"},768:{n:"??"},772:{n:"??"},1537:{n:"SHEETINFOQP",f:re},1600:{n:"??"},1602:{n:"??"},1793:{n:"??"},1794:{n:"??"},1795:{n:"??"},1796:{n:"??"},1920:{n:"??"},2048:{n:"??"},2049:{n:"??"},2052:{n:"??"},2688:{n:"??"},10998:{n:"??"},12849:{n:"??"},28233:{n:"??"},28484:{n:"??"},65535:{n:""}};return{sheet_to_wk1:s,book_to_wk3:a,to_workbook:r}}(),straywsregex=/^\s|\s$|[\t\n\r]/;function write_sst_xml(t,r){if(!r.bookSST)return"";var e=[XML_HEADER];e[e.length]=writextag("sst",null,{xmlns:XMLNS_main[0],count:t.Count,uniqueCount:t.Unique});for(var s=0;s!=t.length;++s)if(t[s]!=null){var a=t[s],i="<si>";a.r?i+=a.r:(i+="<t",a.t||(a.t=""),a.t.match(straywsregex)&&(i+=' xml:space="preserve"'),i+=">"+escapexml(a.t)+"</t>"),i+="</si>",e[e.length]=i}return e.length>2&&(e[e.length]="</sst>",e[1]=e[1].replace("/>",">")),e.join("")}function parse_BrtBeginSst(t){return[t.read_shift(4),t.read_shift(4)]}function write_BrtBeginSst(t,r){return r||(r=new_buf(8)),r.write_shift(4,t.Count),r.write_shift(4,t.Unique),r}var write_BrtSSTItem=write_RichStr;function write_sst_bin(t){var r=buf_array();write_record(r,159,write_BrtBeginSst(t));for(var e=0;e<t.length;++e)write_record(r,19,write_BrtSSTItem(t[e]));return write_record(r,160),r.end()}function _JS2ANSI(t){for(var r=[],e=t.split(""),s=0;s<e.length;++s)r[s]=e[s].charCodeAt(0);return r}function crypto_CreatePasswordVerifier_Method1(t){var r=0,e,s=_JS2ANSI(t),a=s.length+1,i,o,c,x,u;for(e=new_raw_buf(a),e[0]=s.length,i=1;i!=a;++i)e[i]=s[i-1];for(i=a-1;i>=0;--i)o=e[i],c=r&16384?1:0,x=r<<1&32767,u=c|x,r=u^o;return r^52811}var RTF=function(){function t(a,i){switch(i.type){case"base64":return r(Base64_decode(a),i);case"binary":return r(a,i);case"buffer":return r(has_buf&&Buffer.isBuffer(a)?a.toString("binary"):a2s(a),i);case"array":return r(cc2str(a),i)}throw new Error("Unrecognized type "+i.type)}function r(a,i){var o=i||{},c=o.dense?[]:{},x=a.match(/\\trowd.*?\\row\b/g);if(!x.length)throw new Error("RTF missing table");var u={s:{c:0,r:0},e:{c:0,r:x.length-1}};return x.forEach(function(h,_){Array.isArray(c)&&(c[_]=[]);for(var v=/\\\w+\b/g,b=0,E,d=-1;E=v.exec(h);){switch(E[0]){case"\\cell":var g=h.slice(b,v.lastIndex-E[0].length);if(g[0]==" "&&(g=g.slice(1)),++d,g.length){var y={v:g,t:"s"};Array.isArray(c)?c[_][d]=y:c[encode_cell({r:_,c:d})]=y}break}b=v.lastIndex}d>u.e.c&&(u.e.c=d)}),c["!ref"]=encode_range(u),c}function e(a,i){return sheet_to_workbook(t(a,i),i)}function s(a){for(var i=["{\\rtf1\\ansi"],o=safe_decode_range(a["!ref"]),c,x=Array.isArray(a),u=o.s.r;u<=o.e.r;++u){i.push("\\trowd\\trautofit1");for(var h=o.s.c;h<=o.e.c;++h)i.push("\\cellx"+(h+1));for(i.push("\\pard\\intbl"),h=o.s.c;h<=o.e.c;++h){var _=encode_cell({r:u,c:h});c=x?(a[u]||[])[h]:a[_],!(!c||c.v==null&&(!c.f||c.F))&&(i.push(" "+(c.w||(format_cell(c),c.w))),i.push("\\cell"))}i.push("\\pard\\intbl\\row")}return i.join("")+"}"}return{to_workbook:e,to_sheet:t,from_sheet:s}}();function rgb2Hex(t){for(var r=0,e=1;r!=3;++r)e=e*256+(t[r]>255?255:t[r]<0?0:t[r]);return e.toString(16).toUpperCase().slice(1)}var DEF_MDW=6,MDW=DEF_MDW;function width2px(t){return Math.floor((t+Math.round(128/MDW)/256)*MDW)}function px2char(t){return Math.floor((t-5)/MDW*100+.5)/100}function char2width(t){return Math.round((t*MDW+5)/MDW*256)/256}function process_col(t){t.width?(t.wpx=width2px(t.width),t.wch=px2char(t.wpx),t.MDW=MDW):t.wpx?(t.wch=px2char(t.wpx),t.width=char2width(t.wch),t.MDW=MDW):typeof t.wch=="number"&&(t.width=char2width(t.wch),t.wpx=width2px(t.width),t.MDW=MDW),t.customWidth&&delete t.customWidth}var DEF_PPI=96,PPI=DEF_PPI;function px2pt(t){return t*96/PPI}function pt2px(t){return t*PPI/96}function write_numFmts(t){var r=["<numFmts>"];return[[5,8],[23,26],[41,44],[50,392]].forEach(function(e){for(var s=e[0];s<=e[1];++s)t[s]!=null&&(r[r.length]=writextag("numFmt",null,{numFmtId:s,formatCode:escapexml(t[s])}))}),r.length===1?"":(r[r.length]="</numFmts>",r[0]=writextag("numFmts",null,{count:r.length-2}).replace("/>",">"),r.join(""))}function write_cellXfs(t){var r=[];return r[r.length]=writextag("cellXfs",null),t.forEach(function(e){r[r.length]=writextag("xf",null,e)}),r[r.length]="</cellXfs>",r.length===2?"":(r[0]=writextag("cellXfs",null,{count:r.length-2}).replace("/>",">"),r.join(""))}function write_sty_xml(t,r){var e=[XML_HEADER,writextag("styleSheet",null,{xmlns:XMLNS_main[0],"xmlns:vt":XMLNS.vt})],s;return t.SSF&&(s=write_numFmts(t.SSF))!=null&&(e[e.length]=s),e[e.length]='<fonts count="1"><font><sz val="12"/><color theme="1"/><name val="Calibri"/><family val="2"/><scheme val="minor"/></font></fonts>',e[e.length]='<fills count="2"><fill><patternFill patternType="none"/></fill><fill><patternFill patternType="gray125"/></fill></fills>',e[e.length]='<borders count="1"><border><left/><right/><top/><bottom/><diagonal/></border></borders>',e[e.length]='<cellStyleXfs count="1"><xf numFmtId="0" fontId="0" fillId="0" borderId="0"/></cellStyleXfs>',(s=write_cellXfs(r.cellXfs))&&(e[e.length]=s),e[e.length]='<cellStyles count="1"><cellStyle name="Normal" xfId="0" builtinId="0"/></cellStyles>',e[e.length]='<dxfs count="0"/>',e[e.length]='<tableStyles count="0" defaultTableStyle="TableStyleMedium9" defaultPivotStyle="PivotStyleMedium4"/>',e.length>2&&(e[e.length]="</styleSheet>",e[1]=e[1].replace("/>",">")),e.join("")}function parse_BrtFmt(t,r){var e=t.read_shift(2),s=parse_XLWideString(t);return[e,s]}function write_BrtFmt(t,r,e){e||(e=new_buf(6+4*r.length)),e.write_shift(2,t),write_XLWideString(r,e);var s=e.length>e.l?e.slice(0,e.l):e;return e.l==null&&(e.l=e.length),s}function parse_BrtFont(t,r,e){var s={};s.sz=t.read_shift(2)/20;var a=parse_FontFlags(t);a.fItalic&&(s.italic=1),a.fCondense&&(s.condense=1),a.fExtend&&(s.extend=1),a.fShadow&&(s.shadow=1),a.fOutline&&(s.outline=1),a.fStrikeout&&(s.strike=1);var i=t.read_shift(2);switch(i===700&&(s.bold=1),t.read_shift(2)){case 1:s.vertAlign="superscript";break;case 2:s.vertAlign="subscript";break}var o=t.read_shift(1);o!=0&&(s.underline=o);var c=t.read_shift(1);c>0&&(s.family=c);var x=t.read_shift(1);switch(x>0&&(s.charset=x),t.l++,s.color=parse_BrtColor(t),t.read_shift(1)){case 1:s.scheme="major";break;case 2:s.scheme="minor";break}return s.name=parse_XLWideString(t),s}function write_BrtFont(t,r){r||(r=new_buf(25+4*32)),r.write_shift(2,t.sz*20),write_FontFlags(t,r),r.write_shift(2,t.bold?700:400);var e=0;t.vertAlign=="superscript"?e=1:t.vertAlign=="subscript"&&(e=2),r.write_shift(2,e),r.write_shift(1,t.underline||0),r.write_shift(1,t.family||0),r.write_shift(1,t.charset||0),r.write_shift(1,0),write_BrtColor(t.color,r);var s=0;return s=2,r.write_shift(1,s),write_XLWideString(t.name,r),r.length>r.l?r.slice(0,r.l):r}var XLSBFillPTNames=["none","solid","mediumGray","darkGray","lightGray","darkHorizontal","darkVertical","darkDown","darkUp","darkGrid","darkTrellis","lightHorizontal","lightVertical","lightDown","lightUp","lightGrid","lightTrellis","gray125","gray0625"],rev_XLSBFillPTNames,parse_BrtFill=parsenoop;function write_BrtFill(t,r){r||(r=new_buf(4*3+8*7+16*1)),rev_XLSBFillPTNames||(rev_XLSBFillPTNames=evert(XLSBFillPTNames));var e=rev_XLSBFillPTNames[t.patternType];e==null&&(e=40),r.write_shift(4,e);var s=0;if(e!=40)for(write_BrtColor({auto:1},r),write_BrtColor({auto:1},r);s<12;++s)r.write_shift(4,0);else{for(;s<4;++s)r.write_shift(4,0);for(;s<12;++s)r.write_shift(4,0)}return r.length>r.l?r.slice(0,r.l):r}function parse_BrtXF(t,r){var e=t.l+r,s=t.read_shift(2),a=t.read_shift(2);return t.l=e,{ixfe:s,numFmtId:a}}function write_BrtXF(t,r,e){e||(e=new_buf(16)),e.write_shift(2,r||0),e.write_shift(2,t.numFmtId||0),e.write_shift(2,0),e.write_shift(2,0),e.write_shift(2,0),e.write_shift(1,0),e.write_shift(1,0);var s=0;return e.write_shift(1,s),e.write_shift(1,0),e.write_shift(1,0),e.write_shift(1,0),e}function write_Blxf(t,r){return r||(r=new_buf(10)),r.write_shift(1,0),r.write_shift(1,0),r.write_shift(4,0),r.write_shift(4,0),r}var parse_BrtBorder=parsenoop;function write_BrtBorder(t,r){return r||(r=new_buf(51)),r.write_shift(1,0),write_Blxf(null,r),write_Blxf(null,r),write_Blxf(null,r),write_Blxf(null,r),write_Blxf(null,r),r.length>r.l?r.slice(0,r.l):r}function write_BrtStyle(t,r){return r||(r=new_buf(12+4*10)),r.write_shift(4,t.xfId),r.write_shift(2,1),r.write_shift(1,0),r.write_shift(1,0),write_XLNullableWideString(t.name||"",r),r.length>r.l?r.slice(0,r.l):r}function write_BrtBeginTableStyles(t,r,e){var s=new_buf(2052);return s.write_shift(4,t),write_XLNullableWideString(r,s),write_XLNullableWideString(e,s),s.length>s.l?s.slice(0,s.l):s}function write_FMTS_bin(t,r){if(r){var e=0;[[5,8],[23,26],[41,44],[50,392]].forEach(function(s){for(var a=s[0];a<=s[1];++a)r[a]!=null&&++e}),e!=0&&(write_record(t,615,write_UInt32LE(e)),[[5,8],[23,26],[41,44],[50,392]].forEach(function(s){for(var a=s[0];a<=s[1];++a)r[a]!=null&&write_record(t,44,write_BrtFmt(a,r[a]))}),write_record(t,616))}}function write_FONTS_bin(t){var r=1;write_record(t,611,write_UInt32LE(r)),write_record(t,43,write_BrtFont({sz:12,color:{theme:1},name:"Calibri",family:2})),write_record(t,612)}function write_FILLS_bin(t){var r=2;write_record(t,603,write_UInt32LE(r)),write_record(t,45,write_BrtFill({patternType:"none"})),write_record(t,45,write_BrtFill({patternType:"gray125"})),write_record(t,604)}function write_BORDERS_bin(t){var r=1;write_record(t,613,write_UInt32LE(r)),write_record(t,46,write_BrtBorder()),write_record(t,614)}function write_CELLSTYLEXFS_bin(t){var r=1;write_record(t,626,write_UInt32LE(r)),write_record(t,47,write_BrtXF({numFmtId:0},65535)),write_record(t,627)}function write_CELLXFS_bin(t,r){write_record(t,617,write_UInt32LE(r.length)),r.forEach(function(e){write_record(t,47,write_BrtXF(e,0))}),write_record(t,618)}function write_STYLES_bin(t){var r=1;write_record(t,619,write_UInt32LE(r)),write_record(t,48,write_BrtStyle({xfId:0,name:"Normal"})),write_record(t,620)}function write_DXFS_bin(t){var r=0;write_record(t,505,write_UInt32LE(r)),write_record(t,506)}function write_TABLESTYLES_bin(t){var r=0;write_record(t,508,write_BrtBeginTableStyles(r,"TableStyleMedium9","PivotStyleMedium4")),write_record(t,509)}function write_sty_bin(t,r){var e=buf_array();return write_record(e,278),write_FMTS_bin(e,t.SSF),write_FONTS_bin(e),write_FILLS_bin(e),write_BORDERS_bin(e),write_CELLSTYLEXFS_bin(e),write_CELLXFS_bin(e,r.cellXfs),write_STYLES_bin(e),write_DXFS_bin(e),write_TABLESTYLES_bin(e),write_record(e,279),e.end()}function write_theme(t,r){if(r&&r.themeXLSX)return r.themeXLSX;if(t&&typeof t.raw=="string")return t.raw;var e=[XML_HEADER];return e[e.length]='<a:theme xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main" name="Office Theme">',e[e.length]="<a:themeElements>",e[e.length]='<a:clrScheme name="Office">',e[e.length]='<a:dk1><a:sysClr val="windowText" lastClr="000000"/></a:dk1>',e[e.length]='<a:lt1><a:sysClr val="window" lastClr="FFFFFF"/></a:lt1>',e[e.length]='<a:dk2><a:srgbClr val="1F497D"/></a:dk2>',e[e.length]='<a:lt2><a:srgbClr val="EEECE1"/></a:lt2>',e[e.length]='<a:accent1><a:srgbClr val="4F81BD"/></a:accent1>',e[e.length]='<a:accent2><a:srgbClr val="C0504D"/></a:accent2>',e[e.length]='<a:accent3><a:srgbClr val="9BBB59"/></a:accent3>',e[e.length]='<a:accent4><a:srgbClr val="8064A2"/></a:accent4>',e[e.length]='<a:accent5><a:srgbClr val="4BACC6"/></a:accent5>',e[e.length]='<a:accent6><a:srgbClr val="F79646"/></a:accent6>',e[e.length]='<a:hlink><a:srgbClr val="0000FF"/></a:hlink>',e[e.length]='<a:folHlink><a:srgbClr val="800080"/></a:folHlink>',e[e.length]="</a:clrScheme>",e[e.length]='<a:fontScheme name="Office">',e[e.length]="<a:majorFont>",e[e.length]='<a:latin typeface="Cambria"/>',e[e.length]='<a:ea typeface=""/>',e[e.length]='<a:cs typeface=""/>',e[e.length]='<a:font script="Jpan" typeface="ＭＳ Ｐゴシック"/>',e[e.length]='<a:font script="Hang" typeface="맑은 고딕"/>',e[e.length]='<a:font script="Hans" typeface="宋体"/>',e[e.length]='<a:font script="Hant" typeface="新細明體"/>',e[e.length]='<a:font script="Arab" typeface="Times New Roman"/>',e[e.length]='<a:font script="Hebr" typeface="Times New Roman"/>',e[e.length]='<a:font script="Thai" typeface="Tahoma"/>',e[e.length]='<a:font script="Ethi" typeface="Nyala"/>',e[e.length]='<a:font script="Beng" typeface="Vrinda"/>',e[e.length]='<a:font script="Gujr" typeface="Shruti"/>',e[e.length]='<a:font script="Khmr" typeface="MoolBoran"/>',e[e.length]='<a:font script="Knda" typeface="Tunga"/>',e[e.length]='<a:font script="Guru" typeface="Raavi"/>',e[e.length]='<a:font script="Cans" typeface="Euphemia"/>',e[e.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',e[e.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',e[e.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',e[e.length]='<a:font script="Thaa" typeface="MV Boli"/>',e[e.length]='<a:font script="Deva" typeface="Mangal"/>',e[e.length]='<a:font script="Telu" typeface="Gautami"/>',e[e.length]='<a:font script="Taml" typeface="Latha"/>',e[e.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',e[e.length]='<a:font script="Orya" typeface="Kalinga"/>',e[e.length]='<a:font script="Mlym" typeface="Kartika"/>',e[e.length]='<a:font script="Laoo" typeface="DokChampa"/>',e[e.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',e[e.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',e[e.length]='<a:font script="Viet" typeface="Times New Roman"/>',e[e.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',e[e.length]='<a:font script="Geor" typeface="Sylfaen"/>',e[e.length]="</a:majorFont>",e[e.length]="<a:minorFont>",e[e.length]='<a:latin typeface="Calibri"/>',e[e.length]='<a:ea typeface=""/>',e[e.length]='<a:cs typeface=""/>',e[e.length]='<a:font script="Jpan" typeface="ＭＳ Ｐゴシック"/>',e[e.length]='<a:font script="Hang" typeface="맑은 고딕"/>',e[e.length]='<a:font script="Hans" typeface="宋体"/>',e[e.length]='<a:font script="Hant" typeface="新細明體"/>',e[e.length]='<a:font script="Arab" typeface="Arial"/>',e[e.length]='<a:font script="Hebr" typeface="Arial"/>',e[e.length]='<a:font script="Thai" typeface="Tahoma"/>',e[e.length]='<a:font script="Ethi" typeface="Nyala"/>',e[e.length]='<a:font script="Beng" typeface="Vrinda"/>',e[e.length]='<a:font script="Gujr" typeface="Shruti"/>',e[e.length]='<a:font script="Khmr" typeface="DaunPenh"/>',e[e.length]='<a:font script="Knda" typeface="Tunga"/>',e[e.length]='<a:font script="Guru" typeface="Raavi"/>',e[e.length]='<a:font script="Cans" typeface="Euphemia"/>',e[e.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',e[e.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',e[e.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',e[e.length]='<a:font script="Thaa" typeface="MV Boli"/>',e[e.length]='<a:font script="Deva" typeface="Mangal"/>',e[e.length]='<a:font script="Telu" typeface="Gautami"/>',e[e.length]='<a:font script="Taml" typeface="Latha"/>',e[e.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',e[e.length]='<a:font script="Orya" typeface="Kalinga"/>',e[e.length]='<a:font script="Mlym" typeface="Kartika"/>',e[e.length]='<a:font script="Laoo" typeface="DokChampa"/>',e[e.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',e[e.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',e[e.length]='<a:font script="Viet" typeface="Arial"/>',e[e.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',e[e.length]='<a:font script="Geor" typeface="Sylfaen"/>',e[e.length]="</a:minorFont>",e[e.length]="</a:fontScheme>",e[e.length]='<a:fmtScheme name="Office">',e[e.length]="<a:fillStyleLst>",e[e.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',e[e.length]='<a:gradFill rotWithShape="1">',e[e.length]="<a:gsLst>",e[e.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="50000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',e[e.length]='<a:gs pos="35000"><a:schemeClr val="phClr"><a:tint val="37000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',e[e.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="15000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',e[e.length]="</a:gsLst>",e[e.length]='<a:lin ang="16200000" scaled="1"/>',e[e.length]="</a:gradFill>",e[e.length]='<a:gradFill rotWithShape="1">',e[e.length]="<a:gsLst>",e[e.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="100000"/><a:shade val="100000"/><a:satMod val="130000"/></a:schemeClr></a:gs>',e[e.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="50000"/><a:shade val="100000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',e[e.length]="</a:gsLst>",e[e.length]='<a:lin ang="16200000" scaled="0"/>',e[e.length]="</a:gradFill>",e[e.length]="</a:fillStyleLst>",e[e.length]="<a:lnStyleLst>",e[e.length]='<a:ln w="9525" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"><a:shade val="95000"/><a:satMod val="105000"/></a:schemeClr></a:solidFill><a:prstDash val="solid"/></a:ln>',e[e.length]='<a:ln w="25400" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',e[e.length]='<a:ln w="38100" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',e[e.length]="</a:lnStyleLst>",e[e.length]="<a:effectStyleLst>",e[e.length]="<a:effectStyle>",e[e.length]="<a:effectLst>",e[e.length]='<a:outerShdw blurRad="40000" dist="20000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="38000"/></a:srgbClr></a:outerShdw>',e[e.length]="</a:effectLst>",e[e.length]="</a:effectStyle>",e[e.length]="<a:effectStyle>",e[e.length]="<a:effectLst>",e[e.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',e[e.length]="</a:effectLst>",e[e.length]="</a:effectStyle>",e[e.length]="<a:effectStyle>",e[e.length]="<a:effectLst>",e[e.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',e[e.length]="</a:effectLst>",e[e.length]='<a:scene3d><a:camera prst="orthographicFront"><a:rot lat="0" lon="0" rev="0"/></a:camera><a:lightRig rig="threePt" dir="t"><a:rot lat="0" lon="0" rev="1200000"/></a:lightRig></a:scene3d>',e[e.length]='<a:sp3d><a:bevelT w="63500" h="25400"/></a:sp3d>',e[e.length]="</a:effectStyle>",e[e.length]="</a:effectStyleLst>",e[e.length]="<a:bgFillStyleLst>",e[e.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',e[e.length]='<a:gradFill rotWithShape="1">',e[e.length]="<a:gsLst>",e[e.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="40000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',e[e.length]='<a:gs pos="40000"><a:schemeClr val="phClr"><a:tint val="45000"/><a:shade val="99000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',e[e.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="20000"/><a:satMod val="255000"/></a:schemeClr></a:gs>',e[e.length]="</a:gsLst>",e[e.length]='<a:path path="circle"><a:fillToRect l="50000" t="-80000" r="50000" b="180000"/></a:path>',e[e.length]="</a:gradFill>",e[e.length]='<a:gradFill rotWithShape="1">',e[e.length]="<a:gsLst>",e[e.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="80000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',e[e.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="30000"/><a:satMod val="200000"/></a:schemeClr></a:gs>',e[e.length]="</a:gsLst>",e[e.length]='<a:path path="circle"><a:fillToRect l="50000" t="50000" r="50000" b="50000"/></a:path>',e[e.length]="</a:gradFill>",e[e.length]="</a:bgFillStyleLst>",e[e.length]="</a:fmtScheme>",e[e.length]="</a:themeElements>",e[e.length]="<a:objectDefaults>",e[e.length]="<a:spDef>",e[e.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="1"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="3"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="2"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="lt1"/></a:fontRef></a:style>',e[e.length]="</a:spDef>",e[e.length]="<a:lnDef>",e[e.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="2"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="0"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="1"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="tx1"/></a:fontRef></a:style>',e[e.length]="</a:lnDef>",e[e.length]="</a:objectDefaults>",e[e.length]="<a:extraClrSchemeLst/>",e[e.length]="</a:theme>",e.join("")}function parse_BrtMdtinfo(t,r){return{flags:t.read_shift(4),version:t.read_shift(4),name:parse_XLWideString(t)}}function write_BrtMdtinfo(t){var r=new_buf(12+2*t.name.length);return r.write_shift(4,t.flags),r.write_shift(4,t.version),write_XLWideString(t.name,r),r.slice(0,r.l)}function parse_BrtMdb(t){for(var r=[],e=t.read_shift(4);e-- >0;)r.push([t.read_shift(4),t.read_shift(4)]);return r}function write_BrtMdb(t){var r=new_buf(4+8*t.length);r.write_shift(4,t.length);for(var e=0;e<t.length;++e)r.write_shift(4,t[e][0]),r.write_shift(4,t[e][1]);return r}function write_BrtBeginEsfmd(t,r){var e=new_buf(8+2*r.length);return e.write_shift(4,t),write_XLWideString(r,e),e.slice(0,e.l)}function parse_BrtBeginEsmdb(t){return t.l+=4,t.read_shift(4)!=0}function write_BrtBeginEsmdb(t,r){var e=new_buf(8);return e.write_shift(4,t),e.write_shift(4,1),e}function write_xlmeta_bin(){var t=buf_array();return write_record(t,332),write_record(t,334,write_UInt32LE(1)),write_record(t,335,write_BrtMdtinfo({name:"XLDAPR",version:12e4,flags:3496657072})),write_record(t,336),write_record(t,339,write_BrtBeginEsfmd(1,"XLDAPR")),write_record(t,52),write_record(t,35,write_UInt32LE(514)),write_record(t,4096,write_UInt32LE(0)),write_record(t,4097,writeuint16(1)),write_record(t,36),write_record(t,53),write_record(t,340),write_record(t,337,write_BrtBeginEsmdb(1)),write_record(t,51,write_BrtMdb([[1,0]])),write_record(t,338),write_record(t,333),t.end()}function write_xlmeta_xml(){var t=[XML_HEADER];return t.push(`<metadata xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main" xmlns:xlrd="http://schemas.microsoft.com/office/spreadsheetml/2017/richdata" xmlns:xda="http://schemas.microsoft.com/office/spreadsheetml/2017/dynamicarray">
  <metadataTypes count="1">
    <metadataType name="XLDAPR" minSupportedVersion="120000" copy="1" pasteAll="1" pasteValues="1" merge="1" splitFirst="1" rowColShift="1" clearFormats="1" clearComments="1" assign="1" coerce="1" cellMeta="1"/>
  </metadataTypes>
  <futureMetadata name="XLDAPR" count="1">
    <bk>
      <extLst>
        <ext uri="{bdbb8cdc-fa1e-496e-a857-3c3f30c029c3}">
          <xda:dynamicArrayProperties fDynamic="1" fCollapsed="0"/>
        </ext>
      </extLst>
    </bk>
  </futureMetadata>
  <cellMetadata count="1">
    <bk>
      <rc t="1" v="0"/>
    </bk>
  </cellMetadata>
</metadata>`),t.join("")}function parse_BrtCalcChainItem$(t){var r={};r.i=t.read_shift(4);var e={};e.r=t.read_shift(4),e.c=t.read_shift(4),r.r=encode_cell(e);var s=t.read_shift(1);return s&2&&(r.l="1"),s&8&&(r.a="1"),r}var _shapeid=1024;function write_comments_vml(t,r){for(var e=[21600,21600],s=["m0,0l0",e[1],e[0],e[1],e[0],"0xe"].join(","),a=[writextag("xml",null,{"xmlns:v":XLMLNS.v,"xmlns:o":XLMLNS.o,"xmlns:x":XLMLNS.x,"xmlns:mv":XLMLNS.mv}).replace(/\/>/,">"),writextag("o:shapelayout",writextag("o:idmap",null,{"v:ext":"edit",data:t}),{"v:ext":"edit"}),writextag("v:shapetype",[writextag("v:stroke",null,{joinstyle:"miter"}),writextag("v:path",null,{gradientshapeok:"t","o:connecttype":"rect"})].join(""),{id:"_x0000_t202","o:spt":202,coordsize:e.join(","),path:s})];_shapeid<t*1e3;)_shapeid+=1e3;return r.forEach(function(i){var o=decode_cell(i[0]),c={color2:"#BEFF82",type:"gradient"};c.type=="gradient"&&(c.angle="-180");var x=c.type=="gradient"?writextag("o:fill",null,{type:"gradientUnscaled","v:ext":"view"}):null,u=writextag("v:fill",x,c),h={on:"t",obscured:"t"};++_shapeid,a=a.concat(["<v:shape"+wxt_helper({id:"_x0000_s"+_shapeid,type:"#_x0000_t202",style:"position:absolute; margin-left:80pt;margin-top:5pt;width:104pt;height:64pt;z-index:10"+(i[1].hidden?";visibility:hidden":""),fillcolor:"#ECFAD4",strokecolor:"#edeaa1"})+">",u,writextag("v:shadow",null,h),writextag("v:path",null,{"o:connecttype":"none"}),'<v:textbox><div style="text-align:left"></div></v:textbox>','<x:ClientData ObjectType="Note">',"<x:MoveWithCells/>","<x:SizeWithCells/>",writetag("x:Anchor",[o.c+1,0,o.r+1,0,o.c+3,20,o.r+5,20].join(",")),writetag("x:AutoFill","False"),writetag("x:Row",String(o.r)),writetag("x:Column",String(o.c)),i[1].hidden?"":"<x:Visible/>","</x:ClientData>","</v:shape>"])}),a.push("</xml>"),a.join("")}function write_comments_xml(t){var r=[XML_HEADER,writextag("comments",null,{xmlns:XMLNS_main[0]})],e=[];return r.push("<authors>"),t.forEach(function(s){s[1].forEach(function(a){var i=escapexml(a.a);e.indexOf(i)==-1&&(e.push(i),r.push("<author>"+i+"</author>")),a.T&&a.ID&&e.indexOf("tc="+a.ID)==-1&&(e.push("tc="+a.ID),r.push("<author>tc="+a.ID+"</author>"))})}),e.length==0&&(e.push("SheetJ5"),r.push("<author>SheetJ5</author>")),r.push("</authors>"),r.push("<commentList>"),t.forEach(function(s){var a=0,i=[];if(s[1][0]&&s[1][0].T&&s[1][0].ID?a=e.indexOf("tc="+s[1][0].ID):s[1].forEach(function(x){x.a&&(a=e.indexOf(escapexml(x.a))),i.push(x.t||"")}),r.push('<comment ref="'+s[0]+'" authorId="'+a+'"><text>'),i.length<=1)r.push(writetag("t",escapexml(i[0]||"")));else{for(var o=`Comment:
    `+i[0]+`
`,c=1;c<i.length;++c)o+=`Reply:
    `+i[c]+`
`;r.push(writetag("t",escapexml(o)))}r.push("</text></comment>")}),r.push("</commentList>"),r.length>2&&(r[r.length]="</comments>",r[1]=r[1].replace("/>",">")),r.join("")}function write_tcmnt_xml(t,r,e){var s=[XML_HEADER,writextag("ThreadedComments",null,{xmlns:XMLNS.TCMNT}).replace(/[\/]>/,">")];return t.forEach(function(a){var i="";(a[1]||[]).forEach(function(o,c){if(!o.T){delete o.ID;return}o.a&&r.indexOf(o.a)==-1&&r.push(o.a);var x={ref:a[0],id:"{54EE7951-7262-4200-6969-"+("000000000000"+e.tcid++).slice(-12)+"}"};c==0?i=x.id:x.parentId=i,o.ID=x.id,o.a&&(x.personId="{54EE7950-7262-4200-6969-"+("000000000000"+r.indexOf(o.a)).slice(-12)+"}"),s.push(writextag("threadedComment",writetag("text",o.t||""),x))})}),s.push("</ThreadedComments>"),s.join("")}function write_people_xml(t){var r=[XML_HEADER,writextag("personList",null,{xmlns:XMLNS.TCMNT,"xmlns:x":XMLNS_main[0]}).replace(/[\/]>/,">")];return t.forEach(function(e,s){r.push(writextag("person",null,{displayName:e,id:"{54EE7950-7262-4200-6969-"+("000000000000"+s).slice(-12)+"}",userId:e,providerId:"None"}))}),r.push("</personList>"),r.join("")}function parse_BrtBeginComment(t){var r={};r.iauthor=t.read_shift(4);var e=parse_UncheckedRfX(t);return r.rfx=e.s,r.ref=encode_cell(e.s),t.l+=16,r}function write_BrtBeginComment(t,r){return r==null&&(r=new_buf(36)),r.write_shift(4,t[1].iauthor),write_UncheckedRfX(t[0],r),r.write_shift(4,0),r.write_shift(4,0),r.write_shift(4,0),r.write_shift(4,0),r}var parse_BrtCommentAuthor=parse_XLWideString;function write_BrtCommentAuthor(t){return write_XLWideString(t.slice(0,54))}function write_comments_bin(t){var r=buf_array(),e=[];return write_record(r,628),write_record(r,630),t.forEach(function(s){s[1].forEach(function(a){e.indexOf(a.a)>-1||(e.push(a.a.slice(0,54)),write_record(r,632,write_BrtCommentAuthor(a.a)))})}),write_record(r,631),write_record(r,633),t.forEach(function(s){s[1].forEach(function(a){a.iauthor=e.indexOf(a.a);var i={s:decode_cell(s[0]),e:decode_cell(s[0])};write_record(r,635,write_BrtBeginComment([i,a])),a.t&&a.t.length>0&&write_record(r,637,write_BrtCommentText(a)),write_record(r,636),delete a.iauthor})}),write_record(r,634),write_record(r,629),r.end()}function fill_vba_xls(t,r){r.FullPaths.forEach(function(e,s){if(s!=0){var a=e.replace(/[^\/]*[\/]/,"/_VBA_PROJECT_CUR/");a.slice(-1)!=="/"&&CFB.utils.cfb_add(t,a,r.FileIndex[s].content)}})}var VBAFMTS=["xlsb","xlsm","xlam","biff8","xla"],rc_to_a1=function(){var t=/(^|[^A-Za-z_])R(\[?-?\d+\]|[1-9]\d*|)C(\[?-?\d+\]|[1-9]\d*|)(?![A-Za-z0-9_])/g,r={r:0,c:0};function e(s,a,i,o){var c=!1,x=!1;i.length==0?x=!0:i.charAt(0)=="["&&(x=!0,i=i.slice(1,-1)),o.length==0?c=!0:o.charAt(0)=="["&&(c=!0,o=o.slice(1,-1));var u=i.length>0?parseInt(i,10)|0:0,h=o.length>0?parseInt(o,10)|0:0;return c?h+=r.c:--h,x?u+=r.r:--u,a+(c?"":"$")+encode_col(h)+(x?"":"$")+encode_row(u)}return function(a,i){return r=i,a.replace(t,e)}}(),crefregex=/(^|[^._A-Z0-9])([$]?)([A-Z]{1,2}|[A-W][A-Z]{2}|X[A-E][A-Z]|XF[A-D])([$]?)(10[0-3]\d{4}|104[0-7]\d{3}|1048[0-4]\d{2}|10485[0-6]\d|104857[0-6]|[1-9]\d{0,5})(?![_.\(A-Za-z0-9])/g,a1_to_rc=function(){return function(r,e){return r.replace(crefregex,function(s,a,i,o,c,x){var u=decode_col(o)-(i?0:e.c),h=decode_row(x)-(c?0:e.r),_=h==0?"":c?h+1:"["+h+"]",v=u==0?"":i?u+1:"["+u+"]";return a+"R"+_+"C"+v})}}();function shift_formula_str(t,r){return t.replace(crefregex,function(e,s,a,i,o,c){return s+(a=="$"?a+i:encode_col(decode_col(i)+r.c))+(o=="$"?o+c:encode_row(decode_row(c)+r.r))})}function fuzzyfmla(t){return t.length!=1}function parseread1(t){t.l+=1}function parse_ColRelU(t,r){var e=t.read_shift(2);return[e&16383,e>>14&1,e>>15&1]}function parse_RgceArea(t,r,e){var s=2;if(e){if(e.biff>=2&&e.biff<=5)return parse_RgceArea_BIFF2(t);e.biff==12&&(s=4)}var a=t.read_shift(s),i=t.read_shift(s),o=parse_ColRelU(t),c=parse_ColRelU(t);return{s:{r:a,c:o[0],cRel:o[1],rRel:o[2]},e:{r:i,c:c[0],cRel:c[1],rRel:c[2]}}}function parse_RgceArea_BIFF2(t){var r=parse_ColRelU(t),e=parse_ColRelU(t),s=t.read_shift(1),a=t.read_shift(1);return{s:{r:r[0],c:s,cRel:r[1],rRel:r[2]},e:{r:e[0],c:a,cRel:e[1],rRel:e[2]}}}function parse_RgceAreaRel(t,r,e){if(e.biff<8)return parse_RgceArea_BIFF2(t);var s=t.read_shift(e.biff==12?4:2),a=t.read_shift(e.biff==12?4:2),i=parse_ColRelU(t),o=parse_ColRelU(t);return{s:{r:s,c:i[0],cRel:i[1],rRel:i[2]},e:{r:a,c:o[0],cRel:o[1],rRel:o[2]}}}function parse_RgceLoc(t,r,e){if(e&&e.biff>=2&&e.biff<=5)return parse_RgceLoc_BIFF2(t);var s=t.read_shift(e&&e.biff==12?4:2),a=parse_ColRelU(t);return{r:s,c:a[0],cRel:a[1],rRel:a[2]}}function parse_RgceLoc_BIFF2(t){var r=parse_ColRelU(t),e=t.read_shift(1);return{r:r[0],c:e,cRel:r[1],rRel:r[2]}}function parse_RgceElfLoc(t){var r=t.read_shift(2),e=t.read_shift(2);return{r,c:e&255,fQuoted:!!(e&16384),cRel:e>>15,rRel:e>>15}}function parse_RgceLocRel(t,r,e){var s=e&&e.biff?e.biff:8;if(s>=2&&s<=5)return parse_RgceLocRel_BIFF2(t);var a=t.read_shift(s>=12?4:2),i=t.read_shift(2),o=(i&16384)>>14,c=(i&32768)>>15;if(i&=16383,c==1)for(;a>524287;)a-=1048576;if(o==1)for(;i>8191;)i=i-16384;return{r:a,c:i,cRel:o,rRel:c}}function parse_RgceLocRel_BIFF2(t){var r=t.read_shift(2),e=t.read_shift(1),s=(r&32768)>>15,a=(r&16384)>>14;return r&=16383,s==1&&r>=8192&&(r=r-16384),a==1&&e>=128&&(e=e-256),{r,c:e,cRel:a,rRel:s}}function parse_PtgArea(t,r,e){var s=(t[t.l++]&96)>>5,a=parse_RgceArea(t,e.biff>=2&&e.biff<=5?6:8,e);return[s,a]}function parse_PtgArea3d(t,r,e){var s=(t[t.l++]&96)>>5,a=t.read_shift(2,"i"),i=8;if(e)switch(e.biff){case 5:t.l+=12,i=6;break;case 12:i=12;break}var o=parse_RgceArea(t,i,e);return[s,a,o]}function parse_PtgAreaErr(t,r,e){var s=(t[t.l++]&96)>>5;return t.l+=e&&e.biff>8?12:e.biff<8?6:8,[s]}function parse_PtgAreaErr3d(t,r,e){var s=(t[t.l++]&96)>>5,a=t.read_shift(2),i=8;if(e)switch(e.biff){case 5:t.l+=12,i=6;break;case 12:i=12;break}return t.l+=i,[s,a]}function parse_PtgAreaN(t,r,e){var s=(t[t.l++]&96)>>5,a=parse_RgceAreaRel(t,r-1,e);return[s,a]}function parse_PtgArray(t,r,e){var s=(t[t.l++]&96)>>5;return t.l+=e.biff==2?6:e.biff==12?14:7,[s]}function parse_PtgAttrBaxcel(t){var r=t[t.l+1]&1,e=1;return t.l+=4,[r,e]}function parse_PtgAttrChoose(t,r,e){t.l+=2;for(var s=t.read_shift(e&&e.biff==2?1:2),a=[],i=0;i<=s;++i)a.push(t.read_shift(e&&e.biff==2?1:2));return a}function parse_PtgAttrGoto(t,r,e){var s=t[t.l+1]&255?1:0;return t.l+=2,[s,t.read_shift(e&&e.biff==2?1:2)]}function parse_PtgAttrIf(t,r,e){var s=t[t.l+1]&255?1:0;return t.l+=2,[s,t.read_shift(e&&e.biff==2?1:2)]}function parse_PtgAttrIfError(t){var r=t[t.l+1]&255?1:0;return t.l+=2,[r,t.read_shift(2)]}function parse_PtgAttrSemi(t,r,e){var s=t[t.l+1]&255?1:0;return t.l+=e&&e.biff==2?3:4,[s]}function parse_PtgAttrSpaceType(t){var r=t.read_shift(1),e=t.read_shift(1);return[r,e]}function parse_PtgAttrSpace(t){return t.read_shift(2),parse_PtgAttrSpaceType(t)}function parse_PtgAttrSpaceSemi(t){return t.read_shift(2),parse_PtgAttrSpaceType(t)}function parse_PtgRef(t,r,e){var s=(t[t.l]&96)>>5;t.l+=1;var a=parse_RgceLoc(t,0,e);return[s,a]}function parse_PtgRefN(t,r,e){var s=(t[t.l]&96)>>5;t.l+=1;var a=parse_RgceLocRel(t,0,e);return[s,a]}function parse_PtgRef3d(t,r,e){var s=(t[t.l]&96)>>5;t.l+=1;var a=t.read_shift(2);e&&e.biff==5&&(t.l+=12);var i=parse_RgceLoc(t,0,e);return[s,a,i]}function parse_PtgFunc(t,r,e){var s=(t[t.l]&96)>>5;t.l+=1;var a=t.read_shift(e&&e.biff<=3?1:2);return[FtabArgc[a],Ftab[a],s]}function parse_PtgFuncVar(t,r,e){var s=t[t.l++],a=t.read_shift(1),i=e&&e.biff<=3?[s==88?-1:0,t.read_shift(1)]:parsetab(t);return[a,(i[0]===0?Ftab:Cetab)[i[1]]]}function parsetab(t){return[t[t.l+1]>>7,t.read_shift(2)&32767]}function parse_PtgAttrSum(t,r,e){t.l+=e&&e.biff==2?3:4}function parse_PtgExp(t,r,e){if(t.l++,e&&e.biff==12)return[t.read_shift(4,"i"),0];var s=t.read_shift(2),a=t.read_shift(e&&e.biff==2?1:2);return[s,a]}function parse_PtgErr(t){return t.l++,BErr[t.read_shift(1)]}function parse_PtgInt(t){return t.l++,t.read_shift(2)}function parse_PtgBool(t){return t.l++,t.read_shift(1)!==0}function parse_PtgNum(t){return t.l++,parse_Xnum(t)}function parse_PtgStr(t,r,e){return t.l++,parse_ShortXLUnicodeString(t,r-1,e)}function parse_SerAr(t,r){var e=[t.read_shift(1)];if(r==12)switch(e[0]){case 2:e[0]=4;break;case 4:e[0]=16;break;case 0:e[0]=1;break;case 1:e[0]=2;break}switch(e[0]){case 4:e[1]=parsebool(t,1)?"TRUE":"FALSE",r!=12&&(t.l+=7);break;case 37:case 16:e[1]=BErr[t[t.l]],t.l+=r==12?4:8;break;case 0:t.l+=8;break;case 1:e[1]=parse_Xnum(t);break;case 2:e[1]=parse_XLUnicodeString2(t,0,{biff:r>0&&r<8?2:r});break;default:throw new Error("Bad SerAr: "+e[0])}return e}function parse_PtgExtraMem(t,r,e){for(var s=t.read_shift(e.biff==12?4:2),a=[],i=0;i!=s;++i)a.push((e.biff==12?parse_UncheckedRfX:parse_Ref8U)(t));return a}function parse_PtgExtraArray(t,r,e){var s=0,a=0;e.biff==12?(s=t.read_shift(4),a=t.read_shift(4)):(a=1+t.read_shift(1),s=1+t.read_shift(2)),e.biff>=2&&e.biff<8&&(--s,--a==0&&(a=256));for(var i=0,o=[];i!=s&&(o[i]=[]);++i)for(var c=0;c!=a;++c)o[i][c]=parse_SerAr(t,e.biff);return o}function parse_PtgName(t,r,e){var s=t.read_shift(1)>>>5&3,a=!e||e.biff>=8?4:2,i=t.read_shift(a);switch(e.biff){case 2:t.l+=5;break;case 3:case 4:t.l+=8;break;case 5:t.l+=12;break}return[s,0,i]}function parse_PtgNameX(t,r,e){if(e.biff==5)return parse_PtgNameX_BIFF5(t);var s=t.read_shift(1)>>>5&3,a=t.read_shift(2),i=t.read_shift(4);return[s,a,i]}function parse_PtgNameX_BIFF5(t){var r=t.read_shift(1)>>>5&3,e=t.read_shift(2,"i");t.l+=8;var s=t.read_shift(2);return t.l+=12,[r,e,s]}function parse_PtgMemArea(t,r,e){var s=t.read_shift(1)>>>5&3;t.l+=e&&e.biff==2?3:4;var a=t.read_shift(e&&e.biff==2?1:2);return[s,a]}function parse_PtgMemFunc(t,r,e){var s=t.read_shift(1)>>>5&3,a=t.read_shift(e&&e.biff==2?1:2);return[s,a]}function parse_PtgRefErr(t,r,e){var s=t.read_shift(1)>>>5&3;return t.l+=4,e.biff<8&&t.l--,e.biff==12&&(t.l+=2),[s]}function parse_PtgRefErr3d(t,r,e){var s=(t[t.l++]&96)>>5,a=t.read_shift(2),i=4;if(e)switch(e.biff){case 5:i=15;break;case 12:i=6;break}return t.l+=i,[s,a]}var parse_PtgMemErr=parsenoop,parse_PtgMemNoMem=parsenoop,parse_PtgTbl=parsenoop;function parse_PtgElfLoc(t,r,e){return t.l+=2,[parse_RgceElfLoc(t)]}function parse_PtgElfNoop(t){return t.l+=6,[]}var parse_PtgElfCol=parse_PtgElfLoc,parse_PtgElfColS=parse_PtgElfNoop,parse_PtgElfColSV=parse_PtgElfNoop,parse_PtgElfColV=parse_PtgElfLoc;function parse_PtgElfLel(t){return t.l+=2,[parseuint16(t),t.read_shift(2)&1]}var parse_PtgElfRadical=parse_PtgElfLoc,parse_PtgElfRadicalLel=parse_PtgElfLel,parse_PtgElfRadicalS=parse_PtgElfNoop,parse_PtgElfRw=parse_PtgElfLoc,parse_PtgElfRwV=parse_PtgElfLoc,PtgListRT=["Data","All","Headers","??","?Data2","??","?DataHeaders","??","Totals","??","??","??","?DataTotals","??","??","??","?Current"];function parse_PtgList(t){t.l+=2;var r=t.read_shift(2),e=t.read_shift(2),s=t.read_shift(4),a=t.read_shift(2),i=t.read_shift(2),o=PtgListRT[e>>2&31];return{ixti:r,coltype:e&3,rt:o,idx:s,c:a,C:i}}function parse_PtgSxName(t){return t.l+=2,[t.read_shift(4)]}function parse_PtgSheet(t,r,e){return t.l+=5,t.l+=2,t.l+=e.biff==2?1:4,["PTGSHEET"]}function parse_PtgEndSheet(t,r,e){return t.l+=e.biff==2?4:5,["PTGENDSHEET"]}function parse_PtgMemAreaN(t){var r=t.read_shift(1)>>>5&3,e=t.read_shift(2);return[r,e]}function parse_PtgMemNoMemN(t){var r=t.read_shift(1)>>>5&3,e=t.read_shift(2);return[r,e]}function parse_PtgAttrNoop(t){return t.l+=4,[0,0]}var PtgTypes={1:{n:"PtgExp",f:parse_PtgExp},2:{n:"PtgTbl",f:parse_PtgTbl},3:{n:"PtgAdd",f:parseread1},4:{n:"PtgSub",f:parseread1},5:{n:"PtgMul",f:parseread1},6:{n:"PtgDiv",f:parseread1},7:{n:"PtgPower",f:parseread1},8:{n:"PtgConcat",f:parseread1},9:{n:"PtgLt",f:parseread1},10:{n:"PtgLe",f:parseread1},11:{n:"PtgEq",f:parseread1},12:{n:"PtgGe",f:parseread1},13:{n:"PtgGt",f:parseread1},14:{n:"PtgNe",f:parseread1},15:{n:"PtgIsect",f:parseread1},16:{n:"PtgUnion",f:parseread1},17:{n:"PtgRange",f:parseread1},18:{n:"PtgUplus",f:parseread1},19:{n:"PtgUminus",f:parseread1},20:{n:"PtgPercent",f:parseread1},21:{n:"PtgParen",f:parseread1},22:{n:"PtgMissArg",f:parseread1},23:{n:"PtgStr",f:parse_PtgStr},26:{n:"PtgSheet",f:parse_PtgSheet},27:{n:"PtgEndSheet",f:parse_PtgEndSheet},28:{n:"PtgErr",f:parse_PtgErr},29:{n:"PtgBool",f:parse_PtgBool},30:{n:"PtgInt",f:parse_PtgInt},31:{n:"PtgNum",f:parse_PtgNum},32:{n:"PtgArray",f:parse_PtgArray},33:{n:"PtgFunc",f:parse_PtgFunc},34:{n:"PtgFuncVar",f:parse_PtgFuncVar},35:{n:"PtgName",f:parse_PtgName},36:{n:"PtgRef",f:parse_PtgRef},37:{n:"PtgArea",f:parse_PtgArea},38:{n:"PtgMemArea",f:parse_PtgMemArea},39:{n:"PtgMemErr",f:parse_PtgMemErr},40:{n:"PtgMemNoMem",f:parse_PtgMemNoMem},41:{n:"PtgMemFunc",f:parse_PtgMemFunc},42:{n:"PtgRefErr",f:parse_PtgRefErr},43:{n:"PtgAreaErr",f:parse_PtgAreaErr},44:{n:"PtgRefN",f:parse_PtgRefN},45:{n:"PtgAreaN",f:parse_PtgAreaN},46:{n:"PtgMemAreaN",f:parse_PtgMemAreaN},47:{n:"PtgMemNoMemN",f:parse_PtgMemNoMemN},57:{n:"PtgNameX",f:parse_PtgNameX},58:{n:"PtgRef3d",f:parse_PtgRef3d},59:{n:"PtgArea3d",f:parse_PtgArea3d},60:{n:"PtgRefErr3d",f:parse_PtgRefErr3d},61:{n:"PtgAreaErr3d",f:parse_PtgAreaErr3d},255:{}},PtgDupes={64:32,96:32,65:33,97:33,66:34,98:34,67:35,99:35,68:36,100:36,69:37,101:37,70:38,102:38,71:39,103:39,72:40,104:40,73:41,105:41,74:42,106:42,75:43,107:43,76:44,108:44,77:45,109:45,78:46,110:46,79:47,111:47,88:34,120:34,89:57,121:57,90:58,122:58,91:59,123:59,92:60,124:60,93:61,125:61},Ptg18={1:{n:"PtgElfLel",f:parse_PtgElfLel},2:{n:"PtgElfRw",f:parse_PtgElfRw},3:{n:"PtgElfCol",f:parse_PtgElfCol},6:{n:"PtgElfRwV",f:parse_PtgElfRwV},7:{n:"PtgElfColV",f:parse_PtgElfColV},10:{n:"PtgElfRadical",f:parse_PtgElfRadical},11:{n:"PtgElfRadicalS",f:parse_PtgElfRadicalS},13:{n:"PtgElfColS",f:parse_PtgElfColS},15:{n:"PtgElfColSV",f:parse_PtgElfColSV},16:{n:"PtgElfRadicalLel",f:parse_PtgElfRadicalLel},25:{n:"PtgList",f:parse_PtgList},29:{n:"PtgSxName",f:parse_PtgSxName},255:{}},Ptg19={0:{n:"PtgAttrNoop",f:parse_PtgAttrNoop},1:{n:"PtgAttrSemi",f:parse_PtgAttrSemi},2:{n:"PtgAttrIf",f:parse_PtgAttrIf},4:{n:"PtgAttrChoose",f:parse_PtgAttrChoose},8:{n:"PtgAttrGoto",f:parse_PtgAttrGoto},16:{n:"PtgAttrSum",f:parse_PtgAttrSum},32:{n:"PtgAttrBaxcel",f:parse_PtgAttrBaxcel},33:{n:"PtgAttrBaxcel",f:parse_PtgAttrBaxcel},64:{n:"PtgAttrSpace",f:parse_PtgAttrSpace},65:{n:"PtgAttrSpaceSemi",f:parse_PtgAttrSpaceSemi},128:{n:"PtgAttrIfError",f:parse_PtgAttrIfError},255:{}};function parse_RgbExtra(t,r,e,s){if(s.biff<8)return parsenoop(t,r);for(var a=t.l+r,i=[],o=0;o!==e.length;++o)switch(e[o][0]){case"PtgArray":e[o][1]=parse_PtgExtraArray(t,0,s),i.push(e[o][1]);break;case"PtgMemArea":e[o][2]=parse_PtgExtraMem(t,e[o][1],s),i.push(e[o][2]);break;case"PtgExp":s&&s.biff==12&&(e[o][1][1]=t.read_shift(4),i.push(e[o][1]));break;case"PtgList":case"PtgElfRadicalS":case"PtgElfColS":case"PtgElfColSV":throw"Unsupported "+e[o][0]}return r=a-t.l,r!==0&&i.push(parsenoop(t,r)),i}function parse_Rgce(t,r,e){for(var s=t.l+r,a,i,o=[];s!=t.l;)r=s-t.l,i=t[t.l],a=PtgTypes[i]||PtgTypes[PtgDupes[i]],(i===24||i===25)&&(a=(i===24?Ptg18:Ptg19)[t[t.l+1]]),!a||!a.f?parsenoop(t,r):o.push([a.n,a.f(t,r,e)]);return o}function stringify_array(t){for(var r=[],e=0;e<t.length;++e){for(var s=t[e],a=[],i=0;i<s.length;++i){var o=s[i];if(o)switch(o[0]){case 2:a.push('"'+o[1].replace(/"/g,'""')+'"');break;default:a.push(o[1])}else a.push("")}r.push(a.join(","))}return r.join(";")}var PtgBinOp={PtgAdd:"+",PtgConcat:"&",PtgDiv:"/",PtgEq:"=",PtgGe:">=",PtgGt:">",PtgLe:"<=",PtgLt:"<",PtgMul:"*",PtgNe:"<>",PtgPower:"^",PtgSub:"-"};function formula_quote_sheet_name(t,r){if(!t&&!(r&&r.biff<=5&&r.biff>=2))throw new Error("empty sheet name");return/[^\w\u4E00-\u9FFF\u3040-\u30FF]/.test(t)?"'"+t+"'":t}function get_ixti_raw(t,r,e){if(!t)return"SH33TJSERR0";if(e.biff>8&&(!t.XTI||!t.XTI[r]))return t.SheetNames[r];if(!t.XTI)return"SH33TJSERR6";var s=t.XTI[r];if(e.biff<8)return r>1e4&&(r-=65536),r<0&&(r=-r),r==0?"":t.XTI[r-1];if(!s)return"SH33TJSERR1";var a="";if(e.biff>8)switch(t[s[0]][0]){case 357:return a=s[1]==-1?"#REF":t.SheetNames[s[1]],s[1]==s[2]?a:a+":"+t.SheetNames[s[2]];case 358:return e.SID!=null?t.SheetNames[e.SID]:"SH33TJSSAME"+t[s[0]][0];case 355:default:return"SH33TJSSRC"+t[s[0]][0]}switch(t[s[0]][0][0]){case 1025:return a=s[1]==-1?"#REF":t.SheetNames[s[1]]||"SH33TJSERR3",s[1]==s[2]?a:a+":"+t.SheetNames[s[2]];case 14849:return t[s[0]].slice(1).map(function(i){return i.Name}).join(";;");default:return t[s[0]][0][3]?(a=s[1]==-1?"#REF":t[s[0]][0][3][s[1]]||"SH33TJSERR4",s[1]==s[2]?a:a+":"+t[s[0]][0][3][s[2]]):"SH33TJSERR2"}}function get_ixti(t,r,e){var s=get_ixti_raw(t,r,e);return s=="#REF"?s:formula_quote_sheet_name(s,e)}function stringify_formula(t,r,e,s,a){var i=a&&a.biff||8,o={s:{c:0,r:0}},c=[],x,u,h,_=0,v=0,b,E="";if(!t[0]||!t[0][0])return"";for(var d=-1,g="",y=0,R=t[0].length;y<R;++y){var P=t[0][y];switch(P[0]){case"PtgUminus":c.push("-"+c.pop());break;case"PtgUplus":c.push("+"+c.pop());break;case"PtgPercent":c.push(c.pop()+"%");break;case"PtgAdd":case"PtgConcat":case"PtgDiv":case"PtgEq":case"PtgGe":case"PtgGt":case"PtgLe":case"PtgLt":case"PtgMul":case"PtgNe":case"PtgPower":case"PtgSub":if(x=c.pop(),u=c.pop(),d>=0){switch(t[0][d][1][0]){case 0:g=fill(" ",t[0][d][1][1]);break;case 1:g=fill("\r",t[0][d][1][1]);break;default:if(g="",a.WTF)throw new Error("Unexpected PtgAttrSpaceType "+t[0][d][1][0])}u=u+g,d=-1}c.push(u+PtgBinOp[P[0]]+x);break;case"PtgIsect":x=c.pop(),u=c.pop(),c.push(u+" "+x);break;case"PtgUnion":x=c.pop(),u=c.pop(),c.push(u+","+x);break;case"PtgRange":x=c.pop(),u=c.pop(),c.push(u+":"+x);break;case"PtgAttrChoose":break;case"PtgAttrGoto":break;case"PtgAttrIf":break;case"PtgAttrIfError":break;case"PtgRef":h=shift_cell_xls(P[1][1],o,a),c.push(encode_cell_xls(h,i));break;case"PtgRefN":h=e?shift_cell_xls(P[1][1],e,a):P[1][1],c.push(encode_cell_xls(h,i));break;case"PtgRef3d":_=P[1][1],h=shift_cell_xls(P[1][2],o,a),E=get_ixti(s,_,a),c.push(E+"!"+encode_cell_xls(h,i));break;case"PtgFunc":case"PtgFuncVar":var F=P[1][0],S=P[1][1];F||(F=0),F&=127;var I=F==0?[]:c.slice(-F);c.length-=F,S==="User"&&(S=I.shift()),c.push(S+"("+I.join(",")+")");break;case"PtgBool":c.push(P[1]?"TRUE":"FALSE");break;case"PtgInt":c.push(P[1]);break;case"PtgNum":c.push(String(P[1]));break;case"PtgStr":c.push('"'+P[1].replace(/"/g,'""')+'"');break;case"PtgErr":c.push(P[1]);break;case"PtgAreaN":b=shift_range_xls(P[1][1],e?{s:e}:o,a),c.push(encode_range_xls(b,a));break;case"PtgArea":b=shift_range_xls(P[1][1],o,a),c.push(encode_range_xls(b,a));break;case"PtgArea3d":_=P[1][1],b=P[1][2],E=get_ixti(s,_,a),c.push(E+"!"+encode_range_xls(b,a));break;case"PtgAttrSum":c.push("SUM("+c.pop()+")");break;case"PtgAttrBaxcel":case"PtgAttrSemi":break;case"PtgName":v=P[1][2];var w=(s.names||[])[v-1]||(s[0]||[])[v],j=w?w.Name:"SH33TJSNAME"+String(v);j&&j.slice(0,6)=="_xlfn."&&!a.xlfn&&(j=j.slice(6)),c.push(j);break;case"PtgNameX":var C=P[1][1];v=P[1][2];var V;if(a.biff<=5)C<0&&(C=-C),s[C]&&(V=s[C][v]);else{var O="";if(((s[C]||[])[0]||[])[0]==14849||(((s[C]||[])[0]||[])[0]==1025?s[C][v]&&s[C][v].itab>0&&(O=s.SheetNames[s[C][v].itab-1]+"!"):O=s.SheetNames[v-1]+"!"),s[C]&&s[C][v])O+=s[C][v].Name;else if(s[0]&&s[0][v])O+=s[0][v].Name;else{var H=(get_ixti_raw(s,C,a)||"").split(";;");H[v-1]?O=H[v-1]:O+="SH33TJSERRX"}c.push(O);break}V||(V={Name:"SH33TJSERRY"}),c.push(V.Name);break;case"PtgParen":var z="(",pe=")";if(d>=0){switch(g="",t[0][d][1][0]){case 2:z=fill(" ",t[0][d][1][1])+z;break;case 3:z=fill("\r",t[0][d][1][1])+z;break;case 4:pe=fill(" ",t[0][d][1][1])+pe;break;case 5:pe=fill("\r",t[0][d][1][1])+pe;break;default:if(a.WTF)throw new Error("Unexpected PtgAttrSpaceType "+t[0][d][1][0])}d=-1}c.push(z+c.pop()+pe);break;case"PtgRefErr":c.push("#REF!");break;case"PtgRefErr3d":c.push("#REF!");break;case"PtgExp":h={c:P[1][1],r:P[1][0]};var ee={c:e.c,r:e.r};if(s.sharedf[encode_cell(h)]){var he=s.sharedf[encode_cell(h)];c.push(stringify_formula(he,o,ee,s,a))}else{var re=!1;for(x=0;x!=s.arrayf.length;++x)if(u=s.arrayf[x],!(h.c<u[0].s.c||h.c>u[0].e.c)&&!(h.r<u[0].s.r||h.r>u[0].e.r)){c.push(stringify_formula(u[1],o,ee,s,a)),re=!0;break}re||c.push(P[1])}break;case"PtgArray":c.push("{"+stringify_array(P[1])+"}");break;case"PtgMemArea":break;case"PtgAttrSpace":case"PtgAttrSpaceSemi":d=y;break;case"PtgTbl":break;case"PtgMemErr":break;case"PtgMissArg":c.push("");break;case"PtgAreaErr":c.push("#REF!");break;case"PtgAreaErr3d":c.push("#REF!");break;case"PtgList":c.push("Table"+P[1].idx+"[#"+P[1].rt+"]");break;case"PtgMemAreaN":case"PtgMemNoMemN":case"PtgAttrNoop":case"PtgSheet":case"PtgEndSheet":break;case"PtgMemFunc":break;case"PtgMemNoMem":break;case"PtgElfCol":case"PtgElfColS":case"PtgElfColSV":case"PtgElfColV":case"PtgElfLel":case"PtgElfRadical":case"PtgElfRadicalLel":case"PtgElfRadicalS":case"PtgElfRw":case"PtgElfRwV":throw new Error("Unsupported ELFs");case"PtgSxName":throw new Error("Unrecognized Formula Token: "+String(P));default:throw new Error("Unrecognized Formula Token: "+String(P))}var me=["PtgAttrSpace","PtgAttrSpaceSemi","PtgAttrGoto"];if(a.biff!=3&&d>=0&&me.indexOf(t[0][y][0])==-1){P=t[0][d];var te=!0;switch(P[1][0]){case 4:te=!1;case 0:g=fill(" ",P[1][1]);break;case 5:te=!1;case 1:g=fill("\r",P[1][1]);break;default:if(g="",a.WTF)throw new Error("Unexpected PtgAttrSpaceType "+P[1][0])}c.push((te?g:"")+c.pop()+(te?"":g)),d=-1}}if(c.length>1&&a.WTF)throw new Error("bad formula stack");return c[0]}function write_FormulaValue(t){if(t==null){var r=new_buf(8);return r.write_shift(1,3),r.write_shift(1,0),r.write_shift(2,0),r.write_shift(2,0),r.write_shift(2,65535),r}else if(typeof t=="number")return write_Xnum(t);return write_Xnum(0)}function write_Formula(t,r,e,s,a){var i=write_XLSCell(r,e,a),o=write_FormulaValue(t.v),c=new_buf(6),x=33;c.write_shift(2,x),c.write_shift(4,0);for(var u=new_buf(t.bf.length),h=0;h<t.bf.length;++h)u[h]=t.bf[h];var _=bconcat([i,o,c,u]);return _}function parse_XLSBParsedFormula(t,r,e){var s=t.read_shift(4),a=parse_Rgce(t,s,e),i=t.read_shift(4),o=i>0?parse_RgbExtra(t,i,a,e):null;return[a,o]}var parse_XLSBArrayParsedFormula=parse_XLSBParsedFormula,parse_XLSBCellParsedFormula=parse_XLSBParsedFormula,parse_XLSBNameParsedFormula=parse_XLSBParsedFormula,parse_XLSBSharedParsedFormula=parse_XLSBParsedFormula,Cetab={0:"BEEP",1:"OPEN",2:"OPEN.LINKS",3:"CLOSE.ALL",4:"SAVE",5:"SAVE.AS",6:"FILE.DELETE",7:"PAGE.SETUP",8:"PRINT",9:"PRINTER.SETUP",10:"QUIT",11:"NEW.WINDOW",12:"ARRANGE.ALL",13:"WINDOW.SIZE",14:"WINDOW.MOVE",15:"FULL",16:"CLOSE",17:"RUN",22:"SET.PRINT.AREA",23:"SET.PRINT.TITLES",24:"SET.PAGE.BREAK",25:"REMOVE.PAGE.BREAK",26:"FONT",27:"DISPLAY",28:"PROTECT.DOCUMENT",29:"PRECISION",30:"A1.R1C1",31:"CALCULATE.NOW",32:"CALCULATION",34:"DATA.FIND",35:"EXTRACT",36:"DATA.DELETE",37:"SET.DATABASE",38:"SET.CRITERIA",39:"SORT",40:"DATA.SERIES",41:"TABLE",42:"FORMAT.NUMBER",43:"ALIGNMENT",44:"STYLE",45:"BORDER",46:"CELL.PROTECTION",47:"COLUMN.WIDTH",48:"UNDO",49:"CUT",50:"COPY",51:"PASTE",52:"CLEAR",53:"PASTE.SPECIAL",54:"EDIT.DELETE",55:"INSERT",56:"FILL.RIGHT",57:"FILL.DOWN",61:"DEFINE.NAME",62:"CREATE.NAMES",63:"FORMULA.GOTO",64:"FORMULA.FIND",65:"SELECT.LAST.CELL",66:"SHOW.ACTIVE.CELL",67:"GALLERY.AREA",68:"GALLERY.BAR",69:"GALLERY.COLUMN",70:"GALLERY.LINE",71:"GALLERY.PIE",72:"GALLERY.SCATTER",73:"COMBINATION",74:"PREFERRED",75:"ADD.OVERLAY",76:"GRIDLINES",77:"SET.PREFERRED",78:"AXES",79:"LEGEND",80:"ATTACH.TEXT",81:"ADD.ARROW",82:"SELECT.CHART",83:"SELECT.PLOT.AREA",84:"PATTERNS",85:"MAIN.CHART",86:"OVERLAY",87:"SCALE",88:"FORMAT.LEGEND",89:"FORMAT.TEXT",90:"EDIT.REPEAT",91:"PARSE",92:"JUSTIFY",93:"HIDE",94:"UNHIDE",95:"WORKSPACE",96:"FORMULA",97:"FORMULA.FILL",98:"FORMULA.ARRAY",99:"DATA.FIND.NEXT",100:"DATA.FIND.PREV",101:"FORMULA.FIND.NEXT",102:"FORMULA.FIND.PREV",103:"ACTIVATE",104:"ACTIVATE.NEXT",105:"ACTIVATE.PREV",106:"UNLOCKED.NEXT",107:"UNLOCKED.PREV",108:"COPY.PICTURE",109:"SELECT",110:"DELETE.NAME",111:"DELETE.FORMAT",112:"VLINE",113:"HLINE",114:"VPAGE",115:"HPAGE",116:"VSCROLL",117:"HSCROLL",118:"ALERT",119:"NEW",120:"CANCEL.COPY",121:"SHOW.CLIPBOARD",122:"MESSAGE",124:"PASTE.LINK",125:"APP.ACTIVATE",126:"DELETE.ARROW",127:"ROW.HEIGHT",128:"FORMAT.MOVE",129:"FORMAT.SIZE",130:"FORMULA.REPLACE",131:"SEND.KEYS",132:"SELECT.SPECIAL",133:"APPLY.NAMES",134:"REPLACE.FONT",135:"FREEZE.PANES",136:"SHOW.INFO",137:"SPLIT",138:"ON.WINDOW",139:"ON.DATA",140:"DISABLE.INPUT",142:"OUTLINE",143:"LIST.NAMES",144:"FILE.CLOSE",145:"SAVE.WORKBOOK",146:"DATA.FORM",147:"COPY.CHART",148:"ON.TIME",149:"WAIT",150:"FORMAT.FONT",151:"FILL.UP",152:"FILL.LEFT",153:"DELETE.OVERLAY",155:"SHORT.MENUS",159:"SET.UPDATE.STATUS",161:"COLOR.PALETTE",162:"DELETE.STYLE",163:"WINDOW.RESTORE",164:"WINDOW.MAXIMIZE",166:"CHANGE.LINK",167:"CALCULATE.DOCUMENT",168:"ON.KEY",169:"APP.RESTORE",170:"APP.MOVE",171:"APP.SIZE",172:"APP.MINIMIZE",173:"APP.MAXIMIZE",174:"BRING.TO.FRONT",175:"SEND.TO.BACK",185:"MAIN.CHART.TYPE",186:"OVERLAY.CHART.TYPE",187:"SELECT.END",188:"OPEN.MAIL",189:"SEND.MAIL",190:"STANDARD.FONT",191:"CONSOLIDATE",192:"SORT.SPECIAL",193:"GALLERY.3D.AREA",194:"GALLERY.3D.COLUMN",195:"GALLERY.3D.LINE",196:"GALLERY.3D.PIE",197:"VIEW.3D",198:"GOAL.SEEK",199:"WORKGROUP",200:"FILL.GROUP",201:"UPDATE.LINK",202:"PROMOTE",203:"DEMOTE",204:"SHOW.DETAIL",206:"UNGROUP",207:"OBJECT.PROPERTIES",208:"SAVE.NEW.OBJECT",209:"SHARE",210:"SHARE.NAME",211:"DUPLICATE",212:"APPLY.STYLE",213:"ASSIGN.TO.OBJECT",214:"OBJECT.PROTECTION",215:"HIDE.OBJECT",216:"SET.EXTRACT",217:"CREATE.PUBLISHER",218:"SUBSCRIBE.TO",219:"ATTRIBUTES",220:"SHOW.TOOLBAR",222:"PRINT.PREVIEW",223:"EDIT.COLOR",224:"SHOW.LEVELS",225:"FORMAT.MAIN",226:"FORMAT.OVERLAY",227:"ON.RECALC",228:"EDIT.SERIES",229:"DEFINE.STYLE",240:"LINE.PRINT",243:"ENTER.DATA",249:"GALLERY.RADAR",250:"MERGE.STYLES",251:"EDITION.OPTIONS",252:"PASTE.PICTURE",253:"PASTE.PICTURE.LINK",254:"SPELLING",256:"ZOOM",259:"INSERT.OBJECT",260:"WINDOW.MINIMIZE",265:"SOUND.NOTE",266:"SOUND.PLAY",267:"FORMAT.SHAPE",268:"EXTEND.POLYGON",269:"FORMAT.AUTO",272:"GALLERY.3D.BAR",273:"GALLERY.3D.SURFACE",274:"FILL.AUTO",276:"CUSTOMIZE.TOOLBAR",277:"ADD.TOOL",278:"EDIT.OBJECT",279:"ON.DOUBLECLICK",280:"ON.ENTRY",281:"WORKBOOK.ADD",282:"WORKBOOK.MOVE",283:"WORKBOOK.COPY",284:"WORKBOOK.OPTIONS",285:"SAVE.WORKSPACE",288:"CHART.WIZARD",289:"DELETE.TOOL",290:"MOVE.TOOL",291:"WORKBOOK.SELECT",292:"WORKBOOK.ACTIVATE",293:"ASSIGN.TO.TOOL",295:"COPY.TOOL",296:"RESET.TOOL",297:"CONSTRAIN.NUMERIC",298:"PASTE.TOOL",302:"WORKBOOK.NEW",305:"SCENARIO.CELLS",306:"SCENARIO.DELETE",307:"SCENARIO.ADD",308:"SCENARIO.EDIT",309:"SCENARIO.SHOW",310:"SCENARIO.SHOW.NEXT",311:"SCENARIO.SUMMARY",312:"PIVOT.TABLE.WIZARD",313:"PIVOT.FIELD.PROPERTIES",314:"PIVOT.FIELD",315:"PIVOT.ITEM",316:"PIVOT.ADD.FIELDS",318:"OPTIONS.CALCULATION",319:"OPTIONS.EDIT",320:"OPTIONS.VIEW",321:"ADDIN.MANAGER",322:"MENU.EDITOR",323:"ATTACH.TOOLBARS",324:"VBAActivate",325:"OPTIONS.CHART",328:"VBA.INSERT.FILE",330:"VBA.PROCEDURE.DEFINITION",336:"ROUTING.SLIP",338:"ROUTE.DOCUMENT",339:"MAIL.LOGON",342:"INSERT.PICTURE",343:"EDIT.TOOL",344:"GALLERY.DOUGHNUT",350:"CHART.TREND",352:"PIVOT.ITEM.PROPERTIES",354:"WORKBOOK.INSERT",355:"OPTIONS.TRANSITION",356:"OPTIONS.GENERAL",370:"FILTER.ADVANCED",373:"MAIL.ADD.MAILER",374:"MAIL.DELETE.MAILER",375:"MAIL.REPLY",376:"MAIL.REPLY.ALL",377:"MAIL.FORWARD",378:"MAIL.NEXT.LETTER",379:"DATA.LABEL",380:"INSERT.TITLE",381:"FONT.PROPERTIES",382:"MACRO.OPTIONS",383:"WORKBOOK.HIDE",384:"WORKBOOK.UNHIDE",385:"WORKBOOK.DELETE",386:"WORKBOOK.NAME",388:"GALLERY.CUSTOM",390:"ADD.CHART.AUTOFORMAT",391:"DELETE.CHART.AUTOFORMAT",392:"CHART.ADD.DATA",393:"AUTO.OUTLINE",394:"TAB.ORDER",395:"SHOW.DIALOG",396:"SELECT.ALL",397:"UNGROUP.SHEETS",398:"SUBTOTAL.CREATE",399:"SUBTOTAL.REMOVE",400:"RENAME.OBJECT",412:"WORKBOOK.SCROLL",413:"WORKBOOK.NEXT",414:"WORKBOOK.PREV",415:"WORKBOOK.TAB.SPLIT",416:"FULL.SCREEN",417:"WORKBOOK.PROTECT",420:"SCROLLBAR.PROPERTIES",421:"PIVOT.SHOW.PAGES",422:"TEXT.TO.COLUMNS",423:"FORMAT.CHARTTYPE",424:"LINK.FORMAT",425:"TRACER.DISPLAY",430:"TRACER.NAVIGATE",431:"TRACER.CLEAR",432:"TRACER.ERROR",433:"PIVOT.FIELD.GROUP",434:"PIVOT.FIELD.UNGROUP",435:"CHECKBOX.PROPERTIES",436:"LABEL.PROPERTIES",437:"LISTBOX.PROPERTIES",438:"EDITBOX.PROPERTIES",439:"PIVOT.REFRESH",440:"LINK.COMBO",441:"OPEN.TEXT",442:"HIDE.DIALOG",443:"SET.DIALOG.FOCUS",444:"ENABLE.OBJECT",445:"PUSHBUTTON.PROPERTIES",446:"SET.DIALOG.DEFAULT",447:"FILTER",448:"FILTER.SHOW.ALL",449:"CLEAR.OUTLINE",450:"FUNCTION.WIZARD",451:"ADD.LIST.ITEM",452:"SET.LIST.ITEM",453:"REMOVE.LIST.ITEM",454:"SELECT.LIST.ITEM",455:"SET.CONTROL.VALUE",456:"SAVE.COPY.AS",458:"OPTIONS.LISTS.ADD",459:"OPTIONS.LISTS.DELETE",460:"SERIES.AXES",461:"SERIES.X",462:"SERIES.Y",463:"ERRORBAR.X",464:"ERRORBAR.Y",465:"FORMAT.CHART",466:"SERIES.ORDER",467:"MAIL.LOGOFF",468:"CLEAR.ROUTING.SLIP",469:"APP.ACTIVATE.MICROSOFT",470:"MAIL.EDIT.MAILER",471:"ON.SHEET",472:"STANDARD.WIDTH",473:"SCENARIO.MERGE",474:"SUMMARY.INFO",475:"FIND.FILE",476:"ACTIVE.CELL.FONT",477:"ENABLE.TIPWIZARD",478:"VBA.MAKE.ADDIN",480:"INSERTDATATABLE",481:"WORKGROUP.OPTIONS",482:"MAIL.SEND.MAILER",485:"AUTOCORRECT",489:"POST.DOCUMENT",491:"PICKLIST",493:"VIEW.SHOW",494:"VIEW.DEFINE",495:"VIEW.DELETE",509:"SHEET.BACKGROUND",510:"INSERT.MAP.OBJECT",511:"OPTIONS.MENONO",517:"MSOCHECKS",518:"NORMAL",519:"LAYOUT",520:"RM.PRINT.AREA",521:"CLEAR.PRINT.AREA",522:"ADD.PRINT.AREA",523:"MOVE.BRK",545:"HIDECURR.NOTE",546:"HIDEALL.NOTES",547:"DELETE.NOTE",548:"TRAVERSE.NOTES",549:"ACTIVATE.NOTES",620:"PROTECT.REVISIONS",621:"UNPROTECT.REVISIONS",647:"OPTIONS.ME",653:"WEB.PUBLISH",667:"NEWWEBQUERY",673:"PIVOT.TABLE.CHART",753:"OPTIONS.SAVE",755:"OPTIONS.SPELL",808:"HIDEALL.INKANNOTS"},Ftab={0:"COUNT",1:"IF",2:"ISNA",3:"ISERROR",4:"SUM",5:"AVERAGE",6:"MIN",7:"MAX",8:"ROW",9:"COLUMN",10:"NA",11:"NPV",12:"STDEV",13:"DOLLAR",14:"FIXED",15:"SIN",16:"COS",17:"TAN",18:"ATAN",19:"PI",20:"SQRT",21:"EXP",22:"LN",23:"LOG10",24:"ABS",25:"INT",26:"SIGN",27:"ROUND",28:"LOOKUP",29:"INDEX",30:"REPT",31:"MID",32:"LEN",33:"VALUE",34:"TRUE",35:"FALSE",36:"AND",37:"OR",38:"NOT",39:"MOD",40:"DCOUNT",41:"DSUM",42:"DAVERAGE",43:"DMIN",44:"DMAX",45:"DSTDEV",46:"VAR",47:"DVAR",48:"TEXT",49:"LINEST",50:"TREND",51:"LOGEST",52:"GROWTH",53:"GOTO",54:"HALT",55:"RETURN",56:"PV",57:"FV",58:"NPER",59:"PMT",60:"RATE",61:"MIRR",62:"IRR",63:"RAND",64:"MATCH",65:"DATE",66:"TIME",67:"DAY",68:"MONTH",69:"YEAR",70:"WEEKDAY",71:"HOUR",72:"MINUTE",73:"SECOND",74:"NOW",75:"AREAS",76:"ROWS",77:"COLUMNS",78:"OFFSET",79:"ABSREF",80:"RELREF",81:"ARGUMENT",82:"SEARCH",83:"TRANSPOSE",84:"ERROR",85:"STEP",86:"TYPE",87:"ECHO",88:"SET.NAME",89:"CALLER",90:"DEREF",91:"WINDOWS",92:"SERIES",93:"DOCUMENTS",94:"ACTIVE.CELL",95:"SELECTION",96:"RESULT",97:"ATAN2",98:"ASIN",99:"ACOS",100:"CHOOSE",101:"HLOOKUP",102:"VLOOKUP",103:"LINKS",104:"INPUT",105:"ISREF",106:"GET.FORMULA",107:"GET.NAME",108:"SET.VALUE",109:"LOG",110:"EXEC",111:"CHAR",112:"LOWER",113:"UPPER",114:"PROPER",115:"LEFT",116:"RIGHT",117:"EXACT",118:"TRIM",119:"REPLACE",120:"SUBSTITUTE",121:"CODE",122:"NAMES",123:"DIRECTORY",124:"FIND",125:"CELL",126:"ISERR",127:"ISTEXT",128:"ISNUMBER",129:"ISBLANK",130:"T",131:"N",132:"FOPEN",133:"FCLOSE",134:"FSIZE",135:"FREADLN",136:"FREAD",137:"FWRITELN",138:"FWRITE",139:"FPOS",140:"DATEVALUE",141:"TIMEVALUE",142:"SLN",143:"SYD",144:"DDB",145:"GET.DEF",146:"REFTEXT",147:"TEXTREF",148:"INDIRECT",149:"REGISTER",150:"CALL",151:"ADD.BAR",152:"ADD.MENU",153:"ADD.COMMAND",154:"ENABLE.COMMAND",155:"CHECK.COMMAND",156:"RENAME.COMMAND",157:"SHOW.BAR",158:"DELETE.MENU",159:"DELETE.COMMAND",160:"GET.CHART.ITEM",161:"DIALOG.BOX",162:"CLEAN",163:"MDETERM",164:"MINVERSE",165:"MMULT",166:"FILES",167:"IPMT",168:"PPMT",169:"COUNTA",170:"CANCEL.KEY",171:"FOR",172:"WHILE",173:"BREAK",174:"NEXT",175:"INITIATE",176:"REQUEST",177:"POKE",178:"EXECUTE",179:"TERMINATE",180:"RESTART",181:"HELP",182:"GET.BAR",183:"PRODUCT",184:"FACT",185:"GET.CELL",186:"GET.WORKSPACE",187:"GET.WINDOW",188:"GET.DOCUMENT",189:"DPRODUCT",190:"ISNONTEXT",191:"GET.NOTE",192:"NOTE",193:"STDEVP",194:"VARP",195:"DSTDEVP",196:"DVARP",197:"TRUNC",198:"ISLOGICAL",199:"DCOUNTA",200:"DELETE.BAR",201:"UNREGISTER",204:"USDOLLAR",205:"FINDB",206:"SEARCHB",207:"REPLACEB",208:"LEFTB",209:"RIGHTB",210:"MIDB",211:"LENB",212:"ROUNDUP",213:"ROUNDDOWN",214:"ASC",215:"DBCS",216:"RANK",219:"ADDRESS",220:"DAYS360",221:"TODAY",222:"VDB",223:"ELSE",224:"ELSE.IF",225:"END.IF",226:"FOR.CELL",227:"MEDIAN",228:"SUMPRODUCT",229:"SINH",230:"COSH",231:"TANH",232:"ASINH",233:"ACOSH",234:"ATANH",235:"DGET",236:"CREATE.OBJECT",237:"VOLATILE",238:"LAST.ERROR",239:"CUSTOM.UNDO",240:"CUSTOM.REPEAT",241:"FORMULA.CONVERT",242:"GET.LINK.INFO",243:"TEXT.BOX",244:"INFO",245:"GROUP",246:"GET.OBJECT",247:"DB",248:"PAUSE",251:"RESUME",252:"FREQUENCY",253:"ADD.TOOLBAR",254:"DELETE.TOOLBAR",255:"User",256:"RESET.TOOLBAR",257:"EVALUATE",258:"GET.TOOLBAR",259:"GET.TOOL",260:"SPELLING.CHECK",261:"ERROR.TYPE",262:"APP.TITLE",263:"WINDOW.TITLE",264:"SAVE.TOOLBAR",265:"ENABLE.TOOL",266:"PRESS.TOOL",267:"REGISTER.ID",268:"GET.WORKBOOK",269:"AVEDEV",270:"BETADIST",271:"GAMMALN",272:"BETAINV",273:"BINOMDIST",274:"CHIDIST",275:"CHIINV",276:"COMBIN",277:"CONFIDENCE",278:"CRITBINOM",279:"EVEN",280:"EXPONDIST",281:"FDIST",282:"FINV",283:"FISHER",284:"FISHERINV",285:"FLOOR",286:"GAMMADIST",287:"GAMMAINV",288:"CEILING",289:"HYPGEOMDIST",290:"LOGNORMDIST",291:"LOGINV",292:"NEGBINOMDIST",293:"NORMDIST",294:"NORMSDIST",295:"NORMINV",296:"NORMSINV",297:"STANDARDIZE",298:"ODD",299:"PERMUT",300:"POISSON",301:"TDIST",302:"WEIBULL",303:"SUMXMY2",304:"SUMX2MY2",305:"SUMX2PY2",306:"CHITEST",307:"CORREL",308:"COVAR",309:"FORECAST",310:"FTEST",311:"INTERCEPT",312:"PEARSON",313:"RSQ",314:"STEYX",315:"SLOPE",316:"TTEST",317:"PROB",318:"DEVSQ",319:"GEOMEAN",320:"HARMEAN",321:"SUMSQ",322:"KURT",323:"SKEW",324:"ZTEST",325:"LARGE",326:"SMALL",327:"QUARTILE",328:"PERCENTILE",329:"PERCENTRANK",330:"MODE",331:"TRIMMEAN",332:"TINV",334:"MOVIE.COMMAND",335:"GET.MOVIE",336:"CONCATENATE",337:"POWER",338:"PIVOT.ADD.DATA",339:"GET.PIVOT.TABLE",340:"GET.PIVOT.FIELD",341:"GET.PIVOT.ITEM",342:"RADIANS",343:"DEGREES",344:"SUBTOTAL",345:"SUMIF",346:"COUNTIF",347:"COUNTBLANK",348:"SCENARIO.GET",349:"OPTIONS.LISTS.GET",350:"ISPMT",351:"DATEDIF",352:"DATESTRING",353:"NUMBERSTRING",354:"ROMAN",355:"OPEN.DIALOG",356:"SAVE.DIALOG",357:"VIEW.GET",358:"GETPIVOTDATA",359:"HYPERLINK",360:"PHONETIC",361:"AVERAGEA",362:"MAXA",363:"MINA",364:"STDEVPA",365:"VARPA",366:"STDEVA",367:"VARA",368:"BAHTTEXT",369:"THAIDAYOFWEEK",370:"THAIDIGIT",371:"THAIMONTHOFYEAR",372:"THAINUMSOUND",373:"THAINUMSTRING",374:"THAISTRINGLENGTH",375:"ISTHAIDIGIT",376:"ROUNDBAHTDOWN",377:"ROUNDBAHTUP",378:"THAIYEAR",379:"RTD",380:"CUBEVALUE",381:"CUBEMEMBER",382:"CUBEMEMBERPROPERTY",383:"CUBERANKEDMEMBER",384:"HEX2BIN",385:"HEX2DEC",386:"HEX2OCT",387:"DEC2BIN",388:"DEC2HEX",389:"DEC2OCT",390:"OCT2BIN",391:"OCT2HEX",392:"OCT2DEC",393:"BIN2DEC",394:"BIN2OCT",395:"BIN2HEX",396:"IMSUB",397:"IMDIV",398:"IMPOWER",399:"IMABS",400:"IMSQRT",401:"IMLN",402:"IMLOG2",403:"IMLOG10",404:"IMSIN",405:"IMCOS",406:"IMEXP",407:"IMARGUMENT",408:"IMCONJUGATE",409:"IMAGINARY",410:"IMREAL",411:"COMPLEX",412:"IMSUM",413:"IMPRODUCT",414:"SERIESSUM",415:"FACTDOUBLE",416:"SQRTPI",417:"QUOTIENT",418:"DELTA",419:"GESTEP",420:"ISEVEN",421:"ISODD",422:"MROUND",423:"ERF",424:"ERFC",425:"BESSELJ",426:"BESSELK",427:"BESSELY",428:"BESSELI",429:"XIRR",430:"XNPV",431:"PRICEMAT",432:"YIELDMAT",433:"INTRATE",434:"RECEIVED",435:"DISC",436:"PRICEDISC",437:"YIELDDISC",438:"TBILLEQ",439:"TBILLPRICE",440:"TBILLYIELD",441:"PRICE",442:"YIELD",443:"DOLLARDE",444:"DOLLARFR",445:"NOMINAL",446:"EFFECT",447:"CUMPRINC",448:"CUMIPMT",449:"EDATE",450:"EOMONTH",451:"YEARFRAC",452:"COUPDAYBS",453:"COUPDAYS",454:"COUPDAYSNC",455:"COUPNCD",456:"COUPNUM",457:"COUPPCD",458:"DURATION",459:"MDURATION",460:"ODDLPRICE",461:"ODDLYIELD",462:"ODDFPRICE",463:"ODDFYIELD",464:"RANDBETWEEN",465:"WEEKNUM",466:"AMORDEGRC",467:"AMORLINC",468:"CONVERT",724:"SHEETJS",469:"ACCRINT",470:"ACCRINTM",471:"WORKDAY",472:"NETWORKDAYS",473:"GCD",474:"MULTINOMIAL",475:"LCM",476:"FVSCHEDULE",477:"CUBEKPIMEMBER",478:"CUBESET",479:"CUBESETCOUNT",480:"IFERROR",481:"COUNTIFS",482:"SUMIFS",483:"AVERAGEIF",484:"AVERAGEIFS"},FtabArgc={2:1,3:1,10:0,15:1,16:1,17:1,18:1,19:0,20:1,21:1,22:1,23:1,24:1,25:1,26:1,27:2,30:2,31:3,32:1,33:1,34:0,35:0,38:1,39:2,40:3,41:3,42:3,43:3,44:3,45:3,47:3,48:2,53:1,61:3,63:0,65:3,66:3,67:1,68:1,69:1,70:1,71:1,72:1,73:1,74:0,75:1,76:1,77:1,79:2,80:2,83:1,85:0,86:1,89:0,90:1,94:0,95:0,97:2,98:1,99:1,101:3,102:3,105:1,106:1,108:2,111:1,112:1,113:1,114:1,117:2,118:1,119:4,121:1,126:1,127:1,128:1,129:1,130:1,131:1,133:1,134:1,135:1,136:2,137:2,138:2,140:1,141:1,142:3,143:4,144:4,161:1,162:1,163:1,164:1,165:2,172:1,175:2,176:2,177:3,178:2,179:1,184:1,186:1,189:3,190:1,195:3,196:3,197:1,198:1,199:3,201:1,207:4,210:3,211:1,212:2,213:2,214:1,215:1,225:0,229:1,230:1,231:1,232:1,233:1,234:1,235:3,244:1,247:4,252:2,257:1,261:1,271:1,273:4,274:2,275:2,276:2,277:3,278:3,279:1,280:3,281:3,282:3,283:1,284:1,285:2,286:4,287:3,288:2,289:4,290:3,291:3,292:3,293:4,294:1,295:3,296:1,297:3,298:1,299:2,300:3,301:3,302:4,303:2,304:2,305:2,306:2,307:2,308:2,309:3,310:2,311:2,312:2,313:2,314:2,315:2,316:4,325:2,326:2,327:2,328:2,331:2,332:2,337:2,342:1,343:1,346:2,347:1,350:4,351:3,352:1,353:2,360:1,368:1,369:1,370:1,371:1,372:1,373:1,374:1,375:1,376:1,377:1,378:1,382:3,385:1,392:1,393:1,396:2,397:2,398:2,399:1,400:1,401:1,402:1,403:1,404:1,405:1,406:1,407:1,408:1,409:1,410:1,414:4,415:1,416:1,417:2,420:1,421:1,422:2,424:1,425:2,426:2,427:2,428:2,430:3,438:3,439:3,440:3,443:2,444:2,445:2,446:2,447:6,448:6,449:2,450:2,464:2,468:3,476:2,479:1,480:2,65535:0};function csf_to_ods_formula(t){var r="of:="+t.replace(crefregex,"$1[.$2$3$4$5]").replace(/\]:\[/g,":");return r.replace(/;/g,"|").replace(/,/g,";")}function csf_to_ods_3D(t){return t.replace(/\./,"!")}var browser_has_Map=typeof Map<"u";function get_sst_id(t,r,e){var s=0,a=t.length;if(e){if(browser_has_Map?e.has(r):Object.prototype.hasOwnProperty.call(e,r)){for(var i=browser_has_Map?e.get(r):e[r];s<i.length;++s)if(t[i[s]].t===r)return t.Count++,i[s]}}else for(;s<a;++s)if(t[s].t===r)return t.Count++,s;return t[a]={t:r},t.Count++,t.Unique++,e&&(browser_has_Map?(e.has(r)||e.set(r,[]),e.get(r).push(a)):(Object.prototype.hasOwnProperty.call(e,r)||(e[r]=[]),e[r].push(a))),a}function col_obj_w(t,r){var e={min:t+1,max:t+1},s=-1;return r.MDW&&(MDW=r.MDW),r.width!=null?e.customWidth=1:r.wpx!=null?s=px2char(r.wpx):r.wch!=null&&(s=r.wch),s>-1?(e.width=char2width(s),e.customWidth=1):r.width!=null&&(e.width=r.width),r.hidden&&(e.hidden=!0),r.level!=null&&(e.outlineLevel=e.level=r.level),e}function default_margins(t,r){if(t){var e=[.7,.7,.75,.75,.3,.3];t.left==null&&(t.left=e[0]),t.right==null&&(t.right=e[1]),t.top==null&&(t.top=e[2]),t.bottom==null&&(t.bottom=e[3]),t.header==null&&(t.header=e[4]),t.footer==null&&(t.footer=e[5])}}function get_cell_style(t,r,e){var s=e.revssf[r.z!=null?r.z:"General"],a=60,i=t.length;if(s==null&&e.ssf){for(;a<392;++a)if(e.ssf[a]==null){SSF_load(r.z,a),e.ssf[a]=r.z,e.revssf[r.z]=s=a;break}}for(a=0;a!=i;++a)if(t[a].numFmtId===s)return a;return t[i]={numFmtId:s,fontId:0,fillId:0,borderId:0,xfId:0,applyNumberFormat:1},i}function check_ws(t,r,e){if(t&&t["!ref"]){var s=safe_decode_range(t["!ref"]);if(s.e.c<s.s.c||s.e.r<s.s.r)throw new Error("Bad range ("+e+"): "+t["!ref"])}}function write_ws_xml_merges(t){if(t.length===0)return"";for(var r='<mergeCells count="'+t.length+'">',e=0;e!=t.length;++e)r+='<mergeCell ref="'+encode_range(t[e])+'"/>';return r+"</mergeCells>"}function write_ws_xml_sheetpr(t,r,e,s,a){var i=!1,o={},c=null;if(s.bookType!=="xlsx"&&r.vbaraw){var x=r.SheetNames[e];try{r.Workbook&&(x=r.Workbook.Sheets[e].CodeName||x)}catch{}i=!0,o.codeName=utf8write(escapexml(x))}if(t&&t["!outline"]){var u={summaryBelow:1,summaryRight:1};t["!outline"].above&&(u.summaryBelow=0),t["!outline"].left&&(u.summaryRight=0),c=(c||"")+writextag("outlinePr",null,u)}!i&&!c||(a[a.length]=writextag("sheetPr",c,o))}var sheetprot_deffalse=["objects","scenarios","selectLockedCells","selectUnlockedCells"],sheetprot_deftrue=["formatColumns","formatRows","formatCells","insertColumns","insertRows","insertHyperlinks","deleteColumns","deleteRows","sort","autoFilter","pivotTables"];function write_ws_xml_protection(t){var r={sheet:1};return sheetprot_deffalse.forEach(function(e){t[e]!=null&&t[e]&&(r[e]="1")}),sheetprot_deftrue.forEach(function(e){t[e]!=null&&!t[e]&&(r[e]="0")}),t.password&&(r.password=crypto_CreatePasswordVerifier_Method1(t.password).toString(16).toUpperCase()),writextag("sheetProtection",null,r)}function write_ws_xml_margins(t){return default_margins(t),writextag("pageMargins",null,t)}function write_ws_xml_cols(t,r){for(var e=["<cols>"],s,a=0;a!=r.length;++a)(s=r[a])&&(e[e.length]=writextag("col",null,col_obj_w(a,s)));return e[e.length]="</cols>",e.join("")}function write_ws_xml_autofilter(t,r,e,s){var a=typeof t.ref=="string"?t.ref:encode_range(t.ref);e.Workbook||(e.Workbook={Sheets:[]}),e.Workbook.Names||(e.Workbook.Names=[]);var i=e.Workbook.Names,o=decode_range(a);o.s.r==o.e.r&&(o.e.r=decode_range(r["!ref"]).e.r,a=encode_range(o));for(var c=0;c<i.length;++c){var x=i[c];if(x.Name=="_xlnm._FilterDatabase"&&x.Sheet==s){x.Ref="'"+e.SheetNames[s]+"'!"+a;break}}return c==i.length&&i.push({Name:"_xlnm._FilterDatabase",Sheet:s,Ref:"'"+e.SheetNames[s]+"'!"+a}),writextag("autoFilter",null,{ref:a})}function write_ws_xml_sheetviews(t,r,e,s){var a={workbookViewId:"0"};return(((s||{}).Workbook||{}).Views||[])[0]&&(a.rightToLeft=s.Workbook.Views[0].RTL?"1":"0"),writextag("sheetViews",writextag("sheetView",null,a),{})}function write_ws_xml_cell(t,r,e,s){if(t.c&&e["!comments"].push([r,t.c]),t.v===void 0&&typeof t.f!="string"||t.t==="z"&&!t.f)return"";var a="",i=t.t,o=t.v;if(t.t!=="z")switch(t.t){case"b":a=t.v?"1":"0";break;case"n":a=""+t.v;break;case"e":a=BErr[t.v];break;case"d":s&&s.cellDates?a=parseDate(t.v,-1).toISOString():(t=dup(t),t.t="n",a=""+(t.v=datenum(parseDate(t.v)))),typeof t.z>"u"&&(t.z=table_fmt[14]);break;default:a=t.v;break}var c=writetag("v",escapexml(a)),x={r},u=get_cell_style(s.cellXfs,t,s);switch(u!==0&&(x.s=u),t.t){case"n":break;case"d":x.t="d";break;case"b":x.t="b";break;case"e":x.t="e";break;case"z":break;default:if(t.v==null){delete t.t;break}if(t.v.length>32767)throw new Error("Text length must not exceed 32767 characters");if(s&&s.bookSST){c=writetag("v",""+get_sst_id(s.Strings,t.v,s.revStrings)),x.t="s";break}x.t="str";break}if(t.t!=i&&(t.t=i,t.v=o),typeof t.f=="string"&&t.f){var h=t.F&&t.F.slice(0,r.length)==r?{t:"array",ref:t.F}:null;c=writextag("f",escapexml(t.f),h)+(t.v!=null?c:"")}return t.l&&e["!links"].push([r,t.l]),t.D&&(x.cm=1),writextag("c",c,x)}function write_ws_xml_data(t,r,e,s){var a=[],i=[],o=safe_decode_range(t["!ref"]),c="",x,u="",h=[],_=0,v=0,b=t["!rows"],E=Array.isArray(t),d={r:u},g,y=-1;for(v=o.s.c;v<=o.e.c;++v)h[v]=encode_col(v);for(_=o.s.r;_<=o.e.r;++_){for(i=[],u=encode_row(_),v=o.s.c;v<=o.e.c;++v){x=h[v]+u;var R=E?(t[_]||[])[v]:t[x];R!==void 0&&(c=write_ws_xml_cell(R,x,t,r))!=null&&i.push(c)}(i.length>0||b&&b[_])&&(d={r:u},b&&b[_]&&(g=b[_],g.hidden&&(d.hidden=1),y=-1,g.hpx?y=px2pt(g.hpx):g.hpt&&(y=g.hpt),y>-1&&(d.ht=y,d.customHeight=1),g.level&&(d.outlineLevel=g.level)),a[a.length]=writextag("row",i.join(""),d))}if(b)for(;_<b.length;++_)b&&b[_]&&(d={r:_+1},g=b[_],g.hidden&&(d.hidden=1),y=-1,g.hpx?y=px2pt(g.hpx):g.hpt&&(y=g.hpt),y>-1&&(d.ht=y,d.customHeight=1),g.level&&(d.outlineLevel=g.level),a[a.length]=writextag("row","",d));return a.join("")}function write_ws_xml(t,r,e,s){var a=[XML_HEADER,writextag("worksheet",null,{xmlns:XMLNS_main[0],"xmlns:r":XMLNS.r})],i=e.SheetNames[t],o=0,c="",x=e.Sheets[i];x==null&&(x={});var u=x["!ref"]||"A1",h=safe_decode_range(u);if(h.e.c>16383||h.e.r>1048575){if(r.WTF)throw new Error("Range "+u+" exceeds format limit A1:XFD1048576");h.e.c=Math.min(h.e.c,16383),h.e.r=Math.min(h.e.c,1048575),u=encode_range(h)}s||(s={}),x["!comments"]=[];var _=[];write_ws_xml_sheetpr(x,e,t,r,a),a[a.length]=writextag("dimension",null,{ref:u}),a[a.length]=write_ws_xml_sheetviews(x,r,t,e),r.sheetFormat&&(a[a.length]=writextag("sheetFormatPr",null,{defaultRowHeight:r.sheetFormat.defaultRowHeight||"16",baseColWidth:r.sheetFormat.baseColWidth||"10",outlineLevelRow:r.sheetFormat.outlineLevelRow||"7"})),x["!cols"]!=null&&x["!cols"].length>0&&(a[a.length]=write_ws_xml_cols(x,x["!cols"])),a[o=a.length]="<sheetData/>",x["!links"]=[],x["!ref"]!=null&&(c=write_ws_xml_data(x,r),c.length>0&&(a[a.length]=c)),a.length>o+1&&(a[a.length]="</sheetData>",a[o]=a[o].replace("/>",">")),x["!protect"]&&(a[a.length]=write_ws_xml_protection(x["!protect"])),x["!autofilter"]!=null&&(a[a.length]=write_ws_xml_autofilter(x["!autofilter"],x,e,t)),x["!merges"]!=null&&x["!merges"].length>0&&(a[a.length]=write_ws_xml_merges(x["!merges"]));var v=-1,b,E=-1;return x["!links"].length>0&&(a[a.length]="<hyperlinks>",x["!links"].forEach(function(d){d[1].Target&&(b={ref:d[0]},d[1].Target.charAt(0)!="#"&&(E=add_rels(s,-1,escapexml(d[1].Target).replace(/#.*$/,""),RELS.HLINK),b["r:id"]="rId"+E),(v=d[1].Target.indexOf("#"))>-1&&(b.location=escapexml(d[1].Target.slice(v+1))),d[1].Tooltip&&(b.tooltip=escapexml(d[1].Tooltip)),a[a.length]=writextag("hyperlink",null,b))}),a[a.length]="</hyperlinks>"),delete x["!links"],x["!margins"]!=null&&(a[a.length]=write_ws_xml_margins(x["!margins"])),(!r||r.ignoreEC||r.ignoreEC==null)&&(a[a.length]=writetag("ignoredErrors",writextag("ignoredError",null,{numberStoredAsText:1,sqref:u}))),_.length>0&&(E=add_rels(s,-1,"../drawings/drawing"+(t+1)+".xml",RELS.DRAW),a[a.length]=writextag("drawing",null,{"r:id":"rId"+E}),x["!drawing"]=_),x["!comments"].length>0&&(E=add_rels(s,-1,"../drawings/vmlDrawing"+(t+1)+".vml",RELS.VML),a[a.length]=writextag("legacyDrawing",null,{"r:id":"rId"+E}),x["!legacy"]=E),a.length>1&&(a[a.length]="</worksheet>",a[1]=a[1].replace("/>",">")),a.join("")}function parse_BrtRowHdr(t,r){var e={},s=t.l+r;e.r=t.read_shift(4),t.l+=4;var a=t.read_shift(2);t.l+=1;var i=t.read_shift(1);return t.l=s,i&7&&(e.level=i&7),i&16&&(e.hidden=!0),i&32&&(e.hpt=a/20),e}function write_BrtRowHdr(t,r,e){var s=new_buf(145),a=(e["!rows"]||[])[t]||{};s.write_shift(4,t),s.write_shift(4,0);var i=320;a.hpx?i=px2pt(a.hpx)*20:a.hpt&&(i=a.hpt*20),s.write_shift(2,i),s.write_shift(1,0);var o=0;a.level&&(o|=a.level),a.hidden&&(o|=16),(a.hpx||a.hpt)&&(o|=32),s.write_shift(1,o),s.write_shift(1,0);var c=0,x=s.l;s.l+=4;for(var u={r:t,c:0},h=0;h<16;++h)if(!(r.s.c>h+1<<10||r.e.c<h<<10)){for(var _=-1,v=-1,b=h<<10;b<h+1<<10;++b){u.c=b;var E=Array.isArray(e)?(e[u.r]||[])[u.c]:e[encode_cell(u)];E&&(_<0&&(_=b),v=b)}_<0||(++c,s.write_shift(4,_),s.write_shift(4,v))}var d=s.l;return s.l=x,s.write_shift(4,c),s.l=d,s.length>s.l?s.slice(0,s.l):s}function write_row_header(t,r,e,s){var a=write_BrtRowHdr(s,e,r);(a.length>17||(r["!rows"]||[])[s])&&write_record(t,0,a)}var parse_BrtWsDim=parse_UncheckedRfX,write_BrtWsDim=write_UncheckedRfX;function parse_BrtWsFmtInfo(){}function parse_BrtWsProp(t,r){var e={},s=t[t.l];return++t.l,e.above=!(s&64),e.left=!(s&128),t.l+=18,e.name=parse_XLSBCodeName(t),e}function write_BrtWsProp(t,r,e){e==null&&(e=new_buf(84+4*t.length));var s=192;r&&(r.above&&(s&=-65),r.left&&(s&=-129)),e.write_shift(1,s);for(var a=1;a<3;++a)e.write_shift(1,0);return write_BrtColor({auto:1},e),e.write_shift(-4,-1),e.write_shift(-4,-1),write_XLSBCodeName(t,e),e.slice(0,e.l)}function parse_BrtCellBlank(t){var r=parse_XLSBCell(t);return[r]}function write_BrtCellBlank(t,r,e){return e==null&&(e=new_buf(8)),write_XLSBCell(r,e)}function parse_BrtShortBlank(t){var r=parse_XLSBShortCell(t);return[r]}function write_BrtShortBlank(t,r,e){return e==null&&(e=new_buf(4)),write_XLSBShortCell(r,e)}function parse_BrtCellBool(t){var r=parse_XLSBCell(t),e=t.read_shift(1);return[r,e,"b"]}function write_BrtCellBool(t,r,e){return e==null&&(e=new_buf(9)),write_XLSBCell(r,e),e.write_shift(1,t.v?1:0),e}function parse_BrtShortBool(t){var r=parse_XLSBShortCell(t),e=t.read_shift(1);return[r,e,"b"]}function write_BrtShortBool(t,r,e){return e==null&&(e=new_buf(5)),write_XLSBShortCell(r,e),e.write_shift(1,t.v?1:0),e}function parse_BrtCellError(t){var r=parse_XLSBCell(t),e=t.read_shift(1);return[r,e,"e"]}function write_BrtCellError(t,r,e){return e==null&&(e=new_buf(9)),write_XLSBCell(r,e),e.write_shift(1,t.v),e}function parse_BrtShortError(t){var r=parse_XLSBShortCell(t),e=t.read_shift(1);return[r,e,"e"]}function write_BrtShortError(t,r,e){return e==null&&(e=new_buf(8)),write_XLSBShortCell(r,e),e.write_shift(1,t.v),e.write_shift(2,0),e.write_shift(1,0),e}function parse_BrtCellIsst(t){var r=parse_XLSBCell(t),e=t.read_shift(4);return[r,e,"s"]}function write_BrtCellIsst(t,r,e){return e==null&&(e=new_buf(12)),write_XLSBCell(r,e),e.write_shift(4,r.v),e}function parse_BrtShortIsst(t){var r=parse_XLSBShortCell(t),e=t.read_shift(4);return[r,e,"s"]}function write_BrtShortIsst(t,r,e){return e==null&&(e=new_buf(8)),write_XLSBShortCell(r,e),e.write_shift(4,r.v),e}function parse_BrtCellReal(t){var r=parse_XLSBCell(t),e=parse_Xnum(t);return[r,e,"n"]}function write_BrtCellReal(t,r,e){return e==null&&(e=new_buf(16)),write_XLSBCell(r,e),write_Xnum(t.v,e),e}function parse_BrtShortReal(t){var r=parse_XLSBShortCell(t),e=parse_Xnum(t);return[r,e,"n"]}function write_BrtShortReal(t,r,e){return e==null&&(e=new_buf(12)),write_XLSBShortCell(r,e),write_Xnum(t.v,e),e}function parse_BrtCellRk(t){var r=parse_XLSBCell(t),e=parse_RkNumber(t);return[r,e,"n"]}function write_BrtCellRk(t,r,e){return e==null&&(e=new_buf(12)),write_XLSBCell(r,e),write_RkNumber(t.v,e),e}function parse_BrtShortRk(t){var r=parse_XLSBShortCell(t),e=parse_RkNumber(t);return[r,e,"n"]}function write_BrtShortRk(t,r,e){return e==null&&(e=new_buf(8)),write_XLSBShortCell(r,e),write_RkNumber(t.v,e),e}function parse_BrtCellRString(t){var r=parse_XLSBCell(t),e=parse_RichStr(t);return[r,e,"is"]}function parse_BrtCellSt(t){var r=parse_XLSBCell(t),e=parse_XLWideString(t);return[r,e,"str"]}function write_BrtCellSt(t,r,e){return e==null&&(e=new_buf(12+4*t.v.length)),write_XLSBCell(r,e),write_XLWideString(t.v,e),e.length>e.l?e.slice(0,e.l):e}function parse_BrtShortSt(t){var r=parse_XLSBShortCell(t),e=parse_XLWideString(t);return[r,e,"str"]}function write_BrtShortSt(t,r,e){return e==null&&(e=new_buf(8+4*t.v.length)),write_XLSBShortCell(r,e),write_XLWideString(t.v,e),e.length>e.l?e.slice(0,e.l):e}function parse_BrtFmlaBool(t,r,e){var s=t.l+r,a=parse_XLSBCell(t);a.r=e["!row"];var i=t.read_shift(1),o=[a,i,"b"];if(e.cellFormula){t.l+=2;var c=parse_XLSBCellParsedFormula(t,s-t.l,e);o[3]=stringify_formula(c,null,a,e.supbooks,e)}else t.l=s;return o}function parse_BrtFmlaError(t,r,e){var s=t.l+r,a=parse_XLSBCell(t);a.r=e["!row"];var i=t.read_shift(1),o=[a,i,"e"];if(e.cellFormula){t.l+=2;var c=parse_XLSBCellParsedFormula(t,s-t.l,e);o[3]=stringify_formula(c,null,a,e.supbooks,e)}else t.l=s;return o}function parse_BrtFmlaNum(t,r,e){var s=t.l+r,a=parse_XLSBCell(t);a.r=e["!row"];var i=parse_Xnum(t),o=[a,i,"n"];if(e.cellFormula){t.l+=2;var c=parse_XLSBCellParsedFormula(t,s-t.l,e);o[3]=stringify_formula(c,null,a,e.supbooks,e)}else t.l=s;return o}function parse_BrtFmlaString(t,r,e){var s=t.l+r,a=parse_XLSBCell(t);a.r=e["!row"];var i=parse_XLWideString(t),o=[a,i,"str"];if(e.cellFormula){t.l+=2;var c=parse_XLSBCellParsedFormula(t,s-t.l,e);o[3]=stringify_formula(c,null,a,e.supbooks,e)}else t.l=s;return o}var parse_BrtMergeCell=parse_UncheckedRfX,write_BrtMergeCell=write_UncheckedRfX;function write_BrtBeginMergeCells(t,r){return r==null&&(r=new_buf(4)),r.write_shift(4,t),r}function parse_BrtHLink(t,r){var e=t.l+r,s=parse_UncheckedRfX(t),a=parse_XLNullableWideString(t),i=parse_XLWideString(t),o=parse_XLWideString(t),c=parse_XLWideString(t);t.l=e;var x={rfx:s,relId:a,loc:i,display:c};return o&&(x.Tooltip=o),x}function write_BrtHLink(t,r){var e=new_buf(50+4*(t[1].Target.length+(t[1].Tooltip||"").length));write_UncheckedRfX({s:decode_cell(t[0]),e:decode_cell(t[0])},e),write_RelID("rId"+r,e);var s=t[1].Target.indexOf("#"),a=s==-1?"":t[1].Target.slice(s+1);return write_XLWideString(a||"",e),write_XLWideString(t[1].Tooltip||"",e),write_XLWideString("",e),e.slice(0,e.l)}function parse_BrtPane(){}function parse_BrtArrFmla(t,r,e){var s=t.l+r,a=parse_RfX(t),i=t.read_shift(1),o=[a];if(o[2]=i,e.cellFormula){var c=parse_XLSBArrayParsedFormula(t,s-t.l,e);o[1]=c}else t.l=s;return o}function parse_BrtShrFmla(t,r,e){var s=t.l+r,a=parse_UncheckedRfX(t),i=[a];if(e.cellFormula){var o=parse_XLSBSharedParsedFormula(t,s-t.l,e);i[1]=o,t.l=s}else t.l=s;return i}function write_BrtColInfo(t,r,e){e==null&&(e=new_buf(18));var s=col_obj_w(t,r);e.write_shift(-4,t),e.write_shift(-4,t),e.write_shift(4,(s.width||10)*256),e.write_shift(4,0);var a=0;return r.hidden&&(a|=1),typeof s.width=="number"&&(a|=2),r.level&&(a|=r.level<<8),e.write_shift(2,a),e}var BrtMarginKeys=["left","right","top","bottom","header","footer"];function parse_BrtMargins(t){var r={};return BrtMarginKeys.forEach(function(e){r[e]=parse_Xnum(t)}),r}function write_BrtMargins(t,r){return r==null&&(r=new_buf(6*8)),default_margins(t),BrtMarginKeys.forEach(function(e){write_Xnum(t[e],r)}),r}function parse_BrtBeginWsView(t){var r=t.read_shift(2);return t.l+=28,{RTL:r&32}}function write_BrtBeginWsView(t,r,e){e==null&&(e=new_buf(30));var s=924;return(((r||{}).Views||[])[0]||{}).RTL&&(s|=32),e.write_shift(2,s),e.write_shift(4,0),e.write_shift(4,0),e.write_shift(4,0),e.write_shift(1,0),e.write_shift(1,0),e.write_shift(2,0),e.write_shift(2,100),e.write_shift(2,0),e.write_shift(2,0),e.write_shift(2,0),e.write_shift(4,0),e}function write_BrtCellIgnoreEC(t){var r=new_buf(24);return r.write_shift(4,4),r.write_shift(4,1),write_UncheckedRfX(t,r),r}function write_BrtSheetProtection(t,r){return r==null&&(r=new_buf(16*4+2)),r.write_shift(2,t.password?crypto_CreatePasswordVerifier_Method1(t.password):0),r.write_shift(4,1),[["objects",!1],["scenarios",!1],["formatCells",!0],["formatColumns",!0],["formatRows",!0],["insertColumns",!0],["insertRows",!0],["insertHyperlinks",!0],["deleteColumns",!0],["deleteRows",!0],["selectLockedCells",!1],["sort",!0],["autoFilter",!0],["pivotTables",!0],["selectUnlockedCells",!1]].forEach(function(e){e[1]?r.write_shift(4,t[e[0]]!=null&&!t[e[0]]?1:0):r.write_shift(4,t[e[0]]!=null&&t[e[0]]?0:1)}),r}function parse_BrtDVal(){}function parse_BrtDVal14(){}function write_ws_bin_cell(t,r,e,s,a,i,o){if(r.v===void 0)return!1;var c="";switch(r.t){case"b":c=r.v?"1":"0";break;case"d":r=dup(r),r.z=r.z||table_fmt[14],r.v=datenum(parseDate(r.v)),r.t="n";break;case"n":case"e":c=""+r.v;break;default:c=r.v;break}var x={r:e,c:s};switch(x.s=get_cell_style(a.cellXfs,r,a),r.l&&i["!links"].push([encode_cell(x),r.l]),r.c&&i["!comments"].push([encode_cell(x),r.c]),r.t){case"s":case"str":return a.bookSST?(c=get_sst_id(a.Strings,r.v,a.revStrings),x.t="s",x.v=c,o?write_record(t,18,write_BrtShortIsst(r,x)):write_record(t,7,write_BrtCellIsst(r,x))):(x.t="str",o?write_record(t,17,write_BrtShortSt(r,x)):write_record(t,6,write_BrtCellSt(r,x))),!0;case"n":return r.v==(r.v|0)&&r.v>-1e3&&r.v<1e3?o?write_record(t,13,write_BrtShortRk(r,x)):write_record(t,2,write_BrtCellRk(r,x)):o?write_record(t,16,write_BrtShortReal(r,x)):write_record(t,5,write_BrtCellReal(r,x)),!0;case"b":return x.t="b",o?write_record(t,15,write_BrtShortBool(r,x)):write_record(t,4,write_BrtCellBool(r,x)),!0;case"e":return x.t="e",o?write_record(t,14,write_BrtShortError(r,x)):write_record(t,3,write_BrtCellError(r,x)),!0}return o?write_record(t,12,write_BrtShortBlank(r,x)):write_record(t,1,write_BrtCellBlank(r,x)),!0}function write_CELLTABLE(t,r,e,s){var a=safe_decode_range(r["!ref"]||"A1"),i,o="",c=[];write_record(t,145);var x=Array.isArray(r),u=a.e.r;r["!rows"]&&(u=Math.max(a.e.r,r["!rows"].length-1));for(var h=a.s.r;h<=u;++h){o=encode_row(h),write_row_header(t,r,a,h);var _=!1;if(h<=a.e.r)for(var v=a.s.c;v<=a.e.c;++v){h===a.s.r&&(c[v]=encode_col(v)),i=c[v]+o;var b=x?(r[h]||[])[v]:r[i];if(!b){_=!1;continue}_=write_ws_bin_cell(t,b,h,v,s,r,_)}}write_record(t,146)}function write_MERGECELLS(t,r){!r||!r["!merges"]||(write_record(t,177,write_BrtBeginMergeCells(r["!merges"].length)),r["!merges"].forEach(function(e){write_record(t,176,write_BrtMergeCell(e))}),write_record(t,178))}function write_COLINFOS(t,r){!r||!r["!cols"]||(write_record(t,390),r["!cols"].forEach(function(e,s){e&&write_record(t,60,write_BrtColInfo(s,e))}),write_record(t,391))}function write_IGNOREECS(t,r){!r||!r["!ref"]||(write_record(t,648),write_record(t,649,write_BrtCellIgnoreEC(safe_decode_range(r["!ref"]))),write_record(t,650))}function write_HLINKS(t,r,e){r["!links"].forEach(function(s){if(s[1].Target){var a=add_rels(e,-1,s[1].Target.replace(/#.*$/,""),RELS.HLINK);write_record(t,494,write_BrtHLink(s,a))}}),delete r["!links"]}function write_LEGACYDRAWING(t,r,e,s){if(r["!comments"].length>0){var a=add_rels(s,-1,"../drawings/vmlDrawing"+(e+1)+".vml",RELS.VML);write_record(t,551,write_RelID("rId"+a)),r["!legacy"]=a}}function write_AUTOFILTER(t,r,e,s){if(r["!autofilter"]){var a=r["!autofilter"],i=typeof a.ref=="string"?a.ref:encode_range(a.ref);e.Workbook||(e.Workbook={Sheets:[]}),e.Workbook.Names||(e.Workbook.Names=[]);var o=e.Workbook.Names,c=decode_range(i);c.s.r==c.e.r&&(c.e.r=decode_range(r["!ref"]).e.r,i=encode_range(c));for(var x=0;x<o.length;++x){var u=o[x];if(u.Name=="_xlnm._FilterDatabase"&&u.Sheet==s){u.Ref="'"+e.SheetNames[s]+"'!"+i;break}}x==o.length&&o.push({Name:"_xlnm._FilterDatabase",Sheet:s,Ref:"'"+e.SheetNames[s]+"'!"+i}),write_record(t,161,write_UncheckedRfX(safe_decode_range(i))),write_record(t,162)}}function write_WSVIEWS2(t,r,e){write_record(t,133),write_record(t,137,write_BrtBeginWsView(r,e)),write_record(t,138),write_record(t,134)}function write_SHEETPROTECT(t,r){r["!protect"]&&write_record(t,535,write_BrtSheetProtection(r["!protect"]))}function write_ws_bin(t,r,e,s){var a=buf_array(),i=e.SheetNames[t],o=e.Sheets[i]||{},c=i;try{e&&e.Workbook&&(c=e.Workbook.Sheets[t].CodeName||c)}catch{}var x=safe_decode_range(o["!ref"]||"A1");if(x.e.c>16383||x.e.r>1048575){if(r.WTF)throw new Error("Range "+(o["!ref"]||"A1")+" exceeds format limit A1:XFD1048576");x.e.c=Math.min(x.e.c,16383),x.e.r=Math.min(x.e.c,1048575)}return o["!links"]=[],o["!comments"]=[],write_record(a,129),(e.vbaraw||o["!outline"])&&write_record(a,147,write_BrtWsProp(c,o["!outline"])),write_record(a,148,write_BrtWsDim(x)),write_WSVIEWS2(a,o,e.Workbook),write_COLINFOS(a,o),write_CELLTABLE(a,o,t,r),write_SHEETPROTECT(a,o),write_AUTOFILTER(a,o,e,t),write_MERGECELLS(a,o),write_HLINKS(a,o,s),o["!margins"]&&write_record(a,476,write_BrtMargins(o["!margins"])),(!r||r.ignoreEC||r.ignoreEC==null)&&write_IGNOREECS(a,o),write_LEGACYDRAWING(a,o,t,s),write_record(a,130),a.end()}function parse_BrtCsProp(t,r){t.l+=10;var e=parse_XLWideString(t);return{name:e}}var WBPropsDef=[["allowRefreshQuery",!1,"bool"],["autoCompressPictures",!0,"bool"],["backupFile",!1,"bool"],["checkCompatibility",!1,"bool"],["CodeName",""],["date1904",!1,"bool"],["defaultThemeVersion",0,"int"],["filterPrivacy",!1,"bool"],["hidePivotFieldList",!1,"bool"],["promptedSolutions",!1,"bool"],["publishItems",!1,"bool"],["refreshAllConnections",!1,"bool"],["saveExternalLinkValues",!0,"bool"],["showBorderUnselectedTables",!0,"bool"],["showInkAnnotation",!0,"bool"],["showObjects","all"],["showPivotChartFilter",!1,"bool"],["updateLinks","userSet"]];function safe1904(t){return!t.Workbook||!t.Workbook.WBProps?"false":parsexmlbool(t.Workbook.WBProps.date1904)?"true":"false"}var badchars="][*?/\\".split("");function check_ws_name(t,r){if(t.length>31)throw new Error("Sheet names cannot exceed 31 chars");var e=!0;return badchars.forEach(function(s){if(t.indexOf(s)!=-1)throw new Error("Sheet name cannot contain : \\ / ? * [ ]")}),e}function check_wb_names(t,r,e){t.forEach(function(s,a){check_ws_name(s);for(var i=0;i<a;++i)if(s==t[i])throw new Error("Duplicate Sheet Name: "+s);if(e){var o=r&&r[a]&&r[a].CodeName||s;if(o.charCodeAt(0)==95&&o.length>22)throw new Error("Bad Code Name: Worksheet"+o)}})}function check_wb(t){if(!t||!t.SheetNames||!t.Sheets)throw new Error("Invalid Workbook");if(!t.SheetNames.length)throw new Error("Workbook is empty");var r=t.Workbook&&t.Workbook.Sheets||[];check_wb_names(t.SheetNames,r,!!t.vbaraw);for(var e=0;e<t.SheetNames.length;++e)check_ws(t.Sheets[t.SheetNames[e]],t.SheetNames[e],e)}function write_wb_xml(t){var r=[XML_HEADER];r[r.length]=writextag("workbook",null,{xmlns:XMLNS_main[0],"xmlns:r":XMLNS.r});var e=t.Workbook&&(t.Workbook.Names||[]).length>0,s={codeName:"ThisWorkbook"};t.Workbook&&t.Workbook.WBProps&&(WBPropsDef.forEach(function(c){t.Workbook.WBProps[c[0]]!=null&&t.Workbook.WBProps[c[0]]!=c[1]&&(s[c[0]]=t.Workbook.WBProps[c[0]])}),t.Workbook.WBProps.CodeName&&(s.codeName=t.Workbook.WBProps.CodeName,delete s.CodeName)),r[r.length]=writextag("workbookPr",null,s);var a=t.Workbook&&t.Workbook.Sheets||[],i=0;if(a&&a[0]&&a[0].Hidden){for(r[r.length]="<bookViews>",i=0;i!=t.SheetNames.length&&!(!a[i]||!a[i].Hidden);++i);i==t.SheetNames.length&&(i=0),r[r.length]='<workbookView firstSheet="'+i+'" activeTab="'+i+'"/>',r[r.length]="</bookViews>"}for(r[r.length]="<sheets>",i=0;i!=t.SheetNames.length;++i){var o={name:escapexml(t.SheetNames[i].slice(0,31))};if(o.sheetId=""+(i+1),o["r:id"]="rId"+(i+1),a[i])switch(a[i].Hidden){case 1:o.state="hidden";break;case 2:o.state="veryHidden";break}r[r.length]=writextag("sheet",null,o)}return r[r.length]="</sheets>",e&&(r[r.length]="<definedNames>",t.Workbook&&t.Workbook.Names&&t.Workbook.Names.forEach(function(c){var x={name:c.Name};c.Comment&&(x.comment=c.Comment),c.Sheet!=null&&(x.localSheetId=""+c.Sheet),c.Hidden&&(x.hidden="1"),c.Ref&&(r[r.length]=writextag("definedName",escapexml(c.Ref),x))}),r[r.length]="</definedNames>"),r.length>2&&(r[r.length]="</workbook>",r[1]=r[1].replace("/>",">")),r.join("")}function parse_BrtBundleSh(t,r){var e={};return e.Hidden=t.read_shift(4),e.iTabID=t.read_shift(4),e.strRelID=parse_RelID(t),e.name=parse_XLWideString(t),e}function write_BrtBundleSh(t,r){return r||(r=new_buf(127)),r.write_shift(4,t.Hidden),r.write_shift(4,t.iTabID),write_RelID(t.strRelID,r),write_XLWideString(t.name.slice(0,31),r),r.length>r.l?r.slice(0,r.l):r}function parse_BrtWbProp(t,r){var e={},s=t.read_shift(4);e.defaultThemeVersion=t.read_shift(4);var a=r>8?parse_XLWideString(t):"";return a.length>0&&(e.CodeName=a),e.autoCompressPictures=!!(s&65536),e.backupFile=!!(s&64),e.checkCompatibility=!!(s&4096),e.date1904=!!(s&1),e.filterPrivacy=!!(s&8),e.hidePivotFieldList=!!(s&1024),e.promptedSolutions=!!(s&16),e.publishItems=!!(s&2048),e.refreshAllConnections=!!(s&262144),e.saveExternalLinkValues=!!(s&128),e.showBorderUnselectedTables=!!(s&4),e.showInkAnnotation=!!(s&32),e.showObjects=["all","placeholders","none"][s>>13&3],e.showPivotChartFilter=!!(s&32768),e.updateLinks=["userSet","never","always"][s>>8&3],e}function write_BrtWbProp(t,r){r||(r=new_buf(72));var e=0;return t&&t.filterPrivacy&&(e|=8),r.write_shift(4,e),r.write_shift(4,0),write_XLSBCodeName(t&&t.CodeName||"ThisWorkbook",r),r.slice(0,r.l)}function parse_BrtName(t,r,e){var s=t.l+r;t.l+=4,t.l+=1;var a=t.read_shift(4),i=parse_XLNameWideString(t),o=parse_XLSBNameParsedFormula(t,0,e),c=parse_XLNullableWideString(t);t.l=s;var x={Name:i,Ptg:o};return a<268435455&&(x.Sheet=a),c&&(x.Comment=c),x}function write_BUNDLESHS(t,r){write_record(t,143);for(var e=0;e!=r.SheetNames.length;++e){var s=r.Workbook&&r.Workbook.Sheets&&r.Workbook.Sheets[e]&&r.Workbook.Sheets[e].Hidden||0,a={Hidden:s,iTabID:e+1,strRelID:"rId"+(e+1),name:r.SheetNames[e]};write_record(t,156,write_BrtBundleSh(a))}write_record(t,144)}function write_BrtFileVersion(t,r){r||(r=new_buf(127));for(var e=0;e!=4;++e)r.write_shift(4,0);return write_XLWideString("SheetJS",r),write_XLWideString(XLSX.version,r),write_XLWideString(XLSX.version,r),write_XLWideString("7262",r),r.length>r.l?r.slice(0,r.l):r}function write_BrtBookView(t,r){r||(r=new_buf(29)),r.write_shift(-4,0),r.write_shift(-4,460),r.write_shift(4,28800),r.write_shift(4,17600),r.write_shift(4,500),r.write_shift(4,t),r.write_shift(4,t);var e=120;return r.write_shift(1,e),r.length>r.l?r.slice(0,r.l):r}function write_BOOKVIEWS(t,r){if(!(!r.Workbook||!r.Workbook.Sheets)){for(var e=r.Workbook.Sheets,s=0,a=-1,i=-1;s<e.length;++s)!e[s]||!e[s].Hidden&&a==-1?a=s:e[s].Hidden==1&&i==-1&&(i=s);i>a||(write_record(t,135),write_record(t,158,write_BrtBookView(a)),write_record(t,136))}}function write_wb_bin(t,r){var e=buf_array();return write_record(e,131),write_record(e,128,write_BrtFileVersion()),write_record(e,153,write_BrtWbProp(t.Workbook&&t.Workbook.WBProps||null)),write_BOOKVIEWS(e,t),write_BUNDLESHS(e,t),write_record(e,132),e.end()}function write_wb(t,r,e){return(r.slice(-4)===".bin"?write_wb_bin:write_wb_xml)(t)}function write_ws(t,r,e,s,a){return(r.slice(-4)===".bin"?write_ws_bin:write_ws_xml)(t,e,s,a)}function write_sty(t,r,e){return(r.slice(-4)===".bin"?write_sty_bin:write_sty_xml)(t,e)}function write_sst(t,r,e){return(r.slice(-4)===".bin"?write_sst_bin:write_sst_xml)(t,e)}function write_cmnt(t,r,e){return(r.slice(-4)===".bin"?write_comments_bin:write_comments_xml)(t)}function write_xlmeta(t){return(t.slice(-4)===".bin"?write_xlmeta_bin:write_xlmeta_xml)()}function write_props_xlml(t,r){var e=[];return t.Props&&e.push(xlml_write_docprops(t.Props,r)),t.Custprops&&e.push(xlml_write_custprops(t.Props,t.Custprops)),e.join("")}function write_wb_xlml(){return""}function write_sty_xlml(t,r){var e=['<Style ss:ID="Default" ss:Name="Normal"><NumberFormat/></Style>'];return r.cellXfs.forEach(function(s,a){var i=[];i.push(writextag("NumberFormat",null,{"ss:Format":escapexml(table_fmt[s.numFmtId])}));var o={"ss:ID":"s"+(21+a)};e.push(writextag("Style",i.join(""),o))}),writextag("Styles",e.join(""))}function write_name_xlml(t){return writextag("NamedRange",null,{"ss:Name":t.Name,"ss:RefersTo":"="+a1_to_rc(t.Ref,{r:0,c:0})})}function write_names_xlml(t){if(!((t||{}).Workbook||{}).Names)return"";for(var r=t.Workbook.Names,e=[],s=0;s<r.length;++s){var a=r[s];a.Sheet==null&&(a.Name.match(/^_xlfn\./)||e.push(write_name_xlml(a)))}return writextag("Names",e.join(""))}function write_ws_xlml_names(t,r,e,s){if(!t||!((s||{}).Workbook||{}).Names)return"";for(var a=s.Workbook.Names,i=[],o=0;o<a.length;++o){var c=a[o];c.Sheet==e&&(c.Name.match(/^_xlfn\./)||i.push(write_name_xlml(c)))}return i.join("")}function write_ws_xlml_wsopts(t,r,e,s){if(!t)return"";var a=[];if(t["!margins"]&&(a.push("<PageSetup>"),t["!margins"].header&&a.push(writextag("Header",null,{"x:Margin":t["!margins"].header})),t["!margins"].footer&&a.push(writextag("Footer",null,{"x:Margin":t["!margins"].footer})),a.push(writextag("PageMargins",null,{"x:Bottom":t["!margins"].bottom||"0.75","x:Left":t["!margins"].left||"0.7","x:Right":t["!margins"].right||"0.7","x:Top":t["!margins"].top||"0.75"})),a.push("</PageSetup>")),s&&s.Workbook&&s.Workbook.Sheets&&s.Workbook.Sheets[e])if(s.Workbook.Sheets[e].Hidden)a.push(writextag("Visible",s.Workbook.Sheets[e].Hidden==1?"SheetHidden":"SheetVeryHidden",{}));else{for(var i=0;i<e&&!(s.Workbook.Sheets[i]&&!s.Workbook.Sheets[i].Hidden);++i);i==e&&a.push("<Selected/>")}return((((s||{}).Workbook||{}).Views||[])[0]||{}).RTL&&a.push("<DisplayRightToLeft/>"),t["!protect"]&&(a.push(writetag("ProtectContents","True")),t["!protect"].objects&&a.push(writetag("ProtectObjects","True")),t["!protect"].scenarios&&a.push(writetag("ProtectScenarios","True")),t["!protect"].selectLockedCells!=null&&!t["!protect"].selectLockedCells?a.push(writetag("EnableSelection","NoSelection")):t["!protect"].selectUnlockedCells!=null&&!t["!protect"].selectUnlockedCells&&a.push(writetag("EnableSelection","UnlockedCells")),[["formatCells","AllowFormatCells"],["formatColumns","AllowSizeCols"],["formatRows","AllowSizeRows"],["insertColumns","AllowInsertCols"],["insertRows","AllowInsertRows"],["insertHyperlinks","AllowInsertHyperlinks"],["deleteColumns","AllowDeleteCols"],["deleteRows","AllowDeleteRows"],["sort","AllowSort"],["autoFilter","AllowFilter"],["pivotTables","AllowUsePivotTables"]].forEach(function(o){t["!protect"][o[0]]&&a.push("<"+o[1]+"/>")})),a.length==0?"":writextag("WorksheetOptions",a.join(""),{xmlns:XLMLNS.x})}function write_ws_xlml_comment(t){return t.map(function(r){var e=xlml_unfixstr(r.t||""),s=writextag("ss:Data",e,{xmlns:"http://www.w3.org/TR/REC-html40"});return writextag("Comment",s,{"ss:Author":r.a})}).join("")}function write_ws_xlml_cell(t,r,e,s,a,i,o){if(!t||t.v==null&&t.f==null)return"";var c={};if(t.f&&(c["ss:Formula"]="="+escapexml(a1_to_rc(t.f,o))),t.F&&t.F.slice(0,r.length)==r){var x=decode_cell(t.F.slice(r.length+1));c["ss:ArrayRange"]="RC:R"+(x.r==o.r?"":"["+(x.r-o.r)+"]")+"C"+(x.c==o.c?"":"["+(x.c-o.c)+"]")}if(t.l&&t.l.Target&&(c["ss:HRef"]=escapexml(t.l.Target),t.l.Tooltip&&(c["x:HRefScreenTip"]=escapexml(t.l.Tooltip))),e["!merges"])for(var u=e["!merges"],h=0;h!=u.length;++h)u[h].s.c!=o.c||u[h].s.r!=o.r||(u[h].e.c>u[h].s.c&&(c["ss:MergeAcross"]=u[h].e.c-u[h].s.c),u[h].e.r>u[h].s.r&&(c["ss:MergeDown"]=u[h].e.r-u[h].s.r));var _="",v="";switch(t.t){case"z":if(!s.sheetStubs)return"";break;case"n":_="Number",v=String(t.v);break;case"b":_="Boolean",v=t.v?"1":"0";break;case"e":_="Error",v=BErr[t.v];break;case"d":_="DateTime",v=new Date(t.v).toISOString(),t.z==null&&(t.z=t.z||table_fmt[14]);break;case"s":_="String",v=escapexlml(t.v||"");break}var b=get_cell_style(s.cellXfs,t,s);c["ss:StyleID"]="s"+(21+b),c["ss:Index"]=o.c+1;var E=t.v!=null?v:"",d=t.t=="z"?"":'<Data ss:Type="'+_+'">'+E+"</Data>";return(t.c||[]).length>0&&(d+=write_ws_xlml_comment(t.c)),writextag("Cell",d,c)}function write_ws_xlml_row(t,r){var e='<Row ss:Index="'+(t+1)+'"';return r&&(r.hpt&&!r.hpx&&(r.hpx=pt2px(r.hpt)),r.hpx&&(e+=' ss:AutoFitHeight="0" ss:Height="'+r.hpx+'"'),r.hidden&&(e+=' ss:Hidden="1"')),e+">"}function write_ws_xlml_table(t,r,e,s){if(!t["!ref"])return"";var a=safe_decode_range(t["!ref"]),i=t["!merges"]||[],o=0,c=[];t["!cols"]&&t["!cols"].forEach(function(g,y){process_col(g);var R=!!g.width,P=col_obj_w(y,g),F={"ss:Index":y+1};R&&(F["ss:Width"]=width2px(P.width)),g.hidden&&(F["ss:Hidden"]="1"),c.push(writextag("Column",null,F))});for(var x=Array.isArray(t),u=a.s.r;u<=a.e.r;++u){for(var h=[write_ws_xlml_row(u,(t["!rows"]||[])[u])],_=a.s.c;_<=a.e.c;++_){var v=!1;for(o=0;o!=i.length;++o)if(!(i[o].s.c>_)&&!(i[o].s.r>u)&&!(i[o].e.c<_)&&!(i[o].e.r<u)){(i[o].s.c!=_||i[o].s.r!=u)&&(v=!0);break}if(!v){var b={r:u,c:_},E=encode_cell(b),d=x?(t[u]||[])[_]:t[E];h.push(write_ws_xlml_cell(d,E,t,r,e,s,b))}}h.push("</Row>"),h.length>2&&c.push(h.join(""))}return c.join("")}function write_ws_xlml(t,r,e){var s=[],a=e.SheetNames[t],i=e.Sheets[a],o=i?write_ws_xlml_names(i,r,t,e):"";return o.length>0&&s.push("<Names>"+o+"</Names>"),o=i?write_ws_xlml_table(i,r,t,e):"",o.length>0&&s.push("<Table>"+o+"</Table>"),s.push(write_ws_xlml_wsopts(i,r,t,e)),s.join("")}function write_xlml(t,r){r||(r={}),t.SSF||(t.SSF=dup(table_fmt)),t.SSF&&(make_ssf(),SSF_load_table(t.SSF),r.revssf=evert_num(t.SSF),r.revssf[t.SSF[65535]]=0,r.ssf=t.SSF,r.cellXfs=[],get_cell_style(r.cellXfs,{},{revssf:{General:0}}));var e=[];e.push(write_props_xlml(t,r)),e.push(write_wb_xlml()),e.push(""),e.push("");for(var s=0;s<t.SheetNames.length;++s)e.push(writextag("Worksheet",write_ws_xlml(s,r,t),{"ss:Name":escapexml(t.SheetNames[s])}));return e[2]=write_sty_xlml(t,r),e[3]=write_names_xlml(t),XML_HEADER+writextag("Workbook",e.join(""),{xmlns:XLMLNS.ss,"xmlns:o":XLMLNS.o,"xmlns:x":XLMLNS.x,"xmlns:ss":XLMLNS.ss,"xmlns:dt":XLMLNS.dt,"xmlns:html":XLMLNS.html})}var PSCLSID={SI:"e0859ff2f94f6810ab9108002b27b3d9",DSI:"02d5cdd59c2e1b10939708002b2cf9ae",UDI:"05d5cdd59c2e1b10939708002b2cf9ae"};function write_xls_props(t,r){var e=[],s=[],a=[],i=0,o,c=evert_key(DocSummaryPIDDSI,"n"),x=evert_key(SummaryPIDSI,"n");if(t.Props)for(o=keys(t.Props),i=0;i<o.length;++i)(Object.prototype.hasOwnProperty.call(c,o[i])?e:Object.prototype.hasOwnProperty.call(x,o[i])?s:a).push([o[i],t.Props[o[i]]]);if(t.Custprops)for(o=keys(t.Custprops),i=0;i<o.length;++i)Object.prototype.hasOwnProperty.call(t.Props||{},o[i])||(Object.prototype.hasOwnProperty.call(c,o[i])?e:Object.prototype.hasOwnProperty.call(x,o[i])?s:a).push([o[i],t.Custprops[o[i]]]);var u=[];for(i=0;i<a.length;++i)XLSPSSkip.indexOf(a[i][0])>-1||PseudoPropsPairs.indexOf(a[i][0])>-1||a[i][1]!=null&&u.push(a[i]);s.length&&CFB.utils.cfb_add(r,"/SummaryInformation",write_PropertySetStream(s,PSCLSID.SI,x,SummaryPIDSI)),(e.length||u.length)&&CFB.utils.cfb_add(r,"/DocumentSummaryInformation",write_PropertySetStream(e,PSCLSID.DSI,c,DocSummaryPIDDSI,u.length?u:null,PSCLSID.UDI))}function write_xlscfb(t,r){var e=r||{},s=CFB.utils.cfb_new({root:"R"}),a="/Workbook";switch(e.bookType||"xls"){case"xls":e.bookType="biff8";case"xla":e.bookType||(e.bookType="xla");case"biff8":a="/Workbook",e.biff=8;break;case"biff5":a="/Book",e.biff=5;break;default:throw new Error("invalid type "+e.bookType+" for XLS CFB")}return CFB.utils.cfb_add(s,a,write_biff_buf(t,e)),e.biff==8&&(t.Props||t.Custprops)&&write_xls_props(t,s),e.biff==8&&t.vbaraw&&fill_vba_xls(s,CFB.read(t.vbaraw,{type:typeof t.vbaraw=="string"?"binary":"buffer"})),s}var XLSBRecordEnum={0:{f:parse_BrtRowHdr},1:{f:parse_BrtCellBlank},2:{f:parse_BrtCellRk},3:{f:parse_BrtCellError},4:{f:parse_BrtCellBool},5:{f:parse_BrtCellReal},6:{f:parse_BrtCellSt},7:{f:parse_BrtCellIsst},8:{f:parse_BrtFmlaString},9:{f:parse_BrtFmlaNum},10:{f:parse_BrtFmlaBool},11:{f:parse_BrtFmlaError},12:{f:parse_BrtShortBlank},13:{f:parse_BrtShortRk},14:{f:parse_BrtShortError},15:{f:parse_BrtShortBool},16:{f:parse_BrtShortReal},17:{f:parse_BrtShortSt},18:{f:parse_BrtShortIsst},19:{f:parse_RichStr},20:{},21:{},22:{},23:{},24:{},25:{},26:{},27:{},28:{},29:{},30:{},31:{},32:{},33:{},34:{},35:{T:1},36:{T:-1},37:{T:1},38:{T:-1},39:{f:parse_BrtName},40:{},42:{},43:{f:parse_BrtFont},44:{f:parse_BrtFmt},45:{f:parse_BrtFill},46:{f:parse_BrtBorder},47:{f:parse_BrtXF},48:{},49:{f:parse_Int32LE},50:{},51:{f:parse_BrtMdb},52:{T:1},53:{T:-1},54:{T:1},55:{T:-1},56:{T:1},57:{T:-1},58:{},59:{},60:{f:parse_ColInfo},62:{f:parse_BrtCellRString},63:{f:parse_BrtCalcChainItem$},64:{f:parse_BrtDVal},65:{},66:{},67:{},68:{},69:{},70:{},128:{},129:{T:1},130:{T:-1},131:{T:1,f:parsenoop,p:0},132:{T:-1},133:{T:1},134:{T:-1},135:{T:1},136:{T:-1},137:{T:1,f:parse_BrtBeginWsView},138:{T:-1},139:{T:1},140:{T:-1},141:{T:1},142:{T:-1},143:{T:1},144:{T:-1},145:{T:1},146:{T:-1},147:{f:parse_BrtWsProp},148:{f:parse_BrtWsDim,p:16},151:{f:parse_BrtPane},152:{},153:{f:parse_BrtWbProp},154:{},155:{},156:{f:parse_BrtBundleSh},157:{},158:{},159:{T:1,f:parse_BrtBeginSst},160:{T:-1},161:{T:1,f:parse_UncheckedRfX},162:{T:-1},163:{T:1},164:{T:-1},165:{T:1},166:{T:-1},167:{},168:{},169:{},170:{},171:{},172:{T:1},173:{T:-1},174:{},175:{},176:{f:parse_BrtMergeCell},177:{T:1},178:{T:-1},179:{T:1},180:{T:-1},181:{T:1},182:{T:-1},183:{T:1},184:{T:-1},185:{T:1},186:{T:-1},187:{T:1},188:{T:-1},189:{T:1},190:{T:-1},191:{T:1},192:{T:-1},193:{T:1},194:{T:-1},195:{T:1},196:{T:-1},197:{T:1},198:{T:-1},199:{T:1},200:{T:-1},201:{T:1},202:{T:-1},203:{T:1},204:{T:-1},205:{T:1},206:{T:-1},207:{T:1},208:{T:-1},209:{T:1},210:{T:-1},211:{T:1},212:{T:-1},213:{T:1},214:{T:-1},215:{T:1},216:{T:-1},217:{T:1},218:{T:-1},219:{T:1},220:{T:-1},221:{T:1},222:{T:-1},223:{T:1},224:{T:-1},225:{T:1},226:{T:-1},227:{T:1},228:{T:-1},229:{T:1},230:{T:-1},231:{T:1},232:{T:-1},233:{T:1},234:{T:-1},235:{T:1},236:{T:-1},237:{T:1},238:{T:-1},239:{T:1},240:{T:-1},241:{T:1},242:{T:-1},243:{T:1},244:{T:-1},245:{T:1},246:{T:-1},247:{T:1},248:{T:-1},249:{T:1},250:{T:-1},251:{T:1},252:{T:-1},253:{T:1},254:{T:-1},255:{T:1},256:{T:-1},257:{T:1},258:{T:-1},259:{T:1},260:{T:-1},261:{T:1},262:{T:-1},263:{T:1},264:{T:-1},265:{T:1},266:{T:-1},267:{T:1},268:{T:-1},269:{T:1},270:{T:-1},271:{T:1},272:{T:-1},273:{T:1},274:{T:-1},275:{T:1},276:{T:-1},277:{},278:{T:1},279:{T:-1},280:{T:1},281:{T:-1},282:{T:1},283:{T:1},284:{T:-1},285:{T:1},286:{T:-1},287:{T:1},288:{T:-1},289:{T:1},290:{T:-1},291:{T:1},292:{T:-1},293:{T:1},294:{T:-1},295:{T:1},296:{T:-1},297:{T:1},298:{T:-1},299:{T:1},300:{T:-1},301:{T:1},302:{T:-1},303:{T:1},304:{T:-1},305:{T:1},306:{T:-1},307:{T:1},308:{T:-1},309:{T:1},310:{T:-1},311:{T:1},312:{T:-1},313:{T:-1},314:{T:1},315:{T:-1},316:{T:1},317:{T:-1},318:{T:1},319:{T:-1},320:{T:1},321:{T:-1},322:{T:1},323:{T:-1},324:{T:1},325:{T:-1},326:{T:1},327:{T:-1},328:{T:1},329:{T:-1},330:{T:1},331:{T:-1},332:{T:1},333:{T:-1},334:{T:1},335:{f:parse_BrtMdtinfo},336:{T:-1},337:{f:parse_BrtBeginEsmdb,T:1},338:{T:-1},339:{T:1},340:{T:-1},341:{T:1},342:{T:-1},343:{T:1},344:{T:-1},345:{T:1},346:{T:-1},347:{T:1},348:{T:-1},349:{T:1},350:{T:-1},351:{},352:{},353:{T:1},354:{T:-1},355:{f:parse_RelID},357:{},358:{},359:{},360:{T:1},361:{},362:{f:parse_ExternSheet},363:{},364:{},366:{},367:{},368:{},369:{},370:{},371:{},372:{T:1},373:{T:-1},374:{T:1},375:{T:-1},376:{T:1},377:{T:-1},378:{T:1},379:{T:-1},380:{T:1},381:{T:-1},382:{T:1},383:{T:-1},384:{T:1},385:{T:-1},386:{T:1},387:{T:-1},388:{T:1},389:{T:-1},390:{T:1},391:{T:-1},392:{T:1},393:{T:-1},394:{T:1},395:{T:-1},396:{},397:{},398:{},399:{},400:{},401:{T:1},403:{},404:{},405:{},406:{},407:{},408:{},409:{},410:{},411:{},412:{},413:{},414:{},415:{},416:{},417:{},418:{},419:{},420:{},421:{},422:{T:1},423:{T:1},424:{T:-1},425:{T:-1},426:{f:parse_BrtArrFmla},427:{f:parse_BrtShrFmla},428:{},429:{T:1},430:{T:-1},431:{T:1},432:{T:-1},433:{T:1},434:{T:-1},435:{T:1},436:{T:-1},437:{T:1},438:{T:-1},439:{T:1},440:{T:-1},441:{T:1},442:{T:-1},443:{T:1},444:{T:-1},445:{T:1},446:{T:-1},447:{T:1},448:{T:-1},449:{T:1},450:{T:-1},451:{T:1},452:{T:-1},453:{T:1},454:{T:-1},455:{T:1},456:{T:-1},457:{T:1},458:{T:-1},459:{T:1},460:{T:-1},461:{T:1},462:{T:-1},463:{T:1},464:{T:-1},465:{T:1},466:{T:-1},467:{T:1},468:{T:-1},469:{T:1},470:{T:-1},471:{},472:{},473:{T:1},474:{T:-1},475:{},476:{f:parse_BrtMargins},477:{},478:{},479:{T:1},480:{T:-1},481:{T:1},482:{T:-1},483:{T:1},484:{T:-1},485:{f:parse_BrtWsFmtInfo},486:{T:1},487:{T:-1},488:{T:1},489:{T:-1},490:{T:1},491:{T:-1},492:{T:1},493:{T:-1},494:{f:parse_BrtHLink},495:{T:1},496:{T:-1},497:{T:1},498:{T:-1},499:{},500:{T:1},501:{T:-1},502:{T:1},503:{T:-1},504:{},505:{T:1},506:{T:-1},507:{},508:{T:1},509:{T:-1},510:{T:1},511:{T:-1},512:{},513:{},514:{T:1},515:{T:-1},516:{T:1},517:{T:-1},518:{T:1},519:{T:-1},520:{T:1},521:{T:-1},522:{},523:{},524:{},525:{},526:{},527:{},528:{T:1},529:{T:-1},530:{T:1},531:{T:-1},532:{T:1},533:{T:-1},534:{},535:{},536:{},537:{},538:{T:1},539:{T:-1},540:{T:1},541:{T:-1},542:{T:1},548:{},549:{},550:{f:parse_RelID},551:{},552:{},553:{},554:{T:1},555:{T:-1},556:{T:1},557:{T:-1},558:{T:1},559:{T:-1},560:{T:1},561:{T:-1},562:{},564:{},565:{T:1},566:{T:-1},569:{T:1},570:{T:-1},572:{},573:{T:1},574:{T:-1},577:{},578:{},579:{},580:{},581:{},582:{},583:{},584:{},585:{},586:{},587:{},588:{T:-1},589:{},590:{T:1},591:{T:-1},592:{T:1},593:{T:-1},594:{T:1},595:{T:-1},596:{},597:{T:1},598:{T:-1},599:{T:1},600:{T:-1},601:{T:1},602:{T:-1},603:{T:1},604:{T:-1},605:{T:1},606:{T:-1},607:{},608:{T:1},609:{T:-1},610:{},611:{T:1},612:{T:-1},613:{T:1},614:{T:-1},615:{T:1},616:{T:-1},617:{T:1},618:{T:-1},619:{T:1},620:{T:-1},625:{},626:{T:1},627:{T:-1},628:{T:1},629:{T:-1},630:{T:1},631:{T:-1},632:{f:parse_BrtCommentAuthor},633:{T:1},634:{T:-1},635:{T:1,f:parse_BrtBeginComment},636:{T:-1},637:{f:parse_BrtCommentText},638:{T:1},639:{},640:{T:-1},641:{T:1},642:{T:-1},643:{T:1},644:{},645:{T:-1},646:{T:1},648:{T:1},649:{},650:{T:-1},651:{f:parse_BrtCsProp},652:{},653:{T:1},654:{T:-1},655:{T:1},656:{T:-1},657:{T:1},658:{T:-1},659:{},660:{T:1},661:{},662:{T:-1},663:{},664:{T:1},665:{},666:{T:-1},667:{},668:{},669:{},671:{T:1},672:{T:-1},673:{T:1},674:{T:-1},675:{},676:{},677:{},678:{},679:{},680:{},681:{},1024:{},1025:{},1026:{T:1},1027:{T:-1},1028:{T:1},1029:{T:-1},1030:{},1031:{T:1},1032:{T:-1},1033:{T:1},1034:{T:-1},1035:{},1036:{},1037:{},1038:{T:1},1039:{T:-1},1040:{},1041:{T:1},1042:{T:-1},1043:{},1044:{},1045:{},1046:{T:1},1047:{T:-1},1048:{T:1},1049:{T:-1},1050:{},1051:{T:1},1052:{T:1},1053:{f:parse_BrtDVal14},1054:{T:1},1055:{},1056:{T:1},1057:{T:-1},1058:{T:1},1059:{T:-1},1061:{},1062:{T:1},1063:{T:-1},1064:{T:1},1065:{T:-1},1066:{T:1},1067:{T:-1},1068:{T:1},1069:{T:-1},1070:{T:1},1071:{T:-1},1072:{T:1},1073:{T:-1},1075:{T:1},1076:{T:-1},1077:{T:1},1078:{T:-1},1079:{T:1},1080:{T:-1},1081:{T:1},1082:{T:-1},1083:{T:1},1084:{T:-1},1085:{},1086:{T:1},1087:{T:-1},1088:{T:1},1089:{T:-1},1090:{T:1},1091:{T:-1},1092:{T:1},1093:{T:-1},1094:{T:1},1095:{T:-1},1096:{},1097:{T:1},1098:{},1099:{T:-1},1100:{T:1},1101:{T:-1},1102:{},1103:{},1104:{},1105:{},1111:{},1112:{},1113:{T:1},1114:{T:-1},1115:{T:1},1116:{T:-1},1117:{},1118:{T:1},1119:{T:-1},1120:{T:1},1121:{T:-1},1122:{T:1},1123:{T:-1},1124:{T:1},1125:{T:-1},1126:{},1128:{T:1},1129:{T:-1},1130:{},1131:{T:1},1132:{T:-1},1133:{T:1},1134:{T:-1},1135:{T:1},1136:{T:-1},1137:{T:1},1138:{T:-1},1139:{T:1},1140:{T:-1},1141:{},1142:{T:1},1143:{T:-1},1144:{T:1},1145:{T:-1},1146:{},1147:{T:1},1148:{T:-1},1149:{T:1},1150:{T:-1},1152:{T:1},1153:{T:-1},1154:{T:-1},1155:{T:-1},1156:{T:-1},1157:{T:1},1158:{T:-1},1159:{T:1},1160:{T:-1},1161:{T:1},1162:{T:-1},1163:{T:1},1164:{T:-1},1165:{T:1},1166:{T:-1},1167:{T:1},1168:{T:-1},1169:{T:1},1170:{T:-1},1171:{},1172:{T:1},1173:{T:-1},1177:{},1178:{T:1},1180:{},1181:{},1182:{},2048:{T:1},2049:{T:-1},2050:{},2051:{T:1},2052:{T:-1},2053:{},2054:{},2055:{T:1},2056:{T:-1},2057:{T:1},2058:{T:-1},2060:{},2067:{},2068:{T:1},2069:{T:-1},2070:{},2071:{},2072:{T:1},2073:{T:-1},2075:{},2076:{},2077:{T:1},2078:{T:-1},2079:{},2080:{T:1},2081:{T:-1},2082:{},2083:{T:1},2084:{T:-1},2085:{T:1},2086:{T:-1},2087:{T:1},2088:{T:-1},2089:{T:1},2090:{T:-1},2091:{},2092:{},2093:{T:1},2094:{T:-1},2095:{},2096:{T:1},2097:{T:-1},2098:{T:1},2099:{T:-1},2100:{T:1},2101:{T:-1},2102:{},2103:{T:1},2104:{T:-1},2105:{},2106:{T:1},2107:{T:-1},2108:{},2109:{T:1},2110:{T:-1},2111:{T:1},2112:{T:-1},2113:{T:1},2114:{T:-1},2115:{},2116:{},2117:{},2118:{T:1},2119:{T:-1},2120:{},2121:{T:1},2122:{T:-1},2123:{T:1},2124:{T:-1},2125:{},2126:{T:1},2127:{T:-1},2128:{},2129:{T:1},2130:{T:-1},2131:{T:1},2132:{T:-1},2133:{T:1},2134:{},2135:{},2136:{},2137:{T:1},2138:{T:-1},2139:{T:1},2140:{T:-1},2141:{},3072:{},3073:{},4096:{T:1},4097:{T:-1},5002:{T:1},5003:{T:-1},5081:{T:1},5082:{T:-1},5083:{},5084:{T:1},5085:{T:-1},5086:{T:1},5087:{T:-1},5088:{},5089:{},5090:{},5092:{T:1},5093:{T:-1},5094:{},5095:{T:1},5096:{T:-1},5097:{},5099:{},65535:{n:""}};function write_biff_rec(t,r,e,s){var a=r;if(!isNaN(a)){var i=s||(e||[]).length||0,o=t.next(4);o.write_shift(2,a),o.write_shift(2,i),i>0&&is_buf(e)&&t.push(e)}}function write_biff_continue(t,r,e,s){var a=(e||[]).length||0;if(a<=8224)return write_biff_rec(t,r,e,a);var i=r;if(!isNaN(i)){for(var o=e.parts||[],c=0,x=0,u=0;u+(o[c]||8224)<=8224;)u+=o[c]||8224,c++;var h=t.next(4);for(h.write_shift(2,i),h.write_shift(2,u),t.push(e.slice(x,x+u)),x+=u;x<a;){for(h=t.next(4),h.write_shift(2,60),u=0;u+(o[c]||8224)<=8224;)u+=o[c]||8224,c++;h.write_shift(2,u),t.push(e.slice(x,x+u)),x+=u}}}function write_BIFF2Cell(t,r,e){return t||(t=new_buf(7)),t.write_shift(2,r),t.write_shift(2,e),t.write_shift(2,0),t.write_shift(1,0),t}function write_BIFF2BERR(t,r,e,s){var a=new_buf(9);return write_BIFF2Cell(a,t,r),write_Bes(e,s||"b",a),a}function write_BIFF2LABEL(t,r,e){var s=new_buf(8+2*e.length);return write_BIFF2Cell(s,t,r),s.write_shift(1,e.length),s.write_shift(e.length,e,"sbcs"),s.l<s.length?s.slice(0,s.l):s}function write_ws_biff2_cell(t,r,e,s){if(r.v!=null)switch(r.t){case"d":case"n":var a=r.t=="d"?datenum(parseDate(r.v)):r.v;a==(a|0)&&a>=0&&a<65536?write_biff_rec(t,2,write_BIFF2INT(e,s,a)):write_biff_rec(t,3,write_BIFF2NUM(e,s,a));return;case"b":case"e":write_biff_rec(t,5,write_BIFF2BERR(e,s,r.v,r.t));return;case"s":case"str":write_biff_rec(t,4,write_BIFF2LABEL(e,s,(r.v||"").slice(0,255)));return}write_biff_rec(t,1,write_BIFF2Cell(null,e,s))}function write_ws_biff2(t,r,e,s){var a=Array.isArray(r),i=safe_decode_range(r["!ref"]||"A1"),o,c="",x=[];if(i.e.c>255||i.e.r>16383){if(s.WTF)throw new Error("Range "+(r["!ref"]||"A1")+" exceeds format limit A1:IV16384");i.e.c=Math.min(i.e.c,255),i.e.r=Math.min(i.e.c,16383),o=encode_range(i)}for(var u=i.s.r;u<=i.e.r;++u){c=encode_row(u);for(var h=i.s.c;h<=i.e.c;++h){u===i.s.r&&(x[h]=encode_col(h)),o=x[h]+c;var _=a?(r[u]||[])[h]:r[o];_&&write_ws_biff2_cell(t,_,u,h)}}}function write_biff2_buf(t,r){for(var e=r||{},s=buf_array(),a=0,i=0;i<t.SheetNames.length;++i)t.SheetNames[i]==e.sheet&&(a=i);if(a==0&&e.sheet&&t.SheetNames[0]!=e.sheet)throw new Error("Sheet not found: "+e.sheet);return write_biff_rec(s,e.biff==4?1033:e.biff==3?521:9,write_BOF(t,16,e)),write_ws_biff2(s,t.Sheets[t.SheetNames[a]],a,e),write_biff_rec(s,10),s.end()}function write_FONTS_biff8(t,r,e){write_biff_rec(t,49,write_Font({sz:12,name:"Arial"},e))}function write_FMTS_biff8(t,r,e){r&&[[5,8],[23,26],[41,44],[50,392]].forEach(function(s){for(var a=s[0];a<=s[1];++a)r[a]!=null&&write_biff_rec(t,1054,write_Format(a,r[a],e))})}function write_FEAT(t,r){var e=new_buf(19);e.write_shift(4,2151),e.write_shift(4,0),e.write_shift(4,0),e.write_shift(2,3),e.write_shift(1,1),e.write_shift(4,0),write_biff_rec(t,2151,e),e=new_buf(39),e.write_shift(4,2152),e.write_shift(4,0),e.write_shift(4,0),e.write_shift(2,3),e.write_shift(1,0),e.write_shift(4,0),e.write_shift(2,1),e.write_shift(4,4),e.write_shift(2,0),write_Ref8U(safe_decode_range(r["!ref"]||"A1"),e),e.write_shift(4,4),write_biff_rec(t,2152,e)}function write_CELLXFS_biff8(t,r){for(var e=0;e<16;++e)write_biff_rec(t,224,write_XF({numFmtId:0,style:!0},0,r));r.cellXfs.forEach(function(s){write_biff_rec(t,224,write_XF(s,0,r))})}function write_ws_biff8_hlinks(t,r){for(var e=0;e<r["!links"].length;++e){var s=r["!links"][e];write_biff_rec(t,440,write_HLink(s)),s[1].Tooltip&&write_biff_rec(t,2048,write_HLinkTooltip(s))}delete r["!links"]}function write_ws_cols_biff8(t,r){if(r){var e=0;r.forEach(function(s,a){++e<=256&&s&&write_biff_rec(t,125,write_ColInfo(col_obj_w(a,s),a))})}}function write_ws_biff8_cell(t,r,e,s,a){var i=16+get_cell_style(a.cellXfs,r,a);if(r.v==null&&!r.bf){write_biff_rec(t,513,write_XLSCell(e,s,i));return}if(r.bf)write_biff_rec(t,6,write_Formula(r,e,s,a,i));else switch(r.t){case"d":case"n":var o=r.t=="d"?datenum(parseDate(r.v)):r.v;write_biff_rec(t,515,write_Number(e,s,o,i));break;case"b":case"e":write_biff_rec(t,517,write_BoolErr(e,s,r.v,i,a,r.t));break;case"s":case"str":if(a.bookSST){var c=get_sst_id(a.Strings,r.v,a.revStrings);write_biff_rec(t,253,write_LabelSst(e,s,c,i))}else write_biff_rec(t,516,write_Label(e,s,(r.v||"").slice(0,255),i,a));break;default:write_biff_rec(t,513,write_XLSCell(e,s,i))}}function write_ws_biff8(t,r,e){var s=buf_array(),a=e.SheetNames[t],i=e.Sheets[a]||{},o=(e||{}).Workbook||{},c=(o.Sheets||[])[t]||{},x=Array.isArray(i),u=r.biff==8,h,_="",v=[],b=safe_decode_range(i["!ref"]||"A1"),E=u?65536:16384;if(b.e.c>255||b.e.r>=E){if(r.WTF)throw new Error("Range "+(i["!ref"]||"A1")+" exceeds format limit A1:IV16384");b.e.c=Math.min(b.e.c,255),b.e.r=Math.min(b.e.c,E-1)}write_biff_rec(s,2057,write_BOF(e,16,r)),write_biff_rec(s,13,writeuint16(1)),write_biff_rec(s,12,writeuint16(100)),write_biff_rec(s,15,writebool(!0)),write_biff_rec(s,17,writebool(!1)),write_biff_rec(s,16,write_Xnum(.001)),write_biff_rec(s,95,writebool(!0)),write_biff_rec(s,42,writebool(!1)),write_biff_rec(s,43,writebool(!1)),write_biff_rec(s,130,writeuint16(1)),write_biff_rec(s,128,write_Guts()),write_biff_rec(s,131,writebool(!1)),write_biff_rec(s,132,writebool(!1)),u&&write_ws_cols_biff8(s,i["!cols"]),write_biff_rec(s,512,write_Dimensions(b,r)),u&&(i["!links"]=[]);for(var d=b.s.r;d<=b.e.r;++d){_=encode_row(d);for(var g=b.s.c;g<=b.e.c;++g){d===b.s.r&&(v[g]=encode_col(g)),h=v[g]+_;var y=x?(i[d]||[])[g]:i[h];y&&(write_ws_biff8_cell(s,y,d,g,r),u&&y.l&&i["!links"].push([h,y.l]))}}var R=c.CodeName||c.name||a;return u&&write_biff_rec(s,574,write_Window2((o.Views||[])[0])),u&&(i["!merges"]||[]).length&&write_biff_rec(s,229,write_MergeCells(i["!merges"])),u&&write_ws_biff8_hlinks(s,i),write_biff_rec(s,442,write_XLUnicodeString(R)),u&&write_FEAT(s,i),write_biff_rec(s,10),s.end()}function write_biff8_global(t,r,e){var s=buf_array(),a=(t||{}).Workbook||{},i=a.Sheets||[],o=a.WBProps||{},c=e.biff==8,x=e.biff==5;if(write_biff_rec(s,2057,write_BOF(t,5,e)),e.bookType=="xla"&&write_biff_rec(s,135),write_biff_rec(s,225,c?writeuint16(1200):null),write_biff_rec(s,193,writezeroes(2)),x&&write_biff_rec(s,191),x&&write_biff_rec(s,192),write_biff_rec(s,226),write_biff_rec(s,92,write_WriteAccess("SheetJS",e)),write_biff_rec(s,66,writeuint16(c?1200:1252)),c&&write_biff_rec(s,353,writeuint16(0)),c&&write_biff_rec(s,448),write_biff_rec(s,317,write_RRTabId(t.SheetNames.length)),c&&t.vbaraw&&write_biff_rec(s,211),c&&t.vbaraw){var u=o.CodeName||"ThisWorkbook";write_biff_rec(s,442,write_XLUnicodeString(u))}write_biff_rec(s,156,writeuint16(17)),write_biff_rec(s,25,writebool(!1)),write_biff_rec(s,18,writebool(!1)),write_biff_rec(s,19,writeuint16(0)),c&&write_biff_rec(s,431,writebool(!1)),c&&write_biff_rec(s,444,writeuint16(0)),write_biff_rec(s,61,write_Window1()),write_biff_rec(s,64,writebool(!1)),write_biff_rec(s,141,writeuint16(0)),write_biff_rec(s,34,writebool(safe1904(t)=="true")),write_biff_rec(s,14,writebool(!0)),c&&write_biff_rec(s,439,writebool(!1)),write_biff_rec(s,218,writeuint16(0)),write_FONTS_biff8(s,t,e),write_FMTS_biff8(s,t.SSF,e),write_CELLXFS_biff8(s,e),c&&write_biff_rec(s,352,writebool(!1));var h=s.end(),_=buf_array();c&&write_biff_rec(_,140,write_Country()),c&&e.Strings&&write_biff_continue(_,252,write_SST(e.Strings)),write_biff_rec(_,10);var v=_.end(),b=buf_array(),E=0,d=0;for(d=0;d<t.SheetNames.length;++d)E+=(c?12:11)+(c?2:1)*t.SheetNames[d].length;var g=h.length+E+v.length;for(d=0;d<t.SheetNames.length;++d){var y=i[d]||{};write_biff_rec(b,133,write_BoundSheet8({pos:g,hs:y.Hidden||0,dt:0,name:t.SheetNames[d]},e)),g+=r[d].length}var R=b.end();if(E!=R.length)throw new Error("BS8 "+E+" != "+R.length);var P=[];return h.length&&P.push(h),R.length&&P.push(R),v.length&&P.push(v),bconcat(P)}function write_biff8_buf(t,r){var e=r||{},s=[];t&&!t.SSF&&(t.SSF=dup(table_fmt)),t&&t.SSF&&(make_ssf(),SSF_load_table(t.SSF),e.revssf=evert_num(t.SSF),e.revssf[t.SSF[65535]]=0,e.ssf=t.SSF),e.Strings=[],e.Strings.Count=0,e.Strings.Unique=0,fix_write_opts(e),e.cellXfs=[],get_cell_style(e.cellXfs,{},{revssf:{General:0}}),t.Props||(t.Props={});for(var a=0;a<t.SheetNames.length;++a)s[s.length]=write_ws_biff8(a,e,t);return s.unshift(write_biff8_global(t,s,e)),bconcat(s)}function write_biff_buf(t,r){for(var e=0;e<=t.SheetNames.length;++e){var s=t.Sheets[t.SheetNames[e]];if(!(!s||!s["!ref"])){var a=decode_range(s["!ref"]);a.e.c>255&&typeof console<"u"&&console.error&&console.error("Worksheet '"+t.SheetNames[e]+"' extends beyond column IV (255).  Data may be lost.")}}var i=r||{};switch(i.biff||2){case 8:case 5:return write_biff8_buf(t,r);case 4:case 3:case 2:return write_biff2_buf(t,r)}throw new Error("invalid type "+i.bookType+" for BIFF")}function make_html_row(t,r,e,s){for(var a=t["!merges"]||[],i=[],o=r.s.c;o<=r.e.c;++o){for(var c=0,x=0,u=0;u<a.length;++u)if(!(a[u].s.r>e||a[u].s.c>o)&&!(a[u].e.r<e||a[u].e.c<o)){if(a[u].s.r<e||a[u].s.c<o){c=-1;break}c=a[u].e.r-a[u].s.r+1,x=a[u].e.c-a[u].s.c+1;break}if(!(c<0)){var h=encode_cell({r:e,c:o}),_=s.dense?(t[e]||[])[o]:t[h],v=_&&_.v!=null&&(_.h||escapehtml(_.w||(format_cell(_),_.w)||""))||"",b={};c>1&&(b.rowspan=c),x>1&&(b.colspan=x),s.editable?v='<span contenteditable="true">'+v+"</span>":_&&(b["data-t"]=_&&_.t||"z",_.v!=null&&(b["data-v"]=_.v),_.z!=null&&(b["data-z"]=_.z),_.l&&(_.l.Target||"#").charAt(0)!="#"&&(v='<a href="'+_.l.Target+'">'+v+"</a>")),b.id=(s.id||"sjs")+"-"+h,i.push(writextag("td",v,b))}}var E="<tr>";return E+i.join("")+"</tr>"}var HTML_BEGIN='<html><head><meta charset="utf-8"/><title>SheetJS Table Export</title></head><body>',HTML_END="</body></html>";function make_html_preamble(t,r,e){var s=[];return s.join("")+"<table"+(e&&e.id?' id="'+e.id+'"':"")+">"}function sheet_to_html(t,r){var e=r||{},s=e.header!=null?e.header:HTML_BEGIN,a=e.footer!=null?e.footer:HTML_END,i=[s],o=decode_range(t["!ref"]);e.dense=Array.isArray(t),i.push(make_html_preamble(t,o,e));for(var c=o.s.r;c<=o.e.r;++c)i.push(make_html_row(t,o,c,e));return i.push("</table>"+a),i.join("")}function sheet_add_dom(t,r,e){var s=e||{},a=0,i=0;if(s.origin!=null)if(typeof s.origin=="number")a=s.origin;else{var o=typeof s.origin=="string"?decode_cell(s.origin):s.origin;a=o.r,i=o.c}var c=r.getElementsByTagName("tr"),x=Math.min(s.sheetRows||1e7,c.length),u={s:{r:0,c:0},e:{r:a,c:i}};if(t["!ref"]){var h=decode_range(t["!ref"]);u.s.r=Math.min(u.s.r,h.s.r),u.s.c=Math.min(u.s.c,h.s.c),u.e.r=Math.max(u.e.r,h.e.r),u.e.c=Math.max(u.e.c,h.e.c),a==-1&&(u.e.r=a=h.e.r+1)}var _=[],v=0,b=t["!rows"]||(t["!rows"]=[]),E=0,d=0,g=0,y=0,R=0,P=0;for(t["!cols"]||(t["!cols"]=[]);E<c.length&&d<x;++E){var F=c[E];if(is_dom_element_hidden(F)){if(s.display)continue;b[d]={hidden:!0}}var S=F.children;for(g=y=0;g<S.length;++g){var I=S[g];if(!(s.display&&is_dom_element_hidden(I))){var w=I.hasAttribute("data-v")?I.getAttribute("data-v"):I.hasAttribute("v")?I.getAttribute("v"):htmldecode(I.innerHTML),j=I.getAttribute("data-z")||I.getAttribute("z");for(v=0;v<_.length;++v){var C=_[v];C.s.c==y+i&&C.s.r<d+a&&d+a<=C.e.r&&(y=C.e.c+1-i,v=-1)}P=+I.getAttribute("colspan")||1,((R=+I.getAttribute("rowspan")||1)>1||P>1)&&_.push({s:{r:d+a,c:y+i},e:{r:d+a+(R||1)-1,c:y+i+(P||1)-1}});var V={t:"s",v:w},O=I.getAttribute("data-t")||I.getAttribute("t")||"";w!=null&&(w.length==0?V.t=O||"z":s.raw||w.trim().length==0||O=="s"||(w==="TRUE"?V={t:"b",v:!0}:w==="FALSE"?V={t:"b",v:!1}:isNaN(fuzzynum(w))?isNaN(fuzzydate(w).getDate())||(V={t:"d",v:parseDate(w)},s.cellDates||(V={t:"n",v:datenum(V.v)}),V.z=s.dateNF||table_fmt[14]):V={t:"n",v:fuzzynum(w)})),V.z===void 0&&j!=null&&(V.z=j);var H="",z=I.getElementsByTagName("A");if(z&&z.length)for(var pe=0;pe<z.length&&!(z[pe].hasAttribute("href")&&(H=z[pe].getAttribute("href"),H.charAt(0)!="#"));++pe);H&&H.charAt(0)!="#"&&(V.l={Target:H}),s.dense?(t[d+a]||(t[d+a]=[]),t[d+a][y+i]=V):t[encode_cell({c:y+i,r:d+a})]=V,u.e.c<y+i&&(u.e.c=y+i),y+=P}}++d}return _.length&&(t["!merges"]=(t["!merges"]||[]).concat(_)),u.e.r=Math.max(u.e.r,d-1+a),t["!ref"]=encode_range(u),d>=x&&(t["!fullref"]=encode_range((u.e.r=c.length-E+d-1+a,u))),t}function parse_dom_table(t,r){var e=r||{},s=e.dense?[]:{};return sheet_add_dom(s,t,r)}function table_to_book(t,r){return sheet_to_workbook(parse_dom_table(t,r),r)}function is_dom_element_hidden(t){var r="",e=get_get_computed_style_function(t);return e&&(r=e(t).getPropertyValue("display")),r||(r=t.style&&t.style.display),r==="none"}function get_get_computed_style_function(t){return t.ownerDocument.defaultView&&typeof t.ownerDocument.defaultView.getComputedStyle=="function"?t.ownerDocument.defaultView.getComputedStyle:typeof getComputedStyle=="function"?getComputedStyle:null}var write_styles_ods=function(){var t=["<office:master-styles>",'<style:master-page style:name="mp1" style:page-layout-name="mp1">',"<style:header/>",'<style:header-left style:display="false"/>',"<style:footer/>",'<style:footer-left style:display="false"/>',"</style:master-page>","</office:master-styles>"].join(""),r="<office:document-styles "+wxt_helper({"xmlns:office":"urn:oasis:names:tc:opendocument:xmlns:office:1.0","xmlns:table":"urn:oasis:names:tc:opendocument:xmlns:table:1.0","xmlns:style":"urn:oasis:names:tc:opendocument:xmlns:style:1.0","xmlns:text":"urn:oasis:names:tc:opendocument:xmlns:text:1.0","xmlns:draw":"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0","xmlns:fo":"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0","xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:dc":"http://purl.org/dc/elements/1.1/","xmlns:number":"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0","xmlns:svg":"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0","xmlns:of":"urn:oasis:names:tc:opendocument:xmlns:of:1.2","office:version":"1.2"})+">"+t+"</office:document-styles>";return function(){return XML_HEADER+r}}(),write_content_ods=function(){var t=function(i){return escapexml(i).replace(/  +/g,function(o){return'<text:s text:c="'+o.length+'"/>'}).replace(/\t/g,"<text:tab/>").replace(/\n/g,"</text:p><text:p>").replace(/^ /,"<text:s/>").replace(/ $/,"<text:s/>")},r=`          <table:table-cell />
`,e=`          <table:covered-table-cell/>
`,s=function(i,o,c){var x=[];x.push('      <table:table table:name="'+escapexml(o.SheetNames[c])+`" table:style-name="ta1">
`);var u=0,h=0,_=decode_range(i["!ref"]||"A1"),v=i["!merges"]||[],b=0,E=Array.isArray(i);if(i["!cols"])for(h=0;h<=_.e.c;++h)x.push("        <table:table-column"+(i["!cols"][h]?' table:style-name="co'+i["!cols"][h].ods+'"':"")+`></table:table-column>
`);var d="",g=i["!rows"]||[];for(u=0;u<_.s.r;++u)d=g[u]?' table:style-name="ro'+g[u].ods+'"':"",x.push("        <table:table-row"+d+`></table:table-row>
`);for(;u<=_.e.r;++u){for(d=g[u]?' table:style-name="ro'+g[u].ods+'"':"",x.push("        <table:table-row"+d+`>
`),h=0;h<_.s.c;++h)x.push(r);for(;h<=_.e.c;++h){var y=!1,R={},P="";for(b=0;b!=v.length;++b)if(!(v[b].s.c>h)&&!(v[b].s.r>u)&&!(v[b].e.c<h)&&!(v[b].e.r<u)){(v[b].s.c!=h||v[b].s.r!=u)&&(y=!0),R["table:number-columns-spanned"]=v[b].e.c-v[b].s.c+1,R["table:number-rows-spanned"]=v[b].e.r-v[b].s.r+1;break}if(y){x.push(e);continue}var F=encode_cell({r:u,c:h}),S=E?(i[u]||[])[h]:i[F];if(S&&S.f&&(R["table:formula"]=escapexml(csf_to_ods_formula(S.f)),S.F&&S.F.slice(0,F.length)==F)){var I=decode_range(S.F);R["table:number-matrix-columns-spanned"]=I.e.c-I.s.c+1,R["table:number-matrix-rows-spanned"]=I.e.r-I.s.r+1}if(!S){x.push(r);continue}switch(S.t){case"b":P=S.v?"TRUE":"FALSE",R["office:value-type"]="boolean",R["office:boolean-value"]=S.v?"true":"false";break;case"n":P=S.w||String(S.v||0),R["office:value-type"]="float",R["office:value"]=S.v||0;break;case"s":case"str":P=S.v==null?"":S.v,R["office:value-type"]="string";break;case"d":P=S.w||parseDate(S.v).toISOString(),R["office:value-type"]="date",R["office:date-value"]=parseDate(S.v).toISOString(),R["table:style-name"]="ce1";break;default:x.push(r);continue}var w=t(P);if(S.l&&S.l.Target){var j=S.l.Target;j=j.charAt(0)=="#"?"#"+csf_to_ods_3D(j.slice(1)):j,j.charAt(0)!="#"&&!j.match(/^\w+:/)&&(j="../"+j),w=writextag("text:a",w,{"xlink:href":j.replace(/&/g,"&amp;")})}x.push("          "+writextag("table:table-cell",writextag("text:p",w,{}),R)+`
`)}x.push(`        </table:table-row>
`)}return x.push(`      </table:table>
`),x.join("")},a=function(i,o){i.push(` <office:automatic-styles>
`),i.push(`  <number:date-style style:name="N37" number:automatic-order="true">
`),i.push(`   <number:month number:style="long"/>
`),i.push(`   <number:text>/</number:text>
`),i.push(`   <number:day number:style="long"/>
`),i.push(`   <number:text>/</number:text>
`),i.push(`   <number:year/>
`),i.push(`  </number:date-style>
`);var c=0;o.SheetNames.map(function(u){return o.Sheets[u]}).forEach(function(u){if(u&&u["!cols"]){for(var h=0;h<u["!cols"].length;++h)if(u["!cols"][h]){var _=u["!cols"][h];if(_.width==null&&_.wpx==null&&_.wch==null)continue;process_col(_),_.ods=c;var v=u["!cols"][h].wpx+"px";i.push('  <style:style style:name="co'+c+`" style:family="table-column">
`),i.push('   <style:table-column-properties fo:break-before="auto" style:column-width="'+v+`"/>
`),i.push(`  </style:style>
`),++c}}});var x=0;o.SheetNames.map(function(u){return o.Sheets[u]}).forEach(function(u){if(u&&u["!rows"]){for(var h=0;h<u["!rows"].length;++h)if(u["!rows"][h]){u["!rows"][h].ods=x;var _=u["!rows"][h].hpx+"px";i.push('  <style:style style:name="ro'+x+`" style:family="table-row">
`),i.push('   <style:table-row-properties fo:break-before="auto" style:row-height="'+_+`"/>
`),i.push(`  </style:style>
`),++x}}}),i.push(`  <style:style style:name="ta1" style:family="table" style:master-page-name="mp1">
`),i.push(`   <style:table-properties table:display="true" style:writing-mode="lr-tb"/>
`),i.push(`  </style:style>
`),i.push(`  <style:style style:name="ce1" style:family="table-cell" style:parent-style-name="Default" style:data-style-name="N37"/>
`),i.push(` </office:automatic-styles>
`)};return function(o,c){var x=[XML_HEADER],u=wxt_helper({"xmlns:office":"urn:oasis:names:tc:opendocument:xmlns:office:1.0","xmlns:table":"urn:oasis:names:tc:opendocument:xmlns:table:1.0","xmlns:style":"urn:oasis:names:tc:opendocument:xmlns:style:1.0","xmlns:text":"urn:oasis:names:tc:opendocument:xmlns:text:1.0","xmlns:draw":"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0","xmlns:fo":"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0","xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:dc":"http://purl.org/dc/elements/1.1/","xmlns:meta":"urn:oasis:names:tc:opendocument:xmlns:meta:1.0","xmlns:number":"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0","xmlns:presentation":"urn:oasis:names:tc:opendocument:xmlns:presentation:1.0","xmlns:svg":"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0","xmlns:chart":"urn:oasis:names:tc:opendocument:xmlns:chart:1.0","xmlns:dr3d":"urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0","xmlns:math":"http://www.w3.org/1998/Math/MathML","xmlns:form":"urn:oasis:names:tc:opendocument:xmlns:form:1.0","xmlns:script":"urn:oasis:names:tc:opendocument:xmlns:script:1.0","xmlns:ooo":"http://openoffice.org/2004/office","xmlns:ooow":"http://openoffice.org/2004/writer","xmlns:oooc":"http://openoffice.org/2004/calc","xmlns:dom":"http://www.w3.org/2001/xml-events","xmlns:xforms":"http://www.w3.org/2002/xforms","xmlns:xsd":"http://www.w3.org/2001/XMLSchema","xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance","xmlns:sheet":"urn:oasis:names:tc:opendocument:sh33tjs:1.0","xmlns:rpt":"http://openoffice.org/2005/report","xmlns:of":"urn:oasis:names:tc:opendocument:xmlns:of:1.2","xmlns:xhtml":"http://www.w3.org/1999/xhtml","xmlns:grddl":"http://www.w3.org/2003/g/data-view#","xmlns:tableooo":"http://openoffice.org/2009/table","xmlns:drawooo":"http://openoffice.org/2010/draw","xmlns:calcext":"urn:org:documentfoundation:names:experimental:calc:xmlns:calcext:1.0","xmlns:loext":"urn:org:documentfoundation:names:experimental:office:xmlns:loext:1.0","xmlns:field":"urn:openoffice:names:experimental:ooo-ms-interop:xmlns:field:1.0","xmlns:formx":"urn:openoffice:names:experimental:ooxml-odf-interop:xmlns:form:1.0","xmlns:css3t":"http://www.w3.org/TR/css3-text/","office:version":"1.2"}),h=wxt_helper({"xmlns:config":"urn:oasis:names:tc:opendocument:xmlns:config:1.0","office:mimetype":"application/vnd.oasis.opendocument.spreadsheet"});c.bookType=="fods"?(x.push("<office:document"+u+h+`>
`),x.push(write_meta_ods().replace(/office:document-meta/g,"office:meta"))):x.push("<office:document-content"+u+`>
`),a(x,o),x.push(`  <office:body>
`),x.push(`    <office:spreadsheet>
`);for(var _=0;_!=o.SheetNames.length;++_)x.push(s(o.Sheets[o.SheetNames[_]],o,_));return x.push(`    </office:spreadsheet>
`),x.push(`  </office:body>
`),c.bookType=="fods"?x.push("</office:document>"):x.push("</office:document-content>"),x.join("")}}();function write_ods(t,r){if(r.bookType=="fods")return write_content_ods(t,r);var e=zip_new(),s="",a=[],i=[];return s="mimetype",zip_add_file(e,s,"application/vnd.oasis.opendocument.spreadsheet"),s="content.xml",zip_add_file(e,s,write_content_ods(t,r)),a.push([s,"text/xml"]),i.push([s,"ContentFile"]),s="styles.xml",zip_add_file(e,s,write_styles_ods(t,r)),a.push([s,"text/xml"]),i.push([s,"StylesFile"]),s="meta.xml",zip_add_file(e,s,XML_HEADER+write_meta_ods()),a.push([s,"text/xml"]),i.push([s,"MetadataFile"]),s="manifest.rdf",zip_add_file(e,s,write_rdf(i)),a.push([s,"application/rdf+xml"]),s="META-INF/manifest.xml",zip_add_file(e,s,write_manifest(a)),e}/*! sheetjs (C) 2013-present SheetJS -- http://sheetjs.com */function u8_to_dataview(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function stru8(t){return typeof TextEncoder<"u"?new TextEncoder().encode(t):s2a(utf8write(t))}function u8contains(t,r){e:for(var e=0;e<=t.length-r.length;++e){for(var s=0;s<r.length;++s)if(t[e+s]!=r[s])continue e;return!0}return!1}function u8concat(t){var r=t.reduce(function(a,i){return a+i.length},0),e=new Uint8Array(r),s=0;return t.forEach(function(a){e.set(a,s),s+=a.length}),e}function writeDecimal128LE(t,r,e){var s=Math.floor(e==0?0:Math.LOG10E*Math.log(Math.abs(e)))+6176-20,a=e/Math.pow(10,s-6176);t[r+15]|=s>>7,t[r+14]|=(s&127)<<1;for(var i=0;a>=1;++i,a/=256)t[r+i]=a&255;t[r+15]|=e>=0?0:128}function parse_varint49(t,r){var e=r?r[0]:0,s=t[e]&127;e:if(t[e++]>=128&&(s|=(t[e]&127)<<7,t[e++]<128||(s|=(t[e]&127)<<14,t[e++]<128)||(s|=(t[e]&127)<<21,t[e++]<128)||(s+=(t[e]&127)*Math.pow(2,28),++e,t[e++]<128)||(s+=(t[e]&127)*Math.pow(2,35),++e,t[e++]<128)||(s+=(t[e]&127)*Math.pow(2,42),++e,t[e++]<128)))break e;return r&&(r[0]=e),s}function write_varint49(t){var r=new Uint8Array(7);r[0]=t&127;var e=1;e:if(t>127){if(r[e-1]|=128,r[e]=t>>7&127,++e,t<=16383||(r[e-1]|=128,r[e]=t>>14&127,++e,t<=2097151)||(r[e-1]|=128,r[e]=t>>21&127,++e,t<=268435455)||(r[e-1]|=128,r[e]=t/256>>>21&127,++e,t<=34359738367)||(r[e-1]|=128,r[e]=t/65536>>>21&127,++e,t<=4398046511103))break e;r[e-1]|=128,r[e]=t/16777216>>>21&127,++e}return r.slice(0,e)}function varint_to_i32(t){var r=0,e=t[r]&127;e:if(t[r++]>=128){if(e|=(t[r]&127)<<7,t[r++]<128||(e|=(t[r]&127)<<14,t[r++]<128)||(e|=(t[r]&127)<<21,t[r++]<128))break e;e|=(t[r]&127)<<28}return e}function parse_shallow(t){for(var r=[],e=[0];e[0]<t.length;){var s=e[0],a=parse_varint49(t,e),i=a&7;a=Math.floor(a/8);var o=0,c;if(a==0)break;switch(i){case 0:{for(var x=e[0];t[e[0]++]>=128;);c=t.slice(x,e[0])}break;case 5:o=4,c=t.slice(e[0],e[0]+o),e[0]+=o;break;case 1:o=8,c=t.slice(e[0],e[0]+o),e[0]+=o;break;case 2:o=parse_varint49(t,e),c=t.slice(e[0],e[0]+o),e[0]+=o;break;case 3:case 4:default:throw new Error("PB Type ".concat(i," for Field ").concat(a," at offset ").concat(s))}var u={data:c,type:i};r[a]==null?r[a]=[u]:r[a].push(u)}return r}function write_shallow(t){var r=[];return t.forEach(function(e,s){e.forEach(function(a){a.data&&(r.push(write_varint49(s*8+a.type)),a.type==2&&r.push(write_varint49(a.data.length)),r.push(a.data))})}),u8concat(r)}function parse_iwa_file(t){for(var r,e=[],s=[0];s[0]<t.length;){var a=parse_varint49(t,s),i=parse_shallow(t.slice(s[0],s[0]+a));s[0]+=a;var o={id:varint_to_i32(i[1][0].data),messages:[]};i[2].forEach(function(c){var x=parse_shallow(c.data),u=varint_to_i32(x[3][0].data);o.messages.push({meta:x,data:t.slice(s[0],s[0]+u)}),s[0]+=u}),(r=i[3])!=null&&r[0]&&(o.merge=varint_to_i32(i[3][0].data)>>>0>0),e.push(o)}return e}function write_iwa_file(t){var r=[];return t.forEach(function(e){var s=[];s[1]=[{data:write_varint49(e.id),type:0}],s[2]=[],e.merge!=null&&(s[3]=[{data:write_varint49(+!!e.merge),type:0}]);var a=[];e.messages.forEach(function(o){a.push(o.data),o.meta[3]=[{type:0,data:write_varint49(o.data.length)}],s[2].push({data:write_shallow(o.meta),type:2})});var i=write_shallow(s);r.push(write_varint49(i.length)),r.push(i),a.forEach(function(o){return r.push(o)})}),u8concat(r)}function parse_snappy_chunk(t,r){if(t!=0)throw new Error("Unexpected Snappy chunk type ".concat(t));for(var e=[0],s=parse_varint49(r,e),a=[];e[0]<r.length;){var i=r[e[0]]&3;if(i==0){var o=r[e[0]++]>>2;if(o<60)++o;else{var c=o-59;o=r[e[0]],c>1&&(o|=r[e[0]+1]<<8),c>2&&(o|=r[e[0]+2]<<16),c>3&&(o|=r[e[0]+3]<<24),o>>>=0,o++,e[0]+=c}a.push(r.slice(e[0],e[0]+o)),e[0]+=o;continue}else{var x=0,u=0;if(i==1?(u=(r[e[0]]>>2&7)+4,x=(r[e[0]++]&224)<<3,x|=r[e[0]++]):(u=(r[e[0]++]>>2)+1,i==2?(x=r[e[0]]|r[e[0]+1]<<8,e[0]+=2):(x=(r[e[0]]|r[e[0]+1]<<8|r[e[0]+2]<<16|r[e[0]+3]<<24)>>>0,e[0]+=4)),a=[u8concat(a)],x==0)throw new Error("Invalid offset 0");if(x>a[0].length)throw new Error("Invalid offset beyond length");if(u>=x)for(a.push(a[0].slice(-x)),u-=x;u>=a[a.length-1].length;)a.push(a[a.length-1]),u-=a[a.length-1].length;a.push(a[0].slice(-x,-x+u))}}var h=u8concat(a);if(h.length!=s)throw new Error("Unexpected length: ".concat(h.length," != ").concat(s));return h}function decompress_iwa_file(t){for(var r=[],e=0;e<t.length;){var s=t[e++],a=t[e]|t[e+1]<<8|t[e+2]<<16;e+=3,r.push(parse_snappy_chunk(s,t.slice(e,e+a))),e+=a}if(e!==t.length)throw new Error("data is not a valid framed stream!");return u8concat(r)}function compress_iwa_file(t){for(var r=[],e=0;e<t.length;){var s=Math.min(t.length-e,268435455),a=new Uint8Array(4);r.push(a);var i=write_varint49(s),o=i.length;r.push(i),s<=60?(o++,r.push(new Uint8Array([s-1<<2]))):s<=256?(o+=2,r.push(new Uint8Array([240,s-1&255]))):s<=65536?(o+=3,r.push(new Uint8Array([244,s-1&255,s-1>>8&255]))):s<=16777216?(o+=4,r.push(new Uint8Array([248,s-1&255,s-1>>8&255,s-1>>16&255]))):s<=4294967296&&(o+=5,r.push(new Uint8Array([252,s-1&255,s-1>>8&255,s-1>>16&255,s-1>>>24&255]))),r.push(t.slice(e,e+s)),o+=s,a[0]=0,a[1]=o&255,a[2]=o>>8&255,a[3]=o>>16&255,e+=s}return u8concat(r)}function write_new_storage(t,r){var e=new Uint8Array(32),s=u8_to_dataview(e),a=12,i=0;switch(e[0]=5,t.t){case"n":e[1]=2,writeDecimal128LE(e,a,t.v),i|=1,a+=16;break;case"b":e[1]=6,s.setFloat64(a,t.v?1:0,!0),i|=2,a+=8;break;case"s":if(r.indexOf(t.v)==-1)throw new Error("Value ".concat(t.v," missing from SST!"));e[1]=3,s.setUint32(a,r.indexOf(t.v),!0),i|=8,a+=4;break;default:throw"unsupported cell type "+t.t}return s.setUint32(8,i,!0),e.slice(0,a)}function write_old_storage(t,r){var e=new Uint8Array(32),s=u8_to_dataview(e),a=12,i=0;switch(e[0]=3,t.t){case"n":e[2]=2,s.setFloat64(a,t.v,!0),i|=32,a+=8;break;case"b":e[2]=6,s.setFloat64(a,t.v?1:0,!0),i|=32,a+=8;break;case"s":if(r.indexOf(t.v)==-1)throw new Error("Value ".concat(t.v," missing from SST!"));e[2]=3,s.setUint32(a,r.indexOf(t.v),!0),i|=16,a+=4;break;default:throw"unsupported cell type "+t.t}return s.setUint32(4,i,!0),e.slice(0,a)}function parse_TSP_Reference(t){var r=parse_shallow(t);return parse_varint49(r[1][0].data)}function write_tile_row(t,r,e){var s,a,i,o;if(!((s=t[6])!=null&&s[0])||!((a=t[7])!=null&&a[0]))throw"Mutation only works on post-BNC storages!";var c=((o=(i=t[8])==null?void 0:i[0])==null?void 0:o.data)&&varint_to_i32(t[8][0].data)>0||!1;if(c)throw"Math only works with normal offsets";for(var x=0,u=u8_to_dataview(t[7][0].data),h=0,_=[],v=u8_to_dataview(t[4][0].data),b=0,E=[],d=0;d<r.length;++d){if(r[d]==null){u.setUint16(d*2,65535,!0),v.setUint16(d*2,65535);continue}u.setUint16(d*2,h,!0),v.setUint16(d*2,b,!0);var g,y;switch(typeof r[d]){case"string":g=write_new_storage({t:"s",v:r[d]},e),y=write_old_storage({t:"s",v:r[d]},e);break;case"number":g=write_new_storage({t:"n",v:r[d]},e),y=write_old_storage({t:"n",v:r[d]},e);break;case"boolean":g=write_new_storage({t:"b",v:r[d]},e),y=write_old_storage({t:"b",v:r[d]},e);break;default:throw new Error("Unsupported value "+r[d])}_.push(g),h+=g.length,E.push(y),b+=y.length,++x}for(t[2][0].data=write_varint49(x);d<t[7][0].data.length/2;++d)u.setUint16(d*2,65535,!0),v.setUint16(d*2,65535,!0);return t[6][0].data=u8concat(_),t[3][0].data=u8concat(E),x}function write_numbers_iwa(t,r){if(!r||!r.numbers)throw new Error("Must pass a `numbers` option -- check the README");var e=t.Sheets[t.SheetNames[0]];t.SheetNames.length>1&&console.error("The Numbers writer currently writes only the first table");var s=decode_range(e["!ref"]);s.s.r=s.s.c=0;var a=!1;s.e.c>9&&(a=!0,s.e.c=9),s.e.r>49&&(a=!0,s.e.r=49),a&&console.error("The Numbers writer is currently limited to ".concat(encode_range(s)));var i=sheet_to_json(e,{range:s,header:1}),o=["~Sh33tJ5~"];i.forEach(function(N){return N.forEach(function(T){typeof T=="string"&&o.push(T)})});var c={},x=[],u=CFB.read(r.numbers,{type:"base64"});u.FileIndex.map(function(N,T){return[N,u.FullPaths[T]]}).forEach(function(N){var T=N[0],A=N[1];if(T.type==2&&T.name.match(/\.iwa/)){var D=T.content,B=decompress_iwa_file(D),U=parse_iwa_file(B);U.forEach(function(Y){x.push(Y.id),c[Y.id]={deps:[],location:A,type:varint_to_i32(Y.messages[0].meta[1][0].data)}})}}),x.sort(function(N,T){return N-T});var h=x.filter(function(N){return N>1}).map(function(N){return[N,write_varint49(N)]});u.FileIndex.map(function(N,T){return[N,u.FullPaths[T]]}).forEach(function(N){var T=N[0];if(N[1],!!T.name.match(/\.iwa/)){var A=parse_iwa_file(decompress_iwa_file(T.content));A.forEach(function(D){D.messages.forEach(function(B){h.forEach(function(U){D.messages.some(function(Y){return varint_to_i32(Y.meta[1][0].data)!=11006&&u8contains(Y.data,U[1])})&&c[U[0]].deps.push(D.id)})})})}});for(var _=CFB.find(u,c[1].location),v=parse_iwa_file(decompress_iwa_file(_.content)),b,E=0;E<v.length;++E){var d=v[E];d.id==1&&(b=d)}var g=parse_TSP_Reference(parse_shallow(b.messages[0].data)[1][0].data);for(_=CFB.find(u,c[g].location),v=parse_iwa_file(decompress_iwa_file(_.content)),E=0;E<v.length;++E)d=v[E],d.id==g&&(b=d);for(g=parse_TSP_Reference(parse_shallow(b.messages[0].data)[2][0].data),_=CFB.find(u,c[g].location),v=parse_iwa_file(decompress_iwa_file(_.content)),E=0;E<v.length;++E)d=v[E],d.id==g&&(b=d);for(g=parse_TSP_Reference(parse_shallow(b.messages[0].data)[2][0].data),_=CFB.find(u,c[g].location),v=parse_iwa_file(decompress_iwa_file(_.content)),E=0;E<v.length;++E)d=v[E],d.id==g&&(b=d);var y=parse_shallow(b.messages[0].data);{y[6][0].data=write_varint49(s.e.r+1),y[7][0].data=write_varint49(s.e.c+1);var R=parse_TSP_Reference(y[46][0].data),P=CFB.find(u,c[R].location),F=parse_iwa_file(decompress_iwa_file(P.content));{for(var S=0;S<F.length&&F[S].id!=R;++S);if(F[S].id!=R)throw"Bad ColumnRowUIDMapArchive";var I=parse_shallow(F[S].messages[0].data);I[1]=[],I[2]=[],I[3]=[];for(var w=0;w<=s.e.c;++w){var j=[];j[1]=j[2]=[{type:0,data:write_varint49(w+420690)}],I[1].push({type:2,data:write_shallow(j)}),I[2].push({type:0,data:write_varint49(w)}),I[3].push({type:0,data:write_varint49(w)})}I[4]=[],I[5]=[],I[6]=[];for(var C=0;C<=s.e.r;++C)j=[],j[1]=j[2]=[{type:0,data:write_varint49(C+726270)}],I[4].push({type:2,data:write_shallow(j)}),I[5].push({type:0,data:write_varint49(C)}),I[6].push({type:0,data:write_varint49(C)});F[S].messages[0].data=write_shallow(I)}P.content=compress_iwa_file(write_iwa_file(F)),P.size=P.content.length,delete y[46];var V=parse_shallow(y[4][0].data);{V[7][0].data=write_varint49(s.e.r+1);var O=parse_shallow(V[1][0].data),H=parse_TSP_Reference(O[2][0].data);P=CFB.find(u,c[H].location),F=parse_iwa_file(decompress_iwa_file(P.content));{if(F[0].id!=H)throw"Bad HeaderStorageBucket";var z=parse_shallow(F[0].messages[0].data);for(C=0;C<i.length;++C){var pe=parse_shallow(z[2][0].data);pe[1][0].data=write_varint49(C),pe[4][0].data=write_varint49(i[C].length),z[2][C]={type:z[2][0].type,data:write_shallow(pe)}}F[0].messages[0].data=write_shallow(z)}P.content=compress_iwa_file(write_iwa_file(F)),P.size=P.content.length;var ee=parse_TSP_Reference(V[2][0].data);P=CFB.find(u,c[ee].location),F=parse_iwa_file(decompress_iwa_file(P.content));{if(F[0].id!=ee)throw"Bad HeaderStorageBucket";for(z=parse_shallow(F[0].messages[0].data),w=0;w<=s.e.c;++w)pe=parse_shallow(z[2][0].data),pe[1][0].data=write_varint49(w),pe[4][0].data=write_varint49(s.e.r+1),z[2][w]={type:z[2][0].type,data:write_shallow(pe)};F[0].messages[0].data=write_shallow(z)}P.content=compress_iwa_file(write_iwa_file(F)),P.size=P.content.length;var he=parse_TSP_Reference(V[4][0].data);(function(){for(var N=CFB.find(u,c[he].location),T=parse_iwa_file(decompress_iwa_file(N.content)),A,D=0;D<T.length;++D){var B=T[D];B.id==he&&(A=B)}var U=parse_shallow(A.messages[0].data);{U[3]=[];var Y=[];o.forEach(function(xe,Se){Y[1]=[{type:0,data:write_varint49(Se)}],Y[2]=[{type:0,data:write_varint49(1)}],Y[3]=[{type:2,data:stru8(xe)}],U[3].push({type:2,data:write_shallow(Y)})})}A.messages[0].data=write_shallow(U);var G=write_iwa_file(T),fe=compress_iwa_file(G);N.content=fe,N.size=N.content.length})();var re=parse_shallow(V[3][0].data);{var me=re[1][0];delete re[2];var te=parse_shallow(me.data);{var ce=parse_TSP_Reference(te[2][0].data);(function(){for(var N=CFB.find(u,c[ce].location),T=parse_iwa_file(decompress_iwa_file(N.content)),A,D=0;D<T.length;++D){var B=T[D];B.id==ce&&(A=B)}var U=parse_shallow(A.messages[0].data);{delete U[6],delete re[7];var Y=new Uint8Array(U[5][0].data);U[5]=[];for(var G=0,fe=0;fe<=s.e.r;++fe){var xe=parse_shallow(Y);G+=write_tile_row(xe,i[fe],o),xe[1][0].data=write_varint49(fe),U[5].push({data:write_shallow(xe),type:2})}U[1]=[{type:0,data:write_varint49(s.e.c+1)}],U[2]=[{type:0,data:write_varint49(s.e.r+1)}],U[3]=[{type:0,data:write_varint49(G)}],U[4]=[{type:0,data:write_varint49(s.e.r+1)}]}A.messages[0].data=write_shallow(U);var Se=write_iwa_file(T),Ce=compress_iwa_file(Se);N.content=Ce,N.size=N.content.length})()}me.data=write_shallow(te)}V[3][0].data=write_shallow(re)}y[4][0].data=write_shallow(V)}b.messages[0].data=write_shallow(y);var ye=write_iwa_file(v),L=compress_iwa_file(ye);return _.content=L,_.size=_.content.length,u}function fix_opts_func(t){return function(e){for(var s=0;s!=t.length;++s){var a=t[s];e[a[0]]===void 0&&(e[a[0]]=a[1]),a[2]==="n"&&(e[a[0]]=Number(e[a[0]]))}}}function fix_write_opts(t){fix_opts_func([["cellDates",!1],["bookSST",!1],["bookType","xlsx"],["compression",!1],["WTF",!1]])(t)}function write_zip(t,r){return r.bookType=="ods"?write_ods(t,r):r.bookType=="numbers"?write_numbers_iwa(t,r):r.bookType=="xlsb"?write_zip_xlsxb(t,r):write_zip_xlsx(t,r)}function write_zip_xlsxb(t,r){_shapeid=1024,t&&!t.SSF&&(t.SSF=dup(table_fmt)),t&&t.SSF&&(make_ssf(),SSF_load_table(t.SSF),r.revssf=evert_num(t.SSF),r.revssf[t.SSF[65535]]=0,r.ssf=t.SSF),r.rels={},r.wbrels={},r.Strings=[],r.Strings.Count=0,r.Strings.Unique=0,browser_has_Map?r.revStrings=new Map:(r.revStrings={},r.revStrings.foo=[],delete r.revStrings.foo);var e=r.bookType=="xlsb"?"bin":"xml",s=VBAFMTS.indexOf(r.bookType)>-1,a=new_ct();fix_write_opts(r=r||{});var i=zip_new(),o="",c=0;if(r.cellXfs=[],get_cell_style(r.cellXfs,{},{revssf:{General:0}}),t.Props||(t.Props={}),o="docProps/core.xml",zip_add_file(i,o,write_core_props(t.Props,r)),a.coreprops.push(o),add_rels(r.rels,2,o,RELS.CORE_PROPS),o="docProps/app.xml",!(t.Props&&t.Props.SheetNames))if(!t.Workbook||!t.Workbook.Sheets)t.Props.SheetNames=t.SheetNames;else{for(var x=[],u=0;u<t.SheetNames.length;++u)(t.Workbook.Sheets[u]||{}).Hidden!=2&&x.push(t.SheetNames[u]);t.Props.SheetNames=x}for(t.Props.Worksheets=t.Props.SheetNames.length,zip_add_file(i,o,write_ext_props(t.Props)),a.extprops.push(o),add_rels(r.rels,3,o,RELS.EXT_PROPS),t.Custprops!==t.Props&&keys(t.Custprops||{}).length>0&&(o="docProps/custom.xml",zip_add_file(i,o,write_cust_props(t.Custprops)),a.custprops.push(o),add_rels(r.rels,4,o,RELS.CUST_PROPS)),c=1;c<=t.SheetNames.length;++c){var h={"!id":{}},_=t.Sheets[t.SheetNames[c-1]],v=(_||{})["!type"]||"sheet";switch(v){case"chart":default:o="xl/worksheets/sheet"+c+"."+e,zip_add_file(i,o,write_ws(c-1,o,r,t,h)),a.sheets.push(o),add_rels(r.wbrels,-1,"worksheets/sheet"+c+"."+e,RELS.WS[0])}if(_){var b=_["!comments"],E=!1,d="";b&&b.length>0&&(d="xl/comments"+c+"."+e,zip_add_file(i,d,write_cmnt(b,d)),a.comments.push(d),add_rels(h,-1,"../comments"+c+"."+e,RELS.CMNT),E=!0),_["!legacy"]&&E&&zip_add_file(i,"xl/drawings/vmlDrawing"+c+".vml",write_comments_vml(c,_["!comments"])),delete _["!comments"],delete _["!legacy"]}h["!id"].rId1&&zip_add_file(i,get_rels_path(o),write_rels(h))}return r.Strings!=null&&r.Strings.length>0&&(o="xl/sharedStrings."+e,zip_add_file(i,o,write_sst(r.Strings,o,r)),a.strs.push(o),add_rels(r.wbrels,-1,"sharedStrings."+e,RELS.SST)),o="xl/workbook."+e,zip_add_file(i,o,write_wb(t,o)),a.workbooks.push(o),add_rels(r.rels,1,o,RELS.WB),o="xl/theme/theme1.xml",zip_add_file(i,o,write_theme(t.Themes,r)),a.themes.push(o),add_rels(r.wbrels,-1,"theme/theme1.xml",RELS.THEME),o="xl/styles."+e,zip_add_file(i,o,write_sty(t,o,r)),a.styles.push(o),add_rels(r.wbrels,-1,"styles."+e,RELS.STY),t.vbaraw&&s&&(o="xl/vbaProject.bin",zip_add_file(i,o,t.vbaraw),a.vba.push(o),add_rels(r.wbrels,-1,"vbaProject.bin",RELS.VBA)),o="xl/metadata."+e,zip_add_file(i,o,write_xlmeta(o)),a.metadata.push(o),add_rels(r.wbrels,-1,"metadata."+e,RELS.XLMETA),zip_add_file(i,"[Content_Types].xml",write_ct(a,r)),zip_add_file(i,"_rels/.rels",write_rels(r.rels)),zip_add_file(i,"xl/_rels/workbook."+e+".rels",write_rels(r.wbrels)),delete r.revssf,delete r.ssf,i}function write_zip_xlsx(t,r){_shapeid=1024,t&&!t.SSF&&(t.SSF=dup(table_fmt)),t&&t.SSF&&(make_ssf(),SSF_load_table(t.SSF),r.revssf=evert_num(t.SSF),r.revssf[t.SSF[65535]]=0,r.ssf=t.SSF),r.rels={},r.wbrels={},r.Strings=[],r.Strings.Count=0,r.Strings.Unique=0,browser_has_Map?r.revStrings=new Map:(r.revStrings={},r.revStrings.foo=[],delete r.revStrings.foo);var e="xml",s=VBAFMTS.indexOf(r.bookType)>-1,a=new_ct();fix_write_opts(r=r||{});var i=zip_new(),o="",c=0;if(r.cellXfs=[],get_cell_style(r.cellXfs,{},{revssf:{General:0}}),t.Props||(t.Props={}),o="docProps/core.xml",zip_add_file(i,o,write_core_props(t.Props,r)),a.coreprops.push(o),add_rels(r.rels,2,o,RELS.CORE_PROPS),o="docProps/app.xml",!(t.Props&&t.Props.SheetNames))if(!t.Workbook||!t.Workbook.Sheets)t.Props.SheetNames=t.SheetNames;else{for(var x=[],u=0;u<t.SheetNames.length;++u)(t.Workbook.Sheets[u]||{}).Hidden!=2&&x.push(t.SheetNames[u]);t.Props.SheetNames=x}t.Props.Worksheets=t.Props.SheetNames.length,zip_add_file(i,o,write_ext_props(t.Props)),a.extprops.push(o),add_rels(r.rels,3,o,RELS.EXT_PROPS),t.Custprops!==t.Props&&keys(t.Custprops||{}).length>0&&(o="docProps/custom.xml",zip_add_file(i,o,write_cust_props(t.Custprops)),a.custprops.push(o),add_rels(r.rels,4,o,RELS.CUST_PROPS));var h=["SheetJ5"];for(r.tcid=0,c=1;c<=t.SheetNames.length;++c){var _={"!id":{}},v=t.Sheets[t.SheetNames[c-1]],b=(v||{})["!type"]||"sheet";switch(b){case"chart":default:o="xl/worksheets/sheet"+c+"."+e,zip_add_file(i,o,write_ws_xml(c-1,r,t,_)),a.sheets.push(o),add_rels(r.wbrels,-1,"worksheets/sheet"+c+"."+e,RELS.WS[0])}if(v){var E=v["!comments"],d=!1,g="";if(E&&E.length>0){var y=!1;E.forEach(function(R){R[1].forEach(function(P){P.T==!0&&(y=!0)})}),y&&(g="xl/threadedComments/threadedComment"+c+"."+e,zip_add_file(i,g,write_tcmnt_xml(E,h,r)),a.threadedcomments.push(g),add_rels(_,-1,"../threadedComments/threadedComment"+c+"."+e,RELS.TCMNT)),g="xl/comments"+c+"."+e,zip_add_file(i,g,write_comments_xml(E)),a.comments.push(g),add_rels(_,-1,"../comments"+c+"."+e,RELS.CMNT),d=!0}v["!legacy"]&&d&&zip_add_file(i,"xl/drawings/vmlDrawing"+c+".vml",write_comments_vml(c,v["!comments"])),delete v["!comments"],delete v["!legacy"]}_["!id"].rId1&&zip_add_file(i,get_rels_path(o),write_rels(_))}return r.Strings!=null&&r.Strings.length>0&&(o="xl/sharedStrings."+e,zip_add_file(i,o,write_sst_xml(r.Strings,r)),a.strs.push(o),add_rels(r.wbrels,-1,"sharedStrings."+e,RELS.SST)),o="xl/workbook."+e,zip_add_file(i,o,write_wb_xml(t)),a.workbooks.push(o),add_rels(r.rels,1,o,RELS.WB),o="xl/theme/theme1.xml",zip_add_file(i,o,write_theme(t.Themes,r)),a.themes.push(o),add_rels(r.wbrels,-1,"theme/theme1.xml",RELS.THEME),o="xl/styles."+e,zip_add_file(i,o,write_sty_xml(t,r)),a.styles.push(o),add_rels(r.wbrels,-1,"styles."+e,RELS.STY),t.vbaraw&&s&&(o="xl/vbaProject.bin",zip_add_file(i,o,t.vbaraw),a.vba.push(o),add_rels(r.wbrels,-1,"vbaProject.bin",RELS.VBA)),o="xl/metadata."+e,zip_add_file(i,o,write_xlmeta_xml()),a.metadata.push(o),add_rels(r.wbrels,-1,"metadata."+e,RELS.XLMETA),h.length>1&&(o="xl/persons/person.xml",zip_add_file(i,o,write_people_xml(h)),a.people.push(o),add_rels(r.wbrels,-1,"persons/person.xml",RELS.PEOPLE)),zip_add_file(i,"[Content_Types].xml",write_ct(a,r)),zip_add_file(i,"_rels/.rels",write_rels(r.rels)),zip_add_file(i,"xl/_rels/workbook."+e+".rels",write_rels(r.wbrels)),delete r.revssf,delete r.ssf,i}function firstbyte(t,r){var e="";switch((r||{}).type||"base64"){case"buffer":return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]];case"base64":e=Base64_decode(t.slice(0,12));break;case"binary":e=t;break;case"array":return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]];default:throw new Error("Unrecognized type "+(r&&r.type||"undefined"))}return[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3),e.charCodeAt(4),e.charCodeAt(5),e.charCodeAt(6),e.charCodeAt(7)]}function write_cfb_ctr(t,r){switch(r.type){case"base64":case"binary":break;case"buffer":case"array":r.type="";break;case"file":return write_dl(r.file,CFB.write(t,{type:has_buf?"buffer":""}));case"string":throw new Error("'string' output type invalid for '"+r.bookType+"' files");default:throw new Error("Unrecognized type "+r.type)}return CFB.write(t,r)}function write_zip_type(t,r){var e=dup(r||{}),s=write_zip(t,e);return write_zip_denouement(s,e)}function write_zip_denouement(t,r){var e={},s=has_buf?"nodebuffer":typeof Uint8Array<"u"?"array":"string";if(r.compression&&(e.compression="DEFLATE"),r.password)e.type=s;else switch(r.type){case"base64":e.type="base64";break;case"binary":e.type="string";break;case"string":throw new Error("'string' output type invalid for '"+r.bookType+"' files");case"buffer":case"file":e.type=s;break;default:throw new Error("Unrecognized type "+r.type)}var a=t.FullPaths?CFB.write(t,{fileType:"zip",type:{nodebuffer:"buffer",string:"binary"}[e.type]||e.type,compression:!!r.compression}):t.generate(e);if(typeof Deno<"u"&&typeof a=="string"){if(r.type=="binary"||r.type=="base64")return a;a=new Uint8Array(s2ab(a))}return r.password&&typeof encrypt_agile<"u"?write_cfb_ctr(encrypt_agile(a,r.password),r):r.type==="file"?write_dl(r.file,a):r.type=="string"?utf8read(a):a}function write_cfb_type(t,r){var e=r||{},s=write_xlscfb(t,e);return write_cfb_ctr(s,e)}function write_string_type(t,r,e){e||(e="");var s=e+t;switch(r.type){case"base64":return Base64_encode(utf8write(s));case"binary":return utf8write(s);case"string":return t;case"file":return write_dl(r.file,s,"utf8");case"buffer":return has_buf?Buffer_from(s,"utf8"):typeof TextEncoder<"u"?new TextEncoder().encode(s):write_string_type(s,{type:"binary"}).split("").map(function(a){return a.charCodeAt(0)})}throw new Error("Unrecognized type "+r.type)}function write_stxt_type(t,r){switch(r.type){case"base64":return Base64_encode(t);case"binary":return t;case"string":return t;case"file":return write_dl(r.file,t,"binary");case"buffer":return has_buf?Buffer_from(t,"binary"):t.split("").map(function(e){return e.charCodeAt(0)})}throw new Error("Unrecognized type "+r.type)}function write_binary_type(t,r){switch(r.type){case"string":case"base64":case"binary":for(var e="",s=0;s<t.length;++s)e+=String.fromCharCode(t[s]);return r.type=="base64"?Base64_encode(e):r.type=="string"?utf8read(e):e;case"file":return write_dl(r.file,t);case"buffer":return t;default:throw new Error("Unrecognized type "+r.type)}}function writeSync(t,r){reset_cp(),check_wb(t);var e=dup(r||{});if(e.cellStyles&&(e.cellNF=!0,e.sheetStubs=!0),e.type=="array"){e.type="binary";var s=writeSync(t,e);return e.type="array",s2ab(s)}var a=0;if(e.sheet&&(typeof e.sheet=="number"?a=e.sheet:a=t.SheetNames.indexOf(e.sheet),!t.SheetNames[a]))throw new Error("Sheet not found: "+e.sheet+" : "+typeof e.sheet);switch(e.bookType||"xlsb"){case"xml":case"xlml":return write_string_type(write_xlml(t,e),e);case"slk":case"sylk":return write_string_type(SYLK.from_sheet(t.Sheets[t.SheetNames[a]],e),e);case"htm":case"html":return write_string_type(sheet_to_html(t.Sheets[t.SheetNames[a]],e),e);case"txt":return write_stxt_type(sheet_to_txt(t.Sheets[t.SheetNames[a]],e),e);case"csv":return write_string_type(sheet_to_csv(t.Sheets[t.SheetNames[a]],e),e,"\uFEFF");case"dif":return write_string_type(DIF.from_sheet(t.Sheets[t.SheetNames[a]],e),e);case"dbf":return write_binary_type(DBF.from_sheet(t.Sheets[t.SheetNames[a]],e),e);case"prn":return write_string_type(PRN.from_sheet(t.Sheets[t.SheetNames[a]],e),e);case"rtf":return write_string_type(RTF.from_sheet(t.Sheets[t.SheetNames[a]],e),e);case"eth":return write_string_type(ETH.from_sheet(t.Sheets[t.SheetNames[a]],e),e);case"fods":return write_string_type(write_ods(t,e),e);case"wk1":return write_binary_type(WK_.sheet_to_wk1(t.Sheets[t.SheetNames[a]],e),e);case"wk3":return write_binary_type(WK_.book_to_wk3(t,e),e);case"biff2":e.biff||(e.biff=2);case"biff3":e.biff||(e.biff=3);case"biff4":return e.biff||(e.biff=4),write_binary_type(write_biff_buf(t,e),e);case"biff5":e.biff||(e.biff=5);case"biff8":case"xla":case"xls":return e.biff||(e.biff=8),write_cfb_type(t,e);case"xlsx":case"xlsm":case"xlam":case"xlsb":case"numbers":case"ods":return write_zip_type(t,e);default:throw new Error("Unrecognized bookType |"+e.bookType+"|")}}function make_json_row(t,r,e,s,a,i,o,c){var x=encode_row(e),u=c.defval,h=c.raw||!Object.prototype.hasOwnProperty.call(c,"raw"),_=!0,v=a===1?[]:{};if(a!==1)if(Object.defineProperty)try{Object.defineProperty(v,"__rowNum__",{value:e,enumerable:!1})}catch{v.__rowNum__=e}else v.__rowNum__=e;if(!o||t[e])for(var b=r.s.c;b<=r.e.c;++b){var E=o?t[e][b]:t[s[b]+x];if(E===void 0||E.t===void 0){if(u===void 0)continue;i[b]!=null&&(v[i[b]]=u);continue}var d=E.v;switch(E.t){case"z":if(d==null)break;continue;case"e":d=d==0?null:void 0;break;case"s":case"d":case"b":case"n":break;default:throw new Error("unrecognized type "+E.t)}if(i[b]!=null){if(d==null)if(E.t=="e"&&d===null)v[i[b]]=null;else if(u!==void 0)v[i[b]]=u;else if(h&&d===null)v[i[b]]=null;else continue;else v[i[b]]=h&&(E.t!=="n"||E.t==="n"&&c.rawNumbers!==!1)?d:format_cell(E,d,c);d!=null&&(_=!1)}}return{row:v,isempty:_}}function sheet_to_json(t,r){if(t==null||t["!ref"]==null)return[];var e={t:"n",v:0},s=0,a=1,i=[],o=0,c="",x={s:{r:0,c:0},e:{r:0,c:0}},u=r||{},h=u.range!=null?u.range:t["!ref"];switch(u.header===1?s=1:u.header==="A"?s=2:Array.isArray(u.header)?s=3:u.header==null&&(s=0),typeof h){case"string":x=safe_decode_range(h);break;case"number":x=safe_decode_range(t["!ref"]),x.s.r=h;break;default:x=h}s>0&&(a=0);var _=encode_row(x.s.r),v=[],b=[],E=0,d=0,g=Array.isArray(t),y=x.s.r,R=0,P={};g&&!t[y]&&(t[y]=[]);var F=u.skipHidden&&t["!cols"]||[],S=u.skipHidden&&t["!rows"]||[];for(R=x.s.c;R<=x.e.c;++R)if(!(F[R]||{}).hidden)switch(v[R]=encode_col(R),e=g?t[y][R]:t[v[R]+_],s){case 1:i[R]=R-x.s.c;break;case 2:i[R]=v[R];break;case 3:i[R]=u.header[R-x.s.c];break;default:if(e==null&&(e={w:"__EMPTY",t:"s"}),c=o=format_cell(e,null,u),d=P[o]||0,!d)P[o]=1;else{do c=o+"_"+d++;while(P[c]);P[o]=d,P[c]=1}i[R]=c}for(y=x.s.r+a;y<=x.e.r;++y)if(!(S[y]||{}).hidden){var I=make_json_row(t,x,y,v,s,i,g,u);(I.isempty===!1||(s===1?u.blankrows!==!1:u.blankrows))&&(b[E++]=I.row)}return b.length=E,b}var qreg=/"/g;function make_csv_row(t,r,e,s,a,i,o,c){for(var x=!0,u=[],h="",_=encode_row(e),v=r.s.c;v<=r.e.c;++v)if(s[v]){var b=c.dense?(t[e]||[])[v]:t[s[v]+_];if(b==null)h="";else if(b.v!=null){x=!1,h=""+(c.rawNumbers&&b.t=="n"?b.v:format_cell(b,null,c));for(var E=0,d=0;E!==h.length;++E)if((d=h.charCodeAt(E))===a||d===i||d===34||c.forceQuotes){h='"'+h.replace(qreg,'""')+'"';break}h=="ID"&&(h='"ID"')}else b.f!=null&&!b.F?(x=!1,h="="+b.f,h.indexOf(",")>=0&&(h='"'+h.replace(qreg,'""')+'"')):h="";u.push(h)}return c.blankrows===!1&&x?null:u.join(o)}function sheet_to_csv(t,r){var e=[],s=r??{};if(t==null||t["!ref"]==null)return"";var a=safe_decode_range(t["!ref"]),i=s.FS!==void 0?s.FS:",",o=i.charCodeAt(0),c=s.RS!==void 0?s.RS:`
`,x=c.charCodeAt(0),u=new RegExp((i=="|"?"\\|":i)+"+$"),h="",_=[];s.dense=Array.isArray(t);for(var v=s.skipHidden&&t["!cols"]||[],b=s.skipHidden&&t["!rows"]||[],E=a.s.c;E<=a.e.c;++E)(v[E]||{}).hidden||(_[E]=encode_col(E));for(var d=0,g=a.s.r;g<=a.e.r;++g)(b[g]||{}).hidden||(h=make_csv_row(t,a,g,_,o,x,i,s),h!=null&&(s.strip&&(h=h.replace(u,"")),(h||s.blankrows!==!1)&&e.push((d++?c:"")+h)));return delete s.dense,e.join("")}function sheet_to_txt(t,r){r||(r={}),r.FS="	",r.RS=`
`;var e=sheet_to_csv(t,r);return e}function sheet_to_formulae(t){var r="",e,s="";if(t==null||t["!ref"]==null)return[];var a=safe_decode_range(t["!ref"]),i="",o=[],c,x=[],u=Array.isArray(t);for(c=a.s.c;c<=a.e.c;++c)o[c]=encode_col(c);for(var h=a.s.r;h<=a.e.r;++h)for(i=encode_row(h),c=a.s.c;c<=a.e.c;++c)if(r=o[c]+i,e=u?(t[h]||[])[c]:t[r],s="",e!==void 0){if(e.F!=null){if(r=e.F,!e.f)continue;s=e.f,r.indexOf(":")==-1&&(r=r+":"+r)}if(e.f!=null)s=e.f;else{if(e.t=="z")continue;if(e.t=="n"&&e.v!=null)s=""+e.v;else if(e.t=="b")s=e.v?"TRUE":"FALSE";else if(e.w!==void 0)s="'"+e.w;else{if(e.v===void 0)continue;e.t=="s"?s="'"+e.v:s=""+e.v}}x[x.length]=r+"="+s}return x}function sheet_add_json(t,r,e){var s=e||{},a=+!s.skipHeader,i=t||{},o=0,c=0;if(i&&s.origin!=null)if(typeof s.origin=="number")o=s.origin;else{var x=typeof s.origin=="string"?decode_cell(s.origin):s.origin;o=x.r,c=x.c}var u,h={s:{c:0,r:0},e:{c,r:o+r.length-1+a}};if(i["!ref"]){var _=safe_decode_range(i["!ref"]);h.e.c=Math.max(h.e.c,_.e.c),h.e.r=Math.max(h.e.r,_.e.r),o==-1&&(o=_.e.r+1,h.e.r=o+r.length-1+a)}else o==-1&&(o=0,h.e.r=r.length-1+a);var v=s.header||[],b=0;r.forEach(function(d,g){keys(d).forEach(function(y){(b=v.indexOf(y))==-1&&(v[b=v.length]=y);var R=d[y],P="z",F="",S=encode_cell({c:c+b,r:o+g+a});u=ws_get_cell_stub(i,S),R&&typeof R=="object"&&!(R instanceof Date)?i[S]=R:(typeof R=="number"?P="n":typeof R=="boolean"?P="b":typeof R=="string"?P="s":R instanceof Date?(P="d",s.cellDates||(P="n",R=datenum(R)),F=s.dateNF||table_fmt[14]):R===null&&s.nullError&&(P="e",R=0),u?(u.t=P,u.v=R,delete u.w,delete u.R,F&&(u.z=F)):i[S]=u={t:P,v:R},F&&(u.z=F))})}),h.e.c=Math.max(h.e.c,c+v.length-1);var E=encode_row(o);if(a)for(b=0;b<v.length;++b)i[encode_col(b+c)+E]={t:"s",v:v[b]};return i["!ref"]=encode_range(h),i}function json_to_sheet(t,r){return sheet_add_json(null,t,r)}function ws_get_cell_stub(t,r,e){if(typeof r=="string"){if(Array.isArray(t)){var s=decode_cell(r);return t[s.r]||(t[s.r]=[]),t[s.r][s.c]||(t[s.r][s.c]={t:"z"})}return t[r]||(t[r]={t:"z"})}return typeof r!="number"?ws_get_cell_stub(t,encode_cell(r)):ws_get_cell_stub(t,encode_cell({r,c:e||0}))}function wb_sheet_idx(t,r){if(typeof r=="number"){if(r>=0&&t.SheetNames.length>r)return r;throw new Error("Cannot find sheet # "+r)}else if(typeof r=="string"){var e=t.SheetNames.indexOf(r);if(e>-1)return e;throw new Error("Cannot find sheet name |"+r+"|")}else throw new Error("Cannot find sheet |"+r+"|")}function book_new(){return{SheetNames:[],Sheets:{}}}function book_append_sheet(t,r,e,s){var a=1;if(!e)for(;a<=65535&&t.SheetNames.indexOf(e="Sheet"+a)!=-1;++a,e=void 0);if(!e||t.SheetNames.length>=65535)throw new Error("Too many worksheets");if(s&&t.SheetNames.indexOf(e)>=0){var i=e.match(/(^.*?)(\d+)$/);a=i&&+i[2]||0;var o=i&&i[1]||e;for(++a;a<=65535&&t.SheetNames.indexOf(e=o+a)!=-1;++a);}if(check_ws_name(e),t.SheetNames.indexOf(e)>=0)throw new Error("Worksheet with name |"+e+"| already exists!");return t.SheetNames.push(e),t.Sheets[e]=r,e}function book_set_sheet_visibility(t,r,e){t.Workbook||(t.Workbook={}),t.Workbook.Sheets||(t.Workbook.Sheets=[]);var s=wb_sheet_idx(t,r);switch(t.Workbook.Sheets[s]||(t.Workbook.Sheets[s]={}),e){case 0:case 1:case 2:break;default:throw new Error("Bad sheet visibility setting "+e)}t.Workbook.Sheets[s].Hidden=e}function cell_set_number_format(t,r){return t.z=r,t}function cell_set_hyperlink(t,r,e){return r?(t.l={Target:r},e&&(t.l.Tooltip=e)):delete t.l,t}function cell_set_internal_link(t,r,e){return cell_set_hyperlink(t,"#"+r,e)}function cell_add_comment(t,r,e){t.c||(t.c=[]),t.c.push({t:r,a:e||"SheetJS"})}function sheet_set_array_formula(t,r,e,s){for(var a=typeof r!="string"?r:safe_decode_range(r),i=typeof r=="string"?r:encode_range(r),o=a.s.r;o<=a.e.r;++o)for(var c=a.s.c;c<=a.e.c;++c){var x=ws_get_cell_stub(t,o,c);x.t="n",x.F=i,delete x.v,o==a.s.r&&c==a.s.c&&(x.f=e,s&&(x.D=!0))}return t}var utils={encode_col,encode_row,encode_cell,encode_range,decode_col,decode_row,split_cell,decode_cell,decode_range,format_cell,sheet_add_aoa,sheet_add_json,sheet_add_dom,aoa_to_sheet,json_to_sheet,table_to_sheet:parse_dom_table,table_to_book,sheet_to_csv,sheet_to_txt,sheet_to_json,sheet_to_html,sheet_to_formulae,sheet_to_row_object_array:sheet_to_json,sheet_get_cell:ws_get_cell_stub,book_new,book_append_sheet,book_set_sheet_visibility,cell_set_number_format,cell_set_hyperlink,cell_set_internal_link,cell_add_comment,sheet_set_array_formula,consts:{SHEET_VISIBLE:0,SHEET_HIDDEN:1,SHEET_VERY_HIDDEN:2}},pdf={exports:{}};const __viteBrowserExternal={},__viteBrowserExternal$1=Object.freeze(Object.defineProperty({__proto__:null,default:__viteBrowserExternal},Symbol.toStringTag,{value:"Module"})),require$$6=getAugmentedNamespace(__viteBrowserExternal$1);var path2dPolyfill_esm={},hasRequiredPath2dPolyfill_esm;function requirePath2dPolyfill_esm(){if(hasRequiredPath2dPolyfill_esm)return path2dPolyfill_esm;hasRequiredPath2dPolyfill_esm=1;function t(E,d,g){for(var y=0,R=d.length,P;y<R;y++)(P||!(y in d))&&(P||(P=Array.prototype.slice.call(d,0,y)),P[y]=d[y]);return E.concat(P||Array.prototype.slice.call(d))}var r={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},e=/([astvzqmhlc])([^astvzqmhlc]*)/gi,s=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/gi;function a(E){var d=E.match(s);return d?d.map(Number):[]}function i(E){var d=[],g=String(E).trim();return g[0]!=="M"&&g[0]!=="m"||g.replace(e,function(y,R,P){var F=a(P),S=R.toLowerCase(),I=R;if(S==="m"&&F.length>2&&(d.push(t([I],F.splice(0,2))),S="l",I=I==="m"?"l":"L"),F.length<r[S])return"";for(d.push(t([I],F.splice(0,r[S])));F.length>=r[S]&&F.length&&r[S];)d.push(t([I],F.splice(0,r[S])));return""}),d}function o(E,d){var g=E.x*Math.cos(d)-E.y*Math.sin(d),y=E.y*Math.cos(d)+E.x*Math.sin(d);E.x=g,E.y=y}function c(E,d,g){E.x+=d,E.y+=g}function x(E,d){E.x*=d,E.y*=d}var u=function(){function E(d){var g;this.commands=[],d&&d instanceof E?(g=this.commands).push.apply(g,d.commands):d&&(this.commands=i(d))}return E.prototype.addPath=function(d){var g;d&&d instanceof E&&(g=this.commands).push.apply(g,d.commands)},E.prototype.moveTo=function(d,g){this.commands.push(["M",d,g])},E.prototype.lineTo=function(d,g){this.commands.push(["L",d,g])},E.prototype.arc=function(d,g,y,R,P,F){this.commands.push(["AC",d,g,y,R,P,!!F])},E.prototype.arcTo=function(d,g,y,R,P){this.commands.push(["AT",d,g,y,R,P])},E.prototype.ellipse=function(d,g,y,R,P,F,S,I){this.commands.push(["E",d,g,y,R,P,F,S,!!I])},E.prototype.closePath=function(){this.commands.push(["Z"])},E.prototype.bezierCurveTo=function(d,g,y,R,P,F){this.commands.push(["C",d,g,y,R,P,F])},E.prototype.quadraticCurveTo=function(d,g,y,R){this.commands.push(["Q",d,g,y,R])},E.prototype.rect=function(d,g,y,R){this.commands.push(["R",d,g,y,R])},E.prototype.roundRect=function(d,g,y,R,P){typeof P>"u"?this.commands.push(["RR",d,g,y,R,0]):this.commands.push(["RR",d,g,y,R,P])},E}();function h(E,d){var g=0,y=0,R,P,F,S,I,w,j,C,V,O,H,z,pe,ee,he,re,me,te,ce,ye,L,N=null,T=null,A=null,D=null,B=null,U=null;E.beginPath();for(var Y=0;Y<d.length;++Y){te=d[Y][0],te!=="S"&&te!=="s"&&te!=="C"&&te!=="c"&&(N=null,T=null),te!=="T"&&te!=="t"&&te!=="Q"&&te!=="q"&&(A=null,D=null);var G=void 0;switch(te){case"m":case"M":G=d[Y],te==="m"?(g+=G[1],y+=G[2]):(g=G[1],y=G[2]),(te==="M"||!B)&&(B={x:g,y}),E.moveTo(g,y);break;case"l":G=d[Y],g+=G[1],y+=G[2],E.lineTo(g,y);break;case"L":G=d[Y],g=G[1],y=G[2],E.lineTo(g,y);break;case"H":G=d[Y],g=G[1],E.lineTo(g,y);break;case"h":G=d[Y],g+=G[1],E.lineTo(g,y);break;case"V":G=d[Y],y=G[1],E.lineTo(g,y);break;case"v":G=d[Y],y+=G[1],E.lineTo(g,y);break;case"a":case"A":if(G=d[Y],U===null)throw new Error("This should never happen");te==="a"?(g+=G[6],y+=G[7]):(g=G[6],y=G[7]),ee=G[1],he=G[2],j=G[3]*Math.PI/180,F=!!G[4],S=!!G[5],I={x:g,y},w={x:(U.x-I.x)/2,y:(U.y-I.y)/2},o(w,-j),C=w.x*w.x/(ee*ee)+w.y*w.y/(he*he),C>1&&(C=Math.sqrt(C),ee*=C,he*=C),ce={x:ee*w.y/he,y:-(he*w.x)/ee},V=ee*ee*he*he,O=ee*ee*w.y*w.y+he*he*w.x*w.x,S!==F?x(ce,Math.sqrt((V-O)/O)||0):x(ce,-Math.sqrt((V-O)/O)||0),P=Math.atan2((w.y-ce.y)/he,(w.x-ce.x)/ee),R=Math.atan2(-(w.y+ce.y)/he,-(w.x+ce.x)/ee),o(ce,j),c(ce,(I.x+U.x)/2,(I.y+U.y)/2),E.save(),E.translate(ce.x,ce.y),E.rotate(j),E.scale(ee,he),E.arc(0,0,1,P,R,!S),E.restore();break;case"C":G=d[Y],N=G[3],T=G[4],g=G[5],y=G[6],E.bezierCurveTo(G[1],G[2],N,T,g,y);break;case"c":G=d[Y],E.bezierCurveTo(G[1]+g,G[2]+y,G[3]+g,G[4]+y,G[5]+g,G[6]+y),N=G[3]+g,T=G[4]+y,g+=G[5],y+=G[6];break;case"S":G=d[Y],(N===null||T===null)&&(N=g,T=y),E.bezierCurveTo(2*g-N,2*y-T,G[1],G[2],G[3],G[4]),N=G[1],T=G[2],g=G[3],y=G[4];break;case"s":G=d[Y],(N===null||T===null)&&(N=g,T=y),E.bezierCurveTo(2*g-N,2*y-T,G[1]+g,G[2]+y,G[3]+g,G[4]+y),N=G[1]+g,T=G[2]+y,g+=G[3],y+=G[4];break;case"Q":G=d[Y],A=G[1],D=G[2],g=G[3],y=G[4],E.quadraticCurveTo(A,D,g,y);break;case"q":G=d[Y],A=G[1]+g,D=G[2]+y,g+=G[3],y+=G[4],E.quadraticCurveTo(A,D,g,y);break;case"T":G=d[Y],(A===null||D===null)&&(A=g,D=y),A=2*g-A,D=2*y-D,g=G[1],y=G[2],E.quadraticCurveTo(A,D,g,y);break;case"t":G=d[Y],(A===null||D===null)&&(A=g,D=y),A=2*g-A,D=2*y-D,g+=G[1],y+=G[2],E.quadraticCurveTo(A,D,g,y);break;case"z":case"Z":B&&(g=B.x,y=B.y),B=null,E.closePath();break;case"AC":G=d[Y],g=G[1],y=G[2],pe=G[3],P=G[4],R=G[5],ye=G[6],E.arc(g,y,pe,P,R,ye);break;case"AT":G=d[Y],H=G[1],z=G[2],g=G[3],y=G[4],pe=G[5],E.arcTo(H,z,g,y,pe);break;case"E":G=d[Y],g=G[1],y=G[2],ee=G[3],he=G[4],j=G[5],P=G[6],R=G[7],ye=G[8],E.save(),E.translate(g,y),E.rotate(j),E.scale(ee,he),E.arc(0,0,1,P,R,ye),E.restore();break;case"R":G=d[Y],g=G[1],y=G[2],re=G[3],me=G[4],B={x:g,y},E.rect(g,y,re,me);break;case"RR":G=d[Y],g=G[1],y=G[2],re=G[3],me=G[4],L=G[5],B={x:g,y},E.roundRect(g,y,re,me,L);break}U?(U.x=g,U.y=y):U={x:g,y}}}function _(E){if(!(!E||!E.CanvasRenderingContext2D||E.Path2D)){var d=E.CanvasRenderingContext2D,g=d.prototype.fill,y=d.prototype.stroke,R=d.prototype.isPointInPath;d.prototype.fill=function(){for(var F=[],S=0;S<arguments.length;S++)F[S]=arguments[S];if(F[0]instanceof u){var I=F[0],w=F[1]||"nonzero";h(this,I.commands),g.apply(this,[w])}else{var w=F[0]||"nonzero";return g.apply(this,[w])}},d.prototype.stroke=function(F){F&&h(this,F.commands),y.apply(this)},d.prototype.isPointInPath=function(){for(var F=[],S=0;S<arguments.length;S++)F[S]=arguments[S];if(F[0]instanceof u){var I=F[0],w=F[1],j=F[2],C=F[3]||"nonzero";return h(this,I.commands),R.apply(this,[w,j,C])}else return R.apply(this,F)},E.Path2D=u}}function v(E,d,g,y,R){var P=this;if(R===void 0&&(R=0),typeof R=="number"&&(R=[R]),Array.isArray(R)){if(R.length===0||R.length>4)throw new RangeError("Failed to execute 'roundRect' on '".concat(this.constructor.name,"': ").concat(R.length," radii provided. Between one and four radii are necessary."));R.forEach(function(C){if(C<0)throw new RangeError("Failed to execute 'roundRect' on '".concat(P.constructor.name,"': Radius value ").concat(C," is negative."))})}else return;if(R.length===1&&R[0]===0)return this.rect(E,d,g,y);var F=Math.min(g,y)/2,S,I,w,j=S=I=w=Math.min(F,R[0]);R.length===2&&(S=w=Math.min(F,R[1])),R.length===3&&(S=w=Math.min(F,R[1]),I=Math.min(F,R[2])),R.length===4&&(S=Math.min(F,R[1]),I=Math.min(F,R[2]),w=Math.min(F,R[3])),this.moveTo(E,d+y-w),this.arcTo(E,d,E+j,d,j),this.arcTo(E+g,d,E+g,d+S,S),this.arcTo(E+g,d+y,E+g-I,d+y,I),this.arcTo(E,d+y,E,d+y-w,w),this.moveTo(E,d)}function b(E){if(!(!E||!E.CanvasRenderingContext2D)){var d=E.CanvasRenderingContext2D,g=E.Path2D;d&&!d.prototype.roundRect&&(d.prototype.roundRect=v),g&&!g.prototype.roundRect&&(g.prototype.roundRect=v)}}return _(window),b(window),path2dPolyfill_esm}(function(module,exports){(function(r,e){module.exports=r.pdfjsLib=e()})(globalThis,()=>(()=>{var __webpack_modules__=[,(t,r,e)=>{var pt;Object.defineProperty(r,"__esModule",{value:!0}),r.VerbosityLevel=r.Util=r.UnknownErrorException=r.UnexpectedResponseException=r.TextRenderingMode=r.RenderingIntentFlag=r.PromiseCapability=r.PermissionFlag=r.PasswordResponses=r.PasswordException=r.PageActionEventType=r.OPS=r.MissingPDFException=r.MAX_IMAGE_SIZE_TO_CACHE=r.LINE_FACTOR=r.LINE_DESCENT_FACTOR=r.InvalidPDFException=r.ImageKind=r.IDENTITY_MATRIX=r.FormatError=r.FeatureTest=r.FONT_IDENTITY_MATRIX=r.DocumentActionEventType=r.CMapCompressionType=r.BaseException=r.BASELINE_FACTOR=r.AnnotationType=r.AnnotationReplyType=r.AnnotationPrefix=r.AnnotationMode=r.AnnotationFlag=r.AnnotationFieldFlag=r.AnnotationEditorType=r.AnnotationEditorPrefix=r.AnnotationEditorParamsType=r.AnnotationBorderStyleType=r.AnnotationActionEventType=r.AbortException=void 0,r.assert=ce,r.bytesToString=xe,r.createValidAbsoluteUrl=L,r.getModificationDate=tt,r.getUuid=ht,r.getVerbosityLevel=he,r.info=re,r.isArrayBuffer=ze,r.isArrayEqual=Xe,r.isNodeJS=void 0,r.normalizeUnicode=nt,r.objectFromMap=be,r.objectSize=Me,r.setVerbosityLevel=ee,r.shadow=N,r.string32=Ce,r.stringToBytes=Se,r.stringToPDFString=Le,r.stringToUTF8String=Re,r.unreachable=te,r.utf8StringToString=Ee,r.warn=me,e(2),e(84),e(86),e(87),e(89),e(93),e(101),e(102),e(105),e(107),e(109),e(113),e(116),e(123);const s=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser");r.isNodeJS=s;const a=[1,0,0,1,0,0];r.IDENTITY_MATRIX=a;const i=[.001,0,0,.001,0,0];r.FONT_IDENTITY_MATRIX=i;const o=1e7;r.MAX_IMAGE_SIZE_TO_CACHE=o;const c=1.35;r.LINE_FACTOR=c;const x=.35;r.LINE_DESCENT_FACTOR=x;const u=x/c;r.BASELINE_FACTOR=u;const h={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,OPLIST:256};r.RenderingIntentFlag=h;const _={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3};r.AnnotationMode=_;const v="pdfjs_internal_editor_";r.AnnotationEditorPrefix=v;const b={DISABLE:-1,NONE:0,FREETEXT:3,STAMP:13,INK:15};r.AnnotationEditorType=b;const E={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23};r.AnnotationEditorParamsType=E;const d={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048};r.PermissionFlag=d;const g={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4};r.TextRenderingMode=g;const y={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3};r.ImageKind=y;const R={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};r.AnnotationType=R;const P={GROUP:"Group",REPLY:"R"};r.AnnotationReplyType=P;const F={INVISIBLE:1,HIDDEN:2,PRINT:4,NOZOOM:8,NOROTATE:16,NOVIEW:32,READONLY:64,LOCKED:128,TOGGLENOVIEW:256,LOCKEDCONTENTS:512};r.AnnotationFlag=F;const S={READONLY:1,REQUIRED:2,NOEXPORT:4,MULTILINE:4096,PASSWORD:8192,NOTOGGLETOOFF:16384,RADIO:32768,PUSHBUTTON:65536,COMBO:131072,EDIT:262144,SORT:524288,FILESELECT:1048576,MULTISELECT:2097152,DONOTSPELLCHECK:4194304,DONOTSCROLL:8388608,COMB:16777216,RICHTEXT:33554432,RADIOSINUNISON:33554432,COMMITONSELCHANGE:67108864};r.AnnotationFieldFlag=S;const I={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};r.AnnotationBorderStyleType=I;const w={E:"Mouse Enter",X:"Mouse Exit",D:"Mouse Down",U:"Mouse Up",Fo:"Focus",Bl:"Blur",PO:"PageOpen",PC:"PageClose",PV:"PageVisible",PI:"PageInvisible",K:"Keystroke",F:"Format",V:"Validate",C:"Calculate"};r.AnnotationActionEventType=w;const j={WC:"WillClose",WS:"WillSave",DS:"DidSave",WP:"WillPrint",DP:"DidPrint"};r.DocumentActionEventType=j;const C={O:"PageOpen",C:"PageClose"};r.PageActionEventType=C;const V={ERRORS:0,WARNINGS:1,INFOS:5};r.VerbosityLevel=V;const O={NONE:0,BINARY:1};r.CMapCompressionType=O;const H={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91};r.OPS=H;const z={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};r.PasswordResponses=z;let pe=V.WARNINGS;function ee(Ge){Number.isInteger(Ge)&&(pe=Ge)}function he(){return pe}function re(Ge){pe>=V.INFOS&&console.log(`Info: ${Ge}`)}function me(Ge){pe>=V.WARNINGS&&console.log(`Warning: ${Ge}`)}function te(Ge){throw new Error(Ge)}function ce(Ge,Ne){Ge||te(Ne)}function ye(Ge){switch(Ge==null?void 0:Ge.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function L(Ge){let Ne=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,je=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;if(!Ge)return null;try{if(je&&typeof Ge=="string"){if(je.addDefaultProtocol&&Ge.startsWith("www.")){const ct=Ge.match(/\./g);(ct==null?void 0:ct.length)>=2&&(Ge=`http://${Ge}`)}if(je.tryConvertEncoding)try{Ge=Re(Ge)}catch{}}const st=Ne?new URL(Ge,Ne):new URL(Ge);if(ye(st))return st}catch{}return null}function N(Ge,Ne,je){let st=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return Object.defineProperty(Ge,Ne,{value:je,enumerable:!st,configurable:!0,writable:!1}),je}const T=function(){function Ne(je,st){this.constructor===Ne&&te("Cannot initialize BaseException."),this.message=je,this.name=st}return Ne.prototype=new Error,Ne.constructor=Ne,Ne}();r.BaseException=T;class A extends T{constructor(Ne,je){super(Ne,"PasswordException"),this.code=je}}r.PasswordException=A;class D extends T{constructor(Ne,je){super(Ne,"UnknownErrorException"),this.details=je}}r.UnknownErrorException=D;class B extends T{constructor(Ne){super(Ne,"InvalidPDFException")}}r.InvalidPDFException=B;class U extends T{constructor(Ne){super(Ne,"MissingPDFException")}}r.MissingPDFException=U;class Y extends T{constructor(Ne,je){super(Ne,"UnexpectedResponseException"),this.status=je}}r.UnexpectedResponseException=Y;class G extends T{constructor(Ne){super(Ne,"FormatError")}}r.FormatError=G;class fe extends T{constructor(Ne){super(Ne,"AbortException")}}r.AbortException=fe;function xe(Ge){(typeof Ge!="object"||(Ge==null?void 0:Ge.length)===void 0)&&te("Invalid argument for bytesToString");const Ne=Ge.length,je=8192;if(Ne<je)return String.fromCharCode.apply(null,Ge);const st=[];for(let ct=0;ct<Ne;ct+=je){const K=Math.min(ct+je,Ne),_e=Ge.subarray(ct,K);st.push(String.fromCharCode.apply(null,_e))}return st.join("")}function Se(Ge){typeof Ge!="string"&&te("Invalid argument for stringToBytes");const Ne=Ge.length,je=new Uint8Array(Ne);for(let st=0;st<Ne;++st)je[st]=Ge.charCodeAt(st)&255;return je}function Ce(Ge){return String.fromCharCode(Ge>>24&255,Ge>>16&255,Ge>>8&255,Ge&255)}function Me(Ge){return Object.keys(Ge).length}function be(Ge){const Ne=Object.create(null);for(const[je,st]of Ge)Ne[je]=st;return Ne}function ae(){const Ge=new Uint8Array(4);return Ge[0]=1,new Uint32Array(Ge.buffer,0,1)[0]===1}function J(){try{return new Function(""),!0}catch{return!1}}class oe{static get isLittleEndian(){return N(this,"isLittleEndian",ae())}static get isEvalSupported(){return N(this,"isEvalSupported",J())}static get isOffscreenCanvasSupported(){return N(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get platform(){return typeof navigator>"u"?N(this,"platform",{isWin:!1,isMac:!1}):N(this,"platform",{isWin:navigator.platform.includes("Win"),isMac:navigator.platform.includes("Mac")})}static get isCSSRoundSupported(){var Ne,je;return N(this,"isCSSRoundSupported",(je=(Ne=globalThis.CSS)==null?void 0:Ne.supports)==null?void 0:je.call(Ne,"width: round(1.5px, 1px)"))}}r.FeatureTest=oe;const Q=[...Array(256).keys()].map(Ge=>Ge.toString(16).padStart(2,"0"));class ge{static makeHexColor(Ne,je,st){return`#${Q[Ne]}${Q[je]}${Q[st]}`}static scaleMinMax(Ne,je){let st;Ne[0]?(Ne[0]<0&&(st=je[0],je[0]=je[1],je[1]=st),je[0]*=Ne[0],je[1]*=Ne[0],Ne[3]<0&&(st=je[2],je[2]=je[3],je[3]=st),je[2]*=Ne[3],je[3]*=Ne[3]):(st=je[0],je[0]=je[2],je[2]=st,st=je[1],je[1]=je[3],je[3]=st,Ne[1]<0&&(st=je[2],je[2]=je[3],je[3]=st),je[2]*=Ne[1],je[3]*=Ne[1],Ne[2]<0&&(st=je[0],je[0]=je[1],je[1]=st),je[0]*=Ne[2],je[1]*=Ne[2]),je[0]+=Ne[4],je[1]+=Ne[4],je[2]+=Ne[5],je[3]+=Ne[5]}static transform(Ne,je){return[Ne[0]*je[0]+Ne[2]*je[1],Ne[1]*je[0]+Ne[3]*je[1],Ne[0]*je[2]+Ne[2]*je[3],Ne[1]*je[2]+Ne[3]*je[3],Ne[0]*je[4]+Ne[2]*je[5]+Ne[4],Ne[1]*je[4]+Ne[3]*je[5]+Ne[5]]}static applyTransform(Ne,je){const st=Ne[0]*je[0]+Ne[1]*je[2]+je[4],ct=Ne[0]*je[1]+Ne[1]*je[3]+je[5];return[st,ct]}static applyInverseTransform(Ne,je){const st=je[0]*je[3]-je[1]*je[2],ct=(Ne[0]*je[3]-Ne[1]*je[2]+je[2]*je[5]-je[4]*je[3])/st,K=(-Ne[0]*je[1]+Ne[1]*je[0]+je[4]*je[1]-je[5]*je[0])/st;return[ct,K]}static getAxialAlignedBoundingBox(Ne,je){const st=this.applyTransform(Ne,je),ct=this.applyTransform(Ne.slice(2,4),je),K=this.applyTransform([Ne[0],Ne[3]],je),_e=this.applyTransform([Ne[2],Ne[1]],je);return[Math.min(st[0],ct[0],K[0],_e[0]),Math.min(st[1],ct[1],K[1],_e[1]),Math.max(st[0],ct[0],K[0],_e[0]),Math.max(st[1],ct[1],K[1],_e[1])]}static inverseTransform(Ne){const je=Ne[0]*Ne[3]-Ne[1]*Ne[2];return[Ne[3]/je,-Ne[1]/je,-Ne[2]/je,Ne[0]/je,(Ne[2]*Ne[5]-Ne[4]*Ne[3])/je,(Ne[4]*Ne[1]-Ne[5]*Ne[0])/je]}static singularValueDecompose2dScale(Ne){const je=[Ne[0],Ne[2],Ne[1],Ne[3]],st=Ne[0]*je[0]+Ne[1]*je[2],ct=Ne[0]*je[1]+Ne[1]*je[3],K=Ne[2]*je[0]+Ne[3]*je[2],_e=Ne[2]*je[1]+Ne[3]*je[3],We=(st+_e)/2,Ke=Math.sqrt((st+_e)**2-4*(st*_e-K*ct))/2,Ye=We+Ke||1,$e=We-Ke||1;return[Math.sqrt(Ye),Math.sqrt($e)]}static normalizeRect(Ne){const je=Ne.slice(0);return Ne[0]>Ne[2]&&(je[0]=Ne[2],je[2]=Ne[0]),Ne[1]>Ne[3]&&(je[1]=Ne[3],je[3]=Ne[1]),je}static intersect(Ne,je){const st=Math.max(Math.min(Ne[0],Ne[2]),Math.min(je[0],je[2])),ct=Math.min(Math.max(Ne[0],Ne[2]),Math.max(je[0],je[2]));if(st>ct)return null;const K=Math.max(Math.min(Ne[1],Ne[3]),Math.min(je[1],je[3])),_e=Math.min(Math.max(Ne[1],Ne[3]),Math.max(je[1],je[3]));return K>_e?null:[st,K,ct,_e]}static bezierBoundingBox(Ne,je,st,ct,K,_e,We,Ke){const Ye=[],$e=[[],[]];let ne,se,ve,we,Fe,He,Ue,at;for(let Z=0;Z<2;++Z){if(Z===0?(se=6*Ne-12*st+6*K,ne=-3*Ne+9*st-9*K+3*We,ve=3*st-3*Ne):(se=6*je-12*ct+6*_e,ne=-3*je+9*ct-9*_e+3*Ke,ve=3*ct-3*je),Math.abs(ne)<1e-12){if(Math.abs(se)<1e-12)continue;we=-ve/se,0<we&&we<1&&Ye.push(we);continue}Ue=se*se-4*ve*ne,at=Math.sqrt(Ue),!(Ue<0)&&(Fe=(-se+at)/(2*ne),0<Fe&&Fe<1&&Ye.push(Fe),He=(-se-at)/(2*ne),0<He&&He<1&&Ye.push(He))}let it=Ye.length,W;const le=it;for(;it--;)we=Ye[it],W=1-we,$e[0][it]=W*W*W*Ne+3*W*W*we*st+3*W*we*we*K+we*we*we*We,$e[1][it]=W*W*W*je+3*W*W*we*ct+3*W*we*we*_e+we*we*we*Ke;return $e[0][le]=Ne,$e[1][le]=je,$e[0][le+1]=We,$e[1][le+1]=Ke,$e[0].length=$e[1].length=le+2,[Math.min(...$e[0]),Math.min(...$e[1]),Math.max(...$e[0]),Math.max(...$e[1])]}}r.Util=ge;const Te=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,728,711,710,729,733,731,730,732,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8226,8224,8225,8230,8212,8211,402,8260,8249,8250,8722,8240,8222,8220,8221,8216,8217,8218,8482,64257,64258,321,338,352,376,381,305,322,339,353,382,0,8364];function Le(Ge){if(Ge[0]>="ï"){let je;if(Ge[0]==="þ"&&Ge[1]==="ÿ"?je="utf-16be":Ge[0]==="ÿ"&&Ge[1]==="þ"?je="utf-16le":Ge[0]==="ï"&&Ge[1]==="»"&&Ge[2]==="¿"&&(je="utf-8"),je)try{const st=new TextDecoder(je,{fatal:!0}),ct=Se(Ge);return st.decode(ct)}catch(st){me(`stringToPDFString: "${st}".`)}}const Ne=[];for(let je=0,st=Ge.length;je<st;je++){const ct=Te[Ge.charCodeAt(je)];Ne.push(ct?String.fromCharCode(ct):Ge.charAt(je))}return Ne.join("")}function Re(Ge){return decodeURIComponent(escape(Ge))}function Ee(Ge){return unescape(encodeURIComponent(Ge))}function ze(Ge){return typeof Ge=="object"&&(Ge==null?void 0:Ge.byteLength)!==void 0}function Xe(Ge,Ne){if(Ge.length!==Ne.length)return!1;for(let je=0,st=Ge.length;je<st;je++)if(Ge[je]!==Ne[je])return!1;return!0}function tt(){let Ge=arguments.length>0&&arguments[0]!==void 0?arguments[0]:new Date;return[Ge.getUTCFullYear().toString(),(Ge.getUTCMonth()+1).toString().padStart(2,"0"),Ge.getUTCDate().toString().padStart(2,"0"),Ge.getUTCHours().toString().padStart(2,"0"),Ge.getUTCMinutes().toString().padStart(2,"0"),Ge.getUTCSeconds().toString().padStart(2,"0")].join("")}class qe{constructor(){Ie(this,pt,!1);this.promise=new Promise((Ne,je)=>{this.resolve=st=>{ke(this,pt,!0),Ne(st)},this.reject=st=>{ke(this,pt,!0),je(st)}})}get settled(){return M(this,pt)}}pt=new WeakMap,r.PromiseCapability=qe;let dt=null,Ze=null;function nt(Ge){return dt||(dt=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,Ze=new Map([["ﬅ","ſt"]])),Ge.replaceAll(dt,(Ne,je,st)=>je?je.normalize("NFKC"):Ze.get(st))}function ht(){if(typeof crypto<"u"&&typeof(crypto==null?void 0:crypto.randomUUID)=="function")return crypto.randomUUID();const Ge=new Uint8Array(32);if(typeof crypto<"u"&&typeof(crypto==null?void 0:crypto.getRandomValues)=="function")crypto.getRandomValues(Ge);else for(let Ne=0;Ne<32;Ne++)Ge[Ne]=Math.floor(Math.random()*255);return xe(Ge)}const ft="pdfjs_internal_id_";r.AnnotationPrefix=ft},(t,r,e)=>{var s=e(3),a=e(4),i=e(69),o=e(70),c="WebAssembly",x=a[c],u=Error("e",{cause:7}).cause!==7,h=function(v,b){var E={};E[v]=o(v,b,u),s({global:!0,constructor:!0,arity:1,forced:u},E)},_=function(v,b){if(x&&x[v]){var E={};E[v]=o(c+"."+v,b,u),s({target:c,stat:!0,constructor:!0,arity:1,forced:u},E)}};h("Error",function(v){return function(E){return i(v,this,arguments)}}),h("EvalError",function(v){return function(E){return i(v,this,arguments)}}),h("RangeError",function(v){return function(E){return i(v,this,arguments)}}),h("ReferenceError",function(v){return function(E){return i(v,this,arguments)}}),h("SyntaxError",function(v){return function(E){return i(v,this,arguments)}}),h("TypeError",function(v){return function(E){return i(v,this,arguments)}}),h("URIError",function(v){return function(E){return i(v,this,arguments)}}),_("CompileError",function(v){return function(E){return i(v,this,arguments)}}),_("LinkError",function(v){return function(E){return i(v,this,arguments)}}),_("RuntimeError",function(v){return function(E){return i(v,this,arguments)}})},(t,r,e)=>{var s=e(4),a=e(5).f,i=e(44),o=e(48),c=e(38),x=e(56),u=e(68);t.exports=function(h,_){var v=h.target,b=h.global,E=h.stat,d,g,y,R,P,F;if(b?g=s:E?g=s[v]||c(v,{}):g=(s[v]||{}).prototype,g)for(y in _){if(P=_[y],h.dontCallGetSet?(F=a(g,y),R=F&&F.value):R=g[y],d=u(b?y:v+(E?".":"#")+y,h.forced),!d&&R!==void 0){if(typeof P==typeof R)continue;x(P,R)}(h.sham||R&&R.sham)&&i(P,"sham",!0),o(g,y,P,h)}}},function(t){var r=function(e){return e&&e.Math===Math&&e};t.exports=r(typeof globalThis=="object"&&globalThis)||r(typeof window=="object"&&window)||r(typeof self=="object"&&self)||r(typeof commonjsGlobal=="object"&&commonjsGlobal)||function(){return this}()||this||Function("return this")()},(t,r,e)=>{var s=e(6),a=e(8),i=e(10),o=e(11),c=e(12),x=e(18),u=e(39),h=e(42),_=Object.getOwnPropertyDescriptor;r.f=s?_:function(b,E){if(b=c(b),E=x(E),h)try{return _(b,E)}catch{}if(u(b,E))return o(!a(i.f,b,E),b[E])}},(t,r,e)=>{var s=e(7);t.exports=!s(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7})},t=>{t.exports=function(r){try{return!!r()}catch{return!0}}},(t,r,e)=>{var s=e(9),a=Function.prototype.call;t.exports=s?a.bind(a):function(){return a.apply(a,arguments)}},(t,r,e)=>{var s=e(7);t.exports=!s(function(){var a=(function(){}).bind();return typeof a!="function"||a.hasOwnProperty("prototype")})},(t,r)=>{var e={}.propertyIsEnumerable,s=Object.getOwnPropertyDescriptor,a=s&&!e.call({1:2},1);r.f=a?function(o){var c=s(this,o);return!!c&&c.enumerable}:e},t=>{t.exports=function(r,e){return{enumerable:!(r&1),configurable:!(r&2),writable:!(r&4),value:e}}},(t,r,e)=>{var s=e(13),a=e(16);t.exports=function(i){return s(a(i))}},(t,r,e)=>{var s=e(14),a=e(7),i=e(15),o=Object,c=s("".split);t.exports=a(function(){return!o("z").propertyIsEnumerable(0)})?function(x){return i(x)==="String"?c(x,""):o(x)}:o},(t,r,e)=>{var s=e(9),a=Function.prototype,i=a.call,o=s&&a.bind.bind(i,i);t.exports=s?o:function(c){return function(){return i.apply(c,arguments)}}},(t,r,e)=>{var s=e(14),a=s({}.toString),i=s("".slice);t.exports=function(o){return i(a(o),8,-1)}},(t,r,e)=>{var s=e(17),a=TypeError;t.exports=function(i){if(s(i))throw a("Can't call method on "+i);return i}},t=>{t.exports=function(r){return r==null}},(t,r,e)=>{var s=e(19),a=e(23);t.exports=function(i){var o=s(i,"string");return a(o)?o:o+""}},(t,r,e)=>{var s=e(8),a=e(20),i=e(23),o=e(30),c=e(33),x=e(34),u=TypeError,h=x("toPrimitive");t.exports=function(_,v){if(!a(_)||i(_))return _;var b=o(_,h),E;if(b){if(v===void 0&&(v="default"),E=s(b,_,v),!a(E)||i(E))return E;throw u("Can't convert object to primitive value")}return v===void 0&&(v="number"),c(_,v)}},(t,r,e)=>{var s=e(21),a=e(22),i=a.all;t.exports=a.IS_HTMLDDA?function(o){return typeof o=="object"?o!==null:s(o)||o===i}:function(o){return typeof o=="object"?o!==null:s(o)}},(t,r,e)=>{var s=e(22),a=s.all;t.exports=s.IS_HTMLDDA?function(i){return typeof i=="function"||i===a}:function(i){return typeof i=="function"}},t=>{var r=typeof document=="object"&&document.all,e=typeof r>"u"&&r!==void 0;t.exports={all:r,IS_HTMLDDA:e}},(t,r,e)=>{var s=e(24),a=e(21),i=e(25),o=e(26),c=Object;t.exports=o?function(x){return typeof x=="symbol"}:function(x){var u=s("Symbol");return a(u)&&i(u.prototype,c(x))}},(t,r,e)=>{var s=e(4),a=e(21),i=function(o){return a(o)?o:void 0};t.exports=function(o,c){return arguments.length<2?i(s[o]):s[o]&&s[o][c]}},(t,r,e)=>{var s=e(14);t.exports=s({}.isPrototypeOf)},(t,r,e)=>{var s=e(27);t.exports=s&&!Symbol.sham&&typeof Symbol.iterator=="symbol"},(t,r,e)=>{var s=e(28),a=e(7),i=e(4),o=i.String;t.exports=!!Object.getOwnPropertySymbols&&!a(function(){var c=Symbol("symbol detection");return!o(c)||!(Object(c)instanceof Symbol)||!Symbol.sham&&s&&s<41})},(t,r,e)=>{var s=e(4),a=e(29),i=s.process,o=s.Deno,c=i&&i.versions||o&&o.version,x=c&&c.v8,u,h;x&&(u=x.split("."),h=u[0]>0&&u[0]<4?1:+(u[0]+u[1])),!h&&a&&(u=a.match(/Edge\/(\d+)/),(!u||u[1]>=74)&&(u=a.match(/Chrome\/(\d+)/),u&&(h=+u[1]))),t.exports=h},t=>{t.exports=typeof navigator<"u"&&String(navigator.userAgent)||""},(t,r,e)=>{var s=e(31),a=e(17);t.exports=function(i,o){var c=i[o];return a(c)?void 0:s(c)}},(t,r,e)=>{var s=e(21),a=e(32),i=TypeError;t.exports=function(o){if(s(o))return o;throw i(a(o)+" is not a function")}},t=>{var r=String;t.exports=function(e){try{return r(e)}catch{return"Object"}}},(t,r,e)=>{var s=e(8),a=e(21),i=e(20),o=TypeError;t.exports=function(c,x){var u,h;if(x==="string"&&a(u=c.toString)&&!i(h=s(u,c))||a(u=c.valueOf)&&!i(h=s(u,c))||x!=="string"&&a(u=c.toString)&&!i(h=s(u,c)))return h;throw o("Can't convert object to primitive value")}},(t,r,e)=>{var s=e(4),a=e(35),i=e(39),o=e(41),c=e(27),x=e(26),u=s.Symbol,h=a("wks"),_=x?u.for||u:u&&u.withoutSetter||o;t.exports=function(v){return i(h,v)||(h[v]=c&&i(u,v)?u[v]:_("Symbol."+v)),h[v]}},(t,r,e)=>{var s=e(36),a=e(37);(t.exports=function(i,o){return a[i]||(a[i]=o!==void 0?o:{})})("versions",[]).push({version:"3.32.2",mode:s?"pure":"global",copyright:"© 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.32.2/LICENSE",source:"https://github.com/zloirock/core-js"})},t=>{t.exports=!1},(t,r,e)=>{var s=e(4),a=e(38),i="__core-js_shared__",o=s[i]||a(i,{});t.exports=o},(t,r,e)=>{var s=e(4),a=Object.defineProperty;t.exports=function(i,o){try{a(s,i,{value:o,configurable:!0,writable:!0})}catch{s[i]=o}return o}},(t,r,e)=>{var s=e(14),a=e(40),i=s({}.hasOwnProperty);t.exports=Object.hasOwn||function(c,x){return i(a(c),x)}},(t,r,e)=>{var s=e(16),a=Object;t.exports=function(i){return a(s(i))}},(t,r,e)=>{var s=e(14),a=0,i=Math.random(),o=s(1 .toString);t.exports=function(c){return"Symbol("+(c===void 0?"":c)+")_"+o(++a+i,36)}},(t,r,e)=>{var s=e(6),a=e(7),i=e(43);t.exports=!s&&!a(function(){return Object.defineProperty(i("div"),"a",{get:function(){return 7}}).a!==7})},(t,r,e)=>{var s=e(4),a=e(20),i=s.document,o=a(i)&&a(i.createElement);t.exports=function(c){return o?i.createElement(c):{}}},(t,r,e)=>{var s=e(6),a=e(45),i=e(11);t.exports=s?function(o,c,x){return a.f(o,c,i(1,x))}:function(o,c,x){return o[c]=x,o}},(t,r,e)=>{var s=e(6),a=e(42),i=e(46),o=e(47),c=e(18),x=TypeError,u=Object.defineProperty,h=Object.getOwnPropertyDescriptor,_="enumerable",v="configurable",b="writable";r.f=s?i?function(d,g,y){if(o(d),g=c(g),o(y),typeof d=="function"&&g==="prototype"&&"value"in y&&b in y&&!y[b]){var R=h(d,g);R&&R[b]&&(d[g]=y.value,y={configurable:v in y?y[v]:R[v],enumerable:_ in y?y[_]:R[_],writable:!1})}return u(d,g,y)}:u:function(d,g,y){if(o(d),g=c(g),o(y),a)try{return u(d,g,y)}catch{}if("get"in y||"set"in y)throw x("Accessors not supported");return"value"in y&&(d[g]=y.value),d}},(t,r,e)=>{var s=e(6),a=e(7);t.exports=s&&a(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42})},(t,r,e)=>{var s=e(20),a=String,i=TypeError;t.exports=function(o){if(s(o))return o;throw i(a(o)+" is not an object")}},(t,r,e)=>{var s=e(21),a=e(45),i=e(49),o=e(38);t.exports=function(c,x,u,h){h||(h={});var _=h.enumerable,v=h.name!==void 0?h.name:x;if(s(u)&&i(u,v,h),h.global)_?c[x]=u:o(x,u);else{try{h.unsafe?c[x]&&(_=!0):delete c[x]}catch{}_?c[x]=u:a.f(c,x,{value:u,enumerable:!1,configurable:!h.nonConfigurable,writable:!h.nonWritable})}return c}},(t,r,e)=>{var s=e(14),a=e(7),i=e(21),o=e(39),c=e(6),x=e(50).CONFIGURABLE,u=e(51),h=e(52),_=h.enforce,v=h.get,b=String,E=Object.defineProperty,d=s("".slice),g=s("".replace),y=s([].join),R=c&&!a(function(){return E(function(){},"length",{value:8}).length!==8}),P=String(String).split("String"),F=t.exports=function(S,I,w){d(b(I),0,7)==="Symbol("&&(I="["+g(b(I),/^Symbol\(([^)]*)\)/,"$1")+"]"),w&&w.getter&&(I="get "+I),w&&w.setter&&(I="set "+I),(!o(S,"name")||x&&S.name!==I)&&(c?E(S,"name",{value:I,configurable:!0}):S.name=I),R&&w&&o(w,"arity")&&S.length!==w.arity&&E(S,"length",{value:w.arity});try{w&&o(w,"constructor")&&w.constructor?c&&E(S,"prototype",{writable:!1}):S.prototype&&(S.prototype=void 0)}catch{}var j=_(S);return o(j,"source")||(j.source=y(P,typeof I=="string"?I:"")),S};Function.prototype.toString=F(function(){return i(this)&&v(this).source||u(this)},"toString")},(t,r,e)=>{var s=e(6),a=e(39),i=Function.prototype,o=s&&Object.getOwnPropertyDescriptor,c=a(i,"name"),x=c&&(function(){}).name==="something",u=c&&(!s||s&&o(i,"name").configurable);t.exports={EXISTS:c,PROPER:x,CONFIGURABLE:u}},(t,r,e)=>{var s=e(14),a=e(21),i=e(37),o=s(Function.toString);a(i.inspectSource)||(i.inspectSource=function(c){return o(c)}),t.exports=i.inspectSource},(t,r,e)=>{var s=e(53),a=e(4),i=e(20),o=e(44),c=e(39),x=e(37),u=e(54),h=e(55),_="Object already initialized",v=a.TypeError,b=a.WeakMap,E,d,g,y=function(S){return g(S)?d(S):E(S,{})},R=function(S){return function(I){var w;if(!i(I)||(w=d(I)).type!==S)throw v("Incompatible receiver, "+S+" required");return w}};if(s||x.state){var P=x.state||(x.state=new b);P.get=P.get,P.has=P.has,P.set=P.set,E=function(S,I){if(P.has(S))throw v(_);return I.facade=S,P.set(S,I),I},d=function(S){return P.get(S)||{}},g=function(S){return P.has(S)}}else{var F=u("state");h[F]=!0,E=function(S,I){if(c(S,F))throw v(_);return I.facade=S,o(S,F,I),I},d=function(S){return c(S,F)?S[F]:{}},g=function(S){return c(S,F)}}t.exports={set:E,get:d,has:g,enforce:y,getterFor:R}},(t,r,e)=>{var s=e(4),a=e(21),i=s.WeakMap;t.exports=a(i)&&/native code/.test(String(i))},(t,r,e)=>{var s=e(35),a=e(41),i=s("keys");t.exports=function(o){return i[o]||(i[o]=a(o))}},t=>{t.exports={}},(t,r,e)=>{var s=e(39),a=e(57),i=e(5),o=e(45);t.exports=function(c,x,u){for(var h=a(x),_=o.f,v=i.f,b=0;b<h.length;b++){var E=h[b];!s(c,E)&&!(u&&s(u,E))&&_(c,E,v(x,E))}}},(t,r,e)=>{var s=e(24),a=e(14),i=e(58),o=e(67),c=e(47),x=a([].concat);t.exports=s("Reflect","ownKeys")||function(h){var _=i.f(c(h)),v=o.f;return v?x(_,v(h)):_}},(t,r,e)=>{var s=e(59),a=e(66),i=a.concat("length","prototype");r.f=Object.getOwnPropertyNames||function(c){return s(c,i)}},(t,r,e)=>{var s=e(14),a=e(39),i=e(12),o=e(60).indexOf,c=e(55),x=s([].push);t.exports=function(u,h){var _=i(u),v=0,b=[],E;for(E in _)!a(c,E)&&a(_,E)&&x(b,E);for(;h.length>v;)a(_,E=h[v++])&&(~o(b,E)||x(b,E));return b}},(t,r,e)=>{var s=e(12),a=e(61),i=e(64),o=function(c){return function(x,u,h){var _=s(x),v=i(_),b=a(h,v),E;if(c&&u!==u){for(;v>b;)if(E=_[b++],E!==E)return!0}else for(;v>b;b++)if((c||b in _)&&_[b]===u)return c||b||0;return!c&&-1}};t.exports={includes:o(!0),indexOf:o(!1)}},(t,r,e)=>{var s=e(62),a=Math.max,i=Math.min;t.exports=function(o,c){var x=s(o);return x<0?a(x+c,0):i(x,c)}},(t,r,e)=>{var s=e(63);t.exports=function(a){var i=+a;return i!==i||i===0?0:s(i)}},t=>{var r=Math.ceil,e=Math.floor;t.exports=Math.trunc||function(a){var i=+a;return(i>0?e:r)(i)}},(t,r,e)=>{var s=e(65);t.exports=function(a){return s(a.length)}},(t,r,e)=>{var s=e(62),a=Math.min;t.exports=function(i){return i>0?a(s(i),9007199254740991):0}},t=>{t.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},(t,r)=>{r.f=Object.getOwnPropertySymbols},(t,r,e)=>{var s=e(7),a=e(21),i=/#|\.prototype\./,o=function(_,v){var b=x[c(_)];return b===h?!0:b===u?!1:a(v)?s(v):!!v},c=o.normalize=function(_){return String(_).replace(i,".").toLowerCase()},x=o.data={},u=o.NATIVE="N",h=o.POLYFILL="P";t.exports=o},(t,r,e)=>{var s=e(9),a=Function.prototype,i=a.apply,o=a.call;t.exports=typeof Reflect=="object"&&Reflect.apply||(s?o.bind(i):function(){return o.apply(i,arguments)})},(t,r,e)=>{var s=e(24),a=e(39),i=e(44),o=e(25),c=e(71),x=e(56),u=e(74),h=e(75),_=e(76),v=e(80),b=e(81),E=e(6),d=e(36);t.exports=function(g,y,R,P){var F="stackTraceLimit",S=P?2:1,I=g.split("."),w=I[I.length-1],j=s.apply(null,I);if(j){var C=j.prototype;if(!d&&a(C,"cause")&&delete C.cause,!R)return j;var V=s("Error"),O=y(function(H,z){var pe=_(P?z:H,void 0),ee=P?new j(H):new j;return pe!==void 0&&i(ee,"message",pe),b(ee,O,ee.stack,2),this&&o(C,this)&&h(ee,this,O),arguments.length>S&&v(ee,arguments[S]),ee});if(O.prototype=C,w!=="Error"?c?c(O,V):x(O,V,{name:!0}):E&&F in j&&(u(O,j,F),u(O,j,"prepareStackTrace")),x(O,j),!d)try{C.name!==w&&i(C,"name",w),C.constructor=O}catch{}return O}}},(t,r,e)=>{var s=e(72),a=e(47),i=e(73);t.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var o=!1,c={},x;try{x=s(Object.prototype,"__proto__","set"),x(c,[]),o=c instanceof Array}catch{}return function(h,_){return a(h),i(_),o?x(h,_):h.__proto__=_,h}}():void 0)},(t,r,e)=>{var s=e(14),a=e(31);t.exports=function(i,o,c){try{return s(a(Object.getOwnPropertyDescriptor(i,o)[c]))}catch{}}},(t,r,e)=>{var s=e(21),a=String,i=TypeError;t.exports=function(o){if(typeof o=="object"||s(o))return o;throw i("Can't set "+a(o)+" as a prototype")}},(t,r,e)=>{var s=e(45).f;t.exports=function(a,i,o){o in a||s(a,o,{configurable:!0,get:function(){return i[o]},set:function(c){i[o]=c}})}},(t,r,e)=>{var s=e(21),a=e(20),i=e(71);t.exports=function(o,c,x){var u,h;return i&&s(u=c.constructor)&&u!==x&&a(h=u.prototype)&&h!==x.prototype&&i(o,h),o}},(t,r,e)=>{var s=e(77);t.exports=function(a,i){return a===void 0?arguments.length<2?"":i:s(a)}},(t,r,e)=>{var s=e(78),a=String;t.exports=function(i){if(s(i)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return a(i)}},(t,r,e)=>{var s=e(79),a=e(21),i=e(15),o=e(34),c=o("toStringTag"),x=Object,u=i(function(){return arguments}())==="Arguments",h=function(_,v){try{return _[v]}catch{}};t.exports=s?i:function(_){var v,b,E;return _===void 0?"Undefined":_===null?"Null":typeof(b=h(v=x(_),c))=="string"?b:u?i(v):(E=i(v))==="Object"&&a(v.callee)?"Arguments":E}},(t,r,e)=>{var s=e(34),a=s("toStringTag"),i={};i[a]="z",t.exports=String(i)==="[object z]"},(t,r,e)=>{var s=e(20),a=e(44);t.exports=function(i,o){s(o)&&"cause"in o&&a(i,"cause",o.cause)}},(t,r,e)=>{var s=e(44),a=e(82),i=e(83),o=Error.captureStackTrace;t.exports=function(c,x,u,h){i&&(o?o(c,x):s(c,"stack",a(u,h)))}},(t,r,e)=>{var s=e(14),a=Error,i=s("".replace),o=function(u){return String(a(u).stack)}("zxcasd"),c=/\n\s*at [^:]*:[^\n]*/,x=c.test(o);t.exports=function(u,h){if(x&&typeof u=="string"&&!a.prepareStackTrace)for(;h--;)u=i(u,c,"");return u}},(t,r,e)=>{var s=e(7),a=e(11);t.exports=!s(function(){var i=Error("a");return"stack"in i?(Object.defineProperty(i,"stack",a(1,7)),i.stack!==7):!0})},(t,r,e)=>{var s=e(48),a=e(14),i=e(77),o=e(85),c=URLSearchParams,x=c.prototype,u=a(x.append),h=a(x.delete),_=a(x.forEach),v=a([].push),b=new c("a=1&a=2&b=3");b.delete("a",1),b.delete("b",void 0),b+""!="a=2"&&s(x,"delete",function(E){var d=arguments.length,g=d<2?void 0:arguments[1];if(d&&g===void 0)return h(this,E);var y=[];_(this,function(C,V){v(y,{key:V,value:C})}),o(d,1);for(var R=i(E),P=i(g),F=0,S=0,I=!1,w=y.length,j;F<w;)j=y[F++],I||j.key===R?(I=!0,h(this,j.key)):S++;for(;S<w;)j=y[S++],j.key===R&&j.value===P||u(this,j.key,j.value)},{enumerable:!0,unsafe:!0})},t=>{var r=TypeError;t.exports=function(e,s){if(e<s)throw r("Not enough arguments");return e}},(t,r,e)=>{var s=e(48),a=e(14),i=e(77),o=e(85),c=URLSearchParams,x=c.prototype,u=a(x.getAll),h=a(x.has),_=new c("a=1");(_.has("a",2)||!_.has("a",void 0))&&s(x,"has",function(b){var E=arguments.length,d=E<2?void 0:arguments[1];if(E&&d===void 0)return h(this,b);var g=u(this,b);o(E,1);for(var y=i(d),R=0;R<g.length;)if(g[R++]===y)return!0;return!1},{enumerable:!0,unsafe:!0})},(t,r,e)=>{var s=e(6),a=e(14),i=e(88),o=URLSearchParams.prototype,c=a(o.forEach);s&&!("size"in o)&&i(o,"size",{get:function(){var u=0;return c(this,function(){u++}),u},configurable:!0,enumerable:!0})},(t,r,e)=>{var s=e(49),a=e(45);t.exports=function(i,o,c){return c.get&&s(c.get,o,{getter:!0}),c.set&&s(c.set,o,{setter:!0}),a.f(i,o,c)}},(t,r,e)=>{var s=e(3),a=e(40),i=e(64),o=e(90),c=e(92),x=e(7),u=x(function(){return[].push.call({length:4294967296},1)!==4294967297}),h=function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(v){return v instanceof TypeError}},_=u||!h();s({target:"Array",proto:!0,arity:1,forced:_},{push:function(b){var E=a(this),d=i(E),g=arguments.length;c(d+g);for(var y=0;y<g;y++)E[d]=arguments[y],d++;return o(E,d),d}})},(t,r,e)=>{var s=e(6),a=e(91),i=TypeError,o=Object.getOwnPropertyDescriptor,c=s&&!function(){if(this!==void 0)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(x){return x instanceof TypeError}}();t.exports=c?function(x,u){if(a(x)&&!o(x,"length").writable)throw i("Cannot set read only .length");return x.length=u}:function(x,u){return x.length=u}},(t,r,e)=>{var s=e(15);t.exports=Array.isArray||function(i){return s(i)==="Array"}},t=>{var r=TypeError,e=9007199254740991;t.exports=function(s){if(s>e)throw r("Maximum allowed index exceeded");return s}},(t,r,e)=>{var s=e(94),a=e(98).findLast,i=s.aTypedArray,o=s.exportTypedArrayMethod;o("findLast",function(x){return a(i(this),x,arguments.length>1?arguments[1]:void 0)})},(t,r,e)=>{var s=e(95),a=e(6),i=e(4),o=e(21),c=e(20),x=e(39),u=e(78),h=e(32),_=e(44),v=e(48),b=e(88),E=e(25),d=e(96),g=e(71),y=e(34),R=e(41),P=e(52),F=P.enforce,S=P.get,I=i.Int8Array,w=I&&I.prototype,j=i.Uint8ClampedArray,C=j&&j.prototype,V=I&&d(I),O=w&&d(w),H=Object.prototype,z=i.TypeError,pe=y("toStringTag"),ee=R("TYPED_ARRAY_TAG"),he="TypedArrayConstructor",re=s&&!!g&&u(i.opera)!=="Opera",me=!1,te,ce,ye,L={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},N={BigInt64Array:8,BigUint64Array:8},T=function(xe){if(!c(xe))return!1;var Se=u(xe);return Se==="DataView"||x(L,Se)||x(N,Se)},A=function(fe){var xe=d(fe);if(c(xe)){var Se=S(xe);return Se&&x(Se,he)?Se[he]:A(xe)}},D=function(fe){if(!c(fe))return!1;var xe=u(fe);return x(L,xe)||x(N,xe)},B=function(fe){if(D(fe))return fe;throw z("Target is not a typed array")},U=function(fe){if(o(fe)&&(!g||E(V,fe)))return fe;throw z(h(fe)+" is not a typed array constructor")},Y=function(fe,xe,Se,Ce){if(a){if(Se)for(var Me in L){var be=i[Me];if(be&&x(be.prototype,fe))try{delete be.prototype[fe]}catch{try{be.prototype[fe]=xe}catch{}}}(!O[fe]||Se)&&v(O,fe,Se?xe:re&&w[fe]||xe,Ce)}},G=function(fe,xe,Se){var Ce,Me;if(a){if(g){if(Se){for(Ce in L)if(Me=i[Ce],Me&&x(Me,fe))try{delete Me[fe]}catch{}}if(!V[fe]||Se)try{return v(V,fe,Se?xe:re&&V[fe]||xe)}catch{}else return}for(Ce in L)Me=i[Ce],Me&&(!Me[fe]||Se)&&v(Me,fe,xe)}};for(te in L)ce=i[te],ye=ce&&ce.prototype,ye?F(ye)[he]=ce:re=!1;for(te in N)ce=i[te],ye=ce&&ce.prototype,ye&&(F(ye)[he]=ce);if((!re||!o(V)||V===Function.prototype)&&(V=function(){throw z("Incorrect invocation")},re))for(te in L)i[te]&&g(i[te],V);if((!re||!O||O===H)&&(O=V.prototype,re))for(te in L)i[te]&&g(i[te].prototype,O);if(re&&d(C)!==O&&g(C,O),a&&!x(O,pe)){me=!0,b(O,pe,{configurable:!0,get:function(){return c(this)?this[ee]:void 0}});for(te in L)i[te]&&_(i[te],ee,te)}t.exports={NATIVE_ARRAY_BUFFER_VIEWS:re,TYPED_ARRAY_TAG:me&&ee,aTypedArray:B,aTypedArrayConstructor:U,exportTypedArrayMethod:Y,exportTypedArrayStaticMethod:G,getTypedArrayConstructor:A,isView:T,isTypedArray:D,TypedArray:V,TypedArrayPrototype:O}},t=>{t.exports=typeof ArrayBuffer<"u"&&typeof DataView<"u"},(t,r,e)=>{var s=e(39),a=e(21),i=e(40),o=e(54),c=e(97),x=o("IE_PROTO"),u=Object,h=u.prototype;t.exports=c?u.getPrototypeOf:function(_){var v=i(_);if(s(v,x))return v[x];var b=v.constructor;return a(b)&&v instanceof b?b.prototype:v instanceof u?h:null}},(t,r,e)=>{var s=e(7);t.exports=!s(function(){function a(){}return a.prototype.constructor=null,Object.getPrototypeOf(new a)!==a.prototype})},(t,r,e)=>{var s=e(99),a=e(13),i=e(40),o=e(64),c=function(x){var u=x===1;return function(h,_,v){for(var b=i(h),E=a(b),d=s(_,v),g=o(E),y,R;g-- >0;)if(y=E[g],R=d(y,g,b),R)switch(x){case 0:return y;case 1:return g}return u?-1:void 0}};t.exports={findLast:c(0),findLastIndex:c(1)}},(t,r,e)=>{var s=e(100),a=e(31),i=e(9),o=s(s.bind);t.exports=function(c,x){return a(c),x===void 0?c:i?o(c,x):function(){return c.apply(x,arguments)}}},(t,r,e)=>{var s=e(15),a=e(14);t.exports=function(i){if(s(i)==="Function")return a(i)}},(t,r,e)=>{var s=e(94),a=e(98).findLastIndex,i=s.aTypedArray,o=s.exportTypedArrayMethod;o("findLastIndex",function(x){return a(i(this),x,arguments.length>1?arguments[1]:void 0)})},(t,r,e)=>{var s=e(4),a=e(8),i=e(94),o=e(64),c=e(103),x=e(40),u=e(7),h=s.RangeError,_=s.Int8Array,v=_&&_.prototype,b=v&&v.set,E=i.aTypedArray,d=i.exportTypedArrayMethod,g=!u(function(){var R=new Uint8ClampedArray(2);return a(b,R,{length:1,0:3},1),R[1]!==3}),y=g&&i.NATIVE_ARRAY_BUFFER_VIEWS&&u(function(){var R=new _(2);return R.set(1),R.set("2",1),R[0]!==0||R[1]!==2});d("set",function(P){E(this);var F=c(arguments.length>1?arguments[1]:void 0,1),S=x(P);if(g)return a(b,this,S,F);var I=this.length,w=o(S),j=0;if(w+F>I)throw h("Wrong length");for(;j<w;)this[F+j]=S[j++]},!g||y)},(t,r,e)=>{var s=e(104),a=RangeError;t.exports=function(i,o){var c=s(i);if(c%o)throw a("Wrong offset");return c}},(t,r,e)=>{var s=e(62),a=RangeError;t.exports=function(i){var o=s(i);if(o<0)throw a("The argument can't be less than 0");return o}},(t,r,e)=>{var s=e(106),a=e(94),i=a.aTypedArray,o=a.exportTypedArrayMethod,c=a.getTypedArrayConstructor;o("toReversed",function(){return s(i(this),c(this))})},(t,r,e)=>{var s=e(64);t.exports=function(a,i){for(var o=s(a),c=new i(o),x=0;x<o;x++)c[x]=a[o-x-1];return c}},(t,r,e)=>{var s=e(94),a=e(14),i=e(31),o=e(108),c=s.aTypedArray,x=s.getTypedArrayConstructor,u=s.exportTypedArrayMethod,h=a(s.TypedArrayPrototype.sort);u("toSorted",function(v){v!==void 0&&i(v);var b=c(this),E=o(x(b),b);return h(E,v)})},(t,r,e)=>{var s=e(64);t.exports=function(a,i){for(var o=0,c=s(i),x=new a(c);c>o;)x[o]=i[o++];return x}},(t,r,e)=>{var s=e(110),a=e(94),i=e(111),o=e(62),c=e(112),x=a.aTypedArray,u=a.getTypedArrayConstructor,h=a.exportTypedArrayMethod,_=!!function(){try{new Int8Array(1).with(2,{valueOf:function(){throw 8}})}catch(v){return v===8}}();h("with",function(v,b){var E=x(this),d=o(v),g=i(E)?c(b):+b;return s(E,u(E),d,g)},!_)},(t,r,e)=>{var s=e(64),a=e(62),i=RangeError;t.exports=function(o,c,x,u){var h=s(o),_=a(x),v=_<0?h+_:_;if(v>=h||v<0)throw i("Incorrect index");for(var b=new c(h),E=0;E<h;E++)b[E]=E===v?u:o[E];return b}},(t,r,e)=>{var s=e(78);t.exports=function(a){var i=s(a);return i==="BigInt64Array"||i==="BigUint64Array"}},(t,r,e)=>{var s=e(19),a=TypeError;t.exports=function(i){var o=s(i,"number");if(typeof o=="number")throw a("Can't convert number to bigint");return BigInt(o)}},(t,r,e)=>{var s=e(6),a=e(88),i=e(114),o=ArrayBuffer.prototype;s&&!("detached"in o)&&a(o,"detached",{configurable:!0,get:function(){return i(this)}})},(t,r,e)=>{var s=e(14),a=e(115),i=s(ArrayBuffer.prototype.slice);t.exports=function(o){if(a(o)!==0)return!1;try{return i(o,0,0),!1}catch{return!0}}},(t,r,e)=>{var s=e(72),a=e(15),i=TypeError;t.exports=s(ArrayBuffer.prototype,"byteLength","get")||function(o){if(a(o)!=="ArrayBuffer")throw i("ArrayBuffer expected");return o.byteLength}},(t,r,e)=>{var s=e(3),a=e(117);a&&s({target:"ArrayBuffer",proto:!0},{transfer:function(){return a(this,arguments.length?arguments[0]:void 0,!0)}})},(t,r,e)=>{var s=e(4),a=e(14),i=e(72),o=e(118),c=e(114),x=e(115),u=e(119),h=s.TypeError,_=s.structuredClone,v=s.ArrayBuffer,b=s.DataView,E=Math.min,d=v.prototype,g=b.prototype,y=a(d.slice),R=i(d,"resizable","get"),P=i(d,"maxByteLength","get"),F=a(g.getInt8),S=a(g.setInt8);t.exports=u&&function(I,w,j){var C=x(I),V=w===void 0?C:o(w),O=!R||!R(I);if(c(I))throw h("ArrayBuffer is detached");var H=_(I,{transfer:[I]});if(C===V&&(j||O))return H;if(C>=V&&(!j||O))return y(H,0,V);for(var z=j&&!O&&P?{maxByteLength:P(H)}:void 0,pe=new v(V,z),ee=new b(H),he=new b(pe),re=E(V,C),me=0;me<re;me++)S(he,me,F(ee,me));return pe}},(t,r,e)=>{var s=e(62),a=e(65),i=RangeError;t.exports=function(o){if(o===void 0)return 0;var c=s(o),x=a(c);if(c!==x)throw i("Wrong length or index");return x}},(t,r,e)=>{var s=e(4),a=e(7),i=e(28),o=e(120),c=e(121),x=e(122),u=s.structuredClone;t.exports=!!u&&!a(function(){if(c&&i>92||x&&i>94||o&&i>97)return!1;var h=new ArrayBuffer(8),_=u(h,{transfer:[h]});return h.byteLength!==0||_.byteLength!==8})},(t,r,e)=>{var s=e(121),a=e(122);t.exports=!s&&!a&&typeof window=="object"&&typeof document=="object"},t=>{t.exports=typeof Deno=="object"&&Deno&&typeof Deno.version=="object"},(t,r,e)=>{var s=e(4),a=e(15);t.exports=a(s.process)==="process"},(t,r,e)=>{var s=e(3),a=e(117);a&&s({target:"ArrayBuffer",proto:!0},{transferToFixedLength:function(){return a(this,arguments.length?arguments[0]:void 0,!1)}})},(__unused_webpack_module,exports,__w_pdfjs_require__)=>{var t,e,s,a,tr,gr,c,x,u,h,_,v,b,E,d,vr,y,R,Fr,F,S;Object.defineProperty(exports,"__esModule",{value:!0}),exports.RenderTask=exports.PDFWorkerUtil=exports.PDFWorker=exports.PDFPageProxy=exports.PDFDocumentProxy=exports.PDFDocumentLoadingTask=exports.PDFDataRangeTransport=exports.LoopbackPort=exports.DefaultStandardFontDataFactory=exports.DefaultFilterFactory=exports.DefaultCanvasFactory=exports.DefaultCMapReaderFactory=void 0,Object.defineProperty(exports,"SVGGraphics",{enumerable:!0,get:function(){return _displaySvg.SVGGraphics}}),exports.build=void 0,exports.getDocument=getDocument,exports.version=void 0,__w_pdfjs_require__(84),__w_pdfjs_require__(86),__w_pdfjs_require__(87),__w_pdfjs_require__(2),__w_pdfjs_require__(93),__w_pdfjs_require__(101),__w_pdfjs_require__(102),__w_pdfjs_require__(105),__w_pdfjs_require__(107),__w_pdfjs_require__(109),__w_pdfjs_require__(113),__w_pdfjs_require__(116),__w_pdfjs_require__(123),__w_pdfjs_require__(89),__w_pdfjs_require__(125),__w_pdfjs_require__(136),__w_pdfjs_require__(138),__w_pdfjs_require__(141),__w_pdfjs_require__(143),__w_pdfjs_require__(145),__w_pdfjs_require__(147),__w_pdfjs_require__(149),__w_pdfjs_require__(152);var _util=__w_pdfjs_require__(1),_annotation_storage=__w_pdfjs_require__(163),_display_utils=__w_pdfjs_require__(168),_font_loader=__w_pdfjs_require__(171),_displayNode_utils=__w_pdfjs_require__(172),_canvas=__w_pdfjs_require__(173),_worker_options=__w_pdfjs_require__(176),_message_handler=__w_pdfjs_require__(177),_metadata=__w_pdfjs_require__(178),_optional_content_config=__w_pdfjs_require__(179),_transport_stream=__w_pdfjs_require__(180),_displayFetch_stream=__w_pdfjs_require__(181),_displayNetwork=__w_pdfjs_require__(184),_displayNode_stream=__w_pdfjs_require__(185),_displaySvg=__w_pdfjs_require__(186),_xfa_text=__w_pdfjs_require__(194);const DEFAULT_RANGE_CHUNK_SIZE=65536,RENDERING_CANCELLED_TIMEOUT=100,DELAYED_CLEANUP_TIMEOUT=5e3,DefaultCanvasFactory=_util.isNodeJS?_displayNode_utils.NodeCanvasFactory:_display_utils.DOMCanvasFactory;exports.DefaultCanvasFactory=DefaultCanvasFactory;const DefaultCMapReaderFactory=_util.isNodeJS?_displayNode_utils.NodeCMapReaderFactory:_display_utils.DOMCMapReaderFactory;exports.DefaultCMapReaderFactory=DefaultCMapReaderFactory;const DefaultFilterFactory=_util.isNodeJS?_displayNode_utils.NodeFilterFactory:_display_utils.DOMFilterFactory;exports.DefaultFilterFactory=DefaultFilterFactory;const DefaultStandardFontDataFactory=_util.isNodeJS?_displayNode_utils.NodeStandardFontDataFactory:_display_utils.DOMStandardFontDataFactory;exports.DefaultStandardFontDataFactory=DefaultStandardFontDataFactory;function getDocument(w){if(typeof w=="string"||w instanceof URL?w={url:w}:(0,_util.isArrayBuffer)(w)&&(w={data:w}),typeof w!="object")throw new Error("Invalid parameter in getDocument, need parameter object.");if(!w.url&&!w.data&&!w.range)throw new Error("Invalid parameter object: need either .data, .range or .url");const j=new PDFDocumentLoadingTask,{docId:C}=j,V=w.url?getUrlProp(w.url):null,O=w.data?getDataProp(w.data):null,H=w.httpHeaders||null,z=w.withCredentials===!0,pe=w.password??null,ee=w.range instanceof PDFDataRangeTransport?w.range:null,he=Number.isInteger(w.rangeChunkSize)&&w.rangeChunkSize>0?w.rangeChunkSize:DEFAULT_RANGE_CHUNK_SIZE;let re=w.worker instanceof PDFWorker?w.worker:null;const me=w.verbosity,te=typeof w.docBaseUrl=="string"&&!(0,_display_utils.isDataScheme)(w.docBaseUrl)?w.docBaseUrl:null,ce=typeof w.cMapUrl=="string"?w.cMapUrl:null,ye=w.cMapPacked!==!1,L=w.CMapReaderFactory||DefaultCMapReaderFactory,N=typeof w.standardFontDataUrl=="string"?w.standardFontDataUrl:null,T=w.StandardFontDataFactory||DefaultStandardFontDataFactory,A=w.stopAtErrors!==!0,D=Number.isInteger(w.maxImageSize)&&w.maxImageSize>-1?w.maxImageSize:-1,B=w.isEvalSupported!==!1,U=typeof w.isOffscreenCanvasSupported=="boolean"?w.isOffscreenCanvasSupported:!_util.isNodeJS,Y=Number.isInteger(w.canvasMaxAreaInBytes)?w.canvasMaxAreaInBytes:-1,G=typeof w.disableFontFace=="boolean"?w.disableFontFace:_util.isNodeJS,fe=w.fontExtraProperties===!0,xe=w.enableXfa===!0,Se=w.ownerDocument||globalThis.document,Ce=w.disableRange===!0,Me=w.disableStream===!0,be=w.disableAutoFetch===!0,ae=w.pdfBug===!0,J=ee?ee.length:w.length??NaN,oe=typeof w.useSystemFonts=="boolean"?w.useSystemFonts:!_util.isNodeJS&&!G,Q=typeof w.useWorkerFetch=="boolean"?w.useWorkerFetch:L===_display_utils.DOMCMapReaderFactory&&T===_display_utils.DOMStandardFontDataFactory&&ce&&N&&(0,_display_utils.isValidFetchUrl)(ce,document.baseURI)&&(0,_display_utils.isValidFetchUrl)(N,document.baseURI),ge=w.canvasFactory||new DefaultCanvasFactory({ownerDocument:Se}),Te=w.filterFactory||new DefaultFilterFactory({docId:C,ownerDocument:Se}),Le=null;(0,_util.setVerbosityLevel)(me);const Re={canvasFactory:ge,filterFactory:Te};if(Q||(Re.cMapReaderFactory=new L({baseUrl:ce,isCompressed:ye}),Re.standardFontDataFactory=new T({baseUrl:N})),!re){const Xe={verbosity:me,port:_worker_options.GlobalWorkerOptions.workerPort};re=Xe.port?PDFWorker.fromPort(Xe):new PDFWorker(Xe),j._worker=re}const Ee={docId:C,apiVersion:"3.11.174",data:O,password:pe,disableAutoFetch:be,rangeChunkSize:he,length:J,docBaseUrl:te,enableXfa:xe,evaluatorOptions:{maxImageSize:D,disableFontFace:G,ignoreErrors:A,isEvalSupported:B,isOffscreenCanvasSupported:U,canvasMaxAreaInBytes:Y,fontExtraProperties:fe,useSystemFonts:oe,cMapUrl:Q?ce:null,standardFontDataUrl:Q?N:null}},ze={ignoreErrors:A,isEvalSupported:B,disableFontFace:G,fontExtraProperties:fe,enableXfa:xe,ownerDocument:Se,disableAutoFetch:be,pdfBug:ae,styleElement:Le};return re.promise.then(function(){if(j.destroyed)throw new Error("Loading aborted");const Xe=_fetchDocument(re,Ee),tt=new Promise(function(qe){let dt;ee?dt=new _transport_stream.PDFDataTransportStream({length:J,initialData:ee.initialData,progressiveDone:ee.progressiveDone,contentDispositionFilename:ee.contentDispositionFilename,disableRange:Ce,disableStream:Me},ee):O||(dt=(nt=>_util.isNodeJS?new _displayNode_stream.PDFNodeStream(nt):(0,_display_utils.isValidFetchUrl)(nt.url)?new _displayFetch_stream.PDFFetchStream(nt):new _displayNetwork.PDFNetworkStream(nt))({url:V,length:J,httpHeaders:H,withCredentials:z,rangeChunkSize:he,disableRange:Ce,disableStream:Me})),qe(dt)});return Promise.all([Xe,tt]).then(function(qe){let[dt,Ze]=qe;if(j.destroyed)throw new Error("Loading aborted");const nt=new _message_handler.MessageHandler(C,dt,re.port),ht=new WorkerTransport(nt,j,Ze,ze,Re);j._transport=ht,nt.send("Ready",null)})}).catch(j._capability.reject),j}async function _fetchDocument(w,j){if(w.destroyed)throw new Error("Worker was destroyed");const C=await w.messageHandler.sendWithPromise("GetDocRequest",j,j.data?[j.data.buffer]:null);if(w.destroyed)throw new Error("Worker was destroyed");return C}function getUrlProp(w){if(w instanceof URL)return w.href;try{return new URL(w,window.location).href}catch{if(_util.isNodeJS&&typeof w=="string")return w}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function getDataProp(w){if(_util.isNodeJS&&typeof Buffer<"u"&&w instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(w instanceof Uint8Array&&w.byteLength===w.buffer.byteLength)return w;if(typeof w=="string")return(0,_util.stringToBytes)(w);if(typeof w=="object"&&!isNaN(w==null?void 0:w.length)||(0,_util.isArrayBuffer)(w))return new Uint8Array(w);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}const r=class r{constructor(){this._capability=new _util.PromiseCapability,this._transport=null,this._worker=null,this.docId=`d${lr(r,t)._++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){var j,C,V;this.destroyed=!0;try{(j=this._worker)!=null&&j.port&&(this._worker._pendingDestroy=!0),await((C=this._transport)==null?void 0:C.destroy())}catch(O){throw(V=this._worker)!=null&&V.port&&delete this._worker._pendingDestroy,O}this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}};t=new WeakMap,Ie(r,t,0);let PDFDocumentLoadingTask=r;exports.PDFDocumentLoadingTask=PDFDocumentLoadingTask;class PDFDataRangeTransport{constructor(j,C){let V=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,O=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;this.length=j,this.initialData=C,this.progressiveDone=V,this.contentDispositionFilename=O,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=new _util.PromiseCapability}addRangeListener(j){this._rangeListeners.push(j)}addProgressListener(j){this._progressListeners.push(j)}addProgressiveReadListener(j){this._progressiveReadListeners.push(j)}addProgressiveDoneListener(j){this._progressiveDoneListeners.push(j)}onDataRange(j,C){for(const V of this._rangeListeners)V(j,C)}onDataProgress(j,C){this._readyCapability.promise.then(()=>{for(const V of this._progressListeners)V(j,C)})}onDataProgressiveRead(j){this._readyCapability.promise.then(()=>{for(const C of this._progressiveReadListeners)C(j)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const j of this._progressiveDoneListeners)j()})}transportReady(){this._readyCapability.resolve()}requestDataRange(j,C){(0,_util.unreachable)("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}exports.PDFDataRangeTransport=PDFDataRangeTransport;class PDFDocumentProxy{constructor(j,C){this._pdfInfo=j,this._transport=C,Object.defineProperty(this,"getJavaScript",{value:()=>((0,_display_utils.deprecated)("`PDFDocumentProxy.getJavaScript`, please use `PDFDocumentProxy.getJSActions` instead."),this.getJSActions().then(V=>{if(!V)return V;const O=[];for(const H in V)O.push(...V[H]);return O}))})}get annotationStorage(){return this._transport.annotationStorage}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(j){return this._transport.getPage(j)}getPageIndex(j){return this._transport.getPageIndex(j)}getDestinations(){return this._transport.getDestinations()}getDestination(j){return this._transport.getDestination(j)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig(){return this._transport.getOptionalContentConfig()}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(){let j=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return this._transport.startCleanup(j||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}exports.PDFDocumentProxy=PDFDocumentProxy;class PDFPageProxy{constructor(j,C,V){Ie(this,a);Ie(this,e,null);Ie(this,s,!1);let O=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;this._pageIndex=j,this._pageInfo=C,this._transport=V,this._stats=O?new _display_utils.StatTimer:null,this._pdfBug=O,this.commonObjs=V.commonObjs,this.objs=new PDFObjects,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport(){let{scale:j,rotation:C=this.rotate,offsetX:V=0,offsetY:O=0,dontFlip:H=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return new _display_utils.PageViewport({viewBox:this.view,scale:j,rotation:C,offsetX:V,offsetY:O,dontFlip:H})}getAnnotations(){let{intent:j="display"}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const C=this._transport.getRenderingIntent(j);return this._transport.getAnnotations(this._pageIndex,C.renderingIntent)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var j;return((j=this._transport._htmlForXfa)==null?void 0:j.children[this._pageIndex])||null}render(j){var A,D;let{canvasContext:C,viewport:V,intent:O="display",annotationMode:H=_util.AnnotationMode.ENABLE,transform:z=null,background:pe=null,optionalContentConfigPromise:ee=null,annotationCanvasMap:he=null,pageColors:re=null,printAnnotationStorage:me=null}=j;(A=this._stats)==null||A.time("Overall");const te=this._transport.getRenderingIntent(O,H,me);ke(this,s,!1),Ae(this,a,gr).call(this),ee||(ee=this._transport.getOptionalContentConfig());let ce=this._intentStates.get(te.cacheKey);ce||(ce=Object.create(null),this._intentStates.set(te.cacheKey,ce)),ce.streamReaderCancelTimeout&&(clearTimeout(ce.streamReaderCancelTimeout),ce.streamReaderCancelTimeout=null);const ye=!!(te.renderingIntent&_util.RenderingIntentFlag.PRINT);ce.displayReadyCapability||(ce.displayReadyCapability=new _util.PromiseCapability,ce.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(D=this._stats)==null||D.time("Page Request"),this._pumpOperatorList(te));const L=B=>{var U,Y;ce.renderTasks.delete(N),(this._maybeCleanupAfterRender||ye)&&ke(this,s,!0),Ae(this,a,tr).call(this,!ye),B?(N.capability.reject(B),this._abortOperatorList({intentState:ce,reason:B instanceof Error?B:new Error(B)})):N.capability.resolve(),(U=this._stats)==null||U.timeEnd("Rendering"),(Y=this._stats)==null||Y.timeEnd("Overall")},N=new InternalRenderTask({callback:L,params:{canvasContext:C,viewport:V,transform:z,background:pe},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:he,operatorList:ce.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!ye,pdfBug:this._pdfBug,pageColors:re});(ce.renderTasks||(ce.renderTasks=new Set)).add(N);const T=N.task;return Promise.all([ce.displayReadyCapability.promise,ee]).then(B=>{var G;let[U,Y]=B;if(this.destroyed){L();return}(G=this._stats)==null||G.time("Rendering"),N.initializeGraphics({transparency:U,optionalContentConfig:Y}),N.operatorListChanged()}).catch(L),T}getOperatorList(){var ee;let{intent:j="display",annotationMode:C=_util.AnnotationMode.ENABLE,printAnnotationStorage:V=null}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};function O(){z.operatorList.lastChunk&&(z.opListReadCapability.resolve(z.operatorList),z.renderTasks.delete(pe))}const H=this._transport.getRenderingIntent(j,C,V,!0);let z=this._intentStates.get(H.cacheKey);z||(z=Object.create(null),this._intentStates.set(H.cacheKey,z));let pe;return z.opListReadCapability||(pe=Object.create(null),pe.operatorListChanged=O,z.opListReadCapability=new _util.PromiseCapability,(z.renderTasks||(z.renderTasks=new Set)).add(pe),z.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(ee=this._stats)==null||ee.time("Page Request"),this._pumpOperatorList(H)),z.opListReadCapability.promise}streamTextContent(){let{includeMarkedContent:j=!1,disableNormalization:C=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:j===!0,disableNormalization:C===!0},{highWaterMark:100,size(O){return O.items.length}})}getTextContent(){let j=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this._transport._htmlForXfa)return this.getXfa().then(V=>_xfa_text.XfaText.textContent(V));const C=this.streamTextContent(j);return new Promise(function(V,O){function H(){z.read().then(function(ee){let{value:he,done:re}=ee;if(re){V(pe);return}Object.assign(pe.styles,he.styles),pe.items.push(...he.items),H()},O)}const z=C.getReader(),pe={items:[],styles:Object.create(null)};H()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const j=[];for(const C of this._intentStates.values())if(this._abortOperatorList({intentState:C,reason:new Error("Page was destroyed."),force:!0}),!C.opListReadCapability)for(const V of C.renderTasks)j.push(V.completed),V.cancel();return this.objs.clear(),ke(this,s,!1),Ae(this,a,gr).call(this),Promise.all(j)}cleanup(){let j=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;ke(this,s,!0);const C=Ae(this,a,tr).call(this,!1);return j&&C&&this._stats&&(this._stats=new _display_utils.StatTimer),C}_startRenderPage(j,C){var O,H;const V=this._intentStates.get(C);V&&((O=this._stats)==null||O.timeEnd("Page Request"),(H=V.displayReadyCapability)==null||H.resolve(j))}_renderPageChunk(j,C){for(let V=0,O=j.length;V<O;V++)C.operatorList.fnArray.push(j.fnArray[V]),C.operatorList.argsArray.push(j.argsArray[V]);C.operatorList.lastChunk=j.lastChunk,C.operatorList.separateAnnots=j.separateAnnots;for(const V of C.renderTasks)V.operatorListChanged();j.lastChunk&&Ae(this,a,tr).call(this,!0)}_pumpOperatorList(j){let{renderingIntent:C,cacheKey:V,annotationStorageSerializable:O}=j;const{map:H,transfers:z}=O,ee=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:C,cacheKey:V,annotationStorage:H},z).getReader(),he=this._intentStates.get(V);he.streamReader=ee;const re=()=>{ee.read().then(me=>{let{value:te,done:ce}=me;if(ce){he.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(te,he),re())},me=>{if(he.streamReader=null,!this._transport.destroyed){if(he.operatorList){he.operatorList.lastChunk=!0;for(const te of he.renderTasks)te.operatorListChanged();Ae(this,a,tr).call(this,!0)}if(he.displayReadyCapability)he.displayReadyCapability.reject(me);else if(he.opListReadCapability)he.opListReadCapability.reject(me);else throw me}})};re()}_abortOperatorList(j){let{intentState:C,reason:V,force:O=!1}=j;if(C.streamReader){if(C.streamReaderCancelTimeout&&(clearTimeout(C.streamReaderCancelTimeout),C.streamReaderCancelTimeout=null),!O){if(C.renderTasks.size>0)return;if(V instanceof _display_utils.RenderingCancelledException){let H=RENDERING_CANCELLED_TIMEOUT;V.extraDelay>0&&V.extraDelay<1e3&&(H+=V.extraDelay),C.streamReaderCancelTimeout=setTimeout(()=>{C.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:C,reason:V,force:!0})},H);return}}if(C.streamReader.cancel(new _util.AbortException(V.message)).catch(()=>{}),C.streamReader=null,!this._transport.destroyed){for(const[H,z]of this._intentStates)if(z===C){this._intentStates.delete(H);break}this.cleanup()}}}get stats(){return this._stats}}e=new WeakMap,s=new WeakMap,a=new WeakSet,tr=function(){let j=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(Ae(this,a,gr).call(this),!M(this,s)||this.destroyed)return!1;if(j)return ke(this,e,setTimeout(()=>{ke(this,e,null),Ae(this,a,tr).call(this,!1)},DELAYED_CLEANUP_TIMEOUT)),!1;for(const{renderTasks:C,operatorList:V}of this._intentStates.values())if(C.size>0||!V.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),ke(this,s,!1),!0},gr=function(){M(this,e)&&(clearTimeout(M(this,e)),ke(this,e,null))},exports.PDFPageProxy=PDFPageProxy;class LoopbackPort{constructor(){Ie(this,c,new Set);Ie(this,x,Promise.resolve())}postMessage(j,C){const V={data:structuredClone(j,null)};M(this,x).then(()=>{for(const O of M(this,c))O.call(this,V)})}addEventListener(j,C){M(this,c).add(C)}removeEventListener(j,C){M(this,c).delete(C)}terminate(){M(this,c).clear()}}c=new WeakMap,x=new WeakMap,exports.LoopbackPort=LoopbackPort;const PDFWorkerUtil={isWorkerDisabled:!1,fallbackWorkerSrc:null,fakeWorkerId:0};exports.PDFWorkerUtil=PDFWorkerUtil;{if(_util.isNodeJS&&typeof commonjsRequire=="function")PDFWorkerUtil.isWorkerDisabled=!0,PDFWorkerUtil.fallbackWorkerSrc="./pdf.worker.js";else if(typeof document=="object"){const w=(u=document==null?void 0:document.currentScript)==null?void 0:u.src;w&&(PDFWorkerUtil.fallbackWorkerSrc=w.replace(/(\.(?:min\.)?js)(\?.*)?$/i,".worker$1$2"))}PDFWorkerUtil.isSameOrigin=function(w,j){let C;try{if(C=new URL(w),!C.origin||C.origin==="null")return!1}catch{return!1}const V=new URL(j,C);return C.origin===V.origin},PDFWorkerUtil.createCDNWrapper=function(w){const j=`importScripts("${w}");`;return URL.createObjectURL(new Blob([j]))}}const _PDFWorker=class _PDFWorker{constructor(){var V;let{name:w=null,port:j=null,verbosity:C=(0,_util.getVerbosityLevel)()}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this.name=w,this.destroyed=!1,this.verbosity=C,this._readyCapability=new _util.PromiseCapability,this._port=null,this._webWorker=null,this._messageHandler=null,j){if((V=M(_PDFWorker,h))!=null&&V.has(j))throw new Error("Cannot use more than one PDFWorker per port.");(M(_PDFWorker,h)||ke(_PDFWorker,h,new WeakMap)).set(j,this),this._initializeFromPort(j);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(w){this._port=w,this._messageHandler=new _message_handler.MessageHandler("main","worker",w),this._messageHandler.on("ready",function(){}),this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})}_initialize(){if(!PDFWorkerUtil.isWorkerDisabled&&!_PDFWorker._mainThreadWorkerMessageHandler){let{workerSrc:w}=_PDFWorker;try{PDFWorkerUtil.isSameOrigin(window.location.href,w)||(w=PDFWorkerUtil.createCDNWrapper(new URL(w,window.location).href));const j=new Worker(w),C=new _message_handler.MessageHandler("main","worker",j),V=()=>{j.removeEventListener("error",O),C.destroy(),j.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},O=()=>{this._webWorker||V()};j.addEventListener("error",O),C.on("test",z=>{if(j.removeEventListener("error",O),this.destroyed){V();return}z?(this._messageHandler=C,this._port=j,this._webWorker=j,this._readyCapability.resolve(),C.send("configure",{verbosity:this.verbosity})):(this._setupFakeWorker(),C.destroy(),j.terminate())}),C.on("ready",z=>{if(j.removeEventListener("error",O),this.destroyed){V();return}try{H()}catch{this._setupFakeWorker()}});const H=()=>{const z=new Uint8Array;C.send("test",z,[z.buffer])};H();return}catch{(0,_util.info)("The worker has been disabled.")}}this._setupFakeWorker()}_setupFakeWorker(){PDFWorkerUtil.isWorkerDisabled||((0,_util.warn)("Setting up fake worker."),PDFWorkerUtil.isWorkerDisabled=!0),_PDFWorker._setupFakeWorkerGlobal.then(w=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const j=new LoopbackPort;this._port=j;const C=`fake${PDFWorkerUtil.fakeWorkerId++}`,V=new _message_handler.MessageHandler(C+"_worker",C,j);w.setup(V,j);const O=new _message_handler.MessageHandler(C,C+"_worker",j);this._messageHandler=O,this._readyCapability.resolve(),O.send("configure",{verbosity:this.verbosity})}).catch(w=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${w.message}".`))})}destroy(){var w;this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),(w=M(_PDFWorker,h))==null||w.delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(w){var C;if(!(w!=null&&w.port))throw new Error("PDFWorker.fromPort - invalid method signature.");const j=(C=M(this,h))==null?void 0:C.get(w.port);if(j){if(j._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return j}return new _PDFWorker(w)}static get workerSrc(){if(_worker_options.GlobalWorkerOptions.workerSrc)return _worker_options.GlobalWorkerOptions.workerSrc;if(PDFWorkerUtil.fallbackWorkerSrc!==null)return _util.isNodeJS||(0,_display_utils.deprecated)('No "GlobalWorkerOptions.workerSrc" specified.'),PDFWorkerUtil.fallbackWorkerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _mainThreadWorkerMessageHandler(){var w;try{return((w=globalThis.pdfjsWorker)==null?void 0:w.WorkerMessageHandler)||null}catch{return null}}static get _setupFakeWorkerGlobal(){const loader=async()=>{const mainWorkerMessageHandler=this._mainThreadWorkerMessageHandler;if(mainWorkerMessageHandler)return mainWorkerMessageHandler;if(_util.isNodeJS&&typeof commonjsRequire=="function"){const worker=eval("require")(this.workerSrc);return worker.WorkerMessageHandler}return await(0,_display_utils.loadScript)(this.workerSrc),window.pdfjsWorker.WorkerMessageHandler};return(0,_util.shadow)(this,"_setupFakeWorkerGlobal",loader())}};h=new WeakMap,Ie(_PDFWorker,h);let PDFWorker=_PDFWorker;exports.PDFWorker=PDFWorker;class WorkerTransport{constructor(j,C,V,O,H){Ie(this,d);Ie(this,_,new Map);Ie(this,v,new Map);Ie(this,b,new Map);Ie(this,E,null);this.messageHandler=j,this.loadingTask=C,this.commonObjs=new PDFObjects,this.fontLoader=new _font_loader.FontLoader({ownerDocument:O.ownerDocument,styleElement:O.styleElement}),this._params=O,this.canvasFactory=H.canvasFactory,this.filterFactory=H.filterFactory,this.cMapReaderFactory=H.cMapReaderFactory,this.standardFontDataFactory=H.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=V,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=new _util.PromiseCapability,this.setupMessageHandler()}get annotationStorage(){return(0,_util.shadow)(this,"annotationStorage",new _annotation_storage.AnnotationStorage)}getRenderingIntent(j){let C=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_util.AnnotationMode.ENABLE,V=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,O=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,H=_util.RenderingIntentFlag.DISPLAY,z=_annotation_storage.SerializableEmpty;switch(j){case"any":H=_util.RenderingIntentFlag.ANY;break;case"display":break;case"print":H=_util.RenderingIntentFlag.PRINT;break;default:(0,_util.warn)(`getRenderingIntent - invalid intent: ${j}`)}switch(C){case _util.AnnotationMode.DISABLE:H+=_util.RenderingIntentFlag.ANNOTATIONS_DISABLE;break;case _util.AnnotationMode.ENABLE:break;case _util.AnnotationMode.ENABLE_FORMS:H+=_util.RenderingIntentFlag.ANNOTATIONS_FORMS;break;case _util.AnnotationMode.ENABLE_STORAGE:H+=_util.RenderingIntentFlag.ANNOTATIONS_STORAGE,z=(H&_util.RenderingIntentFlag.PRINT&&V instanceof _annotation_storage.PrintAnnotationStorage?V:this.annotationStorage).serializable;break;default:(0,_util.warn)(`getRenderingIntent - invalid annotationMode: ${C}`)}return O&&(H+=_util.RenderingIntentFlag.OPLIST),{renderingIntent:H,cacheKey:`${H}_${z.hash}`,annotationStorageSerializable:z}}destroy(){var V;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=new _util.PromiseCapability,(V=M(this,E))==null||V.reject(new Error("Worker was destroyed during onPassword callback"));const j=[];for(const O of M(this,v).values())j.push(O._destroy());M(this,v).clear(),M(this,b).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const C=this.messageHandler.sendWithPromise("Terminate",null);return j.push(C),Promise.all(j).then(()=>{var O;this.commonObjs.clear(),this.fontLoader.clear(),M(this,_).clear(),this.filterFactory.destroy(),(O=this._networkStream)==null||O.cancelAllRequests(new _util.AbortException("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:j,loadingTask:C}=this;j.on("GetReader",(V,O)=>{(0,_util.assert)(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=H=>{this._lastProgress={loaded:H.loaded,total:H.total}},O.onPull=()=>{this._fullReader.read().then(function(H){let{value:z,done:pe}=H;if(pe){O.close();return}(0,_util.assert)(z instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),O.enqueue(new Uint8Array(z),1,[z])}).catch(H=>{O.error(H)})},O.onCancel=H=>{this._fullReader.cancel(H),O.ready.catch(z=>{if(!this.destroyed)throw z})}}),j.on("ReaderHeadersReady",V=>{const O=new _util.PromiseCapability,H=this._fullReader;return H.headersReady.then(()=>{var z;(!H.isStreamingSupported||!H.isRangeSupported)&&(this._lastProgress&&((z=C.onProgress)==null||z.call(C,this._lastProgress)),H.onProgress=pe=>{var ee;(ee=C.onProgress)==null||ee.call(C,{loaded:pe.loaded,total:pe.total})}),O.resolve({isStreamingSupported:H.isStreamingSupported,isRangeSupported:H.isRangeSupported,contentLength:H.contentLength})},O.reject),O.promise}),j.on("GetRangeReader",(V,O)=>{(0,_util.assert)(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const H=this._networkStream.getRangeReader(V.begin,V.end);if(!H){O.close();return}O.onPull=()=>{H.read().then(function(z){let{value:pe,done:ee}=z;if(ee){O.close();return}(0,_util.assert)(pe instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),O.enqueue(new Uint8Array(pe),1,[pe])}).catch(z=>{O.error(z)})},O.onCancel=z=>{H.cancel(z),O.ready.catch(pe=>{if(!this.destroyed)throw pe})}}),j.on("GetDoc",V=>{let{pdfInfo:O}=V;this._numPages=O.numPages,this._htmlForXfa=O.htmlForXfa,delete O.htmlForXfa,C._capability.resolve(new PDFDocumentProxy(O,this))}),j.on("DocException",function(V){let O;switch(V.name){case"PasswordException":O=new _util.PasswordException(V.message,V.code);break;case"InvalidPDFException":O=new _util.InvalidPDFException(V.message);break;case"MissingPDFException":O=new _util.MissingPDFException(V.message);break;case"UnexpectedResponseException":O=new _util.UnexpectedResponseException(V.message,V.status);break;case"UnknownErrorException":O=new _util.UnknownErrorException(V.message,V.details);break;default:(0,_util.unreachable)("DocException - expected a valid Error.")}C._capability.reject(O)}),j.on("PasswordRequest",V=>{if(ke(this,E,new _util.PromiseCapability),C.onPassword){const O=H=>{H instanceof Error?M(this,E).reject(H):M(this,E).resolve({password:H})};try{C.onPassword(O,V.code)}catch(H){M(this,E).reject(H)}}else M(this,E).reject(new _util.PasswordException(V.message,V.code));return M(this,E).promise}),j.on("DataLoaded",V=>{var O;(O=C.onProgress)==null||O.call(C,{loaded:V.length,total:V.length}),this.downloadInfoCapability.resolve(V)}),j.on("StartRenderPage",V=>{if(this.destroyed)return;M(this,v).get(V.pageIndex)._startRenderPage(V.transparency,V.cacheKey)}),j.on("commonobj",V=>{var pe;let[O,H,z]=V;if(!this.destroyed&&!this.commonObjs.has(O))switch(H){case"Font":const ee=this._params;if("error"in z){const me=z.error;(0,_util.warn)(`Error during font loading: ${me}`),this.commonObjs.resolve(O,me);break}const he=ee.pdfBug&&((pe=globalThis.FontInspector)!=null&&pe.enabled)?(me,te)=>globalThis.FontInspector.fontAdded(me,te):null,re=new _font_loader.FontFaceObject(z,{isEvalSupported:ee.isEvalSupported,disableFontFace:ee.disableFontFace,ignoreErrors:ee.ignoreErrors,inspectFont:he});this.fontLoader.bind(re).catch(me=>j.sendWithPromise("FontFallback",{id:O})).finally(()=>{!ee.fontExtraProperties&&re.data&&(re.data=null),this.commonObjs.resolve(O,re)});break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(O,z);break;default:throw new Error(`Got unknown common object type ${H}`)}}),j.on("obj",V=>{var he;let[O,H,z,pe]=V;if(this.destroyed)return;const ee=M(this,v).get(H);if(!ee.objs.has(O))switch(z){case"Image":if(ee.objs.resolve(O,pe),pe){let re;if(pe.bitmap){const{width:me,height:te}=pe;re=me*te*4}else re=((he=pe.data)==null?void 0:he.length)||0;re>_util.MAX_IMAGE_SIZE_TO_CACHE&&(ee._maybeCleanupAfterRender=!0)}break;case"Pattern":ee.objs.resolve(O,pe);break;default:throw new Error(`Got unknown object type ${z}`)}}),j.on("DocProgress",V=>{var O;this.destroyed||(O=C.onProgress)==null||O.call(C,{loaded:V.loaded,total:V.total})}),j.on("FetchBuiltInCMap",V=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.cMapReaderFactory?this.cMapReaderFactory.fetch(V):Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter."))),j.on("FetchStandardFontData",V=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.standardFontDataFactory?this.standardFontDataFactory.fetch(V):Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.")))}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var V;this.annotationStorage.size<=0&&(0,_util.warn)("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:j,transfers:C}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:j,filename:((V=this._fullReader)==null?void 0:V.filename)??null},C).finally(()=>{this.annotationStorage.resetModified()})}getPage(j){if(!Number.isInteger(j)||j<=0||j>this._numPages)return Promise.reject(new Error("Invalid page request."));const C=j-1,V=M(this,b).get(C);if(V)return V;const O=this.messageHandler.sendWithPromise("GetPage",{pageIndex:C}).then(H=>{if(this.destroyed)throw new Error("Transport destroyed");const z=new PDFPageProxy(C,H,this,this._params.pdfBug);return M(this,v).set(C,z),z});return M(this,b).set(C,O),O}getPageIndex(j){return typeof j!="object"||j===null||!Number.isInteger(j.num)||j.num<0||!Number.isInteger(j.gen)||j.gen<0?Promise.reject(new Error("Invalid pageIndex request.")):this.messageHandler.sendWithPromise("GetPageIndex",{num:j.num,gen:j.gen})}getAnnotations(j,C){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:j,intent:C})}getFieldObjects(){return Ae(this,d,vr).call(this,"GetFieldObjects")}hasJSActions(){return Ae(this,d,vr).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(j){return typeof j!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:j})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return Ae(this,d,vr).call(this,"GetDocJSActions")}getPageJSActions(j){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:j})}getStructTree(j){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:j})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(){return this.messageHandler.sendWithPromise("GetOptionalContentConfig",null).then(j=>new _optional_content_config.OptionalContentConfig(j))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const j="GetMetadata",C=M(this,_).get(j);if(C)return C;const V=this.messageHandler.sendWithPromise(j,null).then(O=>{var H,z;return{info:O[0],metadata:O[1]?new _metadata.Metadata(O[1]):null,contentDispositionFilename:((H=this._fullReader)==null?void 0:H.filename)??null,contentLength:((z=this._fullReader)==null?void 0:z.contentLength)??null}});return M(this,_).set(j,V),V}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(){let j=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const C of M(this,v).values())if(!C.cleanup())throw new Error(`startCleanup: Page ${C.pageNumber} is currently rendering.`);this.commonObjs.clear(),j||this.fontLoader.clear(),M(this,_).clear(),this.filterFactory.destroy(!0)}}get loadingParams(){const{disableAutoFetch:j,enableXfa:C}=this._params;return(0,_util.shadow)(this,"loadingParams",{disableAutoFetch:j,enableXfa:C})}}_=new WeakMap,v=new WeakMap,b=new WeakMap,E=new WeakMap,d=new WeakSet,vr=function(j){let C=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const V=M(this,_).get(j);if(V)return V;const O=this.messageHandler.sendWithPromise(j,C);return M(this,_).set(j,O),O};class PDFObjects{constructor(){Ie(this,R);Ie(this,y,Object.create(null))}get(j){let C=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(C){const O=Ae(this,R,Fr).call(this,j);return O.capability.promise.then(()=>C(O.data)),null}const V=M(this,y)[j];if(!(V!=null&&V.capability.settled))throw new Error(`Requesting object that isn't resolved yet ${j}.`);return V.data}has(j){const C=M(this,y)[j];return(C==null?void 0:C.capability.settled)||!1}resolve(j){let C=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const V=Ae(this,R,Fr).call(this,j);V.data=C,V.capability.resolve()}clear(){var j;for(const C in M(this,y)){const{data:V}=M(this,y)[C];(j=V==null?void 0:V.bitmap)==null||j.close()}ke(this,y,Object.create(null))}}y=new WeakMap,R=new WeakSet,Fr=function(j){var C;return(C=M(this,y))[j]||(C[j]={capability:new _util.PromiseCapability,data:null})};class RenderTask{constructor(j){Ie(this,F,null);ke(this,F,j),this.onContinue=null}get promise(){return M(this,F).capability.promise}cancel(){let j=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;M(this,F).cancel(null,j)}get separateAnnots(){const{separateAnnots:j}=M(this,F).operatorList;if(!j)return!1;const{annotationCanvasMap:C}=M(this,F);return j.form||j.canvas&&(C==null?void 0:C.size)>0}}F=new WeakMap,exports.RenderTask=RenderTask;const I=class I{constructor(j){let{callback:C,params:V,objs:O,commonObjs:H,annotationCanvasMap:z,operatorList:pe,pageIndex:ee,canvasFactory:he,filterFactory:re,useRequestAnimationFrame:me=!1,pdfBug:te=!1,pageColors:ce=null}=j;this.callback=C,this.params=V,this.objs=O,this.commonObjs=H,this.annotationCanvasMap=z,this.operatorListIdx=null,this.operatorList=pe,this._pageIndex=ee,this.canvasFactory=he,this.filterFactory=re,this._pdfBug=te,this.pageColors=ce,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=me===!0&&typeof window<"u",this.cancelled=!1,this.capability=new _util.PromiseCapability,this.task=new RenderTask(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=V.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics(j){var ee,he;let{transparency:C=!1,optionalContentConfig:V}=j;if(this.cancelled)return;if(this._canvas){if(M(I,S).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");M(I,S).add(this._canvas)}this._pdfBug&&((ee=globalThis.StepperManager)!=null&&ee.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:O,viewport:H,transform:z,background:pe}=this.params;this.gfx=new _canvas.CanvasGraphics(O,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:V},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:z,viewport:H,transparency:C,background:pe}),this.operatorListIdx=0,this.graphicsReady=!0,(he=this.graphicsReadyCallback)==null||he.call(this)}cancel(){var V;let j=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,C=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;this.running=!1,this.cancelled=!0,(V=this.gfx)==null||V.endDrawing(),M(I,S).delete(this._canvas),this.callback(j||new _display_utils.RenderingCancelledException(`Rendering cancelled, page ${this._pageIndex+1}`,C))}operatorListChanged(){var j;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(j=this.stepper)==null||j.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?window.requestAnimationFrame(()=>{this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),M(I,S).delete(this._canvas),this.callback())))}};S=new WeakMap,Ie(I,S,new WeakSet);let InternalRenderTask=I;const version="3.11.174";exports.version=version;const build="ce8716743";exports.build=build},(t,r,e)=>{var s=e(3),a=e(126),i=e(135);s({target:"Set",proto:!0,real:!0,forced:!i("difference")},{difference:a})},(t,r,e)=>{var s=e(127),a=e(128),i=e(129),o=e(132),c=e(133),x=e(130),u=e(131),h=a.has,_=a.remove;t.exports=function(b){var E=s(this),d=c(b),g=i(E);return o(E)<=d.size?x(E,function(y){d.includes(y)&&_(g,y)}):u(d.getIterator(),function(y){h(E,y)&&_(g,y)}),g}},(t,r,e)=>{var s=e(128).has;t.exports=function(a){return s(a),a}},(t,r,e)=>{var s=e(14),a=Set.prototype;t.exports={Set,add:s(a.add),has:s(a.has),remove:s(a.delete),proto:a}},(t,r,e)=>{var s=e(128),a=e(130),i=s.Set,o=s.add;t.exports=function(c){var x=new i;return a(c,function(u){o(x,u)}),x}},(t,r,e)=>{var s=e(14),a=e(131),i=e(128),o=i.Set,c=i.proto,x=s(c.forEach),u=s(c.keys),h=u(new o).next;t.exports=function(_,v,b){return b?a({iterator:u(_),next:h},v):x(_,v)}},(t,r,e)=>{var s=e(8);t.exports=function(a,i,o){for(var c=o?a:a.iterator,x=a.next,u,h;!(u=s(x,c)).done;)if(h=i(u.value),h!==void 0)return h}},(t,r,e)=>{var s=e(72),a=e(128);t.exports=s(a.proto,"size","get")||function(i){return i.size}},(t,r,e)=>{var s=e(31),a=e(47),i=e(8),o=e(62),c=e(134),x="Invalid size",u=RangeError,h=TypeError,_=Math.max,v=function(b,E,d,g){this.set=b,this.size=E,this.has=d,this.keys=g};v.prototype={getIterator:function(){return c(a(i(this.keys,this.set)))},includes:function(b){return i(this.has,this.set,b)}},t.exports=function(b){a(b);var E=+b.size;if(E!==E)throw h(x);var d=o(E);if(d<0)throw u(x);return new v(b,_(d,0),s(b.has),s(b.keys))}},t=>{t.exports=function(r){return{iterator:r,next:r.next,done:!1}}},(t,r,e)=>{var s=e(24),a=function(i){return{size:i,has:function(){return!1},keys:function(){return{next:function(){return{done:!0}}}}}};t.exports=function(i){var o=s("Set");try{new o()[i](a(0));try{return new o()[i](a(-1)),!1}catch{return!0}}catch{return!1}}},(t,r,e)=>{var s=e(3),a=e(7),i=e(137),o=e(135),c=!o("intersection")||a(function(){return Array.from(new Set([1,2,3]).intersection(new Set([3,2])))!=="3,2"});s({target:"Set",proto:!0,real:!0,forced:c},{intersection:i})},(t,r,e)=>{var s=e(127),a=e(128),i=e(132),o=e(133),c=e(130),x=e(131),u=a.Set,h=a.add,_=a.has;t.exports=function(b){var E=s(this),d=o(b),g=new u;return i(E)>d.size?x(d.getIterator(),function(y){_(E,y)&&h(g,y)}):c(E,function(y){d.includes(y)&&h(g,y)}),g}},(t,r,e)=>{var s=e(3),a=e(139),i=e(135);s({target:"Set",proto:!0,real:!0,forced:!i("isDisjointFrom")},{isDisjointFrom:a})},(t,r,e)=>{var s=e(127),a=e(128).has,i=e(132),o=e(133),c=e(130),x=e(131),u=e(140);t.exports=function(_){var v=s(this),b=o(_);if(i(v)<=b.size)return c(v,function(d){if(b.includes(d))return!1},!0)!==!1;var E=b.getIterator();return x(E,function(d){if(a(v,d))return u(E,"normal",!1)})!==!1}},(t,r,e)=>{var s=e(8),a=e(47),i=e(30);t.exports=function(o,c,x){var u,h;a(o);try{if(u=i(o,"return"),!u){if(c==="throw")throw x;return x}u=s(u,o)}catch(_){h=!0,u=_}if(c==="throw")throw x;if(h)throw u;return a(u),x}},(t,r,e)=>{var s=e(3),a=e(142),i=e(135);s({target:"Set",proto:!0,real:!0,forced:!i("isSubsetOf")},{isSubsetOf:a})},(t,r,e)=>{var s=e(127),a=e(132),i=e(130),o=e(133);t.exports=function(x){var u=s(this),h=o(x);return a(u)>h.size?!1:i(u,function(_){if(!h.includes(_))return!1},!0)!==!1}},(t,r,e)=>{var s=e(3),a=e(144),i=e(135);s({target:"Set",proto:!0,real:!0,forced:!i("isSupersetOf")},{isSupersetOf:a})},(t,r,e)=>{var s=e(127),a=e(128).has,i=e(132),o=e(133),c=e(131),x=e(140);t.exports=function(h){var _=s(this),v=o(h);if(i(_)<v.size)return!1;var b=v.getIterator();return c(b,function(E){if(!a(_,E))return x(b,"normal",!1)})!==!1}},(t,r,e)=>{var s=e(3),a=e(146),i=e(135);s({target:"Set",proto:!0,real:!0,forced:!i("symmetricDifference")},{symmetricDifference:a})},(t,r,e)=>{var s=e(127),a=e(128),i=e(129),o=e(133),c=e(131),x=a.add,u=a.has,h=a.remove;t.exports=function(v){var b=s(this),E=o(v).getIterator(),d=i(b);return c(E,function(g){u(b,g)?h(d,g):x(d,g)}),d}},(t,r,e)=>{var s=e(3),a=e(148),i=e(135);s({target:"Set",proto:!0,real:!0,forced:!i("union")},{union:a})},(t,r,e)=>{var s=e(127),a=e(128).add,i=e(129),o=e(133),c=e(131);t.exports=function(u){var h=s(this),_=o(u).getIterator(),v=i(h);return c(_,function(b){a(v,b)}),v}},(t,r,e)=>{var s=e(3),a=e(4),i=e(24),o=e(11),c=e(45).f,x=e(39),u=e(150),h=e(75),_=e(76),v=e(151),b=e(82),E=e(6),d=e(36),g="DOMException",y=i("Error"),R=i(g),P=function(){u(this,F);var he=arguments.length,re=_(he<1?void 0:arguments[0]),me=_(he<2?void 0:arguments[1],"Error"),te=new R(re,me),ce=y(re);return ce.name=g,c(te,"stack",o(1,b(ce.stack,1))),h(te,this,P),te},F=P.prototype=R.prototype,S="stack"in y(g),I="stack"in new R(1,2),w=R&&E&&Object.getOwnPropertyDescriptor(a,g),j=!!w&&!(w.writable&&w.configurable),C=S&&!j&&!I;s({global:!0,constructor:!0,forced:d||C},{DOMException:C?P:R});var V=i(g),O=V.prototype;if(O.constructor!==V){d||c(O,"constructor",o(1,V));for(var H in v)if(x(v,H)){var z=v[H],pe=z.s;x(V,pe)||c(V,pe,o(6,z.c))}}},(t,r,e)=>{var s=e(25),a=TypeError;t.exports=function(i,o){if(s(o,i))return i;throw a("Incorrect invocation")}},t=>{t.exports={IndexSizeError:{s:"INDEX_SIZE_ERR",c:1,m:1},DOMStringSizeError:{s:"DOMSTRING_SIZE_ERR",c:2,m:0},HierarchyRequestError:{s:"HIERARCHY_REQUEST_ERR",c:3,m:1},WrongDocumentError:{s:"WRONG_DOCUMENT_ERR",c:4,m:1},InvalidCharacterError:{s:"INVALID_CHARACTER_ERR",c:5,m:1},NoDataAllowedError:{s:"NO_DATA_ALLOWED_ERR",c:6,m:0},NoModificationAllowedError:{s:"NO_MODIFICATION_ALLOWED_ERR",c:7,m:1},NotFoundError:{s:"NOT_FOUND_ERR",c:8,m:1},NotSupportedError:{s:"NOT_SUPPORTED_ERR",c:9,m:1},InUseAttributeError:{s:"INUSE_ATTRIBUTE_ERR",c:10,m:1},InvalidStateError:{s:"INVALID_STATE_ERR",c:11,m:1},SyntaxError:{s:"SYNTAX_ERR",c:12,m:1},InvalidModificationError:{s:"INVALID_MODIFICATION_ERR",c:13,m:1},NamespaceError:{s:"NAMESPACE_ERR",c:14,m:1},InvalidAccessError:{s:"INVALID_ACCESS_ERR",c:15,m:1},ValidationError:{s:"VALIDATION_ERR",c:16,m:0},TypeMismatchError:{s:"TYPE_MISMATCH_ERR",c:17,m:1},SecurityError:{s:"SECURITY_ERR",c:18,m:1},NetworkError:{s:"NETWORK_ERR",c:19,m:1},AbortError:{s:"ABORT_ERR",c:20,m:1},URLMismatchError:{s:"URL_MISMATCH_ERR",c:21,m:1},QuotaExceededError:{s:"QUOTA_EXCEEDED_ERR",c:22,m:1},TimeoutError:{s:"TIMEOUT_ERR",c:23,m:1},InvalidNodeTypeError:{s:"INVALID_NODE_TYPE_ERR",c:24,m:1},DataCloneError:{s:"DATA_CLONE_ERR",c:25,m:1}}},(t,r,e)=>{var s=e(36),a=e(3),i=e(4),o=e(24),c=e(14),x=e(7),u=e(41),h=e(21),_=e(153),v=e(17),b=e(20),E=e(23),d=e(154),g=e(47),y=e(78),R=e(39),P=e(159),F=e(44),S=e(64),I=e(85),w=e(160),j=e(162),C=e(128),V=e(83),O=e(119),H=i.Object,z=i.Array,pe=i.Date,ee=i.Error,he=i.EvalError,re=i.RangeError,me=i.ReferenceError,te=i.SyntaxError,ce=i.TypeError,ye=i.URIError,L=i.PerformanceMark,N=i.WebAssembly,T=N&&N.CompileError||ee,A=N&&N.LinkError||ee,D=N&&N.RuntimeError||ee,B=o("DOMException"),U=j.Map,Y=j.has,G=j.get,fe=j.set,xe=C.Set,Se=C.add,Ce=o("Object","keys"),Me=c([].push),be=c((!0).valueOf),ae=c(1 .valueOf),J=c("".valueOf),oe=c(pe.prototype.getTime),Q=u("structuredClone"),ge="DataCloneError",Te="Transferring",Le=function(K){return!x(function(){var _e=new i.Set([7]),We=K(_e),Ke=K(H(7));return We===_e||!We.has(7)||typeof Ke!="object"||+Ke!=7})&&K},Re=function(K,_e){return!x(function(){var We=new _e,Ke=K({a:We,b:We});return!(Ke&&Ke.a===Ke.b&&Ke.a instanceof _e&&Ke.a.stack===We.stack)})},Ee=function(K){return!x(function(){var _e=K(new i.AggregateError([1],Q,{cause:3}));return _e.name!=="AggregateError"||_e.errors[0]!==1||_e.message!==Q||_e.cause!==3})},ze=i.structuredClone,Xe=s||!Re(ze,ee)||!Re(ze,B)||!Ee(ze),tt=!ze&&Le(function(K){return new L(Q,{detail:K}).detail}),qe=Le(ze)||tt,dt=function(K){throw new B("Uncloneable type: "+K,ge)},Ze=function(K,_e){throw new B((_e||"Cloning")+" of "+K+" cannot be properly polyfilled in this engine",ge)},nt=function(K,_e){return qe||Ze(_e),qe(K)},ht=function(){var K;try{K=new i.DataTransfer}catch{try{K=new i.ClipboardEvent("").clipboardData}catch{}}return K&&K.items&&K.files?K:null},ft=function(K,_e,We){if(Y(_e,K))return G(_e,K);var Ke=We||y(K),Ye,$e,ne,se,ve,we;if(Ke==="SharedArrayBuffer")qe?Ye=qe(K):Ye=K;else{var Fe=i.DataView;!Fe&&typeof K.slice!="function"&&Ze("ArrayBuffer");try{if(typeof K.slice=="function"&&!K.resizable)Ye=K.slice(0);else for($e=K.byteLength,ne=("maxByteLength"in K)?{maxByteLength:K.maxByteLength}:void 0,Ye=new ArrayBuffer($e,ne),se=new Fe(K),ve=new Fe(Ye),we=0;we<$e;we++)ve.setUint8(we,se.getUint8(we))}catch{throw new B("ArrayBuffer is detached",ge)}}return fe(_e,K,Ye),Ye},pt=function(K,_e,We,Ke,Ye){var $e=i[_e];return b($e)||Ze(_e),new $e(ft(K.buffer,Ye),We,Ke)},Ge=function(K,_e,We){this.object=K,this.type=_e,this.metadata=We},Ne=function(K,_e,We){if(E(K)&&dt("Symbol"),!b(K))return K;if(_e){if(Y(_e,K))return G(_e,K)}else _e=new U;var Ke=y(K),Ye,$e,ne,se,ve,we,Fe,He;switch(Ke){case"Array":ne=z(S(K));break;case"Object":ne={};break;case"Map":ne=new U;break;case"Set":ne=new xe;break;case"RegExp":ne=new RegExp(K.source,w(K));break;case"Error":switch($e=K.name,$e){case"AggregateError":ne=o("AggregateError")([]);break;case"EvalError":ne=he();break;case"RangeError":ne=re();break;case"ReferenceError":ne=me();break;case"SyntaxError":ne=te();break;case"TypeError":ne=ce();break;case"URIError":ne=ye();break;case"CompileError":ne=T();break;case"LinkError":ne=A();break;case"RuntimeError":ne=D();break;default:ne=ee()}break;case"DOMException":ne=new B(K.message,K.name);break;case"ArrayBuffer":case"SharedArrayBuffer":ne=We?new Ge(K,Ke):ft(K,_e,Ke);break;case"DataView":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float16Array":case"Float32Array":case"Float64Array":case"BigInt64Array":case"BigUint64Array":we=Ke==="DataView"?K.byteLength:K.length,ne=We?new Ge(K,Ke,{offset:K.byteOffset,length:we}):pt(K,Ke,K.byteOffset,we,_e);break;case"DOMQuad":try{ne=new DOMQuad(Ne(K.p1,_e,We),Ne(K.p2,_e,We),Ne(K.p3,_e,We),Ne(K.p4,_e,We))}catch{ne=nt(K,Ke)}break;case"File":if(qe)try{ne=qe(K),y(ne)!==Ke&&(ne=void 0)}catch{}if(!ne)try{ne=new File([K],K.name,K)}catch{}ne||Ze(Ke);break;case"FileList":if(se=ht(),se){for(ve=0,we=S(K);ve<we;ve++)se.items.add(Ne(K[ve],_e,We));ne=se.files}else ne=nt(K,Ke);break;case"ImageData":try{ne=new ImageData(Ne(K.data,_e,We),K.width,K.height,{colorSpace:K.colorSpace})}catch{ne=nt(K,Ke)}break;default:if(qe)ne=qe(K);else switch(Ke){case"BigInt":ne=H(K.valueOf());break;case"Boolean":ne=H(be(K));break;case"Number":ne=H(ae(K));break;case"String":ne=H(J(K));break;case"Date":ne=new pe(oe(K));break;case"Blob":try{ne=K.slice(0,K.size,K.type)}catch{Ze(Ke)}break;case"DOMPoint":case"DOMPointReadOnly":Ye=i[Ke];try{ne=Ye.fromPoint?Ye.fromPoint(K):new Ye(K.x,K.y,K.z,K.w)}catch{Ze(Ke)}break;case"DOMRect":case"DOMRectReadOnly":Ye=i[Ke];try{ne=Ye.fromRect?Ye.fromRect(K):new Ye(K.x,K.y,K.width,K.height)}catch{Ze(Ke)}break;case"DOMMatrix":case"DOMMatrixReadOnly":Ye=i[Ke];try{ne=Ye.fromMatrix?Ye.fromMatrix(K):new Ye(K)}catch{Ze(Ke)}break;case"AudioData":case"VideoFrame":h(K.clone)||Ze(Ke);try{ne=K.clone()}catch{dt(Ke)}break;case"CropTarget":case"CryptoKey":case"FileSystemDirectoryHandle":case"FileSystemFileHandle":case"FileSystemHandle":case"GPUCompilationInfo":case"GPUCompilationMessage":case"ImageBitmap":case"RTCCertificate":case"WebAssembly.Module":Ze(Ke);default:dt(Ke)}}switch(fe(_e,K,ne),Ke){case"Array":case"Object":for(Fe=Ce(K),ve=0,we=S(Fe);ve<we;ve++)He=Fe[ve],P(ne,He,Ne(K[He],_e,We));break;case"Map":K.forEach(function(Ue,at){fe(ne,Ne(at,_e,We),Ne(Ue,_e,We))});break;case"Set":K.forEach(function(Ue){Se(ne,Ne(Ue,_e,We))});break;case"Error":F(ne,"message",Ne(K.message,_e,We)),R(K,"cause")&&F(ne,"cause",Ne(K.cause,_e,We)),$e==="AggregateError"&&(ne.errors=Ne(K.errors,_e,We));case"DOMException":V&&F(ne,"stack",Ne(K.stack,_e,We))}return ne},je=function(K,_e){if(!b(K))return K;if(Y(_e,K))return G(_e,K);var We,Ke,Ye,$e,ne,se,ve,we;if(K instanceof Ge)switch(We=K.type,Ke=K.object,We){case"ArrayBuffer":case"SharedArrayBuffer":we=ft(Ke,_e,We);break;case"DataView":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float16Array":case"Float32Array":case"Float64Array":case"BigInt64Array":case"BigUint64Array":Ye=K.metadata,we=pt(Ke,We,Ye.offset,Ye.length,_e)}else switch(y(K)){case"Array":case"Object":for(se=Ce(K),$e=0,ne=S(se);$e<ne;$e++)ve=se[$e],K[ve]=je(K[ve],_e);break;case"Map":we=new U,K.forEach(function(Fe,He){fe(we,je(He,_e),je(Fe,_e))});break;case"Set":we=new xe,K.forEach(function(Fe){Se(we,je(Fe,_e))});break;case"Error":K.message=je(K.message,_e),R(K,"cause")&&(K.cause=je(K.cause,_e)),K.name==="AggregateError"&&(K.errors=je(K.errors,_e));case"DOMException":V&&(K.stack=je(K.stack,_e))}return fe(_e,K,we||K),we||K},st=function(K,_e){if(!b(K))throw ce("Transfer option cannot be converted to a sequence");var We=[];d(K,function(Ue){Me(We,g(Ue))});for(var Ke=0,Ye=S(We),$e=[],ne,se,ve,we,Fe,He;Ke<Ye;){if(ne=We[Ke++],se=y(ne),se==="ArrayBuffer"){Me($e,ne);continue}if(Y(_e,ne))throw new B("Duplicate transferable",ge);if(O)we=ze(ne,{transfer:[ne]});else switch(se){case"ImageBitmap":ve=i.OffscreenCanvas,_(ve)||Ze(se,Te);try{Fe=new ve(ne.width,ne.height),He=Fe.getContext("bitmaprenderer"),He.transferFromImageBitmap(ne),we=Fe.transferToImageBitmap()}catch{}break;case"AudioData":case"VideoFrame":(!h(ne.clone)||!h(ne.close))&&Ze(se,Te);try{we=ne.clone(),ne.close()}catch{}break;case"MediaSourceHandle":case"MessagePort":case"OffscreenCanvas":case"ReadableStream":case"TransformStream":case"WritableStream":Ze(se,Te)}if(we===void 0)throw new B("This object cannot be transferred: "+se,ge);fe(_e,ne,we)}return $e},ct=function(K,_e){for(var We=0,Ke=S(K),Ye,$e;We<Ke;){if(Ye=K[We++],Y(_e,Ye))throw new B("Duplicate transferable",ge);O?$e=ze(Ye,{transfer:[Ye]}):(h(Ye.transfer)||Ze("ArrayBuffer",Te),$e=Ye.transfer()),fe(_e,Ye,$e)}};a({global:!0,enumerable:!0,sham:!O,forced:Xe},{structuredClone:function(_e){var We=I(arguments.length,1)>1&&!v(arguments[1])?g(arguments[1]):void 0,Ke=We?We.transfer:void 0,Ye=!1,$e,ne;Ke!==void 0&&($e=new U,ne=st(Ke,$e),Ye=!!S(ne));var se=Ne(_e,$e,Ye);return Ye&&($e=new U,ct(Ke,$e),se=je(se,$e)),se}})},(t,r,e)=>{var s=e(14),a=e(7),i=e(21),o=e(78),c=e(24),x=e(51),u=function(){},h=[],_=c("Reflect","construct"),v=/^\s*(?:class|function)\b/,b=s(v.exec),E=!v.exec(u),d=function(R){if(!i(R))return!1;try{return _(u,h,R),!0}catch{return!1}},g=function(R){if(!i(R))return!1;switch(o(R)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return E||!!b(v,x(R))}catch{return!0}};g.sham=!0,t.exports=!_||a(function(){var y;return d(d.call)||!d(Object)||!d(function(){y=!0})||y})?g:d},(t,r,e)=>{var s=e(99),a=e(8),i=e(47),o=e(32),c=e(155),x=e(64),u=e(25),h=e(157),_=e(158),v=e(140),b=TypeError,E=function(g,y){this.stopped=g,this.result=y},d=E.prototype;t.exports=function(g,y,R){var P=R&&R.that,F=!!(R&&R.AS_ENTRIES),S=!!(R&&R.IS_RECORD),I=!!(R&&R.IS_ITERATOR),w=!!(R&&R.INTERRUPTED),j=s(y,P),C,V,O,H,z,pe,ee,he=function(me){return C&&v(C,"normal",me),new E(!0,me)},re=function(me){return F?(i(me),w?j(me[0],me[1],he):j(me[0],me[1])):w?j(me,he):j(me)};if(S)C=g.iterator;else if(I)C=g;else{if(V=_(g),!V)throw b(o(g)+" is not iterable");if(c(V)){for(O=0,H=x(g);H>O;O++)if(z=re(g[O]),z&&u(d,z))return z;return new E(!1)}C=h(g,V)}for(pe=S?g.next:C.next;!(ee=a(pe,C)).done;){try{z=re(ee.value)}catch(me){v(C,"throw",me)}if(typeof z=="object"&&z&&u(d,z))return z}return new E(!1)}},(t,r,e)=>{var s=e(34),a=e(156),i=s("iterator"),o=Array.prototype;t.exports=function(c){return c!==void 0&&(a.Array===c||o[i]===c)}},t=>{t.exports={}},(t,r,e)=>{var s=e(8),a=e(31),i=e(47),o=e(32),c=e(158),x=TypeError;t.exports=function(u,h){var _=arguments.length<2?c(u):h;if(a(_))return i(s(_,u));throw x(o(u)+" is not iterable")}},(t,r,e)=>{var s=e(78),a=e(30),i=e(17),o=e(156),c=e(34),x=c("iterator");t.exports=function(u){if(!i(u))return a(u,x)||a(u,"@@iterator")||o[s(u)]}},(t,r,e)=>{var s=e(18),a=e(45),i=e(11);t.exports=function(o,c,x){var u=s(c);u in o?a.f(o,u,i(0,x)):o[u]=x}},(t,r,e)=>{var s=e(8),a=e(39),i=e(25),o=e(161),c=RegExp.prototype;t.exports=function(x){var u=x.flags;return u===void 0&&!("flags"in c)&&!a(x,"flags")&&i(c,x)?s(o,x):u}},(t,r,e)=>{var s=e(47);t.exports=function(){var a=s(this),i="";return a.hasIndices&&(i+="d"),a.global&&(i+="g"),a.ignoreCase&&(i+="i"),a.multiline&&(i+="m"),a.dotAll&&(i+="s"),a.unicode&&(i+="u"),a.unicodeSets&&(i+="v"),a.sticky&&(i+="y"),i}},(t,r,e)=>{var s=e(14),a=Map.prototype;t.exports={Map,set:s(a.set),get:s(a.get),has:s(a.has),remove:s(a.delete),proto:a}},(t,r,e)=>{var u,h,_,xs,b;Object.defineProperty(r,"__esModule",{value:!0}),r.SerializableEmpty=r.PrintAnnotationStorage=r.AnnotationStorage=void 0,e(89),e(149),e(152);var s=e(1),a=e(164),i=e(170);const o=Object.freeze({map:null,hash:"",transfers:void 0});r.SerializableEmpty=o;class c{constructor(){Ie(this,_);Ie(this,u,!1);Ie(this,h,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(d,g){const y=M(this,h).get(d);return y===void 0?g:Object.assign(g,y)}getRawValue(d){return M(this,h).get(d)}remove(d){if(M(this,h).delete(d),M(this,h).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const g of M(this,h).values())if(g instanceof a.AnnotationEditor)return;this.onAnnotationEditor(null)}}setValue(d,g){const y=M(this,h).get(d);let R=!1;if(y!==void 0)for(const[P,F]of Object.entries(g))y[P]!==F&&(R=!0,y[P]=F);else R=!0,M(this,h).set(d,g);R&&Ae(this,_,xs).call(this),g instanceof a.AnnotationEditor&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(g.constructor._type)}has(d){return M(this,h).has(d)}getAll(){return M(this,h).size>0?(0,s.objectFromMap)(M(this,h)):null}setAll(d){for(const[g,y]of Object.entries(d))this.setValue(g,y)}get size(){return M(this,h).size}resetModified(){M(this,u)&&(ke(this,u,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new x(this)}get serializable(){if(M(this,h).size===0)return o;const d=new Map,g=new i.MurmurHash3_64,y=[],R=Object.create(null);let P=!1;for(const[F,S]of M(this,h)){const I=S instanceof a.AnnotationEditor?S.serialize(!1,R):S;I&&(d.set(F,I),g.update(`${F}:${JSON.stringify(I)}`),P||(P=!!I.bitmap))}if(P)for(const F of d.values())F.bitmap&&y.push(F.bitmap);return d.size>0?{map:d,hash:g.hexdigest(),transfers:y}:o}}u=new WeakMap,h=new WeakMap,_=new WeakSet,xs=function(){M(this,u)||(ke(this,u,!0),typeof this.onSetModified=="function"&&this.onSetModified())},r.AnnotationStorage=c;class x extends c{constructor(g){super();Ie(this,b);const{map:y,hash:R,transfers:P}=g.serializable,F=structuredClone(y,null);ke(this,b,{map:F,hash:R,transfers:P})}get print(){(0,s.unreachable)("Should not call PrintAnnotationStorage.print")}get serializable(){return M(this,b)}}b=new WeakMap,r.PrintAnnotationStorage=x},(t,r,e)=>{var x,u,h,_,v,b,E,d,g,y,R,P,F,S,I,Ir,kr,C,Or,Mr,gs,vs,Es,Dr,bs;Object.defineProperty(r,"__esModule",{value:!0}),r.AnnotationEditor=void 0,e(89),e(2);var s=e(165),a=e(1),i=e(168);const re=class re{constructor(te){Ie(this,I);Ie(this,x,"");Ie(this,u,!1);Ie(this,h,null);Ie(this,_,null);Ie(this,v,null);Ie(this,b,!1);Ie(this,E,null);Ie(this,d,this.focusin.bind(this));Ie(this,g,this.focusout.bind(this));Ie(this,y,!1);Ie(this,R,!1);Ie(this,P,!1);wt(this,"_initialOptions",Object.create(null));wt(this,"_uiManager",null);wt(this,"_focusEventsAllowed",!0);wt(this,"_l10nPromise",null);Ie(this,F,!1);Ie(this,S,re._zIndex++);this.constructor===re&&(0,a.unreachable)("Cannot initialize AnnotationEditor."),this.parent=te.parent,this.id=te.id,this.width=this.height=null,this.pageIndex=te.parent.pageIndex,this.name=te.name,this.div=null,this._uiManager=te.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=te.isCentered,this._structTreeParentId=null;const{rotation:ce,rawDims:{pageWidth:ye,pageHeight:L,pageX:N,pageY:T}}=this.parent.viewport;this.rotation=ce,this.pageRotation=(360+ce-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[ye,L],this.pageTranslation=[N,T];const[A,D]=this.parentDimensions;this.x=te.x/A,this.y=te.y/D,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get _defaultLineColor(){return(0,a.shadow)(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(te){const ce=new c({id:te.parent.getNextId(),parent:te.parent,uiManager:te._uiManager});ce.annotationElementId=te.annotationElementId,ce.deleted=!0,ce._uiManager.addToAnnotationStorage(ce)}static initialize(te){let ce=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(re._l10nPromise||(re._l10nPromise=new Map(["editor_alt_text_button_label","editor_alt_text_edit_button_label","editor_alt_text_decorative_tooltip"].map(L=>[L,te.get(L)]))),ce!=null&&ce.strings)for(const L of ce.strings)re._l10nPromise.set(L,te.get(L));if(re._borderLineWidth!==-1)return;const ye=getComputedStyle(document.documentElement);re._borderLineWidth=parseFloat(ye.getPropertyValue("--outline-width"))||0}static updateDefaultParams(te,ce){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(te){return!1}static paste(te,ce){(0,a.unreachable)("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return M(this,F)}set _isDraggable(te){var ce;ke(this,F,te),(ce=this.div)==null||ce.classList.toggle("draggable",te)}center(){const[te,ce]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*ce/(te*2),this.y+=this.width*te/(ce*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*ce/(te*2),this.y-=this.width*te/(ce*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(te){this._uiManager.addCommands(te)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=M(this,S)}setParent(te){te!==null&&(this.pageIndex=te.pageIndex,this.pageDimensions=te.pageDimensions),this.parent=te}focusin(te){this._focusEventsAllowed&&(M(this,y)?ke(this,y,!1):this.parent.setSelected(this))}focusout(te){var ye;if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;const ce=te.relatedTarget;ce!=null&&ce.closest(`#${this.id}`)||(te.preventDefault(),(ye=this.parent)!=null&&ye.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(te,ce,ye,L){const[N,T]=this.parentDimensions;[ye,L]=this.screenToPageTranslation(ye,L),this.x=(te+ye)/N,this.y=(ce+L)/T,this.fixAndSetPosition()}translate(te,ce){Ae(this,I,Ir).call(this,this.parentDimensions,te,ce)}translateInPage(te,ce){Ae(this,I,Ir).call(this,this.pageDimensions,te,ce),this.div.scrollIntoView({block:"nearest"})}drag(te,ce){const[ye,L]=this.parentDimensions;if(this.x+=te/ye,this.y+=ce/L,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:B,y:U}=this.div.getBoundingClientRect();this.parent.findNewParent(this,B,U)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:N,y:T}=this;const[A,D]=Ae(this,I,kr).call(this);N+=A,T+=D,this.div.style.left=`${(100*N).toFixed(2)}%`,this.div.style.top=`${(100*T).toFixed(2)}%`,this.div.scrollIntoView({block:"nearest"})}fixAndSetPosition(){const[te,ce]=this.pageDimensions;let{x:ye,y:L,width:N,height:T}=this;switch(N*=te,T*=ce,ye*=te,L*=ce,this.rotation){case 0:ye=Math.max(0,Math.min(te-N,ye)),L=Math.max(0,Math.min(ce-T,L));break;case 90:ye=Math.max(0,Math.min(te-T,ye)),L=Math.min(ce,Math.max(N,L));break;case 180:ye=Math.min(te,Math.max(N,ye)),L=Math.min(ce,Math.max(T,L));break;case 270:ye=Math.min(te,Math.max(T,ye)),L=Math.max(0,Math.min(ce-N,L));break}this.x=ye/=te,this.y=L/=ce;const[A,D]=Ae(this,I,kr).call(this);ye+=A,L+=D;const{style:B}=this.div;B.left=`${(100*ye).toFixed(2)}%`,B.top=`${(100*L).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(te,ce){var ye;return Ae(ye=re,C,Or).call(ye,te,ce,this.parentRotation)}pageTranslationToScreen(te,ce){var ye;return Ae(ye=re,C,Or).call(ye,te,ce,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:te,pageDimensions:[ce,ye]}=this,L=ce*te,N=ye*te;return a.FeatureTest.isCSSRoundSupported?[Math.round(L),Math.round(N)]:[L,N]}setDims(te,ce){var N;const[ye,L]=this.parentDimensions;this.div.style.width=`${(100*te/ye).toFixed(2)}%`,M(this,b)||(this.div.style.height=`${(100*ce/L).toFixed(2)}%`),(N=M(this,h))==null||N.classList.toggle("small",te<re.SMALL_EDITOR_SIZE||ce<re.SMALL_EDITOR_SIZE)}fixDims(){const{style:te}=this.div,{height:ce,width:ye}=te,L=ye.endsWith("%"),N=!M(this,b)&&ce.endsWith("%");if(L&&N)return;const[T,A]=this.parentDimensions;L||(te.width=`${(100*parseFloat(ye)/T).toFixed(2)}%`),!M(this,b)&&!N&&(te.height=`${(100*parseFloat(ce)/A).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}async addAltTextButton(){if(M(this,h))return;const te=ke(this,h,document.createElement("button"));te.className="altText";const ce=await re._l10nPromise.get("editor_alt_text_button_label");te.textContent=ce,te.setAttribute("aria-label",ce),te.tabIndex="0",te.addEventListener("contextmenu",i.noContextMenu),te.addEventListener("pointerdown",ye=>ye.stopPropagation()),te.addEventListener("click",ye=>{ye.preventDefault(),this._uiManager.editAltText(this)},{capture:!0}),te.addEventListener("keydown",ye=>{ye.target===te&&ye.key==="Enter"&&(ye.preventDefault(),this._uiManager.editAltText(this))}),Ae(this,I,Dr).call(this),this.div.append(te),re.SMALL_EDITOR_SIZE||(re.SMALL_EDITOR_SIZE=Math.min(128,Math.round(te.getBoundingClientRect().width*1.4)))}getClientDimensions(){return this.div.getBoundingClientRect()}get altTextData(){return{altText:M(this,x),decorative:M(this,u)}}set altTextData(te){let{altText:ce,decorative:ye}=te;M(this,x)===ce&&M(this,u)===ye||(ke(this,x,ce),ke(this,u,ye),Ae(this,I,Dr).call(this))}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.setAttribute("tabIndex",0),this.setInForeground(),this.div.addEventListener("focusin",M(this,d)),this.div.addEventListener("focusout",M(this,g));const[te,ce]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*ce/te).toFixed(2)}%`,this.div.style.maxHeight=`${(100*te/ce).toFixed(2)}%`);const[ye,L]=this.getInitialTranslation();return this.translate(ye,L),(0,s.bindEvents)(this,this.div,["pointerdown"]),this.div}pointerdown(te){const{isMac:ce}=a.FeatureTest.platform;if(te.button!==0||te.ctrlKey&&ce){te.preventDefault();return}ke(this,y,!0),Ae(this,I,bs).call(this,te)}moveInDOM(){var te;(te=this.parent)==null||te.moveEditorInDOM(this)}_setParentAndPosition(te,ce,ye){te.changeParent(this),this.x=ce,this.y=ye,this.fixAndSetPosition()}getRect(te,ce){const ye=this.parentScale,[L,N]=this.pageDimensions,[T,A]=this.pageTranslation,D=te/ye,B=ce/ye,U=this.x*L,Y=this.y*N,G=this.width*L,fe=this.height*N;switch(this.rotation){case 0:return[U+D+T,N-Y-B-fe+A,U+D+G+T,N-Y-B+A];case 90:return[U+B+T,N-Y+D+A,U+B+fe+T,N-Y+D+G+A];case 180:return[U-D-G+T,N-Y+B+A,U-D+T,N-Y+B+fe+A];case 270:return[U-B-fe+T,N-Y-D-G+A,U-B+T,N-Y-D+A];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(te,ce){const[ye,L,N,T]=te,A=N-ye,D=T-L;switch(this.rotation){case 0:return[ye,ce-T,A,D];case 90:return[ye,ce-L,D,A];case 180:return[N,ce-L,A,D];case 270:return[N,ce-T,D,A];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){ke(this,P,!0)}disableEditMode(){ke(this,P,!1)}isInEditMode(){return M(this,P)}shouldGetKeyboardEvents(){return!1}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}rebuild(){var te,ce;(te=this.div)==null||te.addEventListener("focusin",M(this,d)),(ce=this.div)==null||ce.addEventListener("focusout",M(this,g))}serialize(){(0,a.unreachable)("An editor must be serializable")}static deserialize(te,ce,ye){const L=new this.prototype.constructor({parent:ce,id:ce.getNextId(),uiManager:ye});L.rotation=te.rotation;const[N,T]=L.pageDimensions,[A,D,B,U]=L.getRectInCurrentCoords(te.rect,T);return L.x=A/N,L.y=D/T,L.width=B/N,L.height=U/T,L}remove(){var te;this.div.removeEventListener("focusin",M(this,d)),this.div.removeEventListener("focusout",M(this,g)),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),(te=M(this,h))==null||te.remove(),ke(this,h,null),ke(this,_,null)}get isResizable(){return!1}makeResizable(){this.isResizable&&(Ae(this,I,gs).call(this),M(this,E).classList.remove("hidden"))}select(){var te;this.makeResizable(),(te=this.div)==null||te.classList.add("selectedEditor")}unselect(){var te,ce,ye;(te=M(this,E))==null||te.classList.add("hidden"),(ce=this.div)==null||ce.classList.remove("selectedEditor"),(ye=this.div)!=null&&ye.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus()}updateParams(te,ce){}disableEditing(){M(this,h)&&(M(this,h).hidden=!0)}enableEditing(){M(this,h)&&(M(this,h).hidden=!1)}enterInEditMode(){}get contentDiv(){return this.div}get isEditing(){return M(this,R)}set isEditing(te){ke(this,R,te),this.parent&&(te?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(te,ce){ke(this,b,!0);const ye=te/ce,{style:L}=this.div;L.aspectRatio=ye,L.height="auto"}static get MIN_SIZE(){return 16}};x=new WeakMap,u=new WeakMap,h=new WeakMap,_=new WeakMap,v=new WeakMap,b=new WeakMap,E=new WeakMap,d=new WeakMap,g=new WeakMap,y=new WeakMap,R=new WeakMap,P=new WeakMap,F=new WeakMap,S=new WeakMap,I=new WeakSet,Ir=function(te,ce,ye){let[L,N]=te;[ce,ye]=this.screenToPageTranslation(ce,ye),this.x+=ce/L,this.y+=ye/N,this.fixAndSetPosition()},kr=function(){const[te,ce]=this.parentDimensions,{_borderLineWidth:ye}=re,L=ye/te,N=ye/ce;switch(this.rotation){case 90:return[-L,N];case 180:return[L,N];case 270:return[L,-N];default:return[-L,-N]}},C=new WeakSet,Or=function(te,ce,ye){switch(ye){case 90:return[ce,-te];case 180:return[-te,-ce];case 270:return[-ce,te];default:return[te,ce]}},Mr=function(te){switch(te){case 90:{const[ce,ye]=this.pageDimensions;return[0,-ce/ye,ye/ce,0]}case 180:return[-1,0,0,-1];case 270:{const[ce,ye]=this.pageDimensions;return[0,ce/ye,-ye/ce,0]}default:return[1,0,0,1]}},gs=function(){if(M(this,E))return;ke(this,E,document.createElement("div")),M(this,E).classList.add("resizers");const te=["topLeft","topRight","bottomRight","bottomLeft"];this._willKeepAspectRatio||te.push("topMiddle","middleRight","bottomMiddle","middleLeft");for(const ce of te){const ye=document.createElement("div");M(this,E).append(ye),ye.classList.add("resizer",ce),ye.addEventListener("pointerdown",Ae(this,I,vs).bind(this,ce)),ye.addEventListener("contextmenu",i.noContextMenu)}this.div.prepend(M(this,E))},vs=function(te,ce){ce.preventDefault();const{isMac:ye}=a.FeatureTest.platform;if(ce.button!==0||ce.ctrlKey&&ye)return;const L=Ae(this,I,Es).bind(this,te),N=this._isDraggable;this._isDraggable=!1;const T={passive:!0,capture:!0};window.addEventListener("pointermove",L,T);const A=this.x,D=this.y,B=this.width,U=this.height,Y=this.parent.div.style.cursor,G=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(ce.target).cursor;const fe=()=>{this._isDraggable=N,window.removeEventListener("pointerup",fe),window.removeEventListener("blur",fe),window.removeEventListener("pointermove",L,T),this.parent.div.style.cursor=Y,this.div.style.cursor=G;const xe=this.x,Se=this.y,Ce=this.width,Me=this.height;xe===A&&Se===D&&Ce===B&&Me===U||this.addCommands({cmd:()=>{this.width=Ce,this.height=Me,this.x=xe,this.y=Se;const[be,ae]=this.parentDimensions;this.setDims(be*Ce,ae*Me),this.fixAndSetPosition()},undo:()=>{this.width=B,this.height=U,this.x=A,this.y=D;const[be,ae]=this.parentDimensions;this.setDims(be*B,ae*U),this.fixAndSetPosition()},mustExec:!0})};window.addEventListener("pointerup",fe),window.addEventListener("blur",fe)},Es=function(te,ce){const[ye,L]=this.parentDimensions,N=this.x,T=this.y,A=this.width,D=this.height,B=re.MIN_SIZE/ye,U=re.MIN_SIZE/L,Y=Ze=>Math.round(Ze*1e4)/1e4,G=Ae(this,I,Mr).call(this,this.rotation),fe=(Ze,nt)=>[G[0]*Ze+G[2]*nt,G[1]*Ze+G[3]*nt],xe=Ae(this,I,Mr).call(this,360-this.rotation),Se=(Ze,nt)=>[xe[0]*Ze+xe[2]*nt,xe[1]*Ze+xe[3]*nt];let Ce,Me,be=!1,ae=!1;switch(te){case"topLeft":be=!0,Ce=(Ze,nt)=>[0,0],Me=(Ze,nt)=>[Ze,nt];break;case"topMiddle":Ce=(Ze,nt)=>[Ze/2,0],Me=(Ze,nt)=>[Ze/2,nt];break;case"topRight":be=!0,Ce=(Ze,nt)=>[Ze,0],Me=(Ze,nt)=>[0,nt];break;case"middleRight":ae=!0,Ce=(Ze,nt)=>[Ze,nt/2],Me=(Ze,nt)=>[0,nt/2];break;case"bottomRight":be=!0,Ce=(Ze,nt)=>[Ze,nt],Me=(Ze,nt)=>[0,0];break;case"bottomMiddle":Ce=(Ze,nt)=>[Ze/2,nt],Me=(Ze,nt)=>[Ze/2,0];break;case"bottomLeft":be=!0,Ce=(Ze,nt)=>[0,nt],Me=(Ze,nt)=>[Ze,0];break;case"middleLeft":ae=!0,Ce=(Ze,nt)=>[0,nt/2],Me=(Ze,nt)=>[Ze,nt/2];break}const J=Ce(A,D),oe=Me(A,D);let Q=fe(...oe);const ge=Y(N+Q[0]),Te=Y(T+Q[1]);let Le=1,Re=1,[Ee,ze]=this.screenToPageTranslation(ce.movementX,ce.movementY);if([Ee,ze]=Se(Ee/ye,ze/L),be){const Ze=Math.hypot(A,D);Le=Re=Math.max(Math.min(Math.hypot(oe[0]-J[0]-Ee,oe[1]-J[1]-ze)/Ze,1/A,1/D),B/A,U/D)}else ae?Le=Math.max(B,Math.min(1,Math.abs(oe[0]-J[0]-Ee)))/A:Re=Math.max(U,Math.min(1,Math.abs(oe[1]-J[1]-ze)))/D;const Xe=Y(A*Le),tt=Y(D*Re);Q=fe(...Me(Xe,tt));const qe=ge-Q[0],dt=Te-Q[1];this.width=Xe,this.height=tt,this.x=qe,this.y=dt,this.setDims(ye*Xe,L*tt),this.fixAndSetPosition()},Dr=async function(){var ye;const te=M(this,h);if(!te)return;if(!M(this,x)&&!M(this,u)){te.classList.remove("done"),(ye=M(this,_))==null||ye.remove();return}re._l10nPromise.get("editor_alt_text_edit_button_label").then(L=>{te.setAttribute("aria-label",L)});let ce=M(this,_);if(!ce){ke(this,_,ce=document.createElement("span")),ce.className="tooltip",ce.setAttribute("role","tooltip");const L=ce.id=`alt-text-tooltip-${this.id}`;te.setAttribute("aria-describedby",L);const N=100;te.addEventListener("mouseenter",()=>{ke(this,v,setTimeout(()=>{ke(this,v,null),M(this,_).classList.add("show"),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",subtype:this.editorType,data:{action:"alt_text_tooltip"}}})},N))}),te.addEventListener("mouseleave",()=>{var T;clearTimeout(M(this,v)),ke(this,v,null),(T=M(this,_))==null||T.classList.remove("show")})}te.classList.add("done"),ce.innerText=M(this,u)?await re._l10nPromise.get("editor_alt_text_decorative_tooltip"):M(this,x),ce.parentNode||te.append(ce)},bs=function(te){if(!this._isDraggable)return;const ce=this._uiManager.isSelected(this);this._uiManager.setUpDragSession();let ye,L;ce&&(ye={passive:!0,capture:!0},L=T=>{const[A,D]=this.screenToPageTranslation(T.movementX,T.movementY);this._uiManager.dragSelectedEditors(A,D)},window.addEventListener("pointermove",L,ye));const N=()=>{if(window.removeEventListener("pointerup",N),window.removeEventListener("blur",N),ce&&window.removeEventListener("pointermove",L,ye),ke(this,y,!1),!this._uiManager.endDragSession()){const{isMac:T}=a.FeatureTest.platform;te.ctrlKey&&!T||te.shiftKey||te.metaKey&&T?this.parent.toggleSelected(this):this.parent.setSelected(this)}};window.addEventListener("pointerup",N),window.addEventListener("blur",N)},Ie(re,C),wt(re,"_borderLineWidth",-1),wt(re,"_colorManager",new s.ColorManager),wt(re,"_zIndex",1),wt(re,"SMALL_EDITOR_SIZE",0);let o=re;r.AnnotationEditor=o;class c extends o{constructor(te){super(te),this.annotationElementId=te.annotationElementId,this.deleted=!0}serialize(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex}}}},(t,r,e)=>{var b,E,d,g,y,Lr,F,S,I,w,j,ys,O,H,z,pe,ee,he,re,me,te,ce,ye,L,N,T,A,D,B,U,Y,G,fe,xe,Se,Ce,Me,be,ae,J,oe,Q,ge,Te,Le,Re,Ee,_s,Br,Ur,Er,Wr,Hr,Lt,cr,ws,Ss,Vr,ur,zr;Object.defineProperty(r,"__esModule",{value:!0}),r.KeyboardManager=r.CommandManager=r.ColorManager=r.AnnotationEditorUIManager=void 0,r.bindEvents=i,r.opacityToHex=o,e(93),e(101),e(102),e(105),e(107),e(109),e(113),e(116),e(123),e(2),e(89),e(125),e(136),e(138),e(141),e(143),e(145),e(147),e(166);var s=e(1),a=e(168);function i(ct,K,_e){for(const We of _e)K.addEventListener(We,ct[We].bind(ct))}function o(ct){return Math.round(Math.min(255,Math.max(1,255*ct))).toString(16).padStart(2,"0")}class c{constructor(){Ie(this,b,0)}getId(){return`${s.AnnotationEditorPrefix}${lr(this,b)._++}`}}b=new WeakMap;const P=class P{constructor(){Ie(this,y);Ie(this,E,(0,s.getUuid)());Ie(this,d,0);Ie(this,g,null)}static get _isSVGFittingCanvas(){const K='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',We=new OffscreenCanvas(1,3).getContext("2d"),Ke=new Image;Ke.src=K;const Ye=Ke.decode().then(()=>(We.drawImage(Ke,0,0,1,1,0,0,1,3),new Uint32Array(We.getImageData(0,0,1,1).data.buffer)[0]===0));return(0,s.shadow)(this,"_isSVGFittingCanvas",Ye)}async getFromFile(K){const{lastModified:_e,name:We,size:Ke,type:Ye}=K;return Ae(this,y,Lr).call(this,`${_e}_${We}_${Ke}_${Ye}`,K)}async getFromUrl(K){return Ae(this,y,Lr).call(this,K,K)}async getFromId(K){M(this,g)||ke(this,g,new Map);const _e=M(this,g).get(K);return _e?_e.bitmap?(_e.refCounter+=1,_e):_e.file?this.getFromFile(_e.file):this.getFromUrl(_e.url):null}getSvgUrl(K){const _e=M(this,g).get(K);return _e!=null&&_e.isSvg?_e.svgUrl:null}deleteId(K){M(this,g)||ke(this,g,new Map);const _e=M(this,g).get(K);_e&&(_e.refCounter-=1,_e.refCounter===0&&(_e.bitmap=null))}isValidId(K){return K.startsWith(`image_${M(this,E)}_`)}};E=new WeakMap,d=new WeakMap,g=new WeakMap,y=new WeakSet,Lr=async function(K,_e){M(this,g)||ke(this,g,new Map);let We=M(this,g).get(K);if(We===null)return null;if(We!=null&&We.bitmap)return We.refCounter+=1,We;try{We||(We={bitmap:null,id:`image_${M(this,E)}_${lr(this,d)._++}`,refCounter:0,isSvg:!1});let Ke;if(typeof _e=="string"){We.url=_e;const Ye=await fetch(_e);if(!Ye.ok)throw new Error(Ye.statusText);Ke=await Ye.blob()}else Ke=We.file=_e;if(Ke.type==="image/svg+xml"){const Ye=P._isSVGFittingCanvas,$e=new FileReader,ne=new Image,se=new Promise((ve,we)=>{ne.onload=()=>{We.bitmap=ne,We.isSvg=!0,ve()},$e.onload=async()=>{const Fe=We.svgUrl=$e.result;ne.src=await Ye?`${Fe}#svgView(preserveAspectRatio(none))`:Fe},ne.onerror=$e.onerror=we});$e.readAsDataURL(Ke),await se}else We.bitmap=await createImageBitmap(Ke);We.refCounter=1}catch(Ke){console.error(Ke),We=null}return M(this,g).set(K,We),We&&M(this,g).set(We.id,We),We};let x=P;class u{constructor(){Ie(this,F,[]);Ie(this,S,!1);Ie(this,I);Ie(this,w,-1);let K=arguments.length>0&&arguments[0]!==void 0?arguments[0]:128;ke(this,I,K)}add(K){let{cmd:_e,undo:We,mustExec:Ke,type:Ye=NaN,overwriteIfSameType:$e=!1,keepUndo:ne=!1}=K;if(Ke&&_e(),M(this,S))return;const se={cmd:_e,undo:We,type:Ye};if(M(this,w)===-1){M(this,F).length>0&&(M(this,F).length=0),ke(this,w,0),M(this,F).push(se);return}if($e&&M(this,F)[M(this,w)].type===Ye){ne&&(se.undo=M(this,F)[M(this,w)].undo),M(this,F)[M(this,w)]=se;return}const ve=M(this,w)+1;ve===M(this,I)?M(this,F).splice(0,1):(ke(this,w,ve),ve<M(this,F).length&&M(this,F).splice(ve)),M(this,F).push(se)}undo(){M(this,w)!==-1&&(ke(this,S,!0),M(this,F)[M(this,w)].undo(),ke(this,S,!1),ke(this,w,M(this,w)-1))}redo(){M(this,w)<M(this,F).length-1&&(ke(this,w,M(this,w)+1),ke(this,S,!0),M(this,F)[M(this,w)].cmd(),ke(this,S,!1))}hasSomethingToUndo(){return M(this,w)!==-1}hasSomethingToRedo(){return M(this,w)<M(this,F).length-1}destroy(){ke(this,F,null)}}F=new WeakMap,S=new WeakMap,I=new WeakMap,w=new WeakMap,r.CommandManager=u;class h{constructor(K){Ie(this,j);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:_e}=s.FeatureTest.platform;for(const[We,Ke,Ye={}]of K)for(const $e of We){const ne=$e.startsWith("mac+");_e&&ne?(this.callbacks.set($e.slice(4),{callback:Ke,options:Ye}),this.allKeys.add($e.split("+").at(-1))):!_e&&!ne&&(this.callbacks.set($e,{callback:Ke,options:Ye}),this.allKeys.add($e.split("+").at(-1)))}}exec(K,_e){if(!this.allKeys.has(_e.key))return;const We=this.callbacks.get(Ae(this,j,ys).call(this,_e));if(!We)return;const{callback:Ke,options:{bubbles:Ye=!1,args:$e=[],checker:ne=null}}=We;ne&&!ne(K,_e)||(Ke.bind(K,...$e)(),Ye||(_e.stopPropagation(),_e.preventDefault()))}}j=new WeakSet,ys=function(K){K.altKey&&this.buffer.push("alt"),K.ctrlKey&&this.buffer.push("ctrl"),K.metaKey&&this.buffer.push("meta"),K.shiftKey&&this.buffer.push("shift"),this.buffer.push(K.key);const _e=this.buffer.join("+");return this.buffer.length=0,_e},r.KeyboardManager=h;const V=class V{get _colors(){const K=new Map([["CanvasText",null],["Canvas",null]]);return(0,a.getColorValues)(K),(0,s.shadow)(this,"_colors",K)}convert(K){const _e=(0,a.getRGB)(K);if(!window.matchMedia("(forced-colors: active)").matches)return _e;for(const[We,Ke]of this._colors)if(Ke.every((Ye,$e)=>Ye===_e[$e]))return V._colorsMapping.get(We);return _e}getHexCode(K){const _e=this._colors.get(K);return _e?s.Util.makeHexColor(..._e):K}};wt(V,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));let _=V;r.ColorManager=_;const st=class st{constructor(K,_e,We,Ke,Ye,$e){Ie(this,Ee);Ie(this,O,null);Ie(this,H,new Map);Ie(this,z,new Map);Ie(this,pe,null);Ie(this,ee,null);Ie(this,he,new u);Ie(this,re,0);Ie(this,me,new Set);Ie(this,te,null);Ie(this,ce,null);Ie(this,ye,new Set);Ie(this,L,null);Ie(this,N,new c);Ie(this,T,!1);Ie(this,A,!1);Ie(this,D,null);Ie(this,B,s.AnnotationEditorType.NONE);Ie(this,U,new Set);Ie(this,Y,null);Ie(this,G,this.blur.bind(this));Ie(this,fe,this.focus.bind(this));Ie(this,xe,this.copy.bind(this));Ie(this,Se,this.cut.bind(this));Ie(this,Ce,this.paste.bind(this));Ie(this,Me,this.keydown.bind(this));Ie(this,be,this.onEditingAction.bind(this));Ie(this,ae,this.onPageChanging.bind(this));Ie(this,J,this.onScaleChanging.bind(this));Ie(this,oe,this.onRotationChanging.bind(this));Ie(this,Q,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1});Ie(this,ge,[0,0]);Ie(this,Te,null);Ie(this,Le,null);Ie(this,Re,null);ke(this,Le,K),ke(this,Re,_e),ke(this,pe,We),this._eventBus=Ke,this._eventBus._on("editingaction",M(this,be)),this._eventBus._on("pagechanging",M(this,ae)),this._eventBus._on("scalechanging",M(this,J)),this._eventBus._on("rotationchanging",M(this,oe)),ke(this,ee,Ye.annotationStorage),ke(this,L,Ye.filterFactory),ke(this,Y,$e),this.viewParameters={realScale:a.PixelsPerInch.PDF_TO_CSS_UNITS,rotation:0}}static get _keyboardManager(){const K=st.prototype,_e=Ye=>{const{activeElement:$e}=document;return $e&&M(Ye,Le).contains($e)&&Ye.hasSomethingToControl()},We=this.TRANSLATE_SMALL,Ke=this.TRANSLATE_BIG;return(0,s.shadow)(this,"_keyboardManager",new h([[["ctrl+a","mac+meta+a"],K.selectAll],[["ctrl+z","mac+meta+z"],K.undo],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],K.redo],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],K.delete],[["Escape","mac+Escape"],K.unselectAll],[["ArrowLeft","mac+ArrowLeft"],K.translateSelectedEditors,{args:[-We,0],checker:_e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],K.translateSelectedEditors,{args:[-Ke,0],checker:_e}],[["ArrowRight","mac+ArrowRight"],K.translateSelectedEditors,{args:[We,0],checker:_e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],K.translateSelectedEditors,{args:[Ke,0],checker:_e}],[["ArrowUp","mac+ArrowUp"],K.translateSelectedEditors,{args:[0,-We],checker:_e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],K.translateSelectedEditors,{args:[0,-Ke],checker:_e}],[["ArrowDown","mac+ArrowDown"],K.translateSelectedEditors,{args:[0,We],checker:_e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],K.translateSelectedEditors,{args:[0,Ke],checker:_e}]]))}destroy(){Ae(this,Ee,Er).call(this),Ae(this,Ee,Br).call(this),this._eventBus._off("editingaction",M(this,be)),this._eventBus._off("pagechanging",M(this,ae)),this._eventBus._off("scalechanging",M(this,J)),this._eventBus._off("rotationchanging",M(this,oe));for(const K of M(this,z).values())K.destroy();M(this,z).clear(),M(this,H).clear(),M(this,ye).clear(),ke(this,O,null),M(this,U).clear(),M(this,he).destroy(),M(this,pe).destroy()}get hcmFilter(){return(0,s.shadow)(this,"hcmFilter",M(this,Y)?M(this,L).addHCMFilter(M(this,Y).foreground,M(this,Y).background):"none")}get direction(){return(0,s.shadow)(this,"direction",getComputedStyle(M(this,Le)).direction)}editAltText(K){var _e;(_e=M(this,pe))==null||_e.editAltText(this,K)}onPageChanging(K){let{pageNumber:_e}=K;ke(this,re,_e-1)}focusMainContainer(){M(this,Le).focus()}findParent(K,_e){for(const We of M(this,z).values()){const{x:Ke,y:Ye,width:$e,height:ne}=We.div.getBoundingClientRect();if(K>=Ke&&K<=Ke+$e&&_e>=Ye&&_e<=Ye+ne)return We}return null}disableUserSelect(){let K=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;M(this,Re).classList.toggle("noUserSelect",K)}addShouldRescale(K){M(this,ye).add(K)}removeShouldRescale(K){M(this,ye).delete(K)}onScaleChanging(K){let{scale:_e}=K;this.commitOrRemove(),this.viewParameters.realScale=_e*a.PixelsPerInch.PDF_TO_CSS_UNITS;for(const We of M(this,ye))We.onScaleChanging()}onRotationChanging(K){let{pagesRotation:_e}=K;this.commitOrRemove(),this.viewParameters.rotation=_e}addToAnnotationStorage(K){!K.isEmpty()&&M(this,ee)&&!M(this,ee).has(K.id)&&M(this,ee).setValue(K.id,K)}blur(){if(!this.hasSelection)return;const{activeElement:K}=document;for(const _e of M(this,U))if(_e.div.contains(K)){ke(this,D,[_e,K]),_e._focusEventsAllowed=!1;break}}focus(){if(!M(this,D))return;const[K,_e]=M(this,D);ke(this,D,null),_e.addEventListener("focusin",()=>{K._focusEventsAllowed=!0},{once:!0}),_e.focus()}addEditListeners(){Ae(this,Ee,Ur).call(this),Ae(this,Ee,Wr).call(this)}removeEditListeners(){Ae(this,Ee,Er).call(this),Ae(this,Ee,Hr).call(this)}copy(K){var We;if(K.preventDefault(),(We=M(this,O))==null||We.commitOrRemove(),!this.hasSelection)return;const _e=[];for(const Ke of M(this,U)){const Ye=Ke.serialize(!0);Ye&&_e.push(Ye)}_e.length!==0&&K.clipboardData.setData("application/pdfjs",JSON.stringify(_e))}cut(K){this.copy(K),this.delete()}paste(K){K.preventDefault();const{clipboardData:_e}=K;for(const Ye of _e.items)for(const $e of M(this,ce))if($e.isHandlingMimeForPasting(Ye.type)){$e.paste(Ye,this.currentLayer);return}let We=_e.getData("application/pdfjs");if(!We)return;try{We=JSON.parse(We)}catch(Ye){(0,s.warn)(`paste: "${Ye.message}".`);return}if(!Array.isArray(We))return;this.unselectAll();const Ke=this.currentLayer;try{const Ye=[];for(const se of We){const ve=Ke.deserialize(se);if(!ve)return;Ye.push(ve)}const $e=()=>{for(const se of Ye)Ae(this,Ee,Vr).call(this,se);Ae(this,Ee,zr).call(this,Ye)},ne=()=>{for(const se of Ye)se.remove()};this.addCommands({cmd:$e,undo:ne,mustExec:!0})}catch(Ye){(0,s.warn)(`paste: "${Ye.message}".`)}}keydown(K){var _e;(_e=this.getActive())!=null&&_e.shouldGetKeyboardEvents()||st._keyboardManager.exec(this,K)}onEditingAction(K){["undo","redo","delete","selectAll"].includes(K.name)&&this[K.name]()}setEditingState(K){K?(Ae(this,Ee,_s).call(this),Ae(this,Ee,Ur).call(this),Ae(this,Ee,Wr).call(this),Ae(this,Ee,Lt).call(this,{isEditing:M(this,B)!==s.AnnotationEditorType.NONE,isEmpty:Ae(this,Ee,ur).call(this),hasSomethingToUndo:M(this,he).hasSomethingToUndo(),hasSomethingToRedo:M(this,he).hasSomethingToRedo(),hasSelectedEditor:!1})):(Ae(this,Ee,Br).call(this),Ae(this,Ee,Er).call(this),Ae(this,Ee,Hr).call(this),Ae(this,Ee,Lt).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(K){if(!M(this,ce)){ke(this,ce,K);for(const _e of M(this,ce))Ae(this,Ee,cr).call(this,_e.defaultPropertiesToUpdate)}}getId(){return M(this,N).getId()}get currentLayer(){return M(this,z).get(M(this,re))}getLayer(K){return M(this,z).get(K)}get currentPageIndex(){return M(this,re)}addLayer(K){M(this,z).set(K.pageIndex,K),M(this,T)?K.enable():K.disable()}removeLayer(K){M(this,z).delete(K.pageIndex)}updateMode(K){let _e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(M(this,B)!==K){if(ke(this,B,K),K===s.AnnotationEditorType.NONE){this.setEditingState(!1),Ae(this,Ee,Ss).call(this);return}this.setEditingState(!0),Ae(this,Ee,ws).call(this),this.unselectAll();for(const We of M(this,z).values())We.updateMode(K);if(_e){for(const We of M(this,H).values())if(We.annotationElementId===_e){this.setSelected(We),We.enterInEditMode();break}}}}updateToolbar(K){K!==M(this,B)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:K})}updateParams(K,_e){if(M(this,ce)){if(K===s.AnnotationEditorParamsType.CREATE){this.currentLayer.addNewEditor(K);return}for(const We of M(this,U))We.updateParams(K,_e);for(const We of M(this,ce))We.updateDefaultParams(K,_e)}}enableWaiting(){let K=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(M(this,A)!==K){ke(this,A,K);for(const _e of M(this,z).values())K?_e.disableClick():_e.enableClick(),_e.div.classList.toggle("waiting",K)}}getEditors(K){const _e=[];for(const We of M(this,H).values())We.pageIndex===K&&_e.push(We);return _e}getEditor(K){return M(this,H).get(K)}addEditor(K){M(this,H).set(K.id,K)}removeEditor(K){var _e;M(this,H).delete(K.id),this.unselect(K),(!K.annotationElementId||!M(this,me).has(K.annotationElementId))&&((_e=M(this,ee))==null||_e.remove(K.id))}addDeletedAnnotationElement(K){M(this,me).add(K.annotationElementId),K.deleted=!0}isDeletedAnnotationElement(K){return M(this,me).has(K)}removeDeletedAnnotationElement(K){M(this,me).delete(K.annotationElementId),K.deleted=!1}setActiveEditor(K){M(this,O)!==K&&(ke(this,O,K),K&&Ae(this,Ee,cr).call(this,K.propertiesToUpdate))}toggleSelected(K){if(M(this,U).has(K)){M(this,U).delete(K),K.unselect(),Ae(this,Ee,Lt).call(this,{hasSelectedEditor:this.hasSelection});return}M(this,U).add(K),K.select(),Ae(this,Ee,cr).call(this,K.propertiesToUpdate),Ae(this,Ee,Lt).call(this,{hasSelectedEditor:!0})}setSelected(K){for(const _e of M(this,U))_e!==K&&_e.unselect();M(this,U).clear(),M(this,U).add(K),K.select(),Ae(this,Ee,cr).call(this,K.propertiesToUpdate),Ae(this,Ee,Lt).call(this,{hasSelectedEditor:!0})}isSelected(K){return M(this,U).has(K)}unselect(K){K.unselect(),M(this,U).delete(K),Ae(this,Ee,Lt).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return M(this,U).size!==0}undo(){M(this,he).undo(),Ae(this,Ee,Lt).call(this,{hasSomethingToUndo:M(this,he).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:Ae(this,Ee,ur).call(this)})}redo(){M(this,he).redo(),Ae(this,Ee,Lt).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:M(this,he).hasSomethingToRedo(),isEmpty:Ae(this,Ee,ur).call(this)})}addCommands(K){M(this,he).add(K),Ae(this,Ee,Lt).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:Ae(this,Ee,ur).call(this)})}delete(){if(this.commitOrRemove(),!this.hasSelection)return;const K=[...M(this,U)],_e=()=>{for(const Ke of K)Ke.remove()},We=()=>{for(const Ke of K)Ae(this,Ee,Vr).call(this,Ke)};this.addCommands({cmd:_e,undo:We,mustExec:!0})}commitOrRemove(){var K;(K=M(this,O))==null||K.commitOrRemove()}hasSomethingToControl(){return M(this,O)||this.hasSelection}selectAll(){for(const K of M(this,U))K.commit();Ae(this,Ee,zr).call(this,M(this,H).values())}unselectAll(){if(M(this,O)){M(this,O).commitOrRemove();return}if(this.hasSelection){for(const K of M(this,U))K.unselect();M(this,U).clear(),Ae(this,Ee,Lt).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(K,_e){if((arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1)||this.commitOrRemove(),!this.hasSelection)return;M(this,ge)[0]+=K,M(this,ge)[1]+=_e;const[Ke,Ye]=M(this,ge),$e=[...M(this,U)],ne=1e3;M(this,Te)&&clearTimeout(M(this,Te)),ke(this,Te,setTimeout(()=>{ke(this,Te,null),M(this,ge)[0]=M(this,ge)[1]=0,this.addCommands({cmd:()=>{for(const se of $e)M(this,H).has(se.id)&&se.translateInPage(Ke,Ye)},undo:()=>{for(const se of $e)M(this,H).has(se.id)&&se.translateInPage(-Ke,-Ye)},mustExec:!1})},ne));for(const se of $e)se.translateInPage(K,_e)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),ke(this,te,new Map);for(const K of M(this,U))M(this,te).set(K,{savedX:K.x,savedY:K.y,savedPageIndex:K.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!M(this,te))return!1;this.disableUserSelect(!1);const K=M(this,te);ke(this,te,null);let _e=!1;for(const[{x:Ke,y:Ye,pageIndex:$e},ne]of K)ne.newX=Ke,ne.newY=Ye,ne.newPageIndex=$e,_e||(_e=Ke!==ne.savedX||Ye!==ne.savedY||$e!==ne.savedPageIndex);if(!_e)return!1;const We=(Ke,Ye,$e,ne)=>{if(M(this,H).has(Ke.id)){const se=M(this,z).get(ne);se?Ke._setParentAndPosition(se,Ye,$e):(Ke.pageIndex=ne,Ke.x=Ye,Ke.y=$e)}};return this.addCommands({cmd:()=>{for(const[Ke,{newX:Ye,newY:$e,newPageIndex:ne}]of K)We(Ke,Ye,$e,ne)},undo:()=>{for(const[Ke,{savedX:Ye,savedY:$e,savedPageIndex:ne}]of K)We(Ke,Ye,$e,ne)},mustExec:!0}),!0}dragSelectedEditors(K,_e){if(M(this,te))for(const We of M(this,te).keys())We.drag(K,_e)}rebuild(K){if(K.parent===null){const _e=this.getLayer(K.pageIndex);_e?(_e.changeParent(K),_e.addOrRebuild(K)):(this.addEditor(K),this.addToAnnotationStorage(K),K.rebuild())}else K.parent.addOrRebuild(K)}isActive(K){return M(this,O)===K}getActive(){return M(this,O)}getMode(){return M(this,B)}get imageManager(){return(0,s.shadow)(this,"imageManager",new x)}};O=new WeakMap,H=new WeakMap,z=new WeakMap,pe=new WeakMap,ee=new WeakMap,he=new WeakMap,re=new WeakMap,me=new WeakMap,te=new WeakMap,ce=new WeakMap,ye=new WeakMap,L=new WeakMap,N=new WeakMap,T=new WeakMap,A=new WeakMap,D=new WeakMap,B=new WeakMap,U=new WeakMap,Y=new WeakMap,G=new WeakMap,fe=new WeakMap,xe=new WeakMap,Se=new WeakMap,Ce=new WeakMap,Me=new WeakMap,be=new WeakMap,ae=new WeakMap,J=new WeakMap,oe=new WeakMap,Q=new WeakMap,ge=new WeakMap,Te=new WeakMap,Le=new WeakMap,Re=new WeakMap,Ee=new WeakSet,_s=function(){window.addEventListener("focus",M(this,fe)),window.addEventListener("blur",M(this,G))},Br=function(){window.removeEventListener("focus",M(this,fe)),window.removeEventListener("blur",M(this,G))},Ur=function(){window.addEventListener("keydown",M(this,Me),{capture:!0})},Er=function(){window.removeEventListener("keydown",M(this,Me),{capture:!0})},Wr=function(){document.addEventListener("copy",M(this,xe)),document.addEventListener("cut",M(this,Se)),document.addEventListener("paste",M(this,Ce))},Hr=function(){document.removeEventListener("copy",M(this,xe)),document.removeEventListener("cut",M(this,Se)),document.removeEventListener("paste",M(this,Ce))},Lt=function(K){Object.entries(K).some(We=>{let[Ke,Ye]=We;return M(this,Q)[Ke]!==Ye})&&this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(M(this,Q),K)})},cr=function(K){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:K})},ws=function(){if(!M(this,T)){ke(this,T,!0);for(const K of M(this,z).values())K.enable()}},Ss=function(){if(this.unselectAll(),M(this,T)){ke(this,T,!1);for(const K of M(this,z).values())K.disable()}},Vr=function(K){const _e=M(this,z).get(K.pageIndex);_e?_e.addOrRebuild(K):this.addEditor(K)},ur=function(){if(M(this,H).size===0)return!0;if(M(this,H).size===1)for(const K of M(this,H).values())return K.isEmpty();return!1},zr=function(K){M(this,U).clear();for(const _e of K)_e.isEmpty()||(M(this,U).add(_e),_e.select());Ae(this,Ee,Lt).call(this,{hasSelectedEditor:!0})},wt(st,"TRANSLATE_SMALL",1),wt(st,"TRANSLATE_BIG",10);let v=st;r.AnnotationEditorUIManager=v},(t,r,e)=>{var s=e(3),a=e(6),i=e(4),o=e(24),c=e(14),x=e(8),u=e(21),h=e(20),_=e(91),v=e(39),b=e(77),E=e(64),d=e(159),g=e(7),y=e(167),R=e(27),P=i.JSON,F=i.Number,S=i.SyntaxError,I=P&&P.parse,w=o("Object","keys"),j=Object.getOwnPropertyDescriptor,C=c("".charAt),V=c("".slice),O=c(/./.exec),H=c([].push),z=/^\d$/,pe=/^[1-9]$/,ee=/^(?:-|\d)$/,he=/^[\t\n\r ]$/,re=0,me=1,te=function(D,B){D=b(D);var U=new N(D,0),Y=U.parse(),G=Y.value,fe=U.skip(he,Y.end);if(fe<D.length)throw S('Unexpected extra character: "'+C(D,fe)+'" after the parsed data at: '+fe);return u(B)?ce({"":G},"",B,Y):G},ce=function(D,B,U,Y){var G=D[B],fe=Y&&G===Y.value,xe=fe&&typeof Y.source=="string"?{source:Y.source}:{},Se,Ce,Me,be,ae;if(h(G)){var J=_(G),oe=fe?Y.nodes:J?[]:{};if(J)for(Se=oe.length,Me=E(G),be=0;be<Me;be++)ye(G,be,ce(G,""+be,U,be<Se?oe[be]:void 0));else for(Ce=w(G),Me=E(Ce),be=0;be<Me;be++)ae=Ce[be],ye(G,ae,ce(G,ae,U,v(oe,ae)?oe[ae]:void 0))}return x(U,D,B,G,xe)},ye=function(D,B,U){if(a){var Y=j(D,B);if(Y&&!Y.configurable)return}U===void 0?delete D[B]:d(D,B,U)},L=function(D,B,U,Y){this.value=D,this.end=B,this.source=U,this.nodes=Y},N=function(D,B){this.source=D,this.index=B};N.prototype={fork:function(D){return new N(this.source,D)},parse:function(){var D=this.source,B=this.skip(he,this.index),U=this.fork(B),Y=C(D,B);if(O(ee,Y))return U.number();switch(Y){case"{":return U.object();case"[":return U.array();case'"':return U.string();case"t":return U.keyword(!0);case"f":return U.keyword(!1);case"n":return U.keyword(null)}throw S('Unexpected character: "'+Y+'" at: '+B)},node:function(D,B,U,Y,G){return new L(B,Y,D?null:V(this.source,U,Y),G)},object:function(){for(var D=this.source,B=this.index+1,U=!1,Y={},G={};B<D.length;){if(B=this.until(['"',"}"],B),C(D,B)==="}"&&!U){B++;break}var fe=this.fork(B).string(),xe=fe.value;B=fe.end,B=this.until([":"],B)+1,B=this.skip(he,B),fe=this.fork(B).parse(),d(G,xe,fe),d(Y,xe,fe.value),B=this.until([",","}"],fe.end);var Se=C(D,B);if(Se===",")U=!0,B++;else if(Se==="}"){B++;break}}return this.node(me,Y,this.index,B,G)},array:function(){for(var D=this.source,B=this.index+1,U=!1,Y=[],G=[];B<D.length;){if(B=this.skip(he,B),C(D,B)==="]"&&!U){B++;break}var fe=this.fork(B).parse();if(H(G,fe),H(Y,fe.value),B=this.until([",","]"],fe.end),C(D,B)===",")U=!0,B++;else if(C(D,B)==="]"){B++;break}}return this.node(me,Y,this.index,B,G)},string:function(){var D=this.index,B=y(this.source,this.index+1);return this.node(re,B.value,D,B.end)},number:function(){var D=this.source,B=this.index,U=B;if(C(D,U)==="-"&&U++,C(D,U)==="0")U++;else if(O(pe,C(D,U)))U=this.skip(z,++U);else throw S("Failed to parse number at: "+U);if(C(D,U)==="."&&(U=this.skip(z,++U)),C(D,U)==="e"||C(D,U)==="E"){U++,(C(D,U)==="+"||C(D,U)==="-")&&U++;var Y=U;if(U=this.skip(z,U),Y===U)throw S("Failed to parse number's exponent value at: "+U)}return this.node(re,F(V(D,B,U)),B,U)},keyword:function(D){var B=""+D,U=this.index,Y=U+B.length;if(V(this.source,U,Y)!==B)throw S("Failed to parse value at: "+U);return this.node(re,D,U,Y)},skip:function(D,B){for(var U=this.source;B<U.length&&O(D,C(U,B));B++);return B},until:function(D,B){B=this.skip(he,B);for(var U=C(this.source,B),Y=0;Y<D.length;Y++)if(D[Y]===U)return B;throw S('Unexpected character: "'+U+'" at: '+B)}};var T=g(function(){var D="9007199254740993",B;return I(D,function(U,Y,G){B=G.source}),B!==D}),A=R&&!g(function(){return 1/I("-0 	")!==-1/0});s({target:"JSON",stat:!0,forced:T},{parse:function(B,U){return A&&!u(U)?I(B):te(B,U)}})},(t,r,e)=>{var s=e(14),a=e(39),i=SyntaxError,o=parseInt,c=String.fromCharCode,x=s("".charAt),u=s("".slice),h=s(/./.exec),_={'\\"':'"',"\\\\":"\\","\\/":"/","\\b":"\b","\\f":"\f","\\n":`
`,"\\r":"\r","\\t":"	"},v=/^[\da-f]{4}$/i,b=/^[\u0000-\u001F]$/;t.exports=function(E,d){for(var g=!0,y="";d<E.length;){var R=x(E,d);if(R==="\\"){var P=u(E,d,d+2);if(a(_,P))y+=_[P],d+=2;else if(P==="\\u"){d+=2;var F=u(E,d,d+4);if(!h(v,F))throw i("Bad Unicode escape at: "+d);y+=c(o(F,16)),d+=4}else throw i('Unknown escape sequence: "'+P+'"')}else if(R==='"'){g=!1,d++;break}else{if(h(b,R))throw i("Bad control character in string literal at: "+d);y+=R,d++}}if(g)throw i("Unterminated string at: "+d);return{value:y,end:d}}},(t,r,e)=>{var re,me,te,ce,ye,L,N,T,A,D,B,U,rr,sr,$r,br,yr,dr,hr;Object.defineProperty(r,"__esModule",{value:!0}),r.StatTimer=r.RenderingCancelledException=r.PixelsPerInch=r.PageViewport=r.PDFDateString=r.DOMStandardFontDataFactory=r.DOMSVGFactory=r.DOMFilterFactory=r.DOMCanvasFactory=r.DOMCMapReaderFactory=void 0,r.deprecated=w,r.getColorValues=H,r.getCurrentTransform=z,r.getCurrentTransformInverse=pe,r.getFilenameFromUrl=y,r.getPdfFilenameFromUrl=R,r.getRGB=O,r.getXfaPageViewport=V,r.isDataScheme=d,r.isPdfFile=g,r.isValidFetchUrl=F,r.loadScript=I,r.noContextMenu=S,r.setLayerDimensions=ee,e(2),e(93),e(101),e(102),e(105),e(107),e(109),e(113),e(116),e(123),e(89),e(84),e(86),e(87);var s=e(169),a=e(1);const i="http://www.w3.org/2000/svg",he=class he{};wt(he,"CSS",96),wt(he,"PDF",72),wt(he,"PDF_TO_CSS_UNITS",he.CSS/he.PDF);let o=he;r.PixelsPerInch=o;class c extends s.BaseFilterFactory{constructor(){let{docId:J,ownerDocument:oe=globalThis.document}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super();Ie(this,U);Ie(this,re);Ie(this,me);Ie(this,te);Ie(this,ce);Ie(this,ye);Ie(this,L);Ie(this,N);Ie(this,T);Ie(this,A);Ie(this,D);Ie(this,B,0);ke(this,te,J),ke(this,ce,oe)}addFilter(J){if(!J)return"none";let oe=M(this,U,rr).get(J);if(oe)return oe;let Q,ge,Te,Le;if(J.length===1){const Xe=J[0],tt=new Array(256);for(let qe=0;qe<256;qe++)tt[qe]=Xe[qe]/255;Le=Q=ge=Te=tt.join(",")}else{const[Xe,tt,qe]=J,dt=new Array(256),Ze=new Array(256),nt=new Array(256);for(let ht=0;ht<256;ht++)dt[ht]=Xe[ht]/255,Ze[ht]=tt[ht]/255,nt[ht]=qe[ht]/255;Q=dt.join(","),ge=Ze.join(","),Te=nt.join(","),Le=`${Q}${ge}${Te}`}if(oe=M(this,U,rr).get(Le),oe)return M(this,U,rr).set(J,oe),oe;const Re=`g_${M(this,te)}_transfer_map_${lr(this,B)._++}`,Ee=`url(#${Re})`;M(this,U,rr).set(J,Ee),M(this,U,rr).set(Le,Ee);const ze=Ae(this,U,br).call(this,Re);return Ae(this,U,dr).call(this,Q,ge,Te,ze),Ee}addHCMFilter(J,oe){var tt;const Q=`${J}-${oe}`;if(M(this,L)===Q)return M(this,N);if(ke(this,L,Q),ke(this,N,"none"),(tt=M(this,ye))==null||tt.remove(),!J||!oe)return M(this,N);const ge=Ae(this,U,hr).call(this,J);J=a.Util.makeHexColor(...ge);const Te=Ae(this,U,hr).call(this,oe);if(oe=a.Util.makeHexColor(...Te),M(this,U,sr).style.color="",J==="#000000"&&oe==="#ffffff"||J===oe)return M(this,N);const Le=new Array(256);for(let qe=0;qe<=255;qe++){const dt=qe/255;Le[qe]=dt<=.03928?dt/12.92:((dt+.055)/1.055)**2.4}const Re=Le.join(","),Ee=`g_${M(this,te)}_hcm_filter`,ze=ke(this,T,Ae(this,U,br).call(this,Ee));Ae(this,U,dr).call(this,Re,Re,Re,ze),Ae(this,U,$r).call(this,ze);const Xe=(qe,dt)=>{const Ze=ge[qe]/255,nt=Te[qe]/255,ht=new Array(dt+1);for(let ft=0;ft<=dt;ft++)ht[ft]=Ze+ft/dt*(nt-Ze);return ht.join(",")};return Ae(this,U,dr).call(this,Xe(0,5),Xe(1,5),Xe(2,5),ze),ke(this,N,`url(#${Ee})`),M(this,N)}addHighlightHCMFilter(J,oe,Q,ge){var nt;const Te=`${J}-${oe}-${Q}-${ge}`;if(M(this,A)===Te)return M(this,D);if(ke(this,A,Te),ke(this,D,"none"),(nt=M(this,T))==null||nt.remove(),!J||!oe)return M(this,D);const[Le,Re]=[J,oe].map(Ae(this,U,hr).bind(this));let Ee=Math.round(.2126*Le[0]+.7152*Le[1]+.0722*Le[2]),ze=Math.round(.2126*Re[0]+.7152*Re[1]+.0722*Re[2]),[Xe,tt]=[Q,ge].map(Ae(this,U,hr).bind(this));ze<Ee&&([Ee,ze,Xe,tt]=[ze,Ee,tt,Xe]),M(this,U,sr).style.color="";const qe=(ht,ft,pt)=>{const Ge=new Array(256),Ne=(ze-Ee)/pt,je=ht/255,st=(ft-ht)/(255*pt);let ct=0;for(let K=0;K<=pt;K++){const _e=Math.round(Ee+K*Ne),We=je+K*st;for(let Ke=ct;Ke<=_e;Ke++)Ge[Ke]=We;ct=_e+1}for(let K=ct;K<256;K++)Ge[K]=Ge[ct-1];return Ge.join(",")},dt=`g_${M(this,te)}_hcm_highlight_filter`,Ze=ke(this,T,Ae(this,U,br).call(this,dt));return Ae(this,U,$r).call(this,Ze),Ae(this,U,dr).call(this,qe(Xe[0],tt[0],5),qe(Xe[1],tt[1],5),qe(Xe[2],tt[2],5),Ze),ke(this,D,`url(#${dt})`),M(this,D)}destroy(){arguments.length>0&&arguments[0]!==void 0&&arguments[0]&&(M(this,N)||M(this,D))||(M(this,me)&&(M(this,me).parentNode.parentNode.remove(),ke(this,me,null)),M(this,re)&&(M(this,re).clear(),ke(this,re,null)),ke(this,B,0))}}re=new WeakMap,me=new WeakMap,te=new WeakMap,ce=new WeakMap,ye=new WeakMap,L=new WeakMap,N=new WeakMap,T=new WeakMap,A=new WeakMap,D=new WeakMap,B=new WeakMap,U=new WeakSet,rr=function(){return M(this,re)||ke(this,re,new Map)},sr=function(){if(!M(this,me)){const J=M(this,ce).createElement("div"),{style:oe}=J;oe.visibility="hidden",oe.contain="strict",oe.width=oe.height=0,oe.position="absolute",oe.top=oe.left=0,oe.zIndex=-1;const Q=M(this,ce).createElementNS(i,"svg");Q.setAttribute("width",0),Q.setAttribute("height",0),ke(this,me,M(this,ce).createElementNS(i,"defs")),J.append(Q),Q.append(M(this,me)),M(this,ce).body.append(J)}return M(this,me)},$r=function(J){const oe=M(this,ce).createElementNS(i,"feColorMatrix");oe.setAttribute("type","matrix"),oe.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),J.append(oe)},br=function(J){const oe=M(this,ce).createElementNS(i,"filter");return oe.setAttribute("color-interpolation-filters","sRGB"),oe.setAttribute("id",J),M(this,U,sr).append(oe),oe},yr=function(J,oe,Q){const ge=M(this,ce).createElementNS(i,oe);ge.setAttribute("type","discrete"),ge.setAttribute("tableValues",Q),J.append(ge)},dr=function(J,oe,Q,ge){const Te=M(this,ce).createElementNS(i,"feComponentTransfer");ge.append(Te),Ae(this,U,yr).call(this,Te,"feFuncR",J),Ae(this,U,yr).call(this,Te,"feFuncG",oe),Ae(this,U,yr).call(this,Te,"feFuncB",Q)},hr=function(J){return M(this,U,sr).style.color=J,O(getComputedStyle(M(this,U,sr)).getPropertyValue("color"))},r.DOMFilterFactory=c;class x extends s.BaseCanvasFactory{constructor(){let{ownerDocument:ae=globalThis.document}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this._document=ae}_createCanvas(ae,J){const oe=this._document.createElement("canvas");return oe.width=ae,oe.height=J,oe}}r.DOMCanvasFactory=x;async function u(be){let ae=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(F(be,document.baseURI)){const J=await fetch(be);if(!J.ok)throw new Error(J.statusText);return ae?new Uint8Array(await J.arrayBuffer()):(0,a.stringToBytes)(await J.text())}return new Promise((J,oe)=>{const Q=new XMLHttpRequest;Q.open("GET",be,!0),ae&&(Q.responseType="arraybuffer"),Q.onreadystatechange=()=>{if(Q.readyState===XMLHttpRequest.DONE){if(Q.status===200||Q.status===0){let ge;if(ae&&Q.response?ge=new Uint8Array(Q.response):!ae&&Q.responseText&&(ge=(0,a.stringToBytes)(Q.responseText)),ge){J(ge);return}}oe(new Error(Q.statusText))}},Q.send(null)})}class h extends s.BaseCMapReaderFactory{_fetchData(ae,J){return u(ae,this.isCompressed).then(oe=>({cMapData:oe,compressionType:J}))}}r.DOMCMapReaderFactory=h;class _ extends s.BaseStandardFontDataFactory{_fetchData(ae){return u(ae,!0)}}r.DOMStandardFontDataFactory=_;class v extends s.BaseSVGFactory{_createSVG(ae){return document.createElementNS(i,ae)}}r.DOMSVGFactory=v;class b{constructor(ae){let{viewBox:J,scale:oe,rotation:Q,offsetX:ge=0,offsetY:Te=0,dontFlip:Le=!1}=ae;this.viewBox=J,this.scale=oe,this.rotation=Q,this.offsetX=ge,this.offsetY=Te;const Re=(J[2]+J[0])/2,Ee=(J[3]+J[1])/2;let ze,Xe,tt,qe;switch(Q%=360,Q<0&&(Q+=360),Q){case 180:ze=-1,Xe=0,tt=0,qe=1;break;case 90:ze=0,Xe=1,tt=1,qe=0;break;case 270:ze=0,Xe=-1,tt=-1,qe=0;break;case 0:ze=1,Xe=0,tt=0,qe=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}Le&&(tt=-tt,qe=-qe);let dt,Ze,nt,ht;ze===0?(dt=Math.abs(Ee-J[1])*oe+ge,Ze=Math.abs(Re-J[0])*oe+Te,nt=(J[3]-J[1])*oe,ht=(J[2]-J[0])*oe):(dt=Math.abs(Re-J[0])*oe+ge,Ze=Math.abs(Ee-J[1])*oe+Te,nt=(J[2]-J[0])*oe,ht=(J[3]-J[1])*oe),this.transform=[ze*oe,Xe*oe,tt*oe,qe*oe,dt-ze*oe*Re-tt*oe*Ee,Ze-Xe*oe*Re-qe*oe*Ee],this.width=nt,this.height=ht}get rawDims(){const{viewBox:ae}=this;return(0,a.shadow)(this,"rawDims",{pageWidth:ae[2]-ae[0],pageHeight:ae[3]-ae[1],pageX:ae[0],pageY:ae[1]})}clone(){let{scale:ae=this.scale,rotation:J=this.rotation,offsetX:oe=this.offsetX,offsetY:Q=this.offsetY,dontFlip:ge=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return new b({viewBox:this.viewBox.slice(),scale:ae,rotation:J,offsetX:oe,offsetY:Q,dontFlip:ge})}convertToViewportPoint(ae,J){return a.Util.applyTransform([ae,J],this.transform)}convertToViewportRectangle(ae){const J=a.Util.applyTransform([ae[0],ae[1]],this.transform),oe=a.Util.applyTransform([ae[2],ae[3]],this.transform);return[J[0],J[1],oe[0],oe[1]]}convertToPdfPoint(ae,J){return a.Util.applyInverseTransform([ae,J],this.transform)}}r.PageViewport=b;class E extends a.BaseException{constructor(ae){let J=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;super(ae,"RenderingCancelledException"),this.extraDelay=J}}r.RenderingCancelledException=E;function d(be){const ae=be.length;let J=0;for(;J<ae&&be[J].trim()==="";)J++;return be.substring(J,J+5).toLowerCase()==="data:"}function g(be){return typeof be=="string"&&/\.pdf$/i.test(be)}function y(be){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1)||([be]=be.split(/[#?]/,1)),be.substring(be.lastIndexOf("/")+1)}function R(be){let ae=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"document.pdf";if(typeof be!="string")return ae;if(d(be))return(0,a.warn)('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),ae;const J=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,oe=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,Q=J.exec(be);let ge=oe.exec(Q[1])||oe.exec(Q[2])||oe.exec(Q[3]);if(ge&&(ge=ge[0],ge.includes("%")))try{ge=oe.exec(decodeURIComponent(ge))[0]}catch{}return ge||ae}class P{constructor(){wt(this,"started",Object.create(null));wt(this,"times",[])}time(ae){ae in this.started&&(0,a.warn)(`Timer is already running for ${ae}`),this.started[ae]=Date.now()}timeEnd(ae){ae in this.started||(0,a.warn)(`Timer has not been started for ${ae}`),this.times.push({name:ae,start:this.started[ae],end:Date.now()}),delete this.started[ae]}toString(){const ae=[];let J=0;for(const{name:oe}of this.times)J=Math.max(oe.length,J);for(const{name:oe,start:Q,end:ge}of this.times)ae.push(`${oe.padEnd(J)} ${ge-Q}ms
`);return ae.join("")}}r.StatTimer=P;function F(be,ae){try{const{protocol:J}=ae?new URL(be,ae):new URL(be);return J==="http:"||J==="https:"}catch{return!1}}function S(be){be.preventDefault()}function I(be){let ae=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return new Promise((J,oe)=>{const Q=document.createElement("script");Q.src=be,Q.onload=function(ge){ae&&Q.remove(),J(ge)},Q.onerror=function(){oe(new Error(`Cannot load script at: ${Q.src}`))},(document.head||document.documentElement).append(Q)})}function w(be){console.log("Deprecated API usage: "+be)}let j;class C{static toDateObject(ae){if(!ae||typeof ae!="string")return null;j||(j=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const J=j.exec(ae);if(!J)return null;const oe=parseInt(J[1],10);let Q=parseInt(J[2],10);Q=Q>=1&&Q<=12?Q-1:0;let ge=parseInt(J[3],10);ge=ge>=1&&ge<=31?ge:1;let Te=parseInt(J[4],10);Te=Te>=0&&Te<=23?Te:0;let Le=parseInt(J[5],10);Le=Le>=0&&Le<=59?Le:0;let Re=parseInt(J[6],10);Re=Re>=0&&Re<=59?Re:0;const Ee=J[7]||"Z";let ze=parseInt(J[8],10);ze=ze>=0&&ze<=23?ze:0;let Xe=parseInt(J[9],10)||0;return Xe=Xe>=0&&Xe<=59?Xe:0,Ee==="-"?(Te+=ze,Le+=Xe):Ee==="+"&&(Te-=ze,Le-=Xe),new Date(Date.UTC(oe,Q,ge,Te,Le,Re))}}r.PDFDateString=C;function V(be,ae){let{scale:J=1,rotation:oe=0}=ae;const{width:Q,height:ge}=be.attributes.style,Te=[0,0,parseInt(Q),parseInt(ge)];return new b({viewBox:Te,scale:J,rotation:oe})}function O(be){if(be.startsWith("#")){const ae=parseInt(be.slice(1),16);return[(ae&16711680)>>16,(ae&65280)>>8,ae&255]}return be.startsWith("rgb(")?be.slice(4,-1).split(",").map(ae=>parseInt(ae)):be.startsWith("rgba(")?be.slice(5,-1).split(",").map(ae=>parseInt(ae)).slice(0,3):((0,a.warn)(`Not a valid color format: "${be}"`),[0,0,0])}function H(be){const ae=document.createElement("span");ae.style.visibility="hidden",document.body.append(ae);for(const J of be.keys()){ae.style.color=J;const oe=window.getComputedStyle(ae).color;be.set(J,O(oe))}ae.remove()}function z(be){const{a:ae,b:J,c:oe,d:Q,e:ge,f:Te}=be.getTransform();return[ae,J,oe,Q,ge,Te]}function pe(be){const{a:ae,b:J,c:oe,d:Q,e:ge,f:Te}=be.getTransform().invertSelf();return[ae,J,oe,Q,ge,Te]}function ee(be,ae){let J=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,oe=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0;if(ae instanceof b){const{pageWidth:Q,pageHeight:ge}=ae.rawDims,{style:Te}=be,Le=a.FeatureTest.isCSSRoundSupported,Re=`var(--scale-factor) * ${Q}px`,Ee=`var(--scale-factor) * ${ge}px`,ze=Le?`round(${Re}, 1px)`:`calc(${Re})`,Xe=Le?`round(${Ee}, 1px)`:`calc(${Ee})`;!J||ae.rotation%180===0?(Te.width=ze,Te.height=Xe):(Te.width=Xe,Te.height=ze)}oe&&be.setAttribute("data-main-rotation",ae.rotation)}},(t,r,e)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.BaseStandardFontDataFactory=r.BaseSVGFactory=r.BaseFilterFactory=r.BaseCanvasFactory=r.BaseCMapReaderFactory=void 0,e(2);var s=e(1);class a{constructor(){this.constructor===a&&(0,s.unreachable)("Cannot initialize BaseFilterFactory.")}addFilter(h){return"none"}addHCMFilter(h,_){return"none"}addHighlightHCMFilter(h,_,v,b){return"none"}destroy(){}}r.BaseFilterFactory=a;class i{constructor(){this.constructor===i&&(0,s.unreachable)("Cannot initialize BaseCanvasFactory.")}create(h,_){if(h<=0||_<=0)throw new Error("Invalid canvas size");const v=this._createCanvas(h,_);return{canvas:v,context:v.getContext("2d")}}reset(h,_,v){if(!h.canvas)throw new Error("Canvas is not specified");if(_<=0||v<=0)throw new Error("Invalid canvas size");h.canvas.width=_,h.canvas.height=v}destroy(h){if(!h.canvas)throw new Error("Canvas is not specified");h.canvas.width=0,h.canvas.height=0,h.canvas=null,h.context=null}_createCanvas(h,_){(0,s.unreachable)("Abstract method `_createCanvas` called.")}}r.BaseCanvasFactory=i;class o{constructor(h){let{baseUrl:_=null,isCompressed:v=!0}=h;this.constructor===o&&(0,s.unreachable)("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=_,this.isCompressed=v}async fetch(h){let{name:_}=h;if(!this.baseUrl)throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!_)throw new Error("CMap name must be specified.");const v=this.baseUrl+_+(this.isCompressed?".bcmap":""),b=this.isCompressed?s.CMapCompressionType.BINARY:s.CMapCompressionType.NONE;return this._fetchData(v,b).catch(E=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${v}`)})}_fetchData(h,_){(0,s.unreachable)("Abstract method `_fetchData` called.")}}r.BaseCMapReaderFactory=o;class c{constructor(h){let{baseUrl:_=null}=h;this.constructor===c&&(0,s.unreachable)("Cannot initialize BaseStandardFontDataFactory."),this.baseUrl=_}async fetch(h){let{filename:_}=h;if(!this.baseUrl)throw new Error('The standard font "baseUrl" parameter must be specified, ensure that the "standardFontDataUrl" API parameter is provided.');if(!_)throw new Error("Font filename must be specified.");const v=`${this.baseUrl}${_}`;return this._fetchData(v).catch(b=>{throw new Error(`Unable to load font data at: ${v}`)})}_fetchData(h){(0,s.unreachable)("Abstract method `_fetchData` called.")}}r.BaseStandardFontDataFactory=c;class x{constructor(){this.constructor===x&&(0,s.unreachable)("Cannot initialize BaseSVGFactory.")}create(h,_){let v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(h<=0||_<=0)throw new Error("Invalid SVG dimensions");const b=this._createSVG("svg:svg");return b.setAttribute("version","1.1"),v||(b.setAttribute("width",`${h}px`),b.setAttribute("height",`${_}px`)),b.setAttribute("preserveAspectRatio","none"),b.setAttribute("viewBox",`0 0 ${h} ${_}`),b}createElement(h){if(typeof h!="string")throw new Error("Invalid SVG element type");return this._createSVG(h)}_createSVG(h){(0,s.unreachable)("Abstract method `_createSVG` called.")}}r.BaseSVGFactory=x},(t,r,e)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.MurmurHash3_64=void 0,e(93),e(101),e(102),e(105),e(107),e(109),e(113),e(116),e(123),e(2);var s=e(1);const a=3285377520,i=4294901760,o=65535;class c{constructor(u){this.h1=u?u&4294967295:a,this.h2=u?u&4294967295:a}update(u){let h,_;if(typeof u=="string"){h=new Uint8Array(u.length*2),_=0;for(let w=0,j=u.length;w<j;w++){const C=u.charCodeAt(w);C<=255?h[_++]=C:(h[_++]=C>>>8,h[_++]=C&255)}}else if((0,s.isArrayBuffer)(u))h=u.slice(),_=h.byteLength;else throw new Error("Wrong data format in MurmurHash3_64_update. Input must be a string or array.");const v=_>>2,b=_-v*4,E=new Uint32Array(h.buffer,0,v);let d=0,g=0,y=this.h1,R=this.h2;const P=3432918353,F=461845907,S=P&o,I=F&o;for(let w=0;w<v;w++)w&1?(d=E[w],d=d*P&i|d*S&o,d=d<<15|d>>>17,d=d*F&i|d*I&o,y^=d,y=y<<13|y>>>19,y=y*5+3864292196):(g=E[w],g=g*P&i|g*S&o,g=g<<15|g>>>17,g=g*F&i|g*I&o,R^=g,R=R<<13|R>>>19,R=R*5+3864292196);switch(d=0,b){case 3:d^=h[v*4+2]<<16;case 2:d^=h[v*4+1]<<8;case 1:d^=h[v*4],d=d*P&i|d*S&o,d=d<<15|d>>>17,d=d*F&i|d*I&o,v&1?y^=d:R^=d}this.h1=y,this.h2=R}hexdigest(){let u=this.h1,h=this.h2;return u^=h>>>1,u=u*3981806797&i|u*36045&o,h=h*4283543511&i|((h<<16|u>>>16)*2950163797&i)>>>16,u^=h>>>1,u=u*444984403&i|u*60499&o,h=h*3301882366&i|((h<<16|u>>>16)*3120437893&i)>>>16,u^=h>>>1,(u>>>0).toString(16).padStart(8,"0")+(h>>>0).toString(16).padStart(8,"0")}}r.MurmurHash3_64=c},(t,r,e)=>{var o;Object.defineProperty(r,"__esModule",{value:!0}),r.FontLoader=r.FontFaceObject=void 0,e(125),e(136),e(138),e(141),e(143),e(145),e(147),e(89),e(149);var s=e(1);class a{constructor(x){Ie(this,o,new Set);let{ownerDocument:u=globalThis.document,styleElement:h=null}=x;this._document=u,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(x){this.nativeFontFaces.add(x),this._document.fonts.add(x)}removeNativeFontFace(x){this.nativeFontFaces.delete(x),this._document.fonts.delete(x)}insertRule(x){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const u=this.styleElement.sheet;u.insertRule(x,u.cssRules.length)}clear(){for(const x of this.nativeFontFaces)this._document.fonts.delete(x);this.nativeFontFaces.clear(),M(this,o).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont(x){if(!(!x||M(this,o).has(x.loadedName))){if((0,s.assert)(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:u,src:h,style:_}=x,v=new FontFace(u,h,_);this.addNativeFontFace(v);try{await v.load(),M(this,o).add(u)}catch{(0,s.warn)(`Cannot load system font: ${x.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(v)}return}(0,s.unreachable)("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(x){if(x.attached||x.missingFile&&!x.systemFontInfo)return;if(x.attached=!0,x.systemFontInfo){await this.loadSystemFont(x.systemFontInfo);return}if(this.isFontLoadingAPISupported){const h=x.createNativeFontFace();if(h){this.addNativeFontFace(h);try{await h.loaded}catch(_){throw(0,s.warn)(`Failed to load font '${h.family}': '${_}'.`),x.disableFontFace=!0,_}}return}const u=x.createFontFaceRule();if(u){if(this.insertRule(u),this.isSyncFontLoadingSupported)return;await new Promise(h=>{const _=this._queueLoadingCallback(h);this._prepareFontLoadEvent(x,_)})}}get isFontLoadingAPISupported(){var u;const x=!!((u=this._document)!=null&&u.fonts);return(0,s.shadow)(this,"isFontLoadingAPISupported",x)}get isSyncFontLoadingSupported(){let x=!1;return(s.isNodeJS||typeof navigator<"u"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(x=!0),(0,s.shadow)(this,"isSyncFontLoadingSupported",x)}_queueLoadingCallback(x){function u(){for((0,s.assert)(!_.done,"completeRequest() cannot be called twice."),_.done=!0;h.length>0&&h[0].done;){const v=h.shift();setTimeout(v.callback,0)}}const{loadingRequests:h}=this,_={done:!1,complete:u,callback:x};return h.push(_),_}get _loadTestFont(){const x=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return(0,s.shadow)(this,"_loadTestFont",x)}_prepareFontLoadEvent(x,u){function h(O,H){return O.charCodeAt(H)<<24|O.charCodeAt(H+1)<<16|O.charCodeAt(H+2)<<8|O.charCodeAt(H+3)&255}function _(O,H,z,pe){const ee=O.substring(0,H),he=O.substring(H+z);return ee+pe+he}let v,b;const E=this._document.createElement("canvas");E.width=1,E.height=1;const d=E.getContext("2d");let g=0;function y(O,H){if(++g>30){(0,s.warn)("Load test font never loaded."),H();return}if(d.font="30px "+O,d.fillText(".",0,20),d.getImageData(0,0,1,1).data[3]>0){H();return}setTimeout(y.bind(null,O,H))}const R=`lt${Date.now()}${this.loadTestFontId++}`;let P=this._loadTestFont;P=_(P,976,R.length,R);const S=16,I=1482184792;let w=h(P,S);for(v=0,b=R.length-3;v<b;v+=4)w=w-I+h(R,v)|0;v<R.length&&(w=w-I+h(R+"XXX",v)|0),P=_(P,S,4,(0,s.string32)(w));const j=`url(data:font/opentype;base64,${btoa(P)});`,C=`@font-face {font-family:"${R}";src:${j}}`;this.insertRule(C);const V=this._document.createElement("div");V.style.visibility="hidden",V.style.width=V.style.height="10px",V.style.position="absolute",V.style.top=V.style.left="0px";for(const O of[x.loadedName,R]){const H=this._document.createElement("span");H.textContent="Hi",H.style.fontFamily=O,V.append(H)}this._document.body.append(V),y(R,()=>{V.remove(),u.complete()})}}o=new WeakMap,r.FontLoader=a;class i{constructor(x,u){let{isEvalSupported:h=!0,disableFontFace:_=!1,ignoreErrors:v=!1,inspectFont:b=null}=u;this.compiledGlyphs=Object.create(null);for(const E in x)this[E]=x[E];this.isEvalSupported=h!==!1,this.disableFontFace=_===!0,this.ignoreErrors=v===!0,this._inspectFont=b}createNativeFontFace(){var u;if(!this.data||this.disableFontFace)return null;let x;if(!this.cssFontInfo)x=new FontFace(this.loadedName,this.data,{});else{const h={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(h.style=`oblique ${this.cssFontInfo.italicAngle}deg`),x=new FontFace(this.cssFontInfo.fontFamily,this.data,h)}return(u=this._inspectFont)==null||u.call(this,this),x}createFontFaceRule(){var _;if(!this.data||this.disableFontFace)return null;const x=(0,s.bytesToString)(this.data),u=`url(data:${this.mimetype};base64,${btoa(x)});`;let h;if(!this.cssFontInfo)h=`@font-face {font-family:"${this.loadedName}";src:${u}}`;else{let v=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(v+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),h=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${v}src:${u}}`}return(_=this._inspectFont)==null||_.call(this,this,u),h}getPathGenerator(x,u){if(this.compiledGlyphs[u]!==void 0)return this.compiledGlyphs[u];let h;try{h=x.get(this.loadedName+"_path_"+u)}catch(_){if(!this.ignoreErrors)throw _;return(0,s.warn)(`getPathGenerator - ignoring character: "${_}".`),this.compiledGlyphs[u]=function(v,b){}}if(this.isEvalSupported&&s.FeatureTest.isEvalSupported){const _=[];for(const v of h){const b=v.args!==void 0?v.args.join(","):"";_.push("c.",v.cmd,"(",b,`);
`)}return this.compiledGlyphs[u]=new Function("c","size",_.join(""))}return this.compiledGlyphs[u]=function(_,v){for(const b of h)b.cmd==="scale"&&(b.args=[v,-v]),_[b.cmd].apply(_,b.args)}}}r.FontFaceObject=i},(t,r,e)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.NodeStandardFontDataFactory=r.NodeFilterFactory=r.NodeCanvasFactory=r.NodeCMapReaderFactory=void 0,e(2),e(93),e(101),e(102),e(105),e(107),e(109),e(113),e(116),e(123);var s=e(169),a=e(1);(function(){if(!(globalThis.DOMMatrix||!a.isNodeJS))try{globalThis.DOMMatrix=require$$6.DOMMatrix}catch(_){(0,a.warn)(`Cannot polyfill \`DOMMatrix\`, rendering may be broken: "${_}".`)}})(),function(){if(!(globalThis.Path2D||!a.isNodeJS))try{const{CanvasRenderingContext2D:_}=require$$6,{polyfillPath2D:v}=requirePath2dPolyfill_esm();globalThis.CanvasRenderingContext2D=_,v(globalThis)}catch(_){(0,a.warn)(`Cannot polyfill \`Path2D\`, rendering may be broken: "${_}".`)}}();const i=function(h){return new Promise((_,v)=>{require$$6.readFile(h,(E,d)=>{if(E||!d){v(new Error(E));return}_(new Uint8Array(d))})})};class o extends s.BaseFilterFactory{}r.NodeFilterFactory=o;class c extends s.BaseCanvasFactory{_createCanvas(_,v){return require$$6.createCanvas(_,v)}}r.NodeCanvasFactory=c;class x extends s.BaseCMapReaderFactory{_fetchData(_,v){return i(_).then(b=>({cMapData:b,compressionType:v}))}}r.NodeCMapReaderFactory=x;class u extends s.BaseStandardFontDataFactory{_fetchData(_){return i(_)}}r.NodeStandardFontDataFactory=u},(t,r,e)=>{var me,Gr,Xr;Object.defineProperty(r,"__esModule",{value:!0}),r.CanvasGraphics=void 0,e(2),e(93),e(101),e(102),e(105),e(107),e(109),e(113),e(116),e(123),e(89);var s=e(1),a=e(168),i=e(174),o=e(175);const c=16,x=100,u=4096,h=15,_=10,v=1e3,b=16;function E(L,N){if(L._removeMirroring)throw new Error("Context is already forwarding operations.");L.__originalSave=L.save,L.__originalRestore=L.restore,L.__originalRotate=L.rotate,L.__originalScale=L.scale,L.__originalTranslate=L.translate,L.__originalTransform=L.transform,L.__originalSetTransform=L.setTransform,L.__originalResetTransform=L.resetTransform,L.__originalClip=L.clip,L.__originalMoveTo=L.moveTo,L.__originalLineTo=L.lineTo,L.__originalBezierCurveTo=L.bezierCurveTo,L.__originalRect=L.rect,L.__originalClosePath=L.closePath,L.__originalBeginPath=L.beginPath,L._removeMirroring=()=>{L.save=L.__originalSave,L.restore=L.__originalRestore,L.rotate=L.__originalRotate,L.scale=L.__originalScale,L.translate=L.__originalTranslate,L.transform=L.__originalTransform,L.setTransform=L.__originalSetTransform,L.resetTransform=L.__originalResetTransform,L.clip=L.__originalClip,L.moveTo=L.__originalMoveTo,L.lineTo=L.__originalLineTo,L.bezierCurveTo=L.__originalBezierCurveTo,L.rect=L.__originalRect,L.closePath=L.__originalClosePath,L.beginPath=L.__originalBeginPath,delete L._removeMirroring},L.save=function(){N.save(),this.__originalSave()},L.restore=function(){N.restore(),this.__originalRestore()},L.translate=function(A,D){N.translate(A,D),this.__originalTranslate(A,D)},L.scale=function(A,D){N.scale(A,D),this.__originalScale(A,D)},L.transform=function(A,D,B,U,Y,G){N.transform(A,D,B,U,Y,G),this.__originalTransform(A,D,B,U,Y,G)},L.setTransform=function(A,D,B,U,Y,G){N.setTransform(A,D,B,U,Y,G),this.__originalSetTransform(A,D,B,U,Y,G)},L.resetTransform=function(){N.resetTransform(),this.__originalResetTransform()},L.rotate=function(A){N.rotate(A),this.__originalRotate(A)},L.clip=function(A){N.clip(A),this.__originalClip(A)},L.moveTo=function(T,A){N.moveTo(T,A),this.__originalMoveTo(T,A)},L.lineTo=function(T,A){N.lineTo(T,A),this.__originalLineTo(T,A)},L.bezierCurveTo=function(T,A,D,B,U,Y){N.bezierCurveTo(T,A,D,B,U,Y),this.__originalBezierCurveTo(T,A,D,B,U,Y)},L.rect=function(T,A,D,B){N.rect(T,A,D,B),this.__originalRect(T,A,D,B)},L.closePath=function(){N.closePath(),this.__originalClosePath()},L.beginPath=function(){N.beginPath(),this.__originalBeginPath()}}class d{constructor(N){this.canvasFactory=N,this.cache=Object.create(null)}getCanvas(N,T,A){let D;return this.cache[N]!==void 0?(D=this.cache[N],this.canvasFactory.reset(D,T,A)):(D=this.canvasFactory.create(T,A),this.cache[N]=D),D}delete(N){delete this.cache[N]}clear(){for(const N in this.cache){const T=this.cache[N];this.canvasFactory.destroy(T),delete this.cache[N]}}}function g(L,N,T,A,D,B,U,Y,G,fe){const[xe,Se,Ce,Me,be,ae]=(0,a.getCurrentTransform)(L);if(Se===0&&Ce===0){const Q=U*xe+be,ge=Math.round(Q),Te=Y*Me+ae,Le=Math.round(Te),Re=(U+G)*xe+be,Ee=Math.abs(Math.round(Re)-ge)||1,ze=(Y+fe)*Me+ae,Xe=Math.abs(Math.round(ze)-Le)||1;return L.setTransform(Math.sign(xe),0,0,Math.sign(Me),ge,Le),L.drawImage(N,T,A,D,B,0,0,Ee,Xe),L.setTransform(xe,Se,Ce,Me,be,ae),[Ee,Xe]}if(xe===0&&Me===0){const Q=Y*Ce+be,ge=Math.round(Q),Te=U*Se+ae,Le=Math.round(Te),Re=(Y+fe)*Ce+be,Ee=Math.abs(Math.round(Re)-ge)||1,ze=(U+G)*Se+ae,Xe=Math.abs(Math.round(ze)-Le)||1;return L.setTransform(0,Math.sign(Se),Math.sign(Ce),0,ge,Le),L.drawImage(N,T,A,D,B,0,0,Xe,Ee),L.setTransform(xe,Se,Ce,Me,be,ae),[Xe,Ee]}L.drawImage(N,T,A,D,B,U,Y,G,fe);const J=Math.hypot(xe,Se),oe=Math.hypot(Ce,Me);return[J*G,oe*fe]}function y(L){const{width:N,height:T}=L;if(N>v||T>v)return null;const A=1e3,D=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),B=N+1;let U=new Uint8Array(B*(T+1)),Y,G,fe;const xe=N+7&-8;let Se=new Uint8Array(xe*T),Ce=0;for(const oe of L.data){let Q=128;for(;Q>0;)Se[Ce++]=oe&Q?0:255,Q>>=1}let Me=0;for(Ce=0,Se[Ce]!==0&&(U[0]=1,++Me),G=1;G<N;G++)Se[Ce]!==Se[Ce+1]&&(U[G]=Se[Ce]?2:1,++Me),Ce++;for(Se[Ce]!==0&&(U[G]=2,++Me),Y=1;Y<T;Y++){Ce=Y*xe,fe=Y*B,Se[Ce-xe]!==Se[Ce]&&(U[fe]=Se[Ce]?1:8,++Me);let oe=(Se[Ce]?4:0)+(Se[Ce-xe]?8:0);for(G=1;G<N;G++)oe=(oe>>2)+(Se[Ce+1]?4:0)+(Se[Ce-xe+1]?8:0),D[oe]&&(U[fe+G]=D[oe],++Me),Ce++;if(Se[Ce-xe]!==Se[Ce]&&(U[fe+G]=Se[Ce]?2:4,++Me),Me>A)return null}for(Ce=xe*(T-1),fe=Y*B,Se[Ce]!==0&&(U[fe]=8,++Me),G=1;G<N;G++)Se[Ce]!==Se[Ce+1]&&(U[fe+G]=Se[Ce]?4:8,++Me),Ce++;if(Se[Ce]!==0&&(U[fe+G]=4,++Me),Me>A)return null;const be=new Int32Array([0,B,-1,0,-B,0,0,0,1]),ae=new Path2D;for(Y=0;Me&&Y<=T;Y++){let oe=Y*B;const Q=oe+N;for(;oe<Q&&!U[oe];)oe++;if(oe===Q)continue;ae.moveTo(oe%B,Y);const ge=oe;let Te=U[oe];do{const Le=be[Te];do oe+=Le;while(!U[oe]);const Re=U[oe];Re!==5&&Re!==10?(Te=Re,U[oe]=0):(Te=Re&51*Te>>4,U[oe]&=Te>>2|Te<<2),ae.lineTo(oe%B,oe/B|0),U[oe]||--Me}while(ge!==oe);--Y}return Se=null,U=null,function(oe){oe.save(),oe.scale(1/N,-1/T),oe.translate(0,-T),oe.fill(ae),oe.beginPath(),oe.restore()}}class R{constructor(N,T){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=s.IDENTITY_MATRIX,this.textMatrixScale=1,this.fontMatrix=s.FONT_IDENTITY_MATRIX,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=s.TextRenderingMode.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,N,T])}clone(){const N=Object.create(this);return N.clipBox=this.clipBox.slice(),N}setCurrentPoint(N,T){this.x=N,this.y=T}updatePathMinMax(N,T,A){[T,A]=s.Util.applyTransform([T,A],N),this.minX=Math.min(this.minX,T),this.minY=Math.min(this.minY,A),this.maxX=Math.max(this.maxX,T),this.maxY=Math.max(this.maxY,A)}updateRectMinMax(N,T){const A=s.Util.applyTransform(T,N),D=s.Util.applyTransform(T.slice(2),N);this.minX=Math.min(this.minX,A[0],D[0]),this.minY=Math.min(this.minY,A[1],D[1]),this.maxX=Math.max(this.maxX,A[0],D[0]),this.maxY=Math.max(this.maxY,A[1],D[1])}updateScalingPathMinMax(N,T){s.Util.scaleMinMax(N,T),this.minX=Math.min(this.minX,T[0]),this.maxX=Math.max(this.maxX,T[1]),this.minY=Math.min(this.minY,T[2]),this.maxY=Math.max(this.maxY,T[3])}updateCurvePathMinMax(N,T,A,D,B,U,Y,G,fe,xe){const Se=s.Util.bezierBoundingBox(T,A,D,B,U,Y,G,fe);if(xe){xe[0]=Math.min(xe[0],Se[0],Se[2]),xe[1]=Math.max(xe[1],Se[0],Se[2]),xe[2]=Math.min(xe[2],Se[1],Se[3]),xe[3]=Math.max(xe[3],Se[1],Se[3]);return}this.updateRectMinMax(N,Se)}getPathBoundingBox(){let N=arguments.length>0&&arguments[0]!==void 0?arguments[0]:i.PathType.FILL,T=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const A=[this.minX,this.minY,this.maxX,this.maxY];if(N===i.PathType.STROKE){T||(0,s.unreachable)("Stroke bounding box must include transform.");const D=s.Util.singularValueDecompose2dScale(T),B=D[0]*this.lineWidth/2,U=D[1]*this.lineWidth/2;A[0]-=B,A[1]-=U,A[2]+=B,A[3]+=U}return A}updateClipFromPath(){const N=s.Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(N||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(N){this.clipBox=N,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(){let N=arguments.length>0&&arguments[0]!==void 0?arguments[0]:i.PathType.FILL,T=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return s.Util.intersect(this.clipBox,this.getPathBoundingBox(N,T))}}function P(L,N){if(typeof ImageData<"u"&&N instanceof ImageData){L.putImageData(N,0,0);return}const T=N.height,A=N.width,D=T%b,B=(T-D)/b,U=D===0?B:B+1,Y=L.createImageData(A,b);let G=0,fe;const xe=N.data,Se=Y.data;let Ce,Me,be,ae;if(N.kind===s.ImageKind.GRAYSCALE_1BPP){const J=xe.byteLength,oe=new Uint32Array(Se.buffer,0,Se.byteLength>>2),Q=oe.length,ge=A+7>>3,Te=4294967295,Le=s.FeatureTest.isLittleEndian?4278190080:255;for(Ce=0;Ce<U;Ce++){for(be=Ce<B?b:D,fe=0,Me=0;Me<be;Me++){const Re=J-G;let Ee=0;const ze=Re>ge?A:Re*8-7,Xe=ze&-8;let tt=0,qe=0;for(;Ee<Xe;Ee+=8)qe=xe[G++],oe[fe++]=qe&128?Te:Le,oe[fe++]=qe&64?Te:Le,oe[fe++]=qe&32?Te:Le,oe[fe++]=qe&16?Te:Le,oe[fe++]=qe&8?Te:Le,oe[fe++]=qe&4?Te:Le,oe[fe++]=qe&2?Te:Le,oe[fe++]=qe&1?Te:Le;for(;Ee<ze;Ee++)tt===0&&(qe=xe[G++],tt=128),oe[fe++]=qe&tt?Te:Le,tt>>=1}for(;fe<Q;)oe[fe++]=0;L.putImageData(Y,0,Ce*b)}}else if(N.kind===s.ImageKind.RGBA_32BPP){for(Me=0,ae=A*b*4,Ce=0;Ce<B;Ce++)Se.set(xe.subarray(G,G+ae)),G+=ae,L.putImageData(Y,0,Me),Me+=b;Ce<U&&(ae=A*D*4,Se.set(xe.subarray(G,G+ae)),L.putImageData(Y,0,Me))}else if(N.kind===s.ImageKind.RGB_24BPP)for(be=b,ae=A*be,Ce=0;Ce<U;Ce++){for(Ce>=B&&(be=D,ae=A*be),fe=0,Me=ae;Me--;)Se[fe++]=xe[G++],Se[fe++]=xe[G++],Se[fe++]=xe[G++],Se[fe++]=255;L.putImageData(Y,0,Ce*b)}else throw new Error(`bad image kind: ${N.kind}`)}function F(L,N){if(N.bitmap){L.drawImage(N.bitmap,0,0);return}const T=N.height,A=N.width,D=T%b,B=(T-D)/b,U=D===0?B:B+1,Y=L.createImageData(A,b);let G=0;const fe=N.data,xe=Y.data;for(let Se=0;Se<U;Se++){const Ce=Se<B?b:D;({srcPos:G}=(0,o.convertBlackAndWhiteToRGBA)({src:fe,srcPos:G,dest:xe,width:A,height:Ce,nonBlackColor:0})),L.putImageData(Y,0,Se*b)}}function S(L,N){const T=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const A of T)L[A]!==void 0&&(N[A]=L[A]);L.setLineDash!==void 0&&(N.setLineDash(L.getLineDash()),N.lineDashOffset=L.lineDashOffset)}function I(L){if(L.strokeStyle=L.fillStyle="#000000",L.fillRule="nonzero",L.globalAlpha=1,L.lineWidth=1,L.lineCap="butt",L.lineJoin="miter",L.miterLimit=10,L.globalCompositeOperation="source-over",L.font="10px sans-serif",L.setLineDash!==void 0&&(L.setLineDash([]),L.lineDashOffset=0),!s.isNodeJS){const{filter:N}=L;N!=="none"&&N!==""&&(L.filter="none")}}function w(L,N,T,A){const D=L.length;for(let B=3;B<D;B+=4){const U=L[B];if(U===0)L[B-3]=N,L[B-2]=T,L[B-1]=A;else if(U<255){const Y=255-U;L[B-3]=L[B-3]*U+N*Y>>8,L[B-2]=L[B-2]*U+T*Y>>8,L[B-1]=L[B-1]*U+A*Y>>8}}}function j(L,N,T){const A=L.length,D=1/255;for(let B=3;B<A;B+=4){const U=T?T[L[B]]:L[B];N[B]=N[B]*U*D|0}}function C(L,N,T){const A=L.length;for(let D=3;D<A;D+=4){const B=L[D-3]*77+L[D-2]*152+L[D-1]*28;N[D]=T?N[D]*T[B>>8]>>8:N[D]*B>>16}}function V(L,N,T,A,D,B,U,Y,G,fe,xe){const Se=!!B,Ce=Se?B[0]:0,Me=Se?B[1]:0,be=Se?B[2]:0,ae=D==="Luminosity"?C:j,oe=Math.min(A,Math.ceil(1048576/T));for(let Q=0;Q<A;Q+=oe){const ge=Math.min(oe,A-Q),Te=L.getImageData(Y-fe,Q+(G-xe),T,ge),Le=N.getImageData(Y,Q+G,T,ge);Se&&w(Te.data,Ce,Me,be),ae(Te.data,Le.data,U),N.putImageData(Le,Y,Q+G)}}function O(L,N,T,A){const D=A[0],B=A[1],U=A[2]-D,Y=A[3]-B;U===0||Y===0||(V(N.context,T,U,Y,N.subtype,N.backdrop,N.transferMap,D,B,N.offsetX,N.offsetY),L.save(),L.globalAlpha=1,L.globalCompositeOperation="source-over",L.setTransform(1,0,0,1,0,0),L.drawImage(T.canvas,0,0),L.restore())}function H(L,N){const T=s.Util.singularValueDecompose2dScale(L);T[0]=Math.fround(T[0]),T[1]=Math.fround(T[1]);const A=Math.fround((globalThis.devicePixelRatio||1)*a.PixelsPerInch.PDF_TO_CSS_UNITS);return N!==void 0?N:T[0]<=A||T[1]<=A}const z=["butt","round","square"],pe=["miter","round","bevel"],ee={},he={},ye=class ye{constructor(N,T,A,D,B,U,Y,G){Ie(this,me);let{optionalContentConfig:fe,markedContentStack:xe=null}=U;this.ctx=N,this.current=new R(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=T,this.objs=A,this.canvasFactory=D,this.filterFactory=B,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=xe||[],this.optionalContentConfig=fe,this.cachedCanvases=new d(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=Y,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=G,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(N){let T=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return typeof N=="string"?N.startsWith("g_")?this.commonObjs.get(N):this.objs.get(N):T}beginDrawing(N){let{transform:T,viewport:A,transparency:D=!1,background:B=null}=N;const U=this.ctx.canvas.width,Y=this.ctx.canvas.height,G=this.ctx.fillStyle;if(this.ctx.fillStyle=B||"#ffffff",this.ctx.fillRect(0,0,U,Y),this.ctx.fillStyle=G,D){const fe=this.cachedCanvases.getCanvas("transparent",U,Y);this.compositeCtx=this.ctx,this.transparentCanvas=fe.canvas,this.ctx=fe.context,this.ctx.save(),this.ctx.transform(...(0,a.getCurrentTransform)(this.compositeCtx))}this.ctx.save(),I(this.ctx),T&&(this.ctx.transform(...T),this.outputScaleX=T[0],this.outputScaleY=T[0]),this.ctx.transform(...A.transform),this.viewportScale=A.scale,this.baseTransform=(0,a.getCurrentTransform)(this.ctx)}executeOperatorList(N,T,A,D){const B=N.argsArray,U=N.fnArray;let Y=T||0;const G=B.length;if(G===Y)return Y;const fe=G-Y>_&&typeof A=="function",xe=fe?Date.now()+h:0;let Se=0;const Ce=this.commonObjs,Me=this.objs;let be;for(;;){if(D!==void 0&&Y===D.nextBreakPoint)return D.breakIt(Y,A),Y;if(be=U[Y],be!==s.OPS.dependency)this[be].apply(this,B[Y]);else for(const ae of B[Y]){const J=ae.startsWith("g_")?Ce:Me;if(!J.has(ae))return J.get(ae,A),Y}if(Y++,Y===G)return Y;if(fe&&++Se>_){if(Date.now()>xe)return A(),Y;Se=0}}}endDrawing(){Ae(this,me,Gr).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const N of this._cachedBitmapsMap.values()){for(const T of N.values())typeof HTMLCanvasElement<"u"&&T instanceof HTMLCanvasElement&&(T.width=T.height=0);N.clear()}this._cachedBitmapsMap.clear(),Ae(this,me,Xr).call(this)}_scaleImage(N,T){const A=N.width,D=N.height;let B=Math.max(Math.hypot(T[0],T[1]),1),U=Math.max(Math.hypot(T[2],T[3]),1),Y=A,G=D,fe="prescale1",xe,Se;for(;B>2&&Y>1||U>2&&G>1;){let Ce=Y,Me=G;B>2&&Y>1&&(Ce=Y>=16384?Math.floor(Y/2)-1||1:Math.ceil(Y/2),B/=Y/Ce),U>2&&G>1&&(Me=G>=16384?Math.floor(G/2)-1||1:Math.ceil(G)/2,U/=G/Me),xe=this.cachedCanvases.getCanvas(fe,Ce,Me),Se=xe.context,Se.clearRect(0,0,Ce,Me),Se.drawImage(N,0,0,Y,G,0,0,Ce,Me),N=xe.canvas,Y=Ce,G=Me,fe=fe==="prescale1"?"prescale2":"prescale1"}return{img:N,paintWidth:Y,paintHeight:G}}_createMaskCanvas(N){const T=this.ctx,{width:A,height:D}=N,B=this.current.fillColor,U=this.current.patternFill,Y=(0,a.getCurrentTransform)(T);let G,fe,xe,Se;if((N.bitmap||N.data)&&N.count>1){const Ee=N.bitmap||N.data.buffer;fe=JSON.stringify(U?Y:[Y.slice(0,4),B]),G=this._cachedBitmapsMap.get(Ee),G||(G=new Map,this._cachedBitmapsMap.set(Ee,G));const ze=G.get(fe);if(ze&&!U){const Xe=Math.round(Math.min(Y[0],Y[2])+Y[4]),tt=Math.round(Math.min(Y[1],Y[3])+Y[5]);return{canvas:ze,offsetX:Xe,offsetY:tt}}xe=ze}xe||(Se=this.cachedCanvases.getCanvas("maskCanvas",A,D),F(Se.context,N));let Ce=s.Util.transform(Y,[1/A,0,0,-1/D,0,0]);Ce=s.Util.transform(Ce,[1,0,0,1,0,-D]);const Me=s.Util.applyTransform([0,0],Ce),be=s.Util.applyTransform([A,D],Ce),ae=s.Util.normalizeRect([Me[0],Me[1],be[0],be[1]]),J=Math.round(ae[2]-ae[0])||1,oe=Math.round(ae[3]-ae[1])||1,Q=this.cachedCanvases.getCanvas("fillCanvas",J,oe),ge=Q.context,Te=Math.min(Me[0],be[0]),Le=Math.min(Me[1],be[1]);ge.translate(-Te,-Le),ge.transform(...Ce),xe||(xe=this._scaleImage(Se.canvas,(0,a.getCurrentTransformInverse)(ge)),xe=xe.img,G&&U&&G.set(fe,xe)),ge.imageSmoothingEnabled=H((0,a.getCurrentTransform)(ge),N.interpolate),g(ge,xe,0,0,xe.width,xe.height,0,0,A,D),ge.globalCompositeOperation="source-in";const Re=s.Util.transform((0,a.getCurrentTransformInverse)(ge),[1,0,0,1,-Te,-Le]);return ge.fillStyle=U?B.getPattern(T,this,Re,i.PathType.FILL):B,ge.fillRect(0,0,A,D),G&&!U&&(this.cachedCanvases.delete("fillCanvas"),G.set(fe,Q.canvas)),{canvas:Q.canvas,offsetX:Math.round(Te),offsetY:Math.round(Le)}}setLineWidth(N){N!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=N,this.ctx.lineWidth=N}setLineCap(N){this.ctx.lineCap=z[N]}setLineJoin(N){this.ctx.lineJoin=pe[N]}setMiterLimit(N){this.ctx.miterLimit=N}setDash(N,T){const A=this.ctx;A.setLineDash!==void 0&&(A.setLineDash(N),A.lineDashOffset=T)}setRenderingIntent(N){}setFlatness(N){}setGState(N){for(const[T,A]of N)switch(T){case"LW":this.setLineWidth(A);break;case"LC":this.setLineCap(A);break;case"LJ":this.setLineJoin(A);break;case"ML":this.setMiterLimit(A);break;case"D":this.setDash(A[0],A[1]);break;case"RI":this.setRenderingIntent(A);break;case"FL":this.setFlatness(A);break;case"Font":this.setFont(A[0],A[1]);break;case"CA":this.current.strokeAlpha=A;break;case"ca":this.current.fillAlpha=A,this.ctx.globalAlpha=A;break;case"BM":this.ctx.globalCompositeOperation=A;break;case"SMask":this.current.activeSMask=A?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(A);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const N=this.inSMaskMode;this.current.activeSMask&&!N?this.beginSMaskMode():!this.current.activeSMask&&N&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const N=this.ctx.canvas.width,T=this.ctx.canvas.height,A="smaskGroupAt"+this.groupLevel,D=this.cachedCanvases.getCanvas(A,N,T);this.suspendedCtx=this.ctx,this.ctx=D.context;const B=this.ctx;B.setTransform(...(0,a.getCurrentTransform)(this.suspendedCtx)),S(this.suspendedCtx,B),E(B,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),S(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(N){if(!this.current.activeSMask)return;N?(N[0]=Math.floor(N[0]),N[1]=Math.floor(N[1]),N[2]=Math.ceil(N[2]),N[3]=Math.ceil(N[3])):N=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const T=this.current.activeSMask,A=this.suspendedCtx;O(A,T,this.ctx,N),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}save(){this.inSMaskMode?(S(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const N=this.current;this.stateStack.push(N),this.current=N.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),S(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(N,T,A,D,B,U){this.ctx.transform(N,T,A,D,B,U),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(N,T,A){const D=this.ctx,B=this.current;let U=B.x,Y=B.y,G,fe;const xe=(0,a.getCurrentTransform)(D),Se=xe[0]===0&&xe[3]===0||xe[1]===0&&xe[2]===0,Ce=Se?A.slice(0):null;for(let Me=0,be=0,ae=N.length;Me<ae;Me++)switch(N[Me]|0){case s.OPS.rectangle:U=T[be++],Y=T[be++];const J=T[be++],oe=T[be++],Q=U+J,ge=Y+oe;D.moveTo(U,Y),J===0||oe===0?D.lineTo(Q,ge):(D.lineTo(Q,Y),D.lineTo(Q,ge),D.lineTo(U,ge)),Se||B.updateRectMinMax(xe,[U,Y,Q,ge]),D.closePath();break;case s.OPS.moveTo:U=T[be++],Y=T[be++],D.moveTo(U,Y),Se||B.updatePathMinMax(xe,U,Y);break;case s.OPS.lineTo:U=T[be++],Y=T[be++],D.lineTo(U,Y),Se||B.updatePathMinMax(xe,U,Y);break;case s.OPS.curveTo:G=U,fe=Y,U=T[be+4],Y=T[be+5],D.bezierCurveTo(T[be],T[be+1],T[be+2],T[be+3],U,Y),B.updateCurvePathMinMax(xe,G,fe,T[be],T[be+1],T[be+2],T[be+3],U,Y,Ce),be+=6;break;case s.OPS.curveTo2:G=U,fe=Y,D.bezierCurveTo(U,Y,T[be],T[be+1],T[be+2],T[be+3]),B.updateCurvePathMinMax(xe,G,fe,U,Y,T[be],T[be+1],T[be+2],T[be+3],Ce),U=T[be+2],Y=T[be+3],be+=4;break;case s.OPS.curveTo3:G=U,fe=Y,U=T[be+2],Y=T[be+3],D.bezierCurveTo(T[be],T[be+1],U,Y,U,Y),B.updateCurvePathMinMax(xe,G,fe,T[be],T[be+1],U,Y,U,Y,Ce),be+=4;break;case s.OPS.closePath:D.closePath();break}Se&&B.updateScalingPathMinMax(xe,Ce),B.setCurrentPoint(U,Y)}closePath(){this.ctx.closePath()}stroke(){let N=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const T=this.ctx,A=this.current.strokeColor;T.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof A=="object"&&(A!=null&&A.getPattern)?(T.save(),T.strokeStyle=A.getPattern(T,this,(0,a.getCurrentTransformInverse)(T),i.PathType.STROKE),this.rescaleAndStroke(!1),T.restore()):this.rescaleAndStroke(!0)),N&&this.consumePath(this.current.getClippedPathBoundingBox()),T.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(){let N=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const T=this.ctx,A=this.current.fillColor,D=this.current.patternFill;let B=!1;D&&(T.save(),T.fillStyle=A.getPattern(T,this,(0,a.getCurrentTransformInverse)(T),i.PathType.FILL),B=!0);const U=this.current.getClippedPathBoundingBox();this.contentVisible&&U!==null&&(this.pendingEOFill?(T.fill("evenodd"),this.pendingEOFill=!1):T.fill()),B&&T.restore(),N&&this.consumePath(U)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=ee}eoClip(){this.pendingClip=he}beginText(){this.current.textMatrix=s.IDENTITY_MATRIX,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const N=this.pendingTextPaths,T=this.ctx;if(N===void 0){T.beginPath();return}T.save(),T.beginPath();for(const A of N)T.setTransform(...A.transform),T.translate(A.x,A.y),A.addToPath(T,A.fontSize);T.restore(),T.clip(),T.beginPath(),delete this.pendingTextPaths}setCharSpacing(N){this.current.charSpacing=N}setWordSpacing(N){this.current.wordSpacing=N}setHScale(N){this.current.textHScale=N/100}setLeading(N){this.current.leading=-N}setFont(N,T){var xe;const A=this.commonObjs.get(N),D=this.current;if(!A)throw new Error(`Can't find font for ${N}`);if(D.fontMatrix=A.fontMatrix||s.FONT_IDENTITY_MATRIX,(D.fontMatrix[0]===0||D.fontMatrix[3]===0)&&(0,s.warn)("Invalid font matrix for font "+N),T<0?(T=-T,D.fontDirection=-1):D.fontDirection=1,this.current.font=A,this.current.fontSize=T,A.isType3Font)return;const B=A.loadedName||"sans-serif",U=((xe=A.systemFontInfo)==null?void 0:xe.css)||`"${B}", ${A.fallbackName}`;let Y="normal";A.black?Y="900":A.bold&&(Y="bold");const G=A.italic?"italic":"normal";let fe=T;T<c?fe=c:T>x&&(fe=x),this.current.fontSizeScale=T/fe,this.ctx.font=`${G} ${Y} ${fe}px ${U}`}setTextRenderingMode(N){this.current.textRenderingMode=N}setTextRise(N){this.current.textRise=N}moveText(N,T){this.current.x=this.current.lineX+=N,this.current.y=this.current.lineY+=T}setLeadingMoveText(N,T){this.setLeading(-T),this.moveText(N,T)}setTextMatrix(N,T,A,D,B,U){this.current.textMatrix=[N,T,A,D,B,U],this.current.textMatrixScale=Math.hypot(N,T),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(N,T,A,D){const B=this.ctx,U=this.current,Y=U.font,G=U.textRenderingMode,fe=U.fontSize/U.fontSizeScale,xe=G&s.TextRenderingMode.FILL_STROKE_MASK,Se=!!(G&s.TextRenderingMode.ADD_TO_PATH_FLAG),Ce=U.patternFill&&!Y.missingFile;let Me;(Y.disableFontFace||Se||Ce)&&(Me=Y.getPathGenerator(this.commonObjs,N)),Y.disableFontFace||Ce?(B.save(),B.translate(T,A),B.beginPath(),Me(B,fe),D&&B.setTransform(...D),(xe===s.TextRenderingMode.FILL||xe===s.TextRenderingMode.FILL_STROKE)&&B.fill(),(xe===s.TextRenderingMode.STROKE||xe===s.TextRenderingMode.FILL_STROKE)&&B.stroke(),B.restore()):((xe===s.TextRenderingMode.FILL||xe===s.TextRenderingMode.FILL_STROKE)&&B.fillText(N,T,A),(xe===s.TextRenderingMode.STROKE||xe===s.TextRenderingMode.FILL_STROKE)&&B.strokeText(N,T,A)),Se&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:(0,a.getCurrentTransform)(B),x:T,y:A,fontSize:fe,addToPath:Me})}get isFontSubpixelAAEnabled(){const{context:N}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);N.scale(1.5,1),N.fillText("I",0,10);const T=N.getImageData(0,0,10,10).data;let A=!1;for(let D=3;D<T.length;D+=4)if(T[D]>0&&T[D]<255){A=!0;break}return(0,s.shadow)(this,"isFontSubpixelAAEnabled",A)}showText(N){const T=this.current,A=T.font;if(A.isType3Font)return this.showType3Text(N);const D=T.fontSize;if(D===0)return;const B=this.ctx,U=T.fontSizeScale,Y=T.charSpacing,G=T.wordSpacing,fe=T.fontDirection,xe=T.textHScale*fe,Se=N.length,Ce=A.vertical,Me=Ce?1:-1,be=A.defaultVMetrics,ae=D*T.fontMatrix[0],J=T.textRenderingMode===s.TextRenderingMode.FILL&&!A.disableFontFace&&!T.patternFill;B.save(),B.transform(...T.textMatrix),B.translate(T.x,T.y+T.textRise),fe>0?B.scale(xe,-1):B.scale(xe,1);let oe;if(T.patternFill){B.save();const Re=T.fillColor.getPattern(B,this,(0,a.getCurrentTransformInverse)(B),i.PathType.FILL);oe=(0,a.getCurrentTransform)(B),B.restore(),B.fillStyle=Re}let Q=T.lineWidth;const ge=T.textMatrixScale;if(ge===0||Q===0){const Re=T.textRenderingMode&s.TextRenderingMode.FILL_STROKE_MASK;(Re===s.TextRenderingMode.STROKE||Re===s.TextRenderingMode.FILL_STROKE)&&(Q=this.getSinglePixelWidth())}else Q/=ge;if(U!==1&&(B.scale(U,U),Q/=U),B.lineWidth=Q,A.isInvalidPDFjsFont){const Re=[];let Ee=0;for(const ze of N)Re.push(ze.unicode),Ee+=ze.width;B.fillText(Re.join(""),0,0),T.x+=Ee*ae*xe,B.restore(),this.compose();return}let Te=0,Le;for(Le=0;Le<Se;++Le){const Re=N[Le];if(typeof Re=="number"){Te+=Me*Re*D/1e3;continue}let Ee=!1;const ze=(Re.isSpace?G:0)+Y,Xe=Re.fontChar,tt=Re.accent;let qe,dt,Ze=Re.width;if(Ce){const ht=Re.vmetric||be,ft=-(Re.vmetric?ht[1]:Ze*.5)*ae,pt=ht[2]*ae;Ze=ht?-ht[0]:Ze,qe=ft/U,dt=(Te+pt)/U}else qe=Te/U,dt=0;if(A.remeasure&&Ze>0){const ht=B.measureText(Xe).width*1e3/D*U;if(Ze<ht&&this.isFontSubpixelAAEnabled){const ft=Ze/ht;Ee=!0,B.save(),B.scale(ft,1),qe/=ft}else Ze!==ht&&(qe+=(Ze-ht)/2e3*D/U)}if(this.contentVisible&&(Re.isInFont||A.missingFile)){if(J&&!tt)B.fillText(Xe,qe,dt);else if(this.paintChar(Xe,qe,dt,oe),tt){const ht=qe+D*tt.offset.x/U,ft=dt-D*tt.offset.y/U;this.paintChar(tt.fontChar,ht,ft,oe)}}const nt=Ce?Ze*ae-ze*fe:Ze*ae+ze*fe;Te+=nt,Ee&&B.restore()}Ce?T.y-=Te:T.x+=Te*xe,B.restore(),this.compose()}showType3Text(N){const T=this.ctx,A=this.current,D=A.font,B=A.fontSize,U=A.fontDirection,Y=D.vertical?1:-1,G=A.charSpacing,fe=A.wordSpacing,xe=A.textHScale*U,Se=A.fontMatrix||s.FONT_IDENTITY_MATRIX,Ce=N.length,Me=A.textRenderingMode===s.TextRenderingMode.INVISIBLE;let be,ae,J,oe;if(!(Me||B===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,T.save(),T.transform(...A.textMatrix),T.translate(A.x,A.y),T.scale(xe,U),be=0;be<Ce;++be){if(ae=N[be],typeof ae=="number"){oe=Y*ae*B/1e3,this.ctx.translate(oe,0),A.x+=oe*xe;continue}const Q=(ae.isSpace?fe:0)+G,ge=D.charProcOperatorList[ae.operatorListId];if(!ge){(0,s.warn)(`Type3 character "${ae.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=ae,this.save(),T.scale(B,B),T.transform(...Se),this.executeOperatorList(ge),this.restore()),J=s.Util.applyTransform([ae.width,0],Se)[0]*B+Q,T.translate(J,0),A.x+=J*xe}T.restore(),this.processingType3=null}}setCharWidth(N,T){}setCharWidthAndBounds(N,T,A,D,B,U){this.ctx.rect(A,D,B-A,U-D),this.ctx.clip(),this.endPath()}getColorN_Pattern(N){let T;if(N[0]==="TilingPattern"){const A=N[1],D=this.baseTransform||(0,a.getCurrentTransform)(this.ctx),B={createCanvasGraphics:U=>new ye(U,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};T=new i.TilingPattern(N,A,this.ctx,B,D)}else T=this._getPattern(N[1],N[2]);return T}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(N,T,A){const D=s.Util.makeHexColor(N,T,A);this.ctx.strokeStyle=D,this.current.strokeColor=D}setFillRGBColor(N,T,A){const D=s.Util.makeHexColor(N,T,A);this.ctx.fillStyle=D,this.current.fillColor=D,this.current.patternFill=!1}_getPattern(N){let T=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,A;return this.cachedPatterns.has(N)?A=this.cachedPatterns.get(N):(A=(0,i.getShadingPattern)(this.getObject(N)),this.cachedPatterns.set(N,A)),T&&(A.matrix=T),A}shadingFill(N){if(!this.contentVisible)return;const T=this.ctx;this.save();const A=this._getPattern(N);T.fillStyle=A.getPattern(T,this,(0,a.getCurrentTransformInverse)(T),i.PathType.SHADING);const D=(0,a.getCurrentTransformInverse)(T);if(D){const{width:B,height:U}=T.canvas,[Y,G,fe,xe]=s.Util.getAxialAlignedBoundingBox([0,0,B,U],D);this.ctx.fillRect(Y,G,fe-Y,xe-G)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){(0,s.unreachable)("Should not call beginInlineImage")}beginImageData(){(0,s.unreachable)("Should not call beginImageData")}paintFormXObjectBegin(N,T){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),Array.isArray(N)&&N.length===6&&this.transform(...N),this.baseTransform=(0,a.getCurrentTransform)(this.ctx),T)){const A=T[2]-T[0],D=T[3]-T[1];this.ctx.rect(T[0],T[1],A,D),this.current.updateRectMinMax((0,a.getCurrentTransform)(this.ctx),T),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(N){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const T=this.ctx;N.isolated||(0,s.info)("TODO: Support non-isolated groups."),N.knockout&&(0,s.warn)("Knockout groups not supported.");const A=(0,a.getCurrentTransform)(T);if(N.matrix&&T.transform(...N.matrix),!N.bbox)throw new Error("Bounding box is required.");let D=s.Util.getAxialAlignedBoundingBox(N.bbox,(0,a.getCurrentTransform)(T));const B=[0,0,T.canvas.width,T.canvas.height];D=s.Util.intersect(D,B)||[0,0,0,0];const U=Math.floor(D[0]),Y=Math.floor(D[1]);let G=Math.max(Math.ceil(D[2])-U,1),fe=Math.max(Math.ceil(D[3])-Y,1),xe=1,Se=1;G>u&&(xe=G/u,G=u),fe>u&&(Se=fe/u,fe=u),this.current.startNewPathAndClipBox([0,0,G,fe]);let Ce="groupAt"+this.groupLevel;N.smask&&(Ce+="_smask_"+this.smaskCounter++%2);const Me=this.cachedCanvases.getCanvas(Ce,G,fe),be=Me.context;be.scale(1/xe,1/Se),be.translate(-U,-Y),be.transform(...A),N.smask?this.smaskStack.push({canvas:Me.canvas,context:be,offsetX:U,offsetY:Y,scaleX:xe,scaleY:Se,subtype:N.smask.subtype,backdrop:N.smask.backdrop,transferMap:N.smask.transferMap||null,startTransformInverse:null}):(T.setTransform(1,0,0,1,0,0),T.translate(U,Y),T.scale(xe,Se),T.save()),S(T,be),this.ctx=be,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(T),this.groupLevel++}endGroup(N){if(!this.contentVisible)return;this.groupLevel--;const T=this.ctx,A=this.groupStack.pop();if(this.ctx=A,this.ctx.imageSmoothingEnabled=!1,N.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const D=(0,a.getCurrentTransform)(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...D);const B=s.Util.getAxialAlignedBoundingBox([0,0,T.canvas.width,T.canvas.height],D);this.ctx.drawImage(T.canvas,0,0),this.ctx.restore(),this.compose(B)}}beginAnnotation(N,T,A,D,B){if(Ae(this,me,Gr).call(this),I(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),Array.isArray(T)&&T.length===4){const U=T[2]-T[0],Y=T[3]-T[1];if(B&&this.annotationCanvasMap){A=A.slice(),A[4]-=T[0],A[5]-=T[1],T=T.slice(),T[0]=T[1]=0,T[2]=U,T[3]=Y;const[G,fe]=s.Util.singularValueDecompose2dScale((0,a.getCurrentTransform)(this.ctx)),{viewportScale:xe}=this,Se=Math.ceil(U*this.outputScaleX*xe),Ce=Math.ceil(Y*this.outputScaleY*xe);this.annotationCanvas=this.canvasFactory.create(Se,Ce);const{canvas:Me,context:be}=this.annotationCanvas;this.annotationCanvasMap.set(N,Me),this.annotationCanvas.savedCtx=this.ctx,this.ctx=be,this.ctx.save(),this.ctx.setTransform(G,0,0,-fe,0,Y*fe),I(this.ctx)}else I(this.ctx),this.ctx.rect(T[0],T[1],U,Y),this.ctx.clip(),this.endPath()}this.current=new R(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...A),this.transform(...D)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),Ae(this,me,Xr).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(N){if(!this.contentVisible)return;const T=N.count;N=this.getObject(N.data,N),N.count=T;const A=this.ctx,D=this.processingType3;if(D&&(D.compiled===void 0&&(D.compiled=y(N)),D.compiled)){D.compiled(A);return}const B=this._createMaskCanvas(N),U=B.canvas;A.save(),A.setTransform(1,0,0,1,0,0),A.drawImage(U,B.offsetX,B.offsetY),A.restore(),this.compose()}paintImageMaskXObjectRepeat(N,T){let A=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,D=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,B=arguments.length>4?arguments[4]:void 0,U=arguments.length>5?arguments[5]:void 0;if(!this.contentVisible)return;N=this.getObject(N.data,N);const Y=this.ctx;Y.save();const G=(0,a.getCurrentTransform)(Y);Y.transform(T,A,D,B,0,0);const fe=this._createMaskCanvas(N);Y.setTransform(1,0,0,1,fe.offsetX-G[4],fe.offsetY-G[5]);for(let xe=0,Se=U.length;xe<Se;xe+=2){const Ce=s.Util.transform(G,[T,A,D,B,U[xe],U[xe+1]]),[Me,be]=s.Util.applyTransform([0,0],Ce);Y.drawImage(fe.canvas,Me,be)}Y.restore(),this.compose()}paintImageMaskXObjectGroup(N){if(!this.contentVisible)return;const T=this.ctx,A=this.current.fillColor,D=this.current.patternFill;for(const B of N){const{data:U,width:Y,height:G,transform:fe}=B,xe=this.cachedCanvases.getCanvas("maskCanvas",Y,G),Se=xe.context;Se.save();const Ce=this.getObject(U,B);F(Se,Ce),Se.globalCompositeOperation="source-in",Se.fillStyle=D?A.getPattern(Se,this,(0,a.getCurrentTransformInverse)(T),i.PathType.FILL):A,Se.fillRect(0,0,Y,G),Se.restore(),T.save(),T.transform(...fe),T.scale(1,-1),g(T,xe.canvas,0,0,Y,G,0,-1,1,1),T.restore()}this.compose()}paintImageXObject(N){if(!this.contentVisible)return;const T=this.getObject(N);if(!T){(0,s.warn)("Dependent image isn't ready yet");return}this.paintInlineImageXObject(T)}paintImageXObjectRepeat(N,T,A,D){if(!this.contentVisible)return;const B=this.getObject(N);if(!B){(0,s.warn)("Dependent image isn't ready yet");return}const U=B.width,Y=B.height,G=[];for(let fe=0,xe=D.length;fe<xe;fe+=2)G.push({transform:[T,0,0,A,D[fe],D[fe+1]],x:0,y:0,w:U,h:Y});this.paintInlineImageXObjectGroup(B,G)}applyTransferMapsToCanvas(N){return this.current.transferMaps!=="none"&&(N.filter=this.current.transferMaps,N.drawImage(N.canvas,0,0),N.filter="none"),N.canvas}applyTransferMapsToBitmap(N){if(this.current.transferMaps==="none")return N.bitmap;const{bitmap:T,width:A,height:D}=N,B=this.cachedCanvases.getCanvas("inlineImage",A,D),U=B.context;return U.filter=this.current.transferMaps,U.drawImage(T,0,0),U.filter="none",B.canvas}paintInlineImageXObject(N){if(!this.contentVisible)return;const T=N.width,A=N.height,D=this.ctx;if(this.save(),!s.isNodeJS){const{filter:Y}=D;Y!=="none"&&Y!==""&&(D.filter="none")}D.scale(1/T,-1/A);let B;if(N.bitmap)B=this.applyTransferMapsToBitmap(N);else if(typeof HTMLElement=="function"&&N instanceof HTMLElement||!N.data)B=N;else{const G=this.cachedCanvases.getCanvas("inlineImage",T,A).context;P(G,N),B=this.applyTransferMapsToCanvas(G)}const U=this._scaleImage(B,(0,a.getCurrentTransformInverse)(D));D.imageSmoothingEnabled=H((0,a.getCurrentTransform)(D),N.interpolate),g(D,U.img,0,0,U.paintWidth,U.paintHeight,0,-A,T,A),this.compose(),this.restore()}paintInlineImageXObjectGroup(N,T){if(!this.contentVisible)return;const A=this.ctx;let D;if(N.bitmap)D=N.bitmap;else{const B=N.width,U=N.height,G=this.cachedCanvases.getCanvas("inlineImage",B,U).context;P(G,N),D=this.applyTransferMapsToCanvas(G)}for(const B of T)A.save(),A.transform(...B.transform),A.scale(1,-1),g(A,D,B.x,B.y,B.w,B.h,0,-1,1,1),A.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(N){}markPointProps(N,T){}beginMarkedContent(N){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(N,T){N==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(T)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(N){const T=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(N);const A=this.ctx;this.pendingClip&&(T||(this.pendingClip===he?A.clip("evenodd"):A.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),A.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const N=(0,a.getCurrentTransform)(this.ctx);if(N[1]===0&&N[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(N[0]),Math.abs(N[3]));else{const T=Math.abs(N[0]*N[3]-N[2]*N[1]),A=Math.hypot(N[0],N[2]),D=Math.hypot(N[1],N[3]);this._cachedGetSinglePixelWidth=Math.max(A,D)/T}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:N}=this.current,{a:T,b:A,c:D,d:B}=this.ctx.getTransform();let U,Y;if(A===0&&D===0){const G=Math.abs(T),fe=Math.abs(B);if(G===fe)if(N===0)U=Y=1/G;else{const xe=G*N;U=Y=xe<1?1/xe:1}else if(N===0)U=1/G,Y=1/fe;else{const xe=G*N,Se=fe*N;U=xe<1?1/xe:1,Y=Se<1?1/Se:1}}else{const G=Math.abs(T*B-A*D),fe=Math.hypot(T,A),xe=Math.hypot(D,B);if(N===0)U=xe/G,Y=fe/G;else{const Se=N*G;U=xe>Se?xe/Se:1,Y=fe>Se?fe/Se:1}}this._cachedScaleForStroking[0]=U,this._cachedScaleForStroking[1]=Y}return this._cachedScaleForStroking}rescaleAndStroke(N){const{ctx:T}=this,{lineWidth:A}=this.current,[D,B]=this.getScaleForStroking();if(T.lineWidth=A||1,D===1&&B===1){T.stroke();return}const U=T.getLineDash();if(N&&T.save(),T.scale(D,B),U.length>0){const Y=Math.max(D,B);T.setLineDash(U.map(G=>G/Y)),T.lineDashOffset/=Y}T.stroke(),N&&T.restore()}isContentVisible(){for(let N=this.markedContentStack.length-1;N>=0;N--)if(!this.markedContentStack[N].visible)return!1;return!0}};me=new WeakSet,Gr=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},Xr=function(){if(this.pageColors){const N=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(N!=="none"){const T=this.ctx.filter;this.ctx.filter=N,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=T}}};let re=ye;r.CanvasGraphics=re;for(const L in s.OPS)re.prototype[L]!==void 0&&(re.prototype[s.OPS[L]]=re.prototype[L])},(t,r,e)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.TilingPattern=r.PathType=void 0,r.getShadingPattern=b,e(2);var s=e(1),a=e(168);const i={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};r.PathType=i;function o(y,R){if(!R)return;const P=R[2]-R[0],F=R[3]-R[1],S=new Path2D;S.rect(R[0],R[1],P,F),y.clip(S)}class c{constructor(){this.constructor===c&&(0,s.unreachable)("Cannot initialize BaseShadingPattern.")}getPattern(){(0,s.unreachable)("Abstract method `getPattern` called.")}}class x extends c{constructor(R){super(),this._type=R[1],this._bbox=R[2],this._colorStops=R[3],this._p0=R[4],this._p1=R[5],this._r0=R[6],this._r1=R[7],this.matrix=null}_createGradient(R){let P;this._type==="axial"?P=R.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(P=R.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const F of this._colorStops)P.addColorStop(F[0],F[1]);return P}getPattern(R,P,F,S){let I;if(S===i.STROKE||S===i.FILL){const w=P.current.getClippedPathBoundingBox(S,(0,a.getCurrentTransform)(R))||[0,0,0,0],j=Math.ceil(w[2]-w[0])||1,C=Math.ceil(w[3]-w[1])||1,V=P.cachedCanvases.getCanvas("pattern",j,C,!0),O=V.context;O.clearRect(0,0,O.canvas.width,O.canvas.height),O.beginPath(),O.rect(0,0,O.canvas.width,O.canvas.height),O.translate(-w[0],-w[1]),F=s.Util.transform(F,[1,0,0,1,w[0],w[1]]),O.transform(...P.baseTransform),this.matrix&&O.transform(...this.matrix),o(O,this._bbox),O.fillStyle=this._createGradient(O),O.fill(),I=R.createPattern(V.canvas,"no-repeat");const H=new DOMMatrix(F);I.setTransform(H)}else o(R,this._bbox),I=this._createGradient(R);return I}}function u(y,R,P,F,S,I,w,j){const C=R.coords,V=R.colors,O=y.data,H=y.width*4;let z;C[P+1]>C[F+1]&&(z=P,P=F,F=z,z=I,I=w,w=z),C[F+1]>C[S+1]&&(z=F,F=S,S=z,z=w,w=j,j=z),C[P+1]>C[F+1]&&(z=P,P=F,F=z,z=I,I=w,w=z);const pe=(C[P]+R.offsetX)*R.scaleX,ee=(C[P+1]+R.offsetY)*R.scaleY,he=(C[F]+R.offsetX)*R.scaleX,re=(C[F+1]+R.offsetY)*R.scaleY,me=(C[S]+R.offsetX)*R.scaleX,te=(C[S+1]+R.offsetY)*R.scaleY;if(ee>=te)return;const ce=V[I],ye=V[I+1],L=V[I+2],N=V[w],T=V[w+1],A=V[w+2],D=V[j],B=V[j+1],U=V[j+2],Y=Math.round(ee),G=Math.round(te);let fe,xe,Se,Ce,Me,be,ae,J;for(let oe=Y;oe<=G;oe++){if(oe<re){const Re=oe<ee?0:(ee-oe)/(ee-re);fe=pe-(pe-he)*Re,xe=ce-(ce-N)*Re,Se=ye-(ye-T)*Re,Ce=L-(L-A)*Re}else{let Re;oe>te?Re=1:re===te?Re=0:Re=(re-oe)/(re-te),fe=he-(he-me)*Re,xe=N-(N-D)*Re,Se=T-(T-B)*Re,Ce=A-(A-U)*Re}let Q;oe<ee?Q=0:oe>te?Q=1:Q=(ee-oe)/(ee-te),Me=pe-(pe-me)*Q,be=ce-(ce-D)*Q,ae=ye-(ye-B)*Q,J=L-(L-U)*Q;const ge=Math.round(Math.min(fe,Me)),Te=Math.round(Math.max(fe,Me));let Le=H*oe+ge*4;for(let Re=ge;Re<=Te;Re++)Q=(fe-Re)/(fe-Me),Q<0?Q=0:Q>1&&(Q=1),O[Le++]=xe-(xe-be)*Q|0,O[Le++]=Se-(Se-ae)*Q|0,O[Le++]=Ce-(Ce-J)*Q|0,O[Le++]=255}}function h(y,R,P){const F=R.coords,S=R.colors;let I,w;switch(R.type){case"lattice":const j=R.verticesPerRow,C=Math.floor(F.length/j)-1,V=j-1;for(I=0;I<C;I++){let O=I*j;for(let H=0;H<V;H++,O++)u(y,P,F[O],F[O+1],F[O+j],S[O],S[O+1],S[O+j]),u(y,P,F[O+j+1],F[O+1],F[O+j],S[O+j+1],S[O+1],S[O+j])}break;case"triangles":for(I=0,w=F.length;I<w;I+=3)u(y,P,F[I],F[I+1],F[I+2],S[I],S[I+1],S[I+2]);break;default:throw new Error("illegal figure")}}class _ extends c{constructor(R){super(),this._coords=R[2],this._colors=R[3],this._figures=R[4],this._bounds=R[5],this._bbox=R[7],this._background=R[8],this.matrix=null}_createMeshCanvas(R,P,F){const j=Math.floor(this._bounds[0]),C=Math.floor(this._bounds[1]),V=Math.ceil(this._bounds[2])-j,O=Math.ceil(this._bounds[3])-C,H=Math.min(Math.ceil(Math.abs(V*R[0]*1.1)),3e3),z=Math.min(Math.ceil(Math.abs(O*R[1]*1.1)),3e3),pe=V/H,ee=O/z,he={coords:this._coords,colors:this._colors,offsetX:-j,offsetY:-C,scaleX:1/pe,scaleY:1/ee},re=H+2*2,me=z+2*2,te=F.getCanvas("mesh",re,me,!1),ce=te.context,ye=ce.createImageData(H,z);if(P){const N=ye.data;for(let T=0,A=N.length;T<A;T+=4)N[T]=P[0],N[T+1]=P[1],N[T+2]=P[2],N[T+3]=255}for(const N of this._figures)h(ye,N,he);return ce.putImageData(ye,2,2),{canvas:te.canvas,offsetX:j-2*pe,offsetY:C-2*ee,scaleX:pe,scaleY:ee}}getPattern(R,P,F,S){o(R,this._bbox);let I;if(S===i.SHADING)I=s.Util.singularValueDecompose2dScale((0,a.getCurrentTransform)(R));else if(I=s.Util.singularValueDecompose2dScale(P.baseTransform),this.matrix){const j=s.Util.singularValueDecompose2dScale(this.matrix);I=[I[0]*j[0],I[1]*j[1]]}const w=this._createMeshCanvas(I,S===i.SHADING?null:this._background,P.cachedCanvases);return S!==i.SHADING&&(R.setTransform(...P.baseTransform),this.matrix&&R.transform(...this.matrix)),R.translate(w.offsetX,w.offsetY),R.scale(w.scaleX,w.scaleY),R.createPattern(w.canvas,"no-repeat")}}class v extends c{getPattern(){return"hotpink"}}function b(y){switch(y[0]){case"RadialAxial":return new x(y);case"Mesh":return new _(y);case"Dummy":return new v}throw new Error(`Unknown IR type: ${y[0]}`)}const E={COLORED:1,UNCOLORED:2},g=class g{constructor(R,P,F,S,I){this.operatorList=R[2],this.matrix=R[3]||[1,0,0,1,0,0],this.bbox=R[4],this.xstep=R[5],this.ystep=R[6],this.paintType=R[7],this.tilingType=R[8],this.color=P,this.ctx=F,this.canvasGraphicsFactory=S,this.baseTransform=I}createPatternCanvas(R){const P=this.operatorList,F=this.bbox,S=this.xstep,I=this.ystep,w=this.paintType,j=this.tilingType,C=this.color,V=this.canvasGraphicsFactory;(0,s.info)("TilingType: "+j);const O=F[0],H=F[1],z=F[2],pe=F[3],ee=s.Util.singularValueDecompose2dScale(this.matrix),he=s.Util.singularValueDecompose2dScale(this.baseTransform),re=[ee[0]*he[0],ee[1]*he[1]],me=this.getSizeAndScale(S,this.ctx.canvas.width,re[0]),te=this.getSizeAndScale(I,this.ctx.canvas.height,re[1]),ce=R.cachedCanvases.getCanvas("pattern",me.size,te.size,!0),ye=ce.context,L=V.createCanvasGraphics(ye);L.groupLevel=R.groupLevel,this.setFillAndStrokeStyleToContext(L,w,C);let N=O,T=H,A=z,D=pe;return O<0&&(N=0,A+=Math.abs(O)),H<0&&(T=0,D+=Math.abs(H)),ye.translate(-(me.scale*N),-(te.scale*T)),L.transform(me.scale,0,0,te.scale,0,0),ye.save(),this.clipBbox(L,N,T,A,D),L.baseTransform=(0,a.getCurrentTransform)(L.ctx),L.executeOperatorList(P),L.endDrawing(),{canvas:ce.canvas,scaleX:me.scale,scaleY:te.scale,offsetX:N,offsetY:T}}getSizeAndScale(R,P,F){R=Math.abs(R);const S=Math.max(g.MAX_PATTERN_SIZE,P);let I=Math.ceil(R*F);return I>=S?I=S:F=I/R,{scale:F,size:I}}clipBbox(R,P,F,S,I){const w=S-P,j=I-F;R.ctx.rect(P,F,w,j),R.current.updateRectMinMax((0,a.getCurrentTransform)(R.ctx),[P,F,S,I]),R.clip(),R.endPath()}setFillAndStrokeStyleToContext(R,P,F){const S=R.ctx,I=R.current;switch(P){case E.COLORED:const w=this.ctx;S.fillStyle=w.fillStyle,S.strokeStyle=w.strokeStyle,I.fillColor=w.fillStyle,I.strokeColor=w.strokeStyle;break;case E.UNCOLORED:const j=s.Util.makeHexColor(F[0],F[1],F[2]);S.fillStyle=j,S.strokeStyle=j,I.fillColor=j,I.strokeColor=j;break;default:throw new s.FormatError(`Unsupported paint type: ${P}`)}}getPattern(R,P,F,S){let I=F;S!==i.SHADING&&(I=s.Util.transform(I,P.baseTransform),this.matrix&&(I=s.Util.transform(I,this.matrix)));const w=this.createPatternCanvas(P);let j=new DOMMatrix(I);j=j.translate(w.offsetX,w.offsetY),j=j.scale(1/w.scaleX,1/w.scaleY);const C=R.createPattern(w.canvas,"repeat");return C.setTransform(j),C}};wt(g,"MAX_PATTERN_SIZE",3e3);let d=g;r.TilingPattern=d},(t,r,e)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.convertBlackAndWhiteToRGBA=i,r.convertToRGBA=a,r.grayToRGBA=c,e(93),e(101),e(102),e(105),e(107),e(109),e(113),e(116),e(123);var s=e(1);function a(x){switch(x.kind){case s.ImageKind.GRAYSCALE_1BPP:return i(x);case s.ImageKind.RGB_24BPP:return o(x)}return null}function i(x){let{src:u,srcPos:h=0,dest:_,width:v,height:b,nonBlackColor:E=4294967295,inverseDecode:d=!1}=x;const g=s.FeatureTest.isLittleEndian?4278190080:255,[y,R]=d?[E,g]:[g,E],P=v>>3,F=v&7,S=u.length;_=new Uint32Array(_.buffer);let I=0;for(let w=0;w<b;w++){for(const C=h+P;h<C;h++){const V=h<S?u[h]:255;_[I++]=V&128?R:y,_[I++]=V&64?R:y,_[I++]=V&32?R:y,_[I++]=V&16?R:y,_[I++]=V&8?R:y,_[I++]=V&4?R:y,_[I++]=V&2?R:y,_[I++]=V&1?R:y}if(F===0)continue;const j=h<S?u[h++]:255;for(let C=0;C<F;C++)_[I++]=j&1<<7-C?R:y}return{srcPos:h,destPos:I}}function o(x){let{src:u,srcPos:h=0,dest:_,destPos:v=0,width:b,height:E}=x,d=0;const g=u.length>>2,y=new Uint32Array(u.buffer,h,g);if(s.FeatureTest.isLittleEndian){for(;d<g-2;d+=3,v+=4){const R=y[d],P=y[d+1],F=y[d+2];_[v]=R|4278190080,_[v+1]=R>>>24|P<<8|4278190080,_[v+2]=P>>>16|F<<16|4278190080,_[v+3]=F>>>8|4278190080}for(let R=d*4,P=u.length;R<P;R+=3)_[v++]=u[R]|u[R+1]<<8|u[R+2]<<16|4278190080}else{for(;d<g-2;d+=3,v+=4){const R=y[d],P=y[d+1],F=y[d+2];_[v]=R|255,_[v+1]=R<<24|P>>>8|255,_[v+2]=P<<16|F>>>16|255,_[v+3]=F<<8|255}for(let R=d*4,P=u.length;R<P;R+=3)_[v++]=u[R]<<24|u[R+1]<<16|u[R+2]<<8|255}return{srcPos:h,destPos:v}}function c(x,u){if(s.FeatureTest.isLittleEndian)for(let h=0,_=x.length;h<_;h++)u[h]=x[h]*65793|4278190080;else for(let h=0,_=x.length;h<_;h++)u[h]=x[h]*16843008|255}},(t,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.GlobalWorkerOptions=void 0;const e=Object.create(null);r.GlobalWorkerOptions=e,e.workerPort=null,e.workerSrc=""},(t,r,e)=>{var x,As,Rs,_r;Object.defineProperty(r,"__esModule",{value:!0}),r.MessageHandler=void 0,e(2);var s=e(1);const a={DATA:1,ERROR:2},i={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function o(v){switch(v instanceof Error||typeof v=="object"&&v!==null||(0,s.unreachable)('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),v.name){case"AbortException":return new s.AbortException(v.message);case"MissingPDFException":return new s.MissingPDFException(v.message);case"PasswordException":return new s.PasswordException(v.message,v.code);case"UnexpectedResponseException":return new s.UnexpectedResponseException(v.message,v.status);case"UnknownErrorException":return new s.UnknownErrorException(v.message,v.details);default:return new s.UnknownErrorException(v.message,v.toString())}}class c{constructor(b,E,d){Ie(this,x);this.sourceName=b,this.targetName=E,this.comObj=d,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=g=>{const y=g.data;if(y.targetName!==this.sourceName)return;if(y.stream){Ae(this,x,Rs).call(this,y);return}if(y.callback){const P=y.callbackId,F=this.callbackCapabilities[P];if(!F)throw new Error(`Cannot resolve callback ${P}`);if(delete this.callbackCapabilities[P],y.callback===a.DATA)F.resolve(y.data);else if(y.callback===a.ERROR)F.reject(o(y.reason));else throw new Error("Unexpected callback case");return}const R=this.actionHandler[y.action];if(!R)throw new Error(`Unknown action from worker: ${y.action}`);if(y.callbackId){const P=this.sourceName,F=y.sourceName;new Promise(function(S){S(R(y.data))}).then(function(S){d.postMessage({sourceName:P,targetName:F,callback:a.DATA,callbackId:y.callbackId,data:S})},function(S){d.postMessage({sourceName:P,targetName:F,callback:a.ERROR,callbackId:y.callbackId,reason:o(S)})});return}if(y.streamId){Ae(this,x,As).call(this,y);return}R(y.data)},d.addEventListener("message",this._onComObjOnMessage)}on(b,E){const d=this.actionHandler;if(d[b])throw new Error(`There is already an actionName called "${b}"`);d[b]=E}send(b,E,d){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:b,data:E},d)}sendWithPromise(b,E,d){const g=this.callbackId++,y=new s.PromiseCapability;this.callbackCapabilities[g]=y;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:b,callbackId:g,data:E},d)}catch(R){y.reject(R)}return y.promise}sendWithStream(b,E,d,g){const y=this.streamId++,R=this.sourceName,P=this.targetName,F=this.comObj;return new ReadableStream({start:S=>{const I=new s.PromiseCapability;return this.streamControllers[y]={controller:S,startCall:I,pullCall:null,cancelCall:null,isClosed:!1},F.postMessage({sourceName:R,targetName:P,action:b,streamId:y,data:E,desiredSize:S.desiredSize},g),I.promise},pull:S=>{const I=new s.PromiseCapability;return this.streamControllers[y].pullCall=I,F.postMessage({sourceName:R,targetName:P,stream:i.PULL,streamId:y,desiredSize:S.desiredSize}),I.promise},cancel:S=>{(0,s.assert)(S instanceof Error,"cancel must have a valid reason");const I=new s.PromiseCapability;return this.streamControllers[y].cancelCall=I,this.streamControllers[y].isClosed=!0,F.postMessage({sourceName:R,targetName:P,stream:i.CANCEL,streamId:y,reason:o(S)}),I.promise}},d)}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}x=new WeakSet,As=function(b){const E=b.streamId,d=this.sourceName,g=b.sourceName,y=this.comObj,R=this,P=this.actionHandler[b.action],F={enqueue(S){let I=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,w=arguments.length>2?arguments[2]:void 0;if(this.isCancelled)return;const j=this.desiredSize;this.desiredSize-=I,j>0&&this.desiredSize<=0&&(this.sinkCapability=new s.PromiseCapability,this.ready=this.sinkCapability.promise),y.postMessage({sourceName:d,targetName:g,stream:i.ENQUEUE,streamId:E,chunk:S},w)},close(){this.isCancelled||(this.isCancelled=!0,y.postMessage({sourceName:d,targetName:g,stream:i.CLOSE,streamId:E}),delete R.streamSinks[E])},error(S){(0,s.assert)(S instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,y.postMessage({sourceName:d,targetName:g,stream:i.ERROR,streamId:E,reason:o(S)}))},sinkCapability:new s.PromiseCapability,onPull:null,onCancel:null,isCancelled:!1,desiredSize:b.desiredSize,ready:null};F.sinkCapability.resolve(),F.ready=F.sinkCapability.promise,this.streamSinks[E]=F,new Promise(function(S){S(P(b.data,F))}).then(function(){y.postMessage({sourceName:d,targetName:g,stream:i.START_COMPLETE,streamId:E,success:!0})},function(S){y.postMessage({sourceName:d,targetName:g,stream:i.START_COMPLETE,streamId:E,reason:o(S)})})},Rs=function(b){const E=b.streamId,d=this.sourceName,g=b.sourceName,y=this.comObj,R=this.streamControllers[E],P=this.streamSinks[E];switch(b.stream){case i.START_COMPLETE:b.success?R.startCall.resolve():R.startCall.reject(o(b.reason));break;case i.PULL_COMPLETE:b.success?R.pullCall.resolve():R.pullCall.reject(o(b.reason));break;case i.PULL:if(!P){y.postMessage({sourceName:d,targetName:g,stream:i.PULL_COMPLETE,streamId:E,success:!0});break}P.desiredSize<=0&&b.desiredSize>0&&P.sinkCapability.resolve(),P.desiredSize=b.desiredSize,new Promise(function(F){var S;F((S=P.onPull)==null?void 0:S.call(P))}).then(function(){y.postMessage({sourceName:d,targetName:g,stream:i.PULL_COMPLETE,streamId:E,success:!0})},function(F){y.postMessage({sourceName:d,targetName:g,stream:i.PULL_COMPLETE,streamId:E,reason:o(F)})});break;case i.ENQUEUE:if((0,s.assert)(R,"enqueue should have stream controller"),R.isClosed)break;R.controller.enqueue(b.chunk);break;case i.CLOSE:if((0,s.assert)(R,"close should have stream controller"),R.isClosed)break;R.isClosed=!0,R.controller.close(),Ae(this,x,_r).call(this,R,E);break;case i.ERROR:(0,s.assert)(R,"error should have stream controller"),R.controller.error(o(b.reason)),Ae(this,x,_r).call(this,R,E);break;case i.CANCEL_COMPLETE:b.success?R.cancelCall.resolve():R.cancelCall.reject(o(b.reason)),Ae(this,x,_r).call(this,R,E);break;case i.CANCEL:if(!P)break;new Promise(function(F){var S;F((S=P.onCancel)==null?void 0:S.call(P,o(b.reason)))}).then(function(){y.postMessage({sourceName:d,targetName:g,stream:i.CANCEL_COMPLETE,streamId:E,success:!0})},function(F){y.postMessage({sourceName:d,targetName:g,stream:i.CANCEL_COMPLETE,streamId:E,reason:o(F)})}),P.sinkCapability.reject(o(b.reason)),P.isCancelled=!0,delete this.streamSinks[E];break;default:throw new Error("Unexpected stream case")}},_r=async function(b,E){var d,g,y;await Promise.allSettled([(d=b.startCall)==null?void 0:d.promise,(g=b.pullCall)==null?void 0:g.promise,(y=b.cancelCall)==null?void 0:y.promise]),delete this.streamControllers[E]},r.MessageHandler=c},(t,r,e)=>{var i,o;Object.defineProperty(r,"__esModule",{value:!0}),r.Metadata=void 0;var s=e(1);class a{constructor(x){Ie(this,i);Ie(this,o);let{parsedData:u,rawData:h}=x;ke(this,i,u),ke(this,o,h)}getRaw(){return M(this,o)}get(x){return M(this,i).get(x)??null}getAll(){return(0,s.objectFromMap)(M(this,i))}has(x){return M(this,i).has(x)}}i=new WeakMap,o=new WeakMap,r.Metadata=a},(t,r,e)=>{var x,u,h,_,v,b,Kr;Object.defineProperty(r,"__esModule",{value:!0}),r.OptionalContentConfig=void 0;var s=e(1),a=e(170);const i=Symbol("INTERNAL");class o{constructor(g,y){Ie(this,x,!0);this.name=g,this.intent=y}get visible(){return M(this,x)}_setVisible(g,y){g!==i&&(0,s.unreachable)("Internal method `_setVisible` called."),ke(this,x,y)}}x=new WeakMap;class c{constructor(g){Ie(this,b);Ie(this,u,null);Ie(this,h,new Map);Ie(this,_,null);Ie(this,v,null);if(this.name=null,this.creator=null,g!==null){this.name=g.name,this.creator=g.creator,ke(this,v,g.order);for(const y of g.groups)M(this,h).set(y.id,new o(y.name,y.intent));if(g.baseState==="OFF")for(const y of M(this,h).values())y._setVisible(i,!1);for(const y of g.on)M(this,h).get(y)._setVisible(i,!0);for(const y of g.off)M(this,h).get(y)._setVisible(i,!1);ke(this,_,this.getHash())}}isVisible(g){if(M(this,h).size===0)return!0;if(!g)return(0,s.warn)("Optional content group not defined."),!0;if(g.type==="OCG")return M(this,h).has(g.id)?M(this,h).get(g.id).visible:((0,s.warn)(`Optional content group not found: ${g.id}`),!0);if(g.type==="OCMD"){if(g.expression)return Ae(this,b,Kr).call(this,g.expression);if(!g.policy||g.policy==="AnyOn"){for(const y of g.ids){if(!M(this,h).has(y))return(0,s.warn)(`Optional content group not found: ${y}`),!0;if(M(this,h).get(y).visible)return!0}return!1}else if(g.policy==="AllOn"){for(const y of g.ids){if(!M(this,h).has(y))return(0,s.warn)(`Optional content group not found: ${y}`),!0;if(!M(this,h).get(y).visible)return!1}return!0}else if(g.policy==="AnyOff"){for(const y of g.ids){if(!M(this,h).has(y))return(0,s.warn)(`Optional content group not found: ${y}`),!0;if(!M(this,h).get(y).visible)return!0}return!1}else if(g.policy==="AllOff"){for(const y of g.ids){if(!M(this,h).has(y))return(0,s.warn)(`Optional content group not found: ${y}`),!0;if(M(this,h).get(y).visible)return!1}return!0}return(0,s.warn)(`Unknown optional content policy ${g.policy}.`),!0}return(0,s.warn)(`Unknown group type ${g.type}.`),!0}setVisibility(g){let y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!M(this,h).has(g)){(0,s.warn)(`Optional content group not found: ${g}`);return}M(this,h).get(g)._setVisible(i,!!y),ke(this,u,null)}get hasInitialVisibility(){return M(this,_)===null||this.getHash()===M(this,_)}getOrder(){return M(this,h).size?M(this,v)?M(this,v).slice():[...M(this,h).keys()]:null}getGroups(){return M(this,h).size>0?(0,s.objectFromMap)(M(this,h)):null}getGroup(g){return M(this,h).get(g)||null}getHash(){if(M(this,u)!==null)return M(this,u);const g=new a.MurmurHash3_64;for(const[y,R]of M(this,h))g.update(`${y}:${R.visible}`);return ke(this,u,g.hexdigest())}}u=new WeakMap,h=new WeakMap,_=new WeakMap,v=new WeakMap,b=new WeakSet,Kr=function(g){const y=g.length;if(y<2)return!0;const R=g[0];for(let P=1;P<y;P++){const F=g[P];let S;if(Array.isArray(F))S=Ae(this,b,Kr).call(this,F);else if(M(this,h).has(F))S=M(this,h).get(F).visible;else return(0,s.warn)(`Optional content group not found: ${F}`),!0;switch(R){case"And":if(!S)return!1;break;case"Or":if(S)return!0;break;case"Not":return!S;default:return!0}}return R==="And"},r.OptionalContentConfig=c},(t,r,e)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.PDFDataTransportStream=void 0,e(93),e(101),e(102),e(105),e(107),e(109),e(113),e(116),e(123),e(89);var s=e(1),a=e(168);class i{constructor(u,h){let{length:_,initialData:v,progressiveDone:b=!1,contentDispositionFilename:E=null,disableRange:d=!1,disableStream:g=!1}=u;if((0,s.assert)(h,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.'),this._queuedChunks=[],this._progressiveDone=b,this._contentDispositionFilename=E,(v==null?void 0:v.length)>0){const y=v instanceof Uint8Array&&v.byteLength===v.buffer.byteLength?v.buffer:new Uint8Array(v).buffer;this._queuedChunks.push(y)}this._pdfDataRangeTransport=h,this._isStreamingSupported=!g,this._isRangeSupported=!d,this._contentLength=_,this._fullRequestReader=null,this._rangeReaders=[],this._pdfDataRangeTransport.addRangeListener((y,R)=>{this._onReceiveData({begin:y,chunk:R})}),this._pdfDataRangeTransport.addProgressListener((y,R)=>{this._onProgress({loaded:y,total:R})}),this._pdfDataRangeTransport.addProgressiveReadListener(y=>{this._onReceiveData({chunk:y})}),this._pdfDataRangeTransport.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),this._pdfDataRangeTransport.transportReady()}_onReceiveData(u){let{begin:h,chunk:_}=u;const v=_ instanceof Uint8Array&&_.byteLength===_.buffer.byteLength?_.buffer:new Uint8Array(_).buffer;if(h===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(v):this._queuedChunks.push(v);else{const b=this._rangeReaders.some(function(E){return E._begin!==h?!1:(E._enqueue(v),!0)});(0,s.assert)(b,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var u;return((u=this._fullRequestReader)==null?void 0:u._loaded)??0}_onProgress(u){var h,_,v,b;u.total===void 0?(_=(h=this._rangeReaders[0])==null?void 0:h.onProgress)==null||_.call(h,{loaded:u.loaded}):(b=(v=this._fullRequestReader)==null?void 0:v.onProgress)==null||b.call(v,{loaded:u.loaded,total:u.total})}_onProgressiveDone(){var u;(u=this._fullRequestReader)==null||u.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(u){const h=this._rangeReaders.indexOf(u);h>=0&&this._rangeReaders.splice(h,1)}getFullReader(){(0,s.assert)(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const u=this._queuedChunks;return this._queuedChunks=null,new o(this,u,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(u,h){if(h<=this._progressiveDataLength)return null;const _=new c(this,u,h);return this._pdfDataRangeTransport.requestDataRange(u,h),this._rangeReaders.push(_),_}cancelAllRequests(u){var h;(h=this._fullRequestReader)==null||h.cancel(u);for(const _ of this._rangeReaders.slice(0))_.cancel(u);this._pdfDataRangeTransport.abort()}}r.PDFDataTransportStream=i;class o{constructor(u,h){let _=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;this._stream=u,this._done=_||!1,this._filename=(0,a.isPdfFile)(v)?v:null,this._queuedChunks=h||[],this._loaded=0;for(const b of this._queuedChunks)this._loaded+=b.byteLength;this._requests=[],this._headersReady=Promise.resolve(),u._fullRequestReader=this,this.onProgress=null}_enqueue(u){this._done||(this._requests.length>0?this._requests.shift().resolve({value:u,done:!1}):this._queuedChunks.push(u),this._loaded+=u.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const u=new s.PromiseCapability;return this._requests.push(u),u.promise}cancel(u){this._done=!0;for(const h of this._requests)h.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class c{constructor(u,h,_){this._stream=u,this._begin=h,this._end=_,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(u){if(!this._done){if(this._requests.length===0)this._queuedChunk=u;else{this._requests.shift().resolve({value:u,done:!1});for(const _ of this._requests)_.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const h=this._queuedChunk;return this._queuedChunk=null,{value:h,done:!1}}if(this._done)return{value:void 0,done:!0};const u=new s.PromiseCapability;return this._requests.push(u),u.promise}cancel(u){this._done=!0;for(const h of this._requests)h.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}},(t,r,e)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.PDFFetchStream=void 0,e(93),e(101),e(102),e(105),e(107),e(109),e(113),e(116),e(123),e(89);var s=e(1),a=e(182);function i(_,v,b){return{method:"GET",headers:_,signal:b.signal,mode:"cors",credentials:v?"include":"same-origin",redirect:"follow"}}function o(_){const v=new Headers;for(const b in _){const E=_[b];E!==void 0&&v.append(b,E)}return v}function c(_){return _ instanceof Uint8Array?_.buffer:_ instanceof ArrayBuffer?_:((0,s.warn)(`getArrayBuffer - unexpected data format: ${_}`),new Uint8Array(_).buffer)}class x{constructor(v){this.source=v,this.isHttp=/^https?:/i.test(v.url),this.httpHeaders=this.isHttp&&v.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var v;return((v=this._fullRequestReader)==null?void 0:v._loaded)??0}getFullReader(){return(0,s.assert)(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new u(this),this._fullRequestReader}getRangeReader(v,b){if(b<=this._progressiveDataLength)return null;const E=new h(this,v,b);return this._rangeRequestReaders.push(E),E}cancelAllRequests(v){var b;(b=this._fullRequestReader)==null||b.cancel(v);for(const E of this._rangeRequestReaders.slice(0))E.cancel(v)}}r.PDFFetchStream=x;class u{constructor(v){this._stream=v,this._reader=null,this._loaded=0,this._filename=null;const b=v.source;this._withCredentials=b.withCredentials||!1,this._contentLength=b.length,this._headersCapability=new s.PromiseCapability,this._disableRange=b.disableRange||!1,this._rangeChunkSize=b.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!b.disableStream,this._isRangeSupported=!b.disableRange,this._headers=o(this._stream.httpHeaders);const E=b.url;fetch(E,i(this._headers,this._withCredentials,this._abortController)).then(d=>{if(!(0,a.validateResponseStatus)(d.status))throw(0,a.createResponseStatusError)(d.status,E);this._reader=d.body.getReader(),this._headersCapability.resolve();const g=P=>d.headers.get(P),{allowRangeRequests:y,suggestedLength:R}=(0,a.validateRangeRequestCapabilities)({getResponseHeader:g,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=y,this._contentLength=R||this._contentLength,this._filename=(0,a.extractFilenameFromHeader)(g),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new s.AbortException("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var E;await this._headersCapability.promise;const{value:v,done:b}=await this._reader.read();return b?{value:v,done:b}:(this._loaded+=v.byteLength,(E=this.onProgress)==null||E.call(this,{loaded:this._loaded,total:this._contentLength}),{value:c(v),done:!1})}cancel(v){var b;(b=this._reader)==null||b.cancel(v),this._abortController.abort()}}class h{constructor(v,b,E){this._stream=v,this._reader=null,this._loaded=0;const d=v.source;this._withCredentials=d.withCredentials||!1,this._readCapability=new s.PromiseCapability,this._isStreamingSupported=!d.disableStream,this._abortController=new AbortController,this._headers=o(this._stream.httpHeaders),this._headers.append("Range",`bytes=${b}-${E-1}`);const g=d.url;fetch(g,i(this._headers,this._withCredentials,this._abortController)).then(y=>{if(!(0,a.validateResponseStatus)(y.status))throw(0,a.createResponseStatusError)(y.status,g);this._readCapability.resolve(),this._reader=y.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var E;await this._readCapability.promise;const{value:v,done:b}=await this._reader.read();return b?{value:v,done:b}:(this._loaded+=v.byteLength,(E=this.onProgress)==null||E.call(this,{loaded:this._loaded}),{value:c(v),done:!1})}cancel(v){var b;(b=this._reader)==null||b.cancel(v),this._abortController.abort()}}},(t,r,e)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.createResponseStatusError=x,r.extractFilenameFromHeader=c,r.validateRangeRequestCapabilities=o,r.validateResponseStatus=u;var s=e(1),a=e(183),i=e(168);function o(h){let{getResponseHeader:_,isHttp:v,rangeChunkSize:b,disableRange:E}=h;const d={allowRangeRequests:!1,suggestedLength:void 0},g=parseInt(_("Content-Length"),10);return!Number.isInteger(g)||(d.suggestedLength=g,g<=2*b)||E||!v||_("Accept-Ranges")!=="bytes"||(_("Content-Encoding")||"identity")!=="identity"||(d.allowRangeRequests=!0),d}function c(h){const _=h("Content-Disposition");if(_){let v=(0,a.getFilenameFromContentDispositionHeader)(_);if(v.includes("%"))try{v=decodeURIComponent(v)}catch{}if((0,i.isPdfFile)(v))return v}return null}function x(h,_){return h===404||h===0&&_.startsWith("file:")?new s.MissingPDFException('Missing PDF "'+_+'".'):new s.UnexpectedResponseException(`Unexpected server response (${h}) while retrieving PDF "${_}".`,h)}function u(h){return h===200||h===206}},(t,r,e)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.getFilenameFromContentDispositionHeader=a,e(89),e(149);var s=e(1);function a(i){let o=!0,c=x("filename\\*","i").exec(i);if(c){c=c[1];let d=v(c);return d=unescape(d),d=b(d),d=E(d),h(d)}if(c=_(i),c){const d=E(c);return h(d)}if(c=x("filename","i").exec(i),c){c=c[1];let d=v(c);return d=E(d),h(d)}function x(d,g){return new RegExp("(?:^|;)\\s*"+d+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',g)}function u(d,g){if(d){if(!/^[\x00-\xFF]+$/.test(g))return g;try{const y=new TextDecoder(d,{fatal:!0}),R=(0,s.stringToBytes)(g);g=y.decode(R),o=!1}catch{}}return g}function h(d){return o&&/[\x80-\xff]/.test(d)&&(d=u("utf-8",d),o&&(d=u("iso-8859-1",d))),d}function _(d){const g=[];let y;const R=x("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(y=R.exec(d))!==null;){let[,F,S,I]=y;if(F=parseInt(F,10),F in g){if(F===0)break;continue}g[F]=[S,I]}const P=[];for(let F=0;F<g.length&&F in g;++F){let[S,I]=g[F];I=v(I),S&&(I=unescape(I),F===0&&(I=b(I))),P.push(I)}return P.join("")}function v(d){if(d.startsWith('"')){const g=d.slice(1).split('\\"');for(let y=0;y<g.length;++y){const R=g[y].indexOf('"');R!==-1&&(g[y]=g[y].slice(0,R),g.length=y+1),g[y]=g[y].replaceAll(/\\(.)/g,"$1")}d=g.join('"')}return d}function b(d){const g=d.indexOf("'");if(g===-1)return d;const y=d.slice(0,g),P=d.slice(g+1).replace(/^[^']*'/,"");return u(y,P)}function E(d){return!d.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(d)?d:d.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(g,y,R,P){if(R==="q"||R==="Q")return P=P.replaceAll("_"," "),P=P.replaceAll(/=([0-9a-fA-F]{2})/g,function(F,S){return String.fromCharCode(parseInt(S,16))}),u(y,P);try{P=atob(P)}catch{}return u(y,P)})}return""}},(t,r,e)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.PDFNetworkStream=void 0,e(89);var s=e(1),a=e(182);const i=200,o=206;function c(v){const b=v.response;return typeof b!="string"?b:(0,s.stringToBytes)(b).buffer}class x{constructor(b){let E=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.url=b,this.isHttp=/^https?:/i.test(b),this.httpHeaders=this.isHttp&&E.httpHeaders||Object.create(null),this.withCredentials=E.withCredentials||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(b,E,d){const g={begin:b,end:E};for(const y in d)g[y]=d[y];return this.request(g)}requestFull(b){return this.request(b)}request(b){const E=new XMLHttpRequest,d=this.currXhrId++,g=this.pendingRequests[d]={xhr:E};E.open("GET",this.url),E.withCredentials=this.withCredentials;for(const y in this.httpHeaders){const R=this.httpHeaders[y];R!==void 0&&E.setRequestHeader(y,R)}return this.isHttp&&"begin"in b&&"end"in b?(E.setRequestHeader("Range",`bytes=${b.begin}-${b.end-1}`),g.expectedStatus=o):g.expectedStatus=i,E.responseType="arraybuffer",b.onError&&(E.onerror=function(y){b.onError(E.status)}),E.onreadystatechange=this.onStateChange.bind(this,d),E.onprogress=this.onProgress.bind(this,d),g.onHeadersReceived=b.onHeadersReceived,g.onDone=b.onDone,g.onError=b.onError,g.onProgress=b.onProgress,E.send(null),d}onProgress(b,E){var g;const d=this.pendingRequests[b];d&&((g=d.onProgress)==null||g.call(d,E))}onStateChange(b,E){var F,S,I;const d=this.pendingRequests[b];if(!d)return;const g=d.xhr;if(g.readyState>=2&&d.onHeadersReceived&&(d.onHeadersReceived(),delete d.onHeadersReceived),g.readyState!==4||!(b in this.pendingRequests))return;if(delete this.pendingRequests[b],g.status===0&&this.isHttp){(F=d.onError)==null||F.call(d,g.status);return}const y=g.status||i;if(!(y===i&&d.expectedStatus===o)&&y!==d.expectedStatus){(S=d.onError)==null||S.call(d,g.status);return}const P=c(g);if(y===o){const w=g.getResponseHeader("Content-Range"),j=/bytes (\d+)-(\d+)\/(\d+)/.exec(w);d.onDone({begin:parseInt(j[1],10),chunk:P})}else P?d.onDone({begin:0,chunk:P}):(I=d.onError)==null||I.call(d,g.status)}getRequestXhr(b){return this.pendingRequests[b].xhr}isPendingRequest(b){return b in this.pendingRequests}abortRequest(b){const E=this.pendingRequests[b].xhr;delete this.pendingRequests[b],E.abort()}}class u{constructor(b){this._source=b,this._manager=new x(b.url,{httpHeaders:b.httpHeaders,withCredentials:b.withCredentials}),this._rangeChunkSize=b.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(b){const E=this._rangeRequestReaders.indexOf(b);E>=0&&this._rangeRequestReaders.splice(E,1)}getFullReader(){return(0,s.assert)(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new h(this._manager,this._source),this._fullRequestReader}getRangeReader(b,E){const d=new _(this._manager,b,E);return d.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(d),d}cancelAllRequests(b){var E;(E=this._fullRequestReader)==null||E.cancel(b);for(const d of this._rangeRequestReaders.slice(0))d.cancel(b)}}r.PDFNetworkStream=u;class h{constructor(b,E){this._manager=b;const d={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=E.url,this._fullRequestId=b.requestFull(d),this._headersReceivedCapability=new s.PromiseCapability,this._disableRange=E.disableRange||!1,this._contentLength=E.length,this._rangeChunkSize=E.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const b=this._fullRequestId,E=this._manager.getRequestXhr(b),d=R=>E.getResponseHeader(R),{allowRangeRequests:g,suggestedLength:y}=(0,a.validateRangeRequestCapabilities)({getResponseHeader:d,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});g&&(this._isRangeSupported=!0),this._contentLength=y||this._contentLength,this._filename=(0,a.extractFilenameFromHeader)(d),this._isRangeSupported&&this._manager.abortRequest(b),this._headersReceivedCapability.resolve()}_onDone(b){if(b&&(this._requests.length>0?this._requests.shift().resolve({value:b.chunk,done:!1}):this._cachedChunks.push(b.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const E of this._requests)E.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(b){this._storedError=(0,a.createResponseStatusError)(b,this._url),this._headersReceivedCapability.reject(this._storedError);for(const E of this._requests)E.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(b){var E;(E=this.onProgress)==null||E.call(this,{loaded:b.loaded,total:b.lengthComputable?b.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const b=new s.PromiseCapability;return this._requests.push(b),b.promise}cancel(b){this._done=!0,this._headersReceivedCapability.reject(b);for(const E of this._requests)E.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class _{constructor(b,E,d){this._manager=b;const g={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=b.url,this._requestId=b.requestRange(E,d,g),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){var b;(b=this.onClosed)==null||b.call(this,this)}_onDone(b){const E=b.chunk;this._requests.length>0?this._requests.shift().resolve({value:E,done:!1}):this._queuedChunk=E,this._done=!0;for(const d of this._requests)d.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(b){this._storedError=(0,a.createResponseStatusError)(b,this._url);for(const E of this._requests)E.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(b){var E;this.isStreamingSupported||(E=this.onProgress)==null||E.call(this,{loaded:b.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const E=this._queuedChunk;return this._queuedChunk=null,{value:E,done:!1}}if(this._done)return{value:void 0,done:!0};const b=new s.PromiseCapability;return this._requests.push(b),b.promise}cancel(b){this._done=!0;for(const E of this._requests)E.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}},(t,r,e)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.PDFNodeStream=void 0,e(89),e(93),e(101),e(102),e(105),e(107),e(109),e(113),e(116),e(123);var s=e(1),a=e(182);const i=/^file:\/\/\/[a-zA-Z]:\//;function o(d){const g=require$$6,y=g.parse(d);return y.protocol==="file:"||y.host?y:/^[a-z]:[/\\]/i.test(d)?g.parse(`file:///${d}`):(y.host||(y.protocol="file:"),y)}class c{constructor(g){this.source=g,this.url=o(g.url),this.isHttp=this.url.protocol==="http:"||this.url.protocol==="https:",this.isFsUrl=this.url.protocol==="file:",this.httpHeaders=this.isHttp&&g.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var g;return((g=this._fullRequestReader)==null?void 0:g._loaded)??0}getFullReader(){return(0,s.assert)(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new b(this):new _(this),this._fullRequestReader}getRangeReader(g,y){if(y<=this._progressiveDataLength)return null;const R=this.isFsUrl?new E(this,g,y):new v(this,g,y);return this._rangeRequestReaders.push(R),R}cancelAllRequests(g){var y;(y=this._fullRequestReader)==null||y.cancel(g);for(const R of this._rangeRequestReaders.slice(0))R.cancel(g)}}r.PDFNodeStream=c;class x{constructor(g){this._url=g.url,this._done=!1,this._storedError=null,this.onProgress=null;const y=g.source;this._contentLength=y.length,this._loaded=0,this._filename=null,this._disableRange=y.disableRange||!1,this._rangeChunkSize=y.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!y.disableStream,this._isRangeSupported=!y.disableRange,this._readableStream=null,this._readCapability=new s.PromiseCapability,this._headersCapability=new s.PromiseCapability}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var R;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const g=this._readableStream.read();return g===null?(this._readCapability=new s.PromiseCapability,this.read()):(this._loaded+=g.length,(R=this.onProgress)==null||R.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(g).buffer,done:!1})}cancel(g){if(!this._readableStream){this._error(g);return}this._readableStream.destroy(g)}_error(g){this._storedError=g,this._readCapability.resolve()}_setReadableStream(g){this._readableStream=g,g.on("readable",()=>{this._readCapability.resolve()}),g.on("end",()=>{g.destroy(),this._done=!0,this._readCapability.resolve()}),g.on("error",y=>{this._error(y)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new s.AbortException("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class u{constructor(g){this._url=g.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=new s.PromiseCapability;const y=g.source;this._isStreamingSupported=!y.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){var R;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const g=this._readableStream.read();return g===null?(this._readCapability=new s.PromiseCapability,this.read()):(this._loaded+=g.length,(R=this.onProgress)==null||R.call(this,{loaded:this._loaded}),{value:new Uint8Array(g).buffer,done:!1})}cancel(g){if(!this._readableStream){this._error(g);return}this._readableStream.destroy(g)}_error(g){this._storedError=g,this._readCapability.resolve()}_setReadableStream(g){this._readableStream=g,g.on("readable",()=>{this._readCapability.resolve()}),g.on("end",()=>{g.destroy(),this._done=!0,this._readCapability.resolve()}),g.on("error",y=>{this._error(y)}),this._storedError&&this._readableStream.destroy(this._storedError)}}function h(d,g){return{protocol:d.protocol,auth:d.auth,host:d.hostname,port:d.port,path:d.path,method:"GET",headers:g}}class _ extends x{constructor(g){super(g);const y=R=>{if(R.statusCode===404){const I=new s.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=I,this._headersCapability.reject(I);return}this._headersCapability.resolve(),this._setReadableStream(R);const P=I=>this._readableStream.headers[I.toLowerCase()],{allowRangeRequests:F,suggestedLength:S}=(0,a.validateRangeRequestCapabilities)({getResponseHeader:P,isHttp:g.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=F,this._contentLength=S||this._contentLength,this._filename=(0,a.extractFilenameFromHeader)(P)};if(this._request=null,this._url.protocol==="http:"){const R=require$$6;this._request=R.request(h(this._url,g.httpHeaders),y)}else{const R=require$$6;this._request=R.request(h(this._url,g.httpHeaders),y)}this._request.on("error",R=>{this._storedError=R,this._headersCapability.reject(R)}),this._request.end()}}class v extends u{constructor(g,y,R){super(g),this._httpHeaders={};for(const F in g.httpHeaders){const S=g.httpHeaders[F];S!==void 0&&(this._httpHeaders[F]=S)}this._httpHeaders.Range=`bytes=${y}-${R-1}`;const P=F=>{if(F.statusCode===404){const S=new s.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=S;return}this._setReadableStream(F)};if(this._request=null,this._url.protocol==="http:"){const F=require$$6;this._request=F.request(h(this._url,this._httpHeaders),P)}else{const F=require$$6;this._request=F.request(h(this._url,this._httpHeaders),P)}this._request.on("error",F=>{this._storedError=F}),this._request.end()}}class b extends x{constructor(g){super(g);let y=decodeURIComponent(this._url.path);i.test(this._url.href)&&(y=y.replace(/^\//,""));const R=require$$6;R.lstat(y,(P,F)=>{if(P){P.code==="ENOENT"&&(P=new s.MissingPDFException(`Missing PDF "${y}".`)),this._storedError=P,this._headersCapability.reject(P);return}this._contentLength=F.size,this._setReadableStream(R.createReadStream(y)),this._headersCapability.resolve()})}}class E extends u{constructor(g,y,R){super(g);let P=decodeURIComponent(this._url.path);i.test(this._url.href)&&(P=P.replace(/^\//,""));const F=require$$6;this._setReadableStream(F.createReadStream(P,{start:y,end:R-1}))}}},(t,r,e)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.SVGGraphics=void 0,e(84),e(86),e(87),e(93),e(101),e(102),e(105),e(107),e(109),e(113),e(116),e(123),e(2),e(89),e(187);var s=e(168),a=e(1);const i={fontStyle:"normal",fontWeight:"normal",fillColor:"#000000"},o="http://www.w3.org/XML/1998/namespace",c="http://www.w3.org/1999/xlink",x=["butt","round","square"],u=["miter","round","bevel"],h=function(F){let S=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",I=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(URL.createObjectURL&&typeof Blob<"u"&&!I)return URL.createObjectURL(new Blob([F],{type:S}));const w="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let j=`data:${S};base64,`;for(let C=0,V=F.length;C<V;C+=3){const O=F[C]&255,H=F[C+1]&255,z=F[C+2]&255,pe=O>>2,ee=(O&3)<<4|H>>4,he=C+1<V?(H&15)<<2|z>>6:64,re=C+2<V?z&63:64;j+=w[pe]+w[ee]+w[he]+w[re]}return j},_=function(){const F=new Uint8Array([137,80,78,71,13,10,26,10]),S=12,I=new Int32Array(256);for(let z=0;z<256;z++){let pe=z;for(let ee=0;ee<8;ee++)pe=pe&1?3988292384^pe>>1&2147483647:pe>>1&2147483647;I[z]=pe}function w(z,pe,ee){let he=-1;for(let re=pe;re<ee;re++){const me=(he^z[re])&255,te=I[me];he=he>>>8^te}return he^-1}function j(z,pe,ee,he){let re=he;const me=pe.length;ee[re]=me>>24&255,ee[re+1]=me>>16&255,ee[re+2]=me>>8&255,ee[re+3]=me&255,re+=4,ee[re]=z.charCodeAt(0)&255,ee[re+1]=z.charCodeAt(1)&255,ee[re+2]=z.charCodeAt(2)&255,ee[re+3]=z.charCodeAt(3)&255,re+=4,ee.set(pe,re),re+=pe.length;const te=w(ee,he+4,re);ee[re]=te>>24&255,ee[re+1]=te>>16&255,ee[re+2]=te>>8&255,ee[re+3]=te&255}function C(z,pe,ee){let he=1,re=0;for(let me=pe;me<ee;++me)he=(he+(z[me]&255))%65521,re=(re+he)%65521;return re<<16|he}function V(z){if(!a.isNodeJS)return O(z);try{const pe=parseInt(process.versions.node)>=8?z:Buffer.from(z),ee=require$$6.deflateSync(pe,{level:9});return ee instanceof Uint8Array?ee:new Uint8Array(ee)}catch(pe){(0,a.warn)("Not compressing PNG because zlib.deflateSync is unavailable: "+pe)}return O(z)}function O(z){let pe=z.length;const ee=65535,he=Math.ceil(pe/ee),re=new Uint8Array(2+pe+he*5+4);let me=0;re[me++]=120,re[me++]=156;let te=0;for(;pe>ee;)re[me++]=0,re[me++]=255,re[me++]=255,re[me++]=0,re[me++]=0,re.set(z.subarray(te,te+ee),me),me+=ee,te+=ee,pe-=ee;re[me++]=1,re[me++]=pe&255,re[me++]=pe>>8&255,re[me++]=~pe&65535&255,re[me++]=(~pe&65535)>>8&255,re.set(z.subarray(te),me),me+=z.length-te;const ce=C(z,0,z.length);return re[me++]=ce>>24&255,re[me++]=ce>>16&255,re[me++]=ce>>8&255,re[me++]=ce&255,re}function H(z,pe,ee,he){const re=z.width,me=z.height;let te,ce,ye;const L=z.data;switch(pe){case a.ImageKind.GRAYSCALE_1BPP:ce=0,te=1,ye=re+7>>3;break;case a.ImageKind.RGB_24BPP:ce=2,te=8,ye=re*3;break;case a.ImageKind.RGBA_32BPP:ce=6,te=8,ye=re*4;break;default:throw new Error("invalid format")}const N=new Uint8Array((1+ye)*me);let T=0,A=0;for(let fe=0;fe<me;++fe)N[T++]=0,N.set(L.subarray(A,A+ye),T),A+=ye,T+=ye;if(pe===a.ImageKind.GRAYSCALE_1BPP&&he){T=0;for(let fe=0;fe<me;fe++){T++;for(let xe=0;xe<ye;xe++)N[T++]^=255}}const D=new Uint8Array([re>>24&255,re>>16&255,re>>8&255,re&255,me>>24&255,me>>16&255,me>>8&255,me&255,te,ce,0,0,0]),B=V(N),U=F.length+S*3+D.length+B.length,Y=new Uint8Array(U);let G=0;return Y.set(F,G),G+=F.length,j("IHDR",D,Y,G),G+=S+D.length,j("IDATA",B,Y,G),G+=S+B.length,j("IEND",new Uint8Array(0),Y,G),h(Y,"image/png",ee)}return function(pe,ee,he){const re=pe.kind===void 0?a.ImageKind.GRAYSCALE_1BPP:pe.kind;return H(pe,re,ee,he)}}();class v{constructor(){this.fontSizeScale=1,this.fontWeight=i.fontWeight,this.fontSize=0,this.textMatrix=a.IDENTITY_MATRIX,this.fontMatrix=a.FONT_IDENTITY_MATRIX,this.leading=0,this.textRenderingMode=a.TextRenderingMode.FILL,this.textMatrixScale=1,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRise=0,this.fillColor=i.fillColor,this.strokeColor="#000000",this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.lineJoin="",this.lineCap="",this.miterLimit=0,this.dashArray=[],this.dashPhase=0,this.dependencies=[],this.activeClipUrl=null,this.clipGroup=null,this.maskId=""}clone(){return Object.create(this)}setCurrentPoint(S,I){this.x=S,this.y=I}}function b(F){let S=[];const I=[];for(const w of F){if(w.fn==="save"){S.push({fnId:92,fn:"group",items:[]}),I.push(S),S=S.at(-1).items;continue}w.fn==="restore"?S=I.pop():S.push(w)}return S}function E(F){if(Number.isInteger(F))return F.toString();const S=F.toFixed(10);let I=S.length-1;if(S[I]!=="0")return S;do I--;while(S[I]==="0");return S.substring(0,S[I]==="."?I:I+1)}function d(F){if(F[4]===0&&F[5]===0){if(F[1]===0&&F[2]===0)return F[0]===1&&F[3]===1?"":`scale(${E(F[0])} ${E(F[3])})`;if(F[0]===F[3]&&F[1]===-F[2]){const S=Math.acos(F[0])*180/Math.PI;return`rotate(${E(S)})`}}else if(F[0]===1&&F[1]===0&&F[2]===0&&F[3]===1)return`translate(${E(F[4])} ${E(F[5])})`;return`matrix(${E(F[0])} ${E(F[1])} ${E(F[2])} ${E(F[3])} ${E(F[4])} ${E(F[5])})`}let g=0,y=0,R=0;class P{constructor(S,I){let w=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;(0,s.deprecated)("The SVG back-end is no longer maintained and *may* be removed in the future."),this.svgFactory=new s.DOMSVGFactory,this.current=new v,this.transformMatrix=a.IDENTITY_MATRIX,this.transformStack=[],this.extraStack=[],this.commonObjs=S,this.objs=I,this.pendingClip=null,this.pendingEOFill=!1,this.embedFonts=!1,this.embeddedFonts=Object.create(null),this.cssStyle=null,this.forceDataSchema=!!w,this._operatorIdMapping=[];for(const j in a.OPS)this._operatorIdMapping[a.OPS[j]]=j}getObject(S){let I=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return typeof S=="string"?S.startsWith("g_")?this.commonObjs.get(S):this.objs.get(S):I}save(){this.transformStack.push(this.transformMatrix);const S=this.current;this.extraStack.push(S),this.current=S.clone()}restore(){this.transformMatrix=this.transformStack.pop(),this.current=this.extraStack.pop(),this.pendingClip=null,this.tgrp=null}group(S){this.save(),this.executeOpTree(S),this.restore()}loadDependencies(S){const I=S.fnArray,w=S.argsArray;for(let j=0,C=I.length;j<C;j++)if(I[j]===a.OPS.dependency)for(const V of w[j]){const O=V.startsWith("g_")?this.commonObjs:this.objs,H=new Promise(z=>{O.get(V,z)});this.current.dependencies.push(H)}return Promise.all(this.current.dependencies)}transform(S,I,w,j,C,V){const O=[S,I,w,j,C,V];this.transformMatrix=a.Util.transform(this.transformMatrix,O),this.tgrp=null}getSVG(S,I){this.viewport=I;const w=this._initialize(I);return this.loadDependencies(S).then(()=>(this.transformMatrix=a.IDENTITY_MATRIX,this.executeOpTree(this.convertOpList(S)),w))}convertOpList(S){const I=this._operatorIdMapping,w=S.argsArray,j=S.fnArray,C=[];for(let V=0,O=j.length;V<O;V++){const H=j[V];C.push({fnId:H,fn:I[H],args:w[V]})}return b(C)}executeOpTree(S){for(const I of S){const w=I.fn,j=I.fnId,C=I.args;switch(j|0){case a.OPS.beginText:this.beginText();break;case a.OPS.dependency:break;case a.OPS.setLeading:this.setLeading(C);break;case a.OPS.setLeadingMoveText:this.setLeadingMoveText(C[0],C[1]);break;case a.OPS.setFont:this.setFont(C);break;case a.OPS.showText:this.showText(C[0]);break;case a.OPS.showSpacedText:this.showText(C[0]);break;case a.OPS.endText:this.endText();break;case a.OPS.moveText:this.moveText(C[0],C[1]);break;case a.OPS.setCharSpacing:this.setCharSpacing(C[0]);break;case a.OPS.setWordSpacing:this.setWordSpacing(C[0]);break;case a.OPS.setHScale:this.setHScale(C[0]);break;case a.OPS.setTextMatrix:this.setTextMatrix(C[0],C[1],C[2],C[3],C[4],C[5]);break;case a.OPS.setTextRise:this.setTextRise(C[0]);break;case a.OPS.setTextRenderingMode:this.setTextRenderingMode(C[0]);break;case a.OPS.setLineWidth:this.setLineWidth(C[0]);break;case a.OPS.setLineJoin:this.setLineJoin(C[0]);break;case a.OPS.setLineCap:this.setLineCap(C[0]);break;case a.OPS.setMiterLimit:this.setMiterLimit(C[0]);break;case a.OPS.setFillRGBColor:this.setFillRGBColor(C[0],C[1],C[2]);break;case a.OPS.setStrokeRGBColor:this.setStrokeRGBColor(C[0],C[1],C[2]);break;case a.OPS.setStrokeColorN:this.setStrokeColorN(C);break;case a.OPS.setFillColorN:this.setFillColorN(C);break;case a.OPS.shadingFill:this.shadingFill(C[0]);break;case a.OPS.setDash:this.setDash(C[0],C[1]);break;case a.OPS.setRenderingIntent:this.setRenderingIntent(C[0]);break;case a.OPS.setFlatness:this.setFlatness(C[0]);break;case a.OPS.setGState:this.setGState(C[0]);break;case a.OPS.fill:this.fill();break;case a.OPS.eoFill:this.eoFill();break;case a.OPS.stroke:this.stroke();break;case a.OPS.fillStroke:this.fillStroke();break;case a.OPS.eoFillStroke:this.eoFillStroke();break;case a.OPS.clip:this.clip("nonzero");break;case a.OPS.eoClip:this.clip("evenodd");break;case a.OPS.paintSolidColorImageMask:this.paintSolidColorImageMask();break;case a.OPS.paintImageXObject:this.paintImageXObject(C[0]);break;case a.OPS.paintInlineImageXObject:this.paintInlineImageXObject(C[0]);break;case a.OPS.paintImageMaskXObject:this.paintImageMaskXObject(C[0]);break;case a.OPS.paintFormXObjectBegin:this.paintFormXObjectBegin(C[0],C[1]);break;case a.OPS.paintFormXObjectEnd:this.paintFormXObjectEnd();break;case a.OPS.closePath:this.closePath();break;case a.OPS.closeStroke:this.closeStroke();break;case a.OPS.closeFillStroke:this.closeFillStroke();break;case a.OPS.closeEOFillStroke:this.closeEOFillStroke();break;case a.OPS.nextLine:this.nextLine();break;case a.OPS.transform:this.transform(C[0],C[1],C[2],C[3],C[4],C[5]);break;case a.OPS.constructPath:this.constructPath(C[0],C[1]);break;case a.OPS.endPath:this.endPath();break;case 92:this.group(I.items);break;default:(0,a.warn)(`Unimplemented operator ${w}`);break}}}setWordSpacing(S){this.current.wordSpacing=S}setCharSpacing(S){this.current.charSpacing=S}nextLine(){this.moveText(0,this.current.leading)}setTextMatrix(S,I,w,j,C,V){const O=this.current;O.textMatrix=O.lineMatrix=[S,I,w,j,C,V],O.textMatrixScale=Math.hypot(S,I),O.x=O.lineX=0,O.y=O.lineY=0,O.xcoords=[],O.ycoords=[],O.tspan=this.svgFactory.createElement("svg:tspan"),O.tspan.setAttributeNS(null,"font-family",O.fontFamily),O.tspan.setAttributeNS(null,"font-size",`${E(O.fontSize)}px`),O.tspan.setAttributeNS(null,"y",E(-O.y)),O.txtElement=this.svgFactory.createElement("svg:text"),O.txtElement.append(O.tspan)}beginText(){const S=this.current;S.x=S.lineX=0,S.y=S.lineY=0,S.textMatrix=a.IDENTITY_MATRIX,S.lineMatrix=a.IDENTITY_MATRIX,S.textMatrixScale=1,S.tspan=this.svgFactory.createElement("svg:tspan"),S.txtElement=this.svgFactory.createElement("svg:text"),S.txtgrp=this.svgFactory.createElement("svg:g"),S.xcoords=[],S.ycoords=[]}moveText(S,I){const w=this.current;w.x=w.lineX+=S,w.y=w.lineY+=I,w.xcoords=[],w.ycoords=[],w.tspan=this.svgFactory.createElement("svg:tspan"),w.tspan.setAttributeNS(null,"font-family",w.fontFamily),w.tspan.setAttributeNS(null,"font-size",`${E(w.fontSize)}px`),w.tspan.setAttributeNS(null,"y",E(-w.y))}showText(S){const I=this.current,w=I.font,j=I.fontSize;if(j===0)return;const C=I.fontSizeScale,V=I.charSpacing,O=I.wordSpacing,H=I.fontDirection,z=I.textHScale*H,pe=w.vertical,ee=pe?1:-1,he=w.defaultVMetrics,re=j*I.fontMatrix[0];let me=0;for(const ye of S){if(ye===null){me+=H*O;continue}else if(typeof ye=="number"){me+=ee*ye*j/1e3;continue}const L=(ye.isSpace?O:0)+V,N=ye.fontChar;let T,A,D=ye.width;if(pe){let U;const Y=ye.vmetric||he;U=ye.vmetric?Y[1]:D*.5,U=-U*re;const G=Y[2]*re;D=Y?-Y[0]:D,T=U/C,A=(me+G)/C}else T=me/C,A=0;(ye.isInFont||w.missingFile)&&(I.xcoords.push(I.x+T),pe&&I.ycoords.push(-I.y+A),I.tspan.textContent+=N);const B=pe?D*re-L*H:D*re+L*H;me+=B}I.tspan.setAttributeNS(null,"x",I.xcoords.map(E).join(" ")),pe?I.tspan.setAttributeNS(null,"y",I.ycoords.map(E).join(" ")):I.tspan.setAttributeNS(null,"y",E(-I.y)),pe?I.y-=me:I.x+=me*z,I.tspan.setAttributeNS(null,"font-family",I.fontFamily),I.tspan.setAttributeNS(null,"font-size",`${E(I.fontSize)}px`),I.fontStyle!==i.fontStyle&&I.tspan.setAttributeNS(null,"font-style",I.fontStyle),I.fontWeight!==i.fontWeight&&I.tspan.setAttributeNS(null,"font-weight",I.fontWeight);const te=I.textRenderingMode&a.TextRenderingMode.FILL_STROKE_MASK;if(te===a.TextRenderingMode.FILL||te===a.TextRenderingMode.FILL_STROKE?(I.fillColor!==i.fillColor&&I.tspan.setAttributeNS(null,"fill",I.fillColor),I.fillAlpha<1&&I.tspan.setAttributeNS(null,"fill-opacity",I.fillAlpha)):I.textRenderingMode===a.TextRenderingMode.ADD_TO_PATH?I.tspan.setAttributeNS(null,"fill","transparent"):I.tspan.setAttributeNS(null,"fill","none"),te===a.TextRenderingMode.STROKE||te===a.TextRenderingMode.FILL_STROKE){const ye=1/(I.textMatrixScale||1);this._setStrokeAttributes(I.tspan,ye)}let ce=I.textMatrix;I.textRise!==0&&(ce=ce.slice(),ce[5]+=I.textRise),I.txtElement.setAttributeNS(null,"transform",`${d(ce)} scale(${E(z)}, -1)`),I.txtElement.setAttributeNS(o,"xml:space","preserve"),I.txtElement.append(I.tspan),I.txtgrp.append(I.txtElement),this._ensureTransformGroup().append(I.txtElement)}setLeadingMoveText(S,I){this.setLeading(-I),this.moveText(S,I)}addFontStyle(S){if(!S.data)throw new Error('addFontStyle: No font data available, ensure that the "fontExtraProperties" API parameter is set.');this.cssStyle||(this.cssStyle=this.svgFactory.createElement("svg:style"),this.cssStyle.setAttributeNS(null,"type","text/css"),this.defs.append(this.cssStyle));const I=h(S.data,S.mimetype,this.forceDataSchema);this.cssStyle.textContent+=`@font-face { font-family: "${S.loadedName}"; src: url(${I}); }
`}setFont(S){const I=this.current,w=this.commonObjs.get(S[0]);let j=S[1];I.font=w,this.embedFonts&&!w.missingFile&&!this.embeddedFonts[w.loadedName]&&(this.addFontStyle(w),this.embeddedFonts[w.loadedName]=w),I.fontMatrix=w.fontMatrix||a.FONT_IDENTITY_MATRIX;let C="normal";w.black?C="900":w.bold&&(C="bold");const V=w.italic?"italic":"normal";j<0?(j=-j,I.fontDirection=-1):I.fontDirection=1,I.fontSize=j,I.fontFamily=w.loadedName,I.fontWeight=C,I.fontStyle=V,I.tspan=this.svgFactory.createElement("svg:tspan"),I.tspan.setAttributeNS(null,"y",E(-I.y)),I.xcoords=[],I.ycoords=[]}endText(){var I;const S=this.current;S.textRenderingMode&a.TextRenderingMode.ADD_TO_PATH_FLAG&&((I=S.txtElement)!=null&&I.hasChildNodes())&&(S.element=S.txtElement,this.clip("nonzero"),this.endPath())}setLineWidth(S){S>0&&(this.current.lineWidth=S)}setLineCap(S){this.current.lineCap=x[S]}setLineJoin(S){this.current.lineJoin=u[S]}setMiterLimit(S){this.current.miterLimit=S}setStrokeAlpha(S){this.current.strokeAlpha=S}setStrokeRGBColor(S,I,w){this.current.strokeColor=a.Util.makeHexColor(S,I,w)}setFillAlpha(S){this.current.fillAlpha=S}setFillRGBColor(S,I,w){this.current.fillColor=a.Util.makeHexColor(S,I,w),this.current.tspan=this.svgFactory.createElement("svg:tspan"),this.current.xcoords=[],this.current.ycoords=[]}setStrokeColorN(S){this.current.strokeColor=this._makeColorN_Pattern(S)}setFillColorN(S){this.current.fillColor=this._makeColorN_Pattern(S)}shadingFill(S){const{width:I,height:w}=this.viewport,j=a.Util.inverseTransform(this.transformMatrix),[C,V,O,H]=a.Util.getAxialAlignedBoundingBox([0,0,I,w],j),z=this.svgFactory.createElement("svg:rect");z.setAttributeNS(null,"x",C),z.setAttributeNS(null,"y",V),z.setAttributeNS(null,"width",O-C),z.setAttributeNS(null,"height",H-V),z.setAttributeNS(null,"fill",this._makeShadingPattern(S)),this.current.fillAlpha<1&&z.setAttributeNS(null,"fill-opacity",this.current.fillAlpha),this._ensureTransformGroup().append(z)}_makeColorN_Pattern(S){return S[0]==="TilingPattern"?this._makeTilingPattern(S):this._makeShadingPattern(S)}_makeTilingPattern(S){const I=S[1],w=S[2],j=S[3]||a.IDENTITY_MATRIX,[C,V,O,H]=S[4],z=S[5],pe=S[6],ee=S[7],he=`shading${R++}`,[re,me,te,ce]=a.Util.normalizeRect([...a.Util.applyTransform([C,V],j),...a.Util.applyTransform([O,H],j)]),[ye,L]=a.Util.singularValueDecompose2dScale(j),N=z*ye,T=pe*L,A=this.svgFactory.createElement("svg:pattern");A.setAttributeNS(null,"id",he),A.setAttributeNS(null,"patternUnits","userSpaceOnUse"),A.setAttributeNS(null,"width",N),A.setAttributeNS(null,"height",T),A.setAttributeNS(null,"x",`${re}`),A.setAttributeNS(null,"y",`${me}`);const D=this.svg,B=this.transformMatrix,U=this.current.fillColor,Y=this.current.strokeColor,G=this.svgFactory.create(te-re,ce-me);if(this.svg=G,this.transformMatrix=j,ee===2){const fe=a.Util.makeHexColor(...I);this.current.fillColor=fe,this.current.strokeColor=fe}return this.executeOpTree(this.convertOpList(w)),this.svg=D,this.transformMatrix=B,this.current.fillColor=U,this.current.strokeColor=Y,A.append(G.childNodes[0]),this.defs.append(A),`url(#${he})`}_makeShadingPattern(S){switch(typeof S=="string"&&(S=this.objs.get(S)),S[0]){case"RadialAxial":const I=`shading${R++}`,w=S[3];let j;switch(S[1]){case"axial":const C=S[4],V=S[5];j=this.svgFactory.createElement("svg:linearGradient"),j.setAttributeNS(null,"id",I),j.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),j.setAttributeNS(null,"x1",C[0]),j.setAttributeNS(null,"y1",C[1]),j.setAttributeNS(null,"x2",V[0]),j.setAttributeNS(null,"y2",V[1]);break;case"radial":const O=S[4],H=S[5],z=S[6],pe=S[7];j=this.svgFactory.createElement("svg:radialGradient"),j.setAttributeNS(null,"id",I),j.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),j.setAttributeNS(null,"cx",H[0]),j.setAttributeNS(null,"cy",H[1]),j.setAttributeNS(null,"r",pe),j.setAttributeNS(null,"fx",O[0]),j.setAttributeNS(null,"fy",O[1]),j.setAttributeNS(null,"fr",z);break;default:throw new Error(`Unknown RadialAxial type: ${S[1]}`)}for(const C of w){const V=this.svgFactory.createElement("svg:stop");V.setAttributeNS(null,"offset",C[0]),V.setAttributeNS(null,"stop-color",C[1]),j.append(V)}return this.defs.append(j),`url(#${I})`;case"Mesh":return(0,a.warn)("Unimplemented pattern Mesh"),null;case"Dummy":return"hotpink";default:throw new Error(`Unknown IR type: ${S[0]}`)}}setDash(S,I){this.current.dashArray=S,this.current.dashPhase=I}constructPath(S,I){const w=this.current;let j=w.x,C=w.y,V=[],O=0;for(const H of S)switch(H|0){case a.OPS.rectangle:j=I[O++],C=I[O++];const z=I[O++],pe=I[O++],ee=j+z,he=C+pe;V.push("M",E(j),E(C),"L",E(ee),E(C),"L",E(ee),E(he),"L",E(j),E(he),"Z");break;case a.OPS.moveTo:j=I[O++],C=I[O++],V.push("M",E(j),E(C));break;case a.OPS.lineTo:j=I[O++],C=I[O++],V.push("L",E(j),E(C));break;case a.OPS.curveTo:j=I[O+4],C=I[O+5],V.push("C",E(I[O]),E(I[O+1]),E(I[O+2]),E(I[O+3]),E(j),E(C)),O+=6;break;case a.OPS.curveTo2:V.push("C",E(j),E(C),E(I[O]),E(I[O+1]),E(I[O+2]),E(I[O+3])),j=I[O+2],C=I[O+3],O+=4;break;case a.OPS.curveTo3:j=I[O+2],C=I[O+3],V.push("C",E(I[O]),E(I[O+1]),E(j),E(C),E(j),E(C)),O+=4;break;case a.OPS.closePath:V.push("Z");break}V=V.join(" "),w.path&&S.length>0&&S[0]!==a.OPS.rectangle&&S[0]!==a.OPS.moveTo?V=w.path.getAttributeNS(null,"d")+V:(w.path=this.svgFactory.createElement("svg:path"),this._ensureTransformGroup().append(w.path)),w.path.setAttributeNS(null,"d",V),w.path.setAttributeNS(null,"fill","none"),w.element=w.path,w.setCurrentPoint(j,C)}endPath(){const S=this.current;if(S.path=null,!this.pendingClip)return;if(!S.element){this.pendingClip=null;return}const I=`clippath${g++}`,w=this.svgFactory.createElement("svg:clipPath");w.setAttributeNS(null,"id",I),w.setAttributeNS(null,"transform",d(this.transformMatrix));const j=S.element.cloneNode(!0);if(this.pendingClip==="evenodd"?j.setAttributeNS(null,"clip-rule","evenodd"):j.setAttributeNS(null,"clip-rule","nonzero"),this.pendingClip=null,w.append(j),this.defs.append(w),S.activeClipUrl){S.clipGroup=null;for(const C of this.extraStack)C.clipGroup=null;w.setAttributeNS(null,"clip-path",S.activeClipUrl)}S.activeClipUrl=`url(#${I})`,this.tgrp=null}clip(S){this.pendingClip=S}closePath(){const S=this.current;if(S.path){const I=`${S.path.getAttributeNS(null,"d")}Z`;S.path.setAttributeNS(null,"d",I)}}setLeading(S){this.current.leading=-S}setTextRise(S){this.current.textRise=S}setTextRenderingMode(S){this.current.textRenderingMode=S}setHScale(S){this.current.textHScale=S/100}setRenderingIntent(S){}setFlatness(S){}setGState(S){for(const[I,w]of S)switch(I){case"LW":this.setLineWidth(w);break;case"LC":this.setLineCap(w);break;case"LJ":this.setLineJoin(w);break;case"ML":this.setMiterLimit(w);break;case"D":this.setDash(w[0],w[1]);break;case"RI":this.setRenderingIntent(w);break;case"FL":this.setFlatness(w);break;case"Font":this.setFont(w);break;case"CA":this.setStrokeAlpha(w);break;case"ca":this.setFillAlpha(w);break;default:(0,a.warn)(`Unimplemented graphic state operator ${I}`);break}}fill(){const S=this.current;S.element&&(S.element.setAttributeNS(null,"fill",S.fillColor),S.element.setAttributeNS(null,"fill-opacity",S.fillAlpha),this.endPath())}stroke(){const S=this.current;S.element&&(this._setStrokeAttributes(S.element),S.element.setAttributeNS(null,"fill","none"),this.endPath())}_setStrokeAttributes(S){let I=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const w=this.current;let j=w.dashArray;I!==1&&j.length>0&&(j=j.map(function(C){return I*C})),S.setAttributeNS(null,"stroke",w.strokeColor),S.setAttributeNS(null,"stroke-opacity",w.strokeAlpha),S.setAttributeNS(null,"stroke-miterlimit",E(w.miterLimit)),S.setAttributeNS(null,"stroke-linecap",w.lineCap),S.setAttributeNS(null,"stroke-linejoin",w.lineJoin),S.setAttributeNS(null,"stroke-width",E(I*w.lineWidth)+"px"),S.setAttributeNS(null,"stroke-dasharray",j.map(E).join(" ")),S.setAttributeNS(null,"stroke-dashoffset",E(I*w.dashPhase)+"px")}eoFill(){var S;(S=this.current.element)==null||S.setAttributeNS(null,"fill-rule","evenodd"),this.fill()}fillStroke(){this.stroke(),this.fill()}eoFillStroke(){var S;(S=this.current.element)==null||S.setAttributeNS(null,"fill-rule","evenodd"),this.fillStroke()}closeStroke(){this.closePath(),this.stroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.closePath(),this.eoFillStroke()}paintSolidColorImageMask(){const S=this.svgFactory.createElement("svg:rect");S.setAttributeNS(null,"x","0"),S.setAttributeNS(null,"y","0"),S.setAttributeNS(null,"width","1px"),S.setAttributeNS(null,"height","1px"),S.setAttributeNS(null,"fill",this.current.fillColor),this._ensureTransformGroup().append(S)}paintImageXObject(S){const I=this.getObject(S);if(!I){(0,a.warn)(`Dependent image with object ID ${S} is not ready yet`);return}this.paintInlineImageXObject(I)}paintInlineImageXObject(S,I){const w=S.width,j=S.height,C=_(S,this.forceDataSchema,!!I),V=this.svgFactory.createElement("svg:rect");V.setAttributeNS(null,"x","0"),V.setAttributeNS(null,"y","0"),V.setAttributeNS(null,"width",E(w)),V.setAttributeNS(null,"height",E(j)),this.current.element=V,this.clip("nonzero");const O=this.svgFactory.createElement("svg:image");O.setAttributeNS(c,"xlink:href",C),O.setAttributeNS(null,"x","0"),O.setAttributeNS(null,"y",E(-j)),O.setAttributeNS(null,"width",E(w)+"px"),O.setAttributeNS(null,"height",E(j)+"px"),O.setAttributeNS(null,"transform",`scale(${E(1/w)} ${E(-1/j)})`),I?I.append(O):this._ensureTransformGroup().append(O)}paintImageMaskXObject(S){const I=this.getObject(S.data,S);if(I.bitmap){(0,a.warn)("paintImageMaskXObject: ImageBitmap support is not implemented, ensure that the `isOffscreenCanvasSupported` API parameter is disabled.");return}const w=this.current,j=I.width,C=I.height,V=w.fillColor;w.maskId=`mask${y++}`;const O=this.svgFactory.createElement("svg:mask");O.setAttributeNS(null,"id",w.maskId);const H=this.svgFactory.createElement("svg:rect");H.setAttributeNS(null,"x","0"),H.setAttributeNS(null,"y","0"),H.setAttributeNS(null,"width",E(j)),H.setAttributeNS(null,"height",E(C)),H.setAttributeNS(null,"fill",V),H.setAttributeNS(null,"mask",`url(#${w.maskId})`),this.defs.append(O),this._ensureTransformGroup().append(H),this.paintInlineImageXObject(I,O)}paintFormXObjectBegin(S,I){if(Array.isArray(S)&&S.length===6&&this.transform(S[0],S[1],S[2],S[3],S[4],S[5]),I){const w=I[2]-I[0],j=I[3]-I[1],C=this.svgFactory.createElement("svg:rect");C.setAttributeNS(null,"x",I[0]),C.setAttributeNS(null,"y",I[1]),C.setAttributeNS(null,"width",E(w)),C.setAttributeNS(null,"height",E(j)),this.current.element=C,this.clip("nonzero"),this.endPath()}}paintFormXObjectEnd(){}_initialize(S){const I=this.svgFactory.create(S.width,S.height),w=this.svgFactory.createElement("svg:defs");I.append(w),this.defs=w;const j=this.svgFactory.createElement("svg:g");return j.setAttributeNS(null,"transform",d(S.transform)),I.append(j),this.svg=j,I}_ensureClipGroup(){if(!this.current.clipGroup){const S=this.svgFactory.createElement("svg:g");S.setAttributeNS(null,"clip-path",this.current.activeClipUrl),this.svg.append(S),this.current.clipGroup=S}return this.current.clipGroup}_ensureTransformGroup(){return this.tgrp||(this.tgrp=this.svgFactory.createElement("svg:g"),this.tgrp.setAttributeNS(null,"transform",d(this.transformMatrix)),this.current.activeClipUrl?this._ensureClipGroup().append(this.tgrp):this.svg.append(this.tgrp)),this.tgrp}}r.SVGGraphics=P},(t,r,e)=>{var s=e(3),a=e(188),i=e(193);s({target:"Array",proto:!0},{group:function(c){var x=arguments.length>1?arguments[1]:void 0;return a(this,c,x)}}),i("group")},(t,r,e)=>{var s=e(99),a=e(14),i=e(13),o=e(40),c=e(18),x=e(64),u=e(189),h=e(108),_=Array,v=a([].push);t.exports=function(b,E,d,g){for(var y=o(b),R=i(y),P=s(E,d),F=u(null),S=x(R),I=0,w,j,C;S>I;I++)C=R[I],j=c(P(C,I,y)),j in F?v(F[j],C):F[j]=[C];if(g&&(w=g(y),w!==_))for(j in F)F[j]=h(w,F[j]);return F}},(t,r,e)=>{var s=e(47),a=e(190),i=e(66),o=e(55),c=e(192),x=e(43),u=e(54),h=">",_="<",v="prototype",b="script",E=u("IE_PROTO"),d=function(){},g=function(S){return _+b+h+S+_+"/"+b+h},y=function(S){S.write(g("")),S.close();var I=S.parentWindow.Object;return S=null,I},R=function(){var S=x("iframe"),I="java"+b+":",w;return S.style.display="none",c.appendChild(S),S.src=String(I),w=S.contentWindow.document,w.open(),w.write(g("document.F=Object")),w.close(),w.F},P,F=function(){try{P=new ActiveXObject("htmlfile")}catch{}F=typeof document<"u"?document.domain&&P?y(P):R():y(P);for(var S=i.length;S--;)delete F[v][i[S]];return F()};o[E]=!0,t.exports=Object.create||function(I,w){var j;return I!==null?(d[v]=s(I),j=new d,d[v]=null,j[E]=I):j=F(),w===void 0?j:a.f(j,w)}},(t,r,e)=>{var s=e(6),a=e(46),i=e(45),o=e(47),c=e(12),x=e(191);r.f=s&&!a?Object.defineProperties:function(h,_){o(h);for(var v=c(_),b=x(_),E=b.length,d=0,g;E>d;)i.f(h,g=b[d++],v[g]);return h}},(t,r,e)=>{var s=e(59),a=e(66);t.exports=Object.keys||function(o){return s(o,a)}},(t,r,e)=>{var s=e(24);t.exports=s("document","documentElement")},(t,r,e)=>{var s=e(34),a=e(189),i=e(45).f,o=s("unscopables"),c=Array.prototype;c[o]===void 0&&i(c,o,{configurable:!0,value:a(null)}),t.exports=function(x){c[o][x]=!0}},(t,r,e)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.XfaText=void 0,e(89);class s{static textContent(i){const o=[],c={items:o,styles:Object.create(null)};function x(u){var v;if(!u)return;let h=null;const _=u.name;if(_==="#text")h=u.value;else if(s.shouldBuildText(_))(v=u==null?void 0:u.attributes)!=null&&v.textContent?h=u.attributes.textContent:u.value&&(h=u.value);else return;if(h!==null&&o.push({str:h}),!!u.children)for(const b of u.children)x(b)}return x(i),c}static shouldBuildText(i){return!(i==="textarea"||i==="input"||i==="option"||i==="select")}}r.XfaText=s},(t,r,e)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.TextLayerRenderTask=void 0,r.renderTextLayer=d,r.updateTextLayer=g,e(89),e(2);var s=e(1),a=e(168);const i=1e5,o=30,c=.8,x=new Map;function u(y,R){let P;if(R&&s.FeatureTest.isOffscreenCanvasSupported)P=new OffscreenCanvas(y,y).getContext("2d",{alpha:!1});else{const F=document.createElement("canvas");F.width=F.height=y,P=F.getContext("2d",{alpha:!1})}return P}function h(y,R){const P=x.get(y);if(P)return P;const F=u(o,R);F.font=`${o}px ${y}`;const S=F.measureText("");let I=S.fontBoundingBoxAscent,w=Math.abs(S.fontBoundingBoxDescent);if(I){const C=I/(I+w);return x.set(y,C),F.canvas.width=F.canvas.height=0,C}F.strokeStyle="red",F.clearRect(0,0,o,o),F.strokeText("g",0,0);let j=F.getImageData(0,0,o,o).data;w=0;for(let C=j.length-1-3;C>=0;C-=4)if(j[C]>0){w=Math.ceil(C/4/o);break}F.clearRect(0,0,o,o),F.strokeText("A",0,o),j=F.getImageData(0,0,o,o).data,I=0;for(let C=0,V=j.length;C<V;C+=4)if(j[C]>0){I=o-Math.floor(C/4/o);break}if(F.canvas.width=F.canvas.height=0,I){const C=I/(I+w);return x.set(y,C),C}return x.set(y,c),c}function _(y,R,P){const F=document.createElement("span"),S={angle:0,canvasWidth:0,hasText:R.str!=="",hasEOL:R.hasEOL,fontSize:0};y._textDivs.push(F);const I=s.Util.transform(y._transform,R.transform);let w=Math.atan2(I[1],I[0]);const j=P[R.fontName];j.vertical&&(w+=Math.PI/2);const C=Math.hypot(I[2],I[3]),V=C*h(j.fontFamily,y._isOffscreenCanvasSupported);let O,H;w===0?(O=I[4],H=I[5]-V):(O=I[4]+V*Math.sin(w),H=I[5]-V*Math.cos(w));const z="calc(var(--scale-factor)*",pe=F.style;y._container===y._rootContainer?(pe.left=`${(100*O/y._pageWidth).toFixed(2)}%`,pe.top=`${(100*H/y._pageHeight).toFixed(2)}%`):(pe.left=`${z}${O.toFixed(2)}px)`,pe.top=`${z}${H.toFixed(2)}px)`),pe.fontSize=`${z}${C.toFixed(2)}px)`,pe.fontFamily=j.fontFamily,S.fontSize=C,F.setAttribute("role","presentation"),F.textContent=R.str,F.dir=R.dir,y._fontInspectorEnabled&&(F.dataset.fontName=R.fontName),w!==0&&(S.angle=w*(180/Math.PI));let ee=!1;if(R.str.length>1)ee=!0;else if(R.str!==" "&&R.transform[0]!==R.transform[3]){const he=Math.abs(R.transform[0]),re=Math.abs(R.transform[3]);he!==re&&Math.max(he,re)/Math.min(he,re)>1.5&&(ee=!0)}ee&&(S.canvasWidth=j.vertical?R.height:R.width),y._textDivProperties.set(F,S),y._isReadableStream&&y._layoutText(F)}function v(y){const{div:R,scale:P,properties:F,ctx:S,prevFontSize:I,prevFontFamily:w}=y,{style:j}=R;let C="";if(F.canvasWidth!==0&&F.hasText){const{fontFamily:V}=j,{canvasWidth:O,fontSize:H}=F;(I!==H||w!==V)&&(S.font=`${H*P}px ${V}`,y.prevFontSize=H,y.prevFontFamily=V);const{width:z}=S.measureText(R.textContent);z>0&&(C=`scaleX(${O*P/z})`)}F.angle!==0&&(C=`rotate(${F.angle}deg) ${C}`),C.length>0&&(j.transform=C)}function b(y){if(y._canceled)return;const R=y._textDivs,P=y._capability;if(R.length>i){P.resolve();return}if(!y._isReadableStream)for(const S of R)y._layoutText(S);P.resolve()}class E{constructor(R){var pe;let{textContentSource:P,container:F,viewport:S,textDivs:I,textDivProperties:w,textContentItemsStr:j,isOffscreenCanvasSupported:C}=R;this._textContentSource=P,this._isReadableStream=P instanceof ReadableStream,this._container=this._rootContainer=F,this._textDivs=I||[],this._textContentItemsStr=j||[],this._isOffscreenCanvasSupported=C,this._fontInspectorEnabled=!!((pe=globalThis.FontInspector)!=null&&pe.enabled),this._reader=null,this._textDivProperties=w||new WeakMap,this._canceled=!1,this._capability=new s.PromiseCapability,this._layoutTextParams={prevFontSize:null,prevFontFamily:null,div:null,scale:S.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:u(0,C)};const{pageWidth:V,pageHeight:O,pageX:H,pageY:z}=S.rawDims;this._transform=[1,0,0,-1,-H,z+O],this._pageWidth=V,this._pageHeight=O,(0,a.setLayerDimensions)(F,S),this._capability.promise.finally(()=>{this._layoutTextParams=null}).catch(()=>{})}get promise(){return this._capability.promise}cancel(){this._canceled=!0,this._reader&&(this._reader.cancel(new s.AbortException("TextLayer task cancelled.")).catch(()=>{}),this._reader=null),this._capability.reject(new s.AbortException("TextLayer task cancelled."))}_processItems(R,P){for(const F of R){if(F.str===void 0){if(F.type==="beginMarkedContentProps"||F.type==="beginMarkedContent"){const S=this._container;this._container=document.createElement("span"),this._container.classList.add("markedContent"),F.id!==null&&this._container.setAttribute("id",`${F.id}`),S.append(this._container)}else F.type==="endMarkedContent"&&(this._container=this._container.parentNode);continue}this._textContentItemsStr.push(F.str),_(this,F,P)}}_layoutText(R){const P=this._layoutTextParams.properties=this._textDivProperties.get(R);if(this._layoutTextParams.div=R,v(this._layoutTextParams),P.hasText&&this._container.append(R),P.hasEOL){const F=document.createElement("br");F.setAttribute("role","presentation"),this._container.append(F)}}_render(){const R=new s.PromiseCapability;let P=Object.create(null);if(this._isReadableStream){const F=()=>{this._reader.read().then(S=>{let{value:I,done:w}=S;if(w){R.resolve();return}Object.assign(P,I.styles),this._processItems(I.items,P),F()},R.reject)};this._reader=this._textContentSource.getReader(),F()}else if(this._textContentSource){const{items:F,styles:S}=this._textContentSource;this._processItems(F,S),R.resolve()}else throw new Error('No "textContentSource" parameter specified.');R.promise.then(()=>{P=null,b(this)},this._capability.reject)}}r.TextLayerRenderTask=E;function d(y){!y.textContentSource&&(y.textContent||y.textContentStream)&&((0,a.deprecated)("The TextLayerRender `textContent`/`textContentStream` parameters will be removed in the future, please use `textContentSource` instead."),y.textContentSource=y.textContent||y.textContentStream);const{container:R,viewport:P}=y,F=getComputedStyle(R),S=F.getPropertyValue("visibility"),I=parseFloat(F.getPropertyValue("--scale-factor"));S==="visible"&&(!I||Math.abs(I-P.scale)>1e-5)&&console.error("The `--scale-factor` CSS-variable must be set, to the same value as `viewport.scale`, either on the `container`-element itself or higher up in the DOM.");const w=new E(y);return w._render(),w}function g(y){let{container:R,viewport:P,textDivs:F,textDivProperties:S,isOffscreenCanvasSupported:I,mustRotate:w=!0,mustRescale:j=!0}=y;if(w&&(0,a.setLayerDimensions)(R,{rotation:P.rotation}),j){const C=u(0,I),O={prevFontSize:null,prevFontFamily:null,div:null,scale:P.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:C};for(const H of F)O.properties=S.get(H),O.div=H,v(O)}}},(t,r,e)=>{var h,_,v,b,E,d,g,y,R,P,F,Yr,wr,Zr,Jr;Object.defineProperty(r,"__esModule",{value:!0}),r.AnnotationEditorLayer=void 0,e(125),e(136),e(138),e(141),e(143),e(145),e(147);var s=e(1),a=e(164),i=e(197),o=e(202),c=e(168),x=e(203);const C=class C{constructor(O){Ie(this,F);Ie(this,h);Ie(this,_,!1);Ie(this,v,null);Ie(this,b,this.pointerup.bind(this));Ie(this,E,this.pointerdown.bind(this));Ie(this,d,new Map);Ie(this,g,!1);Ie(this,y,!1);Ie(this,R,!1);Ie(this,P);let{uiManager:H,pageIndex:z,div:pe,accessibilityManager:ee,annotationLayer:he,viewport:re,l10n:me}=O;const te=[i.FreeTextEditor,o.InkEditor,x.StampEditor];if(!C._initialized){C._initialized=!0;for(const ce of te)ce.initialize(me)}H.registerEditorTypes(te),ke(this,P,H),this.pageIndex=z,this.div=pe,ke(this,h,ee),ke(this,v,he),this.viewport=re,M(this,P).addLayer(this)}get isEmpty(){return M(this,d).size===0}updateToolbar(O){M(this,P).updateToolbar(O)}updateMode(){let O=arguments.length>0&&arguments[0]!==void 0?arguments[0]:M(this,P).getMode();Ae(this,F,Jr).call(this),O===s.AnnotationEditorType.INK?(this.addInkEditorIfNeeded(!1),this.disableClick()):this.enableClick(),O!==s.AnnotationEditorType.NONE&&(this.div.classList.toggle("freeTextEditing",O===s.AnnotationEditorType.FREETEXT),this.div.classList.toggle("inkEditing",O===s.AnnotationEditorType.INK),this.div.classList.toggle("stampEditing",O===s.AnnotationEditorType.STAMP),this.div.hidden=!1)}addInkEditorIfNeeded(O){if(!O&&M(this,P).getMode()!==s.AnnotationEditorType.INK)return;if(!O){for(const z of M(this,d).values())if(z.isEmpty()){z.setInBackground();return}}Ae(this,F,wr).call(this,{offsetX:0,offsetY:0},!1).setInBackground()}setEditingState(O){M(this,P).setEditingState(O)}addCommands(O){M(this,P).addCommands(O)}enable(){this.div.style.pointerEvents="auto";const O=new Set;for(const z of M(this,d).values())z.enableEditing(),z.annotationElementId&&O.add(z.annotationElementId);if(!M(this,v))return;const H=M(this,v).getEditableAnnotations();for(const z of H){if(z.hide(),M(this,P).isDeletedAnnotationElement(z.data.id)||O.has(z.data.id))continue;const pe=this.deserialize(z);pe&&(this.addOrRebuild(pe),pe.enableEditing())}}disable(){var H;ke(this,R,!0),this.div.style.pointerEvents="none";const O=new Set;for(const z of M(this,d).values()){if(z.disableEditing(),!z.annotationElementId||z.serialize()!==null){O.add(z.annotationElementId);continue}(H=this.getEditableAnnotation(z.annotationElementId))==null||H.show(),z.remove()}if(M(this,v)){const z=M(this,v).getEditableAnnotations();for(const pe of z){const{id:ee}=pe.data;O.has(ee)||M(this,P).isDeletedAnnotationElement(ee)||pe.show()}}Ae(this,F,Jr).call(this),this.isEmpty&&(this.div.hidden=!0),ke(this,R,!1)}getEditableAnnotation(O){var H;return((H=M(this,v))==null?void 0:H.getEditableAnnotation(O))||null}setActiveEditor(O){M(this,P).getActive()!==O&&M(this,P).setActiveEditor(O)}enableClick(){this.div.addEventListener("pointerdown",M(this,E)),this.div.addEventListener("pointerup",M(this,b))}disableClick(){this.div.removeEventListener("pointerdown",M(this,E)),this.div.removeEventListener("pointerup",M(this,b))}attach(O){M(this,d).set(O.id,O);const{annotationElementId:H}=O;H&&M(this,P).isDeletedAnnotationElement(H)&&M(this,P).removeDeletedAnnotationElement(O)}detach(O){var H;M(this,d).delete(O.id),(H=M(this,h))==null||H.removePointerInTextLayer(O.contentDiv),!M(this,R)&&O.annotationElementId&&M(this,P).addDeletedAnnotationElement(O)}remove(O){this.detach(O),M(this,P).removeEditor(O),O.div.contains(document.activeElement)&&setTimeout(()=>{M(this,P).focusMainContainer()},0),O.div.remove(),O.isAttachedToDOM=!1,M(this,y)||this.addInkEditorIfNeeded(!1)}changeParent(O){var H;O.parent!==this&&(O.annotationElementId&&(M(this,P).addDeletedAnnotationElement(O.annotationElementId),a.AnnotationEditor.deleteAnnotationElement(O),O.annotationElementId=null),this.attach(O),(H=O.parent)==null||H.detach(O),O.setParent(this),O.div&&O.isAttachedToDOM&&(O.div.remove(),this.div.append(O.div)))}add(O){if(this.changeParent(O),M(this,P).addEditor(O),this.attach(O),!O.isAttachedToDOM){const H=O.render();this.div.append(H),O.isAttachedToDOM=!0}O.fixAndSetPosition(),O.onceAdded(),M(this,P).addToAnnotationStorage(O)}moveEditorInDOM(O){var z;if(!O.isAttachedToDOM)return;const{activeElement:H}=document;O.div.contains(H)&&(O._focusEventsAllowed=!1,setTimeout(()=>{O.div.contains(document.activeElement)?O._focusEventsAllowed=!0:(O.div.addEventListener("focusin",()=>{O._focusEventsAllowed=!0},{once:!0}),H.focus())},0)),O._structTreeParentId=(z=M(this,h))==null?void 0:z.moveElementInDOM(this.div,O.div,O.contentDiv,!0)}addOrRebuild(O){O.needsToBeRebuilt()?O.rebuild():this.add(O)}addUndoableEditor(O){const H=()=>O._uiManager.rebuild(O),z=()=>{O.remove()};this.addCommands({cmd:H,undo:z,mustExec:!1})}getNextId(){return M(this,P).getId()}pasteEditor(O,H){M(this,P).updateToolbar(O),M(this,P).updateMode(O);const{offsetX:z,offsetY:pe}=Ae(this,F,Zr).call(this),ee=this.getNextId(),he=Ae(this,F,Yr).call(this,{parent:this,id:ee,x:z,y:pe,uiManager:M(this,P),isCentered:!0,...H});he&&this.add(he)}deserialize(O){switch(O.annotationType??O.annotationEditorType){case s.AnnotationEditorType.FREETEXT:return i.FreeTextEditor.deserialize(O,this,M(this,P));case s.AnnotationEditorType.INK:return o.InkEditor.deserialize(O,this,M(this,P));case s.AnnotationEditorType.STAMP:return x.StampEditor.deserialize(O,this,M(this,P))}return null}addNewEditor(){Ae(this,F,wr).call(this,Ae(this,F,Zr).call(this),!0)}setSelected(O){M(this,P).setSelected(O)}toggleSelected(O){M(this,P).toggleSelected(O)}isSelected(O){return M(this,P).isSelected(O)}unselect(O){M(this,P).unselect(O)}pointerup(O){const{isMac:H}=s.FeatureTest.platform;if(!(O.button!==0||O.ctrlKey&&H)&&O.target===this.div&&M(this,g)){if(ke(this,g,!1),!M(this,_)){ke(this,_,!0);return}if(M(this,P).getMode()===s.AnnotationEditorType.STAMP){M(this,P).unselectAll();return}Ae(this,F,wr).call(this,O,!1)}}pointerdown(O){if(M(this,g)){ke(this,g,!1);return}const{isMac:H}=s.FeatureTest.platform;if(O.button!==0||O.ctrlKey&&H||O.target!==this.div)return;ke(this,g,!0);const z=M(this,P).getActive();ke(this,_,!z||z.isEmpty())}findNewParent(O,H,z){const pe=M(this,P).findParent(H,z);return pe===null||pe===this?!1:(pe.changeParent(O),!0)}destroy(){var O,H;((O=M(this,P).getActive())==null?void 0:O.parent)===this&&(M(this,P).commitOrRemove(),M(this,P).setActiveEditor(null));for(const z of M(this,d).values())(H=M(this,h))==null||H.removePointerInTextLayer(z.contentDiv),z.setParent(null),z.isAttachedToDOM=!1,z.div.remove();this.div=null,M(this,d).clear(),M(this,P).removeLayer(this)}render(O){let{viewport:H}=O;this.viewport=H,(0,c.setLayerDimensions)(this.div,H);for(const z of M(this,P).getEditors(this.pageIndex))this.add(z);this.updateMode()}update(O){let{viewport:H}=O;M(this,P).commitOrRemove(),this.viewport=H,(0,c.setLayerDimensions)(this.div,{rotation:H.rotation}),this.updateMode()}get pageDimensions(){const{pageWidth:O,pageHeight:H}=this.viewport.rawDims;return[O,H]}};h=new WeakMap,_=new WeakMap,v=new WeakMap,b=new WeakMap,E=new WeakMap,d=new WeakMap,g=new WeakMap,y=new WeakMap,R=new WeakMap,P=new WeakMap,F=new WeakSet,Yr=function(O){switch(M(this,P).getMode()){case s.AnnotationEditorType.FREETEXT:return new i.FreeTextEditor(O);case s.AnnotationEditorType.INK:return new o.InkEditor(O);case s.AnnotationEditorType.STAMP:return new x.StampEditor(O)}return null},wr=function(O,H){const z=this.getNextId(),pe=Ae(this,F,Yr).call(this,{parent:this,id:z,x:O.offsetX,y:O.offsetY,uiManager:M(this,P),isCentered:H});return pe&&this.add(pe),pe},Zr=function(){const{x:O,y:H,width:z,height:pe}=this.div.getBoundingClientRect(),ee=Math.max(0,O),he=Math.max(0,H),re=Math.min(window.innerWidth,O+z),me=Math.min(window.innerHeight,H+pe),te=(ee+re)/2-O,ce=(he+me)/2-H,[ye,L]=this.viewport.rotation%180===0?[te,ce]:[ce,te];return{offsetX:ye,offsetY:L}},Jr=function(){ke(this,y,!0);for(const O of M(this,d).values())O.isEmpty()&&O.remove();ke(this,y,!1)},wt(C,"_initialized",!1);let u=C;r.AnnotationEditorLayer=u},(t,r,e)=>{var x,u,h,_,v,b,E,d,g,y,Ts,Cs,Ns,fr,Qr,Ps,qr;Object.defineProperty(r,"__esModule",{value:!0}),r.FreeTextEditor=void 0,e(89);var s=e(1),a=e(165),i=e(164),o=e(198);const C=class C extends i.AnnotationEditor{constructor(H){super({...H,name:"freeTextEditor"});Ie(this,y);Ie(this,x,this.editorDivBlur.bind(this));Ie(this,u,this.editorDivFocus.bind(this));Ie(this,h,this.editorDivInput.bind(this));Ie(this,_,this.editorDivKeydown.bind(this));Ie(this,v);Ie(this,b,"");Ie(this,E,`${this.id}-editor`);Ie(this,d);Ie(this,g,null);ke(this,v,H.color||C._defaultColor||i.AnnotationEditor._defaultLineColor),ke(this,d,H.fontSize||C._defaultFontSize)}static get _keyboardManager(){const H=C.prototype,z=he=>he.isEmpty(),pe=a.AnnotationEditorUIManager.TRANSLATE_SMALL,ee=a.AnnotationEditorUIManager.TRANSLATE_BIG;return(0,s.shadow)(this,"_keyboardManager",new a.KeyboardManager([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],H.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],H.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],H._translateEmpty,{args:[-pe,0],checker:z}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],H._translateEmpty,{args:[-ee,0],checker:z}],[["ArrowRight","mac+ArrowRight"],H._translateEmpty,{args:[pe,0],checker:z}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],H._translateEmpty,{args:[ee,0],checker:z}],[["ArrowUp","mac+ArrowUp"],H._translateEmpty,{args:[0,-pe],checker:z}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],H._translateEmpty,{args:[0,-ee],checker:z}],[["ArrowDown","mac+ArrowDown"],H._translateEmpty,{args:[0,pe],checker:z}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],H._translateEmpty,{args:[0,ee],checker:z}]]))}static initialize(H){i.AnnotationEditor.initialize(H,{strings:["free_text2_default_content","editor_free_text2_aria_label"]});const z=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(z.getPropertyValue("--freetext-padding"))}static updateDefaultParams(H,z){switch(H){case s.AnnotationEditorParamsType.FREETEXT_SIZE:C._defaultFontSize=z;break;case s.AnnotationEditorParamsType.FREETEXT_COLOR:C._defaultColor=z;break}}updateParams(H,z){switch(H){case s.AnnotationEditorParamsType.FREETEXT_SIZE:Ae(this,y,Ts).call(this,z);break;case s.AnnotationEditorParamsType.FREETEXT_COLOR:Ae(this,y,Cs).call(this,z);break}}static get defaultPropertiesToUpdate(){return[[s.AnnotationEditorParamsType.FREETEXT_SIZE,C._defaultFontSize],[s.AnnotationEditorParamsType.FREETEXT_COLOR,C._defaultColor||i.AnnotationEditor._defaultLineColor]]}get propertiesToUpdate(){return[[s.AnnotationEditorParamsType.FREETEXT_SIZE,M(this,d)],[s.AnnotationEditorParamsType.FREETEXT_COLOR,M(this,v)]]}_translateEmpty(H,z){this._uiManager.translateSelectedEditors(H,z,!0)}getInitialTranslation(){const H=this.parentScale;return[-C._internalPadding*H,-(C._internalPadding+M(this,d))*H]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){this.isInEditMode()||(this.parent.setEditingState(!1),this.parent.updateToolbar(s.AnnotationEditorType.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.editorDiv.addEventListener("keydown",M(this,_)),this.editorDiv.addEventListener("focus",M(this,u)),this.editorDiv.addEventListener("blur",M(this,x)),this.editorDiv.addEventListener("input",M(this,h)))}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",M(this,E)),this._isDraggable=!0,this.editorDiv.removeEventListener("keydown",M(this,_)),this.editorDiv.removeEventListener("focus",M(this,u)),this.editorDiv.removeEventListener("blur",M(this,x)),this.editorDiv.removeEventListener("input",M(this,h)),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freeTextEditing"))}focusin(H){this._focusEventsAllowed&&(super.focusin(H),H.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(){var H;if(this.width){Ae(this,y,qr).call(this);return}this.enableEditMode(),this.editorDiv.focus(),(H=this._initialOptions)!=null&&H.isCentered&&this.center(),this._initialOptions=null}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freeTextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const H=M(this,b),z=ke(this,b,Ae(this,y,Ns).call(this).trimEnd());if(H===z)return;const pe=ee=>{if(ke(this,b,ee),!ee){this.remove();return}Ae(this,y,Qr).call(this),this._uiManager.rebuild(this),Ae(this,y,fr).call(this)};this.addCommands({cmd:()=>{pe(z)},undo:()=>{pe(H)},mustExec:!1}),Ae(this,y,fr).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(H){this.enterInEditMode()}keydown(H){H.target===this.div&&H.key==="Enter"&&(this.enterInEditMode(),H.preventDefault())}editorDivKeydown(H){C._keyboardManager.exec(this,H)}editorDivFocus(H){this.isEditing=!0}editorDivBlur(H){this.isEditing=!1}editorDivInput(H){this.parent.div.classList.toggle("freeTextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let H,z;this.width&&(H=this.x,z=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",M(this,E)),this.enableEditing(),i.AnnotationEditor._l10nPromise.get("editor_free_text2_aria_label").then(ee=>{var he;return(he=this.editorDiv)==null?void 0:he.setAttribute("aria-label",ee)}),i.AnnotationEditor._l10nPromise.get("free_text2_default_content").then(ee=>{var he;return(he=this.editorDiv)==null?void 0:he.setAttribute("default-content",ee)}),this.editorDiv.contentEditable=!0;const{style:pe}=this.editorDiv;if(pe.fontSize=`calc(${M(this,d)}px * var(--scale-factor))`,pe.color=M(this,v),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),(0,a.bindEvents)(this,this.div,["dblclick","keydown"]),this.width){const[ee,he]=this.parentDimensions;if(this.annotationElementId){const{position:re}=M(this,g);let[me,te]=this.getInitialTranslation();[me,te]=this.pageTranslationToScreen(me,te);const[ce,ye]=this.pageDimensions,[L,N]=this.pageTranslation;let T,A;switch(this.rotation){case 0:T=H+(re[0]-L)/ce,A=z+this.height-(re[1]-N)/ye;break;case 90:T=H+(re[0]-L)/ce,A=z-(re[1]-N)/ye,[me,te]=[te,-me];break;case 180:T=H-this.width+(re[0]-L)/ce,A=z-(re[1]-N)/ye,[me,te]=[-me,-te];break;case 270:T=H+(re[0]-L-this.height*ye)/ce,A=z+(re[1]-N-this.width*ce)/ye,[me,te]=[-te,me];break}this.setAt(T*ee,A*he,me,te)}else this.setAt(H*ee,z*he,this.width*ee,this.height*he);Ae(this,y,Qr).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}get contentDiv(){return this.editorDiv}static deserialize(H,z,pe){let ee=null;if(H instanceof o.FreeTextAnnotationElement){const{data:{defaultAppearanceData:{fontSize:re,fontColor:me},rect:te,rotation:ce,id:ye},textContent:L,textPosition:N,parent:{page:{pageNumber:T}}}=H;if(!L||L.length===0)return null;ee=H={annotationType:s.AnnotationEditorType.FREETEXT,color:Array.from(me),fontSize:re,value:L.join(`
`),position:N,pageIndex:T-1,rect:te,rotation:ce,id:ye,deleted:!1}}const he=super.deserialize(H,z,pe);return ke(he,d,H.fontSize),ke(he,v,s.Util.makeHexColor(...H.color)),ke(he,b,H.value),he.annotationElementId=H.id||null,ke(he,g,ee),he}serialize(){let H=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(this.isEmpty())return null;if(this.deleted)return{pageIndex:this.pageIndex,id:this.annotationElementId,deleted:!0};const z=C._internalPadding*this.parentScale,pe=this.getRect(z,z),ee=i.AnnotationEditor._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:M(this,v)),he={annotationType:s.AnnotationEditorType.FREETEXT,color:ee,fontSize:M(this,d),value:M(this,b),pageIndex:this.pageIndex,rect:pe,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return H?he:this.annotationElementId&&!Ae(this,y,Ps).call(this,he)?null:(he.id=this.annotationElementId,he)}};x=new WeakMap,u=new WeakMap,h=new WeakMap,_=new WeakMap,v=new WeakMap,b=new WeakMap,E=new WeakMap,d=new WeakMap,g=new WeakMap,y=new WeakSet,Ts=function(H){const z=ee=>{this.editorDiv.style.fontSize=`calc(${ee}px * var(--scale-factor))`,this.translate(0,-(ee-M(this,d))*this.parentScale),ke(this,d,ee),Ae(this,y,fr).call(this)},pe=M(this,d);this.addCommands({cmd:()=>{z(H)},undo:()=>{z(pe)},mustExec:!0,type:s.AnnotationEditorParamsType.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},Cs=function(H){const z=M(this,v);this.addCommands({cmd:()=>{ke(this,v,this.editorDiv.style.color=H)},undo:()=>{ke(this,v,this.editorDiv.style.color=z)},mustExec:!0,type:s.AnnotationEditorParamsType.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},Ns=function(){const H=this.editorDiv.getElementsByTagName("div");if(H.length===0)return this.editorDiv.innerText;const z=[];for(const pe of H)z.push(pe.innerText.replace(/\r\n?|\n/,""));return z.join(`
`)},fr=function(){const[H,z]=this.parentDimensions;let pe;if(this.isAttachedToDOM)pe=this.div.getBoundingClientRect();else{const{currentLayer:ee,div:he}=this,re=he.style.display;he.style.display="hidden",ee.div.append(this.div),pe=he.getBoundingClientRect(),he.remove(),he.style.display=re}this.rotation%180===this.parentRotation%180?(this.width=pe.width/H,this.height=pe.height/z):(this.width=pe.height/H,this.height=pe.width/z),this.fixAndSetPosition()},Qr=function(){if(this.editorDiv.replaceChildren(),!!M(this,b))for(const H of M(this,b).split(`
`)){const z=document.createElement("div");z.append(H?document.createTextNode(H):document.createElement("br")),this.editorDiv.append(z)}},Ps=function(H){const{value:z,fontSize:pe,color:ee,rect:he,pageIndex:re}=M(this,g);return H.value!==z||H.fontSize!==pe||H.rect.some((me,te)=>Math.abs(me-he[te])>=1)||H.color.some((me,te)=>me!==ee[te])||H.pageIndex!==re},qr=function(){let H=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(!this.annotationElementId)return;if(Ae(this,y,fr).call(this),!H&&(this.width===0||this.height===0)){setTimeout(()=>Ae(this,y,qr).call(this,!0),0);return}const z=C._internalPadding*this.parentScale;M(this,g).rect=this.getRect(z,z)},wt(C,"_freeTextDefaultContent",""),wt(C,"_internalPadding",0),wt(C,"_defaultColor",null),wt(C,"_defaultFontSize",10),wt(C,"_type","freetext");let c=C;r.FreeTextEditor=c},(t,r,e)=>{var A,B,Qt,js,G,fe,xe,Se,Ce,Me,be,ae,J,oe,Q,ge,Te,Le,Re,Ee,ze,Xe,Fs,Sr,es,ts,nt,ht,ft,pt,Ge,Ne,je,rs,ct,K,_e,We,Is,ss;Object.defineProperty(r,"__esModule",{value:!0}),r.StampAnnotationElement=r.InkAnnotationElement=r.FreeTextAnnotationElement=r.AnnotationLayer=void 0,e(89),e(125),e(136),e(138),e(141),e(143),e(145),e(147);var s=e(1),a=e(168),i=e(163),o=e(199),c=e(200),x=e(201);const u=1e3,h=9,_=new WeakSet;function v($e){return{width:$e[2]-$e[0],height:$e[3]-$e[1]}}class b{static create(ne){switch(ne.data.annotationType){case s.AnnotationType.LINK:return new d(ne);case s.AnnotationType.TEXT:return new g(ne);case s.AnnotationType.WIDGET:switch(ne.data.fieldType){case"Tx":return new R(ne);case"Btn":return ne.data.radioButton?new S(ne):ne.data.checkBox?new F(ne):new I(ne);case"Ch":return new w(ne);case"Sig":return new P(ne)}return new y(ne);case s.AnnotationType.POPUP:return new j(ne);case s.AnnotationType.FREETEXT:return new V(ne);case s.AnnotationType.LINE:return new O(ne);case s.AnnotationType.SQUARE:return new H(ne);case s.AnnotationType.CIRCLE:return new z(ne);case s.AnnotationType.POLYLINE:return new pe(ne);case s.AnnotationType.CARET:return new he(ne);case s.AnnotationType.INK:return new re(ne);case s.AnnotationType.POLYGON:return new ee(ne);case s.AnnotationType.HIGHLIGHT:return new me(ne);case s.AnnotationType.UNDERLINE:return new te(ne);case s.AnnotationType.SQUIGGLY:return new ce(ne);case s.AnnotationType.STRIKEOUT:return new ye(ne);case s.AnnotationType.STAMP:return new L(ne);case s.AnnotationType.FILEATTACHMENT:return new N(ne);default:return new E(ne)}}}const D=class D{constructor(ne){Ie(this,A,!1);let{isRenderable:se=!1,ignoreBorder:ve=!1,createQuadrilaterals:we=!1}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.isRenderable=se,this.data=ne.data,this.layer=ne.layer,this.linkService=ne.linkService,this.downloadManager=ne.downloadManager,this.imageResourcesPath=ne.imageResourcesPath,this.renderForms=ne.renderForms,this.svgFactory=ne.svgFactory,this.annotationStorage=ne.annotationStorage,this.enableScripting=ne.enableScripting,this.hasJSActions=ne.hasJSActions,this._fieldObjects=ne.fieldObjects,this.parent=ne.parent,se&&(this.container=this._createContainer(ve)),we&&this._createQuadrilaterals()}static _hasPopupData(ne){let{titleObj:se,contentsObj:ve,richText:we}=ne;return!!(se!=null&&se.str||ve!=null&&ve.str||we!=null&&we.str)}get hasPopupData(){return D._hasPopupData(this.data)}_createContainer(ne){const{data:se,parent:{page:ve,viewport:we}}=this,Fe=document.createElement("section");Fe.setAttribute("data-annotation-id",se.id),this instanceof y||(Fe.tabIndex=u),Fe.style.zIndex=this.parent.zIndex++,this.data.popupRef&&Fe.setAttribute("aria-haspopup","dialog"),se.noRotate&&Fe.classList.add("norotate");const{pageWidth:He,pageHeight:Ue,pageX:at,pageY:it}=we.rawDims;if(!se.rect||this instanceof j){const{rotation:de}=se;return!se.hasOwnCanvas&&de!==0&&this.setRotation(de,Fe),Fe}const{width:W,height:le}=v(se.rect),Z=s.Util.normalizeRect([se.rect[0],ve.view[3]-se.rect[1]+ve.view[1],se.rect[2],ve.view[3]-se.rect[3]+ve.view[1]]);if(!ne&&se.borderStyle.width>0){Fe.style.borderWidth=`${se.borderStyle.width}px`;const de=se.borderStyle.horizontalCornerRadius,ue=se.borderStyle.verticalCornerRadius;if(de>0||ue>0){const Be=`calc(${de}px * var(--scale-factor)) / calc(${ue}px * var(--scale-factor))`;Fe.style.borderRadius=Be}else if(this instanceof S){const Be=`calc(${W}px * var(--scale-factor)) / calc(${le}px * var(--scale-factor))`;Fe.style.borderRadius=Be}switch(se.borderStyle.style){case s.AnnotationBorderStyleType.SOLID:Fe.style.borderStyle="solid";break;case s.AnnotationBorderStyleType.DASHED:Fe.style.borderStyle="dashed";break;case s.AnnotationBorderStyleType.BEVELED:(0,s.warn)("Unimplemented border style: beveled");break;case s.AnnotationBorderStyleType.INSET:(0,s.warn)("Unimplemented border style: inset");break;case s.AnnotationBorderStyleType.UNDERLINE:Fe.style.borderBottomStyle="solid";break}const Pe=se.borderColor||null;Pe?(ke(this,A,!0),Fe.style.borderColor=s.Util.makeHexColor(Pe[0]|0,Pe[1]|0,Pe[2]|0)):Fe.style.borderWidth=0}Fe.style.left=`${100*(Z[0]-at)/He}%`,Fe.style.top=`${100*(Z[1]-it)/Ue}%`;const{rotation:ie}=se;return se.hasOwnCanvas||ie===0?(Fe.style.width=`${100*W/He}%`,Fe.style.height=`${100*le/Ue}%`):this.setRotation(ie,Fe),Fe}setRotation(ne){let se=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.container;if(!this.data.rect)return;const{pageWidth:ve,pageHeight:we}=this.parent.viewport.rawDims,{width:Fe,height:He}=v(this.data.rect);let Ue,at;ne%180===0?(Ue=100*Fe/ve,at=100*He/we):(Ue=100*He/ve,at=100*Fe/we),se.style.width=`${Ue}%`,se.style.height=`${at}%`,se.setAttribute("data-main-rotation",(360-ne)%360)}get _commonActions(){const ne=(se,ve,we)=>{const Fe=we.detail[se],He=Fe[0],Ue=Fe.slice(1);we.target.style[ve]=o.ColorConverters[`${He}_HTML`](Ue),this.annotationStorage.setValue(this.data.id,{[ve]:o.ColorConverters[`${He}_rgb`](Ue)})};return(0,s.shadow)(this,"_commonActions",{display:se=>{const{display:ve}=se.detail,we=ve%2===1;this.container.style.visibility=we?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:we,noPrint:ve===1||ve===2})},print:se=>{this.annotationStorage.setValue(this.data.id,{noPrint:!se.detail.print})},hidden:se=>{const{hidden:ve}=se.detail;this.container.style.visibility=ve?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:ve,noView:ve})},focus:se=>{setTimeout(()=>se.target.focus({preventScroll:!1}),0)},userName:se=>{se.target.title=se.detail.userName},readonly:se=>{se.target.disabled=se.detail.readonly},required:se=>{this._setRequired(se.target,se.detail.required)},bgColor:se=>{ne("bgColor","backgroundColor",se)},fillColor:se=>{ne("fillColor","backgroundColor",se)},fgColor:se=>{ne("fgColor","color",se)},textColor:se=>{ne("textColor","color",se)},borderColor:se=>{ne("borderColor","borderColor",se)},strokeColor:se=>{ne("strokeColor","borderColor",se)},rotation:se=>{const ve=se.detail.rotation;this.setRotation(ve),this.annotationStorage.setValue(this.data.id,{rotation:ve})}})}_dispatchEventFromSandbox(ne,se){const ve=this._commonActions;for(const we of Object.keys(se.detail)){const Fe=ne[we]||ve[we];Fe==null||Fe(se)}}_setDefaultPropertiesFromJS(ne){if(!this.enableScripting)return;const se=this.annotationStorage.getRawValue(this.data.id);if(!se)return;const ve=this._commonActions;for(const[we,Fe]of Object.entries(se)){const He=ve[we];if(He){const Ue={detail:{[we]:Fe},target:ne};He(Ue),delete se[we]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:ne}=this.data;if(!ne)return;const[se,ve,we,Fe]=this.data.rect;if(ne.length===1){const[,{x:ue,y:Pe},{x:Be,y:De}]=ne[0];if(we===ue&&Fe===Pe&&se===Be&&ve===De)return}const{style:He}=this.container;let Ue;if(M(this,A)){const{borderColor:ue,borderWidth:Pe}=He;He.borderWidth=0,Ue=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${ue}" stroke-width="${Pe}">`],this.container.classList.add("hasBorder")}const at=we-se,it=Fe-ve,{svgFactory:W}=this,le=W.createElement("svg");le.classList.add("quadrilateralsContainer"),le.setAttribute("width",0),le.setAttribute("height",0);const Z=W.createElement("defs");le.append(Z);const ie=W.createElement("clipPath"),de=`clippath_${this.data.id}`;ie.setAttribute("id",de),ie.setAttribute("clipPathUnits","objectBoundingBox"),Z.append(ie);for(const[,{x:ue,y:Pe},{x:Be,y:De}]of ne){const Oe=W.createElement("rect"),Ve=(Be-se)/at,Je=(Fe-Pe)/it,et=(ue-Be)/at,ut=(Pe-De)/it;Oe.setAttribute("x",Ve),Oe.setAttribute("y",Je),Oe.setAttribute("width",et),Oe.setAttribute("height",ut),ie.append(Oe),Ue==null||Ue.push(`<rect vector-effect="non-scaling-stroke" x="${Ve}" y="${Je}" width="${et}" height="${ut}"/>`)}M(this,A)&&(Ue.push("</g></svg>')"),He.backgroundImage=Ue.join("")),this.container.append(le),this.container.style.clipPath=`url(#${de})`}_createPopup(){const{container:ne,data:se}=this;ne.setAttribute("aria-haspopup","dialog");const ve=new j({data:{color:se.color,titleObj:se.titleObj,modificationDate:se.modificationDate,contentsObj:se.contentsObj,richText:se.richText,parentRect:se.rect,borderStyle:0,id:`popup_${se.id}`,rotation:se.rotation},parent:this.parent,elements:[this]});this.parent.div.append(ve.render())}render(){(0,s.unreachable)("Abstract method `AnnotationElement.render` called")}_getElementsByName(ne){let se=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const ve=[];if(this._fieldObjects){const we=this._fieldObjects[ne];if(we)for(const{page:Fe,id:He,exportValues:Ue}of we){if(Fe===-1||He===se)continue;const at=typeof Ue=="string"?Ue:null,it=document.querySelector(`[data-element-id="${He}"]`);if(it&&!_.has(it)){(0,s.warn)(`_getElementsByName - element not allowed: ${He}`);continue}ve.push({id:He,exportValue:at,domElement:it})}return ve}for(const we of document.getElementsByName(ne)){const{exportValue:Fe}=we,He=we.getAttribute("data-element-id");He!==se&&_.has(we)&&ve.push({id:He,exportValue:Fe,domElement:we})}return ve}show(){var ne;this.container&&(this.container.hidden=!1),(ne=this.popup)==null||ne.maybeShow()}hide(){var ne;this.container&&(this.container.hidden=!0),(ne=this.popup)==null||ne.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const ne=this.getElementsToTriggerPopup();if(Array.isArray(ne))for(const se of ne)se.classList.add("highlightArea");else ne.classList.add("highlightArea")}_editOnDoubleClick(){const{annotationEditorType:ne,data:{id:se}}=this;this.container.addEventListener("dblclick",()=>{var ve;(ve=this.linkService.eventBus)==null||ve.dispatch("switchannotationeditormode",{source:this,mode:ne,editId:se})})}};A=new WeakMap;let E=D;class d extends E{constructor(se){let ve=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;super(se,{isRenderable:!0,ignoreBorder:!!(ve!=null&&ve.ignoreBorder),createQuadrilaterals:!0});Ie(this,B);this.isTooltipOnly=se.data.isTooltipOnly}render(){const{data:se,linkService:ve}=this,we=document.createElement("a");we.setAttribute("data-element-id",se.id);let Fe=!1;return se.url?(ve.addLinkAttributes(we,se.url,se.newWindow),Fe=!0):se.action?(this._bindNamedAction(we,se.action),Fe=!0):se.attachment?(this._bindAttachment(we,se.attachment),Fe=!0):se.setOCGState?(Ae(this,B,js).call(this,we,se.setOCGState),Fe=!0):se.dest?(this._bindLink(we,se.dest),Fe=!0):(se.actions&&(se.actions.Action||se.actions["Mouse Up"]||se.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(we,se),Fe=!0),se.resetForm?(this._bindResetFormAction(we,se.resetForm),Fe=!0):this.isTooltipOnly&&!Fe&&(this._bindLink(we,""),Fe=!0)),this.container.classList.add("linkAnnotation"),Fe&&this.container.append(we),this.container}_bindLink(se,ve){se.href=this.linkService.getDestinationHash(ve),se.onclick=()=>(ve&&this.linkService.goToDestination(ve),!1),(ve||ve==="")&&Ae(this,B,Qt).call(this)}_bindNamedAction(se,ve){se.href=this.linkService.getAnchorUrl(""),se.onclick=()=>(this.linkService.executeNamedAction(ve),!1),Ae(this,B,Qt).call(this)}_bindAttachment(se,ve){se.href=this.linkService.getAnchorUrl(""),se.onclick=()=>{var we;return(we=this.downloadManager)==null||we.openOrDownloadData(this.container,ve.content,ve.filename),!1},Ae(this,B,Qt).call(this)}_bindJSAction(se,ve){se.href=this.linkService.getAnchorUrl("");const we=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const Fe of Object.keys(ve.actions)){const He=we.get(Fe);He&&(se[He]=()=>{var Ue;return(Ue=this.linkService.eventBus)==null||Ue.dispatch("dispatcheventinsandbox",{source:this,detail:{id:ve.id,name:Fe}}),!1})}se.onclick||(se.onclick=()=>!1),Ae(this,B,Qt).call(this)}_bindResetFormAction(se,ve){const we=se.onclick;if(we||(se.href=this.linkService.getAnchorUrl("")),Ae(this,B,Qt).call(this),!this._fieldObjects){(0,s.warn)('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),we||(se.onclick=()=>!1);return}se.onclick=()=>{var le;we==null||we();const{fields:Fe,refs:He,include:Ue}=ve,at=[];if(Fe.length!==0||He.length!==0){const Z=new Set(He);for(const ie of Fe){const de=this._fieldObjects[ie]||[];for(const{id:ue}of de)Z.add(ue)}for(const ie of Object.values(this._fieldObjects))for(const de of ie)Z.has(de.id)===Ue&&at.push(de)}else for(const Z of Object.values(this._fieldObjects))at.push(...Z);const it=this.annotationStorage,W=[];for(const Z of at){const{id:ie}=Z;switch(W.push(ie),Z.type){case"text":{const ue=Z.defaultValue||"";it.setValue(ie,{value:ue});break}case"checkbox":case"radiobutton":{const ue=Z.defaultValue===Z.exportValues;it.setValue(ie,{value:ue});break}case"combobox":case"listbox":{const ue=Z.defaultValue||"";it.setValue(ie,{value:ue});break}default:continue}const de=document.querySelector(`[data-element-id="${ie}"]`);if(de){if(!_.has(de)){(0,s.warn)(`_bindResetFormAction - element not allowed: ${ie}`);continue}}else continue;de.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((le=this.linkService.eventBus)==null||le.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:W,name:"ResetForm"}})),!1}}}B=new WeakSet,Qt=function(){this.container.setAttribute("data-internal-link","")},js=function(se,ve){se.href=this.linkService.getAnchorUrl(""),se.onclick=()=>(this.linkService.executeSetOCGState(ve),!1),Ae(this,B,Qt).call(this)};class g extends E{constructor(ne){super(ne,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const ne=document.createElement("img");return ne.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",ne.alt="[{{type}} Annotation]",ne.dataset.l10nId="text_annotation_type",ne.dataset.l10nArgs=JSON.stringify({type:this.data.name}),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(ne),this.container}}class y extends E{render(){return this.data.alternativeText&&(this.container.title=this.data.alternativeText),this.container}showElementAndHideCanvas(ne){var se;this.data.hasOwnCanvas&&(((se=ne.previousSibling)==null?void 0:se.nodeName)==="CANVAS"&&(ne.previousSibling.hidden=!0),ne.hidden=!1)}_getKeyModifier(ne){const{isWin:se,isMac:ve}=s.FeatureTest.platform;return se&&ne.ctrlKey||ve&&ne.metaKey}_setEventListener(ne,se,ve,we,Fe){ve.includes("mouse")?ne.addEventListener(ve,He=>{var Ue;(Ue=this.linkService.eventBus)==null||Ue.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:we,value:Fe(He),shift:He.shiftKey,modifier:this._getKeyModifier(He)}})}):ne.addEventListener(ve,He=>{var Ue;if(ve==="blur"){if(!se.focused||!He.relatedTarget)return;se.focused=!1}else if(ve==="focus"){if(se.focused)return;se.focused=!0}Fe&&((Ue=this.linkService.eventBus)==null||Ue.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:we,value:Fe(He)}}))})}_setEventListeners(ne,se,ve,we){var Fe,He,Ue;for(const[at,it]of ve)(it==="Action"||(Fe=this.data.actions)!=null&&Fe[it])&&((it==="Focus"||it==="Blur")&&(se||(se={focused:!1})),this._setEventListener(ne,se,at,it,we),it==="Focus"&&!((He=this.data.actions)!=null&&He.Blur)?this._setEventListener(ne,se,"blur","Blur",null):it==="Blur"&&!((Ue=this.data.actions)!=null&&Ue.Focus)&&this._setEventListener(ne,se,"focus","Focus",null))}_setBackgroundColor(ne){const se=this.data.backgroundColor||null;ne.style.backgroundColor=se===null?"transparent":s.Util.makeHexColor(se[0],se[1],se[2])}_setTextStyle(ne){const se=["left","center","right"],{fontColor:ve}=this.data.defaultAppearanceData,we=this.data.defaultAppearanceData.fontSize||h,Fe=ne.style;let He;const Ue=2,at=it=>Math.round(10*it)/10;if(this.data.multiLine){const it=Math.abs(this.data.rect[3]-this.data.rect[1]-Ue),W=Math.round(it/(s.LINE_FACTOR*we))||1,le=it/W;He=Math.min(we,at(le/s.LINE_FACTOR))}else{const it=Math.abs(this.data.rect[3]-this.data.rect[1]-Ue);He=Math.min(we,at(it/s.LINE_FACTOR))}Fe.fontSize=`calc(${He}px * var(--scale-factor))`,Fe.color=s.Util.makeHexColor(ve[0],ve[1],ve[2]),this.data.textAlignment!==null&&(Fe.textAlign=se[this.data.textAlignment])}_setRequired(ne,se){se?ne.setAttribute("required",!0):ne.removeAttribute("required"),ne.setAttribute("aria-required",se)}}class R extends y{constructor(ne){const se=ne.renderForms||!ne.data.hasAppearance&&!!ne.data.fieldValue;super(ne,{isRenderable:se})}setPropertyOnSiblings(ne,se,ve,we){const Fe=this.annotationStorage;for(const He of this._getElementsByName(ne.name,ne.id))He.domElement&&(He.domElement[se]=ve),Fe.setValue(He.id,{[we]:ve})}render(){var we,Fe;const ne=this.annotationStorage,se=this.data.id;this.container.classList.add("textWidgetAnnotation");let ve=null;if(this.renderForms){const He=ne.getValue(se,{value:this.data.fieldValue});let Ue=He.value||"";const at=ne.getValue(se,{charLimit:this.data.maxLen}).charLimit;at&&Ue.length>at&&(Ue=Ue.slice(0,at));let it=He.formattedValue||((we=this.data.textContent)==null?void 0:we.join(`
`))||null;it&&this.data.comb&&(it=it.replaceAll(/\s+/g,""));const W={userValue:Ue,formattedValue:it,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(ve=document.createElement("textarea"),ve.textContent=it??Ue,this.data.doNotScroll&&(ve.style.overflowY="hidden")):(ve=document.createElement("input"),ve.type="text",ve.setAttribute("value",it??Ue),this.data.doNotScroll&&(ve.style.overflowX="hidden")),this.data.hasOwnCanvas&&(ve.hidden=!0),_.add(ve),ve.setAttribute("data-element-id",se),ve.disabled=this.data.readOnly,ve.name=this.data.fieldName,ve.tabIndex=u,this._setRequired(ve,this.data.required),at&&(ve.maxLength=at),ve.addEventListener("input",Z=>{ne.setValue(se,{value:Z.target.value}),this.setPropertyOnSiblings(ve,"value",Z.target.value,"value"),W.formattedValue=null}),ve.addEventListener("resetform",Z=>{const ie=this.data.defaultFieldValue??"";ve.value=W.userValue=ie,W.formattedValue=null});let le=Z=>{const{formattedValue:ie}=W;ie!=null&&(Z.target.value=ie),Z.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){ve.addEventListener("focus",ie=>{if(W.focused)return;const{target:de}=ie;W.userValue&&(de.value=W.userValue),W.lastCommittedValue=de.value,W.commitKey=1,W.focused=!0}),ve.addEventListener("updatefromsandbox",ie=>{this.showElementAndHideCanvas(ie.target);const de={value(ue){W.userValue=ue.detail.value??"",ne.setValue(se,{value:W.userValue.toString()}),ue.target.value=W.userValue},formattedValue(ue){const{formattedValue:Pe}=ue.detail;W.formattedValue=Pe,Pe!=null&&ue.target!==document.activeElement&&(ue.target.value=Pe),ne.setValue(se,{formattedValue:Pe})},selRange(ue){ue.target.setSelectionRange(...ue.detail.selRange)},charLimit:ue=>{var Oe;const{charLimit:Pe}=ue.detail,{target:Be}=ue;if(Pe===0){Be.removeAttribute("maxLength");return}Be.setAttribute("maxLength",Pe);let De=W.userValue;!De||De.length<=Pe||(De=De.slice(0,Pe),Be.value=W.userValue=De,ne.setValue(se,{value:De}),(Oe=this.linkService.eventBus)==null||Oe.dispatch("dispatcheventinsandbox",{source:this,detail:{id:se,name:"Keystroke",value:De,willCommit:!0,commitKey:1,selStart:Be.selectionStart,selEnd:Be.selectionEnd}}))}};this._dispatchEventFromSandbox(de,ie)}),ve.addEventListener("keydown",ie=>{var Pe;W.commitKey=1;let de=-1;if(ie.key==="Escape"?de=0:ie.key==="Enter"&&!this.data.multiLine?de=2:ie.key==="Tab"&&(W.commitKey=3),de===-1)return;const{value:ue}=ie.target;W.lastCommittedValue!==ue&&(W.lastCommittedValue=ue,W.userValue=ue,(Pe=this.linkService.eventBus)==null||Pe.dispatch("dispatcheventinsandbox",{source:this,detail:{id:se,name:"Keystroke",value:ue,willCommit:!0,commitKey:de,selStart:ie.target.selectionStart,selEnd:ie.target.selectionEnd}}))});const Z=le;le=null,ve.addEventListener("blur",ie=>{var ue;if(!W.focused||!ie.relatedTarget)return;W.focused=!1;const{value:de}=ie.target;W.userValue=de,W.lastCommittedValue!==de&&((ue=this.linkService.eventBus)==null||ue.dispatch("dispatcheventinsandbox",{source:this,detail:{id:se,name:"Keystroke",value:de,willCommit:!0,commitKey:W.commitKey,selStart:ie.target.selectionStart,selEnd:ie.target.selectionEnd}})),Z(ie)}),(Fe=this.data.actions)!=null&&Fe.Keystroke&&ve.addEventListener("beforeinput",ie=>{var Je;W.lastCommittedValue=null;const{data:de,target:ue}=ie,{value:Pe,selectionStart:Be,selectionEnd:De}=ue;let Oe=Be,Ve=De;switch(ie.inputType){case"deleteWordBackward":{const et=Pe.substring(0,Be).match(/\w*[^\w]*$/);et&&(Oe-=et[0].length);break}case"deleteWordForward":{const et=Pe.substring(Be).match(/^[^\w]*\w*/);et&&(Ve+=et[0].length);break}case"deleteContentBackward":Be===De&&(Oe-=1);break;case"deleteContentForward":Be===De&&(Ve+=1);break}ie.preventDefault(),(Je=this.linkService.eventBus)==null||Je.dispatch("dispatcheventinsandbox",{source:this,detail:{id:se,name:"Keystroke",value:Pe,change:de||"",willCommit:!1,selStart:Oe,selEnd:Ve}})}),this._setEventListeners(ve,W,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],ie=>ie.target.value)}if(le&&ve.addEventListener("blur",le),this.data.comb){const ie=(this.data.rect[2]-this.data.rect[0])/at;ve.classList.add("comb"),ve.style.letterSpacing=`calc(${ie}px * var(--scale-factor) - 1ch)`}}else ve=document.createElement("div"),ve.textContent=this.data.fieldValue,ve.style.verticalAlign="middle",ve.style.display="table-cell";return this._setTextStyle(ve),this._setBackgroundColor(ve),this._setDefaultPropertiesFromJS(ve),this.container.append(ve),this.container}}class P extends y{constructor(ne){super(ne,{isRenderable:!!ne.data.hasOwnCanvas})}}class F extends y{constructor(ne){super(ne,{isRenderable:ne.renderForms})}render(){const ne=this.annotationStorage,se=this.data,ve=se.id;let we=ne.getValue(ve,{value:se.exportValue===se.fieldValue}).value;typeof we=="string"&&(we=we!=="Off",ne.setValue(ve,{value:we})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const Fe=document.createElement("input");return _.add(Fe),Fe.setAttribute("data-element-id",ve),Fe.disabled=se.readOnly,this._setRequired(Fe,this.data.required),Fe.type="checkbox",Fe.name=se.fieldName,we&&Fe.setAttribute("checked",!0),Fe.setAttribute("exportValue",se.exportValue),Fe.tabIndex=u,Fe.addEventListener("change",He=>{const{name:Ue,checked:at}=He.target;for(const it of this._getElementsByName(Ue,ve)){const W=at&&it.exportValue===se.exportValue;it.domElement&&(it.domElement.checked=W),ne.setValue(it.id,{value:W})}ne.setValue(ve,{value:at})}),Fe.addEventListener("resetform",He=>{const Ue=se.defaultFieldValue||"Off";He.target.checked=Ue===se.exportValue}),this.enableScripting&&this.hasJSActions&&(Fe.addEventListener("updatefromsandbox",He=>{const Ue={value(at){at.target.checked=at.detail.value!=="Off",ne.setValue(ve,{value:at.target.checked})}};this._dispatchEventFromSandbox(Ue,He)}),this._setEventListeners(Fe,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],He=>He.target.checked)),this._setBackgroundColor(Fe),this._setDefaultPropertiesFromJS(Fe),this.container.append(Fe),this.container}}class S extends y{constructor(ne){super(ne,{isRenderable:ne.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const ne=this.annotationStorage,se=this.data,ve=se.id;let we=ne.getValue(ve,{value:se.fieldValue===se.buttonValue}).value;typeof we=="string"&&(we=we!==se.buttonValue,ne.setValue(ve,{value:we}));const Fe=document.createElement("input");if(_.add(Fe),Fe.setAttribute("data-element-id",ve),Fe.disabled=se.readOnly,this._setRequired(Fe,this.data.required),Fe.type="radio",Fe.name=se.fieldName,we&&Fe.setAttribute("checked",!0),Fe.tabIndex=u,Fe.addEventListener("change",He=>{const{name:Ue,checked:at}=He.target;for(const it of this._getElementsByName(Ue,ve))ne.setValue(it.id,{value:!1});ne.setValue(ve,{value:at})}),Fe.addEventListener("resetform",He=>{const Ue=se.defaultFieldValue;He.target.checked=Ue!=null&&Ue===se.buttonValue}),this.enableScripting&&this.hasJSActions){const He=se.buttonValue;Fe.addEventListener("updatefromsandbox",Ue=>{const at={value:it=>{const W=He===it.detail.value;for(const le of this._getElementsByName(it.target.name)){const Z=W&&le.id===ve;le.domElement&&(le.domElement.checked=Z),ne.setValue(le.id,{value:Z})}}};this._dispatchEventFromSandbox(at,Ue)}),this._setEventListeners(Fe,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],Ue=>Ue.target.checked)}return this._setBackgroundColor(Fe),this._setDefaultPropertiesFromJS(Fe),this.container.append(Fe),this.container}}class I extends d{constructor(ne){super(ne,{ignoreBorder:ne.data.hasAppearance})}render(){const ne=super.render();ne.classList.add("buttonWidgetAnnotation","pushButton"),this.data.alternativeText&&(ne.title=this.data.alternativeText);const se=ne.lastChild;return this.enableScripting&&this.hasJSActions&&se&&(this._setDefaultPropertiesFromJS(se),se.addEventListener("updatefromsandbox",ve=>{this._dispatchEventFromSandbox({},ve)})),ne}}class w extends y{constructor(ne){super(ne,{isRenderable:ne.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const ne=this.annotationStorage,se=this.data.id,ve=ne.getValue(se,{value:this.data.fieldValue}),we=document.createElement("select");_.add(we),we.setAttribute("data-element-id",se),we.disabled=this.data.readOnly,this._setRequired(we,this.data.required),we.name=this.data.fieldName,we.tabIndex=u;let Fe=this.data.combo&&this.data.options.length>0;this.data.combo||(we.size=this.data.options.length,this.data.multiSelect&&(we.multiple=!0)),we.addEventListener("resetform",W=>{const le=this.data.defaultFieldValue;for(const Z of we.options)Z.selected=Z.value===le});for(const W of this.data.options){const le=document.createElement("option");le.textContent=W.displayValue,le.value=W.exportValue,ve.value.includes(W.exportValue)&&(le.setAttribute("selected",!0),Fe=!1),we.append(le)}let He=null;if(Fe){const W=document.createElement("option");W.value=" ",W.setAttribute("hidden",!0),W.setAttribute("selected",!0),we.prepend(W),He=()=>{W.remove(),we.removeEventListener("input",He),He=null},we.addEventListener("input",He)}const Ue=W=>{const le=W?"value":"textContent",{options:Z,multiple:ie}=we;return ie?Array.prototype.filter.call(Z,de=>de.selected).map(de=>de[le]):Z.selectedIndex===-1?null:Z[Z.selectedIndex][le]};let at=Ue(!1);const it=W=>{const le=W.target.options;return Array.prototype.map.call(le,Z=>({displayValue:Z.textContent,exportValue:Z.value}))};return this.enableScripting&&this.hasJSActions?(we.addEventListener("updatefromsandbox",W=>{const le={value(Z){He==null||He();const ie=Z.detail.value,de=new Set(Array.isArray(ie)?ie:[ie]);for(const ue of we.options)ue.selected=de.has(ue.value);ne.setValue(se,{value:Ue(!0)}),at=Ue(!1)},multipleSelection(Z){we.multiple=!0},remove(Z){const ie=we.options,de=Z.detail.remove;ie[de].selected=!1,we.remove(de),ie.length>0&&Array.prototype.findIndex.call(ie,Pe=>Pe.selected)===-1&&(ie[0].selected=!0),ne.setValue(se,{value:Ue(!0),items:it(Z)}),at=Ue(!1)},clear(Z){for(;we.length!==0;)we.remove(0);ne.setValue(se,{value:null,items:[]}),at=Ue(!1)},insert(Z){const{index:ie,displayValue:de,exportValue:ue}=Z.detail.insert,Pe=we.children[ie],Be=document.createElement("option");Be.textContent=de,Be.value=ue,Pe?Pe.before(Be):we.append(Be),ne.setValue(se,{value:Ue(!0),items:it(Z)}),at=Ue(!1)},items(Z){const{items:ie}=Z.detail;for(;we.length!==0;)we.remove(0);for(const de of ie){const{displayValue:ue,exportValue:Pe}=de,Be=document.createElement("option");Be.textContent=ue,Be.value=Pe,we.append(Be)}we.options.length>0&&(we.options[0].selected=!0),ne.setValue(se,{value:Ue(!0),items:it(Z)}),at=Ue(!1)},indices(Z){const ie=new Set(Z.detail.indices);for(const de of Z.target.options)de.selected=ie.has(de.index);ne.setValue(se,{value:Ue(!0)}),at=Ue(!1)},editable(Z){Z.target.disabled=!Z.detail.editable}};this._dispatchEventFromSandbox(le,W)}),we.addEventListener("input",W=>{var Z;const le=Ue(!0);ne.setValue(se,{value:le}),W.preventDefault(),(Z=this.linkService.eventBus)==null||Z.dispatch("dispatcheventinsandbox",{source:this,detail:{id:se,name:"Keystroke",value:at,changeEx:le,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(we,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],W=>W.target.value)):we.addEventListener("input",function(W){ne.setValue(se,{value:Ue(!0)})}),this.data.combo&&this._setTextStyle(we),this._setBackgroundColor(we),this._setDefaultPropertiesFromJS(we),this.container.append(we),this.container}}class j extends E{constructor(ne){const{data:se,elements:ve}=ne;super(ne,{isRenderable:E._hasPopupData(se)}),this.elements=ve}render(){this.container.classList.add("popupAnnotation");const ne=new C({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),se=[];for(const ve of this.elements)ve.popup=ne,se.push(ve.data.id),ve.addHighlightArea();return this.container.setAttribute("aria-controls",se.map(ve=>`${s.AnnotationPrefix}${ve}`).join(",")),this.container}}class C{constructor(ne){Ie(this,Xe);Ie(this,G,null);Ie(this,fe,Ae(this,Xe,Fs).bind(this));Ie(this,xe,Ae(this,Xe,ts).bind(this));Ie(this,Se,Ae(this,Xe,es).bind(this));Ie(this,Ce,Ae(this,Xe,Sr).bind(this));Ie(this,Me,null);Ie(this,be,null);Ie(this,ae,null);Ie(this,J,null);Ie(this,oe,null);Ie(this,Q,null);Ie(this,ge,!1);Ie(this,Te,null);Ie(this,Le,null);Ie(this,Re,null);Ie(this,Ee,null);Ie(this,ze,!1);var de;let{container:se,color:ve,elements:we,titleObj:Fe,modificationDate:He,contentsObj:Ue,richText:at,parent:it,rect:W,parentRect:le,open:Z}=ne;ke(this,be,se),ke(this,Ee,Fe),ke(this,ae,Ue),ke(this,Re,at),ke(this,oe,it),ke(this,Me,ve),ke(this,Le,W),ke(this,Q,le),ke(this,J,we);const ie=a.PDFDateString.toDateObject(He);ie&&ke(this,G,it.l10n.get("annotation_date_string",{date:ie.toLocaleDateString(),time:ie.toLocaleTimeString()})),this.trigger=we.flatMap(ue=>ue.getElementsToTriggerPopup());for(const ue of this.trigger)ue.addEventListener("click",M(this,Ce)),ue.addEventListener("mouseenter",M(this,Se)),ue.addEventListener("mouseleave",M(this,xe)),ue.classList.add("popupTriggerArea");for(const ue of we)(de=ue.container)==null||de.addEventListener("keydown",M(this,fe));M(this,be).hidden=!0,Z&&Ae(this,Xe,Sr).call(this)}render(){if(M(this,Te))return;const{page:{view:ne},viewport:{rawDims:{pageWidth:se,pageHeight:ve,pageX:we,pageY:Fe}}}=M(this,oe),He=ke(this,Te,document.createElement("div"));if(He.className="popup",M(this,Me)){const Oe=He.style.outlineColor=s.Util.makeHexColor(...M(this,Me));CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?He.style.backgroundColor=`color-mix(in srgb, ${Oe} 30%, white)`:He.style.backgroundColor=s.Util.makeHexColor(...M(this,Me).map(Je=>Math.floor(.7*(255-Je)+Je)))}const Ue=document.createElement("span");Ue.className="header";const at=document.createElement("h1");if(Ue.append(at),{dir:at.dir,str:at.textContent}=M(this,Ee),He.append(Ue),M(this,G)){const Oe=document.createElement("span");Oe.classList.add("popupDate"),M(this,G).then(Ve=>{Oe.textContent=Ve}),Ue.append(Oe)}const it=M(this,ae),W=M(this,Re);if(W!=null&&W.str&&(!(it!=null&&it.str)||it.str===W.str))x.XfaLayer.render({xfaHtml:W.html,intent:"richText",div:He}),He.lastChild.classList.add("richText","popupContent");else{const Oe=this._formatContents(it);He.append(Oe)}let le=!!M(this,Q),Z=le?M(this,Q):M(this,Le);for(const Oe of M(this,J))if(!Z||s.Util.intersect(Oe.data.rect,Z)!==null){Z=Oe.data.rect,le=!0;break}const ie=s.Util.normalizeRect([Z[0],ne[3]-Z[1]+ne[1],Z[2],ne[3]-Z[3]+ne[1]]),ue=le?Z[2]-Z[0]+5:0,Pe=ie[0]+ue,Be=ie[1],{style:De}=M(this,be);De.left=`${100*(Pe-we)/se}%`,De.top=`${100*(Be-Fe)/ve}%`,M(this,be).append(He)}_formatContents(ne){let{str:se,dir:ve}=ne;const we=document.createElement("p");we.classList.add("popupContent"),we.dir=ve;const Fe=se.split(/(?:\r\n?|\n)/);for(let He=0,Ue=Fe.length;He<Ue;++He){const at=Fe[He];we.append(document.createTextNode(at)),He<Ue-1&&we.append(document.createElement("br"))}return we}forceHide(){ke(this,ze,this.isVisible),M(this,ze)&&(M(this,be).hidden=!0)}maybeShow(){M(this,ze)&&(ke(this,ze,!1),M(this,be).hidden=!1)}get isVisible(){return M(this,be).hidden===!1}}G=new WeakMap,fe=new WeakMap,xe=new WeakMap,Se=new WeakMap,Ce=new WeakMap,Me=new WeakMap,be=new WeakMap,ae=new WeakMap,J=new WeakMap,oe=new WeakMap,Q=new WeakMap,ge=new WeakMap,Te=new WeakMap,Le=new WeakMap,Re=new WeakMap,Ee=new WeakMap,ze=new WeakMap,Xe=new WeakSet,Fs=function(ne){ne.altKey||ne.shiftKey||ne.ctrlKey||ne.metaKey||(ne.key==="Enter"||ne.key==="Escape"&&M(this,ge))&&Ae(this,Xe,Sr).call(this)},Sr=function(){ke(this,ge,!M(this,ge)),M(this,ge)?(Ae(this,Xe,es).call(this),M(this,be).addEventListener("click",M(this,Ce)),M(this,be).addEventListener("keydown",M(this,fe))):(Ae(this,Xe,ts).call(this),M(this,be).removeEventListener("click",M(this,Ce)),M(this,be).removeEventListener("keydown",M(this,fe)))},es=function(){M(this,Te)||this.render(),this.isVisible?M(this,ge)&&M(this,be).classList.add("focused"):(M(this,be).hidden=!1,M(this,be).style.zIndex=parseInt(M(this,be).style.zIndex)+1e3)},ts=function(){M(this,be).classList.remove("focused"),!(M(this,ge)||!this.isVisible)&&(M(this,be).hidden=!0,M(this,be).style.zIndex=parseInt(M(this,be).style.zIndex)-1e3)};class V extends E{constructor(ne){super(ne,{isRenderable:!0,ignoreBorder:!0}),this.textContent=ne.data.textContent,this.textPosition=ne.data.textPosition,this.annotationEditorType=s.AnnotationEditorType.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const ne=document.createElement("div");ne.classList.add("annotationTextContent"),ne.setAttribute("role","comment");for(const se of this.textContent){const ve=document.createElement("span");ve.textContent=se,ne.append(ve)}this.container.append(ne)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}r.FreeTextAnnotationElement=V;class O extends E{constructor(se){super(se,{isRenderable:!0,ignoreBorder:!0});Ie(this,nt,null)}render(){this.container.classList.add("lineAnnotation");const se=this.data,{width:ve,height:we}=v(se.rect),Fe=this.svgFactory.create(ve,we,!0),He=ke(this,nt,this.svgFactory.createElement("svg:line"));return He.setAttribute("x1",se.rect[2]-se.lineCoordinates[0]),He.setAttribute("y1",se.rect[3]-se.lineCoordinates[1]),He.setAttribute("x2",se.rect[2]-se.lineCoordinates[2]),He.setAttribute("y2",se.rect[3]-se.lineCoordinates[3]),He.setAttribute("stroke-width",se.borderStyle.width||1),He.setAttribute("stroke","transparent"),He.setAttribute("fill","transparent"),Fe.append(He),this.container.append(Fe),!se.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return M(this,nt)}addHighlightArea(){this.container.classList.add("highlightArea")}}nt=new WeakMap;class H extends E{constructor(se){super(se,{isRenderable:!0,ignoreBorder:!0});Ie(this,ht,null)}render(){this.container.classList.add("squareAnnotation");const se=this.data,{width:ve,height:we}=v(se.rect),Fe=this.svgFactory.create(ve,we,!0),He=se.borderStyle.width,Ue=ke(this,ht,this.svgFactory.createElement("svg:rect"));return Ue.setAttribute("x",He/2),Ue.setAttribute("y",He/2),Ue.setAttribute("width",ve-He),Ue.setAttribute("height",we-He),Ue.setAttribute("stroke-width",He||1),Ue.setAttribute("stroke","transparent"),Ue.setAttribute("fill","transparent"),Fe.append(Ue),this.container.append(Fe),!se.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return M(this,ht)}addHighlightArea(){this.container.classList.add("highlightArea")}}ht=new WeakMap;class z extends E{constructor(se){super(se,{isRenderable:!0,ignoreBorder:!0});Ie(this,ft,null)}render(){this.container.classList.add("circleAnnotation");const se=this.data,{width:ve,height:we}=v(se.rect),Fe=this.svgFactory.create(ve,we,!0),He=se.borderStyle.width,Ue=ke(this,ft,this.svgFactory.createElement("svg:ellipse"));return Ue.setAttribute("cx",ve/2),Ue.setAttribute("cy",we/2),Ue.setAttribute("rx",ve/2-He/2),Ue.setAttribute("ry",we/2-He/2),Ue.setAttribute("stroke-width",He||1),Ue.setAttribute("stroke","transparent"),Ue.setAttribute("fill","transparent"),Fe.append(Ue),this.container.append(Fe),!se.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return M(this,ft)}addHighlightArea(){this.container.classList.add("highlightArea")}}ft=new WeakMap;class pe extends E{constructor(se){super(se,{isRenderable:!0,ignoreBorder:!0});Ie(this,pt,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const se=this.data,{width:ve,height:we}=v(se.rect),Fe=this.svgFactory.create(ve,we,!0);let He=[];for(const at of se.vertices){const it=at.x-se.rect[0],W=se.rect[3]-at.y;He.push(it+","+W)}He=He.join(" ");const Ue=ke(this,pt,this.svgFactory.createElement(this.svgElementName));return Ue.setAttribute("points",He),Ue.setAttribute("stroke-width",se.borderStyle.width||1),Ue.setAttribute("stroke","transparent"),Ue.setAttribute("fill","transparent"),Fe.append(Ue),this.container.append(Fe),!se.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return M(this,pt)}addHighlightArea(){this.container.classList.add("highlightArea")}}pt=new WeakMap;class ee extends pe{constructor(ne){super(ne),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class he extends E{constructor(ne){super(ne,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class re extends E{constructor(se){super(se,{isRenderable:!0,ignoreBorder:!0});Ie(this,Ge,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=s.AnnotationEditorType.INK}render(){this.container.classList.add(this.containerClassName);const se=this.data,{width:ve,height:we}=v(se.rect),Fe=this.svgFactory.create(ve,we,!0);for(const He of se.inkLists){let Ue=[];for(const it of He){const W=it.x-se.rect[0],le=se.rect[3]-it.y;Ue.push(`${W},${le}`)}Ue=Ue.join(" ");const at=this.svgFactory.createElement(this.svgElementName);M(this,Ge).push(at),at.setAttribute("points",Ue),at.setAttribute("stroke-width",se.borderStyle.width||1),at.setAttribute("stroke","transparent"),at.setAttribute("fill","transparent"),!se.popupRef&&this.hasPopupData&&this._createPopup(),Fe.append(at)}return this.container.append(Fe),this.container}getElementsToTriggerPopup(){return M(this,Ge)}addHighlightArea(){this.container.classList.add("highlightArea")}}Ge=new WeakMap,r.InkAnnotationElement=re;class me extends E{constructor(ne){super(ne,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this.container}}class te extends E{constructor(ne){super(ne,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class ce extends E{constructor(ne){super(ne,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class ye extends E{constructor(ne){super(ne,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class L extends E{constructor(ne){super(ne,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("stampAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}r.StampAnnotationElement=L;class N extends E{constructor(se){var Fe;super(se,{isRenderable:!0});Ie(this,je);Ie(this,Ne,null);const{filename:ve,content:we}=this.data.file;this.filename=(0,a.getFilenameFromUrl)(ve,!0),this.content=we,(Fe=this.linkService.eventBus)==null||Fe.dispatch("fileattachmentannotation",{source:this,filename:ve,content:we})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:se,data:ve}=this;let we;ve.hasAppearance||ve.fillAlpha===0?we=document.createElement("div"):(we=document.createElement("img"),we.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(ve.name)?"paperclip":"pushpin"}.svg`,ve.fillAlpha&&ve.fillAlpha<1&&(we.style=`filter: opacity(${Math.round(ve.fillAlpha*100)}%);`)),we.addEventListener("dblclick",Ae(this,je,rs).bind(this)),ke(this,Ne,we);const{isMac:Fe}=s.FeatureTest.platform;return se.addEventListener("keydown",He=>{He.key==="Enter"&&(Fe?He.metaKey:He.ctrlKey)&&Ae(this,je,rs).call(this)}),!ve.popupRef&&this.hasPopupData?this._createPopup():we.classList.add("popupTriggerArea"),se.append(we),se}getElementsToTriggerPopup(){return M(this,Ne)}addHighlightArea(){this.container.classList.add("highlightArea")}}Ne=new WeakMap,je=new WeakSet,rs=function(){var se;(se=this.downloadManager)==null||se.openOrDownloadData(this.container,this.content,this.filename)};class T{constructor(ne){Ie(this,We);Ie(this,ct,null);Ie(this,K,null);Ie(this,_e,new Map);let{div:se,accessibilityManager:ve,annotationCanvasMap:we,l10n:Fe,page:He,viewport:Ue}=ne;this.div=se,ke(this,ct,ve),ke(this,K,we),this.l10n=Fe,this.page=He,this.viewport=Ue,this.zIndex=0,this.l10n||(this.l10n=c.NullL10n)}async render(ne){const{annotations:se}=ne,ve=this.div;(0,a.setLayerDimensions)(ve,this.viewport);const we=new Map,Fe={data:null,layer:ve,linkService:ne.linkService,downloadManager:ne.downloadManager,imageResourcesPath:ne.imageResourcesPath||"",renderForms:ne.renderForms!==!1,svgFactory:new a.DOMSVGFactory,annotationStorage:ne.annotationStorage||new i.AnnotationStorage,enableScripting:ne.enableScripting===!0,hasJSActions:ne.hasJSActions,fieldObjects:ne.fieldObjects,parent:this,elements:null};for(const He of se){if(He.noHTML)continue;const Ue=He.annotationType===s.AnnotationType.POPUP;if(Ue){const W=we.get(He.id);if(!W)continue;Fe.elements=W}else{const{width:W,height:le}=v(He.rect);if(W<=0||le<=0)continue}Fe.data=He;const at=b.create(Fe);if(!at.isRenderable)continue;if(!Ue&&He.popupRef){const W=we.get(He.popupRef);W?W.push(at):we.set(He.popupRef,[at])}at.annotationEditorType>0&&M(this,_e).set(at.data.id,at);const it=at.render();He.hidden&&(it.style.visibility="hidden"),Ae(this,We,Is).call(this,it,He.id)}Ae(this,We,ss).call(this),await this.l10n.translate(ve)}update(ne){let{viewport:se}=ne;const ve=this.div;this.viewport=se,(0,a.setLayerDimensions)(ve,{rotation:se.rotation}),Ae(this,We,ss).call(this),ve.hidden=!1}getEditableAnnotations(){return Array.from(M(this,_e).values())}getEditableAnnotation(ne){return M(this,_e).get(ne)}}ct=new WeakMap,K=new WeakMap,_e=new WeakMap,We=new WeakSet,Is=function(ne,se){var we;const ve=ne.firstChild||ne;ve.id=`${s.AnnotationPrefix}${se}`,this.div.append(ne),(we=M(this,ct))==null||we.moveElementInDOM(this.div,ne,ve,!1)},ss=function(){if(!M(this,K))return;const ne=this.div;for(const[se,ve]of M(this,K)){const we=ne.querySelector(`[data-annotation-id="${se}"]`);if(!we)continue;const{firstChild:Fe}=we;Fe?Fe.nodeName==="CANVAS"?Fe.replaceWith(ve):Fe.before(ve):we.append(ve)}M(this,K).clear()},r.AnnotationLayer=T},(t,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.ColorConverters=void 0;function e(i){return Math.floor(Math.max(0,Math.min(1,i))*255).toString(16).padStart(2,"0")}function s(i){return Math.max(0,Math.min(255,255*i))}class a{static CMYK_G(o){let[c,x,u,h]=o;return["G",1-Math.min(1,.3*c+.59*u+.11*x+h)]}static G_CMYK(o){let[c]=o;return["CMYK",0,0,0,1-c]}static G_RGB(o){let[c]=o;return["RGB",c,c,c]}static G_rgb(o){let[c]=o;return c=s(c),[c,c,c]}static G_HTML(o){let[c]=o;const x=e(c);return`#${x}${x}${x}`}static RGB_G(o){let[c,x,u]=o;return["G",.3*c+.59*x+.11*u]}static RGB_rgb(o){return o.map(s)}static RGB_HTML(o){return`#${o.map(e).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB(o){let[c,x,u,h]=o;return["RGB",1-Math.min(1,c+h),1-Math.min(1,u+h),1-Math.min(1,x+h)]}static CMYK_rgb(o){let[c,x,u,h]=o;return[s(1-Math.min(1,c+h)),s(1-Math.min(1,u+h)),s(1-Math.min(1,x+h))]}static CMYK_HTML(o){const c=this.CMYK_RGB(o).slice(1);return this.RGB_HTML(c)}static RGB_CMYK(o){let[c,x,u]=o;const h=1-c,_=1-x,v=1-u,b=Math.min(h,_,v);return["CMYK",h,_,v,b]}}r.ColorConverters=a},(t,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.NullL10n=void 0,r.getL10nFallback=s;const e={of_pages:"of {{pagesCount}}",page_of_pages:"({{pageNumber}} of {{pagesCount}})",document_properties_kb:"{{size_kb}} KB ({{size_b}} bytes)",document_properties_mb:"{{size_mb}} MB ({{size_b}} bytes)",document_properties_date_string:"{{date}}, {{time}}",document_properties_page_size_unit_inches:"in",document_properties_page_size_unit_millimeters:"mm",document_properties_page_size_orientation_portrait:"portrait",document_properties_page_size_orientation_landscape:"landscape",document_properties_page_size_name_a3:"A3",document_properties_page_size_name_a4:"A4",document_properties_page_size_name_letter:"Letter",document_properties_page_size_name_legal:"Legal",document_properties_page_size_dimension_string:"{{width}} × {{height}} {{unit}} ({{orientation}})",document_properties_page_size_dimension_name_string:"{{width}} × {{height}} {{unit}} ({{name}}, {{orientation}})",document_properties_linearized_yes:"Yes",document_properties_linearized_no:"No",additional_layers:"Additional Layers",page_landmark:"Page {{page}}",thumb_page_title:"Page {{page}}",thumb_page_canvas:"Thumbnail of Page {{page}}",find_reached_top:"Reached top of document, continued from bottom",find_reached_bottom:"Reached end of document, continued from top","find_match_count[one]":"{{current}} of {{total}} match","find_match_count[other]":"{{current}} of {{total}} matches","find_match_count_limit[one]":"More than {{limit}} match","find_match_count_limit[other]":"More than {{limit}} matches",find_not_found:"Phrase not found",page_scale_width:"Page Width",page_scale_fit:"Page Fit",page_scale_auto:"Automatic Zoom",page_scale_actual:"Actual Size",page_scale_percent:"{{scale}}%",loading_error:"An error occurred while loading the PDF.",invalid_file_error:"Invalid or corrupted PDF file.",missing_file_error:"Missing PDF file.",unexpected_response_error:"Unexpected server response.",rendering_error:"An error occurred while rendering the page.",annotation_date_string:"{{date}}, {{time}}",printing_not_supported:"Warning: Printing is not fully supported by this browser.",printing_not_ready:"Warning: The PDF is not fully loaded for printing.",web_fonts_disabled:"Web fonts are disabled: unable to use embedded PDF fonts.",free_text2_default_content:"Start typing…",editor_free_text2_aria_label:"Text Editor",editor_ink2_aria_label:"Draw Editor",editor_ink_canvas_aria_label:"User-created image",editor_alt_text_button_label:"Alt text",editor_alt_text_edit_button_label:"Edit alt text",editor_alt_text_decorative_tooltip:"Marked as decorative"};e.print_progress_percent="{{progress}}%";function s(o,c){switch(o){case"find_match_count":o=`find_match_count[${c.total===1?"one":"other"}]`;break;case"find_match_count_limit":o=`find_match_count_limit[${c.limit===1?"one":"other"}]`;break}return e[o]||""}function a(o,c){return c?o.replaceAll(/\{\{\s*(\w+)\s*\}\}/g,(x,u)=>u in c?c[u]:"{{"+u+"}}"):o}const i={async getLanguage(){return"en-us"},async getDirection(){return"ltr"},async get(o){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:s(o,c);return a(x,c)},async translate(o){}};r.NullL10n=i},(t,r,e)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.XfaLayer=void 0,e(89);var s=e(194);class a{static setupStorage(o,c,x,u,h){const _=u.getValue(c,{value:null});switch(x.name){case"textarea":if(_.value!==null&&(o.textContent=_.value),h==="print")break;o.addEventListener("input",v=>{u.setValue(c,{value:v.target.value})});break;case"input":if(x.attributes.type==="radio"||x.attributes.type==="checkbox"){if(_.value===x.attributes.xfaOn?o.setAttribute("checked",!0):_.value===x.attributes.xfaOff&&o.removeAttribute("checked"),h==="print")break;o.addEventListener("change",v=>{u.setValue(c,{value:v.target.checked?v.target.getAttribute("xfaOn"):v.target.getAttribute("xfaOff")})})}else{if(_.value!==null&&o.setAttribute("value",_.value),h==="print")break;o.addEventListener("input",v=>{u.setValue(c,{value:v.target.value})})}break;case"select":if(_.value!==null){o.setAttribute("value",_.value);for(const v of x.children)v.attributes.value===_.value?v.attributes.selected=!0:v.attributes.hasOwnProperty("selected")&&delete v.attributes.selected}o.addEventListener("input",v=>{const b=v.target.options,E=b.selectedIndex===-1?"":b[b.selectedIndex].value;u.setValue(c,{value:E})});break}}static setAttributes(o){let{html:c,element:x,storage:u=null,intent:h,linkService:_}=o;const{attributes:v}=x,b=c instanceof HTMLAnchorElement;v.type==="radio"&&(v.name=`${v.name}-${h}`);for(const[E,d]of Object.entries(v))if(d!=null)switch(E){case"class":d.length&&c.setAttribute(E,d.join(" "));break;case"dataId":break;case"id":c.setAttribute("data-element-id",d);break;case"style":Object.assign(c.style,d);break;case"textContent":c.textContent=d;break;default:(!b||E!=="href"&&E!=="newWindow")&&c.setAttribute(E,d)}b&&_.addLinkAttributes(c,v.href,v.newWindow),u&&v.dataId&&this.setupStorage(c,v.dataId,x,u)}static render(o){var d;const c=o.annotationStorage,x=o.linkService,u=o.xfaHtml,h=o.intent||"display",_=document.createElement(u.name);u.attributes&&this.setAttributes({html:_,element:u,intent:h,linkService:x});const v=[[u,-1,_]],b=o.div;if(b.append(_),o.viewport){const g=`matrix(${o.viewport.transform.join(",")})`;b.style.transform=g}h!=="richText"&&b.setAttribute("class","xfaLayer xfaFont");const E=[];for(;v.length>0;){const[g,y,R]=v.at(-1);if(y+1===g.children.length){v.pop();continue}const P=g.children[++v.at(-1)[1]];if(P===null)continue;const{name:F}=P;if(F==="#text"){const I=document.createTextNode(P.value);E.push(I),R.append(I);continue}const S=(d=P==null?void 0:P.attributes)!=null&&d.xmlns?document.createElementNS(P.attributes.xmlns,F):document.createElement(F);if(R.append(S),P.attributes&&this.setAttributes({html:S,element:P,storage:c,intent:h,linkService:x}),P.children&&P.children.length>0)v.push([P,-1,S]);else if(P.value){const I=document.createTextNode(P.value);s.XfaText.shouldBuildText(F)&&E.push(I),S.append(I)}}for(const g of b.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))g.setAttribute("readOnly",!0);return{textDivs:E}}static update(o){const c=`matrix(${o.viewport.transform.join(",")})`;o.div.style.transform=c,o.div.hidden=!1}}r.XfaLayer=a},(t,r,e)=>{var u,h,_,v,b,E,d,g,y,R,P,F,S,I,w,ks,Os,Ms,Ds,ns,Ls,as,Bs,Us,Ws,Hs,Vs,$t,is,Ar,Rr,nr,os,Tr,B,zs,ls,$s,Gs,cs,Cr,ar;Object.defineProperty(r,"__esModule",{value:!0}),r.InkEditor=void 0,e(89),e(2);var s=e(1),a=e(164),i=e(198),o=e(168),c=e(165);const Me=class Me extends a.AnnotationEditor{constructor(J){super({...J,name:"inkEditor"});Ie(this,w);Ie(this,u,0);Ie(this,h,0);Ie(this,_,this.canvasPointermove.bind(this));Ie(this,v,this.canvasPointerleave.bind(this));Ie(this,b,this.canvasPointerup.bind(this));Ie(this,E,this.canvasPointerdown.bind(this));Ie(this,d,new Path2D);Ie(this,g,!1);Ie(this,y,!1);Ie(this,R,!1);Ie(this,P,null);Ie(this,F,0);Ie(this,S,0);Ie(this,I,null);this.color=J.color||null,this.thickness=J.thickness||null,this.opacity=J.opacity||null,this.paths=[],this.bezierPath2D=[],this.allRawPaths=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0,this._willKeepAspectRatio=!0}static initialize(J){a.AnnotationEditor.initialize(J,{strings:["editor_ink_canvas_aria_label","editor_ink2_aria_label"]})}static updateDefaultParams(J,oe){switch(J){case s.AnnotationEditorParamsType.INK_THICKNESS:Me._defaultThickness=oe;break;case s.AnnotationEditorParamsType.INK_COLOR:Me._defaultColor=oe;break;case s.AnnotationEditorParamsType.INK_OPACITY:Me._defaultOpacity=oe/100;break}}updateParams(J,oe){switch(J){case s.AnnotationEditorParamsType.INK_THICKNESS:Ae(this,w,ks).call(this,oe);break;case s.AnnotationEditorParamsType.INK_COLOR:Ae(this,w,Os).call(this,oe);break;case s.AnnotationEditorParamsType.INK_OPACITY:Ae(this,w,Ms).call(this,oe);break}}static get defaultPropertiesToUpdate(){return[[s.AnnotationEditorParamsType.INK_THICKNESS,Me._defaultThickness],[s.AnnotationEditorParamsType.INK_COLOR,Me._defaultColor||a.AnnotationEditor._defaultLineColor],[s.AnnotationEditorParamsType.INK_OPACITY,Math.round(Me._defaultOpacity*100)]]}get propertiesToUpdate(){return[[s.AnnotationEditorParamsType.INK_THICKNESS,this.thickness||Me._defaultThickness],[s.AnnotationEditorParamsType.INK_COLOR,this.color||Me._defaultColor||a.AnnotationEditor._defaultLineColor],[s.AnnotationEditorParamsType.INK_OPACITY,Math.round(100*(this.opacity??Me._defaultOpacity))]]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.canvas||(Ae(this,w,Ar).call(this),Ae(this,w,Rr).call(this)),this.isAttachedToDOM||(this.parent.add(this),Ae(this,w,nr).call(this)),Ae(this,w,ar).call(this)))}remove(){this.canvas!==null&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,M(this,P).disconnect(),ke(this,P,null),super.remove())}setParent(J){!this.parent&&J?this._uiManager.removeShouldRescale(this):this.parent&&J===null&&this._uiManager.addShouldRescale(this),super.setParent(J)}onScaleChanging(){const[J,oe]=this.parentDimensions,Q=this.width*J,ge=this.height*oe;this.setDimensions(Q,ge)}enableEditMode(){M(this,g)||this.canvas===null||(super.enableEditMode(),this._isDraggable=!1,this.canvas.addEventListener("pointerdown",M(this,E)))}disableEditMode(){!this.isInEditMode()||this.canvas===null||(super.disableEditMode(),this._isDraggable=!this.isEmpty(),this.div.classList.remove("editing"),this.canvas.removeEventListener("pointerdown",M(this,E)))}onceAdded(){this._isDraggable=!this.isEmpty()}isEmpty(){return this.paths.length===0||this.paths.length===1&&this.paths[0].length===0}commit(){M(this,g)||(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),ke(this,g,!0),this.div.classList.add("disabled"),Ae(this,w,ar).call(this,!0),this.makeResizable(),this.parent.addInkEditorIfNeeded(!0),this.moveInDOM(),this.div.focus({preventScroll:!0}))}focusin(J){this._focusEventsAllowed&&(super.focusin(J),this.enableEditMode())}canvasPointerdown(J){J.button!==0||!this.isInEditMode()||M(this,g)||(this.setInForeground(),J.preventDefault(),J.type!=="mouse"&&this.div.focus(),Ae(this,w,Ls).call(this,J.offsetX,J.offsetY))}canvasPointermove(J){J.preventDefault(),Ae(this,w,as).call(this,J.offsetX,J.offsetY)}canvasPointerup(J){J.preventDefault(),Ae(this,w,is).call(this,J)}canvasPointerleave(J){Ae(this,w,is).call(this,J)}get isResizable(){return!this.isEmpty()&&M(this,g)}render(){if(this.div)return this.div;let J,oe;this.width&&(J=this.x,oe=this.y),super.render(),a.AnnotationEditor._l10nPromise.get("editor_ink2_aria_label").then(Re=>{var Ee;return(Ee=this.div)==null?void 0:Ee.setAttribute("aria-label",Re)});const[Q,ge,Te,Le]=Ae(this,w,Ds).call(this);if(this.setAt(Q,ge,0,0),this.setDims(Te,Le),Ae(this,w,Ar).call(this),this.width){const[Re,Ee]=this.parentDimensions;this.setAspectRatio(this.width*Re,this.height*Ee),this.setAt(J*Re,oe*Ee,this.width*Re,this.height*Ee),ke(this,R,!0),Ae(this,w,nr).call(this),this.setDims(this.width*Re,this.height*Ee),Ae(this,w,$t).call(this),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return Ae(this,w,Rr).call(this),this.div}setDimensions(J,oe){const Q=Math.round(J),ge=Math.round(oe);if(M(this,F)===Q&&M(this,S)===ge)return;ke(this,F,Q),ke(this,S,ge),this.canvas.style.visibility="hidden";const[Te,Le]=this.parentDimensions;this.width=J/Te,this.height=oe/Le,this.fixAndSetPosition(),M(this,g)&&Ae(this,w,os).call(this,J,oe),Ae(this,w,nr).call(this),Ae(this,w,$t).call(this),this.canvas.style.visibility="visible",this.fixDims()}static deserialize(J,oe,Q){var nt,ht,ft;if(J instanceof i.InkAnnotationElement)return null;const ge=super.deserialize(J,oe,Q);ge.thickness=J.thickness,ge.color=s.Util.makeHexColor(...J.color),ge.opacity=J.opacity;const[Te,Le]=ge.pageDimensions,Re=ge.width*Te,Ee=ge.height*Le,ze=ge.parentScale,Xe=J.thickness/2;ke(ge,g,!0),ke(ge,F,Math.round(Re)),ke(ge,S,Math.round(Ee));const{paths:tt,rect:qe,rotation:dt}=J;for(let{bezier:pt}of tt){pt=Ae(nt=Me,B,$s).call(nt,pt,qe,dt);const Ge=[];ge.paths.push(Ge);let Ne=ze*(pt[0]-Xe),je=ze*(pt[1]-Xe);for(let ct=2,K=pt.length;ct<K;ct+=6){const _e=ze*(pt[ct]-Xe),We=ze*(pt[ct+1]-Xe),Ke=ze*(pt[ct+2]-Xe),Ye=ze*(pt[ct+3]-Xe),$e=ze*(pt[ct+4]-Xe),ne=ze*(pt[ct+5]-Xe);Ge.push([[Ne,je],[_e,We],[Ke,Ye],[$e,ne]]),Ne=$e,je=ne}const st=Ae(this,B,zs).call(this,Ge);ge.bezierPath2D.push(st)}const Ze=Ae(ht=ge,w,cs).call(ht);return ke(ge,h,Math.max(a.AnnotationEditor.MIN_SIZE,Ze[2]-Ze[0])),ke(ge,u,Math.max(a.AnnotationEditor.MIN_SIZE,Ze[3]-Ze[1])),Ae(ft=ge,w,os).call(ft,Re,Ee),ge}serialize(){if(this.isEmpty())return null;const J=this.getRect(0,0),oe=a.AnnotationEditor._colorManager.convert(this.ctx.strokeStyle);return{annotationType:s.AnnotationEditorType.INK,color:oe,thickness:this.thickness,opacity:this.opacity,paths:Ae(this,w,Gs).call(this,this.scaleFactor/this.parentScale,this.translationX,this.translationY,J),pageIndex:this.pageIndex,rect:J,rotation:this.rotation,structTreeParentId:this._structTreeParentId}}};u=new WeakMap,h=new WeakMap,_=new WeakMap,v=new WeakMap,b=new WeakMap,E=new WeakMap,d=new WeakMap,g=new WeakMap,y=new WeakMap,R=new WeakMap,P=new WeakMap,F=new WeakMap,S=new WeakMap,I=new WeakMap,w=new WeakSet,ks=function(J){const oe=this.thickness;this.addCommands({cmd:()=>{this.thickness=J,Ae(this,w,ar).call(this)},undo:()=>{this.thickness=oe,Ae(this,w,ar).call(this)},mustExec:!0,type:s.AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})},Os=function(J){const oe=this.color;this.addCommands({cmd:()=>{this.color=J,Ae(this,w,$t).call(this)},undo:()=>{this.color=oe,Ae(this,w,$t).call(this)},mustExec:!0,type:s.AnnotationEditorParamsType.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})},Ms=function(J){J/=100;const oe=this.opacity;this.addCommands({cmd:()=>{this.opacity=J,Ae(this,w,$t).call(this)},undo:()=>{this.opacity=oe,Ae(this,w,$t).call(this)},mustExec:!0,type:s.AnnotationEditorParamsType.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})},Ds=function(){const{parentRotation:J,parentDimensions:[oe,Q]}=this;switch(J){case 90:return[0,Q,Q,oe];case 180:return[oe,Q,oe,Q];case 270:return[oe,0,Q,oe];default:return[0,0,oe,Q]}},ns=function(){const{ctx:J,color:oe,opacity:Q,thickness:ge,parentScale:Te,scaleFactor:Le}=this;J.lineWidth=ge*Te/Le,J.lineCap="round",J.lineJoin="round",J.miterLimit=10,J.strokeStyle=`${oe}${(0,c.opacityToHex)(Q)}`},Ls=function(J,oe){this.canvas.addEventListener("contextmenu",o.noContextMenu),this.canvas.addEventListener("pointerleave",M(this,v)),this.canvas.addEventListener("pointermove",M(this,_)),this.canvas.addEventListener("pointerup",M(this,b)),this.canvas.removeEventListener("pointerdown",M(this,E)),this.isEditing=!0,M(this,R)||(ke(this,R,!0),Ae(this,w,nr).call(this),this.thickness||(this.thickness=Me._defaultThickness),this.color||(this.color=Me._defaultColor||a.AnnotationEditor._defaultLineColor),this.opacity??(this.opacity=Me._defaultOpacity)),this.currentPath.push([J,oe]),ke(this,y,!1),Ae(this,w,ns).call(this),ke(this,I,()=>{Ae(this,w,Ws).call(this),M(this,I)&&window.requestAnimationFrame(M(this,I))}),window.requestAnimationFrame(M(this,I))},as=function(J,oe){const[Q,ge]=this.currentPath.at(-1);if(this.currentPath.length>1&&J===Q&&oe===ge)return;const Te=this.currentPath;let Le=M(this,d);if(Te.push([J,oe]),ke(this,y,!0),Te.length<=2){Le.moveTo(...Te[0]),Le.lineTo(J,oe);return}Te.length===3&&(ke(this,d,Le=new Path2D),Le.moveTo(...Te[0])),Ae(this,w,Hs).call(this,Le,...Te.at(-3),...Te.at(-2),J,oe)},Bs=function(){if(this.currentPath.length===0)return;const J=this.currentPath.at(-1);M(this,d).lineTo(...J)},Us=function(J,oe){ke(this,I,null),J=Math.min(Math.max(J,0),this.canvas.width),oe=Math.min(Math.max(oe,0),this.canvas.height),Ae(this,w,as).call(this,J,oe),Ae(this,w,Bs).call(this);let Q;if(this.currentPath.length!==1)Q=Ae(this,w,Vs).call(this);else{const Ee=[J,oe];Q=[[Ee,Ee.slice(),Ee.slice(),Ee]]}const ge=M(this,d),Te=this.currentPath;this.currentPath=[],ke(this,d,new Path2D);const Le=()=>{this.allRawPaths.push(Te),this.paths.push(Q),this.bezierPath2D.push(ge),this.rebuild()},Re=()=>{this.allRawPaths.pop(),this.paths.pop(),this.bezierPath2D.pop(),this.paths.length===0?this.remove():(this.canvas||(Ae(this,w,Ar).call(this),Ae(this,w,Rr).call(this)),Ae(this,w,ar).call(this))};this.addCommands({cmd:Le,undo:Re,mustExec:!0})},Ws=function(){if(!M(this,y))return;ke(this,y,!1);const J=Math.ceil(this.thickness*this.parentScale),oe=this.currentPath.slice(-3),Q=oe.map(Le=>Le[0]),ge=oe.map(Le=>Le[1]);Math.min(...Q)-J,Math.max(...Q)+J,Math.min(...ge)-J,Math.max(...ge)+J;const{ctx:Te}=this;Te.save(),Te.clearRect(0,0,this.canvas.width,this.canvas.height);for(const Le of this.bezierPath2D)Te.stroke(Le);Te.stroke(M(this,d)),Te.restore()},Hs=function(J,oe,Q,ge,Te,Le,Re){const Ee=(oe+ge)/2,ze=(Q+Te)/2,Xe=(ge+Le)/2,tt=(Te+Re)/2;J.bezierCurveTo(Ee+2*(ge-Ee)/3,ze+2*(Te-ze)/3,Xe+2*(ge-Xe)/3,tt+2*(Te-tt)/3,Xe,tt)},Vs=function(){const J=this.currentPath;if(J.length<=2)return[[J[0],J[0],J.at(-1),J.at(-1)]];const oe=[];let Q,[ge,Te]=J[0];for(Q=1;Q<J.length-2;Q++){const[qe,dt]=J[Q],[Ze,nt]=J[Q+1],ht=(qe+Ze)/2,ft=(dt+nt)/2,pt=[ge+2*(qe-ge)/3,Te+2*(dt-Te)/3],Ge=[ht+2*(qe-ht)/3,ft+2*(dt-ft)/3];oe.push([[ge,Te],pt,Ge,[ht,ft]]),[ge,Te]=[ht,ft]}const[Le,Re]=J[Q],[Ee,ze]=J[Q+1],Xe=[ge+2*(Le-ge)/3,Te+2*(Re-Te)/3],tt=[Ee+2*(Le-Ee)/3,ze+2*(Re-ze)/3];return oe.push([[ge,Te],Xe,tt,[Ee,ze]]),oe},$t=function(){if(this.isEmpty()){Ae(this,w,Tr).call(this);return}Ae(this,w,ns).call(this);const{canvas:J,ctx:oe}=this;oe.setTransform(1,0,0,1,0,0),oe.clearRect(0,0,J.width,J.height),Ae(this,w,Tr).call(this);for(const Q of this.bezierPath2D)oe.stroke(Q)},is=function(J){this.canvas.removeEventListener("pointerleave",M(this,v)),this.canvas.removeEventListener("pointermove",M(this,_)),this.canvas.removeEventListener("pointerup",M(this,b)),this.canvas.addEventListener("pointerdown",M(this,E)),setTimeout(()=>{this.canvas.removeEventListener("contextmenu",o.noContextMenu)},10),Ae(this,w,Us).call(this,J.offsetX,J.offsetY),this.addToAnnotationStorage(),this.setInBackground()},Ar=function(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",a.AnnotationEditor._l10nPromise.get("editor_ink_canvas_aria_label").then(J=>{var oe;return(oe=this.canvas)==null?void 0:oe.setAttribute("aria-label",J)}),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")},Rr=function(){ke(this,P,new ResizeObserver(J=>{const oe=J[0].contentRect;oe.width&&oe.height&&this.setDimensions(oe.width,oe.height)})),M(this,P).observe(this.div)},nr=function(){if(!M(this,R))return;const[J,oe]=this.parentDimensions;this.canvas.width=Math.ceil(this.width*J),this.canvas.height=Math.ceil(this.height*oe),Ae(this,w,Tr).call(this)},os=function(J,oe){const Q=Ae(this,w,Cr).call(this),ge=(J-Q)/M(this,h),Te=(oe-Q)/M(this,u);this.scaleFactor=Math.min(ge,Te)},Tr=function(){const J=Ae(this,w,Cr).call(this)/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+J,this.translationY*this.scaleFactor+J)},B=new WeakSet,zs=function(J){const oe=new Path2D;for(let Q=0,ge=J.length;Q<ge;Q++){const[Te,Le,Re,Ee]=J[Q];Q===0&&oe.moveTo(...Te),oe.bezierCurveTo(Le[0],Le[1],Re[0],Re[1],Ee[0],Ee[1])}return oe},ls=function(J,oe,Q){const[ge,Te,Le,Re]=oe;switch(Q){case 0:for(let Ee=0,ze=J.length;Ee<ze;Ee+=2)J[Ee]+=ge,J[Ee+1]=Re-J[Ee+1];break;case 90:for(let Ee=0,ze=J.length;Ee<ze;Ee+=2){const Xe=J[Ee];J[Ee]=J[Ee+1]+ge,J[Ee+1]=Xe+Te}break;case 180:for(let Ee=0,ze=J.length;Ee<ze;Ee+=2)J[Ee]=Le-J[Ee],J[Ee+1]+=Te;break;case 270:for(let Ee=0,ze=J.length;Ee<ze;Ee+=2){const Xe=J[Ee];J[Ee]=Le-J[Ee+1],J[Ee+1]=Re-Xe}break;default:throw new Error("Invalid rotation")}return J},$s=function(J,oe,Q){const[ge,Te,Le,Re]=oe;switch(Q){case 0:for(let Ee=0,ze=J.length;Ee<ze;Ee+=2)J[Ee]-=ge,J[Ee+1]=Re-J[Ee+1];break;case 90:for(let Ee=0,ze=J.length;Ee<ze;Ee+=2){const Xe=J[Ee];J[Ee]=J[Ee+1]-Te,J[Ee+1]=Xe-ge}break;case 180:for(let Ee=0,ze=J.length;Ee<ze;Ee+=2)J[Ee]=Le-J[Ee],J[Ee+1]-=Te;break;case 270:for(let Ee=0,ze=J.length;Ee<ze;Ee+=2){const Xe=J[Ee];J[Ee]=Re-J[Ee+1],J[Ee+1]=Le-Xe}break;default:throw new Error("Invalid rotation")}return J},Gs=function(J,oe,Q,ge){var ze,Xe;const Te=[],Le=this.thickness/2,Re=J*oe+Le,Ee=J*Q+Le;for(const tt of this.paths){const qe=[],dt=[];for(let Ze=0,nt=tt.length;Ze<nt;Ze++){const[ht,ft,pt,Ge]=tt[Ze],Ne=J*ht[0]+Re,je=J*ht[1]+Ee,st=J*ft[0]+Re,ct=J*ft[1]+Ee,K=J*pt[0]+Re,_e=J*pt[1]+Ee,We=J*Ge[0]+Re,Ke=J*Ge[1]+Ee;Ze===0&&(qe.push(Ne,je),dt.push(Ne,je)),qe.push(st,ct,K,_e,We,Ke),dt.push(st,ct),Ze===nt-1&&dt.push(We,Ke)}Te.push({bezier:Ae(ze=Me,B,ls).call(ze,qe,ge,this.rotation),points:Ae(Xe=Me,B,ls).call(Xe,dt,ge,this.rotation)})}return Te},cs=function(){let J=1/0,oe=-1/0,Q=1/0,ge=-1/0;for(const Te of this.paths)for(const[Le,Re,Ee,ze]of Te){const Xe=s.Util.bezierBoundingBox(...Le,...Re,...Ee,...ze);J=Math.min(J,Xe[0]),Q=Math.min(Q,Xe[1]),oe=Math.max(oe,Xe[2]),ge=Math.max(ge,Xe[3])}return[J,Q,oe,ge]},Cr=function(){return M(this,g)?Math.ceil(this.thickness*this.parentScale):0},ar=function(){let J=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(this.isEmpty())return;if(!M(this,g)){Ae(this,w,$t).call(this);return}const oe=Ae(this,w,cs).call(this),Q=Ae(this,w,Cr).call(this);ke(this,h,Math.max(a.AnnotationEditor.MIN_SIZE,oe[2]-oe[0])),ke(this,u,Math.max(a.AnnotationEditor.MIN_SIZE,oe[3]-oe[1]));const ge=Math.ceil(Q+M(this,h)*this.scaleFactor),Te=Math.ceil(Q+M(this,u)*this.scaleFactor),[Le,Re]=this.parentDimensions;this.width=ge/Le,this.height=Te/Re,this.setAspectRatio(ge,Te);const Ee=this.translationX,ze=this.translationY;this.translationX=-oe[0],this.translationY=-oe[1],Ae(this,w,nr).call(this),Ae(this,w,$t).call(this),ke(this,F,ge),ke(this,S,Te),this.setDims(ge,Te);const Xe=J?Q/this.scaleFactor/2:0;this.translate(Ee-this.translationX-Xe,ze-this.translationY-Xe)},Ie(Me,B),wt(Me,"_defaultColor",null),wt(Me,"_defaultOpacity",1),wt(Me,"_defaultThickness",1),wt(Me,"_type","ink");let x=Me;r.InkEditor=x},(t,r,e)=>{var x,u,h,_,v,b,E,d,g,y,R,pr,mr,Nr,us,Xs,Ks,ds,Pr,Ys;Object.defineProperty(r,"__esModule",{value:!0}),r.StampEditor=void 0,e(149),e(152);var s=e(1),a=e(164),i=e(168),o=e(198);const H=class H extends a.AnnotationEditor{constructor(ee){super({...ee,name:"stampEditor"});Ie(this,R);Ie(this,x,null);Ie(this,u,null);Ie(this,h,null);Ie(this,_,null);Ie(this,v,null);Ie(this,b,null);Ie(this,E,null);Ie(this,d,null);Ie(this,g,!1);Ie(this,y,!1);ke(this,_,ee.bitmapUrl),ke(this,v,ee.bitmapFile)}static initialize(ee){a.AnnotationEditor.initialize(ee)}static get supportedTypes(){const ee=["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"];return(0,s.shadow)(this,"supportedTypes",ee.map(he=>`image/${he}`))}static get supportedTypesStr(){return(0,s.shadow)(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(ee){return this.supportedTypes.includes(ee)}static paste(ee,he){he.pasteEditor(s.AnnotationEditorType.STAMP,{bitmapFile:ee.getAsFile()})}remove(){var ee,he;M(this,u)&&(ke(this,x,null),this._uiManager.imageManager.deleteId(M(this,u)),(ee=M(this,b))==null||ee.remove(),ke(this,b,null),(he=M(this,E))==null||he.disconnect(),ke(this,E,null)),super.remove()}rebuild(){if(!this.parent){M(this,u)&&Ae(this,R,Nr).call(this);return}super.rebuild(),this.div!==null&&(M(this,u)&&Ae(this,R,Nr).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(){this._isDraggable=!0,this.div.focus()}isEmpty(){return!(M(this,h)||M(this,x)||M(this,_)||M(this,v))}get isResizable(){return!0}render(){if(this.div)return this.div;let ee,he;if(this.width&&(ee=this.x,he=this.y),super.render(),this.div.hidden=!0,M(this,x)?Ae(this,R,us).call(this):Ae(this,R,Nr).call(this),this.width){const[re,me]=this.parentDimensions;this.setAt(ee*re,he*me,this.width*re,this.height*me)}return this.div}static deserialize(ee,he,re){if(ee instanceof o.StampAnnotationElement)return null;const me=super.deserialize(ee,he,re),{rect:te,bitmapUrl:ce,bitmapId:ye,isSvg:L,accessibilityData:N}=ee;ye&&re.imageManager.isValidId(ye)?ke(me,u,ye):ke(me,_,ce),ke(me,g,L);const[T,A]=me.pageDimensions;return me.width=(te[2]-te[0])/T,me.height=(te[3]-te[1])/A,N&&(me.altTextData=N),me}serialize(){let ee=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,he=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(this.isEmpty())return null;const re={annotationType:s.AnnotationEditorType.STAMP,bitmapId:M(this,u),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:M(this,g),structTreeParentId:this._structTreeParentId};if(ee)return re.bitmapUrl=Ae(this,R,Pr).call(this,!0),re.accessibilityData=this.altTextData,re;const{decorative:me,altText:te}=this.altTextData;if(!me&&te&&(re.accessibilityData={type:"Figure",alt:te}),he===null)return re;he.stamps||(he.stamps=new Map);const ce=M(this,g)?(re.rect[2]-re.rect[0])*(re.rect[3]-re.rect[1]):null;if(!he.stamps.has(M(this,u)))he.stamps.set(M(this,u),{area:ce,serialized:re}),re.bitmap=Ae(this,R,Pr).call(this,!1);else if(M(this,g)){const ye=he.stamps.get(M(this,u));ce>ye.area&&(ye.area=ce,ye.serialized.bitmap.close(),ye.serialized.bitmap=Ae(this,R,Pr).call(this,!1))}return re}};x=new WeakMap,u=new WeakMap,h=new WeakMap,_=new WeakMap,v=new WeakMap,b=new WeakMap,E=new WeakMap,d=new WeakMap,g=new WeakMap,y=new WeakMap,R=new WeakSet,pr=function(ee){let he=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!ee){this.remove();return}ke(this,x,ee.bitmap),he||(ke(this,u,ee.id),ke(this,g,ee.isSvg)),Ae(this,R,us).call(this)},mr=function(){ke(this,h,null),this._uiManager.enableWaiting(!1),M(this,b)&&this.div.focus()},Nr=function(){if(M(this,u)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(M(this,u)).then(he=>Ae(this,R,pr).call(this,he,!0)).finally(()=>Ae(this,R,mr).call(this));return}if(M(this,_)){const he=M(this,_);ke(this,_,null),this._uiManager.enableWaiting(!0),ke(this,h,this._uiManager.imageManager.getFromUrl(he).then(re=>Ae(this,R,pr).call(this,re)).finally(()=>Ae(this,R,mr).call(this)));return}if(M(this,v)){const he=M(this,v);ke(this,v,null),this._uiManager.enableWaiting(!0),ke(this,h,this._uiManager.imageManager.getFromFile(he).then(re=>Ae(this,R,pr).call(this,re)).finally(()=>Ae(this,R,mr).call(this)));return}const ee=document.createElement("input");ee.type="file",ee.accept=H.supportedTypesStr,ke(this,h,new Promise(he=>{ee.addEventListener("change",async()=>{if(!ee.files||ee.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const re=await this._uiManager.imageManager.getFromFile(ee.files[0]);Ae(this,R,pr).call(this,re)}he()}),ee.addEventListener("cancel",()=>{this.remove(),he()})}).finally(()=>Ae(this,R,mr).call(this))),ee.click()},us=function(){const{div:ee}=this;let{width:he,height:re}=M(this,x);const[me,te]=this.pageDimensions,ce=.75;if(this.width)he=this.width*me,re=this.height*te;else if(he>ce*me||re>ce*te){const T=Math.min(ce*me/he,ce*te/re);he*=T,re*=T}const[ye,L]=this.parentDimensions;this.setDims(he*ye/me,re*L/te),this._uiManager.enableWaiting(!1);const N=ke(this,b,document.createElement("canvas"));ee.append(N),ee.hidden=!1,Ae(this,R,ds).call(this,he,re),Ae(this,R,Ys).call(this),M(this,y)||(this.parent.addUndoableEditor(this),ke(this,y,!0)),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",subtype:this.editorType,data:{action:"inserted_image"}}}),this.addAltTextButton()},Xs=function(ee,he){var ce;const[re,me]=this.parentDimensions;this.width=ee/re,this.height=he/me,this.setDims(ee,he),(ce=this._initialOptions)!=null&&ce.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,M(this,d)!==null&&clearTimeout(M(this,d)),ke(this,d,setTimeout(()=>{ke(this,d,null),Ae(this,R,ds).call(this,ee,he)},200))},Ks=function(ee,he){const{width:re,height:me}=M(this,x);let te=re,ce=me,ye=M(this,x);for(;te>2*ee||ce>2*he;){const L=te,N=ce;te>2*ee&&(te=te>=16384?Math.floor(te/2)-1:Math.ceil(te/2)),ce>2*he&&(ce=ce>=16384?Math.floor(ce/2)-1:Math.ceil(ce/2));const T=new OffscreenCanvas(te,ce);T.getContext("2d").drawImage(ye,0,0,L,N,0,0,te,ce),ye=T.transferToImageBitmap()}return ye},ds=function(ee,he){ee=Math.ceil(ee),he=Math.ceil(he);const re=M(this,b);if(!re||re.width===ee&&re.height===he)return;re.width=ee,re.height=he;const me=M(this,g)?M(this,x):Ae(this,R,Ks).call(this,ee,he),te=re.getContext("2d");te.filter=this._uiManager.hcmFilter,te.drawImage(me,0,0,me.width,me.height,0,0,ee,he)},Pr=function(ee){if(ee){if(M(this,g)){const me=this._uiManager.imageManager.getSvgUrl(M(this,u));if(me)return me}const he=document.createElement("canvas");return{width:he.width,height:he.height}=M(this,x),he.getContext("2d").drawImage(M(this,x),0,0),he.toDataURL()}if(M(this,g)){const[he,re]=this.pageDimensions,me=Math.round(this.width*he*i.PixelsPerInch.PDF_TO_CSS_UNITS),te=Math.round(this.height*re*i.PixelsPerInch.PDF_TO_CSS_UNITS),ce=new OffscreenCanvas(me,te);return ce.getContext("2d").drawImage(M(this,x),0,0,M(this,x).width,M(this,x).height,0,0,me,te),ce.transferToImageBitmap()}return structuredClone(M(this,x))},Ys=function(){ke(this,E,new ResizeObserver(ee=>{const he=ee[0].contentRect;he.width&&he.height&&Ae(this,R,Xs).call(this,he.width,he.height)})),M(this,E).observe(this.div)},wt(H,"_type","stamp");let c=H;r.StampEditor=c}],__webpack_module_cache__={};function __w_pdfjs_require__(t){var r=__webpack_module_cache__[t];if(r!==void 0)return r.exports;var e=__webpack_module_cache__[t]={exports:{}};return __webpack_modules__[t].call(e.exports,e,e.exports,__w_pdfjs_require__),e.exports}var __webpack_exports__={};return(()=>{var t=__webpack_exports__;Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"AbortException",{enumerable:!0,get:function(){return r.AbortException}}),Object.defineProperty(t,"AnnotationEditorLayer",{enumerable:!0,get:function(){return i.AnnotationEditorLayer}}),Object.defineProperty(t,"AnnotationEditorParamsType",{enumerable:!0,get:function(){return r.AnnotationEditorParamsType}}),Object.defineProperty(t,"AnnotationEditorType",{enumerable:!0,get:function(){return r.AnnotationEditorType}}),Object.defineProperty(t,"AnnotationEditorUIManager",{enumerable:!0,get:function(){return o.AnnotationEditorUIManager}}),Object.defineProperty(t,"AnnotationLayer",{enumerable:!0,get:function(){return c.AnnotationLayer}}),Object.defineProperty(t,"AnnotationMode",{enumerable:!0,get:function(){return r.AnnotationMode}}),Object.defineProperty(t,"CMapCompressionType",{enumerable:!0,get:function(){return r.CMapCompressionType}}),Object.defineProperty(t,"DOMSVGFactory",{enumerable:!0,get:function(){return s.DOMSVGFactory}}),Object.defineProperty(t,"FeatureTest",{enumerable:!0,get:function(){return r.FeatureTest}}),Object.defineProperty(t,"GlobalWorkerOptions",{enumerable:!0,get:function(){return x.GlobalWorkerOptions}}),Object.defineProperty(t,"ImageKind",{enumerable:!0,get:function(){return r.ImageKind}}),Object.defineProperty(t,"InvalidPDFException",{enumerable:!0,get:function(){return r.InvalidPDFException}}),Object.defineProperty(t,"MissingPDFException",{enumerable:!0,get:function(){return r.MissingPDFException}}),Object.defineProperty(t,"OPS",{enumerable:!0,get:function(){return r.OPS}}),Object.defineProperty(t,"PDFDataRangeTransport",{enumerable:!0,get:function(){return e.PDFDataRangeTransport}}),Object.defineProperty(t,"PDFDateString",{enumerable:!0,get:function(){return s.PDFDateString}}),Object.defineProperty(t,"PDFWorker",{enumerable:!0,get:function(){return e.PDFWorker}}),Object.defineProperty(t,"PasswordResponses",{enumerable:!0,get:function(){return r.PasswordResponses}}),Object.defineProperty(t,"PermissionFlag",{enumerable:!0,get:function(){return r.PermissionFlag}}),Object.defineProperty(t,"PixelsPerInch",{enumerable:!0,get:function(){return s.PixelsPerInch}}),Object.defineProperty(t,"PromiseCapability",{enumerable:!0,get:function(){return r.PromiseCapability}}),Object.defineProperty(t,"RenderingCancelledException",{enumerable:!0,get:function(){return s.RenderingCancelledException}}),Object.defineProperty(t,"SVGGraphics",{enumerable:!0,get:function(){return e.SVGGraphics}}),Object.defineProperty(t,"UnexpectedResponseException",{enumerable:!0,get:function(){return r.UnexpectedResponseException}}),Object.defineProperty(t,"Util",{enumerable:!0,get:function(){return r.Util}}),Object.defineProperty(t,"VerbosityLevel",{enumerable:!0,get:function(){return r.VerbosityLevel}}),Object.defineProperty(t,"XfaLayer",{enumerable:!0,get:function(){return u.XfaLayer}}),Object.defineProperty(t,"build",{enumerable:!0,get:function(){return e.build}}),Object.defineProperty(t,"createValidAbsoluteUrl",{enumerable:!0,get:function(){return r.createValidAbsoluteUrl}}),Object.defineProperty(t,"getDocument",{enumerable:!0,get:function(){return e.getDocument}}),Object.defineProperty(t,"getFilenameFromUrl",{enumerable:!0,get:function(){return s.getFilenameFromUrl}}),Object.defineProperty(t,"getPdfFilenameFromUrl",{enumerable:!0,get:function(){return s.getPdfFilenameFromUrl}}),Object.defineProperty(t,"getXfaPageViewport",{enumerable:!0,get:function(){return s.getXfaPageViewport}}),Object.defineProperty(t,"isDataScheme",{enumerable:!0,get:function(){return s.isDataScheme}}),Object.defineProperty(t,"isPdfFile",{enumerable:!0,get:function(){return s.isPdfFile}}),Object.defineProperty(t,"loadScript",{enumerable:!0,get:function(){return s.loadScript}}),Object.defineProperty(t,"noContextMenu",{enumerable:!0,get:function(){return s.noContextMenu}}),Object.defineProperty(t,"normalizeUnicode",{enumerable:!0,get:function(){return r.normalizeUnicode}}),Object.defineProperty(t,"renderTextLayer",{enumerable:!0,get:function(){return a.renderTextLayer}}),Object.defineProperty(t,"setLayerDimensions",{enumerable:!0,get:function(){return s.setLayerDimensions}}),Object.defineProperty(t,"shadow",{enumerable:!0,get:function(){return r.shadow}}),Object.defineProperty(t,"updateTextLayer",{enumerable:!0,get:function(){return a.updateTextLayer}}),Object.defineProperty(t,"version",{enumerable:!0,get:function(){return e.version}});var r=__w_pdfjs_require__(1),e=__w_pdfjs_require__(124),s=__w_pdfjs_require__(168),a=__w_pdfjs_require__(195),i=__w_pdfjs_require__(196),o=__w_pdfjs_require__(165),c=__w_pdfjs_require__(198),x=__w_pdfjs_require__(176),u=__w_pdfjs_require__(201)})(),__webpack_exports__})())})(pdf);var pdfExports=pdf.exports;typeof window<"u"&&!pdfExports.GlobalWorkerOptions.workerSrc&&(pdfExports.GlobalWorkerOptions.workerSrc="//cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js");function PdfToExcelConverter(){const[t,r]=reactExports.useState(!1),[e,s]=reactExports.useState(null),[a,i]=reactExports.useState(null),[o,c]=reactExports.useState([]),[x,u]=reactExports.useState(!1),h=v=>{console.log("📄 Total de elementos de texto:",v.length),console.log("📄 Primeros 10 elementos:",v.slice(0,10));const b=v.slice(0,100).map(F=>F.str).join(" ");console.log("📄 Texto preview (primeros 100):",b);const E=new Map,d=3;v.forEach(F=>{const S=Math.round(F.transform[5]/d)*d;E.has(S)||E.set(S,[]),E.get(S).push(F)});const g=[];Array.from(E.entries()).sort((F,S)=>S[0]-F[0]).forEach(([F,S])=>{const w=S.sort((j,C)=>j.transform[4]-C.transform[4]).map(j=>j.str).join(" ");g.push(w)}),console.log("📄 Líneas extraídas:",g.slice(0,20));const y=[];let R="",P="";for(const F of g){const S=F.trim();if(!S||/glass|cristal|seguro|insurance/i.test(S))continue;const I=S.match(/(Business\s*Parcel|Economy\s*Parcel|Euro\s*Business\s*Parcel|EuroBusinessParc|Parcel\s*Shop|Express|Eurobusiness|Courier)/i);if(I){R=I[0].trim().replace(/\s+/g," "),console.log("🚚 Servicio:",R);continue}const w=S.match(/\b(PROVINCIAL|REGIONAL|NACIONAL|CEUTA|MELILLA|GIBRALTAR|ANDORRA|PENINSULA|BALEARES)\b/i);if(w){P=w[1].trim(),console.log("📍 Zona:",P);continue}const j=S.match(/(\d+(?:-\d+)?)\s*kg/i)||S.match(/\b(0-1|1-3|3-5|5-10|10-15|15\+?|\+15)\b/i);if(!j||!R||!P)continue;let C=j[1];C==="1"?C="0-1":C==="3"?C="1-3":C==="5"?C="3-5":C==="10"?C="5-10":C==="15"?C="10-15":(C==="+"||C==="+15"||C==="15+")&&(C="15-99");const V=S.match(/\d+[.,]\d{2}/g);if(console.log("🔢 Línea con peso:",S,"→ números:",V),V&&V.length>=6){const O={servicio:R,zona:P,peso:C+"kg",recogida:V[0].replace(",","."),arrastre:V[1].replace(",","."),entrega:V[2].replace(",","."),salidas:V[3].replace(",","."),recogidas:V[4].replace(",","."),interciudad:V[5].replace(",",".")};console.log("✅ Fila:",O),y.push(O)}}return console.log(`📊 Total filas: ${y.length}`),y},_=async v=>{var E;const b=(E=v.target.files)==null?void 0:E[0];if(!b||!b.name.toLowerCase().endsWith(".pdf")){i("Selecciona un archivo PDF válido");return}r(!0),i(null),s(null),c([]),u(!1);try{const d=await b.arrayBuffer(),y=await pdfExports.getDocument({data:d}).promise,R=[];for(let O=1;O<=y.numPages;O++){const z=await(await y.getPage(O)).getTextContent();R.push(...z.items)}const P=h(R);if(P.length===0)throw new Error("No se encontraron tarifas. Usa un PDF de GLS 2025.");c(P);const S=[["Servicio","Zona","Peso","Recogida","Arrastre","Entrega","Salidas","Recogidas","Interciudad"],...P.map(O=>Object.values(O))],I=utils.aoa_to_sheet(S);I["!cols"]=Array(9).fill({wch:14});const w=utils.book_new();utils.book_append_sheet(w,I,"Tarifas");const j=writeSync(w,{bookType:"xlsx",type:"array"}),C=new Blob([j],{type:"application/octet-stream"}),V=URL.createObjectURL(C);s(V)}catch(d){i(d instanceof Error?d.message:"Error al procesar el PDF")}finally{r(!1)}};return jsxRuntimeExports.jsxs("div",{className:"p-6 bg-white rounded-lg border border-gray-200",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[jsxRuntimeExports.jsx(FileSpreadsheet,{className:"w-6 h-6 text-green-600"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"PDF to Excel"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600",children:"Sin errores, sin warnings, 100% local"})]})]}),jsxRuntimeExports.jsx("input",{type:"file",accept:".pdf",onChange:_,disabled:t,className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 disabled:opacity-50"}),t&&jsxRuntimeExports.jsxs("div",{className:"mt-4 p-4 bg-blue-50 rounded-lg flex items-center gap-3",children:[jsxRuntimeExports.jsx(Loader2,{className:"w-5 h-5 animate-spin text-blue-600"}),jsxRuntimeExports.jsx("p",{className:"text-sm",children:"Procesando PDF..."})]}),a&&jsxRuntimeExports.jsxs("div",{className:"mt-4 p-4 bg-red-50 rounded-lg flex items-start gap-3",children:[jsxRuntimeExports.jsx(AlertCircle,{className:"w-5 h-5 text-red-600 mt-0.5"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-red-700",children:a})]}),e&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:"mt-4 p-4 bg-green-50 rounded-lg flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx(CheckCircle2,{className:"w-5 h-5 text-green-600"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("p",{className:"text-sm font-medium text-green-900",children:["¡Listo! ",o.length," filas"]}),jsxRuntimeExports.jsxs("button",{onClick:()=>u(!x),className:"text-xs text-green-700 underline",children:[x?"Ocultar":"Ver"," vista previa"]})]})]}),jsxRuntimeExports.jsxs("a",{href:e,download:"tarifas_gls.xlsx",className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white text-sm font-medium rounded-md hover:bg-green-700",children:[jsxRuntimeExports.jsx(Download,{className:"w-4 h-4"}),"Descargar"]})]}),x&&jsxRuntimeExports.jsx("div",{className:"mt-4 max-h-64 overflow-auto border rounded",children:jsxRuntimeExports.jsxs("table",{className:"w-full text-xs",children:[jsxRuntimeExports.jsx("thead",{className:"bg-gray-100 sticky top-0",children:jsxRuntimeExports.jsx("tr",{children:["Servicio","Zona","Peso","Rec","Arr","Ent","Sal","Recog","Int"].map(v=>jsxRuntimeExports.jsx("th",{className:"px-2 py-1 text-left font-medium",children:v},v))})}),jsxRuntimeExports.jsx("tbody",{children:o.slice(0,20).map((v,b)=>jsxRuntimeExports.jsxs("tr",{className:"border-t",children:[jsxRuntimeExports.jsx("td",{className:"px-2 py-1",children:v.servicio}),jsxRuntimeExports.jsx("td",{className:"px-2 py-1",children:v.zona}),jsxRuntimeExports.jsx("td",{className:"px-2 py-1",children:v.peso}),jsxRuntimeExports.jsx("td",{className:"px-2 py-1",children:v.recogida}),jsxRuntimeExports.jsx("td",{className:"px-2 py-1",children:v.arrastre}),jsxRuntimeExports.jsx("td",{className:"px-2 py-1",children:v.entrega}),jsxRuntimeExports.jsx("td",{className:"px-2 py-1",children:v.salidas}),jsxRuntimeExports.jsx("td",{className:"px-2 py-1",children:v.recogidas}),jsxRuntimeExports.jsx("td",{className:"px-2 py-1",children:v.interciudad})]},b))})]})})]})]})}function UserSettingsPanel({onClose:t}){const{userData:r}=useAuth(),[e,s]=reactExports.useState("preferences"),[a,i]=reactExports.useState(!1),o=[{id:"preferences",label:"Preferencias",icon:Settings},{id:"profile",label:"Perfil",icon:User},{id:"subscription",label:"Suscripción",icon:CreditCard},{id:"pdf-converter",label:"PDF a Excel",icon:FileSpreadsheet}];return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Configuración"}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[r==null?void 0:r.full_name," • ",r==null?void 0:r.role]})]}),jsxRuntimeExports.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:jsxRuntimeExports.jsx(X,{className:"h-6 w-6 text-gray-500"})})]}),!a&&jsxRuntimeExports.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[jsxRuntimeExports.jsxs("div",{className:"w-64 border-r border-gray-200 p-4 space-y-1",children:[o.map(c=>{const x=c.icon;return jsxRuntimeExports.jsxs("button",{onClick:()=>s(c.id),className:`w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition-colors ${e===c.id?"bg-blue-50 text-blue-700":"text-gray-700 hover:bg-gray-50"}`,children:[jsxRuntimeExports.jsx(x,{className:"h-5 w-5"}),jsxRuntimeExports.jsx("span",{className:"font-medium",children:c.label})]},c.id)}),jsxRuntimeExports.jsxs("button",{onClick:()=>i(!0),className:"w-full flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:[jsxRuntimeExports.jsx(Settings,{className:"h-5 w-5"}),jsxRuntimeExports.jsx("span",{className:"font-medium",children:"Tabla de Costes Personalizada"})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[e==="preferences"&&jsxRuntimeExports.jsx(PreferencesTab,{}),e==="profile"&&jsxRuntimeExports.jsx(ProfileTab,{}),e==="subscription"&&jsxRuntimeExports.jsx(SubscriptionTab,{}),e==="pdf-converter"&&jsxRuntimeExports.jsx(PdfToExcelConverter,{})]})]}),a&&jsxRuntimeExports.jsx(CustomTariffsEditor,{onClose:()=>i(!1)})]})})}function AdminPanel(){const[t,r]=reactExports.useState("users"),[e,s]=reactExports.useState([]),[a,i]=reactExports.useState([]),[o,c]=reactExports.useState(!1),[x,u]=reactExports.useState(null),[h,_]=reactExports.useState(""),[v,b]=reactExports.useState(1),[E,d]=reactExports.useState(30),[g,y]=reactExports.useState(""),[R,P]=reactExports.useState(""),[F,S]=reactExports.useState(1),[I,w]=reactExports.useState(30),[j,C]=reactExports.useState(null);reactExports.useEffect(()=>{t==="users"?V():t==="promo-codes"&&O()},[t]);async function V(){c(!0);try{const{data:re,error:me}=await supabase.from("user_profiles").select("*").order("created_at",{ascending:!1});if(me)throw me;s(re||[])}catch(re){ee("error",re.message)}finally{c(!1)}}async function O(){c(!0);try{const{data:re,error:me}=await supabase.from("promotional_codes").select("*").order("created_at",{ascending:!1});if(me)throw me;i(re||[])}catch(re){ee("error",re.message)}finally{c(!1)}}async function H(){if(!h||!h.includes("@")){ee("error","Email inválido");return}c(!0);try{const re=localStorage.getItem("user_session");if(!re)throw new Error("No hay sesión activa");const{sessionToken:me}=JSON.parse(re),te=await fetch("https://eyvhuoldrjfntkffpkfm.supabase.co/functions/v1/admin-create-user",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${me}`},body:JSON.stringify({email:h.toLowerCase().trim(),tier:v,durationDays:E})}),ce=await te.json();if(!te.ok)throw new Error(ce.error||"Error al crear usuario");ee("success",`Usuario ${h} creado correctamente`),_(""),b(1),d(30),V()}catch(re){ee("error",re.message)}finally{c(!1)}}async function z(){if(!g||g.length<4){ee("error","El código debe tener al menos 4 caracteres");return}if(!R){ee("error","La descripción es obligatoria");return}c(!0);try{const{data:re}=await supabase.auth.getUser();if(!re.user)throw new Error("No autenticado");const{error:me}=await supabase.from("promotional_codes").insert({code:g.toUpperCase().trim(),description:R,tier:F,duration_days:I,max_uses:j,is_active:!0,created_by:re.user.id});if(me)throw me;ee("success",`Código promocional ${g} creado`),y(""),P(""),S(1),w(30),C(null),O()}catch(re){ee("error",re.message)}finally{c(!1)}}async function pe(re,me){c(!0);try{const{error:te}=await supabase.from("promotional_codes").update({is_active:!me}).eq("id",re);if(te)throw te;ee("success",`Código ${me?"desactivado":"activado"}`),O()}catch(te){ee("error",te.message)}finally{c(!1)}}function ee(re,me){u({type:re,text:me}),setTimeout(()=>u(null),5e3)}function he(re){return["Básico","Pro","Business","Enterprise","Unlimited"][re-1]||"Desconocido"}return jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200",children:[x&&jsxRuntimeExports.jsx("div",{className:`p-4 mb-4 rounded-lg ${x.type==="success"?"bg-green-50 text-green-800":"bg-red-50 text-red-800"}`,children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(AlertCircle,{className:"h-5 w-5"}),jsxRuntimeExports.jsx("span",{children:x.text})]})}),jsxRuntimeExports.jsx("div",{className:"border-b border-gray-200",children:jsxRuntimeExports.jsxs("nav",{className:"flex -mb-px",children:[jsxRuntimeExports.jsx("button",{onClick:()=>r("users"),className:`px-6 py-4 text-sm font-medium border-b-2 transition-colors ${t==="users"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(Users,{className:"h-4 w-4"}),"Usuarios"]})}),jsxRuntimeExports.jsx("button",{onClick:()=>r("create-user"),className:`px-6 py-4 text-sm font-medium border-b-2 transition-colors ${t==="create-user"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(UserPlus,{className:"h-4 w-4"}),"Crear Usuario"]})}),jsxRuntimeExports.jsx("button",{onClick:()=>r("promo-codes"),className:`px-6 py-4 text-sm font-medium border-b-2 transition-colors ${t==="promo-codes"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(Gift,{className:"h-4 w-4"}),"Códigos Promo"]})})]})}),jsxRuntimeExports.jsxs("div",{className:"p-6",children:[t==="users"&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Usuarios Registrados"}),o?jsxRuntimeExports.jsx("p",{className:"text-gray-500",children:"Cargando..."}):e.length===0?jsxRuntimeExports.jsx("p",{className:"text-gray-500",children:"No hay usuarios registrados"}):jsxRuntimeExports.jsx("div",{className:"overflow-x-auto",children:jsxRuntimeExports.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[jsxRuntimeExports.jsx("thead",{className:"bg-gray-50",children:jsxRuntimeExports.jsxs("tr",{children:[jsxRuntimeExports.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Email"}),jsxRuntimeExports.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Tier"}),jsxRuntimeExports.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Dispositivos"}),jsxRuntimeExports.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Estado"}),jsxRuntimeExports.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Expira"}),jsxRuntimeExports.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Pago"})]})}),jsxRuntimeExports.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:e.map(re=>jsxRuntimeExports.jsxs("tr",{className:"hover:bg-gray-50",children:[jsxRuntimeExports.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:re.email}),jsxRuntimeExports.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:he(re.subscription_tier)}),jsxRuntimeExports.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:re.max_devices}),jsxRuntimeExports.jsx("td",{className:"px-4 py-3 text-sm",children:jsxRuntimeExports.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${re.subscription_status==="active"?"bg-green-100 text-green-800":re.subscription_status==="trial"?"bg-blue-100 text-blue-800":"bg-red-100 text-red-800"}`,children:re.subscription_status})}),jsxRuntimeExports.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:new Date(re.subscription_end_date).toLocaleDateString()}),jsxRuntimeExports.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:re.payment_method||"-"})]},re.id))})]})})]}),t==="create-user"&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h2",{className:"text-xl font-semibold mb-6",children:"Crear Usuario Manualmente"}),jsxRuntimeExports.jsxs("div",{className:"max-w-md space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[jsxRuntimeExports.jsx(Mail,{className:"inline h-4 w-4 mr-1"}),"Email"]}),jsxRuntimeExports.jsx("input",{type:"email",value:h,onChange:re=>_(re.target.value),placeholder:"usuario@gls-spain.es",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[jsxRuntimeExports.jsx(CreditCard,{className:"inline h-4 w-4 mr-1"}),"Tier de Suscripción"]}),jsxRuntimeExports.jsxs("select",{value:v,onChange:re=>b(parseInt(re.target.value)),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[jsxRuntimeExports.jsx("option",{value:1,children:"Básico (1 dispositivo)"}),jsxRuntimeExports.jsx("option",{value:2,children:"Pro (3 dispositivos)"}),jsxRuntimeExports.jsx("option",{value:3,children:"Business (5 dispositivos)"}),jsxRuntimeExports.jsx("option",{value:4,children:"Enterprise (8 dispositivos)"}),jsxRuntimeExports.jsx("option",{value:5,children:"Unlimited (12 dispositivos)"})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[jsxRuntimeExports.jsx(Calendar,{className:"inline h-4 w-4 mr-1"}),"Duración (días)"]}),jsxRuntimeExports.jsx("input",{type:"number",value:E,onChange:re=>d(parseInt(re.target.value)),min:"1",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),jsxRuntimeExports.jsx("button",{onClick:H,disabled:o,className:"w-full px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:o?"Creando...":"Crear Usuario"})]})]}),t==="promo-codes"&&jsxRuntimeExports.jsxs("div",{className:"space-y-8",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h2",{className:"text-xl font-semibold mb-6",children:"Crear Código Promocional"}),jsxRuntimeExports.jsxs("div",{className:"max-w-md space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Código"}),jsxRuntimeExports.jsx("input",{type:"text",value:g,onChange:re=>y(re.target.value.toUpperCase()),placeholder:"GLS2025FREE",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Descripción"}),jsxRuntimeExports.jsx("input",{type:"text",value:R,onChange:re=>P(re.target.value),placeholder:"Acceso gratuito 30 días",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tier"}),jsxRuntimeExports.jsxs("select",{value:F,onChange:re=>S(parseInt(re.target.value)),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[jsxRuntimeExports.jsx("option",{value:1,children:"Básico (1 dispositivo)"}),jsxRuntimeExports.jsx("option",{value:2,children:"Pro (3 dispositivos)"}),jsxRuntimeExports.jsx("option",{value:3,children:"Business (5 dispositivos)"}),jsxRuntimeExports.jsx("option",{value:4,children:"Enterprise (8 dispositivos)"}),jsxRuntimeExports.jsx("option",{value:5,children:"Unlimited (12 dispositivos)"})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Duración (días)"}),jsxRuntimeExports.jsx("input",{type:"number",value:I,onChange:re=>w(parseInt(re.target.value)),min:"1",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Máximo de usos (vacío = ilimitado)"}),jsxRuntimeExports.jsx("input",{type:"number",value:j||"",onChange:re=>C(re.target.value?parseInt(re.target.value):null),min:"1",placeholder:"Ilimitado",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),jsxRuntimeExports.jsx("button",{onClick:z,disabled:o,className:"w-full px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:o?"Creando...":"Crear Código Promocional"})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Códigos Promocionales Existentes"}),o?jsxRuntimeExports.jsx("p",{className:"text-gray-500",children:"Cargando..."}):a.length===0?jsxRuntimeExports.jsx("p",{className:"text-gray-500",children:"No hay códigos promocionales"}):jsxRuntimeExports.jsx("div",{className:"overflow-x-auto",children:jsxRuntimeExports.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[jsxRuntimeExports.jsx("thead",{className:"bg-gray-50",children:jsxRuntimeExports.jsxs("tr",{children:[jsxRuntimeExports.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Código"}),jsxRuntimeExports.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Descripción"}),jsxRuntimeExports.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Tier"}),jsxRuntimeExports.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Días"}),jsxRuntimeExports.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Usos"}),jsxRuntimeExports.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Estado"}),jsxRuntimeExports.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Acciones"})]})}),jsxRuntimeExports.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:a.map(re=>jsxRuntimeExports.jsxs("tr",{className:"hover:bg-gray-50",children:[jsxRuntimeExports.jsx("td",{className:"px-4 py-3 text-sm font-mono font-semibold text-gray-900",children:re.code}),jsxRuntimeExports.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:re.description}),jsxRuntimeExports.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:he(re.tier)}),jsxRuntimeExports.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:re.duration_days}),jsxRuntimeExports.jsxs("td",{className:"px-4 py-3 text-sm text-gray-900",children:[re.current_uses," / ",re.max_uses||"∞"]}),jsxRuntimeExports.jsx("td",{className:"px-4 py-3 text-sm",children:jsxRuntimeExports.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${re.is_active?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:re.is_active?"Activo":"Inactivo"})}),jsxRuntimeExports.jsx("td",{className:"px-4 py-3 text-sm",children:jsxRuntimeExports.jsx("button",{onClick:()=>pe(re.id,re.is_active),disabled:o,className:"text-blue-600 hover:text-blue-800 disabled:opacity-50",children:re.is_active?"Desactivar":"Activar"})})]},re.id))})]})})]})]})]})]})}function useCommercialPlans(){const{user:t}=useAuth(),[r,e]=reactExports.useState([]),[s,a]=reactExports.useState(!1),[i,o]=reactExports.useState(null),c=reactExports.useCallback(async()=>{if(!t){e([]);return}a(!0),o(null);try{const{data:_,error:v}=await supabase.from("custom_commercial_plans").select("*").eq("user_id",t.id).order("created_at",{ascending:!1});if(v)throw v;e(_||[])}catch(_){console.error("Error loading commercial plans:",_),o(_ instanceof Error?_.message:"Error al cargar planes comerciales")}finally{a(!1)}},[t]);reactExports.useEffect(()=>{c()},[c]);const x=reactExports.useCallback(async(_,v)=>{if(!t)throw new Error("Usuario no autenticado");a(!0),o(null);try{const{data:b,error:E}=await supabase.from("custom_commercial_plans").insert({user_id:t.id,plan_name:_,discounts:v}).select().single();if(E)throw E;return await c(),b}catch(b){console.error("Error creating commercial plan:",b);const E=b instanceof Error?b.message:"Error al crear plan comercial";throw o(E),new Error(E)}finally{a(!1)}},[t,c]),u=reactExports.useCallback(async(_,v,b)=>{if(!t)throw new Error("Usuario no autenticado");a(!0),o(null);try{const{data:E,error:d}=await supabase.from("custom_commercial_plans").update({plan_name:v,discounts:b}).eq("id",_).eq("user_id",t.id).select().single();if(d)throw d;return await c(),E}catch(E){console.error("Error updating commercial plan:",E);const d=E instanceof Error?E.message:"Error al actualizar plan comercial";throw o(d),new Error(d)}finally{a(!1)}},[t,c]),h=reactExports.useCallback(async _=>{if(!t)throw new Error("Usuario no autenticado");a(!0),o(null);try{const{error:v}=await supabase.from("custom_commercial_plans").delete().eq("id",_).eq("user_id",t.id);if(v)throw v;await c()}catch(v){console.error("Error deleting commercial plan:",v);const b=v instanceof Error?v.message:"Error al eliminar plan comercial";throw o(b),new Error(b)}finally{a(!1)}},[t,c]);return{plans:r,loading:s,error:i,loadPlans:c,createPlan:x,updatePlan:u,deletePlan:h}}const DOMESTIC_SERVICES=["Express8:30","Express10:30","Express14:00","Express19:00","BusinessParcel","EconomyParcel"],DOMESTIC_WEIGHT_RANGES=["1kg","3kg","5kg","10kg","15kg","additional"],INTERNATIONAL_WEIGHT_RANGES=["under15kg","15kg","additional"],EMPTY_PLAN_DISCOUNTS={domestic:{"Express8:30":{"1kg":0,"3kg":0,"5kg":0,"10kg":0,"15kg":0,additional:0},"Express10:30":{"1kg":0,"3kg":0,"5kg":0,"10kg":0,"15kg":0,additional:0},"Express14:00":{"1kg":0,"3kg":0,"5kg":0,"10kg":0,"15kg":0,additional:0},"Express19:00":{"1kg":0,"3kg":0,"5kg":0,"10kg":0,"15kg":0,additional:0},BusinessParcel:{"1kg":0,"3kg":0,"5kg":0,"10kg":0,"15kg":0,additional:0},EconomyParcel:{"1kg":0,"3kg":0,"5kg":0,"10kg":0,"15kg":0,additional:0}},international:{EuroBusinessParcel:{under15kg:0,"15kg":0,additional:0}}},SERVICE_DISPLAY_NAMES={"Express8:30":"Express 8:30","Express10:30":"Express 10:30","Express14:00":"Express 14:00","Express19:00":"Express 19:00",BusinessParcel:"Business Parcel",EconomyParcel:"Economy Parcel",EuroBusinessParcel:"Euro Business Parcel"},WEIGHT_RANGE_DISPLAY_NAMES={"1kg":"1 kg","3kg":"3 kg","5kg":"5 kg","10kg":"10 kg","15kg":"15 kg",additional:"kg adic.",under15kg:"< 15 kg"};function CommercialPlansManager({onClose:t,onPlanSelected:r}){const{plans:e,loading:s,error:a,createPlan:i,updatePlan:o,deletePlan:c}=useCommercialPlans(),[x,u]=reactExports.useState(null),[h,_]=reactExports.useState(null),[v,b]=reactExports.useState(""),[E,d]=reactExports.useState(JSON.parse(JSON.stringify(EMPTY_PLAN_DISCOUNTS))),[g,y]=reactExports.useState(!1),[R,P]=reactExports.useState(null),F=()=>{u(null),_(null),b(""),d(JSON.parse(JSON.stringify(EMPTY_PLAN_DISCOUNTS))),P(null)},S=()=>{F(),u("create")},I=z=>{u("edit"),_(z.id),b(z.plan_name),d(JSON.parse(JSON.stringify(z.discounts))),P(null)},w=async z=>{if(confirm("¿Estás seguro de que deseas eliminar este plan comercial? Esta acción no se puede deshacer."))try{await c(z),r&&r(null)}catch(pe){alert("Error al eliminar el plan: "+(pe instanceof Error?pe.message:"Error desconocido"))}},j=(z,pe,ee)=>{const he=ee===""?0:parseFloat(ee);isNaN(he)||he<0||he>100||d(re=>({...re,domestic:{...re.domestic,[z]:{...re.domestic[z],[pe]:he}}}))},C=(z,pe)=>{const ee=pe===""?0:parseFloat(pe);isNaN(ee)||ee<0||ee>100||d(he=>({...he,international:{EuroBusinessParcel:{...he.international.EuroBusinessParcel,[z]:ee}}}))},V=(z,pe)=>{d(ee=>({...ee,domestic:{...ee.domestic,[pe]:{...ee.domestic[z]}}}))},O=()=>v.trim()?v.length>100?(P("El nombre del plan no puede superar 100 caracteres"),!1):e.some(pe=>pe.plan_name.toLowerCase()===v.toLowerCase()&&pe.id!==h)?(P("Ya existe un plan con este nombre"),!1):(P(null),!0):(P("El nombre del plan es obligatorio"),!1),H=async()=>{if(O()){y(!0);try{if(x==="create"){const z=await i(v,E);r&&z&&r(z)}else if(x==="edit"&&h){const z=await o(h,v,E);r&&z&&r(z)}F()}catch(z){alert("Error al guardar el plan: "+(z instanceof Error?z.message:"Error desconocido"))}finally{y(!1)}}};return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-6xl max-h-[90vh] overflow-hidden flex flex-col",children:[jsxRuntimeExports.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 text-white p-6 flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold",children:"Gestión de Planes Comerciales"}),jsxRuntimeExports.jsx("p",{className:"text-blue-100 text-sm mt-1",children:"Crea, modifica o elimina tus planes personalizados"})]}),jsxRuntimeExports.jsx("button",{onClick:t,className:"p-2 hover:bg-blue-500 rounded-lg transition-colors","aria-label":"Cerrar",children:jsxRuntimeExports.jsx(X,{size:24})})]}),jsxRuntimeExports.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[a&&jsxRuntimeExports.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-4",children:a}),!x&&jsxRuntimeExports.jsxs("div",{className:"mb-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-4",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Planes Existentes"}),jsxRuntimeExports.jsxs("button",{onClick:S,className:"flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors",disabled:s,children:[jsxRuntimeExports.jsx(Plus,{size:18}),"Crear Nuevo Plan"]})]}),s?jsxRuntimeExports.jsx("div",{className:"text-center py-8 text-gray-500",children:"Cargando planes..."}):e.length===0?jsxRuntimeExports.jsx("div",{className:"text-center py-8 text-gray-500 bg-gray-50 rounded-lg",children:"No tienes planes personalizados. Crea uno nuevo para empezar."}):jsxRuntimeExports.jsx("div",{className:"grid gap-3",children:e.map(z=>jsxRuntimeExports.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("h4",{className:"font-semibold text-gray-800",children:z.plan_name}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Creado: ",new Date(z.created_at).toLocaleDateString("es-ES"),z.updated_at!==z.created_at&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[" • Actualizado: ",new Date(z.updated_at).toLocaleDateString("es-ES")]})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("button",{onClick:()=>I(z),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Editar plan",children:jsxRuntimeExports.jsx(Pen,{size:18})}),jsxRuntimeExports.jsx("button",{onClick:()=>w(z.id),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Eliminar plan",children:jsxRuntimeExports.jsx(Trash2,{size:18})})]})]})},z.id))})]}),x&&jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsxs("div",{className:"mb-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-4",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:x==="create"?"Crear Nuevo Plan":"Editar Plan"}),jsxRuntimeExports.jsx("button",{onClick:F,className:"text-gray-600 hover:text-gray-800 transition-colors",children:"Cancelar"})]}),jsxRuntimeExports.jsxs("div",{className:"mb-6",children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nombre del Plan *"}),jsxRuntimeExports.jsx("input",{type:"text",value:v,onChange:z=>b(z.target.value),placeholder:"Ej: Plan Q1 2025, Plan Cliente Premium...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",maxLength:100}),R&&jsxRuntimeExports.jsx("p",{className:"text-red-600 text-sm mt-1",children:R})]}),jsxRuntimeExports.jsxs("div",{className:"mb-6",children:[jsxRuntimeExports.jsxs("h4",{className:"font-semibold text-gray-800 mb-3 flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:"bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm",children:"Doméstico"}),jsxRuntimeExports.jsx("span",{className:"text-sm text-gray-500",children:"Provincial, regional y península (excluye intercity)"})]}),jsxRuntimeExports.jsx("div",{className:"overflow-x-auto",children:jsxRuntimeExports.jsxs("table",{className:"w-full border-collapse",children:[jsxRuntimeExports.jsx("thead",{children:jsxRuntimeExports.jsxs("tr",{className:"bg-gray-50",children:[jsxRuntimeExports.jsx("th",{className:"border border-gray-300 px-3 py-2 text-left text-sm font-semibold",children:"Servicio"}),DOMESTIC_WEIGHT_RANGES.map(z=>jsxRuntimeExports.jsx("th",{className:"border border-gray-300 px-3 py-2 text-center text-sm font-semibold",children:WEIGHT_RANGE_DISPLAY_NAMES[z]},z)),jsxRuntimeExports.jsx("th",{className:"border border-gray-300 px-3 py-2 text-center text-sm font-semibold w-16",children:"Acción"})]})}),jsxRuntimeExports.jsx("tbody",{children:DOMESTIC_SERVICES.map((z,pe)=>jsxRuntimeExports.jsxs("tr",{className:pe%2===0?"bg-white":"bg-gray-50",children:[jsxRuntimeExports.jsx("td",{className:"border border-gray-300 px-3 py-2 font-medium text-sm",children:SERVICE_DISPLAY_NAMES[z]}),DOMESTIC_WEIGHT_RANGES.map(ee=>jsxRuntimeExports.jsx("td",{className:"border border-gray-300 px-1 py-1",children:jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("input",{type:"number",min:"0",max:"100",step:"0.1",value:E.domestic[z][ee]||"",onChange:he=>j(z,ee,he.target.value),className:"w-full px-2 py-1 pr-6 text-center border border-gray-200 rounded focus:ring-1 focus:ring-blue-500 focus:border-transparent text-sm",placeholder:"0"}),jsxRuntimeExports.jsx("span",{className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-500 text-xs pointer-events-none",children:"%"})]})},ee)),jsxRuntimeExports.jsx("td",{className:"border border-gray-300 px-1 py-1 text-center",children:pe>0&&jsxRuntimeExports.jsx("button",{onClick:()=>V(DOMESTIC_SERVICES[pe-1],z),className:"p-1 text-blue-600 hover:bg-blue-50 rounded transition-colors",title:"Copiar fila anterior",children:jsxRuntimeExports.jsx(Copy,{size:14})})})]},z))})]})})]}),jsxRuntimeExports.jsxs("div",{className:"mb-6",children:[jsxRuntimeExports.jsxs("h4",{className:"font-semibold text-gray-800 mb-3 flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:"bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm",children:"Internacional"}),jsxRuntimeExports.jsx("span",{className:"text-sm text-gray-500",children:"Aplica únicamente a Portugal"})]}),jsxRuntimeExports.jsx("div",{className:"overflow-x-auto",children:jsxRuntimeExports.jsxs("table",{className:"w-full border-collapse",children:[jsxRuntimeExports.jsx("thead",{children:jsxRuntimeExports.jsxs("tr",{className:"bg-gray-50",children:[jsxRuntimeExports.jsx("th",{className:"border border-gray-300 px-3 py-2 text-left text-sm font-semibold",children:"Servicio"}),INTERNATIONAL_WEIGHT_RANGES.map(z=>jsxRuntimeExports.jsx("th",{className:"border border-gray-300 px-3 py-2 text-center text-sm font-semibold",children:WEIGHT_RANGE_DISPLAY_NAMES[z]},z))]})}),jsxRuntimeExports.jsx("tbody",{children:jsxRuntimeExports.jsxs("tr",{className:"bg-white",children:[jsxRuntimeExports.jsx("td",{className:"border border-gray-300 px-3 py-2 font-medium text-sm",children:SERVICE_DISPLAY_NAMES.EuroBusinessParcel}),INTERNATIONAL_WEIGHT_RANGES.map(z=>jsxRuntimeExports.jsx("td",{className:"border border-gray-300 px-1 py-1",children:jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("input",{type:"number",min:"0",max:"100",step:"0.1",value:E.international.EuroBusinessParcel[z]||"",onChange:pe=>C(z,pe.target.value),className:"w-full px-2 py-1 pr-6 text-center border border-gray-200 rounded focus:ring-1 focus:ring-blue-500 focus:border-transparent text-sm",placeholder:"0"}),jsxRuntimeExports.jsx("span",{className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-500 text-xs pointer-events-none",children:"%"})]})},z))]})})]})}),jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"* Valores vacíos se consideran 0%. Los descuentos se aplican sobre la tarifa base."})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-end gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:F,className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",disabled:g,children:"Cancelar"}),jsxRuntimeExports.jsxs("button",{onClick:H,disabled:g||!v.trim(),className:"flex items-center gap-2 bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[jsxRuntimeExports.jsx(Save,{size:18}),g?"Guardando...":"Guardar Plan"]})]})]})})]})]})})}const SERVICE_NAME_MAP={"Urg8:30H Courier":"Express8:30","Urg10H Courier":"Express10:30","Urg14H Courier":"Express14:00","Urg19H Courier":"Express19:00","Business Parcel":"BusinessParcel","Economy Parcel":"EconomyParcel"};function getCustomPlanDiscountForWeight(t,r,e){if(!t)return 0;const s=SERVICE_NAME_MAP[r];if(!s)return 0;const a=t.discounts.domestic[s];if(!a)return 0;let i;return e<=1?i="1kg":e<=3?i="3kg":e<=5?i="5kg":e<=10?i="10kg":e<=15?i="15kg":i="additional",a[i]||0}function getCustomPlanDiscountForInternational(t,r,e){if(!t||r!=="EuroBusiness Parcel")return 0;const s=t.discounts.international.EuroBusinessParcel;if(!s)return 0;let a;return e<15?a="under15kg":e===15?a="15kg":a="additional",s[a]||0}const ALLOWED_ZONES_FOR_DISCOUNT=new Set(["Provincial","Regional","Nacional"]),ARR_FIELD_MAP={Provincial:"provincial_arr",Regional:"regional_arr",Nacional:"nacional_arr",Portugal:"portugal_arr"};function getTariffNumericValue(t,r){const e=t[r];return typeof e=="number"&&Number.isFinite(e)?e:null}function roundUp(t){return!Number.isFinite(t)||t<=0?0:Math.ceil(t*100-1e-9)/100}function calculateCustomPlanDiscount(t,r,e,s,a,i){if(!r||i==="interciudad")return 0;const o=e==="EuroBusiness Parcel",c=s==="Portugal";if(c&&!o||!c&&!ALLOWED_ZONES_FOR_DISCOUNT.has(s))return 0;const x=ARR_FIELD_MAP[s];if(!x)return 0;let u;if(o&&c?u=getCustomPlanDiscountForInternational(r,e,a):u=getCustomPlanDiscountForWeight(r,e,a),u===0)return 0;const h=Math.ceil(a);if(h<=0)return 0;const _=[...t].filter(g=>g.service_name===e).sort((g,y)=>g.weight_from-y.weight_from);if(!_.length)return 0;const v=_.find(g=>g.weight_from<=h&&(g.weight_to===null||g.weight_to===void 0||g.weight_to>=h)&&g.weight_from!==999);if(!v)return 0;const b=getTariffNumericValue(v,x);if(!b||!Number.isFinite(b))return 0;const E=b*(u/100),d=v.weight_to??v.weight_from;if(h>d){const g=_.find(y=>y.weight_from===999);if(g){const y=getTariffNumericValue(g,x);if(y&&Number.isFinite(y)){const R=h-d,P=Math.ceil(R),F=y*(u/100)*P;return roundUp(E+F)}}}return roundUp(E)}function getCustomPlanDisplayInfo(t){return t?{name:t.plan_name,description:"Plan comercial personalizado"}:{name:"Sin plan personalizado",description:"No hay plan personalizado aplicado"}}function PackageManager({packages:t,onChange:r,selectedService:e,onClearPackages:s,validationErrors:a=[]}){const i=d=>{const g=a.find(y=>y.packageId===d);return(g==null?void 0:g.errors)??[]},o=React.useCallback(d=>{typeof r=="function"&&r(d)},[r]),c=()=>{const d={id:Date.now().toString(),weight:1,finalWeight:1,quantity:1,dimensions:{height:10,width:10,length:10}};o([...t,d])},x=d=>{t.length>1&&o(t.filter(g=>g.id!==d))},u=(d,g)=>{o(t.map(y=>{if(y.id!==d)return y;const R=y.volumetricWeight?Math.max(g,y.volumetricWeight):g;return{...y,weight:g,finalWeight:R}}))},h=(d,g)=>{const y=e?getConversionFactorForService(e):167,R=calculateVolumetricWeight(g.height,g.width,g.length,y);o(t.map(P=>P.id===d?{...P,dimensions:g,volumetricWeight:R,finalWeight:Math.max(P.weight,R)}:P))},_=(d,g)=>{const y=Math.max(1,Math.round(Number.isFinite(g)?g:1));o(t.map(R=>R.id===d?{...R,quantity:y}:R))},v=t.reduce((d,g)=>d+Math.max(1,Math.round(g.quantity??1)),0),b=t.reduce((d,g)=>d+g.weight*Math.max(1,Math.round(g.quantity??1)),0),E=t.reduce((d,g)=>d+(g.finalWeight||g.weight)*Math.max(1,Math.round(g.quantity??1)),0);return jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 lg:p-8",children:[jsxRuntimeExports.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-start md:justify-between",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center text-xl font-semibold text-gray-900",children:[jsxRuntimeExports.jsx(Package,{className:"h-5 w-5 mr-2 text-blue-600"}),"Gestión de Bultos"]}),jsxRuntimeExports.jsx("p",{className:"mt-2 text-sm text-gray-600 md:mt-1 md:ml-7",children:"La tabla de costes se actualizará automáticamente al indicar pesos, medidas y ajustes necesarios."})]}),jsxRuntimeExports.jsxs("div",{className:"flex flex-wrap gap-2",children:[jsxRuntimeExports.jsxs("button",{onClick:c,type:"button",className:"flex items-center px-4 py-2 text-sm bg-blue-600 text-white rounded-lg shadow-sm hover:bg-blue-700 transition-colors",children:[jsxRuntimeExports.jsx(Plus,{className:"h-4 w-4 mr-1"}),"Añadir"]}),t.length>1&&jsxRuntimeExports.jsx("button",{onClick:s,type:"button",className:"flex items-center px-4 py-2 text-sm bg-gray-100 text-gray-700 rounded-lg shadow-sm hover:bg-gray-200 transition-colors",children:"Limpiar bultos"})]})]}),t.length===1&&jsxRuntimeExports.jsxs("div",{className:"mt-4 mb-4 p-3 bg-blue-50 rounded-lg",children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-blue-900 mb-2",children:"Bultos idénticos (atajo rápido)"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-2",children:[jsxRuntimeExports.jsx("input",{type:"number",min:"1",max:"100",step:"1",value:t[0].quantity??1,onChange:d=>_(t[0].id,Number(d.target.value)),className:"w-20 px-2 py-1 text-sm border border-blue-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),jsxRuntimeExports.jsxs("span",{className:"text-sm text-blue-700",children:["bultos de ",t[0].weight," kg",t[0].dimensions&&jsxRuntimeExports.jsxs("span",{children:[" ","(",t[0].dimensions.height,"×",t[0].dimensions.width,"×",t[0].dimensions.length," cm)"]})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-6",children:[jsxRuntimeExports.jsx("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-3",children:t.map((d,g)=>{var F,S,I;const y=Math.max(1,Math.round(d.quantity??1)),R=i(d.id),P=R.length>0;return jsxRuntimeExports.jsxs("div",{className:`border rounded-lg p-4 flex flex-col h-full ${P?"border-red-400 bg-red-50":"border-gray-200"}`,children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-3",children:[jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>{t.length>1&&x(d.id)},disabled:t.length<=1,className:`text-sm font-medium text-left ${t.length>1?"text-gray-900 hover:text-red-600 focus:outline-none focus-visible:ring-2 focus-visible:ring-red-200 rounded":"text-gray-900 cursor-default"}`,title:t.length>1?"Pulsa para eliminar este bulto":void 0,children:jsxRuntimeExports.jsxs("span",{className:"flex items-center",children:[jsxRuntimeExports.jsxs("span",{children:["Bulto ",g+1]}),y>1&&jsxRuntimeExports.jsxs("span",{className:"ml-2 text-xs font-semibold text-blue-600",children:["×",y]}),P&&jsxRuntimeExports.jsx(AlertTriangle,{className:"ml-2 h-4 w-4 text-red-500"}),t.length>1&&!P&&jsxRuntimeExports.jsx("span",{className:"ml-2 text-[11px] font-normal text-red-500",children:"(pulsa para eliminar)"})]})}),t.length>1&&jsxRuntimeExports.jsx("button",{type:"button",onClick:w=>{w.stopPropagation(),x(d.id)},className:"text-red-600 hover:text-red-800 p-1",title:"Eliminar bulto",children:jsxRuntimeExports.jsx(Minus,{className:"h-4 w-4"})})]}),P&&jsxRuntimeExports.jsx("div",{className:"mb-3 p-2 bg-red-100 border border-red-300 rounded text-xs text-red-800",children:R.map((w,j)=>jsxRuntimeExports.jsx("div",{children:w},j))}),jsxRuntimeExports.jsxs("div",{className:"space-y-4 flex-1",children:[jsxRuntimeExports.jsxs("div",{className:"flex flex-wrap items-end gap-3",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Peso real (kg)"}),jsxRuntimeExports.jsx("input",{type:"number",value:d.weight,onChange:w=>u(d.id,Number(w.target.value)),min:"0.1",max:"1000",step:"0.1",className:"w-20 px-2 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Peso"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Cantidad"}),jsxRuntimeExports.jsx("input",{type:"number",min:"1",step:"1",value:y,onChange:w=>_(d.id,Number(w.target.value)),className:"w-16 px-2 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Unidades"})]}),jsxRuntimeExports.jsxs("div",{className:"text-xs text-gray-600",children:[jsxRuntimeExports.jsx("span",{className:"block font-medium text-gray-900",children:"Peso facturado"}),jsxRuntimeExports.jsx("span",{className:`text-sm ${d.finalWeight&&d.finalWeight>d.weight?"text-blue-600 font-semibold":"text-gray-900"}`,children:formatWeight(d.finalWeight||d.weight)}),jsxRuntimeExports.jsx("span",{className:"block mt-0.5",children:d.finalWeight&&d.finalWeight>d.weight?"Se aplica peso volumétrico.":"Coincide con el peso real."})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("label",{className:`block text-xs font-medium mb-2 flex items-center ${P?"text-red-700":"text-gray-700"}`,children:[jsxRuntimeExports.jsx(Ruler,{className:`h-4 w-4 mr-1 ${P?"text-red-500":"text-blue-600"}`}),"Medidas (cm)"]}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("span",{className:`w-16 text-xs font-medium ${P?"text-red-600":"text-gray-600"}`,children:"Alto"}),jsxRuntimeExports.jsx("input",{type:"number",value:((F=d.dimensions)==null?void 0:F.height)||10,onChange:w=>{var j,C;return h(d.id,{height:Number(w.target.value),width:((j=d.dimensions)==null?void 0:j.width)||10,length:((C=d.dimensions)==null?void 0:C.length)||10})},min:"1",max:"99999",step:"0.1",className:`w-20 px-2 py-1 text-sm border rounded focus:ring-1 focus:border-transparent ${P?"border-red-400 focus:ring-red-500":"border-gray-300 focus:ring-blue-500"}`,placeholder:"Alto"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("span",{className:`w-16 text-xs font-medium ${P?"text-red-600":"text-gray-600"}`,children:"Ancho"}),jsxRuntimeExports.jsx("input",{type:"number",value:((S=d.dimensions)==null?void 0:S.width)||10,onChange:w=>{var j,C;return h(d.id,{height:((j=d.dimensions)==null?void 0:j.height)||10,width:Number(w.target.value),length:((C=d.dimensions)==null?void 0:C.length)||10})},min:"1",max:"99999",step:"0.1",className:`w-20 px-2 py-1 text-sm border rounded focus:ring-1 focus:border-transparent ${P?"border-red-400 focus:ring-red-500":"border-gray-300 focus:ring-blue-500"}`,placeholder:"Ancho"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("span",{className:`w-16 text-xs font-medium ${P?"text-red-600":"text-gray-600"}`,children:"Largo"}),jsxRuntimeExports.jsx("input",{type:"number",value:((I=d.dimensions)==null?void 0:I.length)||10,onChange:w=>{var j,C;return h(d.id,{height:((j=d.dimensions)==null?void 0:j.height)||10,width:((C=d.dimensions)==null?void 0:C.width)||10,length:Number(w.target.value)})},min:"1",max:"99999",step:"0.1",className:`w-20 px-2 py-1 text-sm border rounded focus:ring-1 focus:border-transparent ${P?"border-red-400 focus:ring-red-500":"border-gray-300 focus:ring-blue-500"}`,placeholder:"Largo"})]})]})]}),d.volumetricWeight&&jsxRuntimeExports.jsx("div",{className:"text-xs text-gray-600 bg-gray-50 border border-gray-200 rounded-lg p-3",children:jsxRuntimeExports.jsxs("div",{className:"flex flex-wrap gap-x-6 gap-y-1",children:[jsxRuntimeExports.jsxs("span",{children:["⚖️ Peso volumétrico: ",formatWeight(d.volumetricWeight)]}),d.dimensions&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("span",{children:["📐 ",formatDimensions(d.dimensions.height,d.dimensions.width,d.dimensions.length)]}),jsxRuntimeExports.jsxs("span",{children:["📦 Volumen: ",formatVolume(d.dimensions.height,d.dimensions.width,d.dimensions.length)]})]})]})})]})]},d.id)})}),jsxRuntimeExports.jsx("div",{className:"pt-4 border-t border-gray-200",children:jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsxs("span",{className:"text-gray-600",children:["Total: ",v," bulto",v>1?"s":""]})}),jsxRuntimeExports.jsxs("div",{className:"space-y-1",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-gray-600",children:"Peso real:"}),jsxRuntimeExports.jsx("span",{className:"font-medium text-gray-900",children:formatWeight(b)})]}),E!==b&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-gray-600",children:"Peso facturado:"}),jsxRuntimeExports.jsx("span",{className:"font-medium text-blue-600",children:formatWeight(E)})]})]})]})}),t.some(d=>d.weight<=0)&&jsxRuntimeExports.jsx("div",{className:"p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-yellow-800",children:"⚠️ Algunos bultos tienen peso inválido. El peso debe ser mayor a 0 kg."})}),t.some(d=>d.weight>30)&&jsxRuntimeExports.jsx("div",{className:"p-3 bg-orange-50 border border-orange-200 rounded-lg",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-orange-800",children:"⚠️ Algunos bultos exceden el peso máximo típico (30 kg). Verifica las tarifas disponibles."})}),t.some(d=>d.volumetricWeight&&d.volumetricWeight>d.weight)&&jsxRuntimeExports.jsx("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-lg",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-blue-800",children:"ℹ️ Se está aplicando peso volumétrico en algunos bultos. El peso facturado será el mayor entre peso real y volumétrico."})})]})]})}function CostBreakdownTable({costBreakdowns:t,marginPercentage:r,packages:e,showCosts:s,showPvp:a,shippingMode:i,additionalPvp:o=0,additionalPvpLabel:c,saturdayActive:x=!1,saturdayPvp:u=0,onProvincialCostChange:h,provincialCostOverride:_=null,onMarginChange:v,planSelected:b=!1,discountSummaryValue:E,discountSummaryDescription:d,highlightedZone:g,isInternationalService:y=!1}){const R=Array.isArray(e)?e:[],P=R.reduce((Q,ge)=>Q+Math.max(1,Math.round(ge.quantity??1)),0),F=R.reduce((Q,ge)=>Q+(ge.finalWeight||ge.weight)*Math.max(1,Math.round(ge.quantity??1)),0),[S,I]=reactExports.useState(7),[w,j]=reactExports.useState(1.5),[C,V]=reactExports.useState(8),[O,H]=reactExports.useState(!0),[z,pe]=reactExports.useState(21),[ee,he]=reactExports.useState(null),re=reactExports.useMemo(()=>{if(!t)return[];const Q=1-r/100,ge=Q>0,Te=O?1+z/100:1,Le=Object.entries(t).map(([Re,Ee])=>{const ze=Ee.status==="calculated",Xe=ze&&ge?Ee.totalCost/Q:0,tt=ze?roundUp$1(Xe):0,qe=ze?roundUp$1(tt*(S/100)):0,dt=ze?roundUp$1(tt*(w/100)):0,Ze=ze?roundUp$1(tt*(C/100)):0,nt=ze?roundUp$1(o):0,ht=ze&&x?roundUp$1(u):0,ft=ze?roundUp$1(tt+qe+dt+Ze+nt+ht):0,pt=ze?roundUp$1(ft*Te):0,Ge=ze?ft-Ee.totalCost:0,Ne=ze?Ge>=0?roundUp$1(Ge):-roundUp$1(Math.abs(Ge)):0;return{zone:Re,breakdown:Ee,basePvp:Number.isFinite(tt)?tt:0,energyCharge:Number.isFinite(qe)?qe:0,climateCharge:Number.isFinite(dt)?dt:0,insuranceCharge:Number.isFinite(Ze)?Ze:0,saturdayCharge:Number.isFinite(ht)?ht:0,pvpSinIva:Number.isFinite(ft)?ft:0,pvpConIva:Number.isFinite(pt)?pt:0,marginAmount:Number.isFinite(Ne)?Ne:0}});if(y){const Re=sortEuropeDestinationsByZone(Le.map(Ee=>Ee.zone),g);Le.sort((Ee,ze)=>Re.indexOf(Ee.zone)-Re.indexOf(ze.zone))}return Le},[t,r,S,w,C,O,z,o,x,u,y,g]),me=x||re.some(Q=>Q.breakdown.status==="calculated"&&Q.breakdown.saturdayCost>0),te=re.some(Q=>Q.breakdown.status==="calculated"&&Q.breakdown.mileageCost>0),ce=re.filter(Q=>Q.breakdown.status==="calculated"&&Q.pvpSinIva>0),ye=ce.map(Q=>Q.pvpSinIva),L=ce.map(Q=>Q.pvpConIva),N=ye.length?Math.min(...ye):0,T=ye.length?Math.max(...ye):0,A=L.length?Math.min(...L):0,D=L.length?Math.max(...L):0,B=ye.length>0,U=O?`PVP CON IVA (${z}%)`:"PVP CON IVA (no aplicado)",Y=Math.min(Math.max(r,0),100),G=`calc(${Y}% - 16px)`,fe="linear-gradient(90deg, #dc2626 0%, #f97316 20%, #facc15 38%, #bbf7d0 40%, #4ade80 75%, #16a34a 100%)",xe=reactExports.useMemo(()=>{const Q=B?jsxRuntimeExports.jsxs("div",{className:"text-xs text-gray-500 space-y-0.5",children:[jsxRuntimeExports.jsxs("p",{children:["PVP sin IVA: ",formatCurrency(N)," - ",formatCurrency(T)]}),O&&jsxRuntimeExports.jsxs("p",{children:["PVP con IVA: ",formatCurrency(A)," - ",formatCurrency(D)]})]}):jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500",children:"Pendiente de datos"}),ge=E??"Sin descuentos aplicados",Te=d!=null?typeof d=="string"?jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500",children:d}):d:jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500",children:"Sin descuentos aplicados"});return[{title:"Total Bultos",value:P,description:jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-500",children:formatWeight(F)}),Icon:Calculator,iconClassName:"text-blue-600"},{title:"Margen Objetivo",value:formatPercentage(r),description:jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-500",children:"Sobre venta"}),Icon:TrendingUp,iconClassName:"text-green-600"},{title:"Zonas Calculadas",value:re.length,description:Q,Icon:Euro,iconClassName:"text-purple-600"},{title:"Descuento Coste Aplicado",value:ge,description:Te,Icon:Percent,iconClassName:"text-orange-500"}]},[re.length,O,B,r,D,T,A,N,P,F,E,d]),Se=Q=>ge=>{const Te=Number(ge.target.value);Q(Number.isNaN(Te)?0:Te)},Ce=Q=>{const ge=Number(Q.target.value);Number.isNaN(ge)||v==null||v(ge)};reactExports.useEffect(()=>{if(!ee)return;re.some(ge=>ge.zone===ee)||he(null)},[re,ee]);const Me=Q=>{const ge=Number(Q.target.value);pe(Number.isNaN(ge)?z:ge)},be=Q=>({maxHeight:Q?"5000px":"0px",opacity:Q?1:0,transform:Q?"translateY(0)":"translateY(-8px)",transition:"max-height 0.6s ease, opacity 0.3s ease, transform 0.3s ease",overflow:"hidden",pointerEvents:Q?"auto":"none"}),ae=(Q,ge)=>{if(ge.status==="not_available")return jsxRuntimeExports.jsx("span",{className:"text-red-600 font-semibold",children:"NO"});if(ge.status==="idle")return jsxRuntimeExports.jsx("span",{className:"text-gray-400",children:"—"});const Te=Number.isFinite(Q)?Q:0,Le=formatCurrency(Math.abs(Te));return Te<0?jsxRuntimeExports.jsxs("span",{className:"text-red-600",children:["-",Le]}):Le},J=(Q,ge,Te)=>{if(Te.status==="not_available")return jsxRuntimeExports.jsx("span",{className:"text-red-600 font-semibold",children:"NO"});if(Te.status==="idle")return jsxRuntimeExports.jsx("span",{className:"text-gray-400",children:"—"});const Le=Number.isFinite(Q)?Q:0,Re=Number.isFinite(ge)?ge:0,Ee=formatCurrency(Math.abs(Re)),ze=Re<0?jsxRuntimeExports.jsxs("span",{className:"text-red-600",children:["-",Ee]}):jsxRuntimeExports.jsx("span",{className:"text-gray-900",children:Ee});return jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-end leading-tight",children:[ze,jsxRuntimeExports.jsx("span",{className:"text-[11px] text-gray-500",children:formatPercentage(Le)})]})},oe=Q=>{const{breakdown:ge,zone:Te}=Q;if(ge.status==="not_available"||ge.status==="idle"||!h||Te!=="Provincial")return ae(ge.initialCost,ge);const Le=b?roundUp$1(Math.max(0,ge.initialCost-ge.linearDiscount)):_??ge.initialCost;if(b||!h)return ae(Le,ge);const Re=Ee=>{const ze=Ee.target.value;if(ze===""){h(null);return}const Xe=Number(ze);h(Number.isNaN(Xe)?null:Xe)};return jsxRuntimeExports.jsx("input",{type:"number",step:"0.01",min:"0",value:Number.isFinite(Le)?Le:0,onChange:Re,className:"w-full max-w-[140px] text-right px-2 py-1 border border-blue-200 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",title:"Si tu provincia tiene un coste especial sustituye el coste inicial calculado en base a peso/medidas para que los cálculos se actualicen."})};return jsxRuntimeExports.jsxs("div",{className:"space-y-8",children:[(s||a)&&jsxRuntimeExports.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:xe.map(({title:Q,value:ge,description:Te,Icon:Le,iconClassName:Re})=>jsxRuntimeExports.jsx("div",{className:"bg-white rounded-lg shadow-md p-5",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-gray-600",children:Q}),jsxRuntimeExports.jsx("p",{className:"text-2xl font-bold text-gray-900",children:ge}),Te]}),jsxRuntimeExports.jsx(Le,{className:`h-8 w-8 ${Re}`})]})},Q))}),jsxRuntimeExports.jsx("div",{style:be(s),"aria-hidden":!s,className:"transition-all",children:s&&jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[jsxRuntimeExports.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex flex-wrap items-center justify-between gap-3",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:y?"Desglose de Costes por Pais de Destino":"Desglose de Costes por Zona de Destino"}),jsxRuntimeExports.jsxs("span",{className:"inline-flex items-center px-3 py-1 text-xs font-semibold uppercase tracking-wide text-blue-700 bg-blue-50 border border-blue-200 rounded-full",children:["Modo: ",SHIPPING_MODE_LABELS[i]]})]}),jsxRuntimeExports.jsx("div",{className:`overflow-x-auto ${y?"max-h-96 overflow-y-auto":""}`,children:jsxRuntimeExports.jsxs("table",{className:"min-w-full table-auto text-sm",children:[jsxRuntimeExports.jsx("thead",{className:`bg-gray-50 ${y?"sticky top-0 z-20":""}`,children:jsxRuntimeExports.jsxs("tr",{children:[jsxRuntimeExports.jsx("th",{className:"px-3 py-2 text-left text-[11px] font-semibold text-gray-500 uppercase tracking-tight leading-snug sticky left-0 bg-gray-50 z-10",children:y?"Pais de Destino":"Zona de Destino"}),jsxRuntimeExports.jsxs("th",{className:"px-3 py-2 text-right text-[11px] font-semibold text-gray-500 uppercase tracking-tight leading-snug",children:["Coste Inicial",jsxRuntimeExports.jsx("br",{}),"calculado en base al peso y medidas indicadas"]}),jsxRuntimeExports.jsxs("th",{className:"px-3 py-2 text-right text-[11px] font-semibold text-gray-500 uppercase tracking-tight leading-snug",children:["Descuento",jsxRuntimeExports.jsx("br",{}),"lineal"]}),jsxRuntimeExports.jsxs("th",{className:"px-3 py-2 text-right text-[11px] font-semibold text-gray-500 uppercase tracking-tight leading-snug",children:["Climate Protect",jsxRuntimeExports.jsx("br",{}),"1,5%"]}),jsxRuntimeExports.jsxs("th",{className:"px-3 py-2 text-right text-[11px] font-semibold text-gray-500 uppercase tracking-tight leading-snug",children:["Canon Red",jsxRuntimeExports.jsx("br",{}),"(Fijo) 0,27€"]}),jsxRuntimeExports.jsxs("th",{className:"px-3 py-2 text-right text-[11px] font-semibold text-gray-500 uppercase tracking-tight leading-snug",children:["Canon Digital",jsxRuntimeExports.jsx("br",{}),"(Fijo) 0,06€"]}),jsxRuntimeExports.jsxs("th",{className:"px-3 py-2 text-right text-[11px] font-semibold text-gray-500 uppercase tracking-tight leading-snug",children:["No Vol.",jsxRuntimeExports.jsx("br",{}),"(FIJO) 0,04€"]}),jsxRuntimeExports.jsxs("th",{className:"px-3 py-2 text-right text-[11px] font-semibold text-gray-500 uppercase tracking-tight leading-snug",children:["Ampl. Cobertura",jsxRuntimeExports.jsx("br",{}),"(1,95%)"]}),jsxRuntimeExports.jsxs("th",{className:"px-3 py-2 text-right text-[11px] font-semibold text-gray-500 uppercase tracking-tight leading-snug",children:["Energía",jsxRuntimeExports.jsx("br",{}),"(7,50%)"]}),jsxRuntimeExports.jsxs("th",{className:"px-3 py-2 text-right text-[11px] font-semibold text-gray-500 uppercase tracking-tight leading-snug",children:["Suplementos",jsxRuntimeExports.jsx("br",{}),"(Variable)"]}),jsxRuntimeExports.jsxs("th",{className:"px-3 py-2 text-right text-[11px] font-semibold text-gray-500 uppercase tracking-tight leading-snug",children:["Irregular",jsxRuntimeExports.jsx("br",{}),"(Variable)"]}),te&&jsxRuntimeExports.jsx("th",{className:"px-3 py-2 text-right text-[11px] font-semibold text-gray-500 uppercase tracking-tight leading-snug",children:"Kilometraje"}),me&&jsxRuntimeExports.jsxs("th",{className:"px-3 py-2 text-right text-[11px] font-semibold text-gray-500 uppercase tracking-tight leading-snug",children:["Ent. Sáb",jsxRuntimeExports.jsx("br",{}),"(Coste)"]}),jsxRuntimeExports.jsx("th",{className:"px-3 py-2 text-right text-[11px] font-semibold text-gray-500 uppercase tracking-tight leading-snug",children:"Total suma de conceptos anteriores"}),jsxRuntimeExports.jsxs("th",{className:"px-3 py-2 text-right text-[11px] font-semibold text-gray-500 uppercase tracking-tight leading-snug",children:["Incr. 2024",jsxRuntimeExports.jsx("br",{}),"(%)"]}),jsxRuntimeExports.jsxs("th",{className:"px-3 py-2 text-right text-[11px] font-semibold text-gray-500 uppercase tracking-tight leading-snug",children:["Incr. 2025",jsxRuntimeExports.jsx("br",{}),"(%)"]}),jsxRuntimeExports.jsxs("th",{className:"px-3 py-2 text-right text-[11px] font-semibold text-gray-500 uppercase tracking-tight leading-snug",children:["Incr. 2026",jsxRuntimeExports.jsx("br",{}),"(%) editable"]}),jsxRuntimeExports.jsxs("th",{className:"px-3 py-2 text-right text-[11px] font-semibold text-gray-500 uppercase tracking-tight leading-snug",children:["SPC en €",jsxRuntimeExports.jsx("br",{}),"(editable)"]}),jsxRuntimeExports.jsxs("th",{className:"px-3 py-2 text-right text-[11px] font-bold text-blue-600 uppercase tracking-tight leading-snug",children:["TOTAL COSTE",jsxRuntimeExports.jsx("br",{}),"(Suma de todo lo anterior)"]})]})}),jsxRuntimeExports.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:re.map(Q=>{var Te;const ge=y&&g===Q.zone;return jsxRuntimeExports.jsxs("tr",{className:`transition-colors ${ge?"bg-blue-50 hover:bg-blue-100":"hover:bg-gray-50"}`,children:[jsxRuntimeExports.jsx("td",{className:`px-3 py-3 whitespace-nowrap text-sm font-medium sticky left-0 z-10 ${ge?"bg-blue-50 text-blue-900 font-bold":"bg-white text-gray-900"}`,children:jsxRuntimeExports.jsxs("span",{className:"flex items-center gap-1.5",children:[y&&EUROPE_ZONE_DATA[Q.zone]&&jsxRuntimeExports.jsx("span",{className:"inline-block w-2.5 h-2.5 rounded-full flex-shrink-0",style:{backgroundColor:EUROPE_ZONE_COLORS[EUROPE_ZONE_DATA[Q.zone].zone]},title:`Zona ${EUROPE_ZONE_DATA[Q.zone].zone}`}),ge&&jsxRuntimeExports.jsx("span",{className:"mr-0.5",children:"*"}),y&&((Te=EUROPE_ZONE_DATA[Q.zone])!=null&&Te.displayName)?EUROPE_ZONE_DATA[Q.zone].displayName:Q.zone]})}),jsxRuntimeExports.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-sm text-gray-900 text-right font-medium",children:oe(Q)}),jsxRuntimeExports.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-sm text-gray-600 text-right",children:ae(-Q.breakdown.linearDiscount,Q.breakdown)}),jsxRuntimeExports.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-sm text-gray-600 text-right",children:ae(Q.breakdown.climateProtect,Q.breakdown)}),jsxRuntimeExports.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-sm text-gray-600 text-right",children:ae(Q.breakdown.canonRed,Q.breakdown)}),jsxRuntimeExports.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-sm text-gray-600 text-right",children:ae(Q.breakdown.canonDigital,Q.breakdown)}),jsxRuntimeExports.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-sm text-gray-600 text-right",children:ae(Q.breakdown.noVol,Q.breakdown)}),jsxRuntimeExports.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-sm text-gray-600 text-right",children:ae(Q.breakdown.amplCobertura,Q.breakdown)}),jsxRuntimeExports.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-sm text-gray-600 text-right",children:ae(Q.breakdown.energia,Q.breakdown)}),jsxRuntimeExports.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-sm text-gray-600 text-right",children:ae(Q.breakdown.suplementos,Q.breakdown)}),jsxRuntimeExports.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-sm text-gray-600 text-right",children:ae(Q.breakdown.irregular,Q.breakdown)}),te&&jsxRuntimeExports.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-sm text-gray-600 text-right",children:ae(Q.breakdown.mileageCost,Q.breakdown)}),me&&jsxRuntimeExports.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-sm text-gray-600 text-right",children:ae(Q.breakdown.saturdayCost,Q.breakdown)}),jsxRuntimeExports.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-sm text-gray-900 text-right font-medium",children:ae(Q.breakdown.subtotal,Q.breakdown)}),jsxRuntimeExports.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-sm text-gray-600 text-right",children:J(Q.breakdown.incr2024Percent,Q.breakdown.incr2024,Q.breakdown)}),jsxRuntimeExports.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-sm text-gray-600 text-right",children:J(Q.breakdown.incr2025Percent,Q.breakdown.incr2025,Q.breakdown)}),jsxRuntimeExports.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-sm text-gray-600 text-right",children:J(Q.breakdown.incr2026Percent,Q.breakdown.incr2026,Q.breakdown)}),jsxRuntimeExports.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-sm text-gray-600 text-right",children:ae(Q.breakdown.spc,Q.breakdown)}),jsxRuntimeExports.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-sm text-blue-600 text-right font-bold",children:ae(Q.breakdown.totalCost,Q.breakdown)})]},Q.zone)})})]})})]})}),jsxRuntimeExports.jsx("div",{style:be(a),"aria-hidden":!a,className:"transition-all",children:a&&jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 space-y-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Análisis Comparativo"}),jsxRuntimeExports.jsxs("span",{className:"text-sm text-gray-500",children:["Zonas evaluadas: ",re.length]})]}),o>0&&jsxRuntimeExports.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg px-4 py-3 text-sm text-red-800 flex items-center justify-between",children:jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"font-semibold uppercase tracking-wide text-xs text-red-700",children:c??"Cargos adicionales"}),jsxRuntimeExports.jsxs("p",{children:["Se añaden ",formatCurrency(o)," al PVP total para este envío."]})]})}),x&&u>0&&jsxRuntimeExports.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg px-4 py-3 text-sm text-blue-800 flex items-center justify-between",children:jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"font-semibold uppercase tracking-wide text-xs text-blue-700",children:"Entrega en sábado"}),jsxRuntimeExports.jsxs("p",{children:["Se añaden ",formatCurrency(u)," al PVP total para cubrir la entrega en sábado."]})]})}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Suplemento de energía (%)"}),jsxRuntimeExports.jsx("input",{type:"number",min:"0",step:"0.1",value:S,onChange:Se(I),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Se aplica sobre el PVP base calculado con el margen."})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Climate Protect (%)"}),jsxRuntimeExports.jsx("input",{type:"number",min:"0",step:"0.1",value:w,onChange:Se(j),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Ajusta el recargo del 1,5% para protección climática."})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Seguro Opcional (%)"}),jsxRuntimeExports.jsx("input",{type:"number",min:"0",step:"0.1",value:C,onChange:Se(V),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Incremento editable para cubrir seguros adicionales."})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-stretch",children:[jsxRuntimeExports.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 md:basis-1/4 md:max-w-[25%]",children:[jsxRuntimeExports.jsx("p",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2",children:"Margen objetivo sobre venta"}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("div",{className:"absolute inset-0 rounded-full pointer-events-none",style:{background:fe}}),jsxRuntimeExports.jsx("input",{type:"range",min:0,max:100,step:.1,value:Y,onChange:Ce,className:"relative w-full appearance-none h-2 rounded-full bg-transparent focus:outline-none","aria-label":"Margen objetivo sobre venta","aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":Number.isFinite(r)?r:0,list:"margin-percentage-ticks"}),jsxRuntimeExports.jsx("div",{className:"absolute -top-7",style:{left:G},children:jsxRuntimeExports.jsx("span",{className:"px-2 py-1 rounded-md bg-gray-900 text-white text-xs shadow",children:formatPercentage(r)})})]}),jsxRuntimeExports.jsx("datalist",{id:"margin-percentage-ticks",children:Array.from({length:21}).map((Q,ge)=>{const Te=ge*5;return jsxRuntimeExports.jsx("option",{value:Te,label:`${Te}%`},Te)})})]}),jsxRuntimeExports.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 flex flex-wrap items-center gap-4 justify-end md:basis-3/4 md:max-w-[75%]",children:[jsxRuntimeExports.jsxs("div",{className:"mr-auto",children:[jsxRuntimeExports.jsx("p",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide",children:"PVP SIN IVA"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600",children:"Los suplementos editables se suman al PVP calculado con el margen seleccionado."})]}),jsxRuntimeExports.jsxs("label",{className:"flex items-center space-x-2 text-sm font-medium text-gray-700",children:[jsxRuntimeExports.jsx("input",{type:"checkbox",className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500",checked:O,onChange:Q=>H(Q.target.checked)}),jsxRuntimeExports.jsx("span",{children:"Aplicar IVA al resultado"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-2",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-gray-600",children:"IVA"}),jsxRuntimeExports.jsxs("select",{value:z,onChange:Me,disabled:!O,className:"px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:text-gray-500",children:[jsxRuntimeExports.jsx("option",{value:21,children:"21%"}),jsxRuntimeExports.jsx("option",{value:0,children:"0%"}),jsxRuntimeExports.jsx("option",{value:4,children:"4%"}),jsxRuntimeExports.jsx("option",{value:7,children:"7%"})]})]}),jsxRuntimeExports.jsx("div",{className:"text-xs text-gray-500",children:O?`Mostrando también PVP con IVA (${z}%).`:"Mostrando únicamente PVP sin IVA."})]})]}),jsxRuntimeExports.jsx("div",{className:`overflow-x-auto ${y?"max-h-96 overflow-y-auto":""}`,children:jsxRuntimeExports.jsxs("table",{className:"min-w-full table-auto text-sm",children:[jsxRuntimeExports.jsx("thead",{className:`bg-gray-50 ${y?"sticky top-0 z-20":""}`,children:jsxRuntimeExports.jsxs("tr",{children:[jsxRuntimeExports.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:y?"Pais de Destino":"Zona de Destino"}),jsxRuntimeExports.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Coste"}),jsxRuntimeExports.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"PVP base"}),jsxRuntimeExports.jsxs("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:["Sup. energia (",formatPercentage(S),")"]}),jsxRuntimeExports.jsxs("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:["Climate Protect (",formatPercentage(w),")"]}),jsxRuntimeExports.jsxs("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:["Seguro Opcional (",formatPercentage(C),")"]}),me&&jsxRuntimeExports.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Ent. Sab"}),jsxRuntimeExports.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Margen (sin IVA)"}),jsxRuntimeExports.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:U})]})}),jsxRuntimeExports.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:re.map(Q=>{var Te;const ge=y&&g===Q.zone;return jsxRuntimeExports.jsxs("tr",{className:`transition-colors cursor-pointer ${ge?"bg-blue-50 hover:bg-blue-100":ee===Q.zone?"bg-green-50 hover:bg-green-100":"hover:bg-gray-50"}`,role:"button",tabIndex:0,onClick:()=>he(Q.zone),onKeyDown:Le=>{(Le.key==="Enter"||Le.key===" ")&&(Le.preventDefault(),he(Q.zone))},children:[jsxRuntimeExports.jsx("td",{className:`px-4 py-3 whitespace-nowrap text-sm font-medium ${ge?"text-blue-900 font-bold":"text-gray-900"}`,children:jsxRuntimeExports.jsxs("span",{className:"flex items-center gap-1.5",children:[y&&EUROPE_ZONE_DATA[Q.zone]&&jsxRuntimeExports.jsx("span",{className:"inline-block w-2.5 h-2.5 rounded-full flex-shrink-0",style:{backgroundColor:EUROPE_ZONE_COLORS[EUROPE_ZONE_DATA[Q.zone].zone]},title:`Zona ${EUROPE_ZONE_DATA[Q.zone].zone}`}),ge&&jsxRuntimeExports.jsx("span",{className:"mr-0.5",children:"*"}),y&&((Te=EUROPE_ZONE_DATA[Q.zone])!=null&&Te.displayName)?EUROPE_ZONE_DATA[Q.zone].displayName:Q.zone]})}),jsxRuntimeExports.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-700 text-right",children:ae(Q.breakdown.totalCost,Q.breakdown)}),jsxRuntimeExports.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-700 text-right",children:ae(Q.basePvp,Q.breakdown)}),jsxRuntimeExports.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-700 text-right",children:ae(Q.energyCharge,Q.breakdown)}),jsxRuntimeExports.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-700 text-right",children:ae(Q.climateCharge,Q.breakdown)}),jsxRuntimeExports.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-700 text-right",children:ae(Q.insuranceCharge,Q.breakdown)}),me&&jsxRuntimeExports.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-700 text-right",children:ae(Q.saturdayCharge,Q.breakdown)}),jsxRuntimeExports.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900 text-right",children:ae(Q.marginAmount,Q.breakdown)}),jsxRuntimeExports.jsx("td",{className:`px-4 py-3 whitespace-nowrap text-sm font-semibold text-right ${O?"text-blue-600":"text-gray-500"}`,children:ae(Q.pvpConIva,Q.breakdown)})]},`${Q.zone}-analysis`)})})]})}),ce.length===0&&jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-500",children:"La tabla de costes se actualizará automáticamente al indicar pesos, medidas y ajustes necesarios."})]})}),!s&&!a&&jsxRuntimeExports.jsx("div",{className:"bg-white border border-dashed border-gray-300 rounded-lg p-6 text-center text-sm text-gray-500",children:"Usa los botones «Ver costes» o «Ver PVP» para desplegar la información."})]})}const INTERNATIONAL_DESTINATIONS=["Alemania","Austria","Belgica","Bulgaria","Chipre","Croacia","Dinamarca","Eslovaquia","Eslovenia","Estonia","Finlandia","Francia","Corcega","Grecia","Hungria","Irlanda","Italia","Letonia","Liechtenstein","Lituania","Luxemburgo","Malta","Monaco","Noruega","Paises Bajos","Polonia","Reino Unido Z1","Reino Unido Z2","Republica Checa","Rumania","San Marino","Serbia","Suecia","Suiza","Vaticano"],DESTINATION_ALIASES={alemania:"Alemania",austria:"Austria",belgica:"Belgica",bulgaria:"Bulgaria",chipre:"Chipre",croacia:"Croacia",dinamarca:"Dinamarca",eslovaquia:"Eslovaquia",eslovenia:"Eslovenia",estonia:"Estonia",finlandia:"Finlandia",francia:"Francia",corcega:"Corcega",grecia:"Grecia",hungria:"Hungria",irlanda:"Irlanda",italia:"Italia",letonia:"Letonia",liechtenstein:"Liechtenstein",lituania:"Lituania",luxemburgo:"Luxemburgo",malta:"Malta",monaco:"Monaco",noruega:"Noruega",paises_bajos:"Paises Bajos",paisesbajos:"Paises Bajos",holanda:"Paises Bajos",polonia:"Polonia",reino_unido_z1:"Reino Unido Z1",reinounidoz1:"Reino Unido Z1",uk_z1:"Reino Unido Z1",reino_unido_z2:"Reino Unido Z2",reinounidoz2:"Reino Unido Z2",uk_z2:"Reino Unido Z2",republica_checa:"Republica Checa",republicacheca:"Republica Checa",chequia:"Republica Checa",rumania:"Rumania",san_marino:"San Marino",sanmarino:"San Marino",serbia:"Serbia",suecia:"Suecia",suiza:"Suiza",vaticano:"Vaticano"},normalizeText=t=>t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/_+/g,"_").replace(/^_|_$/g,"");function normalizeInternationalDestination(t){if(!t)return null;const r=normalizeText(t),e=DESTINATION_ALIASES[r];return e||(INTERNATIONAL_DESTINATIONS.find(a=>normalizeText(a)===r)??null)}function calculateInternationalPvp(t,r,e=1.5,s=0){if(t<=0)return 0;const a=roundUp$1(t*(e/100)),i=roundUp$1(t+a+s),o=r<100?1-r/100:0;if(o<=0)return roundUp$1(i);const c=i/o;return roundUp$1(c)}const formatWeightKey$1=(t,r=!1)=>t==null||r&&t>=999?"null":Number.isInteger(t)?String(t):t.toString();function createInternationalMapKey(t,r,e,s){const a=normalizeText(t),i=normalizeText(r);return`${a}|${i}|${formatWeightKey$1(e,!1)}|${formatWeightKey$1(s,!0)}`}function buildInternationalValueMap(t,r){const e=new Map;if(!Array.isArray(t)||t.length===0)return e;const{marginPercentage:s,climateProtectPercent:a=1.5,spc:i=0}=r;for(const o of t){const c=calculateInternationalPvp(o.cost,s,a,i),x=createInternationalMapKey(o.service_name,o.country,o.weight_from,o.weight_to);e.set(x,c)}return e}const __vite_import_meta_env__$1={},SOP_LOG_ENABLED=typeof import.meta<"u"&&typeof __vite_import_meta_env__$1<"u"&&!1,sopLog$1=(...t)=>{SOP_LOG_ENABLED&&console.log("[SOP]",...t)},SERVICE_NAME_ALIASES$1={"express 8 30":"Urg8:30H Courier","express 830":"Urg8:30H Courier","express8 30":"Urg8:30H Courier","express 10 30":"Urg10H Courier","express 1030":"Urg10H Courier","express10 30":"Urg10H Courier","express 14 00":"Urg14H Courier","express 1400":"Urg14H Courier","express14 00":"Urg14H Courier","express 19 00":"Urg19H Courier","express 1900":"Urg19H Courier","express19 00":"Urg19H Courier","business parcel":"Business Parcel","economy parcel":"Economy Parcel",maritimo:"Marítimo","maritimo maritimo":"Marítimo","parcel shop":"Parcel Shop","eurobusiness parcel":"EuroBusiness Parcel"},FTP_FILE_URL$1="https://www.logicalogistica.com/area-privada/base%20SOP%20FTP.xlsx",BASE_RANGE_ALIASES$1={provincial:"provincial",prov:"provincial",regional:"regional",reg:"regional",nacional:"nacional",nacional_:"nacional",pen:"nacional",peninsula:"nacional",portugal:"portugal",port:"portugal",andorra:"andorra",gibraltar:"gibraltar",canarias_mayores:"canarias_mayores",can_my:"canarias_mayores",canarias_menores:"canarias_menores",can_mn:"canarias_menores",baleares_mayores:"baleares_mayores",bal_my:"baleares_mayores",baleares_menores:"baleares_menores",bal_mn:"baleares_menores",ceuta:"ceuta",melilla:"melilla",madeira_mayores:"madeira_mayores",madeira_mayores_maritimo:"madeira_mayores",madeiramayores:"madeira_mayores",madeiramayoresmaritimo:"madeira_mayores",mad_my:"madeira_mayores",madeira_menores:"madeira_menores",madeira_menores_maritimo:"madeira_menores",madeiramenores:"madeira_menores",madeiramenoresmaritimo:"madeira_menores",mad_mn:"madeira_menores",azores_mayores:"azores_mayores",azores_mayores_maritimo:"azores_mayores",azoresmayores:"azores_mayores",azoresmayoresmaritimo:"azores_mayores",az_my:"azores_mayores",azores_menores:"azores_menores",azores_menores_maritimo:"azores_menores",azoresmenores:"azores_menores",azoresmenoresmaritimo:"azores_menores",az_mn:"azores_menores"},DEFAULT_FORM={clientName:"",agencyNameNumber:"",agencyAddress:"",agencyPostalTown:"",agencyProvince:"",agencyEmail:"",validFrom:"",validTo:"",reimbursementPercent:"",reimbursementMinimum:"",reimbursementFixed:"",reimbursementMax:"",energySurcharge:"7.50",climateProtect:"1.5",optionalInsurance:"8"},createServiceKey$1=t=>t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/[^a-z0-9]+/g," ").trim(),resolveExcelServiceKey$1=t=>{const r=createServiceKey$1(t);if(!r)return null;const s=SERVICE_NAME_ALIASES$1[r]??t;return createServiceKey$1(s)||null},formatWeightKey=t=>t==null?"null":Number.isInteger(t)?String(t):t.toString(),createTariffMapKey=(t,r,e,s)=>`${createServiceKey$1(t)}|${r}|${formatWeightKey(e)}|${formatWeightKey(s)}`;function normalizeRangeName$1(t){if(!t)return null;const r=t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/_+/g,"_").replace(/^_|_$/g,"");let e="sal",s=r;const a=s.match(/_(sal|rec|int)$/);a?(e=a[1],s=s.slice(0,-a[0].length)):/_recogida?/.test(s)||/_rec\b/.test(s)?(e="rec",s=s.replace(/_recogida?/,"").replace(/_rec\b/,"")):/_interciudad/.test(s)||/_inter/.test(s)||/_int$/.test(s)?(e="int",s=s.replace(/_interciudad/,"").replace(/_inter/,"").replace(/_int$/,"")):/_salida/.test(s)&&(e="sal",s=s.replace(/_salida/,"")),s=s.replace(/_+/g,"_").replace(/^_|_$/g,"");const o=[s,s.replace(/_/g," "),s.replace(/_/g,"")].reduce((c,x)=>c||(BASE_RANGE_ALIASES$1[x]??null),null);return o?`${o}_${e}`:null}function parseNumber(t){if(t==null)return null;if(typeof t=="number")return Number.isNaN(t)?null:t;if(typeof t=="object"&&t!==null&&"result"in t){const s=t.result;return parseNumber(s)}const r=String(t).replace(/[^0-9.,-]/g,"").replace(",","."),e=Number(r);return Number.isNaN(e)?null:e}function parseWeightBound(t,r){if(typeof t=="string"){const e=t.toLowerCase();if(e.includes("kg")&&e.includes("adc"))return r==="to"?999:parseNumber(t)??15}return parseNumber(t)}function downloadBuffer(t,r,e){const s=t instanceof ArrayBuffer?new Blob([t],{type:e}):new Blob([t],{type:e}),a=URL.createObjectURL(s),i=document.createElement("a");i.href=a,i.download=r,i.click(),URL.revokeObjectURL(a)}const SOPGenerator=({tariffs:t,marginPercentage:r,discountPlans:e,selectedPlanGroup:s,linearDiscount:a,spc:i,variableSurcharge:o,irregularSurcharge:c,increment2026:x,selectedService:u,provincialCostOverride:h,disabled:_})=>{const{user:v}=useAuth(),{preferences:b}=usePreferences(),E=Array.isArray(t)?t:[],d=reactExports.useMemo(()=>Array.isArray(e)?e:[],[e]),g=_||E.length===0,[y,R]=reactExports.useState(!1),[P,F]=reactExports.useState(DEFAULT_FORM),[S,I]=reactExports.useState(null),[w,j]=reactExports.useState(!1),[C,V]=reactExports.useState(!1),[O,H]=reactExports.useState(null),[z,pe]=reactExports.useState(s),[ee,he]=reactExports.useState(null),[re,me]=reactExports.useState(!1),[te,ce]=reactExports.useState([]),ye=!!O,L=reactExports.useMemo(()=>{const ae=new Map;return d.forEach(J=>{const oe=getPlanGroupKey(J);ae.has(oe)||ae.set(oe,J.plan_name)}),Array.from(ae.entries())},[d]),N=L.some(([ae])=>ae===z)?z:"",T=P.reimbursementFixed.trim()!=="",A=P.reimbursementPercent.trim()!=="";reactExports.useEffect(()=>{if(!y){I(null);return}const ae=async()=>{j(!0),I(null);try{const oe=await fetch(FTP_FILE_URL$1);if(!oe.ok)throw new Error("No se pudo descargar el modelo SOP desde el FTP corporativo.");const Q=await oe.arrayBuffer();H(Q);const ge=new exceljs_minExports.Workbook;if(await ge.xlsx.load(Q),!ge.getWorksheet("General"))throw new Error("La plantilla descargada no contiene la hoja 'General'.")}catch(oe){console.error(oe),I(oe instanceof Error?oe.message:"No se pudo preparar el modelo SOP.")}finally{j(!1)}},J=async()=>{try{const{data:oe,error:Q}=await supabase.from("tariffs_international_europe").select("id, service_name, country, weight_from, weight_to, cost").order("country",{ascending:!0}).order("weight_from",{ascending:!0});if(Q){sopLog$1("international-tariffs:error",Q.message);return}oe&&oe.length>0&&(ce(oe),sopLog$1("international-tariffs:loaded",{count:oe.length}))}catch(oe){sopLog$1("international-tariffs:error",oe instanceof Error?oe.message:"Error desconocido")}};ae(),J()},[y]);const D=()=>{if(!g){if(b){const ae={...DEFAULT_FORM,agencyNameNumber:b.agency_name_number||"",agencyAddress:b.agency_address||"",agencyPostalTown:b.agency_postal_town||"",agencyProvince:b.agency_province||"",agencyEmail:b.agency_email||""},J=!!(b.agency_name_number||b.agency_address||b.agency_postal_town||b.agency_province||b.agency_email);F(ae),me(J)}R(!0)}},B=()=>{R(!1),F(DEFAULT_FORM),H(null),I(null),V(!1),j(!1),pe(s),he(null),me(!1),ce([])};reactExports.useEffect(()=>{if(y){const ae=L.some(([J])=>J===s);pe(ae?s:"")}},[y,s,L]),reactExports.useEffect(()=>{if(!y)return;if(!N){he(null);return}const ae=d.find(J=>getPlanGroupKey(J)===N);if(ae){const J=getCustomPlanMessage(ae.id);he(J??null)}else he(null)},[y,N,d]);const U=(ae,J)=>{F(oe=>({...oe,[ae]:J}))},Y=ae=>{F(J=>({...J,reimbursementPercent:ae,reimbursementFixed:ae.trim()?"":J.reimbursementFixed}))},G=ae=>{F(J=>({...J,reimbursementFixed:ae,reimbursementPercent:ae.trim()?"":J.reimbursementPercent}))},fe=async()=>{if(!O)throw new Error("Descarga del modelo SOP incompleta.");const ae=new exceljs_minExports.Workbook;return await ae.xlsx.load(O.slice(0)),xe(ae),Se(ae),Ce(ae),ae.calcProperties.fullCalcOnLoad=!0,ae},xe=ae=>{sopLog$1("build-table:start",{tariffs:E.length,marginPercentage:r,planGroup:N,linearDiscount:a,spc:i,variableSurcharge:o,irregularSurcharge:c,increment2026:x,selectedService:u,provincialCostOverride:h});const J=buildVirtualTariffTable(E,{marginPercentage:r,planGroup:N,discountPlans:d,linearDiscount:N?0:a,spc:i,variableSurcharge:o,irregularSurcharge:c,increment2026:x,selectedService:u,provincialCostOverride:N?null:h}),oe=new Map;J.forEach(Re=>{const Ee=createTariffMapKey(Re.service_name,Re.zone,Re.weight_from,Re.weight_to??null);oe.set(Ee,Re.pvp)});const Q=parseNumber(P.climateProtect)??1.5,ge=buildInternationalValueMap(te,{marginPercentage:r,climateProtectPercent:Q,spc:i});sopLog$1("international-map:built",{entries:ge.size,climateProtectPercent:Q,spc:i});const Te=ae.getWorksheet("General");if(!Te)throw new Error("La hoja 'General' no está disponible en la plantilla descargada.");const Le=(Re,Ee,ze,Xe,tt,qe)=>{Re.getCell("G").value=Ee;const dt=String(Re.getCell("H").value??"").trim(),Ze=String(Re.getCell("I").value??"").trim();if(dt&&Ze){const nt=ae.getWorksheet(dt);if(nt){const ht=nt.getCell(Ze);ht.value=Ee,sopLog$1("write-target",{service:ze,zone:Xe,weight_from:tt,weight_to:qe,sheet:dt,cell:Ze,value:Ee})}}sopLog$1("write-row",{service:ze,zone:Xe,weight_from:tt,weight_to:qe,value:Ee})};Te.eachRow((Re,Ee)=>{if(Ee===1)return;const ze=Re.getCell("A").value,Xe=Re.getCell("F").value,tt=parseWeightBound(ze,"from"),qe=parseWeightBound(Xe,"to"),dt=String(Re.getCell("C").value??"").trim(),Ze=String(Re.getCell("D").value??"").trim();if(!dt||tt===null){Re.getCell("G").value=null;return}const nt=normalizeRangeName$1(Ze);if(!nt){const Ge=normalizeInternationalDestination(Ze);if(Ge&&ge.size>0){const Ne=createInternationalMapKey(dt,Ge,tt,qe),je=ge.get(Ne);if(typeof je=="number"){const st=Number(je.toFixed(2));Le(Re,st,dt,Ge,tt,qe);return}}Re.getCell("G").value=null;return}const ht=resolveExcelServiceKey$1(dt);if(!ht){Re.getCell("G").value=null;return}const ft=createTariffMapKey(ht,nt,tt,qe),pt=oe.get(ft);if(typeof pt=="number"){const Ge=Number(pt.toFixed(2));Le(Re,Ge,dt,nt,tt,qe)}else Re.getCell("G").value=null,sopLog$1("write-row",{service:dt,zone:nt,weight_from:tt,weight_to:qe,value:null})})},Se=ae=>{sopLog$1("base-exp:start","Iniciando escritura en hoja base exp");const J=ae.getWorksheet("General");if(!J){sopLog$1("base-exp:error","La hoja General no está disponible");return}const oe=ae.getWorksheet("base exp");if(!oe){sopLog$1("base-exp:error","La hoja base exp no existe en el workbook");return}let Q=0,ge=0;J.eachRow((Te,Le)=>{if(Le!==1)try{const Re=Te.getCell("G").value,Ee=String(Te.getCell("J").value??"").trim(),ze=String(Te.getCell("K").value??"").trim(),Xe=String(Te.getCell("L").value??"").trim();if(!Ee||Ee.toLowerCase()!=="base exp")return;const tt=parseNumber(Re);if(tt===null){ge++,sopLog$1("base-exp:skip-row",{row:Le,reason:"Valor PVP no numérico",pvpValue:Re});return}if(!ze||!Xe){ge++,sopLog$1("base-exp:skip-row",{row:Le,reason:"Celdas K o L vacías",cellK:ze,cellL:Xe});return}const qe=Number(tt.toFixed(2)),dt=oe.getCell(ze),Ze=oe.getCell(Xe);dt.value=qe,Ze.value=qe,Q++;const nt=String(Te.getCell("C").value??"").trim(),ht=String(Te.getCell("D").value??"").trim(),ft=Te.getCell("A").value,pt=Te.getCell("F").value;sopLog$1("base-exp:write-success",{row:Le,service:nt,zone:ht,weight_from:ft,weight_to:pt,pvp:qe,cellK:ze,cellL:Xe})}catch(Re){ge++,sopLog$1("base-exp:write-error",{row:Le,error:Re instanceof Error?Re.message:String(Re)})}}),sopLog$1("base-exp:complete",{totalProcessed:Q,totalSkipped:ge})},Ce=ae=>{const J=se=>{const ve=[se];return se.startsWith("_")&&ve.push(se.slice(1)),se.includes("Retun")&&ve.push(se.replace("Retun","Return")),se.includes("(martitimo)")&&(ve.push(se.replace("(martitimo)","(maritimo)")),ve.push(se.replace("(martitimo)","(marítimo)"))),se.includes("(maritimo)")&&ve.push(se.replace("(maritimo)","(marítimo)")),ve.reduce((we,Fe)=>we??ae.getWorksheet(Fe),null)},oe=(se,ve,we)=>{se.forEach(({sheet:Fe,cell:He})=>{const Ue=J(Fe);if(!Ue)return;const at=Ue.getCell(He);if(we!=null&&we.percent){if(ve===null||ve==="")at.value=null;else{const it=typeof ve=="number"?ve:parseNumber(ve);it===null?at.value=null:(at.value=Number((it/100).toFixed(6)),at.numFmt="0.00%")}return}ve===null||ve===""?at.value="":at.value=ve})},Q=new Date().toISOString().slice(0,10),ge=new Date;ge.setMonth(11,31);const Te=ge.toISOString().slice(0,10),Le=P.validFrom||Q,Re=P.validTo||Te,Ee=parseNumber(P.reimbursementPercent),ze=parseNumber(P.reimbursementMinimum),Xe=parseNumber(P.reimbursementMax),tt=parseNumber(P.reimbursementFixed),qe=parseNumber(P.optionalInsurance),dt=parseNumber(P.energySurcharge),Ze=parseNumber(P.climateProtect);oe([{sheet:"Express 8_30",cell:"H7"},{sheet:"Express 10_30",cell:"H7"},{sheet:"Express 14.00",cell:"H7"},{sheet:"Express19.00",cell:"L9"},{sheet:"BusinessParcel",cell:"L9"},{sheet:"BusinessParcel_Tránsito",cell:"H9"},{sheet:"_EconomyParcel",cell:"H9"},{sheet:"_EconomyParcel (martitimo)",cell:"H9"},{sheet:"EconomyParcel (maritimo)",cell:"H9"},{sheet:"ShopDeliveryService & ShopRetun",cell:"H6"},{sheet:"EuroBusinessParcel",cell:"P4"}],P.clientName||""),oe([{sheet:"Express 8_30",cell:"C7"},{sheet:"Express 10_30",cell:"C7"},{sheet:"Express 14.00",cell:"C7"},{sheet:"Express19.00",cell:"D9"},{sheet:"BusinessParcel",cell:"D9"},{sheet:"BusinessParcel_Tránsito",cell:"D9"},{sheet:"_EconomyParcel",cell:"D9"},{sheet:"_EconomyParcel (martitimo)",cell:"D9"},{sheet:"EconomyParcel (maritimo)",cell:"D9"},{sheet:"ShopDeliveryService & ShopRetun",cell:"C6"},{sheet:"EuroBusinessParcel",cell:"F4"}],P.agencyNameNumber||""),oe([{sheet:"Express 8_30",cell:"C8"},{sheet:"Express 10_30",cell:"C8"},{sheet:"Express 14.00",cell:"C8"},{sheet:"Express19.00",cell:"D10"},{sheet:"BusinessParcel",cell:"D10"},{sheet:"BusinessParcel_Tránsito",cell:"D10"},{sheet:"_EconomyParcel",cell:"D10"},{sheet:"_EconomyParcel (martitimo)",cell:"D10"},{sheet:"EconomyParcel (maritimo)",cell:"D10"},{sheet:"ShopDeliveryService & ShopRetun",cell:"C7"},{sheet:"EuroBusinessParcel",cell:"F5"}],Le),oe([{sheet:"Express 8_30",cell:"H8"},{sheet:"Express 10_30",cell:"H8"},{sheet:"Express 14.00",cell:"H8"},{sheet:"Express19.00",cell:"L10"},{sheet:"BusinessParcel",cell:"L10"},{sheet:"BusinessParcel_Tránsito",cell:"H10"},{sheet:"_EconomyParcel",cell:"H10"},{sheet:"_EconomyParcel (martitimo)",cell:"H10"},{sheet:"EconomyParcel (maritimo)",cell:"H10"},{sheet:"ShopDeliveryService & ShopRetun",cell:"H7"},{sheet:"EuroBusinessParcel",cell:"P5"}],Re);const Ge=[{sheet:"Express 8_30",cell:"F38"},{sheet:"Express 10_30",cell:"F39"},{sheet:"Express 14.00",cell:"G46"},{sheet:"Express19.00",cell:"L36"},{sheet:"BusinessParcel",cell:"L39"},{sheet:"_EconomyParcel",cell:"F37"},{sheet:"_EconomyParcel (martitimo)",cell:"G41"},{sheet:"EconomyParcel (maritimo)",cell:"G41"}];sopLog$1("commissionTargets values:",{reimbursementFixed:tt,reimbursementPercent:Ee,valueToWrite:tt!==0?"":Ee!==null?Ee.toFixed(2):"",rawReimbursementPercent:P.reimbursementPercent});const Ne=tt!==0?"":Ee!==null?Ee.toFixed(2):"";oe(Ge,Ne,{percent:!0}),oe([{sheet:"Express 8_30",cell:"G38"},{sheet:"Express 10_30",cell:"G39"},{sheet:"Express 14.00",cell:"H46"},{sheet:"Express19.00",cell:"N36"},{sheet:"BusinessParcel",cell:"N39"},{sheet:"_EconomyParcel",cell:"G37"},{sheet:"_EconomyParcel (martitimo)",cell:"H41"},{sheet:"EconomyParcel (maritimo)",cell:"H41"}],ze!==null?ze.toFixed(2):"",{}),oe([{sheet:"Express 8_30",cell:"H38"},{sheet:"Express 10_30",cell:"H39"},{sheet:"Express 14.00",cell:"I46"},{sheet:"Express19.00",cell:"P36"},{sheet:"BusinessParcel",cell:"P39"},{sheet:"_EconomyParcel",cell:"H37"},{sheet:"_EconomyParcel (martitimo)",cell:"I41"},{sheet:"EconomyParcel (maritimo)",cell:"I41"}],Xe!==null?Xe.toFixed(2):"",{});const ct=[{sheet:"Express 8_30",cell:"I38"},{sheet:"Express 10_30",cell:"I39"},{sheet:"Express 14.00",cell:"J46"},{sheet:"Express19.00",cell:"R36"},{sheet:"BusinessParcel",cell:"R39"},{sheet:"_EconomyParcel",cell:"I37"},{sheet:"_EconomyParcel (martitimo)",cell:"J41"},{sheet:"EconomyParcel (maritimo)",cell:"J41"}];sopLog$1("fixedTargets values:",{reimbursementFixed:tt,reimbursementPercent:Ee,valueToWrite:Ee!==0?"":tt!==null?tt.toFixed(2):"",rawReimbursementFixed:P.reimbursementFixed});const K=Ee!==0?"":tt!==null?tt.toFixed(2):"";oe(ct,K,{}),oe([{sheet:"Express 8_30",cell:"I43"},{sheet:"Express 10_30",cell:"I44"},{sheet:"Express 14.00",cell:"J50"},{sheet:"Express19.00",cell:"R44"},{sheet:"BusinessParcel",cell:"R44"},{sheet:"_EconomyParcel",cell:"I43"},{sheet:"_EconomyParcel (martitimo)",cell:"J43"},{sheet:"EconomyParcel (maritimo)",cell:"J43"}],qe!==null?qe.toFixed(2):"",{percent:!0}),oe([{sheet:"Costes_Adicionales",cell:"G5"}],dt!==null?dt.toFixed(2):null,{percent:!0}),oe([{sheet:"Costes_Adicionales",cell:"G7"}],Ze!==null?Ze.toFixed(2):null,{percent:!0});const Ye=J("cierre personalizado");Ye&&(Ye.getCell("H50").value=P.agencyAddress||"",Ye.getCell("H51").value=P.agencyPostalTown||"",Ye.getCell("H52").value=P.agencyProvince||"",Ye.getCell("H53").value=P.agencyEmail||"");const $e=J("BusinessParcel_Tránsito");if($e){for(let se=18;se<=53;se+=1){const ve=se-16;$e.getCell(`C${se}`).value={formula:`IFERROR(INDEX($N$2:$N$1222, S${ve}), "")`},$e.getCell(`D${se}`).value={formula:`IFERROR(INDEX($O$2:$O$1222, S${ve}), "")`}}$e.getCell("H13").value=P.agencyProvince}const ne=(se,ve,we,Fe)=>{const He=se.getWorksheet(ve);if(!He)throw new Error(`La hoja '${ve}' no está disponible en la plantilla descargada.`);const Ue=He.getCell(we);if(!Ue||!Ue.value||typeof Ue.value!="object"||!Ue.value.formula)throw new Error(`La celda '${we}' en la hoja '${ve}' no contiene una fórmula.`);const at=Ue.value.formula,it=we.match(/\d+/);if(!it)throw new Error(`La referencia de celda de origen '${we}' es inválida.`);const W=parseInt(it[0],10),[le,Z]=Fe.split(":"),ie=le.match(/[A-Z]+/),de=le.match(/\d+/),ue=Z.match(/[A-Z]+/),Pe=Z.match(/\d+/);if(!ie||!de||!ue||!Pe)throw new Error(`Rango '${Fe}' inválido.`);const Be=ie[0].charCodeAt(0),De=ue[0].charCodeAt(0),Oe=parseInt(de[0],10),Ve=parseInt(Pe[0],10),Je=new RegExp(`([A-Z]+)${W}(?!\\$)`,"g");for(let et=Oe;et<=Ve;et++)for(let ut=Be;ut<=De;ut++){const rt=String.fromCharCode(ut)+et,lt=He.getCell(rt),mt=at.replace(Je,`$1${et}`);lt&&(lt.value={formula:mt})}};ne(ae,"BusinessParcel_Tránsito","Q2","Q3:Q1211"),ne(ae,"BusinessParcel_Tránsito","R2","R3:R1211"),ne(ae,"BusinessParcel_Tránsito","S2","S3:S1211")},Me=()=>P.clientName.trim()?P.agencyNameNumber.trim()?(I(null),!0):(I("Debes indicar el nombre y número de agencia."),!1):(I("Debes indicar el nombre del cliente o tarifa."),!1),be=async()=>{if(Me()&&!(typeof window<"u"&&!window.confirm('Se va a proceder a descargar el Soporte de Oferta (SOP) con los datos indicados. RECUERDE que debe revisar el resto de suplementos y costes indicados en las hojas antes de proceder a su impresión y/o envío al cliente, principal atención a las hojas: "Aduanas" y "Costes Adicionales".'))){V(!0),I(null);try{const ae=await fe();ae.worksheets.forEach(ge=>{ge.eachRow({includeEmpty:!0},Te=>{Te.eachCell({includeEmpty:!0},Le=>{let Re=Le.value;if(Re&&typeof Re=="object"){if("formula"in Re)return;"result"in Re&&Re.result!==void 0?Re=Re.result:"text"in Re?Re=Re.text:Re=null}Le.value=Re??null})})});const J=ae.getWorksheet("General");J&&(J.state="hidden",sopLog$1("hide-sheet","Hoja General oculta"));const oe=ae.getWorksheet("base exp");oe&&(oe.state="hidden",sopLog$1("hide-sheet","Hoja base exp oculta"));const Q=await ae.xlsx.writeBuffer();downloadBuffer(Q,`SOP_${Date.now()}.xlsx`,"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"),trackSOPDownload(v==null?void 0:v.id)}catch(ae){console.error(ae),I(ae instanceof Error?ae.message:"No se pudo generar el Excel de SOP.")}finally{V(!1)}}};return jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("button",{type:"button",onClick:D,disabled:g,className:`inline-flex items-center gap-2 px-4 py-2 rounded-lg border text-sm font-semibold transition-colors ${g?"bg-gray-200 text-gray-500 border-gray-200 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white border-blue-600"}`,children:[jsxRuntimeExports.jsx(FileSpreadsheet,{className:"h-4 w-4"}),"Generar SOP"]}),y&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col",children:[jsxRuntimeExports.jsxs("div",{className:"px-6 py-2 border-b border-gray-200 flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Generar documentación SOP"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500",children:"Completa los datos comerciales y descarga el Excel actualizado. El SOP cargará los datos de la pantalla principal (%Margen y demás datos aplicados)"}),jsxRuntimeExports.jsxs("p",{className:"text-xs mt-1 text-gray-500",children:[jsxRuntimeExports.jsx("span",{className:"font-bold text-red-600",children:"¡ATENCIÓN!"})," los datos del panel 'Comparador Comercial' sólo son exportable con Mini-SOP."]})]}),jsxRuntimeExports.jsx("button",{type:"button",onClick:B,className:"text-sm text-gray-500 hover:text-gray-700",children:"Cerrar"})]}),jsxRuntimeExports.jsxs("div",{className:"flex-1 overflow-y-auto px-6 py-4 space-y-6",children:[re&&jsxRuntimeExports.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3 flex items-center gap-2",children:[jsxRuntimeExports.jsx("div",{className:"flex-shrink-0 w-2 h-2 bg-green-500 rounded-full"}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-green-800",children:[jsxRuntimeExports.jsx("strong",{children:"Datos precargados desde tu perfil."})," Puedes editarlos si es necesario."]})]}),w&&jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[jsxRuntimeExports.jsx(Loader2,{className:"h-4 w-4 animate-spin"}),"Descargando plantilla corporativa..."]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end",children:[jsxRuntimeExports.jsx("div",{className:"md:col-span-2",children:jsxRuntimeExports.jsxs("label",{className:"block text-xs font-semibold text-gray-600",children:["Plan comercial aplicable",jsxRuntimeExports.jsxs("select",{value:N,onChange:ae=>pe(ae.target.value),className:"mt-1 w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[jsxRuntimeExports.jsx("option",{value:"",children:"Sin plan"}),L.map(([ae,J])=>jsxRuntimeExports.jsx("option",{value:ae,children:J},ae))]})]})}),ee&&jsxRuntimeExports.jsx("div",{className:"text-xs text-blue-600 md:text-right",children:ee})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsxs("label",{className:"block",children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-semibold text-gray-600",children:"Cliente / Tarifa (obligatorio)"}),jsxRuntimeExports.jsx("input",{type:"text",value:P.clientName,onChange:ae=>U("clientName",ae.target.value),className:"mt-1 w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Nombre del cliente o nombre para la tarifa"})]}),jsxRuntimeExports.jsxs("label",{className:"block",children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-semibold text-gray-600",children:"Nombre y nº de agencia (obligatorio)"}),jsxRuntimeExports.jsx("input",{type:"text",value:P.agencyNameNumber,onChange:ae=>U("agencyNameNumber",ae.target.value),className:"mt-1 w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Datos de tu agencia"})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[jsxRuntimeExports.jsxs("label",{className:"block",children:[jsxRuntimeExports.jsxs("span",{className:"text-xs font-semibold text-gray-600",children:["Validez desde",jsxRuntimeExports.jsx("span",{className:"ml-1 text-gray-400",children:"(en blanco HOY)"})]}),jsxRuntimeExports.jsx("input",{type:"date",value:P.validFrom,onChange:ae=>U("validFrom",ae.target.value),className:"mt-1 w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),jsxRuntimeExports.jsxs("label",{className:"block",children:[jsxRuntimeExports.jsxs("span",{className:"text-xs font-semibold text-gray-600",children:["Validez hasta",jsxRuntimeExports.jsx("span",{className:"ml-1 text-gray-400",children:"(en blanco 31/12/xx)"})]}),jsxRuntimeExports.jsx("input",{type:"date",value:P.validTo,onChange:ae=>U("validTo",ae.target.value),className:"mt-1 w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsxs("label",{className:"block",children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-semibold text-gray-600",children:"Dirección de la agencia"}),jsxRuntimeExports.jsx("input",{type:"text",value:P.agencyAddress,onChange:ae=>U("agencyAddress",ae.target.value),className:"mt-1 w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Calle y número"})]}),jsxRuntimeExports.jsxs("label",{className:"block",children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-semibold text-gray-600",children:"CP & Población"}),jsxRuntimeExports.jsx("input",{type:"text",value:P.agencyPostalTown,onChange:ae=>U("agencyPostalTown",ae.target.value),className:"mt-1 w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"ej: 28540 Valdemoro (Madrid)"})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[jsxRuntimeExports.jsxs("label",{className:"block",children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-semibold text-gray-600",children:"Provincia"}),jsxRuntimeExports.jsx("input",{type:"text",value:P.agencyProvince,onChange:ae=>U("agencyProvince",ae.target.value),className:"mt-1 w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),jsxRuntimeExports.jsxs("label",{className:"block",children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-semibold text-gray-600",children:"Email contacto agencia"}),jsxRuntimeExports.jsx("input",{type:"email",value:P.agencyEmail,onChange:ae=>U("agencyEmail",ae.target.value),className:"mt-1 w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[jsxRuntimeExports.jsxs("label",{className:"block",children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-semibold text-gray-600",children:"Comisión reembolsos (%)"}),jsxRuntimeExports.jsx("input",{type:"number",step:"0.01",value:P.reimbursementPercent,onChange:ae=>Y(ae.target.value),disabled:T,className:`mt-1 w-full border rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent ${T?"bg-gray-100 text-gray-500 cursor-not-allowed border-gray-200":"border-gray-300"}`})]}),jsxRuntimeExports.jsxs("label",{className:"block",children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-semibold text-gray-600",children:"Importe mínimo (€)"}),jsxRuntimeExports.jsx("input",{type:"number",step:"0.01",value:P.reimbursementMinimum,onChange:ae=>U("reimbursementMinimum",ae.target.value),className:"mt-1 w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),jsxRuntimeExports.jsxs("label",{className:"block",children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-semibold text-gray-600",children:"Importe máximo (€)"}),jsxRuntimeExports.jsx("input",{type:"number",step:"0.01",value:P.reimbursementMax,onChange:ae=>U("reimbursementMax",ae.target.value),className:"mt-1 w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[jsxRuntimeExports.jsxs("label",{className:"block",children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-semibold text-gray-600",children:"Importe fijo (€)"}),jsxRuntimeExports.jsx("input",{type:"number",step:"0.01",value:P.reimbursementFixed,onChange:ae=>G(ae.target.value),disabled:A,className:`mt-1 w-full border rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent ${A?"bg-gray-100 text-gray-500 cursor-not-allowed border-gray-200":"border-gray-300"}`})]}),jsxRuntimeExports.jsxs("label",{className:"block",children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-semibold text-gray-600",children:"Suplemento de energía (%)"}),jsxRuntimeExports.jsx("input",{type:"number",step:"0.01",value:P.energySurcharge,onChange:ae=>U("energySurcharge",ae.target.value),className:"mt-1 w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),jsxRuntimeExports.jsxs("label",{className:"block",children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-semibold text-gray-600",children:"Climate Protect (%)"}),jsxRuntimeExports.jsx("input",{type:"number",step:"0.01",value:P.climateProtect,onChange:ae=>U("climateProtect",ae.target.value),className:"mt-1 w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),jsxRuntimeExports.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:jsxRuntimeExports.jsxs("label",{className:"block",children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-semibold text-gray-600",children:"Seguro opcional (%)"}),jsxRuntimeExports.jsx("input",{type:"number",step:"0.01",value:P.optionalInsurance,onChange:ae=>U("optionalInsurance",ae.target.value),className:"mt-1 w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),S&&jsxRuntimeExports.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 text-sm rounded-lg p-3",children:S})]}),jsxRuntimeExports.jsxs("div",{className:"px-6 py-4 border-t border-gray-200 flex items-center justify-between",children:[jsxRuntimeExports.jsx("div",{className:"text-xs text-gray-500",children:"La descarga genera un SOP completo con los datos indicados."}),jsxRuntimeExports.jsxs("button",{type:"button",onClick:be,disabled:!ye||C,className:`inline-flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-semibold transition-colors ${!ye||C?"bg-gray-200 text-gray-500 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white"}`,children:[C?jsxRuntimeExports.jsx(Loader2,{className:"h-4 w-4 animate-spin"}):jsxRuntimeExports.jsx(Download,{className:"h-4 w-4"}),"Descargar Excel"]})]})]})})]})},FTP_FILE_URL="https://www.logicalogistica.com/area-privada/base%20SOP%20FTP.xlsx",SERVICE_NAME_ALIASES={"express 8 30":"Urg8:30H Courier","express 830":"Urg8:30H Courier","express8 30":"Urg8:30H Courier","express 10 30":"Urg10H Courier","express 1030":"Urg10H Courier","express10 30":"Urg10H Courier","express 14 00":"Urg14H Courier","express 1400":"Urg14H Courier","express14 00":"Urg14H Courier","express 19 00":"Urg19H Courier","express 1900":"Urg19H Courier","express19 00":"Urg19H Courier","business parcel":"Business Parcel","economy parcel":"Economy Parcel",maritimo:"Marítimo","maritimo maritimo":"Marítimo","parcel shop":"Parcel Shop","eurobusiness parcel":"EuroBusiness Parcel"},BASE_RANGE_ALIASES={provincial:"provincial",prov:"provincial",regional:"regional",reg:"regional",nacional:"nacional",nacional_:"nacional",pen:"nacional",peninsula:"nacional",portugal:"portugal",port:"portugal",andorra:"andorra",gibraltar:"gibraltar",canarias_mayores:"canarias_mayores",can_my:"canarias_mayores",canarias_menores:"canarias_menores",can_mn:"canarias_menores",baleares_mayores:"baleares_mayores",bal_my:"baleares_mayores",baleares_menores:"baleares_menores",bal_mn:"baleares_menores",ceuta:"ceuta",melilla:"melilla",madeira_mayores:"madeira_mayores",madeira_mayores_maritimo:"madeira_mayores",madeiramayores:"madeira_mayores",madeiramayoresmaritimo:"madeira_mayores",mad_my:"madeira_mayores",madeira_menores:"madeira_menores",madeira_menores_maritimo:"madeira_menores",madeiramenores:"madeira_menores",madeiramenoresmaritimo:"madeira_menores",mad_mn:"madeira_menores",azores_mayores:"azores_mayores",azores_mayores_maritimo:"azores_mayores",azoresmayores:"azores_mayores",azoresmayoresmaritimo:"azores_mayores",az_my:"azores_mayores",azores_menores:"azores_menores",azores_menores_maritimo:"azores_menores",azoresmenores:"azores_menores",azoresmenoresmaritimo:"azores_menores",az_mn:"azores_menores"},createServiceKey=t=>t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/[^a-z0-9]+/g," ").trim(),resolveExcelServiceKey=t=>{const r=createServiceKey(t);if(!r)return null;const s=SERVICE_NAME_ALIASES[r]??t;return createServiceKey(s)||null},normalizeRangeName=t=>{if(!t)return null;const r=t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/_+/g,"_").replace(/^_|_$/g,"");let e="sal",s=r;const a=s.match(/_(sal|rec|int)$/);a?(e=a[1],s=s.slice(0,-a[0].length)):/_recogida?/.test(s)||/_rec\b/.test(s)?(e="rec",s=s.replace(/_recogida?/,"").replace(/_rec\b/,"")):/_interciudad/.test(s)||/_inter/.test(s)||/_int$/.test(s)?(e="int",s=s.replace(/_interciudad/,"").replace(/_inter/,"").replace(/_int$/,"")):/_salida/.test(s)&&(e="sal",s=s.replace(/_salida/,"")),s=s.replace(/_+/g,"_").replace(/^_|_$/g,"");const o=[s,s.replace(/_/g," "),s.replace(/_/g,"")].reduce((c,x)=>c||(BASE_RANGE_ALIASES[x]??null),null);return o?`${o}_${e}`:null},sanitizeFileName=t=>t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9\- ]/gi," ").trim().replace(/\s+/g,"-").toLowerCase(),__vite_import_meta_env__={},COMPARATOR_ZONE_TO_DB={"Prov.":"provincial","Reg.":"regional","Pen.":"nacional","Port.":"portugal","Can.My.":"canarias_mayores","Can.Mn.":"canarias_menores","Bal.My.":"baleares_mayores","Bal.Mn.":"baleares_menores",Ceuta:"ceuta",Melilla:"melilla"},COMPARATOR_COLUMN_TO_WEIGHT={"0 a 1kg":{from:0,to:1},"1 a 3kg":{from:1,to:3},"3 a 5kg":{from:3,to:5},"5 a 10kg":{from:5,to:10},"10 a 15kg":{from:10,to:15},"kg. adc":{from:15,to:999}},SOP_DEBUG_ENABLED=typeof import.meta<"u"&&typeof __vite_import_meta_env__<"u"&&!1,sopLog=(...t)=>{SOP_DEBUG_ENABLED&&console.log("[ComparatorMiniSOP]",...t)},findPriceInOfferTable=(t,r,e,s)=>{for(const[a,i]of Object.entries(COMPARATOR_ZONE_TO_DB)){if(i!==r)continue;const o=t[a];if(o){for(const[c,x]of Object.entries(COMPARATOR_COLUMN_TO_WEIGHT))if(x.from===e&&x.to===s){const u=o[c];if(Number.isFinite(u)&&u>0)return u}}}return null},writeToGeneralSheet=(t,r,e)=>{let s=0;const a=createServiceKey(r);return sopLog("Writing to General sheet for service:",r,"(key:",a,")"),t.eachRow((i,o)=>{if(o===1)return;const c=i.getCell("A").value,x=i.getCell("C").value,u=i.getCell("D").value,h=i.getCell("F").value;if(!x||!u)return;const _=resolveExcelServiceKey(String(x));if(!_||_!==a)return;const v=String(u).trim(),b=normalizeRangeName(v);if(!b){sopLog(`  Row ${o}: Could not resolve zone "${v}"`);return}const E=b.replace(/_(sal|rec|int)$/,""),d=Number(c),g=Number(h);if(!Number.isFinite(d)||!Number.isFinite(g))return;const y=findPriceInOfferTable(e,E,d,g);y!==null&&(i.getCell("G").value=Number(y.toFixed(2)),s++,sopLog(`  Row ${o}: ${b} ${d}-${g} = ${y.toFixed(2)}`))}),sopLog(`Updated ${s} cells in General sheet`),s},copyPricesToServiceSheet=(t,r,e)=>{let s=0;const a=createServiceKey(e);return sopLog("Copying prices to service sheet:",r.name),t.eachRow((i,o)=>{if(o===1)return;const c=i.getCell("C").value;if(!c)return;const x=resolveExcelServiceKey(String(c));if(!x||x!==a)return;const u=i.getCell("G").value,h=i.getCell("H").value,_=i.getCell("I").value;if(!u||!h||!_||typeof u!="number"||u<=0)return;const v=String(h).trim(),b=String(_).trim();if(v.toLowerCase()===r.name.toLowerCase())try{const E=r.getCell(b);E.value=Number(u.toFixed(2)),s++,sopLog(`  Copied ${u.toFixed(2)} to ${b}`)}catch(E){sopLog(`  Error copying to ${b}:`,E)}}),sopLog(`Copied ${s} prices to service sheet`),s},findServiceSheetFromGeneral=(t,r,e)=>{const s=createServiceKey(e),a=new Map;if(sopLog("Finding service sheet from General column H for service:",e),t.eachRow((o,c)=>{if(c===1)return;const x=o.getCell("C").value;if(!x)return;const u=resolveExcelServiceKey(String(x));if(!u||u!==s)return;const h=String(o.getCell("H").value??"").trim();h&&a.set(h,(a.get(h)||0)+1)}),a.size===0)return sopLog("  ✗ No sheet references found in General for this service"),null;const i=Array.from(a.entries()).sort((o,c)=>c[1]-o[1]);sopLog("  Sheet references found:",i);for(const[o,c]of i){const x=r.getWorksheet(o);if(x)return sopLog(`  ✓ Found sheet: "${o}" (${c} references)`),x}return sopLog("  ✗ No matching worksheet found for referenced sheet names"),null},ComparatorMiniSOPGenerator=({serviceName:t,offerTable:r})=>{const{user:e}=useAuth(),[s,a]=reactExports.useState(!1),[i,o]=reactExports.useState(!1),[c,x]=reactExports.useState(null),u=t||"Servicio",h=reactExports.useMemo(()=>{const v=sanitizeFileName(u),b=new Date().toISOString().split("T")[0];return v?`mini-sop-${v}-${b}.xlsx`:`mini-sop-${b}.xlsx`},[u]),_=async()=>{x(null),o(!0);try{sopLog("=== Starting MiniSOP generation ==="),sopLog("Service:",u),sopLog("Offer table:",r),sopLog("Step 1: Downloading template from FTP...");const v=await fetch(FTP_FILE_URL);if(!v.ok)throw new Error(`Failed to download template: ${v.statusText}`);const b=await v.arrayBuffer();sopLog("Step 2: Loading workbook...");const E=new exceljs_minExports.Workbook;await E.xlsx.load(b),sopLog("Step 3: Finding General sheet...");const d=E.getWorksheet("General");if(!d)throw new Error('No se encontró la hoja "General" en el archivo base del FTP');if(sopLog("Step 4: Writing prices to General sheet..."),writeToGeneralSheet(d,u,r)===0)throw new Error("No se pudieron escribir precios en la hoja General. Verifica que el servicio existe en el Excel.");sopLog("Step 5: Finding service-specific sheet from General references...");const y=findServiceSheetFromGeneral(d,E,u);if(!y)throw new Error(`No se encontró la hoja del servicio "${u}" en el Excel. Verifica que la hoja "General" contiene referencias válidas en la columna H para este servicio.`);if(sopLog("Step 6: Copying prices to service sheet..."),copyPricesToServiceSheet(d,y,u)===0)throw new Error('No se pudieron copiar precios a la hoja del servicio. Verifica las referencias en "General".');sopLog("Step 7: Hiding all sheets except the service sheet...");const P=y.name;let F=0;E.worksheets.forEach(C=>{C.name===P?(C.state="visible",sopLog(`  ✓ Keeping visible: "${C.name}"`)):(C.state="hidden",F++,sopLog(`  ○ Hiding: "${C.name}"`))}),sopLog(`  Hidden ${F} sheets, keeping "${P}" visible`),sopLog("Step 8: Setting service sheet as active sheet..."),E.views=[{activeTab:E.worksheets.findIndex(C=>C.name===P)}],sopLog("Step 9: Generating Excel buffer from modified workbook...");const S=await E.xlsx.writeBuffer();sopLog("Step 10: Downloading file...");const I=new Blob([S],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),w=URL.createObjectURL(I),j=document.createElement("a");j.href=w,j.download=h,j.click(),URL.revokeObjectURL(w),trackMiniSOPDownload(e==null?void 0:e.id),sopLog("=== MiniSOP generation complete ==="),a(!1)}catch(v){const b=v instanceof Error?v.message:"Error desconocido al generar MiniSOP";console.error("MiniSOP export failed:",v),x(b)}finally{o(!1)}};return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("button",{type:"button",onClick:()=>a(!0),className:"inline-flex items-center px-3 py-1.5 rounded-md bg-emerald-600 text-white text-xs font-semibold shadow hover:bg-emerald-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-emerald-500",children:[jsxRuntimeExports.jsx(FileSpreadsheet,{className:"h-3.5 w-3.5 mr-1.5"}),"Generar MiniSOP"]}),s&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 px-4",children:jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-lg w-full p-6 space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start justify-between",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Generar MiniSOP del Comparador"}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Se generará un Excel con la hoja del servicio ",jsxRuntimeExports.jsxs("span",{className:"font-semibold",children:["«",u,"»"]})," correspondiente a los precios mostrados."]})]}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>{a(!1),x(null)},className:"text-gray-500 hover:text-gray-700","aria-label":"Cerrar",disabled:i,children:jsxRuntimeExports.jsx(X,{className:"h-5 w-5"})})]}),jsxRuntimeExports.jsxs("div",{className:"rounded-md bg-blue-50 border border-blue-100 px-4 py-3 space-y-2",children:[jsxRuntimeExports.jsx("p",{className:"text-sm text-blue-900",children:jsxRuntimeExports.jsx("strong",{children:"Proceso:"})}),jsxRuntimeExports.jsxs("ol",{className:"text-sm text-blue-900 list-decimal list-inside space-y-1",children:[jsxRuntimeExports.jsx("li",{children:"Se procederá a la creación de una hoja SOP"}),jsxRuntimeExports.jsx("li",{children:'Revisa los precios en el panel "Precios a Ofrecer"'}),jsxRuntimeExports.jsx("li",{children:"El sistema copiará los precios a la hoja específica"}),jsxRuntimeExports.jsx("li",{children:"Se generará un Excel con solo esa hoja"}),jsxRuntimeExports.jsx("li",{children:"Puedes repetir el proceso con otros servicios y unificar después desde Excel para obtener un SOP completamente personalizado servicio a servicio"})]})]}),c&&jsxRuntimeExports.jsxs("div",{className:"rounded-md bg-red-50 border border-red-200 px-4 py-3 flex items-start gap-2",children:[jsxRuntimeExports.jsx(AlertCircle,{className:"h-5 w-5 text-red-600 flex-shrink-0 mt-0.5"}),jsxRuntimeExports.jsxs("div",{className:"text-sm text-red-900",children:[jsxRuntimeExports.jsx("p",{className:"font-semibold",children:"Error al generar MiniSOP:"}),jsxRuntimeExports.jsx("p",{className:"mt-1",children:c})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-end gap-2",children:[jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>{a(!1),x(null)},className:"inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200",disabled:i,children:"Cancelar"}),jsxRuntimeExports.jsx("button",{type:"button",onClick:_,className:"inline-flex items-center px-4 py-2 text-sm font-semibold text-white bg-emerald-600 rounded-md hover:bg-emerald-700 disabled:opacity-50 disabled:cursor-not-allowed",disabled:i,children:i?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"Generando..."]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Download,{className:"h-4 w-4 mr-2"}),"Descargar MiniSOP"]})})]})]})})]})},COMPARATOR_ZONES=["Prov.","Reg.","Pen.","Port.","Can.My.","Can.Mn.","Bal.My.","Bal.Mn.","Ceuta","Melilla"],COMPARATOR_COLUMNS=["0 a 1kg","1 a 3kg","3 a 5kg","5 a 10kg","10 a 15kg","kg. adc"],EDITABLE_BLOCKS=["competition","offer"],buildEditableSequence=()=>EDITABLE_BLOCKS.flatMap(t=>COMPARATOR_ZONES.flatMap(r=>COMPARATOR_COLUMNS.map(e=>({block:t,zone:r,column:e})))),getCellId=(t,r,e)=>`${t}__${r}__${e}`,blockHeaders={competition:{color:"bg-yellow-200",title:"Precios competencia",subtitle:"¡Recuerda! Otro GLS no es tu competencia."},agency:{color:"bg-blue-200",title:"Costes base agencia",subtitle:"Se actualiza según tarifa y plan asociado"},offer:{color:"bg-green-200",title:"Precios a ofrecer"}},PANEL_MARGIN=16,SLIDER_TICKS=Array.from({length:21},(t,r)=>r*5),sliderStyles=`
.comparator-slider {
  -webkit-appearance: none;
  appearance: none;
  width: 100%;
  height: 8px;
  background: transparent;
  cursor: pointer;
}

.comparator-slider:focus {
  outline: none;
}

.comparator-slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  height: 18px;
  width: 18px;
  border-radius: 9999px;
  background: #1d4ed8;
  border: 3px solid #ffffff;
  box-shadow: 0 0 0 1px rgba(29, 78, 216, 0.6);
}

.comparator-slider::-moz-range-thumb {
  height: 18px;
  width: 18px;
  border-radius: 9999px;
  background: #1d4ed8;
  border: 3px solid #ffffff;
  box-shadow: 0 0 0 1px rgba(29, 78, 216, 0.6);
}

.comparator-slider::-webkit-slider-runnable-track,
.comparator-slider::-moz-range-track {
  background: transparent;
}
`,CommercialComparatorPanel=({isOpen:t,onClose:r,tables:e,onValueChange:s,availableServices:a,selectedService:i,onServiceChange:o,discountPlans:c,selectedPlan:x,onPlanChange:u,offerMargin:h,onOfferMarginChange:_,offerAverageMargin:v,onReset:b,onMatchCompetition:E,sopLauncher:d})=>{const g=reactExports.useRef(null),y=reactExports.useRef(null),R=reactExports.useRef({pointerId:null,offsetX:0,offsetY:0}),[P,F]=reactExports.useState({x:PANEL_MARGIN,y:PANEL_MARGIN}),[S,I]=reactExports.useState(!1),[w,j]=reactExports.useState(null),[C,V]=reactExports.useState(""),O=reactExports.useMemo(buildEditableSequence,[]),[H,z]=reactExports.useState(()=>h.toFixed(2)),pe="linear-gradient(90deg, #dc2626 0%, #f97316 20%, #facc15 35%, #bbf7d0 40%, #86efac 70%, #166534 100%)",ee=Math.min(98,Math.max(2,h)),he="w-full rounded-md border px-1.5 py-1 text-right text-[11px] focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition-colors",re=A=>(Number.isFinite(A)?A:0).toLocaleString("es-ES",{minimumFractionDigits:2,maximumFractionDigits:2}),me=A=>{const D=A.trim();if(!D)return 0;const B=D.includes(",")?D.replace(/\./g,"").replace(",","."):D,U=Number.parseFloat(B);return!Number.isFinite(U)||U<0?0:roundUp$1(U)},te=(A,D,B,U)=>{j({block:A,zone:D,column:B}),V(re(U))},ce=()=>{if(!w)return;const{block:A,zone:D,column:B}=w,U=e[A][D][B],Y=me(C);Math.abs(Y-U)>.004&&s(A,D,B,Y),j(null)},ye=(A,D)=>{const B=O.findIndex(fe=>fe.block===A.block&&fe.zone===A.zone&&fe.column===A.column);if(B===-1)return!1;const U=B+D;if(U<0||U>=O.length)return!1;const Y=O[U],G=e[Y.block][Y.zone][Y.column];return te(Y.block,Y.zone,Y.column,G),requestAnimationFrame(()=>{var Se;const fe=`input[data-cell-id="${getCellId(Y.block,Y.zone,Y.column)}"]`,xe=(Se=y.current)==null?void 0:Se.querySelector(fe);xe==null||xe.focus(),xe==null||xe.select()}),!0},L=(A,D,B)=>{const Y=Number.isFinite(D),G=Number.isFinite(B),fe={cellClass:"",inputClass:"border-gray-300 text-gray-900 bg-white"};if(Y&&A<D-.01){const xe=D-A,Se=Math.max(D,1),Ce=Math.min(xe/Se,1);return Ce>.5?{cellClass:"bg-green-300/70",inputClass:"border-green-500 text-green-900 bg-white/70"}:Ce>.2?{cellClass:"bg-green-200/70",inputClass:"border-green-400 text-green-900 bg-white/70"}:{cellClass:"bg-green-100/70",inputClass:"border-green-300 text-green-900 bg-white/70"}}if(G&&A>=(Y?D-.01:A-.01)&&A<=B+.01){const xe=Math.abs(B-A),Se=Math.max(B,1);return Math.min(xe/Se,1)<.05?{cellClass:"bg-yellow-200/60",inputClass:"border-yellow-400 text-yellow-900 bg-white/70"}:{cellClass:"bg-yellow-100/60",inputClass:"border-yellow-300 text-yellow-900 bg-white/70"}}return fe};reactExports.useEffect(()=>{var D;if(!t){j(null),V(""),z(h.toFixed(2));return}const A=B=>{B.key==="Escape"&&r()};return document.addEventListener("keydown",A),(D=g.current)==null||D.focus(),()=>{document.removeEventListener("keydown",A)}},[t,r,h]),reactExports.useEffect(()=>{t&&z(h.toFixed(2))},[t,h]),reactExports.useLayoutEffect(()=>{t&&requestAnimationFrame(()=>{var fe,xe;const{innerWidth:A,innerHeight:D}=window,B=((fe=y.current)==null?void 0:fe.offsetWidth)??0,U=((xe=y.current)==null?void 0:xe.offsetHeight)??0,Y=Math.max((A-B)/2,PANEL_MARGIN),G=Math.max((D-U)/2,PANEL_MARGIN);F({x:Y,y:G})})},[t]),reactExports.useEffect(()=>{if(!S)return;const A=B=>{F(U=>{var Se,Ce;const Y=((Se=y.current)==null?void 0:Se.offsetWidth)??0,G=((Ce=y.current)==null?void 0:Ce.offsetHeight)??0,fe=Math.max(window.innerWidth-Y-PANEL_MARGIN,PANEL_MARGIN),xe=Math.max(window.innerHeight-G-PANEL_MARGIN,PANEL_MARGIN);return{x:Math.min(Math.max(B.clientX-R.current.offsetX,PANEL_MARGIN),fe),y:Math.min(Math.max(B.clientY-R.current.offsetY,PANEL_MARGIN),xe)}})},D=B=>{if(R.current.pointerId!==null&&y.current)try{y.current.releasePointerCapture(R.current.pointerId)}catch{}R.current.pointerId=null,I(!1)};return window.addEventListener("pointermove",A),window.addEventListener("pointerup",D,{once:!0}),()=>{window.removeEventListener("pointermove",A),window.removeEventListener("pointerup",D)}},[S]);const N=A=>{if(y.current){if(A.target instanceof HTMLElement){const D=A.target.closest("button,select,input");if(D&&D!==A.currentTarget)return}R.current={pointerId:A.pointerId,offsetX:A.clientX-P.x,offsetY:A.clientY-P.y};try{y.current.setPointerCapture(A.pointerId)}catch{}I(!0)}},T=A=>{A.target instanceof HTMLElement&&A.target.closest("button,select,input")||N(A)};return t?jsxRuntimeExports.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[jsxRuntimeExports.jsx("style",{children:sliderStyles}),jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-black/40",role:"presentation",onClick:r}),jsxRuntimeExports.jsxs("aside",{ref:y,className:"absolute w-[98vw] max-w-[1400px] bg-white shadow-2xl border border-gray-200 rounded-2xl",style:{left:P.x,top:P.y},"aria-modal":"true",role:"dialog",children:[jsxRuntimeExports.jsx("div",{className:"border-b border-gray-200 px-6 py-4 rounded-t-2xl bg-white",children:jsxRuntimeExports.jsxs("div",{className:"flex flex-col gap-3",onPointerDown:T,children:[jsxRuntimeExports.jsx("div",{className:"flex items-start justify-between gap-3",children:jsxRuntimeExports.jsxs("div",{className:"flex flex-col",children:[jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Comparador comercial"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-500",children:"Introduce y compara precios manuales frente a los costes calculados."})]})}),jsxRuntimeExports.jsxs("div",{className:"grid w-full grid-cols-[auto_auto_auto_minmax(0,1fr)_auto_auto] items-end gap-3",children:[jsxRuntimeExports.jsx("button",{type:"button",ref:g,onClick:r,className:"inline-flex items-center px-3 py-2 text-sm font-medium text-gray-600 bg-gray-100 rounded-md hover:bg-gray-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-blue-500",children:"Cerrar"}),jsxRuntimeExports.jsxs("label",{className:"text-[11px] font-medium text-gray-800 w-44",children:["Servicio a comparar",jsxRuntimeExports.jsx("select",{className:"mt-1 w-full rounded-md border border-gray-300 px-2 py-1 text-sm focus:border-blue-500 focus:ring-1 focus:ring-blue-500",value:i,onChange:A=>o(A.target.value),children:a.map(A=>jsxRuntimeExports.jsx("option",{value:A,children:A},A))})]}),jsxRuntimeExports.jsxs("label",{className:"text-[11px] font-medium text-gray-800 w-48",children:["Plan comercial aplicable",jsxRuntimeExports.jsxs("select",{className:"mt-1 w-full rounded-md border border-gray-300 px-2 py-1 text-sm focus:border-blue-500 focus:ring-1 focus:ring-blue-500",value:x,onChange:A=>u(A.target.value),children:[jsxRuntimeExports.jsx("option",{value:"",children:"Sin plan"}),c.map(A=>jsxRuntimeExports.jsx("option",{value:A.id,children:A.plan_name},A.id))]})]}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col w-full min-w-[18rem]",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between text-[11px] text-gray-800",children:[jsxRuntimeExports.jsx("span",{children:"Margen objetivo sobre venta"}),jsxRuntimeExports.jsxs("span",{className:"font-semibold",children:[h.toFixed(0),"%"]})]}),jsxRuntimeExports.jsxs("div",{className:"relative w-full pt-5",children:[jsxRuntimeExports.jsx("div",{className:"absolute inset-x-0 top-1/2 h-2 -translate-y-1/2 rounded-full",style:{background:pe},"aria-hidden":"true"}),jsxRuntimeExports.jsx("input",{type:"range",min:0,max:100,step:1,value:h,onChange:A=>{const D=Number(A.target.value);_(D),z(D.toFixed(2))},className:"comparator-slider relative z-10 w-full","aria-label":"Margen objetivo sobre venta"}),jsxRuntimeExports.jsx("div",{className:"absolute top-0 flex",style:{left:`${ee}%`,transform:"translateX(-50%) translateY(-90%)"},"aria-hidden":"true",children:jsxRuntimeExports.jsxs("span",{className:"px-2 py-1 text-[10px] font-semibold text-white bg-gray-900 rounded-full shadow",children:[h.toFixed(0),"%"]})})]}),jsxRuntimeExports.jsx("div",{className:"grid text-[9px] text-gray-600",style:{gridTemplateColumns:"repeat(21, minmax(0, 1fr))"},"aria-hidden":"true",children:SLIDER_TICKS.map(A=>jsxRuntimeExports.jsx("span",{className:"text-center",children:A},A))}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between text-[11px] text-gray-800",children:[jsxRuntimeExports.jsx("span",{children:"Margen medio actual"}),jsxRuntimeExports.jsxs("span",{className:"font-semibold",children:[v.toFixed(2),"%"]})]}),jsxRuntimeExports.jsxs("label",{className:"mt-2 text-[11px] font-medium text-gray-800",children:["Margen deseado (%)",jsxRuntimeExports.jsx("input",{type:"text",inputMode:"decimal",pattern:"[0-9.,]*",value:H,onChange:A=>{z(A.target.value)},onBlur:()=>{const A=me(H),D=Math.min(100,Math.max(0,A));_(D),z(D.toFixed(2))},onKeyDown:A=>{if(A.key==="Enter"){A.preventDefault();const D=me(H),B=Math.min(100,Math.max(0,D));_(B),z(B.toFixed(2))}},className:"mt-1 w-full rounded-md border border-gray-300 px-2 py-1 text-sm text-right focus:border-blue-500 focus:ring-1 focus:ring-blue-500"})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex flex-wrap items-center justify-end gap-3 text-[11px] text-gray-600",children:[d,jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>{j(null),V(""),b()},className:"inline-flex items-center px-3 py-2 text-sm font-medium text-blue-600 bg-blue-50 rounded-md hover:bg-blue-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-blue-500",children:"Limpiar"}),jsxRuntimeExports.jsx("span",{className:"max-w-xs text-left",children:"Para reiniciar por completo y perder los cambios, cierre el comparador y pulse «Limpiar datos» en el panel principal."})]})]})]})}),jsxRuntimeExports.jsxs("div",{className:"px-6 py-6 space-y-8 max-h-[82vh] overflow-y-auto",children:[jsxRuntimeExports.jsx("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-6",children:["competition","agency","offer"].map(A=>jsxRuntimeExports.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-xl shadow-sm",children:[jsxRuntimeExports.jsx("div",{className:`${blockHeaders[A].color} px-4 py-3 border-b border-gray-200 rounded-t-xl`,children:jsxRuntimeExports.jsxs("div",{className:"flex items-start justify-between gap-3",children:[jsxRuntimeExports.jsxs("div",{className:"space-y-1.5",children:[jsxRuntimeExports.jsx("h3",{className:"text-sm font-semibold text-gray-900 uppercase tracking-wide",children:blockHeaders[A].title}),jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-700 font-medium",children:blockHeaders[A].subtitle})]}),A==="offer"&&jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("button",{type:"button",onClick:E,className:"inline-flex items-center px-3 py-1.5 rounded-md bg-green-600 text-white text-xs font-semibold shadow hover:bg-green-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-green-500",children:"Ajustar a la competencia"}),jsxRuntimeExports.jsx(ComparatorMiniSOPGenerator,{serviceName:i,offerTable:e.offer})]})]})}),jsxRuntimeExports.jsx("div",{className:"p-4",children:jsxRuntimeExports.jsxs("table",{className:"w-full table-fixed text-[11px]",children:[jsxRuntimeExports.jsx("thead",{children:jsxRuntimeExports.jsxs("tr",{children:[jsxRuntimeExports.jsx("th",{className:"text-left font-semibold text-gray-700 pb-2 pr-2",children:"Zona"}),COMPARATOR_COLUMNS.map(D=>jsxRuntimeExports.jsx("th",{className:"text-center font-semibold text-gray-700 pb-2 px-1",children:D},D))]})}),jsxRuntimeExports.jsx("tbody",{className:"divide-y divide-gray-200",children:COMPARATOR_ZONES.map(D=>jsxRuntimeExports.jsxs("tr",{children:[jsxRuntimeExports.jsx("th",{className:"text-left font-medium text-gray-700 py-2 pr-2",children:D}),COMPARATOR_COLUMNS.map(B=>{const U=e[A][D][B],Y=Number.isFinite(U)?Number(U):0;if(A==="competition")return jsxRuntimeExports.jsx("td",{className:"px-1 py-1.5",children:jsxRuntimeExports.jsx("input",{type:"text",inputMode:"decimal",pattern:"[0-9.,]*","data-cell-id":getCellId(A,D,B),value:w&&w.block===A&&w.zone===D&&w.column===B?C:re(Y),onFocus:Se=>{te(A,D,B,Y),Se.target.select()},onBlur:()=>{ce()},onKeyDown:Se=>{if(Se.key==="Enter"&&(Se.preventDefault(),ce()),Se.key==="Tab"){const Ce={block:A,zone:D,column:B};ce(),ye(Ce,Se.shiftKey?-1:1)&&Se.preventDefault()}},onChange:Se=>{w&&w.block===A&&w.zone===D&&w.column===B||te(A,D,B,Y),V(Se.target.value)},className:`${he} border-gray-300 text-gray-900 bg-white`})},B);if(A==="offer"){const Se=e.competition[D][B],Ce=e.agency[D][B],{cellClass:Me,inputClass:be}=L(Y,Number(Se),Number(Ce));return jsxRuntimeExports.jsx("td",{className:`px-1 py-1.5 text-right text-[11px] ${Me}`,children:jsxRuntimeExports.jsx("input",{type:"text",inputMode:"decimal",pattern:"[0-9.,]*","data-cell-id":getCellId(A,D,B),value:w&&w.block===A&&w.zone===D&&w.column===B?C:re(Y),onFocus:ae=>{te(A,D,B,Y),ae.target.select()},onBlur:()=>{ce()},onKeyDown:ae=>{if(ae.key==="Enter"&&(ae.preventDefault(),ce()),ae.key==="Tab"){const J={block:A,zone:D,column:B};ce(),ye(J,ae.shiftKey?-1:1)&&ae.preventDefault()}},onChange:ae=>{w&&w.block===A&&w.zone===D&&w.column===B||te(A,D,B,Y),V(ae.target.value)},className:`${he} ${be}`})},B)}const G=e.competition[D][B],fe=Y-(Number.isFinite(G)?Number(G):0);let xe="";if(fe>.01){const Se=Number.isFinite(G)?Math.max(Number(G),.01):1,Ce=Math.min(fe/Se,1);Ce>.5?xe=" bg-red-300":Ce>.2?xe=" bg-red-200":xe=" bg-red-100"}return jsxRuntimeExports.jsx("td",{className:`px-1 py-1.5 text-right text-[11px]${xe}`,children:jsxRuntimeExports.jsx("span",{className:"inline-block w-full rounded-md border border-transparent bg-white/60 px-1 py-1 text-right font-semibold text-gray-900",children:Y.toLocaleString("es-ES",{minimumFractionDigits:2,maximumFractionDigits:2})})},B)})]},D))})]})})]},A))}),jsxRuntimeExports.jsxs("div",{className:"mt-4 flex flex-wrap gap-4 text-[11px] text-gray-600",children:[jsxRuntimeExports.jsxs("span",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:"h-3 w-3 rounded bg-yellow-200/60 border border-yellow-400","aria-hidden":"true"}),"Margen igual o inferior al coste."]}),jsxRuntimeExports.jsxs("span",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:"h-3 w-3 rounded bg-green-200/70 border border-green-400","aria-hidden":"true"}),"PVP inferior al precio de la competencia."]}),jsxRuntimeExports.jsxs("span",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:"h-3 w-3 rounded bg-red-200 border border-red-400","aria-hidden":"true"}),"Coste agencia superior a la competencia."]})]})]})]})]}):null},buildEmptyBreakdowns=()=>{const t={};return DESTINATION_ZONES.forEach(r=>{t[r]=createEmptyCostBreakdown()}),t},buildEmptyInternationalBreakdowns=()=>{const t={};return EUROPE_DESTINATIONS.forEach(r=>{t[r]=createEmptyCostBreakdown()}),t},createDefaultPackage=()=>({id:`pkg-${Date.now().toString(36)}`,weight:1,finalWeight:1,quantity:1}),createEmptyComparatorTable=()=>COMPARATOR_ZONES.reduce((t,r)=>(t[r]=COMPARATOR_COLUMNS.reduce((e,s)=>(e[s]=0,e),{}),t),{}),createInitialComparatorState=()=>({competition:createEmptyComparatorTable(),agency:createEmptyComparatorTable(),offer:createEmptyComparatorTable()}),createEmptyComparatorManualFlags=()=>COMPARATOR_ZONES.reduce((t,r)=>(t[r]=COMPARATOR_COLUMNS.reduce((e,s)=>(e[s]=!1,e),{}),t),{}),COMPARATOR_ZONE_TO_DESTINATION={"Prov.":"Provincial","Reg.":"Regional","Pen.":"Nacional","Port.":"Portugal","Can.My.":"Canarias Mayores","Can.Mn.":"Canarias Menores","Bal.My.":"Baleares Mayores","Bal.Mn.":"Baleares Menores",Ceuta:"Ceuta",Melilla:"Melilla"},COMPARATOR_COLUMN_WEIGHTS={"0 a 1kg":1,"1 a 3kg":3,"3 a 5kg":5,"5 a 10kg":10,"10 a 15kg":15,"kg. adc":16},SERVICE_INCREMENT_RULES={"Urg8:30H Courier":{base:9,overrides:{"Canarias Mayores":10,"Canarias Menores":10}},"Urg10H Courier":{base:9,overrides:{"Canarias Mayores":10,"Canarias Menores":10,"Baleares Mayores":10,"Baleares Menores":10}},"Urg14H Courier":{base:9,overrides:{"Canarias Mayores":10,"Canarias Menores":10,"Baleares Mayores":10,"Baleares Menores":10}},"Urg19H Courier":{base:6,overrides:{"Canarias Mayores":10,"Canarias Menores":10,"Baleares Mayores":10,"Baleares Menores":10}},"Economy Parcel":{base:2,overrides:{"Canarias Mayores":4,"Canarias Menores":4,"Baleares Mayores":4,"Baleares Menores":4}},Marítimo:{base:4,overrides:{}},"Business Parcel":{base:0,overrides:{"Canarias Mayores":4,"Canarias Menores":4}},"EuroBusiness Parcel":{base:0,overrides:{}},"Parcel Shop":{base:0,overrides:{}}},EXPRESS_SERVICES=new Set(["Urg8:30H Courier","Urg10H Courier","Urg14H Courier"]),SERVICE_INCREMENT_2025_RULES={"Urg8:30H Courier":{Provincial:5,Regional:5,Nacional:5,Portugal:5,"Baleares Mayores":5,"Baleares Menores":5},"Urg10H Courier":{Provincial:5,Regional:5,Nacional:5,Portugal:5,"Baleares Mayores":5,"Baleares Menores":5},"Urg14H Courier":{Provincial:5,Regional:5,Nacional:5,Portugal:5,"Baleares Mayores":5,"Baleares Menores":5},"Urg19H Courier":{Provincial:3,Regional:3,Nacional:3,Portugal:3,Andorra:3,Gibraltar:3}},UNIVERSAL_2025_OVERRIDES={"Canarias Mayores":3,"Canarias Menores":3,"Baleares Mayores":3,"Baleares Menores":3},ISLAND_ONLY_2025_SERVICES=new Set(["Business Parcel","Economy Parcel","Marítimo","Parcel Shop"]),IRREGULAR_SURCHARGE=7,ZERO_MILEAGE_TOTALS={cost:0,sale:0},computeMileageTotals=(t,r,e,s,a)=>{if(!(s==="Urg10H Courier"||s==="Urg14H Courier"&&a)||!Number.isFinite(t)||t<=0)return ZERO_MILEAGE_TOTALS;const o=Number.isFinite(r)?r:0;return{cost:roundUp$1(t*e),sale:roundUp$1(t*o)}},getServiceIncrementConfig=t=>{const r=SERVICE_INCREMENT_RULES[t];return r?{base:r.base,overrides:r.overrides??{}}:{base:0,overrides:{}}},getZoneIncrement=(t,r)=>{const e=getServiceIncrementConfig(t);return e.overrides[r]??e.base},getZoneIncrement2025=(t,r)=>{const e=SERVICE_INCREMENT_2025_RULES[t],s=(e==null?void 0:e[r])??0;if(t==="EuroBusiness Parcel")return s;const a=UNIVERSAL_2025_OVERRIDES[r]??0;return Math.max(s,a)},getMaxIncrement2025ForService=t=>DESTINATION_ZONES.reduce((r,e)=>Math.max(r,getZoneIncrement2025(t,e)),0),TariffCalculator=()=>{var fs;const{userData:t,signOut:r}=useAuth(),{viewMode:e,setViewMode:s,isAdminView:a}=useViewMode(),[i,o]=reactExports.useState(!1),[c,x]=reactExports.useState(!1),[u,h]=reactExports.useState(!1),[_,v]=reactExports.useState(0),{tariffs:b=[],loading:E=!0}=useTariffs(void 0,!1,!0,_)??{},{discountPlans:d=[]}=useDiscountPlans()??{},{activeStates:g=[],refetch:y}=useCustomTariffsActive(t==null?void 0:t.id)??{},{tariffs:R=[],loading:P=!1}=useInternationalEuropeTariffs()??{},{preferences:F}=usePreferences(),[S,I]=reactExports.useState(STATIC_SERVICES[0]),[w,j]=reactExports.useState(EUROPE_DESTINATIONS[0]),C=isInternationalEuropeService(S),V=reactExports.useMemo(()=>g.some(Qe=>Qe.service_name===S&&Qe.is_active),[g,S]),[O,H]=reactExports.useState(40),[z,pe]=reactExports.useState(""),[ee,he]=reactExports.useState(""),re=reactExports.useRef(null),[me,te]=reactExports.useState(()=>[createDefaultPackage()]),[ce,ye]=reactExports.useState("salida"),[L,N]=reactExports.useState(0),[T,A]=reactExports.useState(0),[D,B]=reactExports.useState(0),[U,Y]=reactExports.useState(0),[G,fe]=reactExports.useState(0),[xe,Se]=reactExports.useState(0),[Ce,Me]=reactExports.useState(0),[be,ae]=reactExports.useState({}),[J,oe]=reactExports.useState(!1),[Q,ge]=reactExports.useState(!1),[Te,Le]=reactExports.useState(0),[Re,Ee]=reactExports.useState(null),[ze,Xe]=reactExports.useState(()=>buildEmptyBreakdowns()),[tt,qe]=reactExports.useState([]),[dt,Ze]=reactExports.useState([]),[nt,ht]=reactExports.useState([]),[ft,pt]=reactExports.useState(!1),[Ge,Ne]=reactExports.useState(!1),[je,st]=reactExports.useState(!1),[ct,K]=reactExports.useState(()=>createInitialComparatorState()),[_e,We]=reactExports.useState(40),[Ke,Ye]=reactExports.useState(()=>createEmptyComparatorManualFlags()),[$e,ne]=reactExports.useState(S),se=reactExports.useRef(!1),[ve,we]=reactExports.useState(!1),{plans:Fe,loadPlans:He}=useCommercialPlans(),[Ue,at]=reactExports.useState(null),it=reactExports.useMemo(()=>Fe.find(Qe=>Qe.id===Ue)||null,[Fe,Ue]),W=reactExports.useMemo(()=>{const Qe=Fe.flatMap(ot=>["Urg8:30H Courier","Urg10H Courier","Urg14H Courier","Urg19H Courier","Business Parcel","Economy Parcel","EuroBusiness Parcel"].map(xt=>({id:`user-plan-${ot.id}-${xt}`,plan_name:ot.plan_name,service_name:xt,discount_type:"custom",discount_value:0,min_volume:0,applies_to:"cost",is_active:!0,created_at:ot.created_at,_userPlanId:ot.id})));return[...d,...CUSTOM_DISCOUNT_PLANS,...Qe]},[d,Fe]),le=reactExports.useMemo(()=>W.filter(Qe=>Qe.service_name===S&&Qe.is_active),[W,S]),Z=reactExports.useMemo(()=>findPlanForServiceGroup(W,ee,S)??null,[W,ee,S]),ie=reactExports.useMemo(()=>{if(!ee)return"";const Qe=W.find(ot=>getPlanGroupKey(ot)===ee);return(Qe==null?void 0:Qe.plan_name)??""},[W,ee]),de=reactExports.useMemo(()=>W.filter(Qe=>Qe.service_name===$e&&Qe.is_active),[W,$e]),ue=reactExports.useMemo(()=>findPlanForServiceGroup(W,ee,$e)??null,[W,ee,$e]),Pe=(ue==null?void 0:ue.id)??"",Be=reactExports.useMemo(()=>getServiceIncrementConfig(S),[S]),De=reactExports.useMemo(()=>getMaxIncrement2025ForService(S),[S]),Oe=reactExports.useMemo(()=>{let Qe=0,ot=!1;me.forEach(xt=>{var gt,It,Ct;const vt=Math.max(1,Math.round(xt.quantity??1));if(vt<=0)return;const bt=((gt=xt.dimensions)==null?void 0:gt.height)??0,yt=((It=xt.dimensions)==null?void 0:It.width)??0,Rt=((Ct=xt.dimensions)==null?void 0:Ct.length)??0,Pt=bt+yt+Rt,Tt=Math.max(bt,yt,Rt),At=xt.weight??0;(Pt>300||Tt>200||At>40)&&(Qe+=vt),Tt>120&&(ot=!0)});const Et=Qe*IRREGULAR_SURCHARGE;return{irregularCount:Qe,autoIrregularCost:Et,hasIrregularPackages:Qe>0,hasNonEncintablePackages:ot}},[me]);reactExports.useEffect(()=>{Y(Oe.autoIrregularCost)},[Oe.autoIrregularCost]);const Ve=reactExports.useMemo(()=>EXPRESS_SERVICES.has(S)&&Oe.hasIrregularPackages,[Oe.hasIrregularPackages,S]),Je=Oe.hasNonEncintablePackages,et=.34,ut=reactExports.useMemo(()=>computeMileageTotals(xe,Ce,et,S,Q),[xe,Ce,et,Q,S]),rt=ut.cost,lt=ut.sale,mt=S==="Urg10H Courier"||S==="Urg14H Courier"&&Q,_t=reactExports.useMemo(()=>{if(E||!$e)return createEmptyComparatorTable();const Qe=b.filter(Tt=>Tt.service_name===$e);if(!Qe.length)return createEmptyComparatorTable();const ot=isParcelShopService($e),Et=ee||it||ot?0:G,xt=$e==="Urg14H Courier"&&Q?2.5:0,bt=!!(Pe?getCustomPlanDefinition(Pe):void 0),yt=getEnergyRateForService($e),Rt=(Tt,At,Ft,gt)=>{if(Tt<=0)return null;const Ct=computeZoneCostForPackage({weight:Tt},$e,At,ce,Qe);if(!Ct.available)return null;const kt=roundUp$1(Ct.cost),Mt=Ct.finalWeight??Tt;let Nt=0;if(ue)if(ue.id.startsWith("user-plan-")){const Vt=ue._userPlanId,Ut=Fe.find(zt=>zt.id===Vt);Ut&&(Nt=calculateCustomPlanDiscount(Qe,Ut,$e,At,Mt,ce))}else(ue.discount_type!=="custom"||bt)&&(Nt=calculatePlanDiscountForWeight(Qe,$e,At,ue,Mt,ce));return calculateCostBreakdown(kt,Ft,gt,L,T,D,U,Et,xt,0,{planDiscountAmount:Nt,energyRate:yt,serviceName:$e})},Pt=createEmptyComparatorTable();return COMPARATOR_ZONES.forEach(Tt=>{const At=COMPARATOR_ZONE_TO_DESTINATION[Tt];if(!At)return;const Ft=getZoneIncrement($e,At),gt=getZoneIncrement2025($e,At);COMPARATOR_COLUMNS.forEach(It=>{let Ct=0;if(It==="kg. adc"){const kt=extractPlusOneCost(Qe,At,ce);if(kt!==null&&kt>0){const Mt=calculatePercentualSupplements(kt,yt,ot);Ct=roundUp$1(kt+Mt.total)}}else{const kt=COMPARATOR_COLUMN_WEIGHTS[It],Mt=Rt(kt,At,Ft,gt);Mt&&(Ct=roundUp$1(Mt.totalCost))}Pt[Tt][It]=Number.isFinite(Ct)?Ct:0})}),Pt},[$e,L,U,G,Q,Pe,ue,ee,ce,T,D,b,E,Fe,it]),St=reactExports.useMemo(()=>({...ct,agency:_t}),[_t,ct]);reactExports.useEffect(()=>{Ye(createEmptyComparatorManualFlags())},[$e,Pe]),reactExports.useEffect(()=>{if(se.current){se.current=!1;return}K(Qe=>{let ot=!1;const Et=COMPARATOR_ZONES.reduce((xt,vt)=>{const bt=Qe.offer[vt];let yt=!1;const Rt={...bt};return COMPARATOR_COLUMNS.forEach(Pt=>{if(Ke[vt][Pt])return;const Tt=_t[vt][Pt],At=Math.max(1-_e/100,.01),Ft=Number.isFinite(Tt)?roundUp$1(Tt/At):0;Math.abs(Rt[Pt]-Ft)>.005&&(Rt[Pt]=Ft,yt=!0)}),yt?(ot=!0,xt[vt]=Rt):xt[vt]=bt,xt},{});return ot?{...Qe,offer:Et}:Qe})},[_t,Ke,_e]);const jt=reactExports.useMemo(()=>{let Qe=0,ot=0;COMPARATOR_ZONES.forEach(xt=>{COMPARATOR_COLUMNS.forEach(vt=>{const bt=_t[xt][vt],yt=ct.offer[xt][vt];if(Number.isFinite(bt)&&Number.isFinite(yt)&&yt>0){const Rt=COMPARATOR_COLUMN_WEIGHTS[vt];Qe+=bt*Rt,ot+=yt*Rt}})});const Et=ot>0?(ot-Qe)/ot*100:0;return{totalCost:Qe,totalOffer:ot,margin:Et}},[_t,ct.offer]),Gt=reactExports.useMemo(()=>{if(Z){if(Z.discount_type==="custom"){let Qe=0,ot=0;me.forEach(xt=>{const vt=Math.max(1,Math.round(xt.quantity??1));if(vt<=0)return;const bt=xt.finalWeight??xt.weight??0,yt=getCustomPlanPercentage(Z.id,S,bt);Qe+=yt*vt,ot+=vt});const Et=ot>0?Qe/ot:0;return{value:Z.plan_name,description:ot>0&&Et>0?`Descuento medio aplicado: ${formatPercentage(Et)}`:"Aplicado según tramo de peso"}}if(Z.discount_type==="percentage")return{value:Z.plan_name,description:`-${formatPercentage(Z.discount_value)} sobre coste base`};if(Z.discount_type==="fixed")return{value:Z.plan_name,description:`-${formatCurrency(Z.discount_value)} por envío`}}if(it){const Qe=getCustomPlanDisplayInfo(it);return{value:Qe.name,description:Qe.description}}return ee?{value:ie||"Plan comercial seleccionado",description:"No aplica descuento directo para este servicio"}:G>0?{value:`-${formatPercentage(G)}`,description:"Descuento lineal sobre coste base"}:{value:"Sin descuentos aplicados",description:void 0}},[it,Z,me,S,G,ee,ie]),Xt=Qe=>Qe.map(ot=>({...ot,finalWeight:ot.finalWeight??ot.weight,quantity:Math.max(1,Math.round(ot.quantity??1))})),Kt=(Qe="")=>jsxRuntimeExports.jsxs("div",{className:`bg-white rounded-lg shadow-md p-4 space-y-3 ${Qe}`,children:[jsxRuntimeExports.jsxs("h3",{className:"text-base font-semibold text-gray-900 flex items-center",children:[jsxRuntimeExports.jsx(Package,{className:"h-4 w-4 mr-2 text-blue-600"}),"Configuración del Envío"]}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[(()=>{const ot=S==="Urg14H Courier",Et=S==="Urg14H Courier"&&Q;return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo de Servicio"}),jsxRuntimeExports.jsx("select",{value:S,onChange:xt=>I(xt.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:STATIC_SERVICES.map(xt=>jsxRuntimeExports.jsx("option",{value:xt,children:xt},xt))})]}),C&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Pais de Destino (Europa)"}),jsxRuntimeExports.jsx("select",{value:w,onChange:xt=>j(xt.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:["A","B","C","D","E","F","G","H"].map(xt=>{const vt=getEuropeDestinationsByZone()[xt];return vt.length===0?null:jsxRuntimeExports.jsx("optgroup",{label:`Zona ${xt}`,children:vt.sort((bt,yt)=>bt.localeCompare(yt,"es")).map(bt=>{var yt;return jsxRuntimeExports.jsx("option",{value:bt,children:((yt=EUROPE_ZONE_DATA[bt])==null?void 0:yt.displayName)||bt},bt)})},xt)})})]}),ot&&jsxRuntimeExports.jsxs("div",{className:"flex flex-col gap-2 rounded-md border border-blue-100 bg-blue-50 px-3 py-2",children:[jsxRuntimeExports.jsxs("label",{className:"inline-flex items-center text-sm font-medium text-blue-900",children:[jsxRuntimeExports.jsx("input",{type:"checkbox",className:"mr-2 h-4 w-4 rounded border-blue-300 text-blue-600 focus:ring-blue-500",checked:Q,onChange:xt=>ge(xt.target.checked)}),"Entrega en sábado disponible"]}),Et&&jsxRuntimeExports.jsxs("div",{className:"pl-6",children:[jsxRuntimeExports.jsx("label",{className:"block text-xs font-semibold text-blue-900 mb-1",children:"PVP entrega sábado (€)"}),jsxRuntimeExports.jsx("input",{type:"number",min:"0",step:"0.01",value:Te,onChange:xt=>Le(Number(xt.target.value)||0),className:"w-full px-3 py-2 border border-blue-200 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"})]})]})]})})(),jsxRuntimeExports.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[jsxRuntimeExports.jsxs("div",{className:"sm:basis-[30%] sm:max-w-[30%]",children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Margen Deseado (%)"}),jsxRuntimeExports.jsx("input",{type:"number",value:O,onChange:ot=>H(Number(ot.target.value)),min:"0",max:"100",step:"0.1",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Margen sobre venta"})]}),jsxRuntimeExports.jsxs("div",{className:"sm:basis-[70%] sm:max-w-[70%]",children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Selección Plan Comercial Aplicable"}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsxs("select",{value:Ue?`user-plan-${Ue}`:(Z==null?void 0:Z.id)||"",onChange:ot=>{const Et=ot.target.value;Et.startsWith("user-plan-")?(at(Et.replace("user-plan-","")),he(""),pe("")):(at(null),hs(Et))},disabled:le.length===0&&Fe.length===0,className:`flex-1 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${le.length===0&&Fe.length===0?"border-gray-200 bg-gray-50 text-gray-500 cursor-not-allowed":"border-gray-300"}`,children:[jsxRuntimeExports.jsx("option",{value:"",children:le.length===0&&Fe.length===0?"Sin planes disponibles":"Sin descuento"}),le.length>0&&jsxRuntimeExports.jsx("optgroup",{label:"Planes del Sistema",children:le.map(ot=>jsxRuntimeExports.jsxs("option",{value:ot.id,children:[ot.plan_name,ot.discount_type!=="custom"?` (-${ot.discount_value}${ot.discount_type==="percentage"?"%":"€"})`:""]},ot.id))}),Fe.length>0&&jsxRuntimeExports.jsx("optgroup",{label:"Planes Personalizados",children:Fe.map(ot=>jsxRuntimeExports.jsxs("option",{value:`user-plan-${ot.id}`,children:[ot.plan_name," (Personalizado)"]},`user-plan-${ot.id}`))})]}),jsxRuntimeExports.jsxs("button",{onClick:()=>we(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2 whitespace-nowrap text-sm font-medium",title:"Gestionar planes comerciales personalizados",children:[jsxRuntimeExports.jsx(Sliders,{size:16}),jsxRuntimeExports.jsx("span",{className:"hidden sm:inline",children:"Gestionar"})]})]})]})]})]})]}),Ht=(Qe="")=>{const ot=Be.overrides["Canarias Mayores"]??Be.base,Et=Be.overrides["Canarias Menores"]??Be.base,xt=Be.overrides["Baleares Mayores"]??Be.base,vt=Be.overrides["Baleares Menores"]??Be.base,bt=ot!==Be.base||Et!==Be.base,yt=xt!==Be.base||vt!==Be.base,Rt=ISLAND_ONLY_2025_SERVICES.has(S),Pt=Rt?0:De,Tt=UNIVERSAL_2025_OVERRIDES["Canarias Mayores"],At=UNIVERSAL_2025_OVERRIDES["Baleares Mayores"],Ft=!!ee;return jsxRuntimeExports.jsxs("div",{className:`bg-white rounded-lg shadow-md p-4 ${Qe}`,children:[jsxRuntimeExports.jsx("h3",{className:"text-base font-semibold text-gray-900 mb-3",children:"Ajustes de Coste"}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-xs font-semibold text-gray-700 mb-1 uppercase tracking-wide",children:"Incr. 2024 (%)"}),jsxRuntimeExports.jsx("input",{type:"text",readOnly:!0,value:`${Be.base.toFixed(2)} %`,className:"w-full px-2 py-1.5 border border-gray-200 rounded-md bg-gray-50 text-sm font-semibold text-gray-900"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-xs font-semibold text-gray-700 mb-1 uppercase tracking-wide",children:"Incr. 2025 (%)"}),jsxRuntimeExports.jsx("input",{type:"text",readOnly:!0,value:`${Pt.toFixed(2)} %`,className:"w-full px-2 py-1.5 border border-gray-200 rounded-md bg-gray-50 text-sm font-semibold text-gray-900"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-xs font-semibold text-gray-700 mb-1 uppercase tracking-wide",children:"Incr. 2026 (%)"}),jsxRuntimeExports.jsx("input",{type:"number",value:L,onChange:gt=>N(Number(gt.target.value)),step:"0.1",className:"w-full px-2 py-1.5 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-xs font-semibold text-gray-700 mb-1 uppercase tracking-wide",children:"SPC (€)"}),jsxRuntimeExports.jsx("input",{type:"number",value:T,onChange:gt=>A(Number(gt.target.value)),step:"0.01",className:"w-full px-2 py-1.5 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-xs font-semibold text-gray-700 mb-1 uppercase tracking-wide",children:"Otros (€)"}),jsxRuntimeExports.jsx("input",{type:"number",value:D,onChange:gt=>B(Number(gt.target.value)),step:"0.01",className:"w-full px-2 py-1.5 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Costes adicionales: cajas, bolsas, etiquetas,..."})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-xs font-semibold text-gray-700 mb-1 uppercase tracking-wide",children:"Irregular (€)"}),jsxRuntimeExports.jsx("input",{type:"text",readOnly:!0,value:formatCurrency(U),className:"w-full px-2 py-1.5 border border-gray-200 rounded-md bg-gray-50 text-sm font-semibold text-gray-900"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Se aplica automáticamente 7 € por cada bulto irregular detectado."})]}),jsxRuntimeExports.jsxs("div",{className:"col-span-2 sm:col-span-1",children:[jsxRuntimeExports.jsx("label",{className:"block text-xs font-semibold text-gray-700 mb-1 uppercase tracking-wide",children:"Descuento lineal (%)"}),jsxRuntimeExports.jsx("input",{type:"number",value:Ft?0:G,onChange:gt=>fe(Number(gt.target.value)),min:"0",step:"0.1",disabled:Ft,className:`w-full px-2 py-1.5 border rounded-md text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent ${Ft?"border-gray-200 bg-gray-50 text-gray-400 cursor-not-allowed":"border-gray-300"}`}),jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500 mt-1",children:Ft?"Los planes comerciales desactivan el descuento lineal manual.":"Se resta al coste inicial antes de recargos e incrementos."})]}),bt&&jsxRuntimeExports.jsxs("div",{className:"col-span-2 sm:col-span-1",children:[jsxRuntimeExports.jsx("label",{className:"block text-xs font-semibold text-gray-700 mb-1 uppercase tracking-wide",children:"Canarias (Incr. 2024)"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700",children:[jsxRuntimeExports.jsxs("span",{className:"flex-1 px-2 py-1 border border-gray-200 rounded-md bg-gray-50",children:["Mayores: ",ot.toFixed(2),"%"]}),jsxRuntimeExports.jsxs("span",{className:"flex-1 px-2 py-1 border border-gray-200 rounded-md bg-gray-50",children:["Menores: ",Et.toFixed(2),"%"]})]})]}),yt&&jsxRuntimeExports.jsxs("div",{className:"col-span-2 sm:col-span-1",children:[jsxRuntimeExports.jsx("label",{className:"block text-xs font-semibold text-gray-700 mb-1 uppercase tracking-wide",children:"Baleares (Incr. 2024)"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700",children:[jsxRuntimeExports.jsxs("span",{className:"flex-1 px-2 py-1 border border-gray-200 rounded-md bg-gray-50",children:["Mayores: ",xt.toFixed(2),"%"]}),jsxRuntimeExports.jsxs("span",{className:"flex-1 px-2 py-1 border border-gray-200 rounded-md bg-gray-50",children:["Menores: ",vt.toFixed(2),"%"]})]})]}),Rt&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:"col-span-2 sm:col-span-1",children:[jsxRuntimeExports.jsx("label",{className:"block text-xs font-semibold text-gray-700 mb-1 uppercase tracking-wide",children:"Canarias (Incr. 2025)"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700",children:[jsxRuntimeExports.jsxs("span",{className:"flex-1 px-2 py-1 border border-gray-200 rounded-md bg-gray-50",children:["Mayores: ",Tt.toFixed(2),"%"]}),jsxRuntimeExports.jsxs("span",{className:"flex-1 px-2 py-1 border border-gray-200 rounded-md bg-gray-50",children:["Menores: ",Tt.toFixed(2),"%"]})]})]}),jsxRuntimeExports.jsxs("div",{className:"col-span-2 sm:col-span-1",children:[jsxRuntimeExports.jsx("label",{className:"block text-xs font-semibold text-gray-700 mb-1 uppercase tracking-wide",children:"Baleares (Incr. 2025)"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700",children:[jsxRuntimeExports.jsxs("span",{className:"flex-1 px-2 py-1 border border-gray-200 rounded-md bg-gray-50",children:["Mayores: ",At.toFixed(2),"%"]}),jsxRuntimeExports.jsxs("span",{className:"flex-1 px-2 py-1 border border-gray-200 rounded-md bg-gray-50",children:["Menores: ",At.toFixed(2),"%"]})]})]})]})]})]})},ir=Qe=>{te(Xt(Qe)),trackPackageCalculation(t==null?void 0:t.id)},Bt=Qe=>{if(Qe===null||Number.isNaN(Qe)){Ee(null);return}Ee(Math.max(0,Qe))},Zs=()=>{te(Qe=>{if(Qe.length===0)return[createDefaultPackage()];const[ot]=Xt(Qe);return[ot]})},Js=()=>{I(STATIC_SERVICES[0]),H(40),pe(""),he(""),ye("salida"),N(0),A(0),B(0),Y(0),fe(0),Se(0),Me(0),ae({}),te([createDefaultPackage()]),Xe(buildEmptyBreakdowns()),qe([]),Ze([]),pt(!1),Ne(!1),ge(!1),Le(0),Ee(null),K(createInitialComparatorState()),Ye(createEmptyComparatorManualFlags()),We(40),ne(STATIC_SERVICES[0])},Qs=()=>{pt(Qe=>!Qe)},qs=()=>{Ne(Qe=>!Qe)},en=(Qe,ot,Et,xt)=>{if(Qe==="agency")return;const vt=Number.isFinite(xt)?Math.max(0,xt):0;Qe==="offer"&&Ye(bt=>({...bt,[ot]:{...bt[ot],[Et]:!0}})),K(bt=>({...bt,[Qe]:{...bt[Qe],[ot]:{...bt[Qe][ot],[Et]:vt}}}))},tn=Qe=>{const ot=Math.min(100,Math.max(0,Qe));We(ot)},rn=()=>{K(createInitialComparatorState()),Ye(createEmptyComparatorManualFlags()),We(40)},sn=()=>{let Qe=!1;COMPARATOR_ZONES.forEach(yt=>{COMPARATOR_COLUMNS.forEach(Rt=>{const Pt=ct.competition[yt][Rt];(!Number.isFinite(Pt)||Pt<=0)&&(Qe=!0)})});let ot=!0;Qe&&(ot=window.confirm('Existen celdas sin precio en "Precios competencia". Pulsa Aceptar para rellenarlas con el coste base calculado o Cancelar para dejarlas a 0,00.'));const Et=createEmptyComparatorTable();let xt=0,vt=0;COMPARATOR_ZONES.forEach(yt=>{COMPARATOR_COLUMNS.forEach(Rt=>{const Pt=_t[yt][Rt],Tt=ct.competition[yt][Rt],At=Number.isFinite(Pt)?Pt:0,Ft=Number.isFinite(Tt)?Tt:0;let gt=Ft;if(Ft<=0&&(gt=ot?At:0),At>0&&gt>0&&gt<At&&(gt=At),gt>0){const It=roundUp$1(gt);if(Et[yt][Rt]=It,At>0){const Ct=COMPARATOR_COLUMN_WEIGHTS[Rt];xt+=At*Ct,vt+=It*Ct}}else Et[yt][Rt]=0})}),K(yt=>({...yt,offer:Et})),Ye(createEmptyComparatorManualFlags());const bt=vt>0?(vt-xt)/vt*100:0;se.current=!0,We(Math.min(100,Math.max(0,bt)))},hs=reactExports.useCallback(Qe=>{if(!Qe){he(""),pe("");return}const ot=W.find(Et=>Et.id===Qe);if(!ot){he(""),pe("");return}he(getPlanGroupKey(ot)),pe(ot.id)},[W]),nn=()=>{typeof window<"u"&&window.scrollTo({top:0,behavior:"smooth"})},an=()=>{ae(Qe=>({...Qe,[S]:!0})),oe(!1)},on=async()=>{await r(),x(!1)},ln=()=>{s(e==="admin"?"user":"admin"),x(!1)},cn=async()=>{if(t)try{if(!V){const{data:ot}=await supabase.from("custom_tariffs").select("id").eq("user_id",t.id).eq("service_name",S).limit(1);if(!ot||ot.length===0){window.alert(`No tienes una tabla de costes personalizada creada para este servicio.

Para crear tu tabla personalizada ve a:
Usuario → Configuración → Tarifas Personalizadas`);return}}const Qe=g.find(ot=>ot.service_name===S);Qe?await supabase.from("custom_tariffs_active").update({is_active:!Qe.is_active}).eq("id",Qe.id):await supabase.from("custom_tariffs_active").insert([{user_id:t.id,service_name:S,is_active:!0}]),await y(),v(ot=>ot+1)}catch(Qe){console.error("Error toggling custom tariff state:",Qe),window.alert("Error al cambiar el estado de la tabla personalizada")}},xr=(t==null?void 0:t.is_admin)||!1;return reactExports.useEffect(()=>{if(!ee){z!==""&&pe("");return}Z?Z.id!==z&&pe(Z.id):z!==""&&pe("")},[Z,ee,z]),reactExports.useEffect(()=>{if(!z){re.current=null;return}const Qe=getCustomPlanMessage(z);Qe&&re.current!==z&&(window.alert(Qe),re.current=z)},[z]),reactExports.useEffect(()=>{Z&&Ee(null)},[Z]),reactExports.useEffect(()=>{ee&&fe(0)},[ee]),reactExports.useEffect(()=>{Ue&&(fe(0),he(""),pe(""))},[Ue]),reactExports.useEffect(()=>{S!=="Urg14H Courier"&&ge(!1)},[S]),reactExports.useEffect(()=>{ne(S)},[S]),reactExports.useEffect(()=>{(!Q||S!=="Urg14H Courier")&&Le(0)},[Q,S]),reactExports.useEffect(()=>{const Qe=mt&&!be[S];oe(!!Qe)},[be,Q,S,mt]),reactExports.useEffect(()=>{if(E||C&&P){Xe(buildEmptyBreakdowns()),qe([]),Ze([]);return}if(!S){Xe(buildEmptyBreakdowns()),qe([]),Ze([]);return}if(!me.some(gt=>(gt.finalWeight??gt.weight)>0)){Xe(buildEmptyBreakdowns()),qe([]),Ze([]);return}if(C){const gt=buildEmptyInternationalBreakdowns(),It=[],Ct=[],kt=[],Mt=w;me.forEach((Nt,Yt)=>{var Wt,Ot,Dt;const Vt=((Wt=Nt.dimensions)==null?void 0:Wt.height)??0,Ut=((Ot=Nt.dimensions)==null?void 0:Ot.width)??0,zt=((Dt=Nt.dimensions)==null?void 0:Dt.length)??0,qt=Nt.finalWeight??Nt.weight??0,Zt=validateInternationalEuropePackage(Vt,Ut,zt,qt,Mt);Zt.valid||kt.push({packageId:Nt.id,errors:Zt.errors.map(er=>`Bulto ${Yt+1}: ${er}`)})}),ht(kt),EUROPE_DESTINATIONS.forEach(Nt=>{var qt,Zt,Wt;let Yt=0,Vt=0,Ut=!1,zt=!1;for(const Ot of me){const Dt=Math.max(1,Math.round(Ot.quantity??1)),er=Ot.finalWeight??Ot.weight??0,or=((qt=Ot.dimensions)==null?void 0:qt.height)??0,Jt=((Zt=Ot.dimensions)==null?void 0:Zt.width)??0,un=((Wt=Ot.dimensions)==null?void 0:Wt.length)??0;if(!validateInternationalEuropePackage(or,Jt,un,er,Nt).valid){Ut=!0;break}const ps=calculateInternationalEuropeCost(R,Nt,er);if(ps===null){zt=!0;break}Yt+=ps*Dt,Vt+=Dt}if(Ut){gt[Nt]=createEmptyCostBreakdown("not_available"),Ct.push(Nt);return}if(zt){gt[Nt]=createEmptyCostBreakdown("not_available"),It.push(Nt);return}gt[Nt]=calculateInternationalEuropeCostBreakdown(Yt,T,D,U,ce,Vt)}),Xe(gt),qe(It),Ze(Ct);return}else ht([]);const ot=buildEmptyBreakdowns(),Et=new Set,xt=new Set,vt=b.filter(gt=>gt.service_name===S),bt=!!Z||!!it,yt=isParcelShopService(S),Rt=bt||yt?0:G,Pt=Q&&S==="Urg14H Courier",Tt=Pt?2.5:0,At=rt>0?rt:0,Ft=getEnergyRateForService(S);DESTINATION_ZONES.forEach(gt=>{let It=0,Ct=0,kt="idle",Mt=vt.length===0,Nt=!1;const Yt=getZoneIncrement(S,gt),Vt=getZoneIncrement2025(S,gt);let Ut=!0;for(const Wt of me){if(!Ut)continue;const Ot=Math.max(1,Math.round(Wt.quantity??1));if(Ot<=0)continue;const Dt=computeZoneCostForPackage(Wt,S,gt,ce,vt);if(!Dt.available){kt="not_available",Dt.reason==="missing_tariff"&&(Mt=!0),Dt.reason==="restriction"&&(Nt=!0),Ut=!1;continue}kt="calculated";const er=roundUp$1(Dt.cost);if(It+=er*Ot,it){const or=Dt.finalWeight??Wt.weight??0,Jt=calculateCustomPlanDiscount(vt,it,S,gt,or,ce);Jt>0&&(Ct+=Jt*Ot)}else if(Z){const or=Dt.finalWeight??Wt.weight??0,Jt=calculatePlanDiscountForWeight(vt,S,gt,Z,or,ce);Jt>0&&(Ct+=Jt*Ot)}}if(kt==="not_available"||Mt){ot[gt]=createEmptyCostBreakdown("not_available"),Mt&&Et.add(gt),Nt&&xt.add(gt);return}if(kt==="idle"){ot[gt]=createEmptyCostBreakdown("idle");return}const zt=gt==="Provincial"&&Re!==null&&!z?Re:null,qt=zt!==null?0:Rt,Zt=Z||it?Ct:0;ot[gt]=calculateCostBreakdown(It,Yt,Vt,L,T,D,U,qt,Pt?Tt:0,At,{planDiscountAmount:Zt,energyRate:Ft,baseOverride:zt,serviceName:S})}),Xe(ot),qe(Array.from(Et).sort()),Ze(Array.from(xt).sort())},[b,E,S,me,L,T,D,U,ce,Z,G,Q,Re,rt,C,P,R,w]),reactExports.useEffect(()=>{F&&(F.fixed_spc_value!==null&&F.fixed_spc_value!==void 0&&A(F.fixed_spc_value),F.fixed_discount_percentage!==null&&F.fixed_discount_percentage!==void 0&&F.fixed_discount_percentage>0&&fe(F.fixed_discount_percentage))},[F]),reactExports.useEffect(()=>{const Qe=!ee&&!Ue,ot=(F==null?void 0:F.fixed_discount_percentage)&&F.fixed_discount_percentage>0;Qe&&ot&&G===0&&fe(F.fixed_discount_percentage)},[ee,Ue,F,G]),jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-gray-50",children:[jsxRuntimeExports.jsx("header",{className:"bg-white shadow-sm border-b border-gray-200 sticky top-0 z-40",children:jsxRuntimeExports.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-3",children:[jsxRuntimeExports.jsx(Calculator,{className:"h-8 w-8 text-blue-600"}),jsxRuntimeExports.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Calculadora de Tarifas"}),xr&&!a&&jsxRuntimeExports.jsx("span",{className:"ml-3 px-2 py-1 text-xs font-semibold bg-orange-100 text-orange-800 rounded-full",children:"Modo Usuario"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-3",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-gray-500 hidden sm:inline",children:"Sistema de Cálculo de Tarifas"}),jsxRuntimeExports.jsx(SOPGenerator,{tariffs:b,marginPercentage:O,discountPlans:W,selectedPlanGroup:ee,linearDiscount:Z?0:G,spc:T,variableSurcharge:0,irregularSurcharge:0,increment2026:L,selectedService:S,provincialCostOverride:Re,disabled:!b.length}),jsxRuntimeExports.jsxs("div",{className:"hidden sm:flex items-center text-sm text-gray-700",children:[jsxRuntimeExports.jsx(User,{className:"h-4 w-4 mr-2 text-gray-400"}),jsxRuntimeExports.jsx("span",{className:"font-medium",children:t==null?void 0:t.full_name})]}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("button",{onClick:()=>x(!c),className:"flex items-center space-x-2 px-3 py-2 rounded-lg hover:bg-gray-100 transition-colors",children:jsxRuntimeExports.jsx("div",{className:"w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center",children:jsxRuntimeExports.jsx("span",{className:"text-sm font-bold text-white",children:((fs=t==null?void 0:t.full_name)==null?void 0:fs.split(" ").map(Qe=>Qe[0]).join("").toUpperCase().slice(0,2))||(t==null?void 0:t.email.charAt(0).toUpperCase())})})}),c&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>x(!1)}),jsxRuntimeExports.jsxs("div",{className:"absolute right-0 mt-2 w-56 bg-white rounded-lg shadow-lg border border-gray-200 py-1 z-20",children:[jsxRuntimeExports.jsxs("div",{className:"px-4 py-3 border-b border-gray-200",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-gray-900",children:t==null?void 0:t.full_name}),jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500",children:t==null?void 0:t.email})]}),jsxRuntimeExports.jsxs("button",{onClick:()=>{o(!0),x(!1)},className:"flex items-center w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors",children:[jsxRuntimeExports.jsx(Settings,{className:"h-4 w-4 mr-3 text-gray-400"}),"Configuración"]}),xr&&a&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"border-t border-gray-200 my-1"}),jsxRuntimeExports.jsxs("button",{onClick:()=>{h(!0),x(!1)},className:"flex items-center w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors",children:[jsxRuntimeExports.jsx(Settings,{className:"h-4 w-4 mr-3 text-gray-400"}),"Panel de Administración"]})]}),xr&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"border-t border-gray-200 my-1"}),jsxRuntimeExports.jsx("div",{className:"px-4 py-2",children:jsxRuntimeExports.jsxs("label",{className:"flex items-center justify-between cursor-pointer",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center",children:[jsxRuntimeExports.jsx(Eye,{className:"h-4 w-4 mr-3 text-gray-400"}),jsxRuntimeExports.jsx("span",{className:"text-sm text-gray-700",children:"Ver como Usuario"})]}),jsxRuntimeExports.jsx("button",{onClick:ln,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 ${a?"bg-gray-200":"bg-blue-600"}`,children:jsxRuntimeExports.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${a?"translate-x-1":"translate-x-6"}`})})]})})]}),jsxRuntimeExports.jsx("div",{className:"border-t border-gray-200 mt-1 pt-1",children:jsxRuntimeExports.jsxs("button",{onClick:on,className:"flex items-center w-full px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition-colors",children:[jsxRuntimeExports.jsx(LogOut,{className:"h-4 w-4 mr-3"}),"Cerrar sesión"]})})]})]})]})]})]})})}),V?jsxRuntimeExports.jsx("div",{className:"bg-green-50 border-b border-green-200 px-4 sm:px-6 lg:px-8 py-2",children:jsxRuntimeExports.jsxs("div",{className:"max-w-7xl mx-auto flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:"inline-block w-2 h-2 bg-green-600 rounded-full animate-pulse"}),jsxRuntimeExports.jsxs("span",{className:"text-sm font-medium text-green-900",children:["Estado actual: Usando tabla personalizada para ",S]})]})}):jsxRuntimeExports.jsx("div",{className:"bg-gray-50 border-b border-gray-200 px-4 sm:px-6 lg:px-8 py-2",children:jsxRuntimeExports.jsxs("div",{className:"max-w-7xl mx-auto flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:"inline-block w-2 h-2 bg-gray-400 rounded-full"}),jsxRuntimeExports.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["Estado actual: Usando tabla oficial para ",S]})]})}),i&&jsxRuntimeExports.jsx(UserSettingsPanel,{onClose:()=>o(!1)}),xr&&a&&u&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-7xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Panel de Administración"}),jsxRuntimeExports.jsx("button",{onClick:()=>h(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:jsxRuntimeExports.jsx("svg",{className:"h-6 w-6 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:jsxRuntimeExports.jsx(AdminPanel,{})})]})}),jsxRuntimeExports.jsxs("div",{className:"px-4 sm:px-6 lg:px-8 py-8 space-y-8",children:[jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[Kt(),Ht()]}),jsxRuntimeExports.jsx("div",{className:"flex justify-end",children:jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>st(!0),className:"inline-flex items-center gap-2 rounded-lg bg-blue-600 px-4 py-2 text-sm font-semibold text-white shadow hover:bg-blue-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-blue-500",children:"COMPARADOR COMERCIAL"})}),jsxRuntimeExports.jsx(PackageManager,{packages:me,onChange:ir,selectedService:S,onClearPackages:Zs,validationErrors:C?nt:void 0}),mt&&jsxRuntimeExports.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(MapPin,{className:"h-5 w-5 text-red-600"}),jsxRuntimeExports.jsx("h4",{className:"text-sm font-semibold text-red-700 uppercase tracking-wide",children:"Kilometraje adicional"}),jsxRuntimeExports.jsx("span",{className:"text-xs text-red-600 font-medium",children:"¡Atención!, posibles cargos por kilometraje"})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-5 gap-3 text-sm",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-xs font-semibold text-red-700 mb-1 uppercase tracking-wide",children:"Kms"}),jsxRuntimeExports.jsx("input",{type:"number",min:"0",step:"0.1",value:xe,onChange:Qe=>Se(Number(Qe.target.value)||0),className:"w-full px-2 py-1.5 border border-red-200 rounded-md focus:ring-2 focus:ring-red-400 focus:border-transparent"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-xs font-semibold text-red-700 mb-1 uppercase tracking-wide",children:"Coste por km (€)"}),jsxRuntimeExports.jsx("input",{type:"text",readOnly:!0,value:et.toFixed(2),className:"w-full px-2 py-1.5 border border-red-200 rounded-md bg-red-100 text-red-800 font-semibold"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-xs font-semibold text-red-700 mb-1 uppercase tracking-wide",children:"PVP por km (€)"}),jsxRuntimeExports.jsx("input",{type:"number",min:"0",step:"0.01",value:Ce,onChange:Qe=>Me(Number(Qe.target.value)||0),className:"w-full px-2 py-1.5 border border-red-200 rounded-md focus:ring-2 focus:ring-red-400 focus:border-transparent"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-xs font-semibold text-red-700 mb-1 uppercase tracking-wide",children:"Total Coste (€)"}),jsxRuntimeExports.jsx("input",{type:"text",readOnly:!0,value:formatCurrency(rt),className:"w-full px-2 py-1.5 border border-red-200 rounded-md bg-red-100 text-red-800 font-semibold"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-xs font-semibold text-red-700 mb-1 uppercase tracking-wide",children:"Total Venta (€)"}),jsxRuntimeExports.jsx("input",{type:"text",readOnly:!0,value:formatCurrency(lt),className:"w-full px-2 py-1.5 border border-red-200 rounded-md bg-red-100 text-red-800 font-semibold"})]})]}),jsxRuntimeExports.jsx("p",{className:"text-xs font-semibold text-red-700 text-right uppercase tracking-wide",children:"Sumado al total PVP"})]}),jsxRuntimeExports.jsx("div",{className:"sticky top-28 z-30",children:jsxRuntimeExports.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-4 bg-white/80 backdrop-blur-sm border border-gray-200 rounded-full px-5 py-3 shadow",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 bg-blue-50 border border-blue-200 rounded-full px-4 py-2 shadow-inner",children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-semibold uppercase tracking-wide text-blue-800",children:"Modalidad"}),SHIPPING_MODES.map(Qe=>{const ot=ce===Qe;return jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>ye(Qe),className:`px-3 py-1.5 text-sm font-semibold rounded-full transition-colors ${ot?"bg-blue-600 text-white shadow":"bg-white text-blue-700 hover:bg-blue-100"}`,children:SHIPPING_MODE_LABELS[Qe]},Qe)})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsxs("button",{type:"button",onClick:cn,className:`inline-flex items-center gap-2 px-4 py-2 text-sm font-medium rounded-full transition-colors ${V?"bg-green-600 text-white hover:bg-green-700":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:[V?jsxRuntimeExports.jsx(Eye,{className:"h-4 w-4"}):jsxRuntimeExports.jsx(EyeOff,{className:"h-4 w-4"}),V?"Tabla Personalizada Activa":"Tabla Oficial Activa"]}),jsxRuntimeExports.jsx("button",{type:"button",onClick:Qs,className:`px-4 py-2 text-sm font-medium rounded-full transition-colors ${ft?"bg-blue-600 text-white":"bg-blue-50 text-blue-700 hover:bg-blue-100"}`,children:ft?"Ocultar costes":"Ver costes"}),jsxRuntimeExports.jsx("button",{type:"button",onClick:qs,className:`px-4 py-2 text-sm font-medium rounded-full transition-colors ${Ge?"bg-purple-600 text-white":"bg-purple-50 text-purple-700 hover:bg-purple-100"}`,children:Ge?"Ocultar PVP":"Ver PVP"}),jsxRuntimeExports.jsx("button",{type:"button",onClick:Js,className:"px-4 py-2 text-sm font-medium rounded-full bg-gray-100 text-gray-700 hover:bg-gray-200 transition-colors",children:"Limpiar datos"})]})]})}),Ve&&jsxRuntimeExports.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 flex items-start",children:[jsxRuntimeExports.jsx(AlertCircle,{className:"h-5 w-5 text-yellow-600 mr-3 mt-0.5"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-yellow-900",children:"SE HA DETECTADO UNO O VARIOS BULTOS IRREGULARES EN LA EXPEDICIÓN. TENGA EN CUENTA QUE EL TIEMPO DE TRÁNSITO SERÁ DE FPE+1."})]}),Je&&jsxRuntimeExports.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 flex items-start",children:[jsxRuntimeExports.jsx(AlertCircle,{className:"h-5 w-5 text-red-600 mr-3 mt-0.5"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-red-900",children:"DETECTADO UNO O VARIOS BULTOS NO ENCINTABLES. TENER EN CUENTA POSIBLES SANCIONES, RECARGOS Y +FPE."})]}),tt.length>0&&jsxRuntimeExports.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 flex items-start",children:[jsxRuntimeExports.jsx(AlertCircle,{className:"h-5 w-5 text-yellow-600 mr-3 mt-0.5"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-yellow-900",children:'Zonas no aplicables al servicio se marcan como "NO".'})]}),dt.length>0&&jsxRuntimeExports.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 flex items-start",children:[jsxRuntimeExports.jsx(AlertCircle,{className:"h-5 w-5 text-red-600 mr-3 mt-0.5"}),jsxRuntimeExports.jsxs("div",{className:"text-sm text-red-900",children:[jsxRuntimeExports.jsx("p",{className:"font-medium",children:"Reglas del servicio impiden estas combinaciones."}),jsxRuntimeExports.jsxs("p",{children:["El servicio ",jsxRuntimeExports.jsx("span",{className:"font-semibold",children:S}),' marca como "NO" las zonas',jsxRuntimeExports.jsxs("span",{className:"font-semibold",children:[" ",dt.join(", ")]})," para los bultos introducidos."]}),C&&jsxRuntimeExports.jsxs("p",{className:"mt-2 text-xs",children:[jsxRuntimeExports.jsx("span",{className:"font-semibold",children:"Limites Internacional Europa (por bulto):"})," Las 3 dimensiones deben encajar en los limites ",INTERNATIONAL_EUROPE_LIMITS.dimensionLimits.join("cm, "),"cm (asignacion dinamica). Perimetro max ",INTERNATIONAL_EUROPE_LIMITS.maxPerimeter,"cm (2xdim1 + 2xdim2 + dim mayor). Peso max ",INTERNATIONAL_EUROPE_LIMITS.maxWeight,"kg (",INTERNATIONAL_EUROPE_LIMITS.maxWeightGB,"kg a GB)."]})]})]}),jsxRuntimeExports.jsx("div",{className:`${!ft&&!Ge?"lg:sticky lg:top-36":""}`,children:jsxRuntimeExports.jsx(CostBreakdownTable,{costBreakdowns:ze,marginPercentage:O,packages:me,showCosts:ft,showPvp:Ge,shippingMode:ce,additionalPvp:lt,additionalPvpLabel:mt&&lt>0?"Kilometraje adicional":void 0,saturdayActive:Q&&S==="Urg14H Courier",saturdayPvp:Q&&S==="Urg14H Courier"?Te:0,onProvincialCostChange:Bt,provincialCostOverride:Re,onMarginChange:H,planSelected:!!ee||!!it,discountSummaryValue:Gt.value,discountSummaryDescription:Gt.description,highlightedZone:C?w:void 0,isInternationalService:C})})]}),jsxRuntimeExports.jsx(CommercialComparatorPanel,{isOpen:je,onClose:()=>st(!1),tables:St,onValueChange:en,availableServices:STATIC_SERVICES,selectedService:$e,onServiceChange:ne,discountPlans:de,selectedPlan:Pe,onPlanChange:hs,offerMargin:_e,onOfferMarginChange:tn,offerAverageMargin:jt.margin,onReset:rn,onMatchCompetition:sn,sopLauncher:jsxRuntimeExports.jsx(SOPGenerator,{tariffs:b,marginPercentage:O,discountPlans:W,selectedPlanGroup:ee,linearDiscount:Z?0:G,spc:T,variableSurcharge:0,irregularSurcharge:0,increment2026:L,selectedService:S,provincialCostOverride:Re,disabled:!b.length})}),jsxRuntimeExports.jsx("button",{type:"button",onClick:nn,className:"fixed bottom-6 right-6 z-40 inline-flex items-center justify-center w-12 h-12 rounded-full bg-blue-600 text-white shadow-lg hover:bg-blue-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-blue-500","aria-label":"Volver arriba",children:jsxRuntimeExports.jsx(ArrowUp,{className:"h-5 w-5"})}),J&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 px-4",children:jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-sm w-full p-6 space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx(MapPin,{className:"h-6 w-6 text-red-600"}),jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"¡Atención!"})]}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-700",children:"El servicio seleccionado puede generar cargos adicionales por kilometraje. Revisa los datos antes de confirmar el envío."}),jsxRuntimeExports.jsx("button",{type:"button",onClick:an,className:"w-full inline-flex justify-center items-center px-4 py-2 text-sm font-semibold text-white bg-red-600 rounded-md hover:bg-red-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-red-500",children:"Entendido"})]})}),ve&&jsxRuntimeExports.jsx(CommercialPlansManager,{onClose:()=>{we(!1),He()},onPlanSelected:Qe=>{Qe&&console.log("Plan seleccionado:",Qe),we(!1),He()}})]})};function PricingPage({onBack:t,userEmail:r}){const{user:e}=useAuth(),[s,a]=reactExports.useState(!0),[i,o]=reactExports.useState(!1),c=r||(e==null?void 0:e.email),x=async(u,h)=>{if(!c){alert("Email requerido. Por favor, inicia sesión o introduce tu email.");return}o(!0);try{const _=await fetch("https://eyvhuoldrjfntkffpkfm.supabase.co/functions/v1/create-checkout-session",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV5dmh1b2xkcmpmbnRrZmZwa2ZtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg2Mzk3MjgsImV4cCI6MjA3NDIxNTcyOH0.3zYeVfbaU71HNYQK_29Qki1fnQhLGccFtIFDZn_x2Es"},body:JSON.stringify({tier:u,paymentType:h,userId:e==null?void 0:e.id,email:c})}),v=await _.json();if(!_.ok)throw new Error(v.error||"Error al crear sesión de pago");if(v.checkoutUrl)window.location.href=v.checkoutUrl;else throw new Error("No se recibió URL de checkout")}catch(_){console.error("Error selecting plan:",_),alert(_ instanceof Error?_.message:"Error al procesar el pago. Por favor, inténtalo de nuevo."),o(!1)}};return jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-green-50",children:jsxRuntimeExports.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-12",children:[t&&jsxRuntimeExports.jsxs("button",{onClick:t,className:"mb-8 flex items-center gap-2 text-gray-600 hover:text-gray-900 transition-colors",children:[jsxRuntimeExports.jsx(ArrowLeft,{className:"h-5 w-5"}),"Volver"]}),r&&!e&&jsxRuntimeExports.jsx("div",{className:"max-w-3xl mx-auto mb-6 bg-blue-50 border border-blue-200 rounded-xl p-4",children:jsxRuntimeExports.jsxs("p",{className:"text-sm text-blue-900 text-center",children:[jsxRuntimeExports.jsx("span",{className:"font-semibold",children:"Comprando como:"})," ",r,jsxRuntimeExports.jsx("br",{}),jsxRuntimeExports.jsx("span",{className:"text-blue-700 text-xs",children:"Recibirás un código de acceso por email tras completar el pago"})]})}),jsxRuntimeExports.jsxs("div",{className:"text-center mb-4",children:[jsxRuntimeExports.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-blue-600 rounded-3xl mb-6 shadow-lg",children:jsxRuntimeExports.jsx(Calculator,{className:"h-10 w-10 text-white"})}),jsxRuntimeExports.jsx("h1",{className:"text-5xl font-bold text-gray-900 mb-4",children:"Elige tu plan ideal"}),jsxRuntimeExports.jsx("p",{className:"text-xl text-gray-600 max-w-3xl mx-auto mb-2",children:"Pago flexible: mensual o anual con hasta 2 meses gratis"}),jsxRuntimeExports.jsx("p",{className:"text-lg text-gray-500 max-w-2xl mx-auto",children:"Herramienta especializada para empresarios GLS con ROI en días"})]}),jsxRuntimeExports.jsx(PricingToggle,{isAnnual:s,onToggle:a}),jsxRuntimeExports.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 mb-12",children:pricingPlans.map(u=>jsxRuntimeExports.jsx(PlanCard,{plan:u,isAnnual:s,onSelect:x,isLoading:i},u.id))}),jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-8 mb-8",children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6 text-center",children:"¿Por qué elegir nuestra calculadora?"}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-blue-100 rounded-2xl mb-4",children:jsxRuntimeExports.jsx(Calculator,{className:"h-8 w-8 text-blue-600"})}),jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Precisión Total"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600",children:"Cálculos exactos incluyendo costes ocultos e incrementos que otras herramientas ignoran"})]}),jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-green-100 rounded-2xl mb-4",children:jsxRuntimeExports.jsx(Shield,{className:"h-8 w-8 text-green-600"})}),jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Ahorro Inmediato"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600",children:"Recupera tu inversión en días con un solo uso diario en mostrador"})]}),jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-orange-100 rounded-2xl mb-4",children:jsxRuntimeExports.jsx(Calculator,{className:"h-8 w-8 text-orange-600"})}),jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Comparativa Competitiva"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600",children:"Genera propuestas profesionales y comparativas con la competencia en minutos"})]})]})]}),s&&jsxRuntimeExports.jsx("div",{className:"bg-gradient-to-r from-green-50 to-blue-50 border-2 border-green-200 rounded-2xl p-6 mb-8",children:jsxRuntimeExports.jsxs("p",{className:"text-center text-gray-800",children:[jsxRuntimeExports.jsx("span",{className:"font-bold text-green-700",children:"Plan Corporativo:"})," Hasta 58% más barato por dispositivo que planes individuales"]})}),jsxRuntimeExports.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-6 text-center",children:[jsxRuntimeExports.jsxs("p",{className:"text-sm text-gray-700",children:[jsxRuntimeExports.jsx("span",{className:"font-semibold",children:"Precios sin IVA."})," Pago seguro procesado por Stripe. Cancela en cualquier momento."]}),jsxRuntimeExports.jsx("p",{className:"text-sm text-blue-800 mt-2 font-medium",children:"Solo usuarios @gls-spain.es • Soporte técnico incluido • Actualizaciones automáticas"})]}),jsxRuntimeExports.jsxs("p",{className:"mt-8 text-center text-xs text-gray-500",children:["© ",new Date().getFullYear()," Lógica Logística. Todos los derechos reservados."]})]})})}const MOTIVATIONAL_MESSAGES=["Todo va bien, solo unos segundos más...","Configurando tu suscripción...","Activando tu cuenta...","Preparando tus dispositivos...","Casi listo, últimos ajustes...","Verificando tu pago con Stripe...","Creando tu perfil de usuario...","Sincronizando tus datos..."],PHASE_MESSAGES=[{time:0,message:"Procesando tu pago con Stripe...",progress:25},{time:30,message:"Confirmando pago y creando tu cuenta...",progress:50},{time:60,message:"Activando tu suscripción en nuestros servidores...",progress:75},{time:90,message:"Casi listo, últimos ajustes...",progress:90}];function PaymentSuccess(){const t=useNavigate(),[r,e]=reactExports.useState(null),[s,a]=reactExports.useState(!0),[i,o]=reactExports.useState(0),[c,x]=reactExports.useState(0),[u,h]=reactExports.useState(""),[_,v]=reactExports.useState(""),b=120,E=3e3,d=8e3,g=I=>{for(let w=PHASE_MESSAGES.length-1;w>=0;w--)if(I>=PHASE_MESSAGES[w].time)return PHASE_MESSAGES[w];return PHASE_MESSAGES[0]};reactExports.useEffect(()=>{const I=new URLSearchParams(window.location.search),w=I.get("session_id"),j=I.get("email");if(!w){e({status:"error",message:"No se encontró ID de sesión",error:"Falta el parámetro session_id en la URL"}),a(!1);return}if(!j){e({status:"error",message:"No se encontró email",error:"Falta el parámetro email en la URL"}),a(!1);return}h(w),v(j);const C={email:j,sessionId:w,timestamp:new Date().toISOString()};localStorage.setItem("pending_activation",JSON.stringify(C))},[]),reactExports.useEffect(()=>{if(!_||!s)return;const I=async()=>{try{const C=await(await fetch(`https://eyvhuoldrjfntkffpkfm.supabase.co/functions/v1/check-user-activation-status?email=${encodeURIComponent(_)}&session_id=${encodeURIComponent(u)}`,{method:"GET",headers:{Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV5dmh1b2xkcmpmbnRrZmZwa2ZtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg2Mzk3MjgsImV4cCI6MjA3NDIxNTcyOH0.3zYeVfbaU71HNYQK_29Qki1fnQhLGccFtIFDZn_x2Es","Content-Type":"application/json"}})).json();C.status==="active"?(e({status:"active",message:C.message,user:C.user}),a(!1),localStorage.removeItem("pending_activation"),localStorage.setItem("recently_activated",JSON.stringify({email:_,timestamp:new Date().toISOString()})),setTimeout(()=>{t("/")},2e3)):C.status==="pending"?e({status:"pending",message:C.message}):e({status:"error",message:C.message||"Error al verificar activación",error:C.error})}catch(j){console.error("Error checking activation status:",j),e({status:"error",message:"Error de conexión",error:j instanceof Error?j.message:"Error desconocido"})}};I();const w=setInterval(()=>{i<b&&I()},E);return()=>clearInterval(w)},[_,u,s,i,t]),reactExports.useEffect(()=>{if(!s)return;const I=setInterval(()=>{o(w=>{const j=w+1;return j>=b&&(a(!1),e({status:"timeout",message:"El proceso de activación está tardando más de lo esperado",error:"Timeout después de 120 segundos"})),j})},1e3);return()=>clearInterval(I)},[s]),reactExports.useEffect(()=>{const I=setInterval(()=>{x(w=>(w+1)%MOTIVATIONAL_MESSAGES.length)},d);return()=>clearInterval(I)},[]);const y=()=>{a(!0),o(0),e(null)},R=()=>{localStorage.removeItem("pending_activation"),localStorage.setItem("recently_activated",JSON.stringify({email:_,timestamp:new Date().toISOString()})),t("/")},P=()=>{const I=encodeURIComponent("Problema con activación de cuenta"),w=encodeURIComponent(`Hola,

He completado el pago pero mi cuenta no se ha activado.

Detalles:
- Email: ${_}
- Session ID: ${u}
- Timestamp: ${new Date().toISOString()}

Por favor, ayúdenme a resolver este problema.

Gracias.`);window.location.href=`mailto:dcprats@gmail.com?subject=${I}&body=${w}`};if((r==null?void 0:r.status)==="active")return jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-gradient-to-br from-green-50 via-white to-blue-50 flex items-center justify-center p-4",children:jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-12 text-center max-w-md w-full",children:[jsxRuntimeExports.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-green-100 rounded-full mb-6 animate-bounce",children:jsxRuntimeExports.jsx(CheckCircle,{className:"h-12 w-12 text-green-600"})}),jsxRuntimeExports.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"¡Cuenta activada!"}),jsxRuntimeExports.jsx("p",{className:"text-lg text-gray-600 mb-8",children:"Tu suscripción está lista. Redirigiendo al login..."}),r.user&&jsxRuntimeExports.jsxs("div",{className:"bg-gray-50 rounded-xl p-6 mb-8 text-left",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Detalles de tu suscripción"}),jsxRuntimeExports.jsxs("div",{className:"space-y-2 text-sm",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-gray-600",children:"Plan:"}),jsxRuntimeExports.jsxs("span",{className:"font-semibold text-gray-900",children:["Tier ",r.user.subscription_tier]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-gray-600",children:"Dispositivos:"}),jsxRuntimeExports.jsxs("span",{className:"font-semibold text-gray-900",children:[r.user.max_devices," ",r.user.max_devices===1?"dispositivo":"dispositivos"]})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-gray-500",children:[jsxRuntimeExports.jsx(Loader2,{className:"h-4 w-4 animate-spin"}),jsxRuntimeExports.jsx("span",{children:"Redirigiendo..."})]})]})});if((r==null?void 0:r.status)==="timeout"||(r==null?void 0:r.status)==="error")return jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-gradient-to-br from-orange-50 via-white to-red-50 flex items-center justify-center p-4",children:jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-12 text-center max-w-lg w-full",children:[jsxRuntimeExports.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-orange-100 rounded-full mb-6",children:jsxRuntimeExports.jsx(AlertCircle,{className:"h-8 w-8 text-orange-600"})}),jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:r.status==="timeout"?"Activación en proceso":"Error temporal"}),jsxRuntimeExports.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-6",children:[jsxRuntimeExports.jsx("p",{className:"text-sm text-green-800 font-semibold mb-1",children:"✓ Tu pago se procesó correctamente"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-green-700",children:"El cargo ya está confirmado en Stripe"})]}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 mb-6",children:r.message}),u&&jsxRuntimeExports.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 mb-6 text-left",children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-600 mb-2",children:"Para soporte técnico:"}),jsxRuntimeExports.jsxs("p",{className:"text-xs font-mono text-gray-900 break-all",children:["Session ID: ",u]}),jsxRuntimeExports.jsxs("p",{className:"text-xs font-mono text-gray-900 mt-1",children:["Email: ",_]})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsxs("button",{onClick:y,className:"w-full flex items-center justify-center gap-2 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:[jsxRuntimeExports.jsx(RefreshCw,{className:"h-5 w-5"}),"Reintentar verificación"]}),jsxRuntimeExports.jsxs("button",{onClick:R,className:"w-full flex items-center justify-center gap-2 px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium",children:[jsxRuntimeExports.jsx(Home,{className:"h-5 w-5"}),"Ir al login (intentar en 5 min)"]}),jsxRuntimeExports.jsxs("button",{onClick:P,className:"w-full flex items-center justify-center gap-2 px-6 py-3 bg-white text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors font-medium",children:[jsxRuntimeExports.jsx(Mail,{className:"h-5 w-5"}),"Contactar soporte"]})]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500 mt-6",children:"En la mayoría de casos, tu cuenta se activará en pocos minutos. Puedes cerrar esta ventana e intentar hacer login más tarde."})]})});const F=g(i),S=Math.min(95,F.progress+(i-F.time)*.5);return jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-green-50 flex items-center justify-center p-4",children:jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-12 text-center max-w-md w-full",children:[jsxRuntimeExports.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-blue-100 rounded-full mb-6",children:jsxRuntimeExports.jsx(Loader2,{className:"h-12 w-12 text-blue-600 animate-spin"})}),jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:F.message}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600 mb-6 animate-pulse",children:MOTIVATIONAL_MESSAGES[c]}),jsxRuntimeExports.jsxs("div",{className:"mb-6",children:[jsxRuntimeExports.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3 mb-2 overflow-hidden",children:jsxRuntimeExports.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-green-500 h-3 rounded-full transition-all duration-1000 ease-out",style:{width:`${S}%`}})}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-gray-500",children:[i,"s / ",b,"s"]})]}),jsxRuntimeExports.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:[jsxRuntimeExports.jsx("p",{className:"text-sm text-blue-900 font-semibold mb-1",children:"¿Por qué tarda?"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-blue-800",children:"Stripe procesa tu pago y luego nuestro sistema crea tu cuenta automáticamente. Este proceso suele tardar entre 10-30 segundos."})]}),i>60&&jsxRuntimeExports.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 animate-fade-in",children:jsxRuntimeExports.jsxs("p",{className:"text-xs text-green-800",children:[jsxRuntimeExports.jsx("strong",{children:"Tranquilo, todo va bien."})," Algunos pagos tardan un poco más en procesarse. Si prefieres, puedes cerrar esta ventana e intentar hacer login en unos minutos."]})}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-gray-400 mt-6",children:["Email: ",_]})]})})}function PDFUploadGate(){const{user:t}=useAuth(),[r,e]=reactExports.useState(null),[s,a]=reactExports.useState("idle"),[i,o]=reactExports.useState(null),[c,x]=reactExports.useState(!1),u=reactExports.useRef(null),h=g=>{if(g){if(g.type!=="application/pdf"){o("Por favor, selecciona un archivo PDF válido.");return}if(g.size>10*1024*1024){o("El archivo es demasiado grande. El tamaño máximo es 10MB.");return}e(g),o(null)}},_=g=>{g.preventDefault(),x(!0)},v=()=>{x(!1)},b=g=>{g.preventDefault(),x(!1);const y=g.dataTransfer.files[0];h(y)},E=async()=>{if(!(!r||!t)){a("uploading"),o(null);try{const g=new FormData;g.append("pdf",r),g.append("userId",t.id),a("validating");const P=await fetch("https://eyvhuoldrjfntkffpkfm.supabase.co/functions/v1/upload-and-validate-tariff",{method:"POST",headers:{Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV5dmh1b2xkcmpmbnRrZmZwa2ZtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg2Mzk3MjgsImV4cCI6MjA3NDIxNTcyOH0.3zYeVfbaU71HNYQK_29Qki1fnQhLGccFtIFDZn_x2Es"},body:g});if(!P.ok){const S=await P.json();throw new Error(S.error||"Error al procesar el archivo")}const F=await P.json();F.is_activated?(a("success"),setTimeout(()=>{window.location.reload()},2e3)):(a("error"),o(F.message||"El PDF no pudo ser validado correctamente"))}catch(g){console.error("Upload error:",g),a("error"),o(g.message||"Error al procesar el archivo. Por favor, intenta de nuevo.")}}},d=()=>{switch(s){case"uploading":return jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[jsxRuntimeExports.jsx(Loader,{className:"w-16 h-16 text-blue-600 animate-spin mb-4"}),jsxRuntimeExports.jsx("p",{className:"text-lg font-medium text-gray-700",children:"Subiendo archivo..."}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Por favor, espera un momento"})]});case"validating":return jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[jsxRuntimeExports.jsx(Loader,{className:"w-16 h-16 text-blue-600 animate-spin mb-4"}),jsxRuntimeExports.jsx("p",{className:"text-lg font-medium text-gray-700",children:"Validando documento..."}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Verificando que sea la tarifa oficial GLS 2025"})]});case"success":return jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[jsxRuntimeExports.jsx(CheckCircle,{className:"w-16 h-16 text-green-600 mb-4"}),jsxRuntimeExports.jsx("p",{className:"text-lg font-medium text-gray-700",children:"¡PDF validado correctamente!"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Redirigiendo a la aplicación..."})]});case"error":return jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[jsxRuntimeExports.jsx(XCircle,{className:"w-16 h-16 text-red-600 mb-4"}),jsxRuntimeExports.jsx("p",{className:"text-lg font-medium text-gray-700",children:"Error de validación"}),i&&jsxRuntimeExports.jsx("div",{className:"mt-4 p-4 bg-red-50 border border-red-200 rounded-lg max-w-md",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-red-700",children:i})}),jsxRuntimeExports.jsx("button",{onClick:()=>{a("idle"),o(null),e(null)},className:"mt-6 px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Intentar de nuevo"})]});default:return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{onDragOver:_,onDragLeave:v,onDrop:b,onClick:()=>{var g;return(g=u.current)==null?void 0:g.click()},className:`border-2 border-dashed rounded-lg p-12 text-center cursor-pointer transition-all ${c?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-blue-400 hover:bg-gray-50"}`,children:[jsxRuntimeExports.jsx("input",{ref:u,type:"file",accept:".pdf",onChange:g=>{var y;return h(((y=g.target.files)==null?void 0:y[0])||null)},className:"hidden"}),r?jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center",children:[jsxRuntimeExports.jsx(FileText,{className:"w-16 h-16 text-blue-600 mb-4"}),jsxRuntimeExports.jsx("p",{className:"text-lg font-medium text-gray-700",children:r.name}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:[(r.size/1024/1024).toFixed(2)," MB"]})]}):jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center",children:[jsxRuntimeExports.jsx(Upload,{className:"w-16 h-16 text-gray-400 mb-4"}),jsxRuntimeExports.jsx("p",{className:"text-lg font-medium text-gray-700",children:"Arrastra tu PDF aquí o haz clic para seleccionar"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"PDF de tarifa oficial GLS 2025 (máximo 10MB)"})]})]}),r&&jsxRuntimeExports.jsx("button",{onClick:E,className:"w-full mt-6 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:"Validar y continuar"}),i&&jsxRuntimeExports.jsx("div",{className:"mt-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-red-700",children:i})})]})}};return jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-blue-50 flex items-center justify-center p-4",children:jsxRuntimeExports.jsx("div",{className:"max-w-2xl w-full",children:jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:[jsxRuntimeExports.jsxs("div",{className:"text-center mb-8",children:[jsxRuntimeExports.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-3",children:"Configuración Inicial"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600",children:"Para comenzar a utilizar la aplicación, necesitamos validar tu tarifa oficial de costes GLS 2025."}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Esta verificación es necesaria por motivos de seguridad y para garantizar la precisión de los cálculos."})]}),d(),jsxRuntimeExports.jsx("div",{className:"mt-8 pt-6 border-t border-gray-200",children:jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500 text-center",children:"Tu archivo será procesado de forma segura y almacenado únicamente para validación."})})]})})})}function isSubscriptionActive(t){if(!t)return!1;const{subscription_status:r,subscription_end_date:e}=t;return r==="cancelled"?!1:r==="active"||r==="trial"?new Date(e)>new Date:!1}function isSubscriptionExpired(t){return new Date(t)<=new Date}function canAccessCalculator(t){if(!t)return!1;const r=isSubscriptionActive(t),e=!isSubscriptionExpired(t.subscription_end_date);return r&&e}function useRequireActivation(){const{user:t,isAuthenticated:r}=useAuth(),[e,s]=reactExports.useState(!1),[a,i]=reactExports.useState(!0),[o,c]=reactExports.useState(null);reactExports.useEffect(()=>{if(!r||!t){i(!1),s(!1);return}x()},[t,r]);const x=async()=>{if(t)try{i(!0),c(null),console.log("[useRequireActivation] Checking activation for user:",t.id);const{data:u,error:h}=await supabase.functions.invoke("check-tariff-activation",{body:{userId:t.id}});if(h)throw console.error("[useRequireActivation] Function error:",h),h;console.log("[useRequireActivation] Activation status:",u),s((u==null?void 0:u.is_activated)||!1)}catch(u){console.error("[useRequireActivation] Error checking activation status:",u),c(u.message),s(!1)}finally{i(!1)}};return{isActivated:e,isLoading:a,error:o}}function MainContent(){const{isAuthenticated:t,isLoading:r,userData:e}=useAuth(),{isActivated:s,isLoading:a}=useRequireActivation(),[i,o]=reactExports.useState(!1),[c,x]=reactExports.useState(""),u=_=>{x(_),o(!0)},h=()=>{o(!1),x("")};return r||a?jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx(Loader2,{className:"h-12 w-12 animate-spin text-blue-600 mx-auto mb-4"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600",children:"Cargando..."})]})}):t?t&&!e?jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx(Loader2,{className:"h-12 w-12 animate-spin text-blue-600 mx-auto mb-4"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600",children:"Cargando perfil..."})]})}):canAccessCalculator(e)?s?jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-gray-50",children:jsxRuntimeExports.jsx(TariffCalculator,{})}):jsxRuntimeExports.jsx(PDFUploadGate,{}):jsxRuntimeExports.jsx(PricingPage,{userEmail:e==null?void 0:e.email}):i?jsxRuntimeExports.jsx(PricingPage,{onBack:h,userEmail:c}):jsxRuntimeExports.jsx(LoginContainer,{onShowPricing:u})}function AppContent(){return jsxRuntimeExports.jsxs(Routes,{children:[jsxRuntimeExports.jsx(Route,{path:"/",element:jsxRuntimeExports.jsx(MainContent,{})}),jsxRuntimeExports.jsx(Route,{path:"/payment-success",element:jsxRuntimeExports.jsx(PaymentSuccess,{})}),jsxRuntimeExports.jsx(Route,{path:"/pricing",element:jsxRuntimeExports.jsx(PricingPage,{})})]})}function App(){return jsxRuntimeExports.jsx(BrowserRouter,{basename:"/area-privada2/calculadora",future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:jsxRuntimeExports.jsx(AuthProvider,{children:jsxRuntimeExports.jsx(PreferencesProvider,{children:jsxRuntimeExports.jsx(ViewModeProvider,{children:jsxRuntimeExports.jsx(AppContent,{})})})})})}createRoot(document.getElementById("root")).render(jsxRuntimeExports.jsx(reactExports.StrictMode,{children:jsxRuntimeExports.jsx(App,{})}));
